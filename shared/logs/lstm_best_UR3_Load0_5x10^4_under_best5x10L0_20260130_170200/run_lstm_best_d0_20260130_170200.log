####################################################################################################################################################
### RUN: dataset_seed=0 K=84 test_fraction=0.2 val_fraction=0.1                                                                                  ###
### npz_in=/workspace/shared/data/preprocessed/delan_UR3_Load0_5x10^4_under_K84_seed0_dataset/delan_UR3_Load0_5x10^4_under_K84_seed0_dataset.npz ###
####################################################################################################################################################

#####################
### 1) PREPROCESS ###
#####################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_delan_dataset.py --derive_qdd_from_qd True --col_format wide --trajectory_amount 84 --test_fraction 0.2 --val_fraction 0.1 --seed 0 --lowpass_signals True --lowpass_cutoff_hz 10.0 --lowpass_order 4 --lowpass_qdd False --raw_csv /workspace/shared/data/raw/UR3_Load0_5x10^4_under.csv --out_npz /workspace/shared/data/preprocessed/delan_UR3_Load0_5x10^4_under_K84_seed0_dataset/delan_UR3_Load0_5x10^4_under_K84_seed0_dataset.npz' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Saved: /workspace/shared/data/preprocessed/delan_UR3_Load0_5x10^4_under_K84_seed0_dataset/delan_UR3_Load0_5x10^4_under_K84_seed0_dataset.npz
Saved: /workspace/shared/data/preprocessed/delan_UR3_Load0_5x10^4_under_K84_seed0_dataset/delan_UR3_Load0_5x10^4_under_K84_seed0_dataset.json
Trajectories: train=19 val=3 test=5
Exists: True


#####################################
### EXPORT RESIDUALS (best DeLaN) ###
#####################################

======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_UR3_Load0_5x10^4_under_K84_seed0_dataset/delan_UR3_Load0_5x10^4_under_K84_seed0_dataset.npz --ckpt /workspace/shared/models/delan/UR3_Load0_5x10^4_under__best5x10L0__K84__seed0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__seed0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.jax --out /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz' ===
======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_UR3_Load0_5x10^4_under_K84_seed0_dataset/delan_UR3_Load0_5x10^4_under_K84_seed0_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/UR3_Load0_5x10^4_under__best5x10L0__K84__seed0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__seed0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.jax
Detected n_dof=6 (seed=1)
2026-01-30 16:02:03.417380: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 19 trajectories
  done 19/19

Exporting split=test: 5 trajectories
  done 5/5

Saved residual trajectory dataset: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.json


##############################
### CONFIG: feat=full H=50 ###
##############################

#########################################
### BUILD LSTM WINDOWS H=50 feat=full ###
#########################################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --out_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --H 50 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
  out_npz     = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.json
H=50, n_dof=6, feature_dim=24
X_train: (34566, 50, 24)  Y_train: (34566, 6)
X_test : (5255, 50, 24)  Y_test : (5255, 6)
feature_mode=full


##############################
### TRAIN LSTM seed=0 H=50 ###
##############################

==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 0 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:02:12.085681: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:02:12.316126: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-0ew_ta6a because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (34566, 50, 24), Y_train = (34566, 6)
  X_test  = (5255, 50, 24),  Y_test  = (5255, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 16:02:14.307016: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:02:14.340681: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:02:14.342029: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:02:14.343717: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:02:14.344711: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:02:14.347436: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:02:14.434555: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:02:14.435541: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:02:14.436389: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:02:14.437389: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8964 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 16:02:15.585524: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
487/487 - 3s - 6ms/step - loss: 0.0966 - val_loss: 0.1397
Epoch 2/120
487/487 - 1s - 3ms/step - loss: 0.0485 - val_loss: 0.1445
Epoch 3/120
487/487 - 1s - 3ms/step - loss: 0.0403 - val_loss: 0.1374
Epoch 4/120
487/487 - 1s - 3ms/step - loss: 0.0365 - val_loss: 0.1651
Epoch 5/120
487/487 - 1s - 3ms/step - loss: 0.0335 - val_loss: 0.1852
Epoch 6/120
487/487 - 1s - 3ms/step - loss: 0.0329 - val_loss: 0.1541
Epoch 7/120
487/487 - 1s - 3ms/step - loss: 0.0310 - val_loss: 0.1708
Epoch 8/120
487/487 - 1s - 3ms/step - loss: 0.0303 - val_loss: 0.1701
Epoch 9/120
487/487 - 1s - 3ms/step - loss: 0.0290 - val_loss: 0.1637
Epoch 10/120
487/487 - 1s - 3ms/step - loss: 0.0289 - val_loss: 0.1755
Epoch 11/120
487/487 - 1s - 3ms/step - loss: 0.0279 - val_loss: 0.1575
Epoch 12/120
487/487 - 1s - 3ms/step - loss: 0.0272 - val_loss: 0.1913
Epoch 13/120
487/487 - 1s - 3ms/step - loss: 0.0266 - val_loss: 0.1706
Epoch 14/120
487/487 - 1s - 3ms/step - loss: 0.0265 - val_loss: 0.1651
Epoch 15/120
487/487 - 1s - 3ms/step - loss: 0.0258 - val_loss: 0.1715
Epoch 16/120
487/487 - 1s - 3ms/step - loss: 0.0256 - val_loss: 0.1808
Epoch 17/120
487/487 - 1s - 3ms/step - loss: 0.0256 - val_loss: 0.1864
Epoch 18/120
487/487 - 1s - 3ms/step - loss: 0.0251 - val_loss: 0.1924
Epoch 19/120
487/487 - 1s - 3ms/step - loss: 0.0246 - val_loss: 0.1808
Epoch 20/120
487/487 - 1s - 3ms/step - loss: 0.0244 - val_loss: 0.1831
Epoch 21/120
487/487 - 1s - 3ms/step - loss: 0.0241 - val_loss: 0.1765
Epoch 22/120
487/487 - 1s - 3ms/step - loss: 0.0236 - val_loss: 0.1721
Epoch 23/120
487/487 - 1s - 3ms/step - loss: 0.0234 - val_loss: 0.1709
Epoch 24/120
487/487 - 1s - 3ms/step - loss: 0.0235 - val_loss: 0.1666
Epoch 25/120
487/487 - 1s - 3ms/step - loss: 0.0234 - val_loss: 0.1825
Epoch 26/120
487/487 - 1s - 3ms/step - loss: 0.0229 - val_loss: 0.1817
Epoch 27/120
487/487 - 1s - 3ms/step - loss: 0.0235 - val_loss: 0.1676
Epoch 28/120
487/487 - 1s - 3ms/step - loss: 0.0227 - val_loss: 0.1791
Epoch 29/120
487/487 - 1s - 3ms/step - loss: 0.0222 - val_loss: 0.1665
Epoch 30/120
487/487 - 1s - 3ms/step - loss: 0.0221 - val_loss: 0.1887
Epoch 31/120
487/487 - 1s - 3ms/step - loss: 0.0221 - val_loss: 0.1766
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.2553
Per-joint RMSE: 0.1724 0.5019 0.1789 0.1724 0.2059 0.0724
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_rmse_time.png


#################################
### COMBINED EVAL seed=0 H=50 ###
#################################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/scalers_H50.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2 --H 50 --split test --features full --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl --K 84 --test_fraction 0.2 --seed 0 --dataset_seed 0 --delan_seed 1 --delan_epochs 200 --hp_preset lutter_like_256_wd1e4 --delan_rmse_val 0.23502598002565936 --delan_rmse_test 0.34739817995520866' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:03:02.262907: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:03:02.288834: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-bqja6rkx because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-30 16:03:03.398261: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:03:03.403328: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:03:03.404210: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:03:03.405850: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:03:03.406718: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:03:03.407456: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:03:03.488399: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:03:03.489330: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:03:03.490081: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:03:03.490817: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9131 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 16:03:03.797373: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.232794e-01  RMSE=3.511117e-01
  per-joint RMSE: 0.2735 0.6770 0.2133 0.1655 0.3373 0.1411
Residual LSTM:  MSE=6.358586e-02      RMSE=2.521624e-01
  per-joint RMSE: 0.1941 0.4721 0.2031 0.1687 0.2061 0.0933
Combined torque MSE=6.358586e-02     RMSE=2.521624e-01
  per-joint RMSE: 0.1941 0.4721 0.2031 0.1687 0.2061 0.0933
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_test_H50.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_rmse_time_test_H50.png


##############################
### TRAIN LSTM seed=1 H=50 ###
##############################

==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 1 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:03:05.671371: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:03:05.697049: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-5e35pi30 because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (34566, 50, 24), Y_train = (34566, 6)
  X_test  = (5255, 50, 24),  Y_test  = (5255, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 16:03:07.025056: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:03:07.029674: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:03:07.030517: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:03:07.032033: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:03:07.032813: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:03:07.033549: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:03:07.107940: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:03:07.108847: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:03:07.109588: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:03:07.110407: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9124 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 16:03:08.168306: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
487/487 - 3s - 6ms/step - loss: 0.0927 - val_loss: 0.1321
Epoch 2/120
487/487 - 1s - 3ms/step - loss: 0.0507 - val_loss: 0.1605
Epoch 3/120
487/487 - 1s - 3ms/step - loss: 0.0402 - val_loss: 0.1796
Epoch 4/120
487/487 - 1s - 3ms/step - loss: 0.0366 - val_loss: 0.1667
Epoch 5/120
487/487 - 1s - 3ms/step - loss: 0.0362 - val_loss: 0.1983
Epoch 6/120
487/487 - 1s - 3ms/step - loss: 0.0320 - val_loss: 0.1972
Epoch 7/120
487/487 - 1s - 3ms/step - loss: 0.0305 - val_loss: 0.2101
Epoch 8/120
487/487 - 1s - 3ms/step - loss: 0.0298 - val_loss: 0.2083
Epoch 9/120
487/487 - 1s - 3ms/step - loss: 0.0290 - val_loss: 0.1842
Epoch 10/120
487/487 - 1s - 3ms/step - loss: 0.0284 - val_loss: 0.1788
Epoch 11/120
487/487 - 1s - 3ms/step - loss: 0.0275 - val_loss: 0.1730
Epoch 12/120
487/487 - 1s - 3ms/step - loss: 0.0276 - val_loss: 0.1707
Epoch 13/120
487/487 - 1s - 3ms/step - loss: 0.0269 - val_loss: 0.1664
Epoch 14/120
487/487 - 1s - 3ms/step - loss: 0.0264 - val_loss: 0.1530
Epoch 15/120
487/487 - 1s - 3ms/step - loss: 0.0259 - val_loss: 0.1606
Epoch 16/120
487/487 - 1s - 3ms/step - loss: 0.0261 - val_loss: 0.1638
Epoch 17/120
487/487 - 1s - 3ms/step - loss: 0.0251 - val_loss: 0.1525
Epoch 18/120
487/487 - 1s - 3ms/step - loss: 0.0248 - val_loss: 0.1543
Epoch 19/120
487/487 - 1s - 3ms/step - loss: 0.0247 - val_loss: 0.1358
Epoch 20/120
487/487 - 1s - 3ms/step - loss: 0.0246 - val_loss: 0.1286
Epoch 21/120
487/487 - 1s - 3ms/step - loss: 0.0242 - val_loss: 0.1381
Epoch 22/120
487/487 - 1s - 3ms/step - loss: 0.0235 - val_loss: 0.1317
Epoch 23/120
487/487 - 1s - 3ms/step - loss: 0.0237 - val_loss: 0.1513
Epoch 24/120
487/487 - 1s - 3ms/step - loss: 0.0236 - val_loss: 0.1536
Epoch 25/120
487/487 - 1s - 3ms/step - loss: 0.0231 - val_loss: 0.1332
Epoch 26/120
487/487 - 1s - 3ms/step - loss: 0.0228 - val_loss: 0.1353
Epoch 27/120
487/487 - 1s - 3ms/step - loss: 0.0226 - val_loss: 0.1377
Epoch 28/120
487/487 - 1s - 3ms/step - loss: 0.0225 - val_loss: 0.1414
Epoch 29/120
487/487 - 1s - 3ms/step - loss: 0.0226 - val_loss: 0.1388
Epoch 30/120
487/487 - 1s - 3ms/step - loss: 0.0225 - val_loss: 0.1543
Epoch 31/120
487/487 - 1s - 3ms/step - loss: 0.0220 - val_loss: 0.1527
Epoch 32/120
487/487 - 1s - 3ms/step - loss: 0.0219 - val_loss: 0.1517
Epoch 33/120
487/487 - 1s - 3ms/step - loss: 0.0216 - val_loss: 0.1447
Epoch 34/120
487/487 - 1s - 3ms/step - loss: 0.0215 - val_loss: 0.1497
Epoch 35/120
487/487 - 1s - 3ms/step - loss: 0.0215 - val_loss: 0.1522
Epoch 36/120
487/487 - 1s - 3ms/step - loss: 0.0213 - val_loss: 0.1476
Epoch 37/120
487/487 - 1s - 3ms/step - loss: 0.0237 - val_loss: 0.1537
Epoch 38/120
487/487 - 1s - 3ms/step - loss: 0.0215 - val_loss: 0.1393
Epoch 39/120
487/487 - 1s - 3ms/step - loss: 0.0209 - val_loss: 0.1529
Epoch 40/120
487/487 - 1s - 3ms/step - loss: 0.0208 - val_loss: 0.1593
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.2487
Per-joint RMSE: 0.2019 0.4653 0.2001 0.1562 0.2089 0.0762
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_rmse_time.png


#################################
### COMBINED EVAL seed=1 H=50 ###
#################################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/scalers_H50.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2 --H 50 --split test --features full --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl --K 84 --test_fraction 0.2 --seed 1 --dataset_seed 0 --delan_seed 1 --delan_epochs 200 --hp_preset lutter_like_256_wd1e4 --delan_rmse_val 0.23502598002565936 --delan_rmse_test 0.34739817995520866' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:04:07.359749: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:04:07.385810: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-6ey_h9bn because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-30 16:04:08.386611: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:04:08.395067: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:04:08.395870: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:04:08.397896: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:04:08.398690: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:04:08.399432: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:04:08.479693: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:04:08.480530: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:04:08.481283: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:04:08.482012: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9203 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 16:04:08.788241: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.232794e-01  RMSE=3.511117e-01
  per-joint RMSE: 0.2735 0.6770 0.2133 0.1655 0.3373 0.1411
Residual LSTM:  MSE=6.185230e-02      RMSE=2.487012e-01
  per-joint RMSE: 0.2019 0.4653 0.2001 0.1562 0.2089 0.0763
Combined torque MSE=6.185230e-02     RMSE=2.487012e-01
  per-joint RMSE: 0.2019 0.4653 0.2001 0.1562 0.2089 0.0763
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_test_H50.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_rmse_time_test_H50.png


###############################
### CONFIG: feat=full H=100 ###
###############################

##########################################
### BUILD LSTM WINDOWS H=100 feat=full ###
##########################################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --out_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --H 100 --features full' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
  out_npz     = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
  H           = 100
  feature_mode= full
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.json
H=100, n_dof=6, feature_dim=24
X_train: (33616, 100, 24)  Y_train: (33616, 6)
X_test : (5005, 100, 24)  Y_test : (5005, 6)
feature_mode=full


###############################
### TRAIN LSTM seed=0 H=100 ###
###############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 0 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:04:11.285322: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:04:11.310599: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-2_txxz1q because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
   H  = 100
  din = 24
 dout = 6
  X_train = (33616, 100, 24), Y_train = (33616, 6)
  X_test  = (5005, 100, 24),  Y_test  = (5005, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/scalers_H100.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 16:04:12.901970: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:04:12.907042: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:04:12.907972: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:04:12.909774: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:04:12.910688: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:04:12.911630: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:04:12.998354: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:04:12.999350: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:04:13.000162: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:04:13.000952: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9185 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 100, 128)       │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 100, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 16:04:14.148460: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
473/473 - 3s - 7ms/step - loss: 0.0972 - val_loss: 0.1613
Epoch 2/120
473/473 - 2s - 4ms/step - loss: 0.0469 - val_loss: 0.1536
Epoch 3/120
473/473 - 2s - 4ms/step - loss: 0.0407 - val_loss: 0.1586
Epoch 4/120
473/473 - 2s - 4ms/step - loss: 0.0351 - val_loss: 0.1479
Epoch 5/120
473/473 - 2s - 4ms/step - loss: 0.0332 - val_loss: 0.1425
Epoch 6/120
473/473 - 2s - 4ms/step - loss: 0.0320 - val_loss: 0.1564
Epoch 7/120
473/473 - 2s - 4ms/step - loss: 0.0302 - val_loss: 0.1512
Epoch 8/120
473/473 - 2s - 4ms/step - loss: 0.0294 - val_loss: 0.1620
Epoch 9/120
473/473 - 2s - 4ms/step - loss: 0.0284 - val_loss: 0.1673
Epoch 10/120
473/473 - 2s - 4ms/step - loss: 0.0281 - val_loss: 0.1559
Epoch 11/120
473/473 - 2s - 4ms/step - loss: 0.0274 - val_loss: 0.1481
Epoch 12/120
473/473 - 2s - 4ms/step - loss: 0.0271 - val_loss: 0.1553
Epoch 13/120
473/473 - 2s - 4ms/step - loss: 0.0267 - val_loss: 0.1570
Epoch 14/120
473/473 - 2s - 4ms/step - loss: 0.0263 - val_loss: 0.1583
Epoch 15/120
473/473 - 2s - 4ms/step - loss: 0.0256 - val_loss: 0.1563
Epoch 16/120
473/473 - 2s - 4ms/step - loss: 0.0251 - val_loss: 0.1602
Epoch 17/120
473/473 - 2s - 4ms/step - loss: 0.0247 - val_loss: 0.1567
Epoch 18/120
473/473 - 2s - 4ms/step - loss: 0.0244 - val_loss: 0.1613
Epoch 19/120
473/473 - 2s - 4ms/step - loss: 0.0244 - val_loss: 0.1555
Epoch 20/120
473/473 - 2s - 4ms/step - loss: 0.0243 - val_loss: 0.1477
Epoch 21/120
473/473 - 2s - 4ms/step - loss: 0.0235 - val_loss: 0.1619
Epoch 22/120
473/473 - 2s - 4ms/step - loss: 0.0234 - val_loss: 0.1738
Epoch 23/120
473/473 - 2s - 4ms/step - loss: 0.0236 - val_loss: 0.1620
Epoch 24/120
473/473 - 2s - 4ms/step - loss: 0.0232 - val_loss: 0.1725
Epoch 25/120
473/473 - 2s - 4ms/step - loss: 0.0228 - val_loss: 0.1638
Epoch 26/120
473/473 - 2s - 4ms/step - loss: 0.0226 - val_loss: 0.1623
Epoch 27/120
473/473 - 2s - 4ms/step - loss: 0.0223 - val_loss: 0.1750
Epoch 28/120
473/473 - 2s - 4ms/step - loss: 0.0222 - val_loss: 0.1754
Epoch 29/120
473/473 - 2s - 4ms/step - loss: 0.0221 - val_loss: 0.1732
Epoch 30/120
473/473 - 2s - 4ms/step - loss: 0.0219 - val_loss: 0.1933
Epoch 31/120
473/473 - 2s - 4ms/step - loss: 0.0217 - val_loss: 0.1785
Epoch 32/120
473/473 - 2s - 4ms/step - loss: 0.0217 - val_loss: 0.1719
Epoch 33/120
473/473 - 2s - 4ms/step - loss: 0.0213 - val_loss: 0.1673
Epoch 34/120
473/473 - 2s - 4ms/step - loss: 0.0213 - val_loss: 0.1813
Epoch 35/120
473/473 - 2s - 4ms/step - loss: 0.0210 - val_loss: 0.1650
Epoch 36/120
473/473 - 2s - 4ms/step - loss: 0.0212 - val_loss: 0.1837
Epoch 37/120
473/473 - 2s - 4ms/step - loss: 0.0209 - val_loss: 0.1679
Epoch 38/120
473/473 - 2s - 4ms/step - loss: 0.0210 - val_loss: 0.1705
Epoch 39/120
473/473 - 2s - 4ms/step - loss: 0.0207 - val_loss: 0.1715
Epoch 40/120
473/473 - 2s - 4ms/step - loss: 0.0205 - val_loss: 0.1671
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_train_test_H100.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.2736
Per-joint RMSE: 0.2023 0.5354 0.1997 0.1816 0.2034 0.0848
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=0 H=100 ###
##################################

========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/scalers_H100.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2 --H 100 --split test --features full --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl --K 84 --test_fraction 0.2 --seed 0 --dataset_seed 0 --delan_seed 1 --delan_epochs 200 --hp_preset lutter_like_256_wd1e4 --delan_rmse_val 0.23502598002565936 --delan_rmse_test 0.34739817995520866' ===
========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:05:40.240349: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:05:40.266453: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-nm69swhq because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 100
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-30 16:05:41.260462: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:05:41.265268: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:05:41.266193: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:05:41.267792: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:05:41.268637: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:05:41.269421: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:05:41.348028: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:05:41.348955: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:05:41.349704: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:05:41.350440: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9206 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 16:05:41.652735: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.258905e-01  RMSE=3.548106e-01
  per-joint RMSE: 0.2690 0.6907 0.2073 0.1624 0.3421 0.1398
Residual LSTM:  MSE=7.447244e-02      RMSE=2.728964e-01
  per-joint RMSE: 0.2157 0.5079 0.2209 0.1907 0.2165 0.1016
Combined torque MSE=7.447244e-02     RMSE=2.728964e-01
  per-joint RMSE: 0.2157 0.5079 0.2209 0.1907 0.2165 0.1016
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_test_H100.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_test_H100.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/combined_predictions_test_H100.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_rmse_time_test_H100.png


###############################
### TRAIN LSTM seed=1 H=100 ###
###############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 1 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:05:43.567998: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:05:43.593203: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-1sy7o022 because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
   H  = 100
  din = 24
 dout = 6
  X_train = (33616, 100, 24), Y_train = (33616, 6)
  X_test  = (5005, 100, 24),  Y_test  = (5005, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/scalers_H100.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 16:05:45.195192: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:05:45.200128: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:05:45.200997: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:05:45.202776: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:05:45.203567: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:05:45.204307: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:05:45.286230: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:05:45.287155: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:05:45.287949: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:05:45.288744: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9201 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 100, 128)       │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 100, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 16:05:46.422254: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
473/473 - 3s - 7ms/step - loss: 0.0959 - val_loss: 0.1684
Epoch 2/120
473/473 - 2s - 4ms/step - loss: 0.0479 - val_loss: 0.1748
Epoch 3/120
473/473 - 2s - 4ms/step - loss: 0.0396 - val_loss: 0.1835
Epoch 4/120
473/473 - 2s - 4ms/step - loss: 0.0358 - val_loss: 0.1759
Epoch 5/120
473/473 - 2s - 4ms/step - loss: 0.0337 - val_loss: 0.1707
Epoch 6/120
473/473 - 2s - 4ms/step - loss: 0.0324 - val_loss: 0.1619
Epoch 7/120
473/473 - 2s - 4ms/step - loss: 0.0309 - val_loss: 0.1774
Epoch 8/120
473/473 - 2s - 4ms/step - loss: 0.0295 - val_loss: 0.1625
Epoch 9/120
473/473 - 2s - 4ms/step - loss: 0.0286 - val_loss: 0.1833
Epoch 10/120
473/473 - 2s - 4ms/step - loss: 0.0278 - val_loss: 0.1709
Epoch 11/120
473/473 - 2s - 4ms/step - loss: 0.0284 - val_loss: 0.1449
Epoch 12/120
473/473 - 2s - 4ms/step - loss: 0.0276 - val_loss: 0.1439
Epoch 13/120
473/473 - 2s - 4ms/step - loss: 0.0264 - val_loss: 0.1492
Epoch 14/120
473/473 - 2s - 4ms/step - loss: 0.0256 - val_loss: 0.1513
Epoch 15/120
473/473 - 2s - 4ms/step - loss: 0.0257 - val_loss: 0.1500
Epoch 16/120
473/473 - 2s - 4ms/step - loss: 0.0252 - val_loss: 0.1436
Epoch 17/120
473/473 - 2s - 4ms/step - loss: 0.0250 - val_loss: 0.1484
Epoch 18/120
473/473 - 2s - 4ms/step - loss: 0.0249 - val_loss: 0.1441
Epoch 19/120
473/473 - 2s - 4ms/step - loss: 0.0242 - val_loss: 0.1539
Epoch 20/120
473/473 - 2s - 4ms/step - loss: 0.0239 - val_loss: 0.1350
Epoch 21/120
473/473 - 2s - 4ms/step - loss: 0.0238 - val_loss: 0.1652
Epoch 22/120
473/473 - 2s - 4ms/step - loss: 0.0239 - val_loss: 0.1437
Epoch 23/120
473/473 - 2s - 4ms/step - loss: 0.0233 - val_loss: 0.1471
Epoch 24/120
473/473 - 2s - 4ms/step - loss: 0.0236 - val_loss: 0.1471
Epoch 25/120
473/473 - 2s - 4ms/step - loss: 0.0230 - val_loss: 0.1381
Epoch 26/120
473/473 - 2s - 4ms/step - loss: 0.0226 - val_loss: 0.1431
Epoch 27/120
473/473 - 2s - 4ms/step - loss: 0.0226 - val_loss: 0.1420
Epoch 28/120
473/473 - 2s - 4ms/step - loss: 0.0221 - val_loss: 0.1473
Epoch 29/120
473/473 - 2s - 4ms/step - loss: 0.0222 - val_loss: 0.1593
Epoch 30/120
473/473 - 2s - 4ms/step - loss: 0.0219 - val_loss: 0.1609
Epoch 31/120
473/473 - 2s - 4ms/step - loss: 0.0219 - val_loss: 0.1708
Epoch 32/120
473/473 - 2s - 4ms/step - loss: 0.0217 - val_loss: 0.1877
Epoch 33/120
473/473 - 2s - 4ms/step - loss: 0.0218 - val_loss: 0.1858
Epoch 34/120
473/473 - 2s - 4ms/step - loss: 0.0223 - val_loss: 0.1684
Epoch 35/120
473/473 - 2s - 4ms/step - loss: 0.0213 - val_loss: 0.1854
Epoch 36/120
473/473 - 2s - 4ms/step - loss: 0.0214 - val_loss: 0.1780
Epoch 37/120
473/473 - 2s - 4ms/step - loss: 0.0210 - val_loss: 0.1736
Epoch 38/120
473/473 - 2s - 4ms/step - loss: 0.0210 - val_loss: 0.1715
Epoch 39/120
473/473 - 2s - 4ms/step - loss: 0.0209 - val_loss: 0.1557
Epoch 40/120
473/473 - 2s - 4ms/step - loss: 0.0210 - val_loss: 0.1560
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_train_test_H100.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.2531
Per-joint RMSE: 0.1879 0.4965 0.1707 0.1513 0.2112 0.0766
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=1 H=100 ###
##################################

========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/scalers_H100.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2 --H 100 --split test --features full --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl --K 84 --test_fraction 0.2 --seed 1 --dataset_seed 0 --delan_seed 1 --delan_epochs 200 --hp_preset lutter_like_256_wd1e4 --delan_rmse_val 0.23502598002565936 --delan_rmse_test 0.34739817995520866' ===
========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:07:12.185513: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:07:12.211485: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-xgw1s4cp because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 100
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-30 16:07:13.208295: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:07:13.213183: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:07:13.214167: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:07:13.215762: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:07:13.216625: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:07:13.217361: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:07:13.291445: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:07:13.292293: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:07:13.293125: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:07:13.293858: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9210 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 16:07:13.599393: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.258905e-01  RMSE=3.548106e-01
  per-joint RMSE: 0.2690 0.6907 0.2073 0.1624 0.3421 0.1398
Residual LSTM:  MSE=6.404889e-02      RMSE=2.530788e-01
  per-joint RMSE: 0.1879 0.4965 0.1707 0.1513 0.2112 0.0766
Combined torque MSE=6.404889e-02     RMSE=2.530788e-01
  per-joint RMSE: 0.1879 0.4965 0.1707 0.1513 0.2112 0.0766
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_test_H100.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_test_H100.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/combined_predictions_test_H100.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_rmse_time_test_H100.png


###############################
### CONFIG: feat=state H=50 ###
###############################

##########################################
### BUILD LSTM WINDOWS H=50 feat=state ###
##########################################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --out_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --H 50 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
  out_npz     = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.json
H=50, n_dof=6, feature_dim=18
X_train: (34566, 50, 18)  Y_train: (34566, 6)
X_test : (5255, 50, 18)  Y_test : (5255, 6)
feature_mode=state


##############################
### TRAIN LSTM seed=0 H=50 ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 0 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:07:15.913434: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:07:15.938573: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-v08918cp because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (34566, 50, 18), Y_train = (34566, 6)
  X_test  = (5255, 50, 18),  Y_test  = (5255, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 16:07:17.221964: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:07:17.226600: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:07:17.227395: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:07:17.228909: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:07:17.229700: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:07:17.230432: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:07:17.320228: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:07:17.321129: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:07:17.322119: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:07:17.322898: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9192 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 16:07:18.317942: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
487/487 - 3s - 6ms/step - loss: 0.0964 - val_loss: 0.1542
Epoch 2/120
487/487 - 1s - 3ms/step - loss: 0.0517 - val_loss: 0.1660
Epoch 3/120
487/487 - 1s - 3ms/step - loss: 0.0418 - val_loss: 0.1805
Epoch 4/120
487/487 - 1s - 3ms/step - loss: 0.0374 - val_loss: 0.1844
Epoch 5/120
487/487 - 1s - 3ms/step - loss: 0.0346 - val_loss: 0.1833
Epoch 6/120
487/487 - 1s - 3ms/step - loss: 0.0327 - val_loss: 0.1782
Epoch 7/120
487/487 - 1s - 3ms/step - loss: 0.0326 - val_loss: 0.2050
Epoch 8/120
487/487 - 1s - 3ms/step - loss: 0.0313 - val_loss: 0.1640
Epoch 9/120
487/487 - 1s - 3ms/step - loss: 0.0297 - val_loss: 0.1701
Epoch 10/120
487/487 - 1s - 3ms/step - loss: 0.0290 - val_loss: 0.1588
Epoch 11/120
487/487 - 1s - 3ms/step - loss: 0.0290 - val_loss: 0.1561
Epoch 12/120
487/487 - 1s - 3ms/step - loss: 0.0281 - val_loss: 0.1438
Epoch 13/120
487/487 - 1s - 3ms/step - loss: 0.0271 - val_loss: 0.1652
Epoch 14/120
487/487 - 1s - 3ms/step - loss: 0.0271 - val_loss: 0.1500
Epoch 15/120
487/487 - 1s - 3ms/step - loss: 0.0268 - val_loss: 0.1426
Epoch 16/120
487/487 - 1s - 3ms/step - loss: 0.0264 - val_loss: 0.1473
Epoch 17/120
487/487 - 1s - 3ms/step - loss: 0.0259 - val_loss: 0.1403
Epoch 18/120
487/487 - 1s - 3ms/step - loss: 0.0258 - val_loss: 0.1497
Epoch 19/120
487/487 - 1s - 3ms/step - loss: 0.0255 - val_loss: 0.1406
Epoch 20/120
487/487 - 1s - 3ms/step - loss: 0.0250 - val_loss: 0.1325
Epoch 21/120
487/487 - 1s - 3ms/step - loss: 0.0251 - val_loss: 0.1504
Epoch 22/120
487/487 - 1s - 3ms/step - loss: 0.0245 - val_loss: 0.1269
Epoch 23/120
487/487 - 1s - 3ms/step - loss: 0.0242 - val_loss: 0.1228
Epoch 24/120
487/487 - 1s - 3ms/step - loss: 0.0238 - val_loss: 0.1289
Epoch 25/120
487/487 - 1s - 3ms/step - loss: 0.0239 - val_loss: 0.1235
Epoch 26/120
487/487 - 1s - 3ms/step - loss: 0.0234 - val_loss: 0.1230
Epoch 27/120
487/487 - 1s - 3ms/step - loss: 0.0235 - val_loss: 0.1290
Epoch 28/120
487/487 - 1s - 3ms/step - loss: 0.0231 - val_loss: 0.1292
Epoch 29/120
487/487 - 1s - 3ms/step - loss: 0.0251 - val_loss: 0.1198
Epoch 30/120
487/487 - 1s - 3ms/step - loss: 0.0229 - val_loss: 0.1177
Epoch 31/120
487/487 - 1s - 3ms/step - loss: 0.0227 - val_loss: 0.1310
Epoch 32/120
487/487 - 1s - 3ms/step - loss: 0.0226 - val_loss: 0.1252
Epoch 33/120
487/487 - 1s - 3ms/step - loss: 0.0225 - val_loss: 0.1302
Epoch 34/120
487/487 - 1s - 3ms/step - loss: 0.0222 - val_loss: 0.1203
Epoch 35/120
487/487 - 1s - 3ms/step - loss: 0.0221 - val_loss: 0.1295
Epoch 36/120
487/487 - 1s - 3ms/step - loss: 0.0222 - val_loss: 0.1330
Epoch 37/120
487/487 - 1s - 3ms/step - loss: 0.0221 - val_loss: 0.1285
Epoch 38/120
487/487 - 1s - 3ms/step - loss: 0.0216 - val_loss: 0.1375
Epoch 39/120
487/487 - 1s - 3ms/step - loss: 0.0216 - val_loss: 0.1250
Epoch 40/120
487/487 - 1s - 3ms/step - loss: 0.0213 - val_loss: 0.1361
Epoch 41/120
487/487 - 1s - 3ms/step - loss: 0.0214 - val_loss: 0.1389
Epoch 42/120
487/487 - 1s - 3ms/step - loss: 0.0213 - val_loss: 0.1604
Epoch 43/120
487/487 - 1s - 3ms/step - loss: 0.0210 - val_loss: 0.1372
Epoch 44/120
487/487 - 1s - 3ms/step - loss: 0.0210 - val_loss: 0.1404
Epoch 45/120
487/487 - 1s - 3ms/step - loss: 0.0208 - val_loss: 0.1395
Epoch 46/120
487/487 - 1s - 3ms/step - loss: 0.0210 - val_loss: 0.1456
Epoch 47/120
487/487 - 1s - 3ms/step - loss: 0.0206 - val_loss: 0.1447
Epoch 48/120
487/487 - 1s - 3ms/step - loss: 0.0206 - val_loss: 0.1480
Epoch 49/120
487/487 - 1s - 3ms/step - loss: 0.0206 - val_loss: 0.1392
Epoch 50/120
487/487 - 1s - 3ms/step - loss: 0.0204 - val_loss: 0.1379
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.2675
Per-joint RMSE: 0.1643 0.5051 0.2060 0.1729 0.2558 0.0971
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_rmse_time.png


#################################
### COMBINED EVAL seed=0 H=50 ###
#################################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/scalers_H50.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2 --H 50 --split test --features state --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl --K 84 --test_fraction 0.2 --seed 0 --dataset_seed 0 --delan_seed 1 --delan_epochs 200 --hp_preset lutter_like_256_wd1e4 --delan_rmse_val 0.23502598002565936 --delan_rmse_test 0.34739817995520866' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:08:31.420595: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:08:31.447798: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-9gaogpp3 because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 16:08:32.443566: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:08:32.448288: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:08:32.449136: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:08:32.450791: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:08:32.451583: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:08:32.452319: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:08:32.533780: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:08:32.534617: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:08:32.535386: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:08:32.536114: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9226 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 16:08:32.835295: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.232794e-01  RMSE=3.511117e-01
  per-joint RMSE: 0.2735 0.6770 0.2133 0.1655 0.3373 0.1411
Residual LSTM:  MSE=7.155088e-02      RMSE=2.674899e-01
  per-joint RMSE: 0.1643 0.5051 0.2060 0.1729 0.2558 0.0971
Combined torque MSE=7.155088e-02     RMSE=2.674899e-01
  per-joint RMSE: 0.1643 0.5051 0.2060 0.1729 0.2558 0.0971
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_test_H50.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_rmse_time_test_H50.png


##############################
### TRAIN LSTM seed=1 H=50 ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 1 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:08:34.715537: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:08:34.740727: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-u5rc9s7b because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (34566, 50, 18), Y_train = (34566, 6)
  X_test  = (5255, 50, 18),  Y_test  = (5255, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 16:08:36.014473: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:08:36.019037: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:08:36.019822: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:08:36.021355: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:08:36.022146: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:08:36.022893: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:08:36.093296: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:08:36.094150: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:08:36.094896: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:08:36.095717: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9226 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 16:08:37.110226: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
487/487 - 3s - 6ms/step - loss: 0.0952 - val_loss: 0.1717
Epoch 2/120
487/487 - 1s - 3ms/step - loss: 0.0512 - val_loss: 0.1975
Epoch 3/120
487/487 - 1s - 3ms/step - loss: 0.0421 - val_loss: 0.2368
Epoch 4/120
487/487 - 1s - 3ms/step - loss: 0.0382 - val_loss: 0.2374
Epoch 5/120
487/487 - 1s - 3ms/step - loss: 0.0358 - val_loss: 0.2369
Epoch 6/120
487/487 - 1s - 3ms/step - loss: 0.0334 - val_loss: 0.2219
Epoch 7/120
487/487 - 1s - 3ms/step - loss: 0.0317 - val_loss: 0.2204
Epoch 8/120
487/487 - 1s - 3ms/step - loss: 0.0310 - val_loss: 0.2225
Epoch 9/120
487/487 - 1s - 3ms/step - loss: 0.0296 - val_loss: 0.2059
Epoch 10/120
487/487 - 1s - 3ms/step - loss: 0.0288 - val_loss: 0.2140
Epoch 11/120
487/487 - 1s - 3ms/step - loss: 0.0283 - val_loss: 0.2019
Epoch 12/120
487/487 - 1s - 3ms/step - loss: 0.0278 - val_loss: 0.2033
Epoch 13/120
487/487 - 1s - 3ms/step - loss: 0.0273 - val_loss: 0.1880
Epoch 14/120
487/487 - 1s - 3ms/step - loss: 0.0268 - val_loss: 0.1802
Epoch 15/120
487/487 - 1s - 3ms/step - loss: 0.0270 - val_loss: 0.1739
Epoch 16/120
487/487 - 1s - 3ms/step - loss: 0.0263 - val_loss: 0.1788
Epoch 17/120
487/487 - 1s - 3ms/step - loss: 0.0258 - val_loss: 0.1844
Epoch 18/120
487/487 - 1s - 3ms/step - loss: 0.0252 - val_loss: 0.1718
Epoch 19/120
487/487 - 1s - 3ms/step - loss: 0.0250 - val_loss: 0.1691
Epoch 20/120
487/487 - 1s - 3ms/step - loss: 0.0250 - val_loss: 0.1858
Epoch 21/120
487/487 - 1s - 3ms/step - loss: 0.0244 - val_loss: 0.1800
Epoch 22/120
487/487 - 1s - 3ms/step - loss: 0.0245 - val_loss: 0.1783
Epoch 23/120
487/487 - 1s - 3ms/step - loss: 0.0240 - val_loss: 0.2023
Epoch 24/120
487/487 - 1s - 3ms/step - loss: 0.0240 - val_loss: 0.1849
Epoch 25/120
487/487 - 1s - 3ms/step - loss: 0.0236 - val_loss: 0.1903
Epoch 26/120
487/487 - 1s - 3ms/step - loss: 0.0234 - val_loss: 0.2038
Epoch 27/120
487/487 - 1s - 3ms/step - loss: 0.0232 - val_loss: 0.2017
Epoch 28/120
487/487 - 1s - 3ms/step - loss: 0.0233 - val_loss: 0.1984
Epoch 29/120
487/487 - 1s - 3ms/step - loss: 0.0228 - val_loss: 0.2043
Epoch 30/120
487/487 - 1s - 3ms/step - loss: 0.0227 - val_loss: 0.2105
Epoch 31/120
487/487 - 1s - 3ms/step - loss: 0.0226 - val_loss: 0.2134
Epoch 32/120
487/487 - 1s - 3ms/step - loss: 0.0222 - val_loss: 0.2252
Epoch 33/120
487/487 - 1s - 3ms/step - loss: 0.0222 - val_loss: 0.2375
Epoch 34/120
487/487 - 1s - 3ms/step - loss: 0.0221 - val_loss: 0.2208
Epoch 35/120
487/487 - 1s - 3ms/step - loss: 0.0219 - val_loss: 0.2144
Epoch 36/120
487/487 - 1s - 3ms/step - loss: 0.0217 - val_loss: 0.2319
Epoch 37/120
487/487 - 1s - 3ms/step - loss: 0.0219 - val_loss: 0.2088
Epoch 38/120
487/487 - 1s - 3ms/step - loss: 0.0225 - val_loss: 0.2507
Epoch 39/120
487/487 - 1s - 3ms/step - loss: 0.0221 - val_loss: 0.2132
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.2754
Per-joint RMSE: 0.1842 0.5558 0.1434 0.1632 0.2390 0.0892
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_rmse_time.png


#################################
### COMBINED EVAL seed=1 H=50 ###
#################################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/scalers_H50.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2 --H 50 --split test --features state --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl --K 84 --test_fraction 0.2 --seed 1 --dataset_seed 0 --delan_seed 1 --delan_epochs 200 --hp_preset lutter_like_256_wd1e4 --delan_rmse_val 0.23502598002565936 --delan_rmse_test 0.34739817995520866' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:09:34.839639: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:09:34.865219: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-9d4p3dea because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 16:09:35.829846: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:09:35.834435: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:09:35.835223: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:09:35.836878: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:09:35.837658: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:09:35.838395: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:09:35.914728: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:09:35.915558: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:09:35.916300: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:09:35.917028: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9287 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 16:09:36.218199: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.232794e-01  RMSE=3.511117e-01
  per-joint RMSE: 0.2735 0.6770 0.2133 0.1655 0.3373 0.1411
Residual LSTM:  MSE=7.584986e-02      RMSE=2.754085e-01
  per-joint RMSE: 0.1842 0.5558 0.1434 0.1632 0.2390 0.0892
Combined torque MSE=7.584987e-02     RMSE=2.754085e-01
  per-joint RMSE: 0.1842 0.5558 0.1434 0.1632 0.2390 0.0892
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_test_H50.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_rmse_time_test_H50.png


################################
### CONFIG: feat=state H=100 ###
################################

###########################################
### BUILD LSTM WINDOWS H=100 feat=state ###
###########################################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --out_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --H 100 --features state' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
  out_npz     = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
  H           = 100
  feature_mode= state
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.json
H=100, n_dof=6, feature_dim=18
X_train: (33616, 100, 18)  Y_train: (33616, 6)
X_test : (5005, 100, 18)  Y_test : (5005, 6)
feature_mode=state


###############################
### TRAIN LSTM seed=0 H=100 ###
###############################

==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 0 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:09:38.624936: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:09:38.652327: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-jzdz6hbx because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
   H  = 100
  din = 18
 dout = 6
  X_train = (33616, 100, 18), Y_train = (33616, 6)
  X_test  = (5005, 100, 18),  Y_test  = (5005, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/scalers_H100.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 16:09:40.158807: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:09:40.163702: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:09:40.165006: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:09:40.167702: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:09:40.168632: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:09:40.169398: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:09:40.254533: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:09:40.255462: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:09:40.256261: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:09:40.257059: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9268 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 100, 128)       │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 100, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 16:09:41.356902: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
473/473 - 3s - 7ms/step - loss: 0.0997 - val_loss: 0.1577
Epoch 2/120
473/473 - 2s - 4ms/step - loss: 0.0501 - val_loss: 0.1584
Epoch 3/120
473/473 - 2s - 4ms/step - loss: 0.0411 - val_loss: 0.1624
Epoch 4/120
473/473 - 2s - 4ms/step - loss: 0.0366 - val_loss: 0.1655
Epoch 5/120
473/473 - 2s - 4ms/step - loss: 0.0342 - val_loss: 0.1764
Epoch 6/120
473/473 - 2s - 4ms/step - loss: 0.0321 - val_loss: 0.1730
Epoch 7/120
473/473 - 2s - 4ms/step - loss: 0.0313 - val_loss: 0.1495
Epoch 8/120
473/473 - 2s - 4ms/step - loss: 0.0297 - val_loss: 0.1477
Epoch 9/120
473/473 - 2s - 4ms/step - loss: 0.0296 - val_loss: 0.1540
Epoch 10/120
473/473 - 2s - 5ms/step - loss: 0.0285 - val_loss: 0.1289
Epoch 11/120
473/473 - 2s - 4ms/step - loss: 0.0281 - val_loss: 0.1323
Epoch 12/120
473/473 - 2s - 4ms/step - loss: 0.0320 - val_loss: 0.1699
Epoch 13/120
473/473 - 2s - 4ms/step - loss: 0.0279 - val_loss: 0.1733
Epoch 14/120
473/473 - 2s - 4ms/step - loss: 0.0267 - val_loss: 0.1518
Epoch 15/120
473/473 - 2s - 4ms/step - loss: 0.0262 - val_loss: 0.1438
Epoch 16/120
473/473 - 2s - 4ms/step - loss: 0.0261 - val_loss: 0.1537
Epoch 17/120
473/473 - 2s - 4ms/step - loss: 0.0257 - val_loss: 0.1403
Epoch 18/120
473/473 - 2s - 4ms/step - loss: 0.0251 - val_loss: 0.1471
Epoch 19/120
473/473 - 2s - 4ms/step - loss: 0.0248 - val_loss: 0.1539
Epoch 20/120
473/473 - 2s - 4ms/step - loss: 0.0245 - val_loss: 0.1436
Epoch 21/120
473/473 - 2s - 4ms/step - loss: 0.0246 - val_loss: 0.1493
Epoch 22/120
473/473 - 2s - 4ms/step - loss: 0.0245 - val_loss: 0.1552
Epoch 23/120
473/473 - 2s - 4ms/step - loss: 0.0240 - val_loss: 0.1502
Epoch 24/120
473/473 - 2s - 4ms/step - loss: 0.0238 - val_loss: 0.1418
Epoch 25/120
473/473 - 2s - 4ms/step - loss: 0.0235 - val_loss: 0.1507
Epoch 26/120
473/473 - 2s - 4ms/step - loss: 0.0234 - val_loss: 0.1409
Epoch 27/120
473/473 - 2s - 4ms/step - loss: 0.0230 - val_loss: 0.1402
Epoch 28/120
473/473 - 2s - 4ms/step - loss: 0.0229 - val_loss: 0.1433
Epoch 29/120
473/473 - 2s - 4ms/step - loss: 0.0228 - val_loss: 0.1408
Epoch 30/120
473/473 - 2s - 4ms/step - loss: 0.0223 - val_loss: 0.1505
Epoch 31/120
473/473 - 2s - 4ms/step - loss: 0.0225 - val_loss: 0.1459
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_train_test_H100.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.2698
Per-joint RMSE: 0.1753 0.5406 0.1831 0.1605 0.2134 0.0956
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=0 H=100 ###
##################################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/scalers_H100.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2 --H 100 --split test --features state --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl --K 84 --test_fraction 0.2 --seed 0 --dataset_seed 0 --delan_seed 1 --delan_epochs 200 --hp_preset lutter_like_256_wd1e4 --delan_rmse_val 0.23502598002565936 --delan_rmse_test 0.34739817995520866' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:10:48.558090: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:10:48.584105: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-99ry3c5u because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 100
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 16:10:49.559770: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:10:49.564418: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:10:49.565237: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:10:49.566943: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:10:49.567721: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:10:49.568458: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:10:49.648422: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:10:49.649284: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:10:49.650037: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:10:49.650771: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9280 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 16:10:49.950697: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.258905e-01  RMSE=3.548106e-01
  per-joint RMSE: 0.2690 0.6907 0.2073 0.1624 0.3421 0.1398
Residual LSTM:  MSE=7.344804e-02      RMSE=2.710130e-01
  per-joint RMSE: 0.1887 0.5374 0.1865 0.1620 0.2150 0.0950
Combined torque MSE=7.344804e-02     RMSE=2.710130e-01
  per-joint RMSE: 0.1887 0.5374 0.1865 0.1620 0.2150 0.0950
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_test_H100.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_test_H100.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/combined_predictions_test_H100.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_rmse_time_test_H100.png


###############################
### TRAIN LSTM seed=1 H=100 ###
###############################

==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 1 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:10:51.844254: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:10:51.869906: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-39x_g5sq because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
   H  = 100
  din = 18
 dout = 6
  X_train = (33616, 100, 18), Y_train = (33616, 6)
  X_test  = (5005, 100, 18),  Y_test  = (5005, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/scalers_H100.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 16:10:53.374143: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:10:53.378749: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:10:53.379537: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:10:53.381242: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:10:53.382051: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:10:53.382780: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:10:53.456557: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:10:53.457751: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:10:53.458559: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:10:53.459293: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9279 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 100, 128)       │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 100, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 16:10:54.508916: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
473/473 - 3s - 7ms/step - loss: 0.0992 - val_loss: 0.1040
Epoch 2/120
473/473 - 2s - 4ms/step - loss: 0.0504 - val_loss: 0.1194
Epoch 3/120
473/473 - 2s - 4ms/step - loss: 0.0419 - val_loss: 0.1251
Epoch 4/120
473/473 - 2s - 4ms/step - loss: 0.0372 - val_loss: 0.1420
Epoch 5/120
473/473 - 2s - 4ms/step - loss: 0.0344 - val_loss: 0.1380
Epoch 6/120
473/473 - 2s - 4ms/step - loss: 0.0326 - val_loss: 0.1414
Epoch 7/120
473/473 - 2s - 4ms/step - loss: 0.0309 - val_loss: 0.1525
Epoch 8/120
473/473 - 2s - 4ms/step - loss: 0.0301 - val_loss: 0.1459
Epoch 9/120
473/473 - 2s - 5ms/step - loss: 0.0294 - val_loss: 0.1592
Epoch 10/120
473/473 - 2s - 5ms/step - loss: 0.0328 - val_loss: 0.1426
Epoch 11/120
473/473 - 2s - 5ms/step - loss: 0.0284 - val_loss: 0.1640
Epoch 12/120
473/473 - 2s - 5ms/step - loss: 0.0274 - val_loss: 0.1986
Epoch 13/120
473/473 - 2s - 4ms/step - loss: 0.0271 - val_loss: 0.1913
Epoch 14/120
473/473 - 2s - 4ms/step - loss: 0.0264 - val_loss: 0.1522
Epoch 15/120
473/473 - 2s - 4ms/step - loss: 0.0263 - val_loss: 0.1517
Epoch 16/120
473/473 - 2s - 4ms/step - loss: 0.0256 - val_loss: 0.1457
Epoch 17/120
473/473 - 2s - 4ms/step - loss: 0.0254 - val_loss: 0.1770
Epoch 18/120
473/473 - 2s - 4ms/step - loss: 0.0253 - val_loss: 0.1618
Epoch 19/120
473/473 - 2s - 4ms/step - loss: 0.0249 - val_loss: 0.1720
Epoch 20/120
473/473 - 2s - 4ms/step - loss: 0.0248 - val_loss: 0.1347
Epoch 21/120
473/473 - 2s - 4ms/step - loss: 0.0243 - val_loss: 0.1580
Epoch 22/120
473/473 - 2s - 4ms/step - loss: 0.0240 - val_loss: 0.1683
Epoch 23/120
473/473 - 2s - 4ms/step - loss: 0.0239 - val_loss: 0.1450
Epoch 24/120
473/473 - 2s - 4ms/step - loss: 0.0232 - val_loss: 0.1367
Epoch 25/120
473/473 - 2s - 4ms/step - loss: 0.0234 - val_loss: 0.1445
Epoch 26/120
473/473 - 2s - 4ms/step - loss: 0.0235 - val_loss: 0.1514
Epoch 27/120
473/473 - 2s - 4ms/step - loss: 0.0229 - val_loss: 0.1538
Epoch 28/120
473/473 - 2s - 4ms/step - loss: 0.0229 - val_loss: 0.1446
Epoch 29/120
473/473 - 2s - 4ms/step - loss: 0.0227 - val_loss: 0.1758
Epoch 30/120
473/473 - 2s - 4ms/step - loss: 0.0227 - val_loss: 0.1498
Epoch 31/120
473/473 - 2s - 4ms/step - loss: 0.0225 - val_loss: 0.1274
Epoch 32/120
473/473 - 2s - 4ms/step - loss: 0.0221 - val_loss: 0.1223
Epoch 33/120
473/473 - 2s - 4ms/step - loss: 0.0217 - val_loss: 0.1300
Epoch 34/120
473/473 - 2s - 4ms/step - loss: 0.0218 - val_loss: 0.1318
Epoch 35/120
473/473 - 2s - 4ms/step - loss: 0.0217 - val_loss: 0.1295
Epoch 36/120
473/473 - 2s - 4ms/step - loss: 0.0226 - val_loss: 0.1576
Epoch 37/120
473/473 - 2s - 5ms/step - loss: 0.0215 - val_loss: 0.1313
Epoch 38/120
473/473 - 2s - 4ms/step - loss: 0.0211 - val_loss: 0.1600
Epoch 39/120
473/473 - 2s - 4ms/step - loss: 0.0211 - val_loss: 0.1298
Epoch 40/120
473/473 - 2s - 4ms/step - loss: 0.0209 - val_loss: 0.1657
Epoch 41/120
473/473 - 2s - 4ms/step - loss: 0.0209 - val_loss: 0.1643
Epoch 42/120
473/473 - 2s - 4ms/step - loss: 0.0208 - val_loss: 0.1394
Epoch 43/120
473/473 - 2s - 4ms/step - loss: 0.0205 - val_loss: 0.1507
Epoch 44/120
473/473 - 2s - 4ms/step - loss: 0.0206 - val_loss: 0.1439
Epoch 45/120
473/473 - 2s - 4ms/step - loss: 0.0204 - val_loss: 0.1316
Epoch 46/120
473/473 - 2s - 4ms/step - loss: 0.0203 - val_loss: 0.1606
Epoch 47/120
473/473 - 2s - 4ms/step - loss: 0.0203 - val_loss: 0.1681
Epoch 48/120
473/473 - 2s - 4ms/step - loss: 0.0201 - val_loss: 0.1572
Epoch 49/120
473/473 - 2s - 4ms/step - loss: 0.0203 - val_loss: 0.1605
Epoch 50/120
473/473 - 2s - 4ms/step - loss: 0.0199 - val_loss: 0.1757
Epoch 51/120
473/473 - 2s - 4ms/step - loss: 0.0197 - val_loss: 0.1596
Epoch 52/120
473/473 - 2s - 4ms/step - loss: 0.0196 - val_loss: 0.1720
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_train_test_H100.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.2786
Per-joint RMSE: 0.1832 0.5664 0.1420 0.1588 0.2418 0.0868
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=1 H=100 ###
##################################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/scalers_H100.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2 --H 100 --split test --features state --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl --K 84 --test_fraction 0.2 --seed 1 --dataset_seed 0 --delan_seed 1 --delan_epochs 200 --hp_preset lutter_like_256_wd1e4 --delan_rmse_val 0.23502598002565936 --delan_rmse_test 0.34739817995520866' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:12:45.243255: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:12:45.268889: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-7gi3v9fx because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 100
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 16:12:46.267698: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:12:46.272525: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:12:46.273312: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:12:46.274933: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:12:46.275724: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:12:46.276519: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:12:46.356480: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:12:46.357379: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:12:46.358136: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:12:46.358885: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9236 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 16:12:46.667270: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.258905e-01  RMSE=3.548106e-01
  per-joint RMSE: 0.2690 0.6907 0.2073 0.1624 0.3421 0.1398
Residual LSTM:  MSE=8.097427e-02      RMSE=2.845598e-01
  per-joint RMSE: 0.1810 0.5907 0.1322 0.1595 0.2303 0.0904
Combined torque MSE=8.097427e-02     RMSE=2.845598e-01
  per-joint RMSE: 0.1810 0.5907 0.1322 0.1595 0.2303 0.0904
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_test_H100.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_test_H100.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/combined_predictions_test_H100.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s1_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_rmse_time_test_H100.png

