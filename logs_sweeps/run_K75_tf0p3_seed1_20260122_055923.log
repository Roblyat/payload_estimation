################################################################################################################
### RUN: K=75 test_fraction=0.3 seed=1                                                                       ###
### npz_in=/workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed1_dataset.npz ###
################################################################################################################

#####################
### 1) PREPROCESS ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_delan_dataset.py --qdd True --col_format wide --trajectory_amount 75 --test_fraction 0.3 --seed 1 --raw_csv /workspace/shared/data/raw/delan_UR3_Load0_combined_26.csv --out_npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed1_dataset.npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Saved: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed1_dataset.npz
Trajectories: train=53 test=22
Exists: True

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=0                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz                                 ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed1_dataset.npz -t structured -s 0 -r 0 --hp_preset fast_debug --epochs 250 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 250, 'lagrangian_type': <function structured_lagrangian_fn at 0x7c1e0e5841f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed1_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed1_dataset.npz
   dt ≈ 0.02784919441460803
  dof = 6
  Train trajectories = 53
  Test trajectories  = 22
  Train samples = 31276
  Test samples  = 6039
################################################

2026-01-22 06:40:04.509002: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250 | type=structured | dof=6
################################################
2026-01-22 06:40:07.672727: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:40:07.672763: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:40:07.672769: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:40:07.672796: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:40:07.672802: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:40:07.672816: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:40:07.672852: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:40:07.672858: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:40:07.672878: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:40:07.672885: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.2s, Loss=1.11e+01, Inv=1.11e+01, For=2.37e+02, Power=1.52e+00
  [eval] test_mse=5.331e+00  (n=6039)
Epoch 00050: Time=  10.7s, Loss=1.82e+00, Inv=1.82e+00, For=1.17e+02, Power=3.29e-01
Epoch 00100: Time=  14.8s, Loss=1.56e+00, Inv=1.56e+00, For=1.79e+02, Power=2.97e-01
Epoch 00150: Time=  18.9s, Loss=1.45e+00, Inv=1.45e+00, For=1.94e+02, Power=2.92e-01
Epoch 00200: Time=  22.9s, Loss=1.38e+00, Inv=1.38e+00, For=2.18e+02, Power=2.90e-01
  [eval] test_mse=1.310e+01  (n=6039)
Epoch 00250: Time=  26.8s, Loss=1.34e+00, Inv=1.34e+00, For=2.64e+02, Power=2.85e-01
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250
Torque MSE  = 2.467e+00
Torque RMSE = 1.571e+00
Per-joint MSE : 4.167e+00 2.190e+00 8.591e-01 8.837e-01 1.096e+00 5.605e+00
Per-joint RMSE: 2.041e+00 1.480e+00 9.269e-01 9.401e-01 1.047e+00 2.368e+00
Comp Time per Sample = 5.232e-08s / 19113965.3Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed1_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed1_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax
Detected n_dof=6 (seed=0)
2026-01-22 06:40:36.552954: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 53 trajectories
2026-01-22 06:40:37.870235: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:40:37.870249: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:40:39.344287: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:40:39.344299: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:40:40.938098: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/53
2026-01-22 06:40:42.094556: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:40:42.094596: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:40:42.094603: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 50/53
  done 53/53

Exporting split=test: 22 trajectories
  done 22/22

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz --H 25 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.json
H=25, n_dof=6, feature_dim=24
X_train: (30552, 25, 24)  Y_train: (30552, 6)
X_test : (5784, 25, 24)  Y_test : (5784, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:40:44.685271: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:40:44.709947: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (30552, 25, 24), Y_train = (30552, 6)
  X_test  = (5784, 25, 24),  Y_test  = (5784, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:40:45.780172: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:40:45.784803: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:40:45.785792: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:40:45.787608: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:40:45.788442: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:40:45.789322: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:40:45.870120: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:40:45.871012: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:40:45.871805: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:40:45.872595: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8952 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:40:46.829656: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
96/96 - 2s - 17ms/step - loss: 0.3756 - val_loss: 0.5940
Epoch 2/60
96/96 - 0s - 3ms/step - loss: 0.2064 - val_loss: 0.5500
Epoch 3/60
96/96 - 0s - 3ms/step - loss: 0.1804 - val_loss: 0.5303
Epoch 4/60
96/96 - 0s - 3ms/step - loss: 0.1659 - val_loss: 0.5100
Epoch 5/60
96/96 - 0s - 3ms/step - loss: 0.1578 - val_loss: 0.4998
Epoch 6/60
96/96 - 0s - 3ms/step - loss: 0.1508 - val_loss: 0.4949
Epoch 7/60
96/96 - 0s - 3ms/step - loss: 0.1456 - val_loss: 0.4804
Epoch 8/60
96/96 - 0s - 3ms/step - loss: 0.1429 - val_loss: 0.4750
Epoch 9/60
96/96 - 0s - 3ms/step - loss: 0.1397 - val_loss: 0.4674
Epoch 10/60
96/96 - 0s - 3ms/step - loss: 0.1363 - val_loss: 0.4630
Epoch 11/60
96/96 - 0s - 3ms/step - loss: 0.1342 - val_loss: 0.4578
Epoch 12/60
96/96 - 0s - 3ms/step - loss: 0.1325 - val_loss: 0.4520
Epoch 13/60
96/96 - 0s - 3ms/step - loss: 0.1305 - val_loss: 0.4499
Epoch 14/60
96/96 - 0s - 3ms/step - loss: 0.1290 - val_loss: 0.4473
Epoch 15/60
96/96 - 0s - 3ms/step - loss: 0.1272 - val_loss: 0.4422
Epoch 16/60
96/96 - 0s - 3ms/step - loss: 0.1249 - val_loss: 0.4449
Epoch 17/60
96/96 - 0s - 3ms/step - loss: 0.1240 - val_loss: 0.4397
Epoch 18/60
96/96 - 0s - 3ms/step - loss: 0.1231 - val_loss: 0.4397
Epoch 19/60
96/96 - 0s - 3ms/step - loss: 0.1217 - val_loss: 0.4396
Epoch 20/60
96/96 - 0s - 3ms/step - loss: 0.1210 - val_loss: 0.4362
Epoch 21/60
96/96 - 0s - 3ms/step - loss: 0.1201 - val_loss: 0.4318
Epoch 22/60
96/96 - 0s - 3ms/step - loss: 0.1187 - val_loss: 0.4370
Epoch 23/60
96/96 - 0s - 3ms/step - loss: 0.1171 - val_loss: 0.4340
Epoch 24/60
96/96 - 0s - 3ms/step - loss: 0.1164 - val_loss: 0.4335
Epoch 25/60
96/96 - 0s - 3ms/step - loss: 0.1154 - val_loss: 0.4311
Epoch 26/60
96/96 - 0s - 3ms/step - loss: 0.1143 - val_loss: 0.4178
Epoch 27/60
96/96 - 0s - 3ms/step - loss: 0.1130 - val_loss: 0.4272
Epoch 28/60
96/96 - 0s - 3ms/step - loss: 0.1126 - val_loss: 0.4264
Epoch 29/60
96/96 - 0s - 3ms/step - loss: 0.1123 - val_loss: 0.4213
Epoch 30/60
96/96 - 0s - 3ms/step - loss: 0.1109 - val_loss: 0.4198
Epoch 31/60
96/96 - 0s - 3ms/step - loss: 0.1098 - val_loss: 0.4221
Epoch 32/60
96/96 - 0s - 3ms/step - loss: 0.1097 - val_loss: 0.4250
Epoch 33/60
96/96 - 0s - 3ms/step - loss: 0.1089 - val_loss: 0.4227
Epoch 34/60
96/96 - 0s - 3ms/step - loss: 0.1086 - val_loss: 0.4300
Epoch 35/60
96/96 - 0s - 3ms/step - loss: 0.1079 - val_loss: 0.4152
Epoch 36/60
96/96 - 0s - 3ms/step - loss: 0.1058 - val_loss: 0.4198
Epoch 37/60
96/96 - 0s - 3ms/step - loss: 0.1060 - val_loss: 0.4224
Epoch 38/60
96/96 - 0s - 3ms/step - loss: 0.1052 - val_loss: 0.4304
Epoch 39/60
96/96 - 0s - 3ms/step - loss: 0.1052 - val_loss: 0.4236
Epoch 40/60
96/96 - 0s - 3ms/step - loss: 0.1049 - val_loss: 0.4262
Epoch 41/60
96/96 - 0s - 3ms/step - loss: 0.1036 - val_loss: 0.4261
Epoch 42/60
96/96 - 0s - 3ms/step - loss: 0.1032 - val_loss: 0.4188
Epoch 43/60
96/96 - 0s - 3ms/step - loss: 0.1027 - val_loss: 0.4161
Epoch 44/60
96/96 - 0s - 3ms/step - loss: 0.1022 - val_loss: 0.4266
Epoch 45/60
96/96 - 0s - 3ms/step - loss: 0.1024 - val_loss: 0.4261
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.5177
Per-joint RMSE: 1.9820 1.4009 0.8193 0.8966 1.0136 2.3298
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:41:00.228920: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:41:00.253426: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:41:01.112025: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:01.116649: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:01.117520: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:01.119362: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:01.120153: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:01.120889: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:01.204343: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:01.205831: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:01.206591: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:01.207404: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:41:01.510009: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.547981e+00  RMSE=1.596240e+00
  per-joint RMSE: 2.0797 1.4983 0.9383 0.9564 1.0671 2.4050
Residual LSTM:  MSE=2.303564e+00      RMSE=1.517750e+00
  per-joint RMSE: 1.9820 1.4009 0.8193 0.8966 1.0136 2.3298
Combined torque MSE=2.303564e+00     RMSE=1.517750e+00
  per-joint RMSE: 1.9820 1.4009 0.8193 0.8966 1.0136 2.3298
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz --H 25 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.json
H=25, n_dof=6, feature_dim=6
X_train: (30552, 25, 6)  Y_train: (30552, 6)
X_test : (5784, 25, 6)  Y_test : (5784, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:41:03.509717: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:41:03.533385: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (30552, 25, 6), Y_train = (30552, 6)
  X_test  = (5784, 25, 6),  Y_test  = (5784, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:41:04.502669: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:04.507154: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:04.507951: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:04.509481: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:04.510273: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:04.511016: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:04.586093: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:04.586927: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:04.587685: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:04.588416: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:41:05.512463: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
96/96 - 2s - 17ms/step - loss: 0.7373 - val_loss: 0.5832
Epoch 2/60
96/96 - 0s - 3ms/step - loss: 0.4215 - val_loss: 0.5489
Epoch 3/60
96/96 - 0s - 3ms/step - loss: 0.3270 - val_loss: 0.5346
Epoch 4/60
96/96 - 0s - 3ms/step - loss: 0.2793 - val_loss: 0.5358
Epoch 5/60
96/96 - 0s - 3ms/step - loss: 0.2470 - val_loss: 0.5266
Epoch 6/60
96/96 - 0s - 3ms/step - loss: 0.2197 - val_loss: 0.5241
Epoch 7/60
96/96 - 0s - 3ms/step - loss: 0.1927 - val_loss: 0.5124
Epoch 8/60
96/96 - 0s - 3ms/step - loss: 0.1814 - val_loss: 0.5055
Epoch 9/60
96/96 - 0s - 3ms/step - loss: 0.1742 - val_loss: 0.5020
Epoch 10/60
96/96 - 0s - 3ms/step - loss: 0.1647 - val_loss: 0.5007
Epoch 11/60
96/96 - 0s - 3ms/step - loss: 0.1578 - val_loss: 0.4962
Epoch 12/60
96/96 - 0s - 3ms/step - loss: 0.1553 - val_loss: 0.4983
Epoch 13/60
96/96 - 0s - 3ms/step - loss: 0.1663 - val_loss: 0.4901
Epoch 14/60
96/96 - 0s - 3ms/step - loss: 0.1500 - val_loss: 0.4919
Epoch 15/60
96/96 - 0s - 3ms/step - loss: 0.1482 - val_loss: 0.4894
Epoch 16/60
96/96 - 0s - 3ms/step - loss: 0.1472 - val_loss: 0.4838
Epoch 17/60
96/96 - 0s - 3ms/step - loss: 0.1433 - val_loss: 0.4840
Epoch 18/60
96/96 - 0s - 3ms/step - loss: 0.1448 - val_loss: 0.4853
Epoch 19/60
96/96 - 0s - 3ms/step - loss: 0.1419 - val_loss: 0.4817
Epoch 20/60
96/96 - 0s - 3ms/step - loss: 0.1386 - val_loss: 0.4798
Epoch 21/60
96/96 - 0s - 3ms/step - loss: 0.1602 - val_loss: 0.4793
Epoch 22/60
96/96 - 0s - 3ms/step - loss: 0.1466 - val_loss: 0.4840
Epoch 23/60
96/96 - 0s - 3ms/step - loss: 0.1361 - val_loss: 0.4837
Epoch 24/60
96/96 - 0s - 3ms/step - loss: 0.1382 - val_loss: 0.4945
Epoch 25/60
96/96 - 0s - 3ms/step - loss: 0.1340 - val_loss: 0.4854
Epoch 26/60
96/96 - 0s - 3ms/step - loss: 0.1314 - val_loss: 0.4797
Epoch 27/60
96/96 - 0s - 3ms/step - loss: 0.1312 - val_loss: 0.4870
Epoch 28/60
96/96 - 0s - 3ms/step - loss: 0.1307 - val_loss: 0.4828
Epoch 29/60
96/96 - 0s - 3ms/step - loss: 0.1309 - val_loss: 0.4774
Epoch 30/60
96/96 - 0s - 3ms/step - loss: 0.1296 - val_loss: 0.4826
Epoch 31/60
96/96 - 0s - 3ms/step - loss: 0.1364 - val_loss: 0.4762
Epoch 32/60
96/96 - 0s - 3ms/step - loss: 0.1312 - val_loss: 0.4786
Epoch 33/60
96/96 - 0s - 3ms/step - loss: 0.1269 - val_loss: 0.4716
Epoch 34/60
96/96 - 0s - 3ms/step - loss: 0.1273 - val_loss: 0.4778
Epoch 35/60
96/96 - 0s - 3ms/step - loss: 0.1253 - val_loss: 0.4814
Epoch 36/60
96/96 - 0s - 3ms/step - loss: 0.1265 - val_loss: 0.4792
Epoch 37/60
96/96 - 0s - 3ms/step - loss: 0.1246 - val_loss: 0.4754
Epoch 38/60
96/96 - 0s - 3ms/step - loss: 0.1237 - val_loss: 0.4775
Epoch 39/60
96/96 - 0s - 3ms/step - loss: 0.1243 - val_loss: 0.4793
Epoch 40/60
96/96 - 0s - 3ms/step - loss: 0.1234 - val_loss: 0.4761
Epoch 41/60
96/96 - 0s - 3ms/step - loss: 0.1233 - val_loss: 0.4701
Epoch 42/60
96/96 - 0s - 3ms/step - loss: 0.1216 - val_loss: 0.4740
Epoch 43/60
96/96 - 0s - 3ms/step - loss: 0.1225 - val_loss: 0.4806
Epoch 44/60
96/96 - 0s - 3ms/step - loss: 0.1203 - val_loss: 0.4709
Epoch 45/60
96/96 - 0s - 3ms/step - loss: 0.1199 - val_loss: 0.4680
Epoch 46/60
96/96 - 0s - 3ms/step - loss: 0.1194 - val_loss: 0.4670
Epoch 47/60
96/96 - 0s - 3ms/step - loss: 0.1212 - val_loss: 0.4751
Epoch 48/60
96/96 - 0s - 3ms/step - loss: 0.1193 - val_loss: 0.4721
Epoch 49/60
96/96 - 0s - 3ms/step - loss: 0.1198 - val_loss: 0.4764
Epoch 50/60
96/96 - 0s - 3ms/step - loss: 0.1225 - val_loss: 0.4709
Epoch 51/60
96/96 - 0s - 3ms/step - loss: 0.1190 - val_loss: 0.4695
Epoch 52/60
96/96 - 0s - 3ms/step - loss: 0.1199 - val_loss: 0.4709
Epoch 53/60
96/96 - 0s - 3ms/step - loss: 0.1499 - val_loss: 0.4952
Epoch 54/60
96/96 - 0s - 3ms/step - loss: 0.1436 - val_loss: 0.4782
Epoch 55/60
96/96 - 0s - 3ms/step - loss: 0.1267 - val_loss: 0.4678
Epoch 56/60
96/96 - 0s - 3ms/step - loss: 0.1184 - val_loss: 0.4748
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.5972
Per-joint RMSE: 2.0576 1.6041 0.9138 0.9342 1.0380 2.3903
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:41:21.735808: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:41:21.760866: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:41:22.615043: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:22.619767: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:22.620648: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:22.622311: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:22.623097: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:22.623829: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:22.704938: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:22.705932: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:22.706742: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:22.707515: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:41:23.002139: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.547981e+00  RMSE=1.596240e+00
  per-joint RMSE: 2.0797 1.4983 0.9383 0.9564 1.0671 2.4050
Residual LSTM:  MSE=2.550961e+00      RMSE=1.597173e+00
  per-joint RMSE: 2.0576 1.6041 0.9138 0.9342 1.0380 2.3903
Combined torque MSE=2.550961e+00     RMSE=1.597173e+00
  per-joint RMSE: 2.0576 1.6041 0.9138 0.9342 1.0380 2.3903
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz --H 25 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (30552, 25, 18)  Y_train: (30552, 6)
X_test : (5784, 25, 18)  Y_test : (5784, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:41:25.051382: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:41:25.075580: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (30552, 25, 18), Y_train = (30552, 6)
  X_test  = (5784, 25, 18),  Y_test  = (5784, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:41:26.114513: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:26.119115: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:26.119899: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:26.121484: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:26.122267: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:26.123001: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:26.203550: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:26.204469: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:26.205299: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:26.206035: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:41:27.166441: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
96/96 - 2s - 17ms/step - loss: 0.4239 - val_loss: 0.5800
Epoch 2/60
96/96 - 0s - 3ms/step - loss: 0.2464 - val_loss: 0.5927
Epoch 3/60
96/96 - 0s - 3ms/step - loss: 0.2205 - val_loss: 0.6222
Epoch 4/60
96/96 - 0s - 3ms/step - loss: 0.2036 - val_loss: 0.6636
Epoch 5/60
96/96 - 0s - 3ms/step - loss: 0.1855 - val_loss: 0.6799
Epoch 6/60
96/96 - 0s - 3ms/step - loss: 0.1744 - val_loss: 0.6592
Epoch 7/60
96/96 - 0s - 3ms/step - loss: 0.1681 - val_loss: 0.6440
Epoch 8/60
96/96 - 0s - 3ms/step - loss: 0.1626 - val_loss: 0.6390
Epoch 9/60
96/96 - 0s - 3ms/step - loss: 0.1558 - val_loss: 0.6336
Epoch 10/60
96/96 - 0s - 3ms/step - loss: 0.1518 - val_loss: 0.6106
Epoch 11/60
96/96 - 0s - 3ms/step - loss: 0.1473 - val_loss: 0.6095
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.5542
Per-joint RMSE: 2.0056 1.4418 0.8468 0.9355 1.0427 2.3903
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:41:31.653437: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:41:31.677801: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:41:32.526366: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:32.530986: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:32.531864: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:32.533493: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:32.534288: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:32.535035: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:32.614921: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:32.615841: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:32.616588: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:32.617316: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:41:32.907576: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.547981e+00  RMSE=1.596240e+00
  per-joint RMSE: 2.0797 1.4983 0.9383 0.9564 1.0671 2.4050
Residual LSTM:  MSE=2.415680e+00      RMSE=1.554246e+00
  per-joint RMSE: 2.0056 1.4418 0.8468 0.9355 1.0427 2.3903
Combined torque MSE=2.415680e+00     RMSE=1.554246e+00
  per-joint RMSE: 2.0056 1.4418 0.8468 0.9355 1.0427 2.3903
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz --H 25 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (30552, 25, 18)  Y_train: (30552, 6)
X_test : (5784, 25, 18)  Y_test : (5784, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:41:34.953664: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:41:34.977723: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (30552, 25, 18), Y_train = (30552, 6)
  X_test  = (5784, 25, 18),  Y_test  = (5784, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:41:36.002613: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:36.007191: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:36.008147: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:36.009722: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:36.010512: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:36.011250: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:36.094077: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:36.094993: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:36.095733: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:36.096462: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:41:37.016584: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
96/96 - 2s - 17ms/step - loss: 0.3838 - val_loss: 0.5549
Epoch 2/60
96/96 - 0s - 3ms/step - loss: 0.2093 - val_loss: 0.5000
Epoch 3/60
96/96 - 0s - 3ms/step - loss: 0.1837 - val_loss: 0.4913
Epoch 4/60
96/96 - 0s - 3ms/step - loss: 0.1687 - val_loss: 0.4786
Epoch 5/60
96/96 - 0s - 3ms/step - loss: 0.1601 - val_loss: 0.4726
Epoch 6/60
96/96 - 0s - 3ms/step - loss: 0.1538 - val_loss: 0.4679
Epoch 7/60
96/96 - 0s - 3ms/step - loss: 0.1482 - val_loss: 0.4644
Epoch 8/60
96/96 - 0s - 3ms/step - loss: 0.1440 - val_loss: 0.4586
Epoch 9/60
96/96 - 0s - 3ms/step - loss: 0.1414 - val_loss: 0.4615
Epoch 10/60
96/96 - 0s - 3ms/step - loss: 0.1379 - val_loss: 0.4633
Epoch 11/60
96/96 - 0s - 3ms/step - loss: 0.1363 - val_loss: 0.4637
Epoch 12/60
96/96 - 0s - 3ms/step - loss: 0.1346 - val_loss: 0.4644
Epoch 13/60
96/96 - 0s - 3ms/step - loss: 0.1317 - val_loss: 0.4620
Epoch 14/60
96/96 - 0s - 3ms/step - loss: 0.1311 - val_loss: 0.4632
Epoch 15/60
96/96 - 0s - 3ms/step - loss: 0.1291 - val_loss: 0.4635
Epoch 16/60
96/96 - 0s - 3ms/step - loss: 0.1261 - val_loss: 0.4554
Epoch 17/60
96/96 - 0s - 3ms/step - loss: 0.1251 - val_loss: 0.4596
Epoch 18/60
96/96 - 0s - 3ms/step - loss: 0.1243 - val_loss: 0.4561
Epoch 19/60
96/96 - 0s - 3ms/step - loss: 0.1228 - val_loss: 0.4634
Epoch 20/60
96/96 - 0s - 3ms/step - loss: 0.1217 - val_loss: 0.4630
Epoch 21/60
96/96 - 0s - 3ms/step - loss: 0.1203 - val_loss: 0.4533
Epoch 22/60
96/96 - 0s - 3ms/step - loss: 0.1199 - val_loss: 0.4569
Epoch 23/60
96/96 - 0s - 3ms/step - loss: 0.1179 - val_loss: 0.4559
Epoch 24/60
96/96 - 0s - 3ms/step - loss: 0.1162 - val_loss: 0.4561
Epoch 25/60
96/96 - 0s - 3ms/step - loss: 0.1154 - val_loss: 0.4559
Epoch 26/60
96/96 - 0s - 3ms/step - loss: 0.1144 - val_loss: 0.4556
Epoch 27/60
96/96 - 0s - 3ms/step - loss: 0.1133 - val_loss: 0.4638
Epoch 28/60
96/96 - 0s - 3ms/step - loss: 0.1125 - val_loss: 0.4580
Epoch 29/60
96/96 - 0s - 3ms/step - loss: 0.1107 - val_loss: 0.4629
Epoch 30/60
96/96 - 0s - 3ms/step - loss: 0.1107 - val_loss: 0.4587
Epoch 31/60
96/96 - 0s - 3ms/step - loss: 0.1106 - val_loss: 0.4657
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.5255
Per-joint RMSE: 1.9433 1.4696 0.8257 0.8808 1.0129 2.3543
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:41:46.660421: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:41:46.685466: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:41:47.554473: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:47.559172: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:47.560027: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:47.561794: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:47.562535: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:47.563322: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:47.646560: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:47.647458: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:47.648251: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:47.649039: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:41:47.944287: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.547981e+00  RMSE=1.596240e+00
  per-joint RMSE: 2.0797 1.4983 0.9383 0.9564 1.0671 2.4050
Residual LSTM:  MSE=2.327002e+00      RMSE=1.525451e+00
  per-joint RMSE: 1.9433 1.4696 0.8257 0.8808 1.0129 2.3543
Combined torque MSE=2.327002e+00     RMSE=1.525451e+00
  per-joint RMSE: 1.9433 1.4696 0.8257 0.8808 1.0129 2.3543
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz --H 50 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.json
H=50, n_dof=6, feature_dim=24
X_train: (29877, 50, 24)  Y_train: (29877, 6)
X_test : (5559, 50, 24)  Y_test : (5559, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:41:50.157654: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:41:50.181536: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (29877, 50, 24), Y_train = (29877, 6)
  X_test  = (5559, 50, 24),  Y_test  = (5559, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:41:51.353969: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:51.358684: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:51.359605: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:51.361339: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:51.362247: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:51.363108: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:51.447197: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:51.448082: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:51.448870: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:41:51.449655: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:41:52.486638: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
94/94 - 2s - 19ms/step - loss: 0.3698 - val_loss: 0.6644
Epoch 2/60
94/94 - 0s - 4ms/step - loss: 0.2102 - val_loss: 0.6767
Epoch 3/60
94/94 - 0s - 4ms/step - loss: 0.1882 - val_loss: 0.6484
Epoch 4/60
94/94 - 0s - 4ms/step - loss: 0.1754 - val_loss: 0.6311
Epoch 5/60
94/94 - 0s - 4ms/step - loss: 0.1660 - val_loss: 0.6003
Epoch 6/60
94/94 - 0s - 4ms/step - loss: 0.1572 - val_loss: 0.5977
Epoch 7/60
94/94 - 0s - 4ms/step - loss: 0.1513 - val_loss: 0.5774
Epoch 8/60
94/94 - 0s - 4ms/step - loss: 0.1477 - val_loss: 0.5614
Epoch 9/60
94/94 - 0s - 4ms/step - loss: 0.1450 - val_loss: 0.5604
Epoch 10/60
94/94 - 0s - 4ms/step - loss: 0.1416 - val_loss: 0.5541
Epoch 11/60
94/94 - 0s - 4ms/step - loss: 0.1401 - val_loss: 0.5516
Epoch 12/60
94/94 - 0s - 5ms/step - loss: 0.1368 - val_loss: 0.5464
Epoch 13/60
94/94 - 0s - 4ms/step - loss: 0.1354 - val_loss: 0.5477
Epoch 14/60
94/94 - 0s - 4ms/step - loss: 0.1329 - val_loss: 0.5439
Epoch 15/60
94/94 - 0s - 4ms/step - loss: 0.1309 - val_loss: 0.5414
Epoch 16/60
94/94 - 0s - 4ms/step - loss: 0.1291 - val_loss: 0.5382
Epoch 17/60
94/94 - 0s - 4ms/step - loss: 0.1298 - val_loss: 0.5270
Epoch 18/60
94/94 - 0s - 4ms/step - loss: 0.1273 - val_loss: 0.5192
Epoch 19/60
94/94 - 0s - 4ms/step - loss: 0.1253 - val_loss: 0.5252
Epoch 20/60
94/94 - 0s - 4ms/step - loss: 0.1244 - val_loss: 0.5148
Epoch 21/60
94/94 - 0s - 4ms/step - loss: 0.1234 - val_loss: 0.5102
Epoch 22/60
94/94 - 0s - 4ms/step - loss: 0.1221 - val_loss: 0.5155
Epoch 23/60
94/94 - 0s - 4ms/step - loss: 0.1223 - val_loss: 0.5186
Epoch 24/60
94/94 - 0s - 4ms/step - loss: 0.1198 - val_loss: 0.5070
Epoch 25/60
94/94 - 0s - 4ms/step - loss: 0.1190 - val_loss: 0.5033
Epoch 26/60
94/94 - 0s - 4ms/step - loss: 0.1183 - val_loss: 0.4986
Epoch 27/60
94/94 - 0s - 4ms/step - loss: 0.1162 - val_loss: 0.5044
Epoch 28/60
94/94 - 0s - 4ms/step - loss: 0.1173 - val_loss: 0.5001
Epoch 29/60
94/94 - 0s - 4ms/step - loss: 0.1146 - val_loss: 0.5012
Epoch 30/60
94/94 - 0s - 4ms/step - loss: 0.1145 - val_loss: 0.5050
Epoch 31/60
94/94 - 0s - 4ms/step - loss: 0.1141 - val_loss: 0.5022
Epoch 32/60
94/94 - 0s - 4ms/step - loss: 0.1130 - val_loss: 0.5055
Epoch 33/60
94/94 - 0s - 4ms/step - loss: 0.1118 - val_loss: 0.5034
Epoch 34/60
94/94 - 0s - 4ms/step - loss: 0.1111 - val_loss: 0.4956
Epoch 35/60
94/94 - 0s - 4ms/step - loss: 0.1110 - val_loss: 0.4998
Epoch 36/60
94/94 - 0s - 4ms/step - loss: 0.1105 - val_loss: 0.5026
Epoch 37/60
94/94 - 0s - 4ms/step - loss: 0.1096 - val_loss: 0.5038
Epoch 38/60
94/94 - 0s - 4ms/step - loss: 0.1094 - val_loss: 0.4953
Epoch 39/60
94/94 - 0s - 4ms/step - loss: 0.1084 - val_loss: 0.4995
Epoch 40/60
94/94 - 0s - 4ms/step - loss: 0.1075 - val_loss: 0.4859
Epoch 41/60
94/94 - 0s - 4ms/step - loss: 0.1073 - val_loss: 0.4970
Epoch 42/60
94/94 - 0s - 4ms/step - loss: 0.1076 - val_loss: 0.4941
Epoch 43/60
94/94 - 0s - 4ms/step - loss: 0.1062 - val_loss: 0.4945
Epoch 44/60
94/94 - 0s - 4ms/step - loss: 0.1058 - val_loss: 0.4905
Epoch 45/60
94/94 - 0s - 4ms/step - loss: 0.1049 - val_loss: 0.4843
Epoch 46/60
94/94 - 0s - 4ms/step - loss: 0.1038 - val_loss: 0.4888
Epoch 47/60
94/94 - 0s - 4ms/step - loss: 0.1040 - val_loss: 0.4828
Epoch 48/60
94/94 - 0s - 4ms/step - loss: 0.1026 - val_loss: 0.4906
Epoch 49/60
94/94 - 0s - 4ms/step - loss: 0.1028 - val_loss: 0.4859
Epoch 50/60
94/94 - 0s - 4ms/step - loss: 0.1012 - val_loss: 0.4802
Epoch 51/60
94/94 - 0s - 4ms/step - loss: 0.1012 - val_loss: 0.4837
Epoch 52/60
94/94 - 0s - 4ms/step - loss: 0.1013 - val_loss: 0.4843
Epoch 53/60
94/94 - 0s - 4ms/step - loss: 0.1000 - val_loss: 0.4833
Epoch 54/60
94/94 - 0s - 4ms/step - loss: 0.0992 - val_loss: 0.4842
Epoch 55/60
94/94 - 0s - 4ms/step - loss: 0.0996 - val_loss: 0.4741
Epoch 56/60
94/94 - 0s - 4ms/step - loss: 0.0991 - val_loss: 0.4738
Epoch 57/60
94/94 - 0s - 4ms/step - loss: 0.0983 - val_loss: 0.4735
Epoch 58/60
94/94 - 0s - 4ms/step - loss: 0.0970 - val_loss: 0.4755
Epoch 59/60
94/94 - 0s - 4ms/step - loss: 0.0969 - val_loss: 0.4746
Epoch 60/60
94/94 - 0s - 4ms/step - loss: 0.0967 - val_loss: 0.4753
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.4979
Per-joint RMSE: 1.8965 1.4451 0.8241 0.8759 1.0200 2.3001
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:42:17.202565: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:42:17.227356: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:42:18.090109: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:18.094670: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:18.095459: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:18.097321: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:18.098116: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:18.098860: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:18.179498: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:18.180342: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:18.181092: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:18.181824: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:42:18.482485: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.496059e+00  RMSE=1.579892e+00
  per-joint RMSE: 2.0357 1.5051 0.9236 0.9511 1.0641 2.3826
Residual LSTM:  MSE=2.243728e+00      RMSE=1.497908e+00
  per-joint RMSE: 1.8965 1.4451 0.8241 0.8759 1.0200 2.3001
Combined torque MSE=2.243728e+00     RMSE=1.497908e+00
  per-joint RMSE: 1.8965 1.4451 0.8241 0.8759 1.0200 2.3001
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz --H 50 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.json
H=50, n_dof=6, feature_dim=6
X_train: (29877, 50, 6)  Y_train: (29877, 6)
X_test : (5559, 50, 6)  Y_test : (5559, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:42:20.544825: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:42:20.569391: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (29877, 50, 6), Y_train = (29877, 6)
  X_test  = (5559, 50, 6),  Y_test  = (5559, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:42:21.604746: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:21.609390: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:21.610264: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:21.611861: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:21.612660: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:21.613396: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:21.694497: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:21.695423: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:21.696266: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:21.697010: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:42:22.629016: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
94/94 - 2s - 19ms/step - loss: 0.7000 - val_loss: 0.6088
Epoch 2/60
94/94 - 0s - 4ms/step - loss: 0.3669 - val_loss: 0.5906
Epoch 3/60
94/94 - 0s - 4ms/step - loss: 0.2812 - val_loss: 0.5775
Epoch 4/60
94/94 - 0s - 4ms/step - loss: 0.2535 - val_loss: 0.5792
Epoch 5/60
94/94 - 0s - 4ms/step - loss: 0.2142 - val_loss: 0.5636
Epoch 6/60
94/94 - 0s - 4ms/step - loss: 0.1943 - val_loss: 0.5736
Epoch 7/60
94/94 - 0s - 4ms/step - loss: 0.1870 - val_loss: 0.5648
Epoch 8/60
94/94 - 0s - 4ms/step - loss: 0.1857 - val_loss: 0.5608
Epoch 9/60
94/94 - 0s - 4ms/step - loss: 0.1771 - val_loss: 0.5638
Epoch 10/60
94/94 - 0s - 4ms/step - loss: 0.1675 - val_loss: 0.5617
Epoch 11/60
94/94 - 0s - 4ms/step - loss: 0.1648 - val_loss: 0.5681
Epoch 12/60
94/94 - 0s - 5ms/step - loss: 0.1627 - val_loss: 0.5623
Epoch 13/60
94/94 - 0s - 4ms/step - loss: 0.1566 - val_loss: 0.5668
Epoch 14/60
94/94 - 0s - 4ms/step - loss: 0.1552 - val_loss: 0.5634
Epoch 15/60
94/94 - 0s - 4ms/step - loss: 0.1585 - val_loss: 0.5692
Epoch 16/60
94/94 - 0s - 4ms/step - loss: 0.1695 - val_loss: 0.5557
Epoch 17/60
94/94 - 0s - 4ms/step - loss: 0.1543 - val_loss: 0.5715
Epoch 18/60
94/94 - 0s - 4ms/step - loss: 0.1497 - val_loss: 0.5686
Epoch 19/60
94/94 - 0s - 4ms/step - loss: 0.1467 - val_loss: 0.5686
Epoch 20/60
94/94 - 0s - 4ms/step - loss: 0.1481 - val_loss: 0.5666
Epoch 21/60
94/94 - 0s - 4ms/step - loss: 0.1432 - val_loss: 0.5683
Epoch 22/60
94/94 - 0s - 4ms/step - loss: 0.1422 - val_loss: 0.5644
Epoch 23/60
94/94 - 0s - 4ms/step - loss: 0.1422 - val_loss: 0.5614
Epoch 24/60
94/94 - 0s - 4ms/step - loss: 0.1407 - val_loss: 0.5581
Epoch 25/60
94/94 - 0s - 4ms/step - loss: 0.1386 - val_loss: 0.5656
Epoch 26/60
94/94 - 0s - 4ms/step - loss: 0.1399 - val_loss: 0.5655
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.5677
Per-joint RMSE: 2.0465 1.4773 0.8905 0.9401 1.0328 2.3730
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:42:33.973924: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:42:33.998272: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:42:34.907034: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:34.911639: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:34.912424: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:34.914143: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:34.914932: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:34.915675: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:34.998786: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:34.999619: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:35.000360: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:35.001094: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:42:35.301593: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.496059e+00  RMSE=1.579892e+00
  per-joint RMSE: 2.0357 1.5051 0.9236 0.9511 1.0641 2.3826
Residual LSTM:  MSE=2.457563e+00      RMSE=1.567662e+00
  per-joint RMSE: 2.0465 1.4773 0.8905 0.9401 1.0328 2.3730
Combined torque MSE=2.457563e+00     RMSE=1.567662e+00
  per-joint RMSE: 2.0465 1.4773 0.8905 0.9401 1.0328 2.3730
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz --H 50 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (29877, 50, 18)  Y_train: (29877, 6)
X_test : (5559, 50, 18)  Y_test : (5559, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:42:37.416477: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:42:37.440513: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (29877, 50, 18), Y_train = (29877, 6)
  X_test  = (5559, 50, 18),  Y_test  = (5559, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:42:38.587138: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:38.591761: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:38.592549: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:38.594282: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:38.595163: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:38.595894: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:38.676351: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:38.677189: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:38.677932: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:38.678660: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:42:39.675022: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
94/94 - 2s - 19ms/step - loss: 0.4255 - val_loss: 0.6372
Epoch 2/60
94/94 - 0s - 4ms/step - loss: 0.2519 - val_loss: 0.6569
Epoch 3/60
94/94 - 0s - 4ms/step - loss: 0.2261 - val_loss: 0.6511
Epoch 4/60
94/94 - 0s - 4ms/step - loss: 0.2035 - val_loss: 0.6926
Epoch 5/60
94/94 - 0s - 4ms/step - loss: 0.1886 - val_loss: 0.6906
Epoch 6/60
94/94 - 0s - 4ms/step - loss: 0.1818 - val_loss: 0.6757
Epoch 7/60
94/94 - 0s - 4ms/step - loss: 0.1741 - val_loss: 0.6728
Epoch 8/60
94/94 - 0s - 4ms/step - loss: 0.1681 - val_loss: 0.6663
Epoch 9/60
94/94 - 0s - 4ms/step - loss: 0.1598 - val_loss: 0.6413
Epoch 10/60
94/94 - 0s - 4ms/step - loss: 0.1567 - val_loss: 0.6407
Epoch 11/60
94/94 - 0s - 4ms/step - loss: 0.1526 - val_loss: 0.6557
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.5388
Per-joint RMSE: 1.9543 1.4375 0.8516 0.9286 1.0644 2.3667
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:42:45.520144: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:42:45.544601: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:42:46.386458: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:46.390992: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:46.391782: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:46.393471: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:46.394255: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:46.394988: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:46.479758: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:46.480602: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:46.481351: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:46.482079: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:42:46.783034: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.496059e+00  RMSE=1.579892e+00
  per-joint RMSE: 2.0357 1.5051 0.9236 0.9511 1.0641 2.3826
Residual LSTM:  MSE=2.367825e+00      RMSE=1.538774e+00
  per-joint RMSE: 1.9543 1.4375 0.8516 0.9286 1.0644 2.3667
Combined torque MSE=2.367825e+00     RMSE=1.538774e+00
  per-joint RMSE: 1.9543 1.4375 0.8516 0.9286 1.0644 2.3667
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz --H 50 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (29877, 50, 18)  Y_train: (29877, 6)
X_test : (5559, 50, 18)  Y_test : (5559, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:42:48.905223: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:42:48.928872: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (29877, 50, 18), Y_train = (29877, 6)
  X_test  = (5559, 50, 18),  Y_test  = (5559, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:42:50.066206: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:50.070810: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:50.071746: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:50.073577: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:50.074370: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:50.075106: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:50.168087: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:50.168983: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:50.169845: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:42:50.170628: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:42:51.133372: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
94/94 - 2s - 18ms/step - loss: 0.3829 - val_loss: 0.5910
Epoch 2/60
94/94 - 0s - 4ms/step - loss: 0.2120 - val_loss: 0.5674
Epoch 3/60
94/94 - 0s - 4ms/step - loss: 0.1863 - val_loss: 0.5554
Epoch 4/60
94/94 - 0s - 4ms/step - loss: 0.1746 - val_loss: 0.5412
Epoch 5/60
94/94 - 0s - 4ms/step - loss: 0.1650 - val_loss: 0.5262
Epoch 6/60
94/94 - 0s - 4ms/step - loss: 0.1578 - val_loss: 0.5288
Epoch 7/60
94/94 - 0s - 4ms/step - loss: 0.1527 - val_loss: 0.5226
Epoch 8/60
94/94 - 0s - 4ms/step - loss: 0.1479 - val_loss: 0.5298
Epoch 9/60
94/94 - 0s - 4ms/step - loss: 0.1454 - val_loss: 0.5261
Epoch 10/60
94/94 - 0s - 4ms/step - loss: 0.1427 - val_loss: 0.5215
Epoch 11/60
94/94 - 0s - 4ms/step - loss: 0.1405 - val_loss: 0.5180
Epoch 12/60
94/94 - 0s - 5ms/step - loss: 0.1374 - val_loss: 0.5105
Epoch 13/60
94/94 - 0s - 4ms/step - loss: 0.1349 - val_loss: 0.5085
Epoch 14/60
94/94 - 0s - 4ms/step - loss: 0.1336 - val_loss: 0.5027
Epoch 15/60
94/94 - 0s - 4ms/step - loss: 0.1321 - val_loss: 0.5110
Epoch 16/60
94/94 - 0s - 4ms/step - loss: 0.1298 - val_loss: 0.4919
Epoch 17/60
94/94 - 0s - 4ms/step - loss: 0.1283 - val_loss: 0.4947
Epoch 18/60
94/94 - 0s - 4ms/step - loss: 0.1273 - val_loss: 0.4948
Epoch 19/60
94/94 - 0s - 4ms/step - loss: 0.1266 - val_loss: 0.4822
Epoch 20/60
94/94 - 0s - 4ms/step - loss: 0.1254 - val_loss: 0.4911
Epoch 21/60
94/94 - 0s - 4ms/step - loss: 0.1243 - val_loss: 0.4712
Epoch 22/60
94/94 - 0s - 4ms/step - loss: 0.1216 - val_loss: 0.4794
Epoch 23/60
94/94 - 0s - 4ms/step - loss: 0.1206 - val_loss: 0.4830
Epoch 24/60
94/94 - 0s - 4ms/step - loss: 0.1196 - val_loss: 0.4801
Epoch 25/60
94/94 - 0s - 4ms/step - loss: 0.1191 - val_loss: 0.4734
Epoch 26/60
94/94 - 0s - 4ms/step - loss: 0.1184 - val_loss: 0.4732
Epoch 27/60
94/94 - 0s - 4ms/step - loss: 0.1174 - val_loss: 0.4761
Epoch 28/60
94/94 - 0s - 4ms/step - loss: 0.1161 - val_loss: 0.4710
Epoch 29/60
94/94 - 0s - 4ms/step - loss: 0.1150 - val_loss: 0.4775
Epoch 30/60
94/94 - 0s - 4ms/step - loss: 0.1143 - val_loss: 0.4683
Epoch 31/60
94/94 - 0s - 4ms/step - loss: 0.1138 - val_loss: 0.4641
Epoch 32/60
94/94 - 0s - 4ms/step - loss: 0.1134 - val_loss: 0.4643
Epoch 33/60
94/94 - 0s - 4ms/step - loss: 0.1121 - val_loss: 0.4620
Epoch 34/60
94/94 - 0s - 4ms/step - loss: 0.1109 - val_loss: 0.4638
Epoch 35/60
94/94 - 0s - 4ms/step - loss: 0.1106 - val_loss: 0.4632
Epoch 36/60
94/94 - 0s - 4ms/step - loss: 0.1093 - val_loss: 0.4700
Epoch 37/60
94/94 - 0s - 4ms/step - loss: 0.1096 - val_loss: 0.4678
Epoch 38/60
94/94 - 0s - 4ms/step - loss: 0.1086 - val_loss: 0.4703
Epoch 39/60
94/94 - 0s - 4ms/step - loss: 0.1077 - val_loss: 0.4635
Epoch 40/60
94/94 - 0s - 4ms/step - loss: 0.1077 - val_loss: 0.4606
Epoch 41/60
94/94 - 0s - 4ms/step - loss: 0.1066 - val_loss: 0.4606
Epoch 42/60
94/94 - 0s - 4ms/step - loss: 0.1063 - val_loss: 0.4610
Epoch 43/60
94/94 - 0s - 4ms/step - loss: 0.1071 - val_loss: 0.4535
Epoch 44/60
94/94 - 0s - 4ms/step - loss: 0.1048 - val_loss: 0.4520
Epoch 45/60
94/94 - 0s - 4ms/step - loss: 0.1046 - val_loss: 0.4556
Epoch 46/60
94/94 - 0s - 4ms/step - loss: 0.1038 - val_loss: 0.4550
Epoch 47/60
94/94 - 0s - 4ms/step - loss: 0.1044 - val_loss: 0.4509
Epoch 48/60
94/94 - 0s - 4ms/step - loss: 0.1033 - val_loss: 0.4556
Epoch 49/60
94/94 - 0s - 4ms/step - loss: 0.1023 - val_loss: 0.4579
Epoch 50/60
94/94 - 0s - 4ms/step - loss: 0.1018 - val_loss: 0.4584
Epoch 51/60
94/94 - 0s - 4ms/step - loss: 0.1012 - val_loss: 0.4639
Epoch 52/60
94/94 - 0s - 4ms/step - loss: 0.1017 - val_loss: 0.4535
Epoch 53/60
94/94 - 0s - 4ms/step - loss: 0.1004 - val_loss: 0.4576
Epoch 54/60
94/94 - 0s - 4ms/step - loss: 0.1004 - val_loss: 0.4535
Epoch 55/60
94/94 - 0s - 4ms/step - loss: 0.0994 - val_loss: 0.4519
Epoch 56/60
94/94 - 0s - 4ms/step - loss: 0.0991 - val_loss: 0.4453
Epoch 57/60
94/94 - 0s - 4ms/step - loss: 0.0987 - val_loss: 0.4496
Epoch 58/60
94/94 - 0s - 4ms/step - loss: 0.0988 - val_loss: 0.4494
Epoch 59/60
94/94 - 0s - 4ms/step - loss: 0.0975 - val_loss: 0.4422
Epoch 60/60
94/94 - 0s - 4ms/step - loss: 0.0971 - val_loss: 0.4378
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.4960
Per-joint RMSE: 1.8350 1.5287 0.8201 0.8747 1.0162 2.2922
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:43:15.551449: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:43:15.576436: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:43:16.431356: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:43:16.435895: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:43:16.436677: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:43:16.438329: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:43:16.439115: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:43:16.439846: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:43:16.522100: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:43:16.522931: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:43:16.523664: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:43:16.524387: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:43:16.824196: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.496059e+00  RMSE=1.579892e+00
  per-joint RMSE: 2.0357 1.5051 0.9236 0.9511 1.0641 2.3826
Residual LSTM:  MSE=2.238091e+00      RMSE=1.496025e+00
  per-joint RMSE: 1.8350 1.5287 0.8201 0.8747 1.0162 2.2922
Combined torque MSE=2.238091e+00     RMSE=1.496025e+00
  per-joint RMSE: 1.8350 1.5287 0.8201 0.8747 1.0162 2.2922
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=1                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz                                 ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed1_dataset.npz -t structured -s 1 -r 0 --hp_preset fast_debug --epochs 250 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 250, 'lagrangian_type': <function structured_lagrangian_fn at 0x73895721c1f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed1_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed1_dataset.npz
   dt ≈ 0.02784919441460803
  dof = 6
  Train trajectories = 53
  Test trajectories  = 22
  Train samples = 31276
  Test samples  = 6039
################################################

2026-01-22 06:43:21.189022: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250 | type=structured | dof=6
################################################
2026-01-22 06:43:24.350363: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:43:24.350399: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:43:24.350405: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:43:24.350432: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:43:24.350438: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:43:24.350453: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:43:24.350489: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:43:24.350495: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:43:24.350511: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:43:24.350515: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.1s, Loss=1.22e+01, Inv=1.22e+01, For=2.24e+02, Power=1.51e+00
  [eval] test_mse=7.947e+00  (n=6039)
Epoch 00050: Time=  10.5s, Loss=1.86e+00, Inv=1.86e+00, For=1.18e+02, Power=3.31e-01
Epoch 00100: Time=  14.9s, Loss=1.58e+00, Inv=1.58e+00, For=1.47e+02, Power=3.02e-01
Epoch 00150: Time=  19.1s, Loss=1.45e+00, Inv=1.45e+00, For=1.69e+02, Power=2.88e-01
Epoch 00200: Time=  23.1s, Loss=1.37e+00, Inv=1.37e+00, For=2.10e+02, Power=2.78e-01
  [eval] test_mse=8.493e+00  (n=6039)
Epoch 00250: Time=  27.3s, Loss=1.33e+00, Inv=1.33e+00, For=2.41e+02, Power=2.71e-01
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250
Torque MSE  = 1.441e+00
Torque RMSE = 1.200e+00
Per-joint MSE : 3.006e+00 1.636e+00 8.830e-01 1.066e+00 8.090e-01 1.244e+00
Per-joint RMSE: 1.734e+00 1.279e+00 9.397e-01 1.032e+00 8.994e-01 1.116e+00
Comp Time per Sample = 5.084e-08s / 19671202.2Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed1_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed1_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax
Detected n_dof=6 (seed=1)
2026-01-22 06:43:53.801320: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 53 trajectories
2026-01-22 06:43:55.109081: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:43:55.109096: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:43:56.701504: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:43:56.701515: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:43:58.261737: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/53
2026-01-22 06:43:59.507532: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:43:59.507573: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:43:59.507582: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 50/53
  done 53/53

Exporting split=test: 22 trajectories
  done 22/22

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz --H 25 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.json
H=25, n_dof=6, feature_dim=24
X_train: (30552, 25, 24)  Y_train: (30552, 6)
X_test : (5784, 25, 24)  Y_test : (5784, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:44:02.139172: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:44:02.163241: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (30552, 25, 24), Y_train = (30552, 6)
  X_test  = (5784, 25, 24),  Y_test  = (5784, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:44:03.239996: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:03.244909: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:03.245830: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:03.247466: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:03.248385: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:03.249155: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:03.346113: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:03.347001: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:03.347806: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:03.348604: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8952 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:44:04.306113: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
96/96 - 2s - 17ms/step - loss: 0.3761 - val_loss: 0.5760
Epoch 2/60
96/96 - 0s - 3ms/step - loss: 0.2074 - val_loss: 0.5164
Epoch 3/60
96/96 - 0s - 3ms/step - loss: 0.1860 - val_loss: 0.4826
Epoch 4/60
96/96 - 0s - 3ms/step - loss: 0.1704 - val_loss: 0.4715
Epoch 5/60
96/96 - 0s - 3ms/step - loss: 0.1608 - val_loss: 0.4604
Epoch 6/60
96/96 - 0s - 3ms/step - loss: 0.1551 - val_loss: 0.4522
Epoch 7/60
96/96 - 0s - 3ms/step - loss: 0.1481 - val_loss: 0.4478
Epoch 8/60
96/96 - 0s - 3ms/step - loss: 0.1449 - val_loss: 0.4427
Epoch 9/60
96/96 - 0s - 3ms/step - loss: 0.1408 - val_loss: 0.4343
Epoch 10/60
96/96 - 0s - 3ms/step - loss: 0.1392 - val_loss: 0.4256
Epoch 11/60
96/96 - 0s - 3ms/step - loss: 0.1364 - val_loss: 0.4255
Epoch 12/60
96/96 - 0s - 3ms/step - loss: 0.1361 - val_loss: 0.4236
Epoch 13/60
96/96 - 0s - 3ms/step - loss: 0.1317 - val_loss: 0.4229
Epoch 14/60
96/96 - 0s - 3ms/step - loss: 0.1300 - val_loss: 0.4198
Epoch 15/60
96/96 - 0s - 3ms/step - loss: 0.1289 - val_loss: 0.4247
Epoch 16/60
96/96 - 0s - 3ms/step - loss: 0.1264 - val_loss: 0.4189
Epoch 17/60
96/96 - 0s - 3ms/step - loss: 0.1249 - val_loss: 0.4183
Epoch 18/60
96/96 - 0s - 3ms/step - loss: 0.1241 - val_loss: 0.4233
Epoch 19/60
96/96 - 0s - 3ms/step - loss: 0.1235 - val_loss: 0.4252
Epoch 20/60
96/96 - 0s - 3ms/step - loss: 0.1218 - val_loss: 0.4260
Epoch 21/60
96/96 - 0s - 3ms/step - loss: 0.1207 - val_loss: 0.4241
Epoch 22/60
96/96 - 0s - 3ms/step - loss: 0.1186 - val_loss: 0.4263
Epoch 23/60
96/96 - 0s - 3ms/step - loss: 0.1178 - val_loss: 0.4267
Epoch 24/60
96/96 - 0s - 3ms/step - loss: 0.1177 - val_loss: 0.4310
Epoch 25/60
96/96 - 0s - 3ms/step - loss: 0.1160 - val_loss: 0.4299
Epoch 26/60
96/96 - 0s - 3ms/step - loss: 0.1159 - val_loss: 0.4310
Epoch 27/60
96/96 - 0s - 3ms/step - loss: 0.1149 - val_loss: 0.4294
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.1282
Per-joint RMSE: 1.6272 1.1742 0.8646 1.0126 0.8473 1.0577
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:44:13.018655: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:44:13.043272: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:44:13.885441: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:13.890010: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:13.890895: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:13.892557: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:13.893349: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:13.894086: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:13.972536: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:13.973373: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:13.974203: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:13.974936: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:44:14.268267: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.465588e+00  RMSE=1.210615e+00
  per-joint RMSE: 1.7520 1.2761 0.9475 1.0439 0.9095 1.1317
Residual LSTM:  MSE=1.272731e+00      RMSE=1.128154e+00
  per-joint RMSE: 1.6272 1.1742 0.8646 1.0126 0.8473 1.0577
Combined torque MSE=1.272731e+00     RMSE=1.128154e+00
  per-joint RMSE: 1.6272 1.1742 0.8646 1.0126 0.8473 1.0577
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz --H 25 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.json
H=25, n_dof=6, feature_dim=6
X_train: (30552, 25, 6)  Y_train: (30552, 6)
X_test : (5784, 25, 6)  Y_test : (5784, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:44:16.281621: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:44:16.305873: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (30552, 25, 6), Y_train = (30552, 6)
  X_test  = (5784, 25, 6),  Y_test  = (5784, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:44:17.277753: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:17.282401: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:17.283192: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:17.284879: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:17.285667: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:17.286405: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:17.368020: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:17.368936: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:17.369686: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:17.370416: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:44:18.293428: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
96/96 - 2s - 17ms/step - loss: 0.7501 - val_loss: 0.5592
Epoch 2/60
96/96 - 0s - 3ms/step - loss: 0.4517 - val_loss: 0.5603
Epoch 3/60
96/96 - 0s - 3ms/step - loss: 0.3365 - val_loss: 0.5405
Epoch 4/60
96/96 - 0s - 3ms/step - loss: 0.2858 - val_loss: 0.5087
Epoch 5/60
96/96 - 0s - 3ms/step - loss: 0.2487 - val_loss: 0.5184
Epoch 6/60
96/96 - 0s - 3ms/step - loss: 0.2247 - val_loss: 0.5065
Epoch 7/60
96/96 - 0s - 3ms/step - loss: 0.2213 - val_loss: 0.5105
Epoch 8/60
96/96 - 0s - 3ms/step - loss: 0.1930 - val_loss: 0.5103
Epoch 9/60
96/96 - 0s - 3ms/step - loss: 0.1760 - val_loss: 0.5181
Epoch 10/60
96/96 - 0s - 3ms/step - loss: 0.1705 - val_loss: 0.5120
Epoch 11/60
96/96 - 0s - 3ms/step - loss: 0.1969 - val_loss: 0.5103
Epoch 12/60
96/96 - 0s - 3ms/step - loss: 0.1609 - val_loss: 0.5208
Epoch 13/60
96/96 - 0s - 3ms/step - loss: 0.1568 - val_loss: 0.5214
Epoch 14/60
96/96 - 0s - 3ms/step - loss: 0.1540 - val_loss: 0.5117
Epoch 15/60
96/96 - 0s - 3ms/step - loss: 0.1499 - val_loss: 0.5107
Epoch 16/60
96/96 - 0s - 3ms/step - loss: 0.1498 - val_loss: 0.5103
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.2012
Per-joint RMSE: 1.7343 1.2311 0.9735 1.0298 0.9160 1.1341
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:44:24.072187: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:44:24.096971: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:44:24.943174: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:24.947911: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:24.948791: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:24.950491: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:24.951283: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:24.952019: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:25.035098: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:25.036026: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:25.036766: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:25.037502: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:44:25.340446: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.465588e+00  RMSE=1.210615e+00
  per-joint RMSE: 1.7520 1.2761 0.9475 1.0439 0.9095 1.1317
Residual LSTM:  MSE=1.442809e+00      RMSE=1.201170e+00
  per-joint RMSE: 1.7343 1.2311 0.9735 1.0298 0.9160 1.1341
Combined torque MSE=1.442809e+00     RMSE=1.201170e+00
  per-joint RMSE: 1.7343 1.2311 0.9735 1.0298 0.9160 1.1341
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz --H 25 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (30552, 25, 18)  Y_train: (30552, 6)
X_test : (5784, 25, 18)  Y_test : (5784, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:44:27.392992: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:44:27.417246: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (30552, 25, 18), Y_train = (30552, 6)
  X_test  = (5784, 25, 18),  Y_test  = (5784, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:44:28.446839: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:28.451501: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:28.452384: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:28.454172: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:28.455102: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:28.455917: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:28.539201: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:28.540044: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:28.540783: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:28.541515: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:44:29.504851: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
96/96 - 2s - 17ms/step - loss: 0.4336 - val_loss: 0.5987
Epoch 2/60
96/96 - 0s - 3ms/step - loss: 0.2534 - val_loss: 0.6044
Epoch 3/60
96/96 - 0s - 3ms/step - loss: 0.2216 - val_loss: 0.6264
Epoch 4/60
96/96 - 0s - 3ms/step - loss: 0.2011 - val_loss: 0.6330
Epoch 5/60
96/96 - 0s - 3ms/step - loss: 0.1886 - val_loss: 0.6108
Epoch 6/60
96/96 - 0s - 3ms/step - loss: 0.1765 - val_loss: 0.6100
Epoch 7/60
96/96 - 0s - 3ms/step - loss: 0.1688 - val_loss: 0.5849
Epoch 8/60
96/96 - 0s - 3ms/step - loss: 0.1618 - val_loss: 0.5652
Epoch 9/60
96/96 - 0s - 3ms/step - loss: 0.1578 - val_loss: 0.5683
Epoch 10/60
96/96 - 0s - 3ms/step - loss: 0.1535 - val_loss: 0.5623
Epoch 11/60
96/96 - 0s - 3ms/step - loss: 0.1503 - val_loss: 0.5617
Epoch 12/60
96/96 - 0s - 4ms/step - loss: 0.1469 - val_loss: 0.5564
Epoch 13/60
96/96 - 0s - 3ms/step - loss: 0.1437 - val_loss: 0.5618
Epoch 14/60
96/96 - 0s - 3ms/step - loss: 0.1407 - val_loss: 0.5504
Epoch 15/60
96/96 - 0s - 3ms/step - loss: 0.1380 - val_loss: 0.5510
Epoch 16/60
96/96 - 0s - 3ms/step - loss: 0.1383 - val_loss: 0.5573
Epoch 17/60
96/96 - 0s - 3ms/step - loss: 0.1343 - val_loss: 0.5554
Epoch 18/60
96/96 - 0s - 3ms/step - loss: 0.1320 - val_loss: 0.5560
Epoch 19/60
96/96 - 0s - 3ms/step - loss: 0.1342 - val_loss: 0.5635
Epoch 20/60
96/96 - 0s - 3ms/step - loss: 0.1308 - val_loss: 0.5520
Epoch 21/60
96/96 - 0s - 3ms/step - loss: 0.1311 - val_loss: 0.5690
Epoch 22/60
96/96 - 0s - 3ms/step - loss: 0.1287 - val_loss: 0.5571
Epoch 23/60
96/96 - 0s - 3ms/step - loss: 0.1287 - val_loss: 0.5531
Epoch 24/60
96/96 - 0s - 3ms/step - loss: 0.1260 - val_loss: 0.5501
Epoch 25/60
96/96 - 0s - 3ms/step - loss: 0.1264 - val_loss: 0.5651
Epoch 26/60
96/96 - 0s - 3ms/step - loss: 0.1243 - val_loss: 0.5637
Epoch 27/60
96/96 - 0s - 3ms/step - loss: 0.1232 - val_loss: 0.5567
Epoch 28/60
96/96 - 0s - 3ms/step - loss: 0.1214 - val_loss: 0.5570
Epoch 29/60
96/96 - 0s - 3ms/step - loss: 0.1222 - val_loss: 0.5713
Epoch 30/60
96/96 - 0s - 3ms/step - loss: 0.1226 - val_loss: 0.5716
Epoch 31/60
96/96 - 0s - 3ms/step - loss: 0.1228 - val_loss: 0.5626
Epoch 32/60
96/96 - 0s - 3ms/step - loss: 0.1193 - val_loss: 0.5557
Epoch 33/60
96/96 - 0s - 3ms/step - loss: 0.1187 - val_loss: 0.5655
Epoch 34/60
96/96 - 0s - 3ms/step - loss: 0.1197 - val_loss: 0.5568
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.1433
Per-joint RMSE: 1.6604 1.1714 0.8689 0.9984 0.8591 1.1065
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:44:40.102744: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:44:40.127526: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:44:40.993005: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:40.997707: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:40.998499: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:41.000282: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:41.001064: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:41.001798: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:41.082720: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:41.083551: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:41.084293: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:41.085020: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:44:41.380957: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.465588e+00  RMSE=1.210615e+00
  per-joint RMSE: 1.7520 1.2761 0.9475 1.0439 0.9095 1.1317
Residual LSTM:  MSE=1.307249e+00      RMSE=1.143350e+00
  per-joint RMSE: 1.6604 1.1714 0.8689 0.9984 0.8591 1.1065
Combined torque MSE=1.307249e+00     RMSE=1.143350e+00
  per-joint RMSE: 1.6604 1.1714 0.8689 0.9984 0.8591 1.1065
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz --H 25 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (30552, 25, 18)  Y_train: (30552, 6)
X_test : (5784, 25, 18)  Y_test : (5784, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:44:43.447255: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:44:43.471509: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (30552, 25, 18), Y_train = (30552, 6)
  X_test  = (5784, 25, 18),  Y_test  = (5784, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:44:44.495776: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:44.500610: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:44.501406: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:44.503265: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:44.504050: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:44.504785: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:44.583078: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:44.583919: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:44.584671: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:44.585391: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:44:45.506652: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
96/96 - 2s - 17ms/step - loss: 0.3825 - val_loss: 0.5622
Epoch 2/60
96/96 - 0s - 3ms/step - loss: 0.2119 - val_loss: 0.5083
Epoch 3/60
96/96 - 0s - 3ms/step - loss: 0.1867 - val_loss: 0.4846
Epoch 4/60
96/96 - 0s - 3ms/step - loss: 0.1708 - val_loss: 0.4671
Epoch 5/60
96/96 - 0s - 3ms/step - loss: 0.1637 - val_loss: 0.4407
Epoch 6/60
96/96 - 0s - 3ms/step - loss: 0.1584 - val_loss: 0.4339
Epoch 7/60
96/96 - 0s - 3ms/step - loss: 0.1518 - val_loss: 0.4242
Epoch 8/60
96/96 - 0s - 3ms/step - loss: 0.1470 - val_loss: 0.4250
Epoch 9/60
96/96 - 0s - 3ms/step - loss: 0.1431 - val_loss: 0.4198
Epoch 10/60
96/96 - 0s - 3ms/step - loss: 0.1400 - val_loss: 0.4115
Epoch 11/60
96/96 - 0s - 3ms/step - loss: 0.1379 - val_loss: 0.4189
Epoch 12/60
96/96 - 0s - 3ms/step - loss: 0.1352 - val_loss: 0.4128
Epoch 13/60
96/96 - 0s - 3ms/step - loss: 0.1338 - val_loss: 0.4091
Epoch 14/60
96/96 - 0s - 3ms/step - loss: 0.1329 - val_loss: 0.4075
Epoch 15/60
96/96 - 0s - 3ms/step - loss: 0.1301 - val_loss: 0.4097
Epoch 16/60
96/96 - 0s - 3ms/step - loss: 0.1283 - val_loss: 0.4057
Epoch 17/60
96/96 - 0s - 3ms/step - loss: 0.1276 - val_loss: 0.4041
Epoch 18/60
96/96 - 0s - 3ms/step - loss: 0.1250 - val_loss: 0.4011
Epoch 19/60
96/96 - 0s - 3ms/step - loss: 0.1240 - val_loss: 0.4023
Epoch 20/60
96/96 - 0s - 3ms/step - loss: 0.1233 - val_loss: 0.4007
Epoch 21/60
96/96 - 0s - 3ms/step - loss: 0.1225 - val_loss: 0.4003
Epoch 22/60
96/96 - 0s - 3ms/step - loss: 0.1218 - val_loss: 0.3966
Epoch 23/60
96/96 - 0s - 3ms/step - loss: 0.1197 - val_loss: 0.4006
Epoch 24/60
96/96 - 0s - 3ms/step - loss: 0.1190 - val_loss: 0.4043
Epoch 25/60
96/96 - 0s - 3ms/step - loss: 0.1176 - val_loss: 0.4055
Epoch 26/60
96/96 - 0s - 3ms/step - loss: 0.1179 - val_loss: 0.3998
Epoch 27/60
96/96 - 0s - 3ms/step - loss: 0.1156 - val_loss: 0.4004
Epoch 28/60
96/96 - 0s - 3ms/step - loss: 0.1149 - val_loss: 0.3981
Epoch 29/60
96/96 - 0s - 3ms/step - loss: 0.1149 - val_loss: 0.3967
Epoch 30/60
96/96 - 0s - 3ms/step - loss: 0.1132 - val_loss: 0.3994
Epoch 31/60
96/96 - 0s - 3ms/step - loss: 0.1121 - val_loss: 0.3956
Epoch 32/60
96/96 - 0s - 3ms/step - loss: 0.1115 - val_loss: 0.4016
Epoch 33/60
96/96 - 0s - 3ms/step - loss: 0.1120 - val_loss: 0.4009
Epoch 34/60
96/96 - 0s - 3ms/step - loss: 0.1097 - val_loss: 0.4036
Epoch 35/60
96/96 - 0s - 3ms/step - loss: 0.1098 - val_loss: 0.4043
Epoch 36/60
96/96 - 0s - 3ms/step - loss: 0.1091 - val_loss: 0.4096
Epoch 37/60
96/96 - 0s - 3ms/step - loss: 0.1090 - val_loss: 0.4027
Epoch 38/60
96/96 - 0s - 3ms/step - loss: 0.1084 - val_loss: 0.4071
Epoch 39/60
96/96 - 0s - 3ms/step - loss: 0.1067 - val_loss: 0.4021
Epoch 40/60
96/96 - 0s - 3ms/step - loss: 0.1070 - val_loss: 0.4144
Epoch 41/60
96/96 - 0s - 3ms/step - loss: 0.1059 - val_loss: 0.4106
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.1411
Per-joint RMSE: 1.6140 1.2374 0.9018 0.9966 0.8617 1.0617
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:44:57.753917: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:44:57.778768: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:44:58.637052: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:58.641760: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:58.642556: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:58.644278: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:58.645143: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:58.645890: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:58.728458: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:58.729378: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:58.730124: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:44:58.730859: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:44:59.029782: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.465588e+00  RMSE=1.210615e+00
  per-joint RMSE: 1.7520 1.2761 0.9475 1.0439 0.9095 1.1317
Residual LSTM:  MSE=1.302016e+00      RMSE=1.141059e+00
  per-joint RMSE: 1.6140 1.2374 0.9018 0.9966 0.8617 1.0617
Combined torque MSE=1.302016e+00     RMSE=1.141059e+00
  per-joint RMSE: 1.6140 1.2374 0.9018 0.9966 0.8617 1.0617
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz --H 50 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.json
H=50, n_dof=6, feature_dim=24
X_train: (29877, 50, 24)  Y_train: (29877, 6)
X_test : (5559, 50, 24)  Y_test : (5559, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:45:01.169115: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:45:01.192894: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (29877, 50, 24), Y_train = (29877, 6)
  X_test  = (5559, 50, 24),  Y_test  = (5559, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:45:02.391926: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:02.396597: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:02.397390: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:02.399064: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:02.399865: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:02.400980: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:02.485513: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:02.486420: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:02.487325: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:02.488169: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:45:03.529321: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
94/94 - 2s - 19ms/step - loss: 0.3801 - val_loss: 0.5996
Epoch 2/60
94/94 - 0s - 4ms/step - loss: 0.2146 - val_loss: 0.5637
Epoch 3/60
94/94 - 0s - 4ms/step - loss: 0.1911 - val_loss: 0.5367
Epoch 4/60
94/94 - 0s - 4ms/step - loss: 0.1763 - val_loss: 0.5089
Epoch 5/60
94/94 - 0s - 4ms/step - loss: 0.1678 - val_loss: 0.5097
Epoch 6/60
94/94 - 0s - 4ms/step - loss: 0.1624 - val_loss: 0.5114
Epoch 7/60
94/94 - 0s - 4ms/step - loss: 0.1555 - val_loss: 0.5019
Epoch 8/60
94/94 - 0s - 4ms/step - loss: 0.1516 - val_loss: 0.5036
Epoch 9/60
94/94 - 0s - 4ms/step - loss: 0.1464 - val_loss: 0.5012
Epoch 10/60
94/94 - 0s - 4ms/step - loss: 0.1440 - val_loss: 0.4991
Epoch 11/60
94/94 - 0s - 4ms/step - loss: 0.1407 - val_loss: 0.4871
Epoch 12/60
94/94 - 0s - 5ms/step - loss: 0.1378 - val_loss: 0.4894
Epoch 13/60
94/94 - 0s - 4ms/step - loss: 0.1366 - val_loss: 0.4839
Epoch 14/60
94/94 - 0s - 4ms/step - loss: 0.1348 - val_loss: 0.4852
Epoch 15/60
94/94 - 0s - 4ms/step - loss: 0.1329 - val_loss: 0.4815
Epoch 16/60
94/94 - 0s - 4ms/step - loss: 0.1310 - val_loss: 0.4762
Epoch 17/60
94/94 - 0s - 4ms/step - loss: 0.1297 - val_loss: 0.4766
Epoch 18/60
94/94 - 0s - 4ms/step - loss: 0.1278 - val_loss: 0.4846
Epoch 19/60
94/94 - 0s - 4ms/step - loss: 0.1269 - val_loss: 0.4802
Epoch 20/60
94/94 - 0s - 4ms/step - loss: 0.1251 - val_loss: 0.4827
Epoch 21/60
94/94 - 0s - 4ms/step - loss: 0.1254 - val_loss: 0.4844
Epoch 22/60
94/94 - 0s - 4ms/step - loss: 0.1229 - val_loss: 0.4904
Epoch 23/60
94/94 - 0s - 4ms/step - loss: 0.1217 - val_loss: 0.4872
Epoch 24/60
94/94 - 0s - 4ms/step - loss: 0.1212 - val_loss: 0.4862
Epoch 25/60
94/94 - 0s - 4ms/step - loss: 0.1211 - val_loss: 0.4846
Epoch 26/60
94/94 - 0s - 4ms/step - loss: 0.1198 - val_loss: 0.4904
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.1179
Per-joint RMSE: 1.5967 1.1812 0.8634 0.9927 0.8343 1.0612
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:45:15.196284: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:45:15.220793: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:45:16.078715: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:16.083341: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:16.084290: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:16.086152: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:16.086945: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:16.087687: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:16.172526: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:16.173355: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:16.174094: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:16.174822: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:45:16.470646: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.438163e+00  RMSE=1.199234e+00
  per-joint RMSE: 1.7247 1.2792 0.9390 1.0406 0.8950 1.1192
Residual LSTM:  MSE=1.249609e+00      RMSE=1.117859e+00
  per-joint RMSE: 1.5967 1.1812 0.8634 0.9927 0.8343 1.0612
Combined torque MSE=1.249609e+00     RMSE=1.117859e+00
  per-joint RMSE: 1.5967 1.1812 0.8634 0.9927 0.8343 1.0612
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz --H 50 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.json
H=50, n_dof=6, feature_dim=6
X_train: (29877, 50, 6)  Y_train: (29877, 6)
X_test : (5559, 50, 6)  Y_test : (5559, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:45:18.529356: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:45:18.553306: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (29877, 50, 6), Y_train = (29877, 6)
  X_test  = (5559, 50, 6),  Y_test  = (5559, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:45:19.591577: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:19.596264: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:19.597136: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:19.598703: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:19.599488: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:19.600225: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:19.682387: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:19.683212: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:19.684045: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:19.684776: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:45:20.643577: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
94/94 - 2s - 19ms/step - loss: 0.7213 - val_loss: 0.5826
Epoch 2/60
94/94 - 0s - 4ms/step - loss: 0.3678 - val_loss: 0.5538
Epoch 3/60
94/94 - 0s - 4ms/step - loss: 0.2682 - val_loss: 0.5570
Epoch 4/60
94/94 - 0s - 4ms/step - loss: 0.2314 - val_loss: 0.5646
Epoch 5/60
94/94 - 0s - 4ms/step - loss: 0.2095 - val_loss: 0.5832
Epoch 6/60
94/94 - 0s - 4ms/step - loss: 0.2044 - val_loss: 0.5608
Epoch 7/60
94/94 - 0s - 4ms/step - loss: 0.1910 - val_loss: 0.5695
Epoch 8/60
94/94 - 0s - 4ms/step - loss: 0.1881 - val_loss: 0.5706
Epoch 9/60
94/94 - 0s - 4ms/step - loss: 0.1777 - val_loss: 0.5541
Epoch 10/60
94/94 - 0s - 4ms/step - loss: 0.1750 - val_loss: 0.5682
Epoch 11/60
94/94 - 0s - 4ms/step - loss: 0.1692 - val_loss: 0.5592
Epoch 12/60
94/94 - 0s - 5ms/step - loss: 0.1650 - val_loss: 0.5598
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.2006
Per-joint RMSE: 1.7140 1.2943 0.9285 1.0384 0.9082 1.1269
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:45:26.790999: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:45:26.815601: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:45:27.662093: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:27.666718: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:27.667518: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:27.669340: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:27.670217: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:27.670956: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:27.747615: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:27.748450: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:27.749278: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:27.750012: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:45:28.046093: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.438163e+00  RMSE=1.199234e+00
  per-joint RMSE: 1.7247 1.2792 0.9390 1.0406 0.8950 1.1192
Residual LSTM:  MSE=1.441333e+00      RMSE=1.200555e+00
  per-joint RMSE: 1.7140 1.2943 0.9285 1.0384 0.9082 1.1269
Combined torque MSE=1.441333e+00     RMSE=1.200555e+00
  per-joint RMSE: 1.7140 1.2943 0.9285 1.0384 0.9082 1.1269
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz --H 50 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (29877, 50, 18)  Y_train: (29877, 6)
X_test : (5559, 50, 18)  Y_test : (5559, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:45:30.176496: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:45:30.200329: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (29877, 50, 18), Y_train = (29877, 6)
  X_test  = (5559, 50, 18),  Y_test  = (5559, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:45:31.326987: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:31.331582: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:31.332457: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:31.334025: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:31.334810: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:31.335545: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:31.414926: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:31.415848: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:31.416682: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:31.417415: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:45:32.372904: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
94/94 - 2s - 18ms/step - loss: 0.4257 - val_loss: 0.5653
Epoch 2/60
94/94 - 0s - 4ms/step - loss: 0.2570 - val_loss: 0.5561
Epoch 3/60
94/94 - 0s - 4ms/step - loss: 0.2272 - val_loss: 0.5597
Epoch 4/60
94/94 - 0s - 4ms/step - loss: 0.2089 - val_loss: 0.5907
Epoch 5/60
94/94 - 0s - 4ms/step - loss: 0.1941 - val_loss: 0.5909
Epoch 6/60
94/94 - 0s - 4ms/step - loss: 0.1857 - val_loss: 0.5821
Epoch 7/60
94/94 - 0s - 4ms/step - loss: 0.1769 - val_loss: 0.5822
Epoch 8/60
94/94 - 0s - 4ms/step - loss: 0.1721 - val_loss: 0.5833
Epoch 9/60
94/94 - 0s - 4ms/step - loss: 0.1661 - val_loss: 0.5809
Epoch 10/60
94/94 - 0s - 4ms/step - loss: 0.1614 - val_loss: 0.5745
Epoch 11/60
94/94 - 0s - 4ms/step - loss: 0.1595 - val_loss: 0.5719
Epoch 12/60
94/94 - 0s - 5ms/step - loss: 0.1533 - val_loss: 0.5708
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.1463
Per-joint RMSE: 1.6465 1.2116 0.8844 0.9880 0.8692 1.0917
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:45:38.563311: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:45:38.587970: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:45:39.457698: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:39.462433: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:39.463368: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:39.465254: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:39.466180: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:39.466964: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:39.543233: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:39.544209: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:39.545008: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:39.545789: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:45:39.839206: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.438163e+00  RMSE=1.199234e+00
  per-joint RMSE: 1.7247 1.2792 0.9390 1.0406 0.8950 1.1192
Residual LSTM:  MSE=1.314113e+00      RMSE=1.146348e+00
  per-joint RMSE: 1.6465 1.2116 0.8844 0.9880 0.8692 1.0917
Combined torque MSE=1.314113e+00     RMSE=1.146348e+00
  per-joint RMSE: 1.6465 1.2116 0.8844 0.9880 0.8692 1.0917
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz --H 50 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (29877, 50, 18)  Y_train: (29877, 6)
X_test : (5559, 50, 18)  Y_test : (5559, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:45:41.983810: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:45:42.007918: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (29877, 50, 18), Y_train = (29877, 6)
  X_test  = (5559, 50, 18),  Y_test  = (5559, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:45:43.153370: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:43.158028: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:43.158830: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:43.160461: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:43.161254: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:43.161989: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:43.241031: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:43.241933: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:43.242728: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:43.243528: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:45:44.252458: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
94/94 - 2s - 19ms/step - loss: 0.3830 - val_loss: 0.5649
Epoch 2/60
94/94 - 0s - 4ms/step - loss: 0.2183 - val_loss: 0.5267
Epoch 3/60
94/94 - 0s - 4ms/step - loss: 0.1922 - val_loss: 0.5151
Epoch 4/60
94/94 - 0s - 4ms/step - loss: 0.1792 - val_loss: 0.5060
Epoch 5/60
94/94 - 0s - 4ms/step - loss: 0.1688 - val_loss: 0.4983
Epoch 6/60
94/94 - 0s - 4ms/step - loss: 0.1613 - val_loss: 0.5063
Epoch 7/60
94/94 - 0s - 4ms/step - loss: 0.1565 - val_loss: 0.4948
Epoch 8/60
94/94 - 0s - 4ms/step - loss: 0.1520 - val_loss: 0.4920
Epoch 9/60
94/94 - 0s - 4ms/step - loss: 0.1487 - val_loss: 0.4889
Epoch 10/60
94/94 - 0s - 4ms/step - loss: 0.1445 - val_loss: 0.4845
Epoch 11/60
94/94 - 0s - 4ms/step - loss: 0.1428 - val_loss: 0.4898
Epoch 12/60
94/94 - 0s - 5ms/step - loss: 0.1400 - val_loss: 0.4771
Epoch 13/60
94/94 - 0s - 4ms/step - loss: 0.1369 - val_loss: 0.4747
Epoch 14/60
94/94 - 0s - 4ms/step - loss: 0.1349 - val_loss: 0.4758
Epoch 15/60
94/94 - 0s - 4ms/step - loss: 0.1326 - val_loss: 0.4691
Epoch 16/60
94/94 - 0s - 4ms/step - loss: 0.1314 - val_loss: 0.4650
Epoch 17/60
94/94 - 0s - 4ms/step - loss: 0.1304 - val_loss: 0.4642
Epoch 18/60
94/94 - 0s - 4ms/step - loss: 0.1288 - val_loss: 0.4554
Epoch 19/60
94/94 - 0s - 4ms/step - loss: 0.1272 - val_loss: 0.4600
Epoch 20/60
94/94 - 0s - 4ms/step - loss: 0.1255 - val_loss: 0.4638
Epoch 21/60
94/94 - 0s - 4ms/step - loss: 0.1242 - val_loss: 0.4625
Epoch 22/60
94/94 - 0s - 4ms/step - loss: 0.1239 - val_loss: 0.4725
Epoch 23/60
94/94 - 0s - 4ms/step - loss: 0.1228 - val_loss: 0.4718
Epoch 24/60
94/94 - 0s - 4ms/step - loss: 0.1213 - val_loss: 0.4657
Epoch 25/60
94/94 - 0s - 4ms/step - loss: 0.1201 - val_loss: 0.4655
Epoch 26/60
94/94 - 0s - 4ms/step - loss: 0.1186 - val_loss: 0.4757
Epoch 27/60
94/94 - 0s - 4ms/step - loss: 0.1189 - val_loss: 0.4703
Epoch 28/60
94/94 - 0s - 4ms/step - loss: 0.1183 - val_loss: 0.4747
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.1173
Per-joint RMSE: 1.5960 1.1934 0.8474 1.0027 0.8259 1.0549
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:45:56.764345: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:45:56.789433: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:45:57.631970: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:57.636698: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:57.637487: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:57.639140: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:57.639925: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:57.640665: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:57.727511: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:57.728336: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:57.729072: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:45:57.729800: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:45:58.024017: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.438163e+00  RMSE=1.199234e+00
  per-joint RMSE: 1.7247 1.2792 0.9390 1.0406 0.8950 1.1192
Residual LSTM:  MSE=1.248294e+00      RMSE=1.117271e+00
  per-joint RMSE: 1.5960 1.1934 0.8474 1.0027 0.8259 1.0549
Combined torque MSE=1.248294e+00     RMSE=1.117271e+00
  per-joint RMSE: 1.5960 1.1934 0.8474 1.0027 0.8259 1.0549
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=2                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz                                 ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed1_dataset.npz -t structured -s 2 -r 0 --hp_preset fast_debug --epochs 250 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 250, 'lagrangian_type': <function structured_lagrangian_fn at 0x7ed8e353c1f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed1_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed1_dataset.npz
   dt ≈ 0.02784919441460803
  dof = 6
  Train trajectories = 53
  Test trajectories  = 22
  Train samples = 31276
  Test samples  = 6039
################################################

2026-01-22 06:46:02.415999: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250 | type=structured | dof=6
################################################
2026-01-22 06:46:05.577164: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:46:05.577200: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:46:05.577206: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:46:05.577233: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:46:05.577239: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:46:05.577253: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:46:05.577289: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:46:05.577295: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:46:05.577310: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:46:05.577315: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   4.9s, Loss=9.81e+00, Inv=9.81e+00, For=1.91e+02, Power=1.61e+00
  [eval] test_mse=5.637e+00  (n=6039)
Epoch 00050: Time=  10.4s, Loss=1.82e+00, Inv=1.82e+00, For=1.30e+02, Power=3.33e-01
Epoch 00100: Time=  14.6s, Loss=1.58e+00, Inv=1.58e+00, For=1.81e+02, Power=2.99e-01
Epoch 00150: Time=  18.6s, Loss=1.46e+00, Inv=1.46e+00, For=2.30e+02, Power=2.87e-01
Epoch 00200: Time=  22.7s, Loss=1.39e+00, Inv=1.39e+00, For=2.90e+02, Power=2.74e-01
  [eval] test_mse=8.739e+00  (n=6039)
Epoch 00250: Time=  26.6s, Loss=1.33e+00, Inv=1.33e+00, For=3.45e+02, Power=2.63e-01
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250
Torque MSE  = 1.549e+00
Torque RMSE = 1.244e+00
Per-joint MSE : 1.018e+00 1.868e+00 1.989e+00 4.851e-01 5.774e-01 3.355e+00
Per-joint RMSE: 1.009e+00 1.367e+00 1.410e+00 6.965e-01 7.598e-01 1.832e+00
Comp Time per Sample = 4.632e-08s / 21589678.6Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed1_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed1_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax
Detected n_dof=6 (seed=2)
2026-01-22 06:46:34.329087: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 53 trajectories
2026-01-22 06:46:35.668913: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:46:35.668927: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:46:37.142329: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:46:37.142342: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:46:38.723097: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/53
2026-01-22 06:46:39.965021: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:46:39.965055: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:46:39.965061: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 50/53
  done 53/53

Exporting split=test: 22 trajectories
  done 22/22

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz --H 25 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.json
H=25, n_dof=6, feature_dim=24
X_train: (30552, 25, 24)  Y_train: (30552, 6)
X_test : (5784, 25, 24)  Y_test : (5784, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:46:42.411088: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:46:42.435114: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (30552, 25, 24), Y_train = (30552, 6)
  X_test  = (5784, 25, 24),  Y_test  = (5784, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:46:43.505768: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:43.510634: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:43.511555: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:43.513257: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:43.514171: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:43.515041: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:43.600256: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:43.601145: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:43.601942: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:43.602736: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8952 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:46:44.551370: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
96/96 - 2s - 17ms/step - loss: 0.3773 - val_loss: 0.6212
Epoch 2/60
96/96 - 0s - 3ms/step - loss: 0.2058 - val_loss: 0.5844
Epoch 3/60
96/96 - 0s - 3ms/step - loss: 0.1827 - val_loss: 0.5677
Epoch 4/60
96/96 - 0s - 3ms/step - loss: 0.1691 - val_loss: 0.5541
Epoch 5/60
96/96 - 0s - 3ms/step - loss: 0.1605 - val_loss: 0.5259
Epoch 6/60
96/96 - 0s - 3ms/step - loss: 0.1544 - val_loss: 0.5203
Epoch 7/60
96/96 - 0s - 3ms/step - loss: 0.1501 - val_loss: 0.5115
Epoch 8/60
96/96 - 0s - 3ms/step - loss: 0.1448 - val_loss: 0.5113
Epoch 9/60
96/96 - 0s - 3ms/step - loss: 0.1420 - val_loss: 0.5127
Epoch 10/60
96/96 - 0s - 3ms/step - loss: 0.1399 - val_loss: 0.5103
Epoch 11/60
96/96 - 0s - 4ms/step - loss: 0.1380 - val_loss: 0.5046
Epoch 12/60
96/96 - 0s - 3ms/step - loss: 0.1357 - val_loss: 0.4950
Epoch 13/60
96/96 - 0s - 3ms/step - loss: 0.1329 - val_loss: 0.4972
Epoch 14/60
96/96 - 0s - 3ms/step - loss: 0.1323 - val_loss: 0.4934
Epoch 15/60
96/96 - 0s - 3ms/step - loss: 0.1329 - val_loss: 0.4861
Epoch 16/60
96/96 - 0s - 3ms/step - loss: 0.1270 - val_loss: 0.4889
Epoch 17/60
96/96 - 0s - 3ms/step - loss: 0.1274 - val_loss: 0.4801
Epoch 18/60
96/96 - 0s - 3ms/step - loss: 0.1251 - val_loss: 0.4775
Epoch 19/60
96/96 - 0s - 3ms/step - loss: 0.1240 - val_loss: 0.4774
Epoch 20/60
96/96 - 0s - 3ms/step - loss: 0.1231 - val_loss: 0.4720
Epoch 21/60
96/96 - 0s - 3ms/step - loss: 0.1217 - val_loss: 0.4808
Epoch 22/60
96/96 - 0s - 3ms/step - loss: 0.1211 - val_loss: 0.4804
Epoch 23/60
96/96 - 0s - 3ms/step - loss: 0.1199 - val_loss: 0.4835
Epoch 24/60
96/96 - 0s - 3ms/step - loss: 0.1185 - val_loss: 0.4791
Epoch 25/60
96/96 - 0s - 3ms/step - loss: 0.1181 - val_loss: 0.4740
Epoch 26/60
96/96 - 0s - 3ms/step - loss: 0.1172 - val_loss: 0.4758
Epoch 27/60
96/96 - 0s - 3ms/step - loss: 0.1181 - val_loss: 0.4731
Epoch 28/60
96/96 - 0s - 3ms/step - loss: 0.1155 - val_loss: 0.4788
Epoch 29/60
96/96 - 0s - 3ms/step - loss: 0.1154 - val_loss: 0.4759
Epoch 30/60
96/96 - 0s - 3ms/step - loss: 0.1140 - val_loss: 0.4810
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.1632
Per-joint RMSE: 0.8806 1.2315 1.2755 0.6560 0.7042 1.8090
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:46:54.164899: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:46:54.190678: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:46:55.042129: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:55.046718: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:55.047510: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:55.049278: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:55.050147: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:55.050886: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:55.132817: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:55.133744: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:55.134487: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:55.135213: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:46:55.430567: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.594317e+00  RMSE=1.262663e+00
  per-joint RMSE: 1.0254 1.3801 1.4277 0.7091 0.7729 1.8631
Residual LSTM:  MSE=1.352944e+00      RMSE=1.163161e+00
  per-joint RMSE: 0.8806 1.2315 1.2755 0.6560 0.7042 1.8090
Combined torque MSE=1.352944e+00     RMSE=1.163161e+00
  per-joint RMSE: 0.8806 1.2315 1.2755 0.6560 0.7042 1.8090
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz --H 25 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.json
H=25, n_dof=6, feature_dim=6
X_train: (30552, 25, 6)  Y_train: (30552, 6)
X_test : (5784, 25, 6)  Y_test : (5784, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:46:57.432152: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:46:57.456335: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (30552, 25, 6), Y_train = (30552, 6)
  X_test  = (5784, 25, 6),  Y_test  = (5784, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:46:58.426527: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:58.431063: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:58.431853: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:58.433493: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:58.434279: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:58.435022: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:58.513108: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:58.513940: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:58.514685: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:46:58.515412: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:46:59.434164: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
96/96 - 2s - 17ms/step - loss: 0.7623 - val_loss: 0.5623
Epoch 2/60
96/96 - 0s - 3ms/step - loss: 0.4382 - val_loss: 0.5244
Epoch 3/60
96/96 - 0s - 3ms/step - loss: 0.3363 - val_loss: 0.5094
Epoch 4/60
96/96 - 0s - 3ms/step - loss: 0.2843 - val_loss: 0.5009
Epoch 5/60
96/96 - 0s - 3ms/step - loss: 0.2528 - val_loss: 0.5100
Epoch 6/60
96/96 - 0s - 3ms/step - loss: 0.2261 - val_loss: 0.5174
Epoch 7/60
96/96 - 0s - 3ms/step - loss: 0.2020 - val_loss: 0.5184
Epoch 8/60
96/96 - 0s - 3ms/step - loss: 0.1867 - val_loss: 0.5199
Epoch 9/60
96/96 - 0s - 3ms/step - loss: 0.1814 - val_loss: 0.5162
Epoch 10/60
96/96 - 0s - 3ms/step - loss: 0.1700 - val_loss: 0.5135
Epoch 11/60
96/96 - 0s - 3ms/step - loss: 0.1637 - val_loss: 0.5144
Epoch 12/60
96/96 - 0s - 3ms/step - loss: 0.1604 - val_loss: 0.5123
Epoch 13/60
96/96 - 0s - 3ms/step - loss: 0.1766 - val_loss: 0.5152
Epoch 14/60
96/96 - 0s - 3ms/step - loss: 0.1580 - val_loss: 0.5125
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.2443
Per-joint RMSE: 1.0962 1.1784 1.4857 0.7346 0.7443 1.8436
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:47:04.705704: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:47:04.731039: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:47:05.593281: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:05.598047: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:05.598840: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:05.600549: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:05.601340: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:05.602074: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:05.683982: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:05.684820: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:05.685553: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:05.686282: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:47:05.978246: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.594317e+00  RMSE=1.262663e+00
  per-joint RMSE: 1.0254 1.3801 1.4277 0.7091 0.7729 1.8631
Residual LSTM:  MSE=1.548340e+00      RMSE=1.244323e+00
  per-joint RMSE: 1.0962 1.1784 1.4857 0.7346 0.7443 1.8436
Combined torque MSE=1.548340e+00     RMSE=1.244323e+00
  per-joint RMSE: 1.0962 1.1784 1.4857 0.7346 0.7443 1.8436
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz --H 25 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (30552, 25, 18)  Y_train: (30552, 6)
X_test : (5784, 25, 18)  Y_test : (5784, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:47:08.051941: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:47:08.076190: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (30552, 25, 18), Y_train = (30552, 6)
  X_test  = (5784, 25, 18),  Y_test  = (5784, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:47:09.111478: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:09.116173: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:09.117042: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:09.118615: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:09.119415: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:09.120343: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:09.194352: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:09.195182: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:09.195922: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:09.196652: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:47:10.164170: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
96/96 - 2s - 17ms/step - loss: 0.4332 - val_loss: 0.5749
Epoch 2/60
96/96 - 0s - 3ms/step - loss: 0.2451 - val_loss: 0.6031
Epoch 3/60
96/96 - 0s - 3ms/step - loss: 0.2174 - val_loss: 0.6576
Epoch 4/60
96/96 - 0s - 3ms/step - loss: 0.1947 - val_loss: 0.6537
Epoch 5/60
96/96 - 0s - 3ms/step - loss: 0.1866 - val_loss: 0.6248
Epoch 6/60
96/96 - 0s - 3ms/step - loss: 0.1761 - val_loss: 0.6246
Epoch 7/60
96/96 - 0s - 3ms/step - loss: 0.1693 - val_loss: 0.6159
Epoch 8/60
96/96 - 0s - 3ms/step - loss: 0.1617 - val_loss: 0.5989
Epoch 9/60
96/96 - 0s - 3ms/step - loss: 0.1570 - val_loss: 0.5923
Epoch 10/60
96/96 - 0s - 3ms/step - loss: 0.1532 - val_loss: 0.5981
Epoch 11/60
96/96 - 0s - 3ms/step - loss: 0.1510 - val_loss: 0.5953
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.2140
Per-joint RMSE: 0.9166 1.2881 1.4034 0.6699 0.7459 1.8353
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:47:14.648114: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:47:14.672832: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:47:15.531896: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:15.536598: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:15.537391: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:15.539071: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:15.539942: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:15.540739: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:15.621360: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:15.622194: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:15.622944: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:15.623677: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:47:15.917505: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.594317e+00  RMSE=1.262663e+00
  per-joint RMSE: 1.0254 1.3801 1.4277 0.7091 0.7729 1.8631
Residual LSTM:  MSE=1.473783e+00      RMSE=1.213995e+00
  per-joint RMSE: 0.9166 1.2881 1.4034 0.6699 0.7459 1.8353
Combined torque MSE=1.473783e+00     RMSE=1.213995e+00
  per-joint RMSE: 0.9166 1.2881 1.4034 0.6699 0.7459 1.8353
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz --H 25 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (30552, 25, 18)  Y_train: (30552, 6)
X_test : (5784, 25, 18)  Y_test : (5784, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:47:17.984693: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:47:18.008872: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (30552, 25, 18), Y_train = (30552, 6)
  X_test  = (5784, 25, 18),  Y_test  = (5784, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:47:19.048563: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:19.053178: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:19.054047: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:19.055610: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:19.056393: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:19.057135: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:19.134191: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:19.135026: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:19.135856: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:19.136599: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:47:20.065259: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
96/96 - 2s - 17ms/step - loss: 0.3896 - val_loss: 0.5727
Epoch 2/60
96/96 - 0s - 3ms/step - loss: 0.2119 - val_loss: 0.5008
Epoch 3/60
96/96 - 0s - 3ms/step - loss: 0.1850 - val_loss: 0.5116
Epoch 4/60
96/96 - 0s - 3ms/step - loss: 0.1698 - val_loss: 0.5220
Epoch 5/60
96/96 - 0s - 3ms/step - loss: 0.1626 - val_loss: 0.5204
Epoch 6/60
96/96 - 0s - 3ms/step - loss: 0.1565 - val_loss: 0.5169
Epoch 7/60
96/96 - 0s - 3ms/step - loss: 0.1509 - val_loss: 0.5144
Epoch 8/60
96/96 - 0s - 3ms/step - loss: 0.1469 - val_loss: 0.5036
Epoch 9/60
96/96 - 0s - 3ms/step - loss: 0.1436 - val_loss: 0.4992
Epoch 10/60
96/96 - 0s - 3ms/step - loss: 0.1407 - val_loss: 0.4907
Epoch 11/60
96/96 - 0s - 3ms/step - loss: 0.1381 - val_loss: 0.4883
Epoch 12/60
96/96 - 0s - 4ms/step - loss: 0.1360 - val_loss: 0.4862
Epoch 13/60
96/96 - 0s - 3ms/step - loss: 0.1342 - val_loss: 0.4804
Epoch 14/60
96/96 - 0s - 3ms/step - loss: 0.1327 - val_loss: 0.4745
Epoch 15/60
96/96 - 0s - 3ms/step - loss: 0.1307 - val_loss: 0.4742
Epoch 16/60
96/96 - 0s - 3ms/step - loss: 0.1296 - val_loss: 0.4715
Epoch 17/60
96/96 - 0s - 3ms/step - loss: 0.1273 - val_loss: 0.4771
Epoch 18/60
96/96 - 0s - 3ms/step - loss: 0.1264 - val_loss: 0.4715
Epoch 19/60
96/96 - 0s - 3ms/step - loss: 0.1255 - val_loss: 0.4858
Epoch 20/60
96/96 - 0s - 3ms/step - loss: 0.1256 - val_loss: 0.4819
Epoch 21/60
96/96 - 0s - 3ms/step - loss: 0.1227 - val_loss: 0.4846
Epoch 22/60
96/96 - 0s - 3ms/step - loss: 0.1220 - val_loss: 0.4902
Epoch 23/60
96/96 - 0s - 3ms/step - loss: 0.1210 - val_loss: 0.4841
Epoch 24/60
96/96 - 0s - 3ms/step - loss: 0.1206 - val_loss: 0.4858
Epoch 25/60
96/96 - 0s - 3ms/step - loss: 0.1193 - val_loss: 0.4904
Epoch 26/60
96/96 - 0s - 3ms/step - loss: 0.1187 - val_loss: 0.4912
Epoch 27/60
96/96 - 0s - 3ms/step - loss: 0.1187 - val_loss: 0.5001
Epoch 28/60
96/96 - 0s - 3ms/step - loss: 0.1158 - val_loss: 0.5027
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.1685
Per-joint RMSE: 0.8906 1.2677 1.2983 0.6417 0.6958 1.7919
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:47:28.963132: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:47:28.987558: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:47:29.832045: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:29.836726: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:29.837514: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:29.839282: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:29.840151: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:29.840894: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:29.920992: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:29.921910: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:29.922748: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:29.923471: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:47:30.215679: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.594317e+00  RMSE=1.262663e+00
  per-joint RMSE: 1.0254 1.3801 1.4277 0.7091 0.7729 1.8631
Residual LSTM:  MSE=1.365411e+00      RMSE=1.168508e+00
  per-joint RMSE: 0.8906 1.2677 1.2983 0.6417 0.6958 1.7919
Combined torque MSE=1.365411e+00     RMSE=1.168508e+00
  per-joint RMSE: 0.8906 1.2677 1.2983 0.6417 0.6958 1.7919
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz --H 50 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.json
H=50, n_dof=6, feature_dim=24
X_train: (29877, 50, 24)  Y_train: (29877, 6)
X_test : (5559, 50, 24)  Y_test : (5559, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:47:32.391361: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:47:32.414848: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (29877, 50, 24), Y_train = (29877, 6)
  X_test  = (5559, 50, 24),  Y_test  = (5559, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:47:33.614066: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:33.619011: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:33.620013: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:33.621645: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:33.622565: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:33.623425: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:33.707888: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:33.708779: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:33.709589: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:33.710368: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:47:34.719967: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
94/94 - 2s - 19ms/step - loss: 0.3791 - val_loss: 0.6833
Epoch 2/60
94/94 - 0s - 4ms/step - loss: 0.2131 - val_loss: 0.6468
Epoch 3/60
94/94 - 0s - 4ms/step - loss: 0.1871 - val_loss: 0.6000
Epoch 4/60
94/94 - 0s - 4ms/step - loss: 0.1737 - val_loss: 0.5629
Epoch 5/60
94/94 - 0s - 4ms/step - loss: 0.1663 - val_loss: 0.5398
Epoch 6/60
94/94 - 0s - 4ms/step - loss: 0.1587 - val_loss: 0.5372
Epoch 7/60
94/94 - 0s - 4ms/step - loss: 0.1545 - val_loss: 0.5377
Epoch 8/60
94/94 - 0s - 4ms/step - loss: 0.1501 - val_loss: 0.5425
Epoch 9/60
94/94 - 0s - 4ms/step - loss: 0.1458 - val_loss: 0.5370
Epoch 10/60
94/94 - 0s - 4ms/step - loss: 0.1431 - val_loss: 0.5330
Epoch 11/60
94/94 - 0s - 4ms/step - loss: 0.1405 - val_loss: 0.5257
Epoch 12/60
94/94 - 0s - 5ms/step - loss: 0.1387 - val_loss: 0.5277
Epoch 13/60
94/94 - 0s - 4ms/step - loss: 0.1359 - val_loss: 0.5244
Epoch 14/60
94/94 - 0s - 4ms/step - loss: 0.1327 - val_loss: 0.5290
Epoch 15/60
94/94 - 0s - 4ms/step - loss: 0.1320 - val_loss: 0.5238
Epoch 16/60
94/94 - 0s - 4ms/step - loss: 0.1315 - val_loss: 0.5197
Epoch 17/60
94/94 - 0s - 4ms/step - loss: 0.1294 - val_loss: 0.5216
Epoch 18/60
94/94 - 0s - 4ms/step - loss: 0.1290 - val_loss: 0.5176
Epoch 19/60
94/94 - 0s - 4ms/step - loss: 0.1261 - val_loss: 0.5141
Epoch 20/60
94/94 - 0s - 4ms/step - loss: 0.1249 - val_loss: 0.5174
Epoch 21/60
94/94 - 0s - 4ms/step - loss: 0.1244 - val_loss: 0.5141
Epoch 22/60
94/94 - 0s - 4ms/step - loss: 0.1227 - val_loss: 0.5111
Epoch 23/60
94/94 - 0s - 4ms/step - loss: 0.1215 - val_loss: 0.5138
Epoch 24/60
94/94 - 0s - 4ms/step - loss: 0.1198 - val_loss: 0.5106
Epoch 25/60
94/94 - 0s - 4ms/step - loss: 0.1193 - val_loss: 0.4979
Epoch 26/60
94/94 - 0s - 4ms/step - loss: 0.1178 - val_loss: 0.4977
Epoch 27/60
94/94 - 0s - 4ms/step - loss: 0.1188 - val_loss: 0.5053
Epoch 28/60
94/94 - 0s - 4ms/step - loss: 0.1170 - val_loss: 0.4961
Epoch 29/60
94/94 - 0s - 4ms/step - loss: 0.1165 - val_loss: 0.4941
Epoch 30/60
94/94 - 0s - 4ms/step - loss: 0.1150 - val_loss: 0.4919
Epoch 31/60
94/94 - 0s - 4ms/step - loss: 0.1145 - val_loss: 0.4859
Epoch 32/60
94/94 - 0s - 4ms/step - loss: 0.1131 - val_loss: 0.4805
Epoch 33/60
94/94 - 0s - 4ms/step - loss: 0.1137 - val_loss: 0.4859
Epoch 34/60
94/94 - 0s - 4ms/step - loss: 0.1125 - val_loss: 0.4809
Epoch 35/60
94/94 - 0s - 4ms/step - loss: 0.1115 - val_loss: 0.4706
Epoch 36/60
94/94 - 0s - 4ms/step - loss: 0.1110 - val_loss: 0.4738
Epoch 37/60
94/94 - 0s - 4ms/step - loss: 0.1112 - val_loss: 0.4775
Epoch 38/60
94/94 - 0s - 4ms/step - loss: 0.1098 - val_loss: 0.4795
Epoch 39/60
94/94 - 0s - 4ms/step - loss: 0.1089 - val_loss: 0.4735
Epoch 40/60
94/94 - 0s - 4ms/step - loss: 0.1086 - val_loss: 0.4807
Epoch 41/60
94/94 - 0s - 4ms/step - loss: 0.1078 - val_loss: 0.4869
Epoch 42/60
94/94 - 0s - 4ms/step - loss: 0.1078 - val_loss: 0.4901
Epoch 43/60
94/94 - 0s - 4ms/step - loss: 0.1065 - val_loss: 0.4841
Epoch 44/60
94/94 - 0s - 4ms/step - loss: 0.1060 - val_loss: 0.4774
Epoch 45/60
94/94 - 0s - 4ms/step - loss: 0.1053 - val_loss: 0.4876
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.1444
Per-joint RMSE: 0.8654 1.2147 1.2755 0.6534 0.6560 1.7745
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:47:53.802587: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:47:53.827389: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:47:54.678277: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:54.683144: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:54.683938: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:54.685650: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:54.686927: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:54.687766: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:54.772665: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:54.773497: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:54.774334: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:54.775064: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:47:55.081710: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.564175e+00  RMSE=1.250670e+00
  per-joint RMSE: 0.9966 1.3889 1.4121 0.7118 0.7496 1.8440
Residual LSTM:  MSE=1.309589e+00      RMSE=1.144373e+00
  per-joint RMSE: 0.8654 1.2147 1.2755 0.6534 0.6560 1.7745
Combined torque MSE=1.309589e+00     RMSE=1.144373e+00
  per-joint RMSE: 0.8654 1.2147 1.2755 0.6534 0.6560 1.7745
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz --H 50 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.json
H=50, n_dof=6, feature_dim=6
X_train: (29877, 50, 6)  Y_train: (29877, 6)
X_test : (5559, 50, 6)  Y_test : (5559, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:47:57.145867: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:47:57.169874: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (29877, 50, 6), Y_train = (29877, 6)
  X_test  = (5559, 50, 6),  Y_test  = (5559, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:47:58.211734: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:58.216322: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:58.217188: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:58.218841: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:58.219626: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:58.220356: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:58.298904: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:58.299805: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:58.300609: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:47:58.301396: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:47:59.270003: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
94/94 - 2s - 19ms/step - loss: 0.7312 - val_loss: 0.6319
Epoch 2/60
94/94 - 0s - 4ms/step - loss: 0.3804 - val_loss: 0.5839
Epoch 3/60
94/94 - 0s - 4ms/step - loss: 0.2756 - val_loss: 0.5721
Epoch 4/60
94/94 - 0s - 4ms/step - loss: 0.2379 - val_loss: 0.5903
Epoch 5/60
94/94 - 0s - 4ms/step - loss: 0.2189 - val_loss: 0.5667
Epoch 6/60
94/94 - 0s - 4ms/step - loss: 0.2045 - val_loss: 0.5678
Epoch 7/60
94/94 - 0s - 4ms/step - loss: 0.1943 - val_loss: 0.5537
Epoch 8/60
94/94 - 0s - 4ms/step - loss: 0.1838 - val_loss: 0.5552
Epoch 9/60
94/94 - 0s - 4ms/step - loss: 0.1806 - val_loss: 0.5537
Epoch 10/60
94/94 - 0s - 4ms/step - loss: 0.1743 - val_loss: 0.5416
Epoch 11/60
94/94 - 0s - 4ms/step - loss: 0.1892 - val_loss: 0.5494
Epoch 12/60
94/94 - 0s - 5ms/step - loss: 0.1770 - val_loss: 0.5564
Epoch 13/60
94/94 - 0s - 4ms/step - loss: 0.1653 - val_loss: 0.5476
Epoch 14/60
94/94 - 0s - 4ms/step - loss: 0.1598 - val_loss: 0.5442
Epoch 15/60
94/94 - 0s - 4ms/step - loss: 0.1546 - val_loss: 0.5433
Epoch 16/60
94/94 - 0s - 4ms/step - loss: 0.1537 - val_loss: 0.5330
Epoch 17/60
94/94 - 0s - 4ms/step - loss: 0.1546 - val_loss: 0.5402
Epoch 18/60
94/94 - 0s - 4ms/step - loss: 0.1561 - val_loss: 0.5332
Epoch 19/60
94/94 - 0s - 4ms/step - loss: 0.1523 - val_loss: 0.5198
Epoch 20/60
94/94 - 0s - 4ms/step - loss: 0.1540 - val_loss: 0.5276
Epoch 21/60
94/94 - 0s - 4ms/step - loss: 0.1486 - val_loss: 0.5266
Epoch 22/60
94/94 - 0s - 4ms/step - loss: 0.1462 - val_loss: 0.5264
Epoch 23/60
94/94 - 0s - 4ms/step - loss: 0.1477 - val_loss: 0.5422
Epoch 24/60
94/94 - 0s - 4ms/step - loss: 0.1438 - val_loss: 0.5359
Epoch 25/60
94/94 - 0s - 4ms/step - loss: 0.1431 - val_loss: 0.5342
Epoch 26/60
94/94 - 0s - 4ms/step - loss: 0.1451 - val_loss: 0.5342
Epoch 27/60
94/94 - 0s - 4ms/step - loss: 0.1460 - val_loss: 0.5463
Epoch 28/60
94/94 - 0s - 4ms/step - loss: 0.1578 - val_loss: 0.5400
Epoch 29/60
94/94 - 0s - 4ms/step - loss: 0.1423 - val_loss: 0.5419
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.2099
Per-joint RMSE: 1.0136 1.1935 1.3906 0.7319 0.7468 1.8180
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:48:11.831987: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:48:11.856626: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:48:12.714715: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:12.719413: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:12.720212: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:12.721967: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:12.722779: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:12.723886: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:12.807944: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:12.808938: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:12.809685: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:12.810414: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:48:13.106155: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.564175e+00  RMSE=1.250670e+00
  per-joint RMSE: 0.9966 1.3889 1.4121 0.7118 0.7496 1.8440
Residual LSTM:  MSE=1.463979e+00      RMSE=1.209950e+00
  per-joint RMSE: 1.0136 1.1935 1.3906 0.7319 0.7468 1.8180
Combined torque MSE=1.463979e+00     RMSE=1.209950e+00
  per-joint RMSE: 1.0136 1.1935 1.3906 0.7319 0.7468 1.8180
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz --H 50 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (29877, 50, 18)  Y_train: (29877, 6)
X_test : (5559, 50, 18)  Y_test : (5559, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:48:15.263490: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:48:15.287502: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (29877, 50, 18), Y_train = (29877, 6)
  X_test  = (5559, 50, 18),  Y_test  = (5559, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:48:16.438491: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:16.443111: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:16.444046: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:16.445792: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:16.446696: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:16.447553: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:16.532361: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:16.533242: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:16.534031: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:16.534816: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:48:17.487342: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
94/94 - 2s - 19ms/step - loss: 0.4344 - val_loss: 0.6409
Epoch 2/60
94/94 - 0s - 4ms/step - loss: 0.2533 - val_loss: 0.6896
Epoch 3/60
94/94 - 0s - 4ms/step - loss: 0.2242 - val_loss: 0.6680
Epoch 4/60
94/94 - 0s - 4ms/step - loss: 0.2037 - val_loss: 0.6690
Epoch 5/60
94/94 - 0s - 4ms/step - loss: 0.1927 - val_loss: 0.6685
Epoch 6/60
94/94 - 0s - 4ms/step - loss: 0.1815 - val_loss: 0.6563
Epoch 7/60
94/94 - 0s - 4ms/step - loss: 0.1742 - val_loss: 0.6593
Epoch 8/60
94/94 - 0s - 4ms/step - loss: 0.1693 - val_loss: 0.6460
Epoch 9/60
94/94 - 0s - 4ms/step - loss: 0.1627 - val_loss: 0.6392
Epoch 10/60
94/94 - 0s - 4ms/step - loss: 0.1577 - val_loss: 0.6396
Epoch 11/60
94/94 - 0s - 4ms/step - loss: 0.1531 - val_loss: 0.6336
Epoch 12/60
94/94 - 0s - 5ms/step - loss: 0.1513 - val_loss: 0.6419
Epoch 13/60
94/94 - 0s - 4ms/step - loss: 0.1475 - val_loss: 0.6376
Epoch 14/60
94/94 - 0s - 4ms/step - loss: 0.1453 - val_loss: 0.6410
Epoch 15/60
94/94 - 0s - 4ms/step - loss: 0.1424 - val_loss: 0.6384
Epoch 16/60
94/94 - 0s - 4ms/step - loss: 0.1398 - val_loss: 0.6424
Epoch 17/60
94/94 - 0s - 4ms/step - loss: 0.1379 - val_loss: 0.6457
Epoch 18/60
94/94 - 0s - 4ms/step - loss: 0.1371 - val_loss: 0.6403
Epoch 19/60
94/94 - 0s - 4ms/step - loss: 0.1349 - val_loss: 0.6417
Epoch 20/60
94/94 - 0s - 4ms/step - loss: 0.1341 - val_loss: 0.6340
Epoch 21/60
94/94 - 0s - 4ms/step - loss: 0.1327 - val_loss: 0.6409
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.2006
Per-joint RMSE: 0.9019 1.3344 1.3352 0.6477 0.7262 1.8236
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:48:27.061058: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:48:27.085644: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:48:27.946145: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:27.950849: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:27.951649: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:27.953302: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:27.954102: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:27.954923: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:28.039282: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:28.040121: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:28.040866: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:28.041596: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:48:28.340594: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.564175e+00  RMSE=1.250670e+00
  per-joint RMSE: 0.9966 1.3889 1.4121 0.7118 0.7496 1.8440
Residual LSTM:  MSE=1.441531e+00      RMSE=1.200638e+00
  per-joint RMSE: 0.9019 1.3344 1.3352 0.6477 0.7262 1.8236
Combined torque MSE=1.441531e+00     RMSE=1.200638e+00
  per-joint RMSE: 0.9019 1.3344 1.3352 0.6477 0.7262 1.8236
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz --H 50 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (29877, 50, 18)  Y_train: (29877, 6)
X_test : (5559, 50, 18)  Y_test : (5559, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:48:30.474538: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:48:30.499001: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (29877, 50, 18), Y_train = (29877, 6)
  X_test  = (5559, 50, 18),  Y_test  = (5559, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:48:31.634544: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:31.639056: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:31.639922: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:31.641431: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:31.642292: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:31.643021: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:31.722573: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:31.723421: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:31.724170: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:31.724901: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:48:32.710346: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
94/94 - 2s - 19ms/step - loss: 0.3911 - val_loss: 0.5943
Epoch 2/60
94/94 - 0s - 4ms/step - loss: 0.2171 - val_loss: 0.5810
Epoch 3/60
94/94 - 0s - 4ms/step - loss: 0.1896 - val_loss: 0.5753
Epoch 4/60
94/94 - 0s - 4ms/step - loss: 0.1774 - val_loss: 0.5652
Epoch 5/60
94/94 - 0s - 4ms/step - loss: 0.1681 - val_loss: 0.5495
Epoch 6/60
94/94 - 0s - 4ms/step - loss: 0.1602 - val_loss: 0.5405
Epoch 7/60
94/94 - 0s - 4ms/step - loss: 0.1551 - val_loss: 0.5408
Epoch 8/60
94/94 - 0s - 4ms/step - loss: 0.1509 - val_loss: 0.5230
Epoch 9/60
94/94 - 0s - 4ms/step - loss: 0.1465 - val_loss: 0.5192
Epoch 10/60
94/94 - 0s - 4ms/step - loss: 0.1449 - val_loss: 0.5166
Epoch 11/60
94/94 - 0s - 4ms/step - loss: 0.1418 - val_loss: 0.5100
Epoch 12/60
94/94 - 0s - 5ms/step - loss: 0.1391 - val_loss: 0.5021
Epoch 13/60
94/94 - 0s - 4ms/step - loss: 0.1366 - val_loss: 0.5102
Epoch 14/60
94/94 - 0s - 4ms/step - loss: 0.1348 - val_loss: 0.5061
Epoch 15/60
94/94 - 0s - 4ms/step - loss: 0.1337 - val_loss: 0.5006
Epoch 16/60
94/94 - 0s - 4ms/step - loss: 0.1321 - val_loss: 0.5003
Epoch 17/60
94/94 - 0s - 4ms/step - loss: 0.1310 - val_loss: 0.4998
Epoch 18/60
94/94 - 0s - 4ms/step - loss: 0.1290 - val_loss: 0.4937
Epoch 19/60
94/94 - 0s - 4ms/step - loss: 0.1280 - val_loss: 0.4912
Epoch 20/60
94/94 - 0s - 4ms/step - loss: 0.1263 - val_loss: 0.4987
Epoch 21/60
94/94 - 0s - 4ms/step - loss: 0.1259 - val_loss: 0.4942
Epoch 22/60
94/94 - 0s - 4ms/step - loss: 0.1245 - val_loss: 0.4997
Epoch 23/60
94/94 - 0s - 4ms/step - loss: 0.1237 - val_loss: 0.5027
Epoch 24/60
94/94 - 0s - 4ms/step - loss: 0.1219 - val_loss: 0.5002
Epoch 25/60
94/94 - 0s - 4ms/step - loss: 0.1220 - val_loss: 0.4980
Epoch 26/60
94/94 - 0s - 4ms/step - loss: 0.1200 - val_loss: 0.4974
Epoch 27/60
94/94 - 0s - 4ms/step - loss: 0.1201 - val_loss: 0.4968
Epoch 28/60
94/94 - 0s - 4ms/step - loss: 0.1188 - val_loss: 0.4918
Epoch 29/60
94/94 - 0s - 4ms/step - loss: 0.1180 - val_loss: 0.4897
Epoch 30/60
94/94 - 0s - 4ms/step - loss: 0.1179 - val_loss: 0.4920
Epoch 31/60
94/94 - 0s - 4ms/step - loss: 0.1154 - val_loss: 0.4950
Epoch 32/60
94/94 - 0s - 4ms/step - loss: 0.1153 - val_loss: 0.4918
Epoch 33/60
94/94 - 0s - 4ms/step - loss: 0.1149 - val_loss: 0.4844
Epoch 34/60
94/94 - 0s - 4ms/step - loss: 0.1147 - val_loss: 0.4870
Epoch 35/60
94/94 - 0s - 4ms/step - loss: 0.1138 - val_loss: 0.4941
Epoch 36/60
94/94 - 0s - 4ms/step - loss: 0.1123 - val_loss: 0.4883
Epoch 37/60
94/94 - 0s - 4ms/step - loss: 0.1124 - val_loss: 0.4898
Epoch 38/60
94/94 - 0s - 4ms/step - loss: 0.1118 - val_loss: 0.4813
Epoch 39/60
94/94 - 0s - 4ms/step - loss: 0.1109 - val_loss: 0.4791
Epoch 40/60
94/94 - 0s - 4ms/step - loss: 0.1108 - val_loss: 0.4862
Epoch 41/60
94/94 - 0s - 4ms/step - loss: 0.1098 - val_loss: 0.4758
Epoch 42/60
94/94 - 0s - 4ms/step - loss: 0.1102 - val_loss: 0.4812
Epoch 43/60
94/94 - 0s - 4ms/step - loss: 0.1091 - val_loss: 0.4761
Epoch 44/60
94/94 - 0s - 4ms/step - loss: 0.1089 - val_loss: 0.4777
Epoch 45/60
94/94 - 0s - 4ms/step - loss: 0.1078 - val_loss: 0.4767
Epoch 46/60
94/94 - 0s - 4ms/step - loss: 0.1073 - val_loss: 0.4840
Epoch 47/60
94/94 - 0s - 4ms/step - loss: 0.1066 - val_loss: 0.4788
Epoch 48/60
94/94 - 0s - 4ms/step - loss: 0.1064 - val_loss: 0.4745
Epoch 49/60
94/94 - 0s - 4ms/step - loss: 0.1052 - val_loss: 0.4710
Epoch 50/60
94/94 - 0s - 4ms/step - loss: 0.1062 - val_loss: 0.4694
Epoch 51/60
94/94 - 0s - 4ms/step - loss: 0.1048 - val_loss: 0.4697
Epoch 52/60
94/94 - 0s - 4ms/step - loss: 0.1041 - val_loss: 0.4692
Epoch 53/60
94/94 - 0s - 4ms/step - loss: 0.1039 - val_loss: 0.4666
Epoch 54/60
94/94 - 0s - 4ms/step - loss: 0.1038 - val_loss: 0.4659
Epoch 55/60
94/94 - 0s - 4ms/step - loss: 0.1031 - val_loss: 0.4646
Epoch 56/60
94/94 - 0s - 4ms/step - loss: 0.1019 - val_loss: 0.4620
Epoch 57/60
94/94 - 0s - 4ms/step - loss: 0.1019 - val_loss: 0.4586
Epoch 58/60
94/94 - 0s - 4ms/step - loss: 0.1012 - val_loss: 0.4625
Epoch 59/60
94/94 - 0s - 4ms/step - loss: 0.1005 - val_loss: 0.4621
Epoch 60/60
94/94 - 0s - 4ms/step - loss: 0.0999 - val_loss: 0.4724
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.1608
Per-joint RMSE: 0.8672 1.2902 1.3016 0.6272 0.6726 1.7686
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:48:57.447695: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:48:57.471984: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:48:58.321974: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:58.326663: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:58.327539: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:58.329242: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:58.330109: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:58.330851: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:58.413624: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:58.414550: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:58.415295: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:48:58.416031: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:48:58.711922: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.564175e+00  RMSE=1.250670e+00
  per-joint RMSE: 0.9966 1.3889 1.4121 0.7118 0.7496 1.8440
Residual LSTM:  MSE=1.347430e+00      RMSE=1.160788e+00
  per-joint RMSE: 0.8672 1.2902 1.3016 0.6272 0.6726 1.7686
Combined torque MSE=1.347430e+00     RMSE=1.160788e+00
  per-joint RMSE: 0.8672 1.2902 1.3016 0.6272 0.6726 1.7686
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

