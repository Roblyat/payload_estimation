################################################################################################################
### RUN: K=75 test_fraction=0.2 seed=1                                                                       ###
### npz_in=/workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed1_dataset.npz ###
################################################################################################################

#####################
### 1) PREPROCESS ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_delan_dataset.py --qdd True --col_format wide --trajectory_amount 75 --test_fraction 0.2 --seed 1 --raw_csv /workspace/shared/data/raw/delan_UR3_Load0_combined_26.csv --out_npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed1_dataset.npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Saved: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed1_dataset.npz
Trajectories: train=60 test=15
Exists: True

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=0                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz                                 ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed1_dataset.npz -t structured -s 0 -r 0 --hp_preset fast_debug --epochs 250 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 250, 'lagrangian_type': <function structured_lagrangian_fn at 0x746ee09c41f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed1_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed1_dataset.npz
   dt ≈ 0.02784919441460803
  dof = 6
  Train trajectories = 60
  Test trajectories  = 15
  Train samples = 32291
  Test samples  = 5024
################################################

2026-01-22 06:13:10.425806: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250 | type=structured | dof=6
################################################
2026-01-22 06:13:13.591803: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:13:13.591840: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:13:13.591848: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:13:13.591878: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:13:13.591884: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:13:13.591898: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:13:13.591937: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:13:13.591944: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:13:13.591961: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:13:13.591966: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.0s, Loss=1.19e+01, Inv=1.19e+01, For=2.00e+02, Power=2.02e+00
  [eval] test_mse=5.831e+00  (n=5024)
Epoch 00050: Time=  11.0s, Loss=2.05e+00, Inv=2.05e+00, For=9.75e+01, Power=7.40e-01
Epoch 00100: Time=  15.2s, Loss=1.81e+00, Inv=1.81e+00, For=1.27e+02, Power=6.98e-01
Epoch 00150: Time=  19.3s, Loss=1.69e+00, Inv=1.69e+00, For=1.61e+02, Power=6.86e-01
Epoch 00200: Time=  23.2s, Loss=1.62e+00, Inv=1.62e+00, For=2.14e+02, Power=6.83e-01
  [eval] test_mse=9.283e+00  (n=5024)
Epoch 00250: Time=  27.4s, Loss=1.58e+00, Inv=1.58e+00, For=2.90e+02, Power=6.73e-01
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250
Torque MSE  = 1.837e+00
Torque RMSE = 1.355e+00
Per-joint MSE : 2.584e+00 2.228e+00 7.277e-01 3.226e-01 5.411e-01 4.620e+00
Per-joint RMSE: 1.607e+00 1.493e+00 8.531e-01 5.680e-01 7.356e-01 2.149e+00
Comp Time per Sample = 6.610e-08s / 15129431.5Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed1_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed1_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax
Detected n_dof=6 (seed=0)
2026-01-22 06:13:43.146522: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 60 trajectories
2026-01-22 06:13:44.480697: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:13:44.480711: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:13:46.042131: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:13:46.042144: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:13:47.537230: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/60
2026-01-22 06:13:48.757187: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:13:48.757221: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:13:48.757227: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 50/60
  done 60/60

Exporting split=test: 15 trajectories
  done 15/15

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz --H 25 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.json
H=25, n_dof=6, feature_dim=24
X_train: (31504, 25, 24)  Y_train: (31504, 6)
X_test : (4832, 25, 24)  Y_test : (4832, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:13:51.175540: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:13:51.199214: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (31504, 25, 24), Y_train = (31504, 6)
  X_test  = (4832, 25, 24),  Y_test  = (4832, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:13:52.258173: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:13:52.263066: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:13:52.264093: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:13:52.265895: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:13:52.266811: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:13:52.267690: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:13:52.358567: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:13:52.359457: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:13:52.360346: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:13:52.361131: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8952 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:13:53.308427: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
99/99 - 2s - 16ms/step - loss: 0.3370 - val_loss: 0.4650
Epoch 2/60
99/99 - 0s - 3ms/step - loss: 0.1850 - val_loss: 0.4493
Epoch 3/60
99/99 - 0s - 3ms/step - loss: 0.1655 - val_loss: 0.4411
Epoch 4/60
99/99 - 0s - 3ms/step - loss: 0.1541 - val_loss: 0.4284
Epoch 5/60
99/99 - 0s - 3ms/step - loss: 0.1473 - val_loss: 0.4161
Epoch 6/60
99/99 - 0s - 3ms/step - loss: 0.1410 - val_loss: 0.4078
Epoch 7/60
99/99 - 0s - 3ms/step - loss: 0.1369 - val_loss: 0.3974
Epoch 8/60
99/99 - 0s - 3ms/step - loss: 0.1326 - val_loss: 0.3880
Epoch 9/60
99/99 - 0s - 3ms/step - loss: 0.1298 - val_loss: 0.3852
Epoch 10/60
99/99 - 0s - 3ms/step - loss: 0.1277 - val_loss: 0.3862
Epoch 11/60
99/99 - 0s - 3ms/step - loss: 0.1253 - val_loss: 0.3801
Epoch 12/60
99/99 - 0s - 3ms/step - loss: 0.1227 - val_loss: 0.3736
Epoch 13/60
99/99 - 0s - 3ms/step - loss: 0.1203 - val_loss: 0.3680
Epoch 14/60
99/99 - 0s - 3ms/step - loss: 0.1202 - val_loss: 0.3694
Epoch 15/60
99/99 - 0s - 3ms/step - loss: 0.1186 - val_loss: 0.3696
Epoch 16/60
99/99 - 0s - 3ms/step - loss: 0.1168 - val_loss: 0.3724
Epoch 17/60
99/99 - 0s - 3ms/step - loss: 0.1164 - val_loss: 0.3713
Epoch 18/60
99/99 - 0s - 3ms/step - loss: 0.1151 - val_loss: 0.3729
Epoch 19/60
99/99 - 0s - 3ms/step - loss: 0.1137 - val_loss: 0.3754
Epoch 20/60
99/99 - 0s - 3ms/step - loss: 0.1128 - val_loss: 0.3723
Epoch 21/60
99/99 - 0s - 3ms/step - loss: 0.1108 - val_loss: 0.3726
Epoch 22/60
99/99 - 0s - 3ms/step - loss: 0.1103 - val_loss: 0.3690
Epoch 23/60
99/99 - 0s - 3ms/step - loss: 0.1091 - val_loss: 0.3733
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.2919
Per-joint RMSE: 1.5091 1.3654 0.7846 0.4981 0.7334 2.1144
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:14:01.125862: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:14:01.150350: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:14:02.005055: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:02.009804: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:02.010604: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:02.012215: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:02.013008: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:02.013747: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:02.098974: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:02.099820: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:02.100574: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:02.101308: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:14:02.410006: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.884857e+00  RMSE=1.372901e+00
  per-joint RMSE: 1.6334 1.5065 0.8530 0.5761 0.7476 2.1802
Residual LSTM:  MSE=1.669005e+00      RMSE=1.291900e+00
  per-joint RMSE: 1.5091 1.3654 0.7846 0.4981 0.7334 2.1144
Combined torque MSE=1.669005e+00     RMSE=1.291900e+00
  per-joint RMSE: 1.5091 1.3654 0.7846 0.4981 0.7334 2.1144
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz --H 25 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.json
H=25, n_dof=6, feature_dim=6
X_train: (31504, 25, 6)  Y_train: (31504, 6)
X_test : (4832, 25, 6)  Y_test : (4832, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:14:04.351854: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:14:04.375686: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (31504, 25, 6), Y_train = (31504, 6)
  X_test  = (4832, 25, 6),  Y_test  = (4832, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:14:05.352688: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:05.357221: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:05.358028: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:05.360934: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:05.361803: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:05.362540: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:05.445553: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:05.446476: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:05.447211: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:05.448031: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:14:06.371244: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
99/99 - 2s - 16ms/step - loss: 0.7376 - val_loss: 0.5104
Epoch 2/60
99/99 - 0s - 3ms/step - loss: 0.4273 - val_loss: 0.4995
Epoch 3/60
99/99 - 0s - 3ms/step - loss: 0.3116 - val_loss: 0.5064
Epoch 4/60
99/99 - 0s - 3ms/step - loss: 0.2623 - val_loss: 0.5136
Epoch 5/60
99/99 - 0s - 3ms/step - loss: 0.2377 - val_loss: 0.5346
Epoch 6/60
99/99 - 0s - 3ms/step - loss: 0.2085 - val_loss: 0.5039
Epoch 7/60
99/99 - 0s - 3ms/step - loss: 0.1908 - val_loss: 0.5038
Epoch 8/60
99/99 - 0s - 3ms/step - loss: 0.1842 - val_loss: 0.5063
Epoch 9/60
99/99 - 0s - 3ms/step - loss: 0.1647 - val_loss: 0.4877
Epoch 10/60
99/99 - 0s - 3ms/step - loss: 0.1615 - val_loss: 0.4983
Epoch 11/60
99/99 - 0s - 3ms/step - loss: 0.1526 - val_loss: 0.4950
Epoch 12/60
99/99 - 0s - 3ms/step - loss: 0.1457 - val_loss: 0.4968
Epoch 13/60
99/99 - 0s - 3ms/step - loss: 0.1439 - val_loss: 0.5017
Epoch 14/60
99/99 - 0s - 3ms/step - loss: 0.1420 - val_loss: 0.4896
Epoch 15/60
99/99 - 0s - 3ms/step - loss: 0.1395 - val_loss: 0.4874
Epoch 16/60
99/99 - 0s - 3ms/step - loss: 0.1465 - val_loss: 0.4903
Epoch 17/60
99/99 - 0s - 3ms/step - loss: 0.1429 - val_loss: 0.4895
Epoch 18/60
99/99 - 0s - 3ms/step - loss: 0.1362 - val_loss: 0.4906
Epoch 19/60
99/99 - 0s - 3ms/step - loss: 0.1336 - val_loss: 0.4935
Epoch 20/60
99/99 - 0s - 3ms/step - loss: 0.1290 - val_loss: 0.4882
Epoch 21/60
99/99 - 0s - 3ms/step - loss: 0.1284 - val_loss: 0.4865
Epoch 22/60
99/99 - 0s - 3ms/step - loss: 0.1256 - val_loss: 0.4835
Epoch 23/60
99/99 - 0s - 3ms/step - loss: 0.1366 - val_loss: 0.4933
Epoch 24/60
99/99 - 0s - 3ms/step - loss: 0.1275 - val_loss: 0.4863
Epoch 25/60
99/99 - 0s - 3ms/step - loss: 0.1242 - val_loss: 0.5000
Epoch 26/60
99/99 - 0s - 3ms/step - loss: 0.1257 - val_loss: 0.4836
Epoch 27/60
99/99 - 0s - 3ms/step - loss: 0.1224 - val_loss: 0.4749
Epoch 28/60
99/99 - 0s - 3ms/step - loss: 0.1204 - val_loss: 0.4845
Epoch 29/60
99/99 - 0s - 3ms/step - loss: 0.1214 - val_loss: 0.4756
Epoch 30/60
99/99 - 0s - 3ms/step - loss: 0.1201 - val_loss: 0.4687
Epoch 31/60
99/99 - 0s - 3ms/step - loss: 0.1188 - val_loss: 0.4824
Epoch 32/60
99/99 - 0s - 3ms/step - loss: 0.1202 - val_loss: 0.4810
Epoch 33/60
99/99 - 0s - 3ms/step - loss: 0.1199 - val_loss: 0.4788
Epoch 34/60
99/99 - 0s - 3ms/step - loss: 0.1379 - val_loss: 0.4590
Epoch 35/60
99/99 - 0s - 3ms/step - loss: 0.1285 - val_loss: 0.4665
Epoch 36/60
99/99 - 0s - 3ms/step - loss: 0.1180 - val_loss: 0.4659
Epoch 37/60
99/99 - 0s - 3ms/step - loss: 0.1163 - val_loss: 0.4675
Epoch 38/60
99/99 - 0s - 3ms/step - loss: 0.1149 - val_loss: 0.4655
Epoch 39/60
99/99 - 0s - 3ms/step - loss: 0.1149 - val_loss: 0.4640
Epoch 40/60
99/99 - 0s - 3ms/step - loss: 0.1130 - val_loss: 0.4662
Epoch 41/60
99/99 - 0s - 3ms/step - loss: 0.1167 - val_loss: 0.4646
Epoch 42/60
99/99 - 0s - 3ms/step - loss: 0.1130 - val_loss: 0.4534
Epoch 43/60
99/99 - 0s - 3ms/step - loss: 0.1175 - val_loss: 0.4529
Epoch 44/60
99/99 - 0s - 3ms/step - loss: 0.1135 - val_loss: 0.4670
Epoch 45/60
99/99 - 0s - 3ms/step - loss: 0.1128 - val_loss: 0.4671
Epoch 46/60
99/99 - 0s - 3ms/step - loss: 0.1205 - val_loss: 0.4720
Epoch 47/60
99/99 - 0s - 3ms/step - loss: 0.1128 - val_loss: 0.4682
Epoch 48/60
99/99 - 0s - 3ms/step - loss: 0.1119 - val_loss: 0.4636
Epoch 49/60
99/99 - 0s - 3ms/step - loss: 0.1098 - val_loss: 0.4708
Epoch 50/60
99/99 - 0s - 3ms/step - loss: 0.1102 - val_loss: 0.4620
Epoch 51/60
99/99 - 0s - 3ms/step - loss: 0.1089 - val_loss: 0.4672
Epoch 52/60
99/99 - 0s - 3ms/step - loss: 0.1109 - val_loss: 0.4626
Epoch 53/60
99/99 - 0s - 3ms/step - loss: 0.1073 - val_loss: 0.4683
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.3413
Per-joint RMSE: 1.6125 1.5003 0.7559 0.5360 0.7205 2.1367
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:14:22.132046: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:14:22.156906: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:14:22.992540: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:22.997166: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:22.998112: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:22.999802: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:23.000494: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:23.001235: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:23.077645: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:23.078560: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:23.079307: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:23.080042: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:14:23.373647: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.884857e+00  RMSE=1.372901e+00
  per-joint RMSE: 1.6334 1.5065 0.8530 0.5761 0.7476 2.1802
Residual LSTM:  MSE=1.799017e+00      RMSE=1.341274e+00
  per-joint RMSE: 1.6125 1.5003 0.7559 0.5360 0.7205 2.1367
Combined torque MSE=1.799017e+00     RMSE=1.341274e+00
  per-joint RMSE: 1.6125 1.5003 0.7559 0.5360 0.7205 2.1367
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz --H 25 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (31504, 25, 18)  Y_train: (31504, 6)
X_test : (4832, 25, 18)  Y_test : (4832, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:14:25.377850: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:14:25.401763: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (31504, 25, 18), Y_train = (31504, 6)
  X_test  = (4832, 25, 18),  Y_test  = (4832, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:14:26.450006: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:26.454756: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:26.455708: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:26.457334: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:26.458218: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:26.458958: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:26.537343: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:26.538183: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:26.538928: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:26.539658: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:14:27.518761: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
99/99 - 2s - 17ms/step - loss: 0.3926 - val_loss: 0.4969
Epoch 2/60
99/99 - 0s - 3ms/step - loss: 0.2247 - val_loss: 0.5099
Epoch 3/60
99/99 - 0s - 3ms/step - loss: 0.1971 - val_loss: 0.5291
Epoch 4/60
99/99 - 0s - 3ms/step - loss: 0.1776 - val_loss: 0.5530
Epoch 5/60
99/99 - 0s - 3ms/step - loss: 0.1648 - val_loss: 0.5478
Epoch 6/60
99/99 - 0s - 3ms/step - loss: 0.1585 - val_loss: 0.5519
Epoch 7/60
99/99 - 0s - 3ms/step - loss: 0.1514 - val_loss: 0.5522
Epoch 8/60
99/99 - 0s - 3ms/step - loss: 0.1466 - val_loss: 0.5405
Epoch 9/60
99/99 - 0s - 3ms/step - loss: 0.1435 - val_loss: 0.5283
Epoch 10/60
99/99 - 0s - 3ms/step - loss: 0.1381 - val_loss: 0.5274
Epoch 11/60
99/99 - 0s - 3ms/step - loss: 0.1347 - val_loss: 0.5277
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.3406
Per-joint RMSE: 1.5721 1.4541 0.8113 0.5286 0.7536 2.1660
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:14:32.080919: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:14:32.105188: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:14:32.950848: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:32.955460: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:32.956257: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:32.957904: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:32.958745: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:32.959515: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:33.046667: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:33.047733: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:33.048862: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:33.049719: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:14:33.358738: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.884857e+00  RMSE=1.372901e+00
  per-joint RMSE: 1.6334 1.5065 0.8530 0.5761 0.7476 2.1802
Residual LSTM:  MSE=1.797143e+00      RMSE=1.340576e+00
  per-joint RMSE: 1.5721 1.4541 0.8113 0.5286 0.7536 2.1660
Combined torque MSE=1.797143e+00     RMSE=1.340576e+00
  per-joint RMSE: 1.5721 1.4541 0.8113 0.5286 0.7536 2.1660
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz --H 25 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (31504, 25, 18)  Y_train: (31504, 6)
X_test : (4832, 25, 18)  Y_test : (4832, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:14:35.389532: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:14:35.413139: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (31504, 25, 18), Y_train = (31504, 6)
  X_test  = (4832, 25, 18),  Y_test  = (4832, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:14:36.442635: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:36.447169: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:36.448045: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:36.449692: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:36.450567: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:36.451309: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:36.534904: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:36.535733: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:36.536475: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:36.537204: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:14:37.468999: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
99/99 - 2s - 16ms/step - loss: 0.3543 - val_loss: 0.5029
Epoch 2/60
99/99 - 0s - 3ms/step - loss: 0.1954 - val_loss: 0.4723
Epoch 3/60
99/99 - 0s - 3ms/step - loss: 0.1707 - val_loss: 0.4613
Epoch 4/60
99/99 - 0s - 3ms/step - loss: 0.1588 - val_loss: 0.4590
Epoch 5/60
99/99 - 0s - 3ms/step - loss: 0.1511 - val_loss: 0.4541
Epoch 6/60
99/99 - 0s - 3ms/step - loss: 0.1456 - val_loss: 0.4486
Epoch 7/60
99/99 - 0s - 3ms/step - loss: 0.1396 - val_loss: 0.4339
Epoch 8/60
99/99 - 0s - 3ms/step - loss: 0.1363 - val_loss: 0.4246
Epoch 9/60
99/99 - 0s - 3ms/step - loss: 0.1320 - val_loss: 0.3969
Epoch 10/60
99/99 - 0s - 3ms/step - loss: 0.1299 - val_loss: 0.3943
Epoch 11/60
99/99 - 0s - 3ms/step - loss: 0.1276 - val_loss: 0.3936
Epoch 12/60
99/99 - 0s - 3ms/step - loss: 0.1254 - val_loss: 0.3745
Epoch 13/60
99/99 - 0s - 3ms/step - loss: 0.1229 - val_loss: 0.3714
Epoch 14/60
99/99 - 0s - 3ms/step - loss: 0.1216 - val_loss: 0.3689
Epoch 15/60
99/99 - 0s - 3ms/step - loss: 0.1193 - val_loss: 0.3649
Epoch 16/60
99/99 - 0s - 3ms/step - loss: 0.1188 - val_loss: 0.3692
Epoch 17/60
99/99 - 0s - 3ms/step - loss: 0.1164 - val_loss: 0.3664
Epoch 18/60
99/99 - 0s - 3ms/step - loss: 0.1154 - val_loss: 0.3609
Epoch 19/60
99/99 - 0s - 3ms/step - loss: 0.1141 - val_loss: 0.3602
Epoch 20/60
99/99 - 0s - 3ms/step - loss: 0.1136 - val_loss: 0.3589
Epoch 21/60
99/99 - 0s - 3ms/step - loss: 0.1128 - val_loss: 0.3516
Epoch 22/60
99/99 - 0s - 3ms/step - loss: 0.1110 - val_loss: 0.3551
Epoch 23/60
99/99 - 0s - 3ms/step - loss: 0.1100 - val_loss: 0.3495
Epoch 24/60
99/99 - 0s - 3ms/step - loss: 0.1078 - val_loss: 0.3502
Epoch 25/60
99/99 - 0s - 3ms/step - loss: 0.1078 - val_loss: 0.3522
Epoch 26/60
99/99 - 0s - 3ms/step - loss: 0.1087 - val_loss: 0.3512
Epoch 27/60
99/99 - 0s - 3ms/step - loss: 0.1077 - val_loss: 0.3474
Epoch 28/60
99/99 - 0s - 3ms/step - loss: 0.1066 - val_loss: 0.3478
Epoch 29/60
99/99 - 0s - 3ms/step - loss: 0.1047 - val_loss: 0.3487
Epoch 30/60
99/99 - 0s - 3ms/step - loss: 0.1024 - val_loss: 0.3479
Epoch 31/60
99/99 - 0s - 3ms/step - loss: 0.1022 - val_loss: 0.3513
Epoch 32/60
99/99 - 0s - 3ms/step - loss: 0.1024 - val_loss: 0.3452
Epoch 33/60
99/99 - 0s - 3ms/step - loss: 0.1016 - val_loss: 0.3510
Epoch 34/60
99/99 - 0s - 3ms/step - loss: 0.0993 - val_loss: 0.3524
Epoch 35/60
99/99 - 0s - 3ms/step - loss: 0.0997 - val_loss: 0.3568
Epoch 36/60
99/99 - 0s - 3ms/step - loss: 0.0982 - val_loss: 0.3564
Epoch 37/60
99/99 - 0s - 3ms/step - loss: 0.0974 - val_loss: 0.3572
Epoch 38/60
99/99 - 0s - 3ms/step - loss: 0.0981 - val_loss: 0.3540
Epoch 39/60
99/99 - 0s - 3ms/step - loss: 0.0967 - val_loss: 0.3556
Epoch 40/60
99/99 - 0s - 3ms/step - loss: 0.0961 - val_loss: 0.3560
Epoch 41/60
99/99 - 0s - 3ms/step - loss: 0.0962 - val_loss: 0.3534
Epoch 42/60
99/99 - 0s - 3ms/step - loss: 0.0950 - val_loss: 0.3585
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.2821
Per-joint RMSE: 1.4731 1.3567 0.7723 0.5313 0.7488 2.1006
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:14:50.516314: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:14:50.540533: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:14:51.388221: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:51.392828: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:51.393706: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:51.395509: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:51.396325: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:51.397215: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:51.478960: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:51.479796: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:51.480547: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:51.481275: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:14:51.784416: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.884857e+00  RMSE=1.372901e+00
  per-joint RMSE: 1.6334 1.5065 0.8530 0.5761 0.7476 2.1802
Residual LSTM:  MSE=1.643822e+00      RMSE=1.282116e+00
  per-joint RMSE: 1.4731 1.3567 0.7723 0.5313 0.7488 2.1006
Combined torque MSE=1.643822e+00     RMSE=1.282116e+00
  per-joint RMSE: 1.4731 1.3567 0.7723 0.5313 0.7488 2.1006
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz --H 50 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.json
H=50, n_dof=6, feature_dim=24
X_train: (30779, 50, 24)  Y_train: (30779, 6)
X_test : (4657, 50, 24)  Y_test : (4657, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:14:53.897490: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:14:53.921437: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (30779, 50, 24), Y_train = (30779, 6)
  X_test  = (4657, 50, 24),  Y_test  = (4657, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:14:55.158846: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:55.163673: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:55.164591: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:55.166371: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:55.167281: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:55.168138: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:55.250399: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:55.251280: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:55.252085: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:14:55.252871: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:14:56.369730: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
97/97 - 2s - 18ms/step - loss: 0.3422 - val_loss: 0.5057
Epoch 2/60
97/97 - 0s - 4ms/step - loss: 0.1942 - val_loss: 0.4755
Epoch 3/60
97/97 - 0s - 4ms/step - loss: 0.1720 - val_loss: 0.4569
Epoch 4/60
97/97 - 0s - 4ms/step - loss: 0.1610 - val_loss: 0.4386
Epoch 5/60
97/97 - 0s - 4ms/step - loss: 0.1534 - val_loss: 0.4288
Epoch 6/60
97/97 - 0s - 4ms/step - loss: 0.1466 - val_loss: 0.4226
Epoch 7/60
97/97 - 0s - 4ms/step - loss: 0.1418 - val_loss: 0.4169
Epoch 8/60
97/97 - 0s - 4ms/step - loss: 0.1373 - val_loss: 0.4194
Epoch 9/60
97/97 - 0s - 4ms/step - loss: 0.1349 - val_loss: 0.4180
Epoch 10/60
97/97 - 0s - 4ms/step - loss: 0.1320 - val_loss: 0.4178
Epoch 11/60
97/97 - 0s - 5ms/step - loss: 0.1292 - val_loss: 0.4191
Epoch 12/60
97/97 - 0s - 4ms/step - loss: 0.1275 - val_loss: 0.4138
Epoch 13/60
97/97 - 0s - 4ms/step - loss: 0.1253 - val_loss: 0.4169
Epoch 14/60
97/97 - 0s - 4ms/step - loss: 0.1245 - val_loss: 0.4141
Epoch 15/60
97/97 - 0s - 4ms/step - loss: 0.1217 - val_loss: 0.4183
Epoch 16/60
97/97 - 0s - 4ms/step - loss: 0.1206 - val_loss: 0.4179
Epoch 17/60
97/97 - 0s - 4ms/step - loss: 0.1188 - val_loss: 0.4075
Epoch 18/60
97/97 - 0s - 4ms/step - loss: 0.1179 - val_loss: 0.4140
Epoch 19/60
97/97 - 0s - 4ms/step - loss: 0.1160 - val_loss: 0.4171
Epoch 20/60
97/97 - 0s - 4ms/step - loss: 0.1157 - val_loss: 0.4126
Epoch 21/60
97/97 - 0s - 4ms/step - loss: 0.1149 - val_loss: 0.4110
Epoch 22/60
97/97 - 0s - 4ms/step - loss: 0.1135 - val_loss: 0.4175
Epoch 23/60
97/97 - 0s - 4ms/step - loss: 0.1114 - val_loss: 0.4113
Epoch 24/60
97/97 - 0s - 4ms/step - loss: 0.1107 - val_loss: 0.4160
Epoch 25/60
97/97 - 0s - 4ms/step - loss: 0.1100 - val_loss: 0.4053
Epoch 26/60
97/97 - 0s - 4ms/step - loss: 0.1083 - val_loss: 0.4096
Epoch 27/60
97/97 - 0s - 4ms/step - loss: 0.1086 - val_loss: 0.4115
Epoch 28/60
97/97 - 0s - 4ms/step - loss: 0.1076 - val_loss: 0.4073
Epoch 29/60
97/97 - 0s - 4ms/step - loss: 0.1067 - val_loss: 0.3977
Epoch 30/60
97/97 - 0s - 4ms/step - loss: 0.1055 - val_loss: 0.4049
Epoch 31/60
97/97 - 0s - 4ms/step - loss: 0.1049 - val_loss: 0.3960
Epoch 32/60
97/97 - 0s - 4ms/step - loss: 0.1033 - val_loss: 0.4024
Epoch 33/60
97/97 - 0s - 4ms/step - loss: 0.1026 - val_loss: 0.4002
Epoch 34/60
97/97 - 0s - 4ms/step - loss: 0.1017 - val_loss: 0.4002
Epoch 35/60
97/97 - 0s - 4ms/step - loss: 0.1011 - val_loss: 0.3993
Epoch 36/60
97/97 - 0s - 4ms/step - loss: 0.1003 - val_loss: 0.4009
Epoch 37/60
97/97 - 0s - 4ms/step - loss: 0.1002 - val_loss: 0.3984
Epoch 38/60
97/97 - 0s - 4ms/step - loss: 0.1009 - val_loss: 0.3894
Epoch 39/60
97/97 - 0s - 4ms/step - loss: 0.0981 - val_loss: 0.3900
Epoch 40/60
97/97 - 0s - 4ms/step - loss: 0.0971 - val_loss: 0.3910
Epoch 41/60
97/97 - 0s - 4ms/step - loss: 0.0970 - val_loss: 0.3840
Epoch 42/60
97/97 - 0s - 4ms/step - loss: 0.0965 - val_loss: 0.3939
Epoch 43/60
97/97 - 0s - 4ms/step - loss: 0.0948 - val_loss: 0.3917
Epoch 44/60
97/97 - 0s - 4ms/step - loss: 0.0949 - val_loss: 0.3928
Epoch 45/60
97/97 - 0s - 4ms/step - loss: 0.0949 - val_loss: 0.3966
Epoch 46/60
97/97 - 0s - 4ms/step - loss: 0.0942 - val_loss: 0.3958
Epoch 47/60
97/97 - 0s - 4ms/step - loss: 0.0945 - val_loss: 0.4013
Epoch 48/60
97/97 - 0s - 4ms/step - loss: 0.0928 - val_loss: 0.3960
Epoch 49/60
97/97 - 0s - 4ms/step - loss: 0.0912 - val_loss: 0.3993
Epoch 50/60
97/97 - 0s - 4ms/step - loss: 0.0906 - val_loss: 0.4028
Epoch 51/60
97/97 - 0s - 4ms/step - loss: 0.0903 - val_loss: 0.4039
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.2980
Per-joint RMSE: 1.4999 1.4376 0.7997 0.5127 0.7360 2.0852
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:15:18.324719: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:15:18.349923: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:15:19.197498: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:19.202170: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:19.203034: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:19.204719: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:19.205509: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:19.206243: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:19.282841: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:19.283762: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:19.284503: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:19.285240: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:15:19.593981: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.848504e+00  RMSE=1.359597e+00
  per-joint RMSE: 1.6165 1.5034 0.8436 0.5598 0.7530 2.1508
Residual LSTM:  MSE=1.684722e+00      RMSE=1.297968e+00
  per-joint RMSE: 1.4999 1.4376 0.7997 0.5127 0.7360 2.0852
Combined torque MSE=1.684722e+00     RMSE=1.297968e+00
  per-joint RMSE: 1.4999 1.4376 0.7997 0.5127 0.7360 2.0852
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz --H 50 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.json
H=50, n_dof=6, feature_dim=6
X_train: (30779, 50, 6)  Y_train: (30779, 6)
X_test : (4657, 50, 6)  Y_test : (4657, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:15:21.569986: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:15:21.594120: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (30779, 50, 6), Y_train = (30779, 6)
  X_test  = (4657, 50, 6),  Y_test  = (4657, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:15:22.615725: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:22.620346: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:22.621231: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:22.622881: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:22.623668: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:22.624404: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:22.699598: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:22.700510: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:22.701260: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:22.701997: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:15:23.621705: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
97/97 - 2s - 18ms/step - loss: 0.6758 - val_loss: 0.6201
Epoch 2/60
97/97 - 0s - 4ms/step - loss: 0.3676 - val_loss: 0.6224
Epoch 3/60
97/97 - 0s - 4ms/step - loss: 0.2596 - val_loss: 0.5854
Epoch 4/60
97/97 - 0s - 4ms/step - loss: 0.2226 - val_loss: 0.5897
Epoch 5/60
97/97 - 0s - 4ms/step - loss: 0.1979 - val_loss: 0.5861
Epoch 6/60
97/97 - 0s - 4ms/step - loss: 0.1845 - val_loss: 0.5916
Epoch 7/60
97/97 - 0s - 4ms/step - loss: 0.1737 - val_loss: 0.5845
Epoch 8/60
97/97 - 0s - 4ms/step - loss: 0.1683 - val_loss: 0.5969
Epoch 9/60
97/97 - 0s - 4ms/step - loss: 0.1677 - val_loss: 0.5774
Epoch 10/60
97/97 - 0s - 4ms/step - loss: 0.1568 - val_loss: 0.5746
Epoch 11/60
97/97 - 0s - 5ms/step - loss: 0.1548 - val_loss: 0.5730
Epoch 12/60
97/97 - 0s - 4ms/step - loss: 0.1486 - val_loss: 0.5881
Epoch 13/60
97/97 - 0s - 4ms/step - loss: 0.1488 - val_loss: 0.5974
Epoch 14/60
97/97 - 0s - 4ms/step - loss: 0.1508 - val_loss: 0.5656
Epoch 15/60
97/97 - 0s - 4ms/step - loss: 0.1471 - val_loss: 0.5695
Epoch 16/60
97/97 - 0s - 4ms/step - loss: 0.1411 - val_loss: 0.5936
Epoch 17/60
97/97 - 0s - 4ms/step - loss: 0.1393 - val_loss: 0.5787
Epoch 18/60
97/97 - 0s - 4ms/step - loss: 0.1373 - val_loss: 0.5915
Epoch 19/60
97/97 - 0s - 4ms/step - loss: 0.1369 - val_loss: 0.5972
Epoch 20/60
97/97 - 0s - 4ms/step - loss: 0.1390 - val_loss: 0.5822
Epoch 21/60
97/97 - 0s - 4ms/step - loss: 0.1358 - val_loss: 0.5893
Epoch 22/60
97/97 - 0s - 4ms/step - loss: 0.1327 - val_loss: 0.5882
Epoch 23/60
97/97 - 0s - 4ms/step - loss: 0.1334 - val_loss: 0.5854
Epoch 24/60
97/97 - 0s - 4ms/step - loss: 0.1319 - val_loss: 0.5892
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.3218
Per-joint RMSE: 1.5796 1.4139 0.7407 0.5184 0.7607 2.1429
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:15:34.543931: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:15:34.568508: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:15:35.414815: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:35.419375: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:35.420217: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:35.421892: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:35.422742: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:35.423527: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:35.507015: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:35.507899: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:35.508756: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:35.509578: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:15:35.812867: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.848504e+00  RMSE=1.359597e+00
  per-joint RMSE: 1.6165 1.5034 0.8436 0.5598 0.7530 2.1508
Residual LSTM:  MSE=1.747028e+00      RMSE=1.321752e+00
  per-joint RMSE: 1.5796 1.4139 0.7407 0.5184 0.7607 2.1429
Combined torque MSE=1.747028e+00     RMSE=1.321752e+00
  per-joint RMSE: 1.5796 1.4139 0.7407 0.5184 0.7607 2.1429
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz --H 50 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (30779, 50, 18)  Y_train: (30779, 6)
X_test : (4657, 50, 18)  Y_test : (4657, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:15:37.939847: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:15:37.963709: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (30779, 50, 18), Y_train = (30779, 6)
  X_test  = (4657, 50, 18),  Y_test  = (4657, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:15:39.097380: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:39.101926: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:39.102725: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:39.104449: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:39.105233: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:39.105971: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:39.188282: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:39.189122: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:39.189866: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:15:39.190598: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:15:40.181356: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
97/97 - 2s - 18ms/step - loss: 0.3839 - val_loss: 0.5658
Epoch 2/60
97/97 - 0s - 4ms/step - loss: 0.2277 - val_loss: 0.5851
Epoch 3/60
97/97 - 0s - 4ms/step - loss: 0.2041 - val_loss: 0.6296
Epoch 4/60
97/97 - 0s - 4ms/step - loss: 0.1846 - val_loss: 0.6153
Epoch 5/60
97/97 - 0s - 4ms/step - loss: 0.1719 - val_loss: 0.6134
Epoch 6/60
97/97 - 0s - 4ms/step - loss: 0.1630 - val_loss: 0.5915
Epoch 7/60
97/97 - 0s - 4ms/step - loss: 0.1567 - val_loss: 0.5797
Epoch 8/60
97/97 - 0s - 4ms/step - loss: 0.1532 - val_loss: 0.5628
Epoch 9/60
97/97 - 0s - 4ms/step - loss: 0.1475 - val_loss: 0.5725
Epoch 10/60
97/97 - 0s - 4ms/step - loss: 0.1441 - val_loss: 0.5664
Epoch 11/60
97/97 - 0s - 4ms/step - loss: 0.1403 - val_loss: 0.5603
Epoch 12/60
97/97 - 0s - 5ms/step - loss: 0.1369 - val_loss: 0.5609
Epoch 13/60
97/97 - 0s - 4ms/step - loss: 0.1351 - val_loss: 0.5609
Epoch 14/60
97/97 - 0s - 4ms/step - loss: 0.1331 - val_loss: 0.5504
Epoch 15/60
97/97 - 0s - 4ms/step - loss: 0.1313 - val_loss: 0.5561
Epoch 16/60
97/97 - 0s - 4ms/step - loss: 0.1285 - val_loss: 0.5472
Epoch 17/60
97/97 - 0s - 4ms/step - loss: 0.1269 - val_loss: 0.5527
Epoch 18/60
97/97 - 0s - 4ms/step - loss: 0.1256 - val_loss: 0.5440
Epoch 19/60
97/97 - 0s - 4ms/step - loss: 0.1248 - val_loss: 0.5445
Epoch 20/60
97/97 - 0s - 4ms/step - loss: 0.1231 - val_loss: 0.5502
Epoch 21/60
97/97 - 0s - 4ms/step - loss: 0.1215 - val_loss: 0.5435
Epoch 22/60
97/97 - 0s - 4ms/step - loss: 0.1198 - val_loss: 0.5507
Epoch 23/60
97/97 - 0s - 4ms/step - loss: 0.1184 - val_loss: 0.5465
Epoch 24/60
97/97 - 0s - 4ms/step - loss: 0.1170 - val_loss: 0.5478
Epoch 25/60
97/97 - 0s - 4ms/step - loss: 0.1163 - val_loss: 0.5507
Epoch 26/60
97/97 - 0s - 4ms/step - loss: 0.1165 - val_loss: 0.5455
Epoch 27/60
97/97 - 0s - 4ms/step - loss: 0.1150 - val_loss: 0.5409
Epoch 28/60
97/97 - 0s - 4ms/step - loss: 0.1133 - val_loss: 0.5491
Epoch 29/60
97/97 - 0s - 4ms/step - loss: 0.1137 - val_loss: 0.5413
Epoch 30/60
97/97 - 0s - 4ms/step - loss: 0.1108 - val_loss: 0.5482
Epoch 31/60
97/97 - 0s - 4ms/step - loss: 0.1113 - val_loss: 0.5481
Epoch 32/60
97/97 - 0s - 4ms/step - loss: 0.1101 - val_loss: 0.5393
Epoch 33/60
97/97 - 0s - 4ms/step - loss: 0.1093 - val_loss: 0.5379
Epoch 34/60
97/97 - 0s - 4ms/step - loss: 0.1087 - val_loss: 0.5452
Epoch 35/60
97/97 - 0s - 4ms/step - loss: 0.1078 - val_loss: 0.5388
Epoch 36/60
97/97 - 0s - 4ms/step - loss: 0.1075 - val_loss: 0.5465
Epoch 37/60
97/97 - 0s - 4ms/step - loss: 0.1063 - val_loss: 0.5379
Epoch 38/60
97/97 - 0s - 4ms/step - loss: 0.1057 - val_loss: 0.5449
Epoch 39/60
97/97 - 0s - 4ms/step - loss: 0.1047 - val_loss: 0.5542
Epoch 40/60
97/97 - 0s - 4ms/step - loss: 0.1041 - val_loss: 0.5396
Epoch 41/60
97/97 - 0s - 4ms/step - loss: 0.1039 - val_loss: 0.5449
Epoch 42/60
97/97 - 0s - 4ms/step - loss: 0.1031 - val_loss: 0.5538
Epoch 43/60
97/97 - 0s - 4ms/step - loss: 0.1020 - val_loss: 0.5550
Epoch 44/60
97/97 - 0s - 4ms/step - loss: 0.1019 - val_loss: 0.5492
Epoch 45/60
97/97 - 0s - 4ms/step - loss: 0.1016 - val_loss: 0.5557
Epoch 46/60
97/97 - 0s - 4ms/step - loss: 0.1010 - val_loss: 0.5569
Epoch 47/60
97/97 - 0s - 4ms/step - loss: 0.1002 - val_loss: 0.5491
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.3249
Per-joint RMSE: 1.5474 1.4278 0.8047 0.5106 0.8010 2.1328
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:16:00.481487: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:16:00.506288: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:16:01.351715: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:01.356397: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:01.357189: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:01.358869: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:01.359658: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:01.360393: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:01.441150: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:01.441989: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:01.442826: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:01.443553: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:16:01.748130: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.848504e+00  RMSE=1.359597e+00
  per-joint RMSE: 1.6165 1.5034 0.8436 0.5598 0.7530 2.1508
Residual LSTM:  MSE=1.755284e+00      RMSE=1.324871e+00
  per-joint RMSE: 1.5474 1.4278 0.8047 0.5106 0.8010 2.1328
Combined torque MSE=1.755284e+00     RMSE=1.324871e+00
  per-joint RMSE: 1.5474 1.4278 0.8047 0.5106 0.8010 2.1328
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz --H 50 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (30779, 50, 18)  Y_train: (30779, 6)
X_test : (4657, 50, 18)  Y_test : (4657, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:16:03.846956: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:16:03.870494: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (30779, 50, 18), Y_train = (30779, 6)
  X_test  = (4657, 50, 18),  Y_test  = (4657, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:16:04.997006: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:05.001812: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:05.002753: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:05.004380: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:05.005289: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:05.006153: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:05.088822: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:05.089802: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:05.090597: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:05.091378: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:16:06.095838: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
97/97 - 2s - 18ms/step - loss: 0.3468 - val_loss: 0.5570
Epoch 2/60
97/97 - 0s - 4ms/step - loss: 0.1984 - val_loss: 0.5899
Epoch 3/60
97/97 - 0s - 4ms/step - loss: 0.1738 - val_loss: 0.6010
Epoch 4/60
97/97 - 0s - 4ms/step - loss: 0.1615 - val_loss: 0.5650
Epoch 5/60
97/97 - 0s - 4ms/step - loss: 0.1541 - val_loss: 0.5352
Epoch 6/60
97/97 - 0s - 4ms/step - loss: 0.1473 - val_loss: 0.5367
Epoch 7/60
97/97 - 0s - 4ms/step - loss: 0.1428 - val_loss: 0.5162
Epoch 8/60
97/97 - 0s - 4ms/step - loss: 0.1387 - val_loss: 0.4933
Epoch 9/60
97/97 - 0s - 4ms/step - loss: 0.1357 - val_loss: 0.4846
Epoch 10/60
97/97 - 0s - 4ms/step - loss: 0.1329 - val_loss: 0.4852
Epoch 11/60
97/97 - 0s - 5ms/step - loss: 0.1316 - val_loss: 0.4746
Epoch 12/60
97/97 - 0s - 4ms/step - loss: 0.1299 - val_loss: 0.4731
Epoch 13/60
97/97 - 0s - 4ms/step - loss: 0.1266 - val_loss: 0.4701
Epoch 14/60
97/97 - 0s - 4ms/step - loss: 0.1243 - val_loss: 0.4562
Epoch 15/60
97/97 - 0s - 4ms/step - loss: 0.1232 - val_loss: 0.4590
Epoch 16/60
97/97 - 0s - 4ms/step - loss: 0.1211 - val_loss: 0.4651
Epoch 17/60
97/97 - 0s - 4ms/step - loss: 0.1201 - val_loss: 0.4590
Epoch 18/60
97/97 - 0s - 4ms/step - loss: 0.1193 - val_loss: 0.4588
Epoch 19/60
97/97 - 0s - 4ms/step - loss: 0.1172 - val_loss: 0.4557
Epoch 20/60
97/97 - 0s - 4ms/step - loss: 0.1164 - val_loss: 0.4513
Epoch 21/60
97/97 - 0s - 4ms/step - loss: 0.1149 - val_loss: 0.4546
Epoch 22/60
97/97 - 0s - 4ms/step - loss: 0.1137 - val_loss: 0.4495
Epoch 23/60
97/97 - 0s - 4ms/step - loss: 0.1136 - val_loss: 0.4535
Epoch 24/60
97/97 - 0s - 4ms/step - loss: 0.1116 - val_loss: 0.4455
Epoch 25/60
97/97 - 0s - 4ms/step - loss: 0.1110 - val_loss: 0.4422
Epoch 26/60
97/97 - 0s - 4ms/step - loss: 0.1096 - val_loss: 0.4440
Epoch 27/60
97/97 - 0s - 4ms/step - loss: 0.1085 - val_loss: 0.4421
Epoch 28/60
97/97 - 0s - 4ms/step - loss: 0.1077 - val_loss: 0.4368
Epoch 29/60
97/97 - 0s - 4ms/step - loss: 0.1071 - val_loss: 0.4444
Epoch 30/60
97/97 - 0s - 4ms/step - loss: 0.1059 - val_loss: 0.4396
Epoch 31/60
97/97 - 0s - 4ms/step - loss: 0.1049 - val_loss: 0.4377
Epoch 32/60
97/97 - 0s - 4ms/step - loss: 0.1043 - val_loss: 0.4342
Epoch 33/60
97/97 - 0s - 4ms/step - loss: 0.1036 - val_loss: 0.4347
Epoch 34/60
97/97 - 0s - 4ms/step - loss: 0.1030 - val_loss: 0.4363
Epoch 35/60
97/97 - 0s - 4ms/step - loss: 0.1032 - val_loss: 0.4298
Epoch 36/60
97/97 - 0s - 4ms/step - loss: 0.1010 - val_loss: 0.4398
Epoch 37/60
97/97 - 0s - 4ms/step - loss: 0.1001 - val_loss: 0.4330
Epoch 38/60
97/97 - 0s - 4ms/step - loss: 0.1002 - val_loss: 0.4367
Epoch 39/60
97/97 - 0s - 4ms/step - loss: 0.0988 - val_loss: 0.4309
Epoch 40/60
97/97 - 0s - 4ms/step - loss: 0.0995 - val_loss: 0.4370
Epoch 41/60
97/97 - 0s - 4ms/step - loss: 0.0978 - val_loss: 0.4332
Epoch 42/60
97/97 - 0s - 4ms/step - loss: 0.0975 - val_loss: 0.4359
Epoch 43/60
97/97 - 0s - 4ms/step - loss: 0.0963 - val_loss: 0.4404
Epoch 44/60
97/97 - 0s - 4ms/step - loss: 0.0962 - val_loss: 0.4285
Epoch 45/60
97/97 - 0s - 4ms/step - loss: 0.0948 - val_loss: 0.4319
Epoch 46/60
97/97 - 0s - 4ms/step - loss: 0.0949 - val_loss: 0.4226
Epoch 47/60
97/97 - 0s - 4ms/step - loss: 0.0937 - val_loss: 0.4284
Epoch 48/60
97/97 - 0s - 4ms/step - loss: 0.0935 - val_loss: 0.4295
Epoch 49/60
97/97 - 0s - 4ms/step - loss: 0.0932 - val_loss: 0.4310
Epoch 50/60
97/97 - 0s - 4ms/step - loss: 0.0920 - val_loss: 0.4269
Epoch 51/60
97/97 - 0s - 4ms/step - loss: 0.0922 - val_loss: 0.4270
Epoch 52/60
97/97 - 0s - 4ms/step - loss: 0.0907 - val_loss: 0.4275
Epoch 53/60
97/97 - 0s - 4ms/step - loss: 0.0909 - val_loss: 0.4264
Epoch 54/60
97/97 - 0s - 4ms/step - loss: 0.0899 - val_loss: 0.4137
Epoch 55/60
97/97 - 0s - 4ms/step - loss: 0.0900 - val_loss: 0.4288
Epoch 56/60
97/97 - 0s - 4ms/step - loss: 0.0890 - val_loss: 0.4298
Epoch 57/60
97/97 - 0s - 4ms/step - loss: 0.0894 - val_loss: 0.4177
Epoch 58/60
97/97 - 0s - 4ms/step - loss: 0.0879 - val_loss: 0.4189
Epoch 59/60
97/97 - 0s - 4ms/step - loss: 0.0875 - val_loss: 0.4206
Epoch 60/60
97/97 - 0s - 4ms/step - loss: 0.0866 - val_loss: 0.4102
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.2930
Per-joint RMSE: 1.4733 1.4999 0.7326 0.4910 0.7244 2.0755
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:16:31.582275: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:16:31.607000: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:16:32.456459: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:32.461003: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:32.461953: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:32.463606: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:32.464395: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:32.465123: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:32.546086: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:32.546922: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:32.547670: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:16:32.548409: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8950 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:16:32.861763: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.848504e+00  RMSE=1.359597e+00
  per-joint RMSE: 1.6165 1.5034 0.8436 0.5598 0.7530 2.1508
Residual LSTM:  MSE=1.671762e+00      RMSE=1.292966e+00
  per-joint RMSE: 1.4733 1.4999 0.7326 0.4910 0.7244 2.0755
Combined torque MSE=1.671762e+00     RMSE=1.292966e+00
  per-joint RMSE: 1.4733 1.4999 0.7326 0.4910 0.7244 2.0755
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=1                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz                                 ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed1_dataset.npz -t structured -s 1 -r 0 --hp_preset fast_debug --epochs 250 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 250, 'lagrangian_type': <function structured_lagrangian_fn at 0x7924667541f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed1_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed1_dataset.npz
   dt ≈ 0.02784919441460803
  dof = 6
  Train trajectories = 60
  Test trajectories  = 15
  Train samples = 32291
  Test samples  = 5024
################################################

2026-01-22 06:16:37.224457: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250 | type=structured | dof=6
################################################
2026-01-22 06:16:40.376538: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:16:40.376583: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:16:40.376589: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:16:40.376616: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:16:40.376621: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:16:40.376636: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:16:40.376672: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:16:40.376678: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:16:40.376693: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:16:40.376698: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.0s, Loss=1.60e+01, Inv=1.60e+01, For=2.13e+02, Power=2.23e+00
  [eval] test_mse=2.548e+00  (n=5024)
Epoch 00050: Time=  10.5s, Loss=2.15e+00, Inv=2.15e+00, For=9.38e+01, Power=7.57e-01
Epoch 00100: Time=  14.8s, Loss=1.83e+00, Inv=1.83e+00, For=1.18e+02, Power=7.00e-01
Epoch 00150: Time=  19.3s, Loss=1.70e+00, Inv=1.70e+00, For=1.36e+02, Power=6.82e-01
Epoch 00200: Time=  23.2s, Loss=1.61e+00, Inv=1.61e+00, For=1.61e+02, Power=6.71e-01
  [eval] test_mse=6.651e+00  (n=5024)
Epoch 00250: Time=  27.5s, Loss=1.56e+00, Inv=1.56e+00, For=1.86e+02, Power=6.60e-01
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250
Torque MSE  = 1.190e+00
Torque RMSE = 1.091e+00
Per-joint MSE : 1.440e+00 1.218e+00 6.161e-01 2.649e+00 5.357e-01 6.788e-01
Per-joint RMSE: 1.200e+00 1.104e+00 7.849e-01 1.628e+00 7.319e-01 8.239e-01
Comp Time per Sample = 5.723e-08s / 17474296.2Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed1_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed1_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax
Detected n_dof=6 (seed=1)
2026-01-22 06:17:09.957634: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 60 trajectories
2026-01-22 06:17:11.290490: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:17:11.290505: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:17:12.800873: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:17:12.800886: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:17:14.299668: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/60
2026-01-22 06:17:15.401984: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:17:15.402018: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:17:15.402024: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 50/60
  done 60/60

Exporting split=test: 15 trajectories
  done 15/15

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz --H 25 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.json
H=25, n_dof=6, feature_dim=24
X_train: (31504, 25, 24)  Y_train: (31504, 6)
X_test : (4832, 25, 24)  Y_test : (4832, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:17:17.951786: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:17:17.976016: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (31504, 25, 24), Y_train = (31504, 6)
  X_test  = (4832, 25, 24),  Y_test  = (4832, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:17:19.035960: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:19.040657: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:19.041590: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:19.043236: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:19.044255: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:19.045133: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:19.125775: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:19.126687: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:19.127549: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:19.128337: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8951 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:17:20.114932: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
99/99 - 2s - 16ms/step - loss: 0.3408 - val_loss: 0.4494
Epoch 2/60
99/99 - 0s - 3ms/step - loss: 0.1920 - val_loss: 0.4299
Epoch 3/60
99/99 - 0s - 3ms/step - loss: 0.1712 - val_loss: 0.4263
Epoch 4/60
99/99 - 0s - 3ms/step - loss: 0.1597 - val_loss: 0.4265
Epoch 5/60
99/99 - 0s - 3ms/step - loss: 0.1501 - val_loss: 0.4200
Epoch 6/60
99/99 - 0s - 3ms/step - loss: 0.1454 - val_loss: 0.4075
Epoch 7/60
99/99 - 0s - 3ms/step - loss: 0.1391 - val_loss: 0.4098
Epoch 8/60
99/99 - 0s - 3ms/step - loss: 0.1364 - val_loss: 0.3964
Epoch 9/60
99/99 - 0s - 3ms/step - loss: 0.1328 - val_loss: 0.3927
Epoch 10/60
99/99 - 0s - 3ms/step - loss: 0.1303 - val_loss: 0.3924
Epoch 11/60
99/99 - 0s - 3ms/step - loss: 0.1275 - val_loss: 0.3907
Epoch 12/60
99/99 - 0s - 3ms/step - loss: 0.1262 - val_loss: 0.3818
Epoch 13/60
99/99 - 0s - 3ms/step - loss: 0.1229 - val_loss: 0.3847
Epoch 14/60
99/99 - 0s - 3ms/step - loss: 0.1214 - val_loss: 0.3787
Epoch 15/60
99/99 - 0s - 3ms/step - loss: 0.1192 - val_loss: 0.3786
Epoch 16/60
99/99 - 0s - 3ms/step - loss: 0.1177 - val_loss: 0.3769
Epoch 17/60
99/99 - 0s - 3ms/step - loss: 0.1168 - val_loss: 0.3778
Epoch 18/60
99/99 - 0s - 3ms/step - loss: 0.1152 - val_loss: 0.3771
Epoch 19/60
99/99 - 0s - 3ms/step - loss: 0.1145 - val_loss: 0.3759
Epoch 20/60
99/99 - 0s - 3ms/step - loss: 0.1137 - val_loss: 0.3765
Epoch 21/60
99/99 - 0s - 3ms/step - loss: 0.1111 - val_loss: 0.3766
Epoch 22/60
99/99 - 0s - 3ms/step - loss: 0.1109 - val_loss: 0.3730
Epoch 23/60
99/99 - 0s - 3ms/step - loss: 0.1098 - val_loss: 0.3718
Epoch 24/60
99/99 - 0s - 3ms/step - loss: 0.1091 - val_loss: 0.3715
Epoch 25/60
99/99 - 0s - 3ms/step - loss: 0.1078 - val_loss: 0.3697
Epoch 26/60
99/99 - 0s - 3ms/step - loss: 0.1084 - val_loss: 0.3681
Epoch 27/60
99/99 - 0s - 3ms/step - loss: 0.1066 - val_loss: 0.3679
Epoch 28/60
99/99 - 0s - 3ms/step - loss: 0.1048 - val_loss: 0.3680
Epoch 29/60
99/99 - 0s - 3ms/step - loss: 0.1053 - val_loss: 0.3636
Epoch 30/60
99/99 - 0s - 3ms/step - loss: 0.1039 - val_loss: 0.3659
Epoch 31/60
99/99 - 0s - 3ms/step - loss: 0.1020 - val_loss: 0.3698
Epoch 32/60
99/99 - 0s - 3ms/step - loss: 0.1014 - val_loss: 0.3681
Epoch 33/60
99/99 - 0s - 3ms/step - loss: 0.1014 - val_loss: 0.3779
Epoch 34/60
99/99 - 0s - 3ms/step - loss: 0.1002 - val_loss: 0.3722
Epoch 35/60
99/99 - 0s - 3ms/step - loss: 0.1005 - val_loss: 0.3692
Epoch 36/60
99/99 - 0s - 3ms/step - loss: 0.1007 - val_loss: 0.3738
Epoch 37/60
99/99 - 0s - 3ms/step - loss: 0.0992 - val_loss: 0.3750
Epoch 38/60
99/99 - 0s - 3ms/step - loss: 0.0981 - val_loss: 0.3700
Epoch 39/60
99/99 - 0s - 3ms/step - loss: 0.0974 - val_loss: 0.3721
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.0113
Per-joint RMSE: 1.0876 0.9983 0.7291 1.5330 0.6618 0.7984
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:17:32.482260: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:17:32.507085: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:17:33.361169: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:33.365847: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:33.366729: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:33.368369: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:33.369164: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:33.369901: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:33.450687: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:33.451525: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:33.452266: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:33.453009: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:17:33.764838: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.199634e+00  RMSE=1.095278e+00
  per-joint RMSE: 1.2006 1.0890 0.7910 1.6446 0.7391 0.8329
Residual LSTM:  MSE=1.022791e+00      RMSE=1.011331e+00
  per-joint RMSE: 1.0876 0.9983 0.7291 1.5330 0.6618 0.7984
Combined torque MSE=1.022791e+00     RMSE=1.011331e+00
  per-joint RMSE: 1.0876 0.9983 0.7291 1.5330 0.6618 0.7984
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz --H 25 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.json
H=25, n_dof=6, feature_dim=6
X_train: (31504, 25, 6)  Y_train: (31504, 6)
X_test : (4832, 25, 6)  Y_test : (4832, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:17:35.753474: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:17:35.777211: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (31504, 25, 6), Y_train = (31504, 6)
  X_test  = (4832, 25, 6),  Y_test  = (4832, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:17:36.760993: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:36.765484: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:36.766348: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:36.767944: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:36.768736: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:36.769481: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:36.848231: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:36.849147: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:36.849901: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:36.850868: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:17:37.763039: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
99/99 - 2s - 16ms/step - loss: 0.7455 - val_loss: 0.5233
Epoch 2/60
99/99 - 0s - 3ms/step - loss: 0.4383 - val_loss: 0.4955
Epoch 3/60
99/99 - 0s - 3ms/step - loss: 0.3211 - val_loss: 0.4888
Epoch 4/60
99/99 - 0s - 3ms/step - loss: 0.2734 - val_loss: 0.4894
Epoch 5/60
99/99 - 0s - 3ms/step - loss: 0.2392 - val_loss: 0.4929
Epoch 6/60
99/99 - 0s - 3ms/step - loss: 0.2137 - val_loss: 0.4894
Epoch 7/60
99/99 - 0s - 3ms/step - loss: 0.1936 - val_loss: 0.4824
Epoch 8/60
99/99 - 0s - 3ms/step - loss: 0.1771 - val_loss: 0.4745
Epoch 9/60
99/99 - 0s - 3ms/step - loss: 0.1647 - val_loss: 0.4719
Epoch 10/60
99/99 - 0s - 3ms/step - loss: 0.1690 - val_loss: 0.4707
Epoch 11/60
99/99 - 0s - 3ms/step - loss: 0.1520 - val_loss: 0.4634
Epoch 12/60
99/99 - 0s - 3ms/step - loss: 0.1491 - val_loss: 0.4630
Epoch 13/60
99/99 - 0s - 3ms/step - loss: 0.1458 - val_loss: 0.4648
Epoch 14/60
99/99 - 0s - 3ms/step - loss: 0.1453 - val_loss: 0.4580
Epoch 15/60
99/99 - 0s - 3ms/step - loss: 0.1389 - val_loss: 0.4589
Epoch 16/60
99/99 - 0s - 3ms/step - loss: 0.1415 - val_loss: 0.4560
Epoch 17/60
99/99 - 0s - 3ms/step - loss: 0.1362 - val_loss: 0.4575
Epoch 18/60
99/99 - 0s - 3ms/step - loss: 0.1364 - val_loss: 0.4562
Epoch 19/60
99/99 - 0s - 3ms/step - loss: 0.1329 - val_loss: 0.4557
Epoch 20/60
99/99 - 0s - 3ms/step - loss: 0.1319 - val_loss: 0.4532
Epoch 21/60
99/99 - 0s - 3ms/step - loss: 0.1310 - val_loss: 0.4453
Epoch 22/60
99/99 - 0s - 3ms/step - loss: 0.1285 - val_loss: 0.4502
Epoch 23/60
99/99 - 0s - 3ms/step - loss: 0.1279 - val_loss: 0.4439
Epoch 24/60
99/99 - 0s - 3ms/step - loss: 0.1274 - val_loss: 0.4490
Epoch 25/60
99/99 - 0s - 3ms/step - loss: 0.1289 - val_loss: 0.4465
Epoch 26/60
99/99 - 0s - 3ms/step - loss: 0.1249 - val_loss: 0.4456
Epoch 27/60
99/99 - 0s - 3ms/step - loss: 0.1229 - val_loss: 0.4498
Epoch 28/60
99/99 - 0s - 3ms/step - loss: 0.1229 - val_loss: 0.4471
Epoch 29/60
99/99 - 0s - 3ms/step - loss: 0.1241 - val_loss: 0.4452
Epoch 30/60
99/99 - 0s - 3ms/step - loss: 0.1265 - val_loss: 0.4443
Epoch 31/60
99/99 - 0s - 3ms/step - loss: 0.1268 - val_loss: 0.4372
Epoch 32/60
99/99 - 0s - 3ms/step - loss: 0.1203 - val_loss: 0.4470
Epoch 33/60
99/99 - 0s - 3ms/step - loss: 0.1192 - val_loss: 0.4483
Epoch 34/60
99/99 - 0s - 3ms/step - loss: 0.1189 - val_loss: 0.4445
Epoch 35/60
99/99 - 0s - 3ms/step - loss: 0.1179 - val_loss: 0.4479
Epoch 36/60
99/99 - 0s - 3ms/step - loss: 0.1151 - val_loss: 0.4399
Epoch 37/60
99/99 - 0s - 3ms/step - loss: 0.1157 - val_loss: 0.4416
Epoch 38/60
99/99 - 0s - 3ms/step - loss: 0.1163 - val_loss: 0.4434
Epoch 39/60
99/99 - 0s - 3ms/step - loss: 0.1152 - val_loss: 0.4393
Epoch 40/60
99/99 - 0s - 3ms/step - loss: 0.1280 - val_loss: 0.4492
Epoch 41/60
99/99 - 0s - 3ms/step - loss: 0.1145 - val_loss: 0.4406
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.0392
Per-joint RMSE: 1.1248 1.0592 0.7159 1.5769 0.6853 0.7896
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:17:50.204731: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:17:50.229429: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:17:51.081927: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:51.086621: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:51.087415: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:51.089196: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:51.089980: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:51.090718: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:51.173157: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:51.174071: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:51.174812: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:51.175607: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:17:51.472828: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.199634e+00  RMSE=1.095278e+00
  per-joint RMSE: 1.2006 1.0890 0.7910 1.6446 0.7391 0.8329
Residual LSTM:  MSE=1.079863e+00      RMSE=1.039164e+00
  per-joint RMSE: 1.1248 1.0592 0.7159 1.5769 0.6853 0.7896
Combined torque MSE=1.079863e+00     RMSE=1.039164e+00
  per-joint RMSE: 1.1248 1.0592 0.7159 1.5769 0.6853 0.7896
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz --H 25 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (31504, 25, 18)  Y_train: (31504, 6)
X_test : (4832, 25, 18)  Y_test : (4832, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:17:53.463809: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:17:53.487541: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (31504, 25, 18), Y_train = (31504, 6)
  X_test  = (4832, 25, 18),  Y_test  = (4832, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:17:54.527153: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:54.531561: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:54.532358: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:54.533911: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:54.534694: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:54.535433: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:54.613244: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:54.614080: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:54.614918: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:17:54.615656: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:17:55.563649: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
99/99 - 2s - 17ms/step - loss: 0.3889 - val_loss: 0.4937
Epoch 2/60
99/99 - 0s - 3ms/step - loss: 0.2326 - val_loss: 0.5004
Epoch 3/60
99/99 - 0s - 3ms/step - loss: 0.2041 - val_loss: 0.5363
Epoch 4/60
99/99 - 0s - 3ms/step - loss: 0.1868 - val_loss: 0.5445
Epoch 5/60
99/99 - 0s - 3ms/step - loss: 0.1738 - val_loss: 0.5525
Epoch 6/60
99/99 - 0s - 3ms/step - loss: 0.1647 - val_loss: 0.5458
Epoch 7/60
99/99 - 0s - 3ms/step - loss: 0.1576 - val_loss: 0.5300
Epoch 8/60
99/99 - 0s - 3ms/step - loss: 0.1527 - val_loss: 0.5123
Epoch 9/60
99/99 - 0s - 3ms/step - loss: 0.1483 - val_loss: 0.5110
Epoch 10/60
99/99 - 0s - 3ms/step - loss: 0.1434 - val_loss: 0.5001
Epoch 11/60
99/99 - 0s - 3ms/step - loss: 0.1404 - val_loss: 0.5014
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.0474
Per-joint RMSE: 1.1322 0.9889 0.7337 1.6240 0.7139 0.7983
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:18:00.126864: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:18:00.151777: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:18:00.988566: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:00.993142: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:00.993930: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:00.995765: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:00.996576: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:00.997376: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:01.080343: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:01.081435: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:01.082338: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:01.083145: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:18:01.392091: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.199634e+00  RMSE=1.095278e+00
  per-joint RMSE: 1.2006 1.0890 0.7910 1.6446 0.7391 0.8329
Residual LSTM:  MSE=1.097068e+00      RMSE=1.047410e+00
  per-joint RMSE: 1.1322 0.9889 0.7337 1.6240 0.7139 0.7983
Combined torque MSE=1.097068e+00     RMSE=1.047410e+00
  per-joint RMSE: 1.1322 0.9889 0.7337 1.6240 0.7139 0.7983
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz --H 25 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (31504, 25, 18)  Y_train: (31504, 6)
X_test : (4832, 25, 18)  Y_test : (4832, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:18:03.429241: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:18:03.453291: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (31504, 25, 18), Y_train = (31504, 6)
  X_test  = (4832, 25, 18),  Y_test  = (4832, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:18:04.494824: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:04.499255: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:04.500131: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:04.501769: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:04.502552: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:04.503656: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:04.587350: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:04.588184: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:04.589006: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:04.589820: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:18:05.514635: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
99/99 - 2s - 16ms/step - loss: 0.3534 - val_loss: 0.4710
Epoch 2/60
99/99 - 0s - 3ms/step - loss: 0.1996 - val_loss: 0.4781
Epoch 3/60
99/99 - 0s - 3ms/step - loss: 0.1738 - val_loss: 0.4767
Epoch 4/60
99/99 - 0s - 3ms/step - loss: 0.1609 - val_loss: 0.4757
Epoch 5/60
99/99 - 0s - 3ms/step - loss: 0.1527 - val_loss: 0.4645
Epoch 6/60
99/99 - 0s - 3ms/step - loss: 0.1456 - val_loss: 0.4472
Epoch 7/60
99/99 - 0s - 3ms/step - loss: 0.1415 - val_loss: 0.4342
Epoch 8/60
99/99 - 0s - 3ms/step - loss: 0.1381 - val_loss: 0.4197
Epoch 9/60
99/99 - 0s - 3ms/step - loss: 0.1350 - val_loss: 0.4149
Epoch 10/60
99/99 - 0s - 3ms/step - loss: 0.1304 - val_loss: 0.4118
Epoch 11/60
99/99 - 0s - 3ms/step - loss: 0.1285 - val_loss: 0.4077
Epoch 12/60
99/99 - 0s - 3ms/step - loss: 0.1264 - val_loss: 0.4066
Epoch 13/60
99/99 - 0s - 3ms/step - loss: 0.1239 - val_loss: 0.3920
Epoch 14/60
99/99 - 0s - 3ms/step - loss: 0.1215 - val_loss: 0.3958
Epoch 15/60
99/99 - 0s - 3ms/step - loss: 0.1204 - val_loss: 0.3855
Epoch 16/60
99/99 - 0s - 3ms/step - loss: 0.1188 - val_loss: 0.3855
Epoch 17/60
99/99 - 0s - 3ms/step - loss: 0.1170 - val_loss: 0.3837
Epoch 18/60
99/99 - 0s - 3ms/step - loss: 0.1168 - val_loss: 0.3844
Epoch 19/60
99/99 - 0s - 3ms/step - loss: 0.1143 - val_loss: 0.3821
Epoch 20/60
99/99 - 0s - 3ms/step - loss: 0.1125 - val_loss: 0.3797
Epoch 21/60
99/99 - 0s - 3ms/step - loss: 0.1116 - val_loss: 0.3795
Epoch 22/60
99/99 - 0s - 3ms/step - loss: 0.1109 - val_loss: 0.3778
Epoch 23/60
99/99 - 0s - 3ms/step - loss: 0.1089 - val_loss: 0.3869
Epoch 24/60
99/99 - 0s - 3ms/step - loss: 0.1098 - val_loss: 0.3860
Epoch 25/60
99/99 - 0s - 3ms/step - loss: 0.1086 - val_loss: 0.3824
Epoch 26/60
99/99 - 0s - 3ms/step - loss: 0.1067 - val_loss: 0.3791
Epoch 27/60
99/99 - 0s - 3ms/step - loss: 0.1067 - val_loss: 0.3797
Epoch 28/60
99/99 - 0s - 3ms/step - loss: 0.1059 - val_loss: 0.3787
Epoch 29/60
99/99 - 0s - 3ms/step - loss: 0.1041 - val_loss: 0.3844
Epoch 30/60
99/99 - 0s - 3ms/step - loss: 0.1036 - val_loss: 0.3764
Epoch 31/60
99/99 - 0s - 3ms/step - loss: 0.1032 - val_loss: 0.3744
Epoch 32/60
99/99 - 0s - 3ms/step - loss: 0.1026 - val_loss: 0.3775
Epoch 33/60
99/99 - 0s - 3ms/step - loss: 0.1009 - val_loss: 0.3845
Epoch 34/60
99/99 - 0s - 3ms/step - loss: 0.1005 - val_loss: 0.3743
Epoch 35/60
99/99 - 0s - 3ms/step - loss: 0.0984 - val_loss: 0.3764
Epoch 36/60
99/99 - 0s - 3ms/step - loss: 0.0990 - val_loss: 0.3795
Epoch 37/60
99/99 - 0s - 3ms/step - loss: 0.0980 - val_loss: 0.3712
Epoch 38/60
99/99 - 0s - 3ms/step - loss: 0.0970 - val_loss: 0.3697
Epoch 39/60
99/99 - 0s - 3ms/step - loss: 0.0955 - val_loss: 0.3772
Epoch 40/60
99/99 - 0s - 3ms/step - loss: 0.0952 - val_loss: 0.3741
Epoch 41/60
99/99 - 0s - 3ms/step - loss: 0.0948 - val_loss: 0.3790
Epoch 42/60
99/99 - 0s - 3ms/step - loss: 0.0942 - val_loss: 0.3779
Epoch 43/60
99/99 - 0s - 3ms/step - loss: 0.0926 - val_loss: 0.3804
Epoch 44/60
99/99 - 0s - 3ms/step - loss: 0.0926 - val_loss: 0.3697
Epoch 45/60
99/99 - 0s - 3ms/step - loss: 0.0916 - val_loss: 0.3853
Epoch 46/60
99/99 - 0s - 3ms/step - loss: 0.0906 - val_loss: 0.3808
Epoch 47/60
99/99 - 0s - 3ms/step - loss: 0.0899 - val_loss: 0.3804
Epoch 48/60
99/99 - 0s - 3ms/step - loss: 0.0892 - val_loss: 0.3831
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.0285
Per-joint RMSE: 1.1283 1.0571 0.7050 1.5405 0.6681 0.8000
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:18:20.010670: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:18:20.035237: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:18:20.879695: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:20.884349: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:20.885224: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:20.887033: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:20.887830: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:20.888562: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:20.973644: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:20.974484: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:20.975225: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:20.975955: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:18:21.281008: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.199634e+00  RMSE=1.095278e+00
  per-joint RMSE: 1.2006 1.0890 0.7910 1.6446 0.7391 0.8329
Residual LSTM:  MSE=1.057836e+00      RMSE=1.028512e+00
  per-joint RMSE: 1.1283 1.0571 0.7050 1.5405 0.6681 0.8000
Combined torque MSE=1.057836e+00     RMSE=1.028512e+00
  per-joint RMSE: 1.1283 1.0571 0.7050 1.5405 0.6681 0.8000
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz --H 50 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.json
H=50, n_dof=6, feature_dim=24
X_train: (30779, 50, 24)  Y_train: (30779, 6)
X_test : (4657, 50, 24)  Y_test : (4657, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:18:23.378362: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:18:23.402828: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (30779, 50, 24), Y_train = (30779, 6)
  X_test  = (4657, 50, 24),  Y_test  = (4657, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:18:24.580228: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:24.584852: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:24.585778: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:24.587493: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:24.588408: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:24.589273: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:24.673473: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:24.674452: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:24.675255: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:24.676043: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:18:25.687698: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
97/97 - 2s - 18ms/step - loss: 0.3526 - val_loss: 0.5590
Epoch 2/60
97/97 - 0s - 4ms/step - loss: 0.2003 - val_loss: 0.5398
Epoch 3/60
97/97 - 0s - 4ms/step - loss: 0.1771 - val_loss: 0.5247
Epoch 4/60
97/97 - 0s - 4ms/step - loss: 0.1655 - val_loss: 0.4993
Epoch 5/60
97/97 - 0s - 4ms/step - loss: 0.1564 - val_loss: 0.4953
Epoch 6/60
97/97 - 0s - 4ms/step - loss: 0.1496 - val_loss: 0.4796
Epoch 7/60
97/97 - 0s - 4ms/step - loss: 0.1444 - val_loss: 0.4606
Epoch 8/60
97/97 - 0s - 4ms/step - loss: 0.1405 - val_loss: 0.4512
Epoch 9/60
97/97 - 0s - 4ms/step - loss: 0.1368 - val_loss: 0.4452
Epoch 10/60
97/97 - 0s - 4ms/step - loss: 0.1350 - val_loss: 0.4316
Epoch 11/60
97/97 - 0s - 5ms/step - loss: 0.1307 - val_loss: 0.4285
Epoch 12/60
97/97 - 0s - 4ms/step - loss: 0.1294 - val_loss: 0.4206
Epoch 13/60
97/97 - 0s - 4ms/step - loss: 0.1269 - val_loss: 0.4152
Epoch 14/60
97/97 - 0s - 4ms/step - loss: 0.1253 - val_loss: 0.4048
Epoch 15/60
97/97 - 0s - 4ms/step - loss: 0.1229 - val_loss: 0.4064
Epoch 16/60
97/97 - 0s - 4ms/step - loss: 0.1218 - val_loss: 0.4056
Epoch 17/60
97/97 - 0s - 4ms/step - loss: 0.1207 - val_loss: 0.4056
Epoch 18/60
97/97 - 0s - 4ms/step - loss: 0.1185 - val_loss: 0.3962
Epoch 19/60
97/97 - 0s - 4ms/step - loss: 0.1185 - val_loss: 0.3961
Epoch 20/60
97/97 - 0s - 4ms/step - loss: 0.1162 - val_loss: 0.3934
Epoch 21/60
97/97 - 0s - 4ms/step - loss: 0.1158 - val_loss: 0.3937
Epoch 22/60
97/97 - 0s - 4ms/step - loss: 0.1145 - val_loss: 0.3899
Epoch 23/60
97/97 - 0s - 4ms/step - loss: 0.1128 - val_loss: 0.3911
Epoch 24/60
97/97 - 0s - 4ms/step - loss: 0.1110 - val_loss: 0.3881
Epoch 25/60
97/97 - 0s - 4ms/step - loss: 0.1104 - val_loss: 0.3847
Epoch 26/60
97/97 - 0s - 4ms/step - loss: 0.1098 - val_loss: 0.3851
Epoch 27/60
97/97 - 0s - 4ms/step - loss: 0.1082 - val_loss: 0.3844
Epoch 28/60
97/97 - 0s - 4ms/step - loss: 0.1077 - val_loss: 0.3812
Epoch 29/60
97/97 - 0s - 4ms/step - loss: 0.1069 - val_loss: 0.3800
Epoch 30/60
97/97 - 0s - 4ms/step - loss: 0.1065 - val_loss: 0.3796
Epoch 31/60
97/97 - 0s - 4ms/step - loss: 0.1053 - val_loss: 0.3826
Epoch 32/60
97/97 - 0s - 4ms/step - loss: 0.1043 - val_loss: 0.3838
Epoch 33/60
97/97 - 0s - 4ms/step - loss: 0.1028 - val_loss: 0.3823
Epoch 34/60
97/97 - 0s - 4ms/step - loss: 0.1020 - val_loss: 0.3816
Epoch 35/60
97/97 - 0s - 4ms/step - loss: 0.1019 - val_loss: 0.3804
Epoch 36/60
97/97 - 0s - 4ms/step - loss: 0.1012 - val_loss: 0.3842
Epoch 37/60
97/97 - 0s - 4ms/step - loss: 0.1012 - val_loss: 0.3844
Epoch 38/60
97/97 - 0s - 4ms/step - loss: 0.0986 - val_loss: 0.3812
Epoch 39/60
97/97 - 0s - 4ms/step - loss: 0.0986 - val_loss: 0.3801
Epoch 40/60
97/97 - 0s - 4ms/step - loss: 0.0985 - val_loss: 0.3855
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.0251
Per-joint RMSE: 1.1279 1.0147 0.7367 1.5486 0.6560 0.7955
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:18:43.274526: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:18:43.298852: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:18:44.151731: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:44.156903: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:44.157775: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:44.159688: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:44.160480: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:44.161230: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:44.238684: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:44.239605: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:44.240420: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:44.241244: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:18:44.552150: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.177459e+00  RMSE=1.085108e+00
  per-joint RMSE: 1.1952 1.0898 0.7719 1.6253 0.7152 0.8366
Residual LSTM:  MSE=1.050930e+00      RMSE=1.025149e+00
  per-joint RMSE: 1.1279 1.0147 0.7367 1.5486 0.6560 0.7955
Combined torque MSE=1.050930e+00     RMSE=1.025149e+00
  per-joint RMSE: 1.1279 1.0147 0.7367 1.5486 0.6560 0.7955
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz --H 50 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.json
H=50, n_dof=6, feature_dim=6
X_train: (30779, 50, 6)  Y_train: (30779, 6)
X_test : (4657, 50, 6)  Y_test : (4657, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:18:46.557031: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:18:46.581104: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (30779, 50, 6), Y_train = (30779, 6)
  X_test  = (4657, 50, 6),  Y_test  = (4657, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:18:47.611115: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:47.615878: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:47.616668: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:47.618264: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:47.619047: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:47.619778: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:47.696923: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:47.697842: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:47.698590: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:18:47.699322: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:18:48.630615: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
97/97 - 2s - 18ms/step - loss: 0.6779 - val_loss: 0.5996
Epoch 2/60
97/97 - 0s - 4ms/step - loss: 0.3708 - val_loss: 0.5624
Epoch 3/60
97/97 - 0s - 4ms/step - loss: 0.2696 - val_loss: 0.5184
Epoch 4/60
97/97 - 0s - 4ms/step - loss: 0.2198 - val_loss: 0.5250
Epoch 5/60
97/97 - 0s - 4ms/step - loss: 0.1939 - val_loss: 0.5049
Epoch 6/60
97/97 - 0s - 4ms/step - loss: 0.1808 - val_loss: 0.5111
Epoch 7/60
97/97 - 0s - 4ms/step - loss: 0.1796 - val_loss: 0.5081
Epoch 8/60
97/97 - 0s - 4ms/step - loss: 0.1687 - val_loss: 0.4952
Epoch 9/60
97/97 - 0s - 4ms/step - loss: 0.1651 - val_loss: 0.5034
Epoch 10/60
97/97 - 0s - 4ms/step - loss: 0.1589 - val_loss: 0.5115
Epoch 11/60
97/97 - 0s - 4ms/step - loss: 0.1540 - val_loss: 0.4985
Epoch 12/60
97/97 - 0s - 5ms/step - loss: 0.1504 - val_loss: 0.4940
Epoch 13/60
97/97 - 0s - 4ms/step - loss: 0.1492 - val_loss: 0.4982
Epoch 14/60
97/97 - 0s - 4ms/step - loss: 0.1464 - val_loss: 0.4871
Epoch 15/60
97/97 - 0s - 4ms/step - loss: 0.1442 - val_loss: 0.4849
Epoch 16/60
97/97 - 0s - 4ms/step - loss: 0.1431 - val_loss: 0.4876
Epoch 17/60
97/97 - 0s - 4ms/step - loss: 0.1444 - val_loss: 0.4894
Epoch 18/60
97/97 - 0s - 4ms/step - loss: 0.1420 - val_loss: 0.4885
Epoch 19/60
97/97 - 0s - 4ms/step - loss: 0.1380 - val_loss: 0.4985
Epoch 20/60
97/97 - 0s - 4ms/step - loss: 0.1381 - val_loss: 0.4987
Epoch 21/60
97/97 - 0s - 4ms/step - loss: 0.1352 - val_loss: 0.4942
Epoch 22/60
97/97 - 0s - 4ms/step - loss: 0.1333 - val_loss: 0.4999
Epoch 23/60
97/97 - 0s - 4ms/step - loss: 0.1335 - val_loss: 0.4987
Epoch 24/60
97/97 - 0s - 4ms/step - loss: 0.1336 - val_loss: 0.4901
Epoch 25/60
97/97 - 0s - 4ms/step - loss: 0.1309 - val_loss: 0.4917
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.0652
Per-joint RMSE: 1.1874 0.9984 0.7569 1.6249 0.7172 0.8207
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:18:59.886176: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:18:59.910948: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:19:00.760506: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:00.765085: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:00.765876: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:00.767554: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:00.768345: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:00.769093: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:00.852282: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:00.853118: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:00.853950: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:00.854745: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:19:01.155248: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.177459e+00  RMSE=1.085108e+00
  per-joint RMSE: 1.1952 1.0898 0.7719 1.6253 0.7152 0.8366
Residual LSTM:  MSE=1.134641e+00      RMSE=1.065195e+00
  per-joint RMSE: 1.1874 0.9984 0.7569 1.6249 0.7172 0.8207
Combined torque MSE=1.134641e+00     RMSE=1.065195e+00
  per-joint RMSE: 1.1874 0.9984 0.7569 1.6249 0.7172 0.8207
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz --H 50 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (30779, 50, 18)  Y_train: (30779, 6)
X_test : (4657, 50, 18)  Y_test : (4657, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:19:03.272410: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:19:03.296008: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (30779, 50, 18), Y_train = (30779, 6)
  X_test  = (4657, 50, 18),  Y_test  = (4657, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:19:04.429992: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:04.434601: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:04.435474: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:04.436960: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:04.437831: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:04.438564: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:04.520134: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:04.521056: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:04.521813: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:04.522538: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:19:05.493364: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
97/97 - 2s - 18ms/step - loss: 0.3868 - val_loss: 0.5616
Epoch 2/60
97/97 - 0s - 4ms/step - loss: 0.2367 - val_loss: 0.5714
Epoch 3/60
97/97 - 0s - 4ms/step - loss: 0.2108 - val_loss: 0.6232
Epoch 4/60
97/97 - 0s - 4ms/step - loss: 0.1922 - val_loss: 0.6240
Epoch 5/60
97/97 - 0s - 4ms/step - loss: 0.1791 - val_loss: 0.6023
Epoch 6/60
97/97 - 0s - 4ms/step - loss: 0.1702 - val_loss: 0.6048
Epoch 7/60
97/97 - 0s - 4ms/step - loss: 0.1629 - val_loss: 0.5991
Epoch 8/60
97/97 - 0s - 4ms/step - loss: 0.1579 - val_loss: 0.6045
Epoch 9/60
97/97 - 0s - 4ms/step - loss: 0.1521 - val_loss: 0.5989
Epoch 10/60
97/97 - 0s - 4ms/step - loss: 0.1494 - val_loss: 0.5853
Epoch 11/60
97/97 - 0s - 4ms/step - loss: 0.1451 - val_loss: 0.5696
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.0406
Per-joint RMSE: 1.1224 1.0158 0.7202 1.6109 0.6790 0.7945
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:19:11.424095: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:19:11.449156: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:19:12.307250: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:12.311906: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:12.312701: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:12.314386: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:12.315166: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:12.315898: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:12.397593: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:12.398429: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:12.399177: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:12.399897: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:19:12.709172: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.177459e+00  RMSE=1.085108e+00
  per-joint RMSE: 1.1952 1.0898 0.7719 1.6253 0.7152 0.8366
Residual LSTM:  MSE=1.082932e+00      RMSE=1.040640e+00
  per-joint RMSE: 1.1224 1.0158 0.7202 1.6109 0.6790 0.7945
Combined torque MSE=1.082932e+00     RMSE=1.040640e+00
  per-joint RMSE: 1.1224 1.0158 0.7202 1.6109 0.6790 0.7945
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz --H 50 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (30779, 50, 18)  Y_train: (30779, 6)
X_test : (4657, 50, 18)  Y_test : (4657, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:19:14.814340: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:19:14.837981: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (30779, 50, 18), Y_train = (30779, 6)
  X_test  = (4657, 50, 18),  Y_test  = (4657, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:19:15.971242: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:15.975886: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:15.976792: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:15.978416: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:15.979412: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:15.980155: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:16.064361: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:16.065254: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:16.066062: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:16.066943: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:19:17.068208: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
97/97 - 2s - 18ms/step - loss: 0.3497 - val_loss: 0.4813
Epoch 2/60
97/97 - 0s - 4ms/step - loss: 0.2013 - val_loss: 0.4971
Epoch 3/60
97/97 - 0s - 4ms/step - loss: 0.1786 - val_loss: 0.4932
Epoch 4/60
97/97 - 0s - 4ms/step - loss: 0.1660 - val_loss: 0.4743
Epoch 5/60
97/97 - 0s - 4ms/step - loss: 0.1578 - val_loss: 0.4699
Epoch 6/60
97/97 - 0s - 4ms/step - loss: 0.1507 - val_loss: 0.4630
Epoch 7/60
97/97 - 0s - 4ms/step - loss: 0.1463 - val_loss: 0.4537
Epoch 8/60
97/97 - 0s - 4ms/step - loss: 0.1416 - val_loss: 0.4483
Epoch 9/60
97/97 - 0s - 4ms/step - loss: 0.1375 - val_loss: 0.4440
Epoch 10/60
97/97 - 0s - 4ms/step - loss: 0.1343 - val_loss: 0.4416
Epoch 11/60
97/97 - 0s - 5ms/step - loss: 0.1331 - val_loss: 0.4389
Epoch 12/60
97/97 - 0s - 4ms/step - loss: 0.1308 - val_loss: 0.4378
Epoch 13/60
97/97 - 0s - 4ms/step - loss: 0.1284 - val_loss: 0.4333
Epoch 14/60
97/97 - 0s - 4ms/step - loss: 0.1262 - val_loss: 0.4316
Epoch 15/60
97/97 - 0s - 4ms/step - loss: 0.1251 - val_loss: 0.4245
Epoch 16/60
97/97 - 0s - 4ms/step - loss: 0.1230 - val_loss: 0.4260
Epoch 17/60
97/97 - 0s - 4ms/step - loss: 0.1208 - val_loss: 0.4253
Epoch 18/60
97/97 - 0s - 4ms/step - loss: 0.1196 - val_loss: 0.4319
Epoch 19/60
97/97 - 0s - 4ms/step - loss: 0.1181 - val_loss: 0.4284
Epoch 20/60
97/97 - 0s - 4ms/step - loss: 0.1168 - val_loss: 0.4296
Epoch 21/60
97/97 - 0s - 4ms/step - loss: 0.1156 - val_loss: 0.4281
Epoch 22/60
97/97 - 0s - 4ms/step - loss: 0.1147 - val_loss: 0.4298
Epoch 23/60
97/97 - 0s - 4ms/step - loss: 0.1129 - val_loss: 0.4322
Epoch 24/60
97/97 - 0s - 4ms/step - loss: 0.1123 - val_loss: 0.4332
Epoch 25/60
97/97 - 0s - 4ms/step - loss: 0.1106 - val_loss: 0.4413
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.0048
Per-joint RMSE: 1.0648 0.9737 0.7138 1.5517 0.6528 0.7955
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:19:28.709308: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:19:28.733388: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:19:29.574434: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:29.579588: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:29.580520: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:29.582428: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:29.583388: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:29.584177: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:29.657127: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:29.658046: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:29.658789: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:19:29.659516: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:19:29.961068: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.177459e+00  RMSE=1.085108e+00
  per-joint RMSE: 1.1952 1.0898 0.7719 1.6253 0.7152 0.8366
Residual LSTM:  MSE=1.009696e+00      RMSE=1.004836e+00
  per-joint RMSE: 1.0648 0.9737 0.7138 1.5517 0.6528 0.7955
Combined torque MSE=1.009696e+00     RMSE=1.004836e+00
  per-joint RMSE: 1.0648 0.9737 0.7138 1.5517 0.6528 0.7955
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=2                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz                                 ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed1_dataset.npz -t structured -s 2 -r 0 --hp_preset fast_debug --epochs 250 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 250, 'lagrangian_type': <function structured_lagrangian_fn at 0x77cc20a2c1f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed1_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed1_dataset.npz
   dt ≈ 0.02784919441460803
  dof = 6
  Train trajectories = 60
  Test trajectories  = 15
  Train samples = 32291
  Test samples  = 5024
################################################

2026-01-22 06:19:34.280014: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250 | type=structured | dof=6
################################################
2026-01-22 06:19:37.432808: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:19:37.432845: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:19:37.432851: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:19:37.432880: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:19:37.432886: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:19:37.432901: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:19:37.432939: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:19:37.432944: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:19:37.432961: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:19:37.432965: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.0s, Loss=1.12e+01, Inv=1.12e+01, For=1.71e+02, Power=2.73e+00
  [eval] test_mse=4.064e+00  (n=5024)
Epoch 00050: Time=  10.6s, Loss=2.05e+00, Inv=2.05e+00, For=9.44e+01, Power=7.49e-01
Epoch 00100: Time=  14.6s, Loss=1.82e+00, Inv=1.82e+00, For=1.31e+02, Power=7.00e-01
Epoch 00150: Time=  18.7s, Loss=1.69e+00, Inv=1.69e+00, For=1.77e+02, Power=6.81e-01
Epoch 00200: Time=  23.0s, Loss=1.62e+00, Inv=1.62e+00, For=2.26e+02, Power=6.63e-01
  [eval] test_mse=7.694e+00  (n=5024)
Epoch 00250: Time=  27.7s, Loss=1.56e+00, Inv=1.56e+00, For=2.58e+02, Power=6.50e-01
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250
Torque MSE  = 1.535e+00
Torque RMSE = 1.239e+00
Per-joint MSE : 5.093e-01 2.002e+00 8.955e-01 1.853e-01 6.137e-01 5.001e+00
Per-joint RMSE: 7.137e-01 1.415e+00 9.463e-01 4.305e-01 7.834e-01 2.236e+00
Comp Time per Sample = 6.539e-08s / 15291990.5Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed1_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed1_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax
Detected n_dof=6 (seed=2)
2026-01-22 06:20:07.254728: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 60 trajectories
2026-01-22 06:20:08.579517: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:20:08.579531: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:20:10.139362: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:20:10.139374: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:20:11.694726: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/60
2026-01-22 06:20:12.902959: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:20:12.902998: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:20:12.903005: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 50/60
  done 60/60

Exporting split=test: 15 trajectories
  done 15/15

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz --H 25 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.json
H=25, n_dof=6, feature_dim=24
X_train: (31504, 25, 24)  Y_train: (31504, 6)
X_test : (4832, 25, 24)  Y_test : (4832, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:20:15.525964: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:20:15.550197: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (31504, 25, 24), Y_train = (31504, 6)
  X_test  = (4832, 25, 24),  Y_test  = (4832, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:20:16.604932: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:16.609751: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:16.610684: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:16.612463: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:16.613387: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:16.614263: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:16.700630: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:16.701617: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:16.702415: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:16.703205: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8951 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:20:17.683465: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
99/99 - 2s - 17ms/step - loss: 0.3423 - val_loss: 0.4492
Epoch 2/60
99/99 - 0s - 3ms/step - loss: 0.1918 - val_loss: 0.4107
Epoch 3/60
99/99 - 0s - 3ms/step - loss: 0.1700 - val_loss: 0.4078
Epoch 4/60
99/99 - 0s - 3ms/step - loss: 0.1573 - val_loss: 0.4016
Epoch 5/60
99/99 - 0s - 3ms/step - loss: 0.1474 - val_loss: 0.3981
Epoch 6/60
99/99 - 0s - 3ms/step - loss: 0.1432 - val_loss: 0.3930
Epoch 7/60
99/99 - 0s - 3ms/step - loss: 0.1379 - val_loss: 0.3923
Epoch 8/60
99/99 - 0s - 3ms/step - loss: 0.1334 - val_loss: 0.3825
Epoch 9/60
99/99 - 0s - 3ms/step - loss: 0.1322 - val_loss: 0.3860
Epoch 10/60
99/99 - 0s - 3ms/step - loss: 0.1291 - val_loss: 0.3791
Epoch 11/60
99/99 - 0s - 3ms/step - loss: 0.1273 - val_loss: 0.3816
Epoch 12/60
99/99 - 0s - 3ms/step - loss: 0.1258 - val_loss: 0.3708
Epoch 13/60
99/99 - 0s - 3ms/step - loss: 0.1238 - val_loss: 0.3670
Epoch 14/60
99/99 - 0s - 3ms/step - loss: 0.1229 - val_loss: 0.3747
Epoch 15/60
99/99 - 0s - 3ms/step - loss: 0.1214 - val_loss: 0.3682
Epoch 16/60
99/99 - 0s - 3ms/step - loss: 0.1198 - val_loss: 0.3707
Epoch 17/60
99/99 - 0s - 3ms/step - loss: 0.1181 - val_loss: 0.3677
Epoch 18/60
99/99 - 0s - 3ms/step - loss: 0.1164 - val_loss: 0.3690
Epoch 19/60
99/99 - 0s - 3ms/step - loss: 0.1153 - val_loss: 0.3658
Epoch 20/60
99/99 - 0s - 3ms/step - loss: 0.1143 - val_loss: 0.3645
Epoch 21/60
99/99 - 0s - 3ms/step - loss: 0.1131 - val_loss: 0.3699
Epoch 22/60
99/99 - 0s - 3ms/step - loss: 0.1118 - val_loss: 0.3699
Epoch 23/60
99/99 - 0s - 3ms/step - loss: 0.1119 - val_loss: 0.3659
Epoch 24/60
99/99 - 0s - 3ms/step - loss: 0.1095 - val_loss: 0.3688
Epoch 25/60
99/99 - 0s - 3ms/step - loss: 0.1095 - val_loss: 0.3701
Epoch 26/60
99/99 - 0s - 3ms/step - loss: 0.1086 - val_loss: 0.3717
Epoch 27/60
99/99 - 0s - 3ms/step - loss: 0.1068 - val_loss: 0.3760
Epoch 28/60
99/99 - 0s - 3ms/step - loss: 0.1071 - val_loss: 0.3785
Epoch 29/60
99/99 - 0s - 3ms/step - loss: 0.1076 - val_loss: 0.3750
Epoch 30/60
99/99 - 0s - 3ms/step - loss: 0.1041 - val_loss: 0.3748
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.1687
Per-joint RMSE: 0.5858 1.2374 0.8692 0.3254 0.7730 2.2051
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:20:27.474252: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:20:27.499499: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:20:28.353314: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:28.358010: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:28.358792: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:28.360472: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:28.361265: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:28.361999: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:28.442657: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:28.443489: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:28.444224: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:28.444949: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:20:28.748858: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.571482e+00  RMSE=1.253587e+00
  per-joint RMSE: 0.7187 1.4312 0.9474 0.4355 0.7903 2.2698
Residual LSTM:  MSE=1.365950e+00      RMSE=1.168739e+00
  per-joint RMSE: 0.5858 1.2374 0.8692 0.3254 0.7730 2.2051
Combined torque MSE=1.365950e+00     RMSE=1.168739e+00
  per-joint RMSE: 0.5858 1.2374 0.8692 0.3254 0.7730 2.2051
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz --H 25 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.json
H=25, n_dof=6, feature_dim=6
X_train: (31504, 25, 6)  Y_train: (31504, 6)
X_test : (4832, 25, 6)  Y_test : (4832, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:20:30.677055: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:20:30.701163: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (31504, 25, 6), Y_train = (31504, 6)
  X_test  = (4832, 25, 6),  Y_test  = (4832, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:20:31.677329: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:31.681828: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:31.682617: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:31.684162: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:31.684948: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:31.685677: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:31.757886: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:31.758725: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:31.759474: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:31.760210: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:20:32.700970: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
99/99 - 2s - 16ms/step - loss: 0.7421 - val_loss: 0.5162
Epoch 2/60
99/99 - 0s - 3ms/step - loss: 0.4258 - val_loss: 0.4745
Epoch 3/60
99/99 - 0s - 3ms/step - loss: 0.3117 - val_loss: 0.4790
Epoch 4/60
99/99 - 0s - 3ms/step - loss: 0.2650 - val_loss: 0.4556
Epoch 5/60
99/99 - 0s - 3ms/step - loss: 0.2355 - val_loss: 0.4503
Epoch 6/60
99/99 - 0s - 3ms/step - loss: 0.2089 - val_loss: 0.4626
Epoch 7/60
99/99 - 0s - 3ms/step - loss: 0.1843 - val_loss: 0.4679
Epoch 8/60
99/99 - 0s - 3ms/step - loss: 0.1746 - val_loss: 0.4693
Epoch 9/60
99/99 - 0s - 3ms/step - loss: 0.1631 - val_loss: 0.4737
Epoch 10/60
99/99 - 0s - 3ms/step - loss: 0.1607 - val_loss: 0.4677
Epoch 11/60
99/99 - 0s - 3ms/step - loss: 0.1525 - val_loss: 0.4704
Epoch 12/60
99/99 - 0s - 3ms/step - loss: 0.1507 - val_loss: 0.4744
Epoch 13/60
99/99 - 0s - 3ms/step - loss: 0.1489 - val_loss: 0.4686
Epoch 14/60
99/99 - 0s - 3ms/step - loss: 0.1450 - val_loss: 0.4680
Epoch 15/60
99/99 - 0s - 3ms/step - loss: 0.1400 - val_loss: 0.4686
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.1835
Per-joint RMSE: 0.6217 1.3031 0.8765 0.3748 0.7467 2.2030
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:20:38.278370: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:20:38.302659: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:20:39.161911: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:39.166545: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:39.167900: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:39.169656: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:39.170458: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:39.171283: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:39.253958: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:39.254879: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:39.255619: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:39.256360: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:20:39.555238: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.571482e+00  RMSE=1.253587e+00
  per-joint RMSE: 0.7187 1.4312 0.9474 0.4355 0.7903 2.2698
Residual LSTM:  MSE=1.400704e+00      RMSE=1.183514e+00
  per-joint RMSE: 0.6217 1.3031 0.8765 0.3748 0.7467 2.2030
Combined torque MSE=1.400704e+00     RMSE=1.183514e+00
  per-joint RMSE: 0.6217 1.3031 0.8765 0.3748 0.7467 2.2030
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz --H 25 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (31504, 25, 18)  Y_train: (31504, 6)
X_test : (4832, 25, 18)  Y_test : (4832, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:20:41.598048: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:20:41.621617: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (31504, 25, 18), Y_train = (31504, 6)
  X_test  = (4832, 25, 18),  Y_test  = (4832, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:20:42.662939: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:42.667611: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:42.668406: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:42.670148: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:42.670938: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:42.671679: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:42.749107: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:42.750029: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:42.750777: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:42.751509: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:20:43.699162: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
99/99 - 2s - 16ms/step - loss: 0.3995 - val_loss: 0.4871
Epoch 2/60
99/99 - 0s - 3ms/step - loss: 0.2332 - val_loss: 0.5047
Epoch 3/60
99/99 - 0s - 3ms/step - loss: 0.2037 - val_loss: 0.5445
Epoch 4/60
99/99 - 0s - 3ms/step - loss: 0.1877 - val_loss: 0.5603
Epoch 5/60
99/99 - 0s - 3ms/step - loss: 0.1728 - val_loss: 0.5637
Epoch 6/60
99/99 - 0s - 3ms/step - loss: 0.1634 - val_loss: 0.5549
Epoch 7/60
99/99 - 0s - 3ms/step - loss: 0.1555 - val_loss: 0.5567
Epoch 8/60
99/99 - 0s - 3ms/step - loss: 0.1501 - val_loss: 0.5484
Epoch 9/60
99/99 - 0s - 3ms/step - loss: 0.1463 - val_loss: 0.5505
Epoch 10/60
99/99 - 0s - 3ms/step - loss: 0.1422 - val_loss: 0.5506
Epoch 11/60
99/99 - 0s - 3ms/step - loss: 0.1380 - val_loss: 0.5524
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.2133
Per-joint RMSE: 0.5946 1.3592 0.8966 0.3520 0.7627 2.2633
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:20:48.312116: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:20:48.336889: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:20:49.186373: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:49.190906: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:49.191703: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:49.193387: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:49.194185: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:49.194920: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:49.280002: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:49.280955: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:49.281823: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:49.282603: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:20:49.585584: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.571482e+00  RMSE=1.253587e+00
  per-joint RMSE: 0.7187 1.4312 0.9474 0.4355 0.7903 2.2698
Residual LSTM:  MSE=1.472179e+00      RMSE=1.213334e+00
  per-joint RMSE: 0.5946 1.3592 0.8966 0.3520 0.7627 2.2633
Combined torque MSE=1.472179e+00     RMSE=1.213334e+00
  per-joint RMSE: 0.5946 1.3592 0.8966 0.3520 0.7627 2.2633
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz --H 25 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (31504, 25, 18)  Y_train: (31504, 6)
X_test : (4832, 25, 18)  Y_test : (4832, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:20:51.607453: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:20:51.631219: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (31504, 25, 18), Y_train = (31504, 6)
  X_test  = (4832, 25, 18),  Y_test  = (4832, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:20:52.643065: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:52.647730: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:52.648512: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:52.650100: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:52.650881: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:52.651618: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:52.729434: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:52.730352: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:52.731190: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:52.731922: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:20:53.679406: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
99/99 - 2s - 16ms/step - loss: 0.3627 - val_loss: 0.4319
Epoch 2/60
99/99 - 0s - 3ms/step - loss: 0.1987 - val_loss: 0.4025
Epoch 3/60
99/99 - 0s - 3ms/step - loss: 0.1715 - val_loss: 0.3986
Epoch 4/60
99/99 - 0s - 3ms/step - loss: 0.1600 - val_loss: 0.3993
Epoch 5/60
99/99 - 0s - 3ms/step - loss: 0.1514 - val_loss: 0.4198
Epoch 6/60
99/99 - 0s - 3ms/step - loss: 0.1452 - val_loss: 0.4174
Epoch 7/60
99/99 - 0s - 3ms/step - loss: 0.1411 - val_loss: 0.4160
Epoch 8/60
99/99 - 0s - 3ms/step - loss: 0.1370 - val_loss: 0.4182
Epoch 9/60
99/99 - 0s - 3ms/step - loss: 0.1332 - val_loss: 0.4121
Epoch 10/60
99/99 - 0s - 3ms/step - loss: 0.1314 - val_loss: 0.4084
Epoch 11/60
99/99 - 0s - 3ms/step - loss: 0.1278 - val_loss: 0.4109
Epoch 12/60
99/99 - 0s - 3ms/step - loss: 0.1269 - val_loss: 0.4110
Epoch 13/60
99/99 - 0s - 3ms/step - loss: 0.1236 - val_loss: 0.4088
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.1833
Per-joint RMSE: 0.5911 1.2891 0.8860 0.3372 0.7516 2.2196
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:20:58.761674: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:20:58.786330: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:20:59.638595: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:59.643151: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:59.643952: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:59.645666: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:59.646466: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:59.647292: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:59.726592: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:59.727512: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:59.728258: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:20:59.728983: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:21:00.036017: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.571482e+00  RMSE=1.253587e+00
  per-joint RMSE: 0.7187 1.4312 0.9474 0.4355 0.7903 2.2698
Residual LSTM:  MSE=1.400245e+00      RMSE=1.183319e+00
  per-joint RMSE: 0.5911 1.2891 0.8860 0.3372 0.7516 2.2196
Combined torque MSE=1.400245e+00     RMSE=1.183319e+00
  per-joint RMSE: 0.5911 1.2891 0.8860 0.3372 0.7516 2.2196
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz --H 50 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.json
H=50, n_dof=6, feature_dim=24
X_train: (30779, 50, 24)  Y_train: (30779, 6)
X_test : (4657, 50, 24)  Y_test : (4657, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:21:02.170322: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:21:02.194300: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (30779, 50, 24), Y_train = (30779, 6)
  X_test  = (4657, 50, 24),  Y_test  = (4657, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:21:03.384336: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:03.388969: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:03.389883: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:03.391640: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:03.392557: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:03.393307: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:03.472816: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:03.473806: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:03.474605: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:03.475394: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:21:04.486674: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
97/97 - 2s - 18ms/step - loss: 0.3546 - val_loss: 0.4960
Epoch 2/60
97/97 - 0s - 4ms/step - loss: 0.1942 - val_loss: 0.4583
Epoch 3/60
97/97 - 0s - 4ms/step - loss: 0.1729 - val_loss: 0.4475
Epoch 4/60
97/97 - 0s - 4ms/step - loss: 0.1603 - val_loss: 0.4345
Epoch 5/60
97/97 - 0s - 4ms/step - loss: 0.1527 - val_loss: 0.4280
Epoch 6/60
97/97 - 0s - 4ms/step - loss: 0.1470 - val_loss: 0.4210
Epoch 7/60
97/97 - 0s - 4ms/step - loss: 0.1417 - val_loss: 0.4133
Epoch 8/60
97/97 - 0s - 4ms/step - loss: 0.1390 - val_loss: 0.4154
Epoch 9/60
97/97 - 0s - 4ms/step - loss: 0.1358 - val_loss: 0.4095
Epoch 10/60
97/97 - 0s - 4ms/step - loss: 0.1339 - val_loss: 0.4083
Epoch 11/60
97/97 - 0s - 5ms/step - loss: 0.1320 - val_loss: 0.4049
Epoch 12/60
97/97 - 0s - 4ms/step - loss: 0.1299 - val_loss: 0.4015
Epoch 13/60
97/97 - 0s - 4ms/step - loss: 0.1272 - val_loss: 0.3963
Epoch 14/60
97/97 - 0s - 4ms/step - loss: 0.1256 - val_loss: 0.3992
Epoch 15/60
97/97 - 0s - 4ms/step - loss: 0.1240 - val_loss: 0.3948
Epoch 16/60
97/97 - 0s - 4ms/step - loss: 0.1218 - val_loss: 0.3993
Epoch 17/60
97/97 - 0s - 4ms/step - loss: 0.1214 - val_loss: 0.3998
Epoch 18/60
97/97 - 0s - 4ms/step - loss: 0.1196 - val_loss: 0.3969
Epoch 19/60
97/97 - 0s - 4ms/step - loss: 0.1186 - val_loss: 0.3964
Epoch 20/60
97/97 - 0s - 4ms/step - loss: 0.1171 - val_loss: 0.3944
Epoch 21/60
97/97 - 0s - 4ms/step - loss: 0.1156 - val_loss: 0.3935
Epoch 22/60
97/97 - 0s - 4ms/step - loss: 0.1150 - val_loss: 0.3901
Epoch 23/60
97/97 - 0s - 4ms/step - loss: 0.1155 - val_loss: 0.3898
Epoch 24/60
97/97 - 0s - 4ms/step - loss: 0.1130 - val_loss: 0.3947
Epoch 25/60
97/97 - 0s - 4ms/step - loss: 0.1121 - val_loss: 0.3900
Epoch 26/60
97/97 - 0s - 4ms/step - loss: 0.1107 - val_loss: 0.3900
Epoch 27/60
97/97 - 0s - 4ms/step - loss: 0.1101 - val_loss: 0.3892
Epoch 28/60
97/97 - 0s - 4ms/step - loss: 0.1099 - val_loss: 0.3862
Epoch 29/60
97/97 - 0s - 4ms/step - loss: 0.1081 - val_loss: 0.3774
Epoch 30/60
97/97 - 0s - 4ms/step - loss: 0.1070 - val_loss: 0.3802
Epoch 31/60
97/97 - 0s - 4ms/step - loss: 0.1065 - val_loss: 0.3729
Epoch 32/60
97/97 - 0s - 4ms/step - loss: 0.1066 - val_loss: 0.3791
Epoch 33/60
97/97 - 0s - 4ms/step - loss: 0.1051 - val_loss: 0.3869
Epoch 34/60
97/97 - 0s - 4ms/step - loss: 0.1042 - val_loss: 0.3749
Epoch 35/60
97/97 - 0s - 4ms/step - loss: 0.1035 - val_loss: 0.3782
Epoch 36/60
97/97 - 0s - 4ms/step - loss: 0.1035 - val_loss: 0.3818
Epoch 37/60
97/97 - 0s - 4ms/step - loss: 0.1025 - val_loss: 0.3830
Epoch 38/60
97/97 - 0s - 4ms/step - loss: 0.1017 - val_loss: 0.3790
Epoch 39/60
97/97 - 0s - 4ms/step - loss: 0.1006 - val_loss: 0.3841
Epoch 40/60
97/97 - 0s - 4ms/step - loss: 0.1000 - val_loss: 0.3845
Epoch 41/60
97/97 - 0s - 4ms/step - loss: 0.0987 - val_loss: 0.3808
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.1491
Per-joint RMSE: 0.5972 1.2172 0.8627 0.3157 0.7466 2.1641
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:21:22.484273: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:21:22.509294: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:21:23.353699: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:23.358394: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:23.359187: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:23.360868: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:23.361660: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:23.362393: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:23.438745: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:23.439587: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:23.440356: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:23.441131: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:21:23.742001: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.543251e+00  RMSE=1.242277e+00
  per-joint RMSE: 0.7093 1.4225 0.9417 0.4359 0.7833 2.2456
Residual LSTM:  MSE=1.320477e+00      RMSE=1.149120e+00
  per-joint RMSE: 0.5972 1.2172 0.8627 0.3157 0.7466 2.1641
Combined torque MSE=1.320477e+00     RMSE=1.149120e+00
  per-joint RMSE: 0.5972 1.2172 0.8627 0.3157 0.7466 2.1641
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s1_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz --H 50 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.json
H=50, n_dof=6, feature_dim=6
X_train: (30779, 50, 6)  Y_train: (30779, 6)
X_test : (4657, 50, 6)  Y_test : (4657, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:21:25.727410: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:21:25.751603: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (30779, 50, 6), Y_train = (30779, 6)
  X_test  = (4657, 50, 6),  Y_test  = (4657, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:21:26.786339: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:26.791064: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:26.791863: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:26.793396: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:26.794185: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:26.794923: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:26.874132: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:26.874969: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:26.875715: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:26.876447: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:21:27.844344: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
97/97 - 2s - 18ms/step - loss: 0.6729 - val_loss: 0.6057
Epoch 2/60
97/97 - 0s - 4ms/step - loss: 0.3541 - val_loss: 0.5966
Epoch 3/60
97/97 - 0s - 4ms/step - loss: 0.2674 - val_loss: 0.5902
Epoch 4/60
97/97 - 0s - 4ms/step - loss: 0.2207 - val_loss: 0.5700
Epoch 5/60
97/97 - 0s - 4ms/step - loss: 0.1951 - val_loss: 0.5801
Epoch 6/60
97/97 - 0s - 4ms/step - loss: 0.1842 - val_loss: 0.5700
Epoch 7/60
97/97 - 0s - 4ms/step - loss: 0.1761 - val_loss: 0.5664
Epoch 8/60
97/97 - 0s - 4ms/step - loss: 0.1723 - val_loss: 0.5851
Epoch 9/60
97/97 - 0s - 4ms/step - loss: 0.1771 - val_loss: 0.5775
Epoch 10/60
97/97 - 0s - 4ms/step - loss: 0.1597 - val_loss: 0.6145
Epoch 11/60
97/97 - 0s - 5ms/step - loss: 0.1550 - val_loss: 0.5596
Epoch 12/60
97/97 - 0s - 4ms/step - loss: 0.1516 - val_loss: 0.5547
Epoch 13/60
97/97 - 0s - 4ms/step - loss: 0.1565 - val_loss: 0.5668
Epoch 14/60
97/97 - 0s - 4ms/step - loss: 0.1643 - val_loss: 0.5749
Epoch 15/60
97/97 - 0s - 4ms/step - loss: 0.1496 - val_loss: 0.5808
Epoch 16/60
97/97 - 0s - 4ms/step - loss: 0.1467 - val_loss: 0.5957
Epoch 17/60
97/97 - 0s - 4ms/step - loss: 0.1433 - val_loss: 0.5685
Epoch 18/60
97/97 - 0s - 4ms/step - loss: 0.1399 - val_loss: 0.5762
Epoch 19/60
97/97 - 0s - 4ms/step - loss: 0.1412 - val_loss: 0.5685
Epoch 20/60
97/97 - 0s - 4ms/step - loss: 0.1409 - val_loss: 0.5631
Epoch 21/60
97/97 - 0s - 4ms/step - loss: 0.1375 - val_loss: 0.5844
Epoch 22/60
97/97 - 0s - 4ms/step - loss: 0.1370 - val_loss: 0.5774
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.2225
Per-joint RMSE: 0.6389 1.4353 0.8653 0.3904 0.7429 2.2464
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:21:38.108263: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:21:38.133250: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:21:39.014305: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:39.018903: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:39.019780: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:39.021664: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:39.022637: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:39.023374: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:39.103102: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:39.104277: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:39.105023: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:39.105768: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8950 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:21:39.412636: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.543251e+00  RMSE=1.242277e+00
  per-joint RMSE: 0.7093 1.4225 0.9417 0.4359 0.7833 2.2456
Residual LSTM:  MSE=1.494604e+00      RMSE=1.222540e+00
  per-joint RMSE: 0.6389 1.4353 0.8653 0.3904 0.7429 2.2464
Combined torque MSE=1.494604e+00     RMSE=1.222540e+00
  per-joint RMSE: 0.6389 1.4353 0.8653 0.3904 0.7429 2.2464
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s1_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz --H 50 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (30779, 50, 18)  Y_train: (30779, 6)
X_test : (4657, 50, 18)  Y_test : (4657, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:21:41.527838: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:21:41.552829: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (30779, 50, 18), Y_train = (30779, 6)
  X_test  = (4657, 50, 18),  Y_test  = (4657, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:21:42.691145: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:42.695745: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:42.696672: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:42.698442: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:42.699352: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:42.700211: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:42.782746: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:42.783732: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:42.784537: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:42.785438: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:21:43.769723: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
97/97 - 2s - 18ms/step - loss: 0.4023 - val_loss: 0.5202
Epoch 2/60
97/97 - 0s - 4ms/step - loss: 0.2379 - val_loss: 0.5296
Epoch 3/60
97/97 - 0s - 4ms/step - loss: 0.2099 - val_loss: 0.5427
Epoch 4/60
97/97 - 0s - 4ms/step - loss: 0.1891 - val_loss: 0.5391
Epoch 5/60
97/97 - 0s - 4ms/step - loss: 0.1765 - val_loss: 0.5411
Epoch 6/60
97/97 - 0s - 4ms/step - loss: 0.1669 - val_loss: 0.5405
Epoch 7/60
97/97 - 0s - 4ms/step - loss: 0.1604 - val_loss: 0.5404
Epoch 8/60
97/97 - 0s - 4ms/step - loss: 0.1532 - val_loss: 0.5300
Epoch 9/60
97/97 - 0s - 4ms/step - loss: 0.1484 - val_loss: 0.5252
Epoch 10/60
97/97 - 0s - 4ms/step - loss: 0.1450 - val_loss: 0.5154
Epoch 11/60
97/97 - 0s - 4ms/step - loss: 0.1423 - val_loss: 0.5168
Epoch 12/60
97/97 - 0s - 5ms/step - loss: 0.1389 - val_loss: 0.5176
Epoch 13/60
97/97 - 0s - 4ms/step - loss: 0.1378 - val_loss: 0.5162
Epoch 14/60
97/97 - 0s - 4ms/step - loss: 0.1347 - val_loss: 0.5166
Epoch 15/60
97/97 - 0s - 4ms/step - loss: 0.1325 - val_loss: 0.5157
Epoch 16/60
97/97 - 0s - 4ms/step - loss: 0.1302 - val_loss: 0.5209
Epoch 17/60
97/97 - 0s - 4ms/step - loss: 0.1282 - val_loss: 0.5201
Epoch 18/60
97/97 - 0s - 4ms/step - loss: 0.1270 - val_loss: 0.5200
Epoch 19/60
97/97 - 0s - 4ms/step - loss: 0.1254 - val_loss: 0.5214
Epoch 20/60
97/97 - 0s - 4ms/step - loss: 0.1238 - val_loss: 0.5174
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.2026
Per-joint RMSE: 0.5954 1.3865 0.8733 0.3689 0.7684 2.2162
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:21:53.275255: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:21:53.299937: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:21:54.141758: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:54.146386: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:54.147175: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:54.148898: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:54.149739: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:54.150520: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:54.229748: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:54.230660: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:54.231399: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:54.232122: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:21:54.536658: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.543251e+00  RMSE=1.242277e+00
  per-joint RMSE: 0.7093 1.4225 0.9417 0.4359 0.7833 2.2456
Residual LSTM:  MSE=1.446333e+00      RMSE=1.202636e+00
  per-joint RMSE: 0.5954 1.3865 0.8733 0.3689 0.7684 2.2162
Combined torque MSE=1.446333e+00     RMSE=1.202636e+00
  per-joint RMSE: 0.5954 1.3865 0.8733 0.3689 0.7684 2.2162
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s1_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz --H 50 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (30779, 50, 18)  Y_train: (30779, 6)
X_test : (4657, 50, 18)  Y_test : (4657, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:21:56.601866: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:21:56.625554: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (30779, 50, 18), Y_train = (30779, 6)
  X_test  = (4657, 50, 18),  Y_test  = (4657, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:21:57.744566: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:57.749113: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:57.749900: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:57.751586: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:57.752365: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:57.753098: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:57.830759: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:57.831605: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:57.832335: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:21:57.833066: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:21:58.826326: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
97/97 - 2s - 18ms/step - loss: 0.3658 - val_loss: 0.4804
Epoch 2/60
97/97 - 0s - 4ms/step - loss: 0.2024 - val_loss: 0.4606
Epoch 3/60
97/97 - 0s - 4ms/step - loss: 0.1765 - val_loss: 0.4692
Epoch 4/60
97/97 - 0s - 4ms/step - loss: 0.1634 - val_loss: 0.4764
Epoch 5/60
97/97 - 0s - 4ms/step - loss: 0.1545 - val_loss: 0.4625
Epoch 6/60
97/97 - 0s - 4ms/step - loss: 0.1488 - val_loss: 0.4617
Epoch 7/60
97/97 - 0s - 4ms/step - loss: 0.1436 - val_loss: 0.4612
Epoch 8/60
97/97 - 0s - 4ms/step - loss: 0.1404 - val_loss: 0.4608
Epoch 9/60
97/97 - 0s - 4ms/step - loss: 0.1366 - val_loss: 0.4491
Epoch 10/60
97/97 - 0s - 4ms/step - loss: 0.1339 - val_loss: 0.4459
Epoch 11/60
97/97 - 0s - 4ms/step - loss: 0.1309 - val_loss: 0.4576
Epoch 12/60
97/97 - 0s - 5ms/step - loss: 0.1288 - val_loss: 0.4549
Epoch 13/60
97/97 - 0s - 4ms/step - loss: 0.1280 - val_loss: 0.4567
Epoch 14/60
97/97 - 0s - 4ms/step - loss: 0.1259 - val_loss: 0.4608
Epoch 15/60
97/97 - 0s - 4ms/step - loss: 0.1248 - val_loss: 0.4580
Epoch 16/60
97/97 - 0s - 4ms/step - loss: 0.1227 - val_loss: 0.4595
Epoch 17/60
97/97 - 0s - 4ms/step - loss: 0.1206 - val_loss: 0.4665
Epoch 18/60
97/97 - 0s - 4ms/step - loss: 0.1202 - val_loss: 0.4824
Epoch 19/60
97/97 - 0s - 4ms/step - loss: 0.1188 - val_loss: 0.4775
Epoch 20/60
97/97 - 0s - 4ms/step - loss: 0.1171 - val_loss: 0.4720
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.1600
Per-joint RMSE: 0.5938 1.2892 0.8592 0.3243 0.7527 2.1560
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:22:08.369954: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:22:08.394784: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:22:09.230964: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:22:09.235612: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:22:09.236405: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:22:09.238063: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:22:09.238858: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:22:09.239604: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:22:09.320888: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:22:09.321722: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:22:09.322466: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:22:09.323197: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:22:09.628388: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.543251e+00  RMSE=1.242277e+00
  per-joint RMSE: 0.7093 1.4225 0.9417 0.4359 0.7833 2.2456
Residual LSTM:  MSE=1.345552e+00      RMSE=1.159979e+00
  per-joint RMSE: 0.5938 1.2892 0.8592 0.3243 0.7527 2.1560
Combined torque MSE=1.345552e+00     RMSE=1.159979e+00
  per-joint RMSE: 0.5938 1.2892 0.8592 0.3243 0.7527 2.1560
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s1_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

