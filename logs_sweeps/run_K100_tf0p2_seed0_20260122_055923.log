#################################################################################################################
### RUN: K=100 test_fraction=0.2 seed=0                                                                       ###
### npz_in=/workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p2_seed0_dataset.npz ###
#################################################################################################################

#####################
### 1) PREPROCESS ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_delan_dataset.py --qdd True --col_format wide --trajectory_amount 100 --test_fraction 0.2 --seed 0 --raw_csv /workspace/shared/data/raw/delan_UR3_Load0_combined_26.csv --out_npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p2_seed0_dataset.npz' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Saved: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p2_seed0_dataset.npz
Trajectories: train=80 test=20
Exists: True

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=0                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz                                ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p2_seed0_dataset.npz -t structured -s 0 -r 0 --hp_preset fast_debug --epochs 300 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300.jax' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 300, 'lagrangian_type': <function structured_lagrangian_fn at 0x7ad410e9c1f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K100_tf0p2_seed0_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p2_seed0_dataset.npz
   dt ≈ 0.022972524931080995
  dof = 6
  Train trajectories = 80
  Test trajectories  = 20
  Train samples = 39124
  Test samples  = 15025
################################################

2026-01-22 06:58:40.640522: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300 | type=structured | dof=6
################################################
2026-01-22 06:58:43.831157: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:58:43.831191: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:58:43.831197: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:58:43.831224: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:58:43.831229: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:58:43.831244: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:58:43.831280: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:58:43.831285: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:58:43.831300: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:58:43.831305: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.0s, Loss=1.25e+01, Inv=1.25e+01, For=2.26e+02, Power=2.79e+00
  [eval] test_mse=1.664e+00  (n=15025)
Epoch 00050: Time=  12.0s, Loss=2.48e+00, Inv=2.48e+00, For=1.18e+02, Power=1.25e+00
Epoch 00100: Time=  16.8s, Loss=2.25e+00, Inv=2.25e+00, For=1.36e+02, Power=1.08e+00
Epoch 00150: Time=  22.1s, Loss=2.14e+00, Inv=2.14e+00, For=1.57e+02, Power=1.02e+00
Epoch 00200: Time=  27.6s, Loss=2.07e+00, Inv=2.07e+00, For=1.76e+02, Power=9.92e-01
  [eval] test_mse=3.288e+00  (n=15025)
Epoch 00250: Time=  32.6s, Loss=2.03e+00, Inv=2.03e+00, For=1.83e+02, Power=9.79e-01
Epoch 00300: Time=  37.9s, Loss=2.01e+00, Inv=2.01e+00, For=2.04e+02, Power=9.73e-01
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300
Torque MSE  = 6.766e-01
Torque RMSE = 8.226e-01
Per-joint MSE : 1.154e+00 1.638e+00 7.449e-01 2.385e-01 1.204e-01 1.642e-01
Per-joint RMSE: 1.074e+00 1.280e+00 8.631e-01 4.884e-01 3.470e-01 4.052e-01
Comp Time per Sample = 2.270e-08s / 44045050.8Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p2_seed0_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p2_seed0_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300.jax
Detected n_dof=6 (seed=0)
2026-01-22 06:59:23.853850: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 80 trajectories
2026-01-22 06:59:25.181627: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:59:25.181639: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:59:26.849708: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:59:27.959365: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:59:27.959379: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/80
  done 50/80
2026-01-22 06:59:30.769664: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 75/80
2026-01-22 06:59:31.975392: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 80/80

Exporting split=test: 20 trajectories
  done 20/20

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300.npz --H 25 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300.json
H=25, n_dof=6, feature_dim=24
X_train: (38086, 25, 24)  Y_train: (38086, 6)
X_test : (14734, 25, 24)  Y_test : (14734, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:59:34.252657: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:59:34.276888: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (38086, 25, 24), Y_train = (38086, 6)
  X_test  = (14734, 25, 24),  Y_test  = (14734, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:59:35.391412: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:35.396266: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:35.397081: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:35.398819: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:35.399749: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:35.400723: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:35.531974: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:35.532861: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:35.533662: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:35.534450: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8813 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 06:59:36.486867: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
120/120 - 2s - 14ms/step - loss: 0.2484 - val_loss: 0.5076
Epoch 2/80
120/120 - 0s - 3ms/step - loss: 0.1376 - val_loss: 0.4852
Epoch 3/80
120/120 - 0s - 3ms/step - loss: 0.1171 - val_loss: 0.4802
Epoch 4/80
120/120 - 0s - 3ms/step - loss: 0.1063 - val_loss: 0.4842
Epoch 5/80
120/120 - 0s - 3ms/step - loss: 0.0993 - val_loss: 0.4826
Epoch 6/80
120/120 - 0s - 3ms/step - loss: 0.0953 - val_loss: 0.4868
Epoch 7/80
120/120 - 0s - 3ms/step - loss: 0.0929 - val_loss: 0.4850
Epoch 8/80
120/120 - 0s - 3ms/step - loss: 0.0883 - val_loss: 0.5017
Epoch 9/80
120/120 - 0s - 3ms/step - loss: 0.0859 - val_loss: 0.5062
Epoch 10/80
120/120 - 0s - 3ms/step - loss: 0.0838 - val_loss: 0.5083
Epoch 11/80
120/120 - 0s - 3ms/step - loss: 0.0821 - val_loss: 0.5059
Epoch 12/80
120/120 - 0s - 3ms/step - loss: 0.0816 - val_loss: 0.5062
Epoch 13/80
120/120 - 0s - 3ms/step - loss: 0.0822 - val_loss: 0.5182
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6857
Per-joint RMSE: 0.8782 1.0481 0.7520 0.4341 0.2894 0.3373
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:59:42.307354: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:59:42.332117: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 20
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:59:43.180955: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:43.185949: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:43.186869: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:43.188538: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:43.189342: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:43.190199: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:43.276931: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:43.277822: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:43.278621: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:43.279497: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8811 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:59:43.579384: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.864938e-01  RMSE=8.285492e-01
  per-joint RMSE: 1.0830 1.2894 0.8683 0.4918 0.3488 0.4078
Residual LSTM:  MSE=4.702088e-01      RMSE=6.857178e-01
  per-joint RMSE: 0.8782 1.0481 0.7520 0.4341 0.2894 0.3373
Combined torque MSE=4.702088e-01     RMSE=6.857178e-01
  per-joint RMSE: 0.8782 1.0481 0.7520 0.4341 0.2894 0.3373
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300.npz --H 25 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300.json
H=25, n_dof=6, feature_dim=6
X_train: (38086, 25, 6)  Y_train: (38086, 6)
X_test : (14734, 25, 6)  Y_test : (14734, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:59:45.698748: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:59:45.722534: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (38086, 25, 6), Y_train = (38086, 6)
  X_test  = (14734, 25, 6),  Y_test  = (14734, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:59:46.713950: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:46.718930: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:46.719723: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:46.721269: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:46.722053: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:46.722795: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:46.796279: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:46.797220: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:46.798037: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:46.798831: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8811 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 06:59:47.732646: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
120/120 - 2s - 14ms/step - loss: 0.6245 - val_loss: 1.7447
Epoch 2/80
120/120 - 0s - 3ms/step - loss: 0.4754 - val_loss: 1.7606
Epoch 3/80
120/120 - 0s - 3ms/step - loss: 0.3915 - val_loss: 1.4631
Epoch 4/80
120/120 - 0s - 3ms/step - loss: 0.3428 - val_loss: 1.4929
Epoch 5/80
120/120 - 0s - 3ms/step - loss: 0.3056 - val_loss: 1.5686
Epoch 6/80
120/120 - 0s - 3ms/step - loss: 0.2768 - val_loss: 1.4446
Epoch 7/80
120/120 - 0s - 3ms/step - loss: 0.2583 - val_loss: 1.4105
Epoch 8/80
120/120 - 0s - 3ms/step - loss: 0.2307 - val_loss: 1.4669
Epoch 9/80
120/120 - 0s - 3ms/step - loss: 0.2125 - val_loss: 1.3158
Epoch 10/80
120/120 - 0s - 3ms/step - loss: 0.2104 - val_loss: 1.1092
Epoch 11/80
120/120 - 0s - 3ms/step - loss: 0.2216 - val_loss: 1.2413
Epoch 12/80
120/120 - 0s - 3ms/step - loss: 0.1952 - val_loss: 1.2910
Epoch 13/80
120/120 - 0s - 3ms/step - loss: 0.1973 - val_loss: 1.2694
Epoch 14/80
120/120 - 0s - 3ms/step - loss: 0.1869 - val_loss: 1.3398
Epoch 15/80
120/120 - 0s - 3ms/step - loss: 0.1755 - val_loss: 1.1872
Epoch 16/80
120/120 - 0s - 3ms/step - loss: 0.1639 - val_loss: 1.2007
Epoch 17/80
120/120 - 0s - 3ms/step - loss: 0.1544 - val_loss: 1.2123
Epoch 18/80
120/120 - 0s - 3ms/step - loss: 0.1545 - val_loss: 1.1703
Epoch 19/80
120/120 - 0s - 3ms/step - loss: 0.1736 - val_loss: 1.2393
Epoch 20/80
120/120 - 0s - 3ms/step - loss: 0.1541 - val_loss: 1.2033
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7666
Per-joint RMSE: 1.0099 1.1597 0.8098 0.4795 0.3352 0.4039
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:59:55.795740: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:59:55.820212: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 20
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:59:56.665817: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:56.670647: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:56.671522: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:56.673279: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:56.673993: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:56.674733: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:56.751455: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:56.752297: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:56.753046: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:59:56.753774: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:59:57.050479: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.864938e-01  RMSE=8.285492e-01
  per-joint RMSE: 1.0830 1.2894 0.8683 0.4918 0.3488 0.4078
Residual LSTM:  MSE=5.876625e-01      RMSE=7.665915e-01
  per-joint RMSE: 1.0099 1.1597 0.8098 0.4795 0.3352 0.4039
Combined torque MSE=5.876625e-01     RMSE=7.665915e-01
  per-joint RMSE: 1.0099 1.1597 0.8098 0.4795 0.3352 0.4039
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300.npz --H 25 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300.json
H=25, n_dof=6, feature_dim=18
X_train: (38086, 25, 18)  Y_train: (38086, 6)
X_test : (14734, 25, 18)  Y_test : (14734, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:59:59.194468: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:59:59.218527: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (38086, 25, 18), Y_train = (38086, 6)
  X_test  = (14734, 25, 18),  Y_test  = (14734, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:00:00.312507: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:00.317063: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:00.317971: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:00.319524: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:00.320334: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:00.321096: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:00.402605: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:00.403466: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:00.404244: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:00.405005: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8811 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:00:01.357118: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
120/120 - 2s - 14ms/step - loss: 0.2913 - val_loss: 0.5221
Epoch 2/80
120/120 - 0s - 3ms/step - loss: 0.1689 - val_loss: 0.4630
Epoch 3/80
120/120 - 0s - 3ms/step - loss: 0.1439 - val_loss: 0.4433
Epoch 4/80
120/120 - 0s - 3ms/step - loss: 0.1298 - val_loss: 0.4386
Epoch 5/80
120/120 - 0s - 3ms/step - loss: 0.1233 - val_loss: 0.4353
Epoch 6/80
120/120 - 0s - 3ms/step - loss: 0.1290 - val_loss: 0.4192
Epoch 7/80
120/120 - 0s - 3ms/step - loss: 0.1114 - val_loss: 0.4145
Epoch 8/80
120/120 - 0s - 3ms/step - loss: 0.1071 - val_loss: 0.4076
Epoch 9/80
120/120 - 0s - 3ms/step - loss: 0.1034 - val_loss: 0.4059
Epoch 10/80
120/120 - 0s - 3ms/step - loss: 0.1025 - val_loss: 0.4200
Epoch 11/80
120/120 - 0s - 3ms/step - loss: 0.0989 - val_loss: 0.4121
Epoch 12/80
120/120 - 0s - 3ms/step - loss: 0.0957 - val_loss: 0.4053
Epoch 13/80
120/120 - 0s - 3ms/step - loss: 0.0930 - val_loss: 0.4247
Epoch 14/80
120/120 - 0s - 3ms/step - loss: 0.0945 - val_loss: 0.4196
Epoch 15/80
120/120 - 0s - 3ms/step - loss: 0.0932 - val_loss: 0.4253
Epoch 16/80
120/120 - 0s - 3ms/step - loss: 0.0926 - val_loss: 0.4104
Epoch 17/80
120/120 - 0s - 3ms/step - loss: 0.1043 - val_loss: 0.4037
Epoch 18/80
120/120 - 0s - 3ms/step - loss: 0.0924 - val_loss: 0.4097
Epoch 19/80
120/120 - 0s - 3ms/step - loss: 0.0896 - val_loss: 0.4264
Epoch 20/80
120/120 - 0s - 3ms/step - loss: 0.0852 - val_loss: 0.3979
Epoch 21/80
120/120 - 0s - 3ms/step - loss: 0.0869 - val_loss: 0.4216
Epoch 22/80
120/120 - 0s - 3ms/step - loss: 0.0830 - val_loss: 0.4313
Epoch 23/80
120/120 - 0s - 3ms/step - loss: 0.0816 - val_loss: 0.4199
Epoch 24/80
120/120 - 0s - 3ms/step - loss: 0.0818 - val_loss: 0.4019
Epoch 25/80
120/120 - 0s - 3ms/step - loss: 0.0800 - val_loss: 0.4195
Epoch 26/80
120/120 - 0s - 3ms/step - loss: 0.0781 - val_loss: 0.4351
Epoch 27/80
120/120 - 0s - 3ms/step - loss: 0.0792 - val_loss: 0.4348
Epoch 28/80
120/120 - 0s - 3ms/step - loss: 0.0760 - val_loss: 0.4374
Epoch 29/80
120/120 - 0s - 3ms/step - loss: 0.0754 - val_loss: 0.4376
Epoch 30/80
120/120 - 0s - 3ms/step - loss: 0.0748 - val_loss: 0.4401
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7821
Per-joint RMSE: 1.0333 1.1947 0.8445 0.4622 0.3370 0.3666
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:00:12.602241: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:00:12.627156: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 20
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:00:13.487079: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:13.491699: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:13.492493: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:13.494169: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:13.494957: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:13.495695: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:13.579377: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:13.580209: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:13.580961: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:13.581692: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8811 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:00:13.887753: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.864938e-01  RMSE=8.285492e-01
  per-joint RMSE: 1.0830 1.2894 0.8683 0.4918 0.3488 0.4078
Residual LSTM:  MSE=6.116470e-01      RMSE=7.820786e-01
  per-joint RMSE: 1.0333 1.1947 0.8445 0.4622 0.3370 0.3666
Combined torque MSE=6.116470e-01     RMSE=7.820786e-01
  per-joint RMSE: 1.0333 1.1947 0.8445 0.4622 0.3370 0.3666
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300.npz --H 25 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300.json
H=25, n_dof=6, feature_dim=18
X_train: (38086, 25, 18)  Y_train: (38086, 6)
X_test : (14734, 25, 18)  Y_test : (14734, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:00:16.006588: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:00:16.030696: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (38086, 25, 18), Y_train = (38086, 6)
  X_test  = (14734, 25, 18),  Y_test  = (14734, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:00:17.104437: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:17.108895: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:17.109745: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:17.111383: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:17.112170: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:17.112989: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:17.187698: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:17.188541: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:17.189288: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:17.190026: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8811 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:00:18.142170: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
120/120 - 2s - 14ms/step - loss: 0.2506 - val_loss: 0.4960
Epoch 2/80
120/120 - 0s - 3ms/step - loss: 0.1404 - val_loss: 0.4701
Epoch 3/80
120/120 - 0s - 3ms/step - loss: 0.1206 - val_loss: 0.4758
Epoch 4/80
120/120 - 0s - 3ms/step - loss: 0.1081 - val_loss: 0.4811
Epoch 5/80
120/120 - 0s - 3ms/step - loss: 0.1005 - val_loss: 0.4805
Epoch 6/80
120/120 - 0s - 3ms/step - loss: 0.0963 - val_loss: 0.4892
Epoch 7/80
120/120 - 0s - 3ms/step - loss: 0.0931 - val_loss: 0.4742
Epoch 8/80
120/120 - 0s - 3ms/step - loss: 0.0890 - val_loss: 0.4663
Epoch 9/80
120/120 - 0s - 3ms/step - loss: 0.0869 - val_loss: 0.4789
Epoch 10/80
120/120 - 0s - 3ms/step - loss: 0.0846 - val_loss: 0.4626
Epoch 11/80
120/120 - 0s - 3ms/step - loss: 0.0823 - val_loss: 0.4584
Epoch 12/80
120/120 - 0s - 3ms/step - loss: 0.0812 - val_loss: 0.4629
Epoch 13/80
120/120 - 0s - 3ms/step - loss: 0.0796 - val_loss: 0.4570
Epoch 14/80
120/120 - 0s - 3ms/step - loss: 0.0785 - val_loss: 0.4590
Epoch 15/80
120/120 - 0s - 3ms/step - loss: 0.0767 - val_loss: 0.4605
Epoch 16/80
120/120 - 0s - 3ms/step - loss: 0.0761 - val_loss: 0.4592
Epoch 17/80
120/120 - 0s - 3ms/step - loss: 0.0745 - val_loss: 0.4497
Epoch 18/80
120/120 - 0s - 3ms/step - loss: 0.0738 - val_loss: 0.4576
Epoch 19/80
120/120 - 0s - 3ms/step - loss: 0.0727 - val_loss: 0.4501
Epoch 20/80
120/120 - 0s - 3ms/step - loss: 0.0717 - val_loss: 0.4461
Epoch 21/80
120/120 - 0s - 3ms/step - loss: 0.0717 - val_loss: 0.4552
Epoch 22/80
120/120 - 0s - 3ms/step - loss: 0.0709 - val_loss: 0.4470
Epoch 23/80
120/120 - 0s - 3ms/step - loss: 0.0695 - val_loss: 0.4451
Epoch 24/80
120/120 - 0s - 3ms/step - loss: 0.0695 - val_loss: 0.4429
Epoch 25/80
120/120 - 0s - 3ms/step - loss: 0.0683 - val_loss: 0.4440
Epoch 26/80
120/120 - 0s - 3ms/step - loss: 0.0680 - val_loss: 0.4473
Epoch 27/80
120/120 - 0s - 3ms/step - loss: 0.0668 - val_loss: 0.4476
Epoch 28/80
120/120 - 0s - 3ms/step - loss: 0.0671 - val_loss: 0.4465
Epoch 29/80
120/120 - 0s - 3ms/step - loss: 0.0660 - val_loss: 0.4367
Epoch 30/80
120/120 - 0s - 3ms/step - loss: 0.0648 - val_loss: 0.4334
Epoch 31/80
120/120 - 0s - 3ms/step - loss: 0.0649 - val_loss: 0.4278
Epoch 32/80
120/120 - 0s - 3ms/step - loss: 0.0640 - val_loss: 0.4375
Epoch 33/80
120/120 - 0s - 3ms/step - loss: 0.0640 - val_loss: 0.4400
Epoch 34/80
120/120 - 0s - 3ms/step - loss: 0.0627 - val_loss: 0.4537
Epoch 35/80
120/120 - 0s - 3ms/step - loss: 0.0624 - val_loss: 0.4429
Epoch 36/80
120/120 - 0s - 3ms/step - loss: 0.0624 - val_loss: 0.4414
Epoch 37/80
120/120 - 0s - 3ms/step - loss: 0.0623 - val_loss: 0.4454
Epoch 38/80
120/120 - 0s - 3ms/step - loss: 0.0614 - val_loss: 0.4458
Epoch 39/80
120/120 - 0s - 3ms/step - loss: 0.0607 - val_loss: 0.4404
Epoch 40/80
120/120 - 0s - 3ms/step - loss: 0.0599 - val_loss: 0.4474
Epoch 41/80
120/120 - 0s - 3ms/step - loss: 0.0608 - val_loss: 0.4353
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7135
Per-joint RMSE: 0.8773 1.1542 0.7509 0.4523 0.2875 0.3193
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:00:32.788882: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:00:32.812983: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 20
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:00:33.660489: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:33.665147: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:33.666708: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:33.668339: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:33.669216: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:33.669955: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:33.758696: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:33.759539: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:33.760281: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:33.761010: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8811 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:00:34.069723: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.864938e-01  RMSE=8.285492e-01
  per-joint RMSE: 1.0830 1.2894 0.8683 0.4918 0.3488 0.4078
Residual LSTM:  MSE=5.091461e-01      RMSE=7.135447e-01
  per-joint RMSE: 0.8773 1.1542 0.7509 0.4523 0.2875 0.3193
Combined torque MSE=5.091461e-01     RMSE=7.135447e-01
  per-joint RMSE: 0.8773 1.1542 0.7509 0.4523 0.2875 0.3193
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300.npz --H 50 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300.json
H=50, n_dof=6, feature_dim=24
X_train: (37136, 50, 24)  Y_train: (37136, 6)
X_test : (14459, 50, 24)  Y_test : (14459, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:00:36.298984: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:00:36.322994: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (37136, 50, 24), Y_train = (37136, 6)
  X_test  = (14459, 50, 24),  Y_test  = (14459, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:00:37.713103: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:37.718438: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:37.719436: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:37.721427: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:37.722234: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:37.723121: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:37.812518: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:37.813534: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:37.814502: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:37.815440: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8811 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:00:38.922369: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
117/117 - 2s - 16ms/step - loss: 0.2517 - val_loss: 0.5046
Epoch 2/80
117/117 - 0s - 4ms/step - loss: 0.1404 - val_loss: 0.4886
Epoch 3/80
117/117 - 0s - 4ms/step - loss: 0.1182 - val_loss: 0.4915
Epoch 4/80
117/117 - 0s - 4ms/step - loss: 0.1081 - val_loss: 0.4783
Epoch 5/80
117/117 - 0s - 4ms/step - loss: 0.1026 - val_loss: 0.4717
Epoch 6/80
117/117 - 0s - 4ms/step - loss: 0.0961 - val_loss: 0.4641
Epoch 7/80
117/117 - 0s - 4ms/step - loss: 0.0930 - val_loss: 0.4817
Epoch 8/80
117/117 - 0s - 4ms/step - loss: 0.0893 - val_loss: 0.4906
Epoch 9/80
117/117 - 1s - 5ms/step - loss: 0.0868 - val_loss: 0.4831
Epoch 10/80
117/117 - 0s - 4ms/step - loss: 0.0850 - val_loss: 0.4852
Epoch 11/80
117/117 - 0s - 4ms/step - loss: 0.0825 - val_loss: 0.4780
Epoch 12/80
117/117 - 0s - 4ms/step - loss: 0.0807 - val_loss: 0.4897
Epoch 13/80
117/117 - 0s - 4ms/step - loss: 0.0795 - val_loss: 0.4849
Epoch 14/80
117/117 - 0s - 4ms/step - loss: 0.0776 - val_loss: 0.4793
Epoch 15/80
117/117 - 0s - 4ms/step - loss: 0.0760 - val_loss: 0.4795
Epoch 16/80
117/117 - 0s - 4ms/step - loss: 0.0752 - val_loss: 0.4787
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7018
Per-joint RMSE: 0.9098 1.0951 0.7464 0.4215 0.2869 0.3334
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:00:48.252347: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:00:48.277398: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 20
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 07:00:49.143386: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:49.148026: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:49.148822: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:49.150446: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:49.151232: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:49.151964: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:49.236699: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:49.237620: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:49.238387: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:49.239112: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8813 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:00:49.543212: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.962011e-01  RMSE=8.343866e-01
  per-joint RMSE: 1.0912 1.2993 0.8729 0.4952 0.3507 0.4103
Residual LSTM:  MSE=4.925361e-01      RMSE=7.018092e-01
  per-joint RMSE: 0.9098 1.0951 0.7464 0.4215 0.2869 0.3334
Combined torque MSE=4.925361e-01     RMSE=7.018092e-01
  per-joint RMSE: 0.9098 1.0951 0.7464 0.4215 0.2869 0.3334
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300.npz --H 50 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300.json
H=50, n_dof=6, feature_dim=6
X_train: (37136, 50, 6)  Y_train: (37136, 6)
X_test : (14459, 50, 6)  Y_test : (14459, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:00:51.686042: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:00:51.710120: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (37136, 50, 6), Y_train = (37136, 6)
  X_test  = (14459, 50, 6),  Y_test  = (14459, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:00:52.770537: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:52.775117: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:52.775989: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:52.777788: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:52.778593: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:52.779328: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:52.854651: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:52.855494: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:52.856247: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:00:52.856990: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8813 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:00:53.785387: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
117/117 - 2s - 15ms/step - loss: 0.5889 - val_loss: 1.5073
Epoch 2/80
117/117 - 0s - 4ms/step - loss: 0.3970 - val_loss: 1.3775
Epoch 3/80
117/117 - 0s - 4ms/step - loss: 0.3083 - val_loss: 1.4338
Epoch 4/80
117/117 - 0s - 4ms/step - loss: 0.2375 - val_loss: 1.3207
Epoch 5/80
117/117 - 0s - 4ms/step - loss: 0.2134 - val_loss: 1.3358
Epoch 6/80
117/117 - 0s - 4ms/step - loss: 0.2066 - val_loss: 1.3716
Epoch 7/80
117/117 - 0s - 4ms/step - loss: 0.1837 - val_loss: 1.3034
Epoch 8/80
117/117 - 0s - 4ms/step - loss: 0.1728 - val_loss: 1.2465
Epoch 9/80
117/117 - 1s - 4ms/step - loss: 0.1598 - val_loss: 1.2568
Epoch 10/80
117/117 - 0s - 4ms/step - loss: 0.1527 - val_loss: 1.2982
Epoch 11/80
117/117 - 0s - 4ms/step - loss: 0.1430 - val_loss: 1.2957
Epoch 12/80
117/117 - 0s - 4ms/step - loss: 0.1456 - val_loss: 1.2782
Epoch 13/80
117/117 - 0s - 4ms/step - loss: 0.1415 - val_loss: 1.2645
Epoch 14/80
117/117 - 0s - 4ms/step - loss: 0.1298 - val_loss: 1.3366
Epoch 15/80
117/117 - 0s - 4ms/step - loss: 0.1311 - val_loss: 1.3101
Epoch 16/80
117/117 - 0s - 4ms/step - loss: 0.1143 - val_loss: 1.4013
Epoch 17/80
117/117 - 0s - 4ms/step - loss: 0.1068 - val_loss: 1.3472
Epoch 18/80
117/117 - 0s - 4ms/step - loss: 0.1041 - val_loss: 1.2753
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7633
Per-joint RMSE: 1.0282 1.1306 0.8065 0.4929 0.3305 0.3975
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:01:03.724365: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:01:03.749556: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 20
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 07:01:04.598324: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:04.602861: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:04.603666: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:04.605471: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:04.606271: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:04.607013: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:04.688372: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:04.689292: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:04.690033: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:04.690768: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8811 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:01:04.996640: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.962011e-01  RMSE=8.343866e-01
  per-joint RMSE: 1.0912 1.2993 0.8729 0.4952 0.3507 0.4103
Residual LSTM:  MSE=5.826849e-01      RMSE=7.633380e-01
  per-joint RMSE: 1.0282 1.1306 0.8065 0.4929 0.3305 0.3975
Combined torque MSE=5.826849e-01     RMSE=7.633380e-01
  per-joint RMSE: 1.0282 1.1306 0.8065 0.4929 0.3305 0.3975
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300.npz --H 50 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300.json
H=50, n_dof=6, feature_dim=18
X_train: (37136, 50, 18)  Y_train: (37136, 6)
X_test : (14459, 50, 18)  Y_test : (14459, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:01:07.215496: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:01:07.239037: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (37136, 50, 18), Y_train = (37136, 6)
  X_test  = (14459, 50, 18),  Y_test  = (14459, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:01:08.479077: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:08.484010: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:08.484917: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:08.486738: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:08.487644: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:08.488521: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:08.580644: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:08.581529: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:08.582331: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:08.583114: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8811 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:01:09.609817: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
117/117 - 2s - 16ms/step - loss: 0.2829 - val_loss: 0.5004
Epoch 2/80
117/117 - 0s - 4ms/step - loss: 0.1692 - val_loss: 0.4604
Epoch 3/80
117/117 - 0s - 4ms/step - loss: 0.1456 - val_loss: 0.4599
Epoch 4/80
117/117 - 0s - 4ms/step - loss: 0.1348 - val_loss: 0.4513
Epoch 5/80
117/117 - 0s - 4ms/step - loss: 0.1238 - val_loss: 0.4403
Epoch 6/80
117/117 - 0s - 4ms/step - loss: 0.1190 - val_loss: 0.4396
Epoch 7/80
117/117 - 0s - 4ms/step - loss: 0.1131 - val_loss: 0.4217
Epoch 8/80
117/117 - 0s - 4ms/step - loss: 0.1107 - val_loss: 0.4401
Epoch 9/80
117/117 - 1s - 4ms/step - loss: 0.1062 - val_loss: 0.4234
Epoch 10/80
117/117 - 0s - 4ms/step - loss: 0.1039 - val_loss: 0.4332
Epoch 11/80
117/117 - 0s - 4ms/step - loss: 0.1001 - val_loss: 0.4339
Epoch 12/80
117/117 - 0s - 4ms/step - loss: 0.0973 - val_loss: 0.4252
Epoch 13/80
117/117 - 0s - 4ms/step - loss: 0.0963 - val_loss: 0.4432
Epoch 14/80
117/117 - 0s - 4ms/step - loss: 0.0951 - val_loss: 0.4352
Epoch 15/80
117/117 - 0s - 4ms/step - loss: 0.0897 - val_loss: 0.4405
Epoch 16/80
117/117 - 0s - 4ms/step - loss: 0.0872 - val_loss: 0.4332
Epoch 17/80
117/117 - 0s - 4ms/step - loss: 0.0892 - val_loss: 0.4394
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7924
Per-joint RMSE: 1.0561 1.2064 0.8501 0.4615 0.3422 0.3800
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:01:19.347503: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:01:19.372218: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 20
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:01:20.235161: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:20.239964: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:20.240831: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:20.242570: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:20.243362: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:20.244106: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:20.324357: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:20.325187: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:20.326016: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:20.326747: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8813 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:01:20.636926: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.962011e-01  RMSE=8.343866e-01
  per-joint RMSE: 1.0912 1.2993 0.8729 0.4952 0.3507 0.4103
Residual LSTM:  MSE=6.279413e-01      RMSE=7.924275e-01
  per-joint RMSE: 1.0561 1.2064 0.8501 0.4615 0.3422 0.3800
Combined torque MSE=6.279413e-01     RMSE=7.924275e-01
  per-joint RMSE: 1.0561 1.2064 0.8501 0.4615 0.3422 0.3800
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300.npz --H 50 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300.json
H=50, n_dof=6, feature_dim=18
X_train: (37136, 50, 18)  Y_train: (37136, 6)
X_test : (14459, 50, 18)  Y_test : (14459, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:01:22.865041: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:01:22.890003: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (37136, 50, 18), Y_train = (37136, 6)
  X_test  = (14459, 50, 18),  Y_test  = (14459, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:01:24.127679: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:24.132448: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:24.133666: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:24.135584: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:24.136609: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:24.137463: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:24.224243: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:24.225130: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:24.225932: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:24.226723: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8811 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:01:25.227971: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
117/117 - 2s - 16ms/step - loss: 0.2466 - val_loss: 0.5281
Epoch 2/80
117/117 - 0s - 4ms/step - loss: 0.1407 - val_loss: 0.5247
Epoch 3/80
117/117 - 0s - 4ms/step - loss: 0.1204 - val_loss: 0.5073
Epoch 4/80
117/117 - 0s - 4ms/step - loss: 0.1093 - val_loss: 0.5111
Epoch 5/80
117/117 - 0s - 4ms/step - loss: 0.1017 - val_loss: 0.5242
Epoch 6/80
117/117 - 0s - 4ms/step - loss: 0.0972 - val_loss: 0.5172
Epoch 7/80
117/117 - 0s - 4ms/step - loss: 0.0937 - val_loss: 0.5290
Epoch 8/80
117/117 - 0s - 4ms/step - loss: 0.0910 - val_loss: 0.5279
Epoch 9/80
117/117 - 0s - 4ms/step - loss: 0.0878 - val_loss: 0.5280
Epoch 10/80
117/117 - 1s - 5ms/step - loss: 0.0861 - val_loss: 0.5240
Epoch 11/80
117/117 - 0s - 4ms/step - loss: 0.0837 - val_loss: 0.5223
Epoch 12/80
117/117 - 0s - 4ms/step - loss: 0.0821 - val_loss: 0.5173
Epoch 13/80
117/117 - 0s - 4ms/step - loss: 0.0806 - val_loss: 0.5182
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7154
Per-joint RMSE: 0.8833 1.1332 0.7868 0.4451 0.2836 0.3300
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:01:33.084991: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:01:33.109604: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s0_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 20
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:01:33.971261: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:33.976044: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:33.976962: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:33.978653: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:33.979565: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:33.980326: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:34.071616: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:34.072606: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:34.073394: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:01:34.074180: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8811 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:01:34.390996: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.962011e-01  RMSE=8.343866e-01
  per-joint RMSE: 1.0912 1.2993 0.8729 0.4952 0.3507 0.4103
Residual LSTM:  MSE=5.117746e-01      RMSE=7.153842e-01
  per-joint RMSE: 0.8833 1.1332 0.7868 0.4451 0.2836 0.3300
Combined torque MSE=5.117746e-01     RMSE=7.153842e-01
  per-joint RMSE: 0.8833 1.1332 0.7868 0.4451 0.2836 0.3300
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=1                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz                                ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p2_seed0_dataset.npz -t structured -s 1 -r 0 --hp_preset fast_debug --epochs 300 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300.jax' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 300, 'lagrangian_type': <function structured_lagrangian_fn at 0x78eee8dbc1f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K100_tf0p2_seed0_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p2_seed0_dataset.npz
   dt ≈ 0.022972524931080995
  dof = 6
  Train trajectories = 80
  Test trajectories  = 20
  Train samples = 39124
  Test samples  = 15025
################################################

2026-01-22 07:01:38.893555: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300 | type=structured | dof=6
################################################
2026-01-22 07:01:42.050214: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:01:42.050249: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:01:42.050255: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:01:42.050282: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:01:42.050288: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:01:42.050302: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:01:42.050343: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:01:42.050350: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:01:42.050371: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:01:42.050378: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.1s, Loss=1.31e+01, Inv=1.31e+01, For=1.86e+02, Power=2.95e+00
  [eval] test_mse=1.876e+00  (n=15025)
Epoch 00050: Time=  11.5s, Loss=2.54e+00, Inv=2.54e+00, For=1.03e+02, Power=1.30e+00
Epoch 00100: Time=  16.8s, Loss=2.30e+00, Inv=2.30e+00, For=1.20e+02, Power=1.12e+00
Epoch 00150: Time=  21.6s, Loss=2.18e+00, Inv=2.18e+00, For=1.37e+02, Power=1.04e+00
Epoch 00200: Time=  26.5s, Loss=2.10e+00, Inv=2.10e+00, For=1.67e+02, Power=1.00e+00
  [eval] test_mse=3.116e+00  (n=15025)
Epoch 00250: Time=  31.6s, Loss=2.06e+00, Inv=2.06e+00, For=1.71e+02, Power=9.81e-01
Epoch 00300: Time=  36.4s, Loss=2.03e+00, Inv=2.03e+00, For=1.96e+02, Power=9.68e-01
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300
Torque MSE  = 6.561e-01
Torque RMSE = 8.100e-01
Per-joint MSE : 1.101e+00 1.448e+00 8.086e-01 2.019e-01 2.054e-01 1.715e-01
Per-joint RMSE: 1.049e+00 1.203e+00 8.992e-01 4.494e-01 4.532e-01 4.141e-01
Comp Time per Sample = 2.163e-08s / 46236886.7Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p2_seed0_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p2_seed0_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300.jax
Detected n_dof=6 (seed=1)
2026-01-22 07:02:20.581686: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 80 trajectories
2026-01-22 07:02:21.900260: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:02:21.900273: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:02:23.532886: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:02:24.669475: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:02:24.669490: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/80
  done 50/80
2026-01-22 07:02:27.456277: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 75/80
2026-01-22 07:02:28.795837: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 80/80

Exporting split=test: 20 trajectories
  done 20/20

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300.npz --H 25 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300.json
H=25, n_dof=6, feature_dim=24
X_train: (38086, 25, 24)  Y_train: (38086, 6)
X_test : (14734, 25, 24)  Y_test : (14734, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:02:31.160408: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:02:31.184672: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (38086, 25, 24), Y_train = (38086, 6)
  X_test  = (14734, 25, 24),  Y_test  = (14734, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:02:32.327518: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:32.332468: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:32.333398: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:32.335223: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:32.336241: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:32.337115: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:32.435435: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:32.436329: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:32.437124: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:32.437907: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:02:33.418975: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
120/120 - 2s - 14ms/step - loss: 0.2475 - val_loss: 0.4966
Epoch 2/80
120/120 - 0s - 3ms/step - loss: 0.1395 - val_loss: 0.4632
Epoch 3/80
120/120 - 0s - 3ms/step - loss: 0.1158 - val_loss: 0.4620
Epoch 4/80
120/120 - 0s - 3ms/step - loss: 0.1065 - val_loss: 0.4625
Epoch 5/80
120/120 - 0s - 3ms/step - loss: 0.1000 - val_loss: 0.4545
Epoch 6/80
120/120 - 0s - 3ms/step - loss: 0.0948 - val_loss: 0.4484
Epoch 7/80
120/120 - 0s - 3ms/step - loss: 0.0914 - val_loss: 0.4446
Epoch 8/80
120/120 - 0s - 3ms/step - loss: 0.0885 - val_loss: 0.4406
Epoch 9/80
120/120 - 0s - 3ms/step - loss: 0.0865 - val_loss: 0.4437
Epoch 10/80
120/120 - 0s - 3ms/step - loss: 0.0842 - val_loss: 0.4533
Epoch 11/80
120/120 - 0s - 3ms/step - loss: 0.0819 - val_loss: 0.4589
Epoch 12/80
120/120 - 0s - 3ms/step - loss: 0.0828 - val_loss: 0.4413
Epoch 13/80
120/120 - 0s - 3ms/step - loss: 0.0816 - val_loss: 0.4528
Epoch 14/80
120/120 - 0s - 3ms/step - loss: 0.0777 - val_loss: 0.4594
Epoch 15/80
120/120 - 0s - 3ms/step - loss: 0.0767 - val_loss: 0.4608
Epoch 16/80
120/120 - 0s - 3ms/step - loss: 0.0791 - val_loss: 0.4577
Epoch 17/80
120/120 - 0s - 3ms/step - loss: 0.0757 - val_loss: 0.4494
Epoch 18/80
120/120 - 0s - 3ms/step - loss: 0.0733 - val_loss: 0.4626
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6769
Per-joint RMSE: 0.8270 1.0422 0.7686 0.3665 0.3770 0.3342
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:02:40.935153: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:02:40.960286: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 20
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 07:02:41.818433: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:41.823478: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:41.824352: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:41.826157: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:41.826951: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:41.827744: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:41.917021: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:41.917871: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:41.918615: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:41.919342: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:02:42.219394: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.652926e-01  RMSE=8.156547e-01
  per-joint RMSE: 1.0575 1.2122 0.9046 0.4520 0.4559 0.4167
Residual LSTM:  MSE=4.581936e-01      RMSE=6.769000e-01
  per-joint RMSE: 0.8270 1.0422 0.7686 0.3665 0.3770 0.3342
Combined torque MSE=4.581936e-01     RMSE=6.769000e-01
  per-joint RMSE: 0.8270 1.0422 0.7686 0.3665 0.3770 0.3342
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300.npz --H 25 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300.json
H=25, n_dof=6, feature_dim=6
X_train: (38086, 25, 6)  Y_train: (38086, 6)
X_test : (14734, 25, 6)  Y_test : (14734, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:02:44.325104: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:02:44.349435: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (38086, 25, 6), Y_train = (38086, 6)
  X_test  = (14734, 25, 6),  Y_test  = (14734, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:02:45.361056: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:45.366141: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:45.366930: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:45.368477: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:45.369259: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:45.369997: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:45.451181: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:45.452016: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:45.452841: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:45.453580: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:02:46.369261: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
120/120 - 2s - 14ms/step - loss: 0.6152 - val_loss: 1.9698
Epoch 2/80
120/120 - 0s - 3ms/step - loss: 0.4519 - val_loss: 1.8503
Epoch 3/80
120/120 - 0s - 3ms/step - loss: 0.3915 - val_loss: 1.6856
Epoch 4/80
120/120 - 0s - 3ms/step - loss: 0.3349 - val_loss: 1.5629
Epoch 5/80
120/120 - 0s - 3ms/step - loss: 0.2970 - val_loss: 1.5834
Epoch 6/80
120/120 - 0s - 3ms/step - loss: 0.2887 - val_loss: 1.5903
Epoch 7/80
120/120 - 0s - 3ms/step - loss: 0.2529 - val_loss: 1.7766
Epoch 8/80
120/120 - 0s - 3ms/step - loss: 0.2341 - val_loss: 1.8974
Epoch 9/80
120/120 - 0s - 3ms/step - loss: 0.2491 - val_loss: 1.4388
Epoch 10/80
120/120 - 0s - 3ms/step - loss: 0.2144 - val_loss: 1.4688
Epoch 11/80
120/120 - 0s - 3ms/step - loss: 0.2101 - val_loss: 1.3208
Epoch 12/80
120/120 - 0s - 3ms/step - loss: 0.2293 - val_loss: 1.5996
Epoch 13/80
120/120 - 0s - 3ms/step - loss: 0.1910 - val_loss: 1.6801
Epoch 14/80
120/120 - 0s - 3ms/step - loss: 0.1929 - val_loss: 1.4004
Epoch 15/80
120/120 - 0s - 3ms/step - loss: 0.1703 - val_loss: 1.4782
Epoch 16/80
120/120 - 0s - 3ms/step - loss: 0.1736 - val_loss: 1.4903
Epoch 17/80
120/120 - 0s - 3ms/step - loss: 0.1796 - val_loss: 1.4149
Epoch 18/80
120/120 - 0s - 3ms/step - loss: 0.1680 - val_loss: 1.3991
Epoch 19/80
120/120 - 0s - 3ms/step - loss: 0.1533 - val_loss: 1.3834
Epoch 20/80
120/120 - 0s - 3ms/step - loss: 0.1628 - val_loss: 1.4285
Epoch 21/80
120/120 - 0s - 3ms/step - loss: 0.1534 - val_loss: 1.4181
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7422
Per-joint RMSE: 0.9638 1.0834 0.8152 0.4407 0.4289 0.3991
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:02:54.702231: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:02:54.726844: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 20
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 07:02:55.578779: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:55.583416: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:55.584212: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:55.586734: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:55.587987: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:55.588862: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:55.667699: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:55.668745: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:55.669528: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:55.670267: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:02:55.964854: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.652926e-01  RMSE=8.156547e-01
  per-joint RMSE: 1.0575 1.2122 0.9046 0.4520 0.4559 0.4167
Residual LSTM:  MSE=5.508053e-01      RMSE=7.421626e-01
  per-joint RMSE: 0.9638 1.0834 0.8152 0.4407 0.4289 0.3991
Combined torque MSE=5.508053e-01     RMSE=7.421626e-01
  per-joint RMSE: 0.9638 1.0834 0.8152 0.4407 0.4289 0.3991
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300.npz --H 25 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300.json
H=25, n_dof=6, feature_dim=18
X_train: (38086, 25, 18)  Y_train: (38086, 6)
X_test : (14734, 25, 18)  Y_test : (14734, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:02:58.109956: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:02:58.133840: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (38086, 25, 18), Y_train = (38086, 6)
  X_test  = (14734, 25, 18),  Y_test  = (14734, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:02:59.215798: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:59.220308: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:59.221087: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:59.222644: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:59.223423: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:59.224157: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:59.307322: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:59.308214: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:59.309009: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:02:59.309800: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:03:00.279863: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
120/120 - 2s - 14ms/step - loss: 0.2917 - val_loss: 0.4889
Epoch 2/80
120/120 - 0s - 3ms/step - loss: 0.1719 - val_loss: 0.4543
Epoch 3/80
120/120 - 0s - 3ms/step - loss: 0.1455 - val_loss: 0.4465
Epoch 4/80
120/120 - 0s - 3ms/step - loss: 0.1324 - val_loss: 0.4426
Epoch 5/80
120/120 - 0s - 3ms/step - loss: 0.1246 - val_loss: 0.4374
Epoch 6/80
120/120 - 0s - 3ms/step - loss: 0.1163 - val_loss: 0.4318
Epoch 7/80
120/120 - 0s - 3ms/step - loss: 0.1103 - val_loss: 0.4438
Epoch 8/80
120/120 - 0s - 3ms/step - loss: 0.1082 - val_loss: 0.4414
Epoch 9/80
120/120 - 0s - 3ms/step - loss: 0.1034 - val_loss: 0.4181
Epoch 10/80
120/120 - 0s - 3ms/step - loss: 0.0990 - val_loss: 0.4226
Epoch 11/80
120/120 - 0s - 3ms/step - loss: 0.0974 - val_loss: 0.4386
Epoch 12/80
120/120 - 0s - 3ms/step - loss: 0.0948 - val_loss: 0.4216
Epoch 13/80
120/120 - 0s - 3ms/step - loss: 0.0945 - val_loss: 0.4276
Epoch 14/80
120/120 - 0s - 3ms/step - loss: 0.0956 - val_loss: 0.4212
Epoch 15/80
120/120 - 0s - 3ms/step - loss: 0.0924 - val_loss: 0.4173
Epoch 16/80
120/120 - 0s - 3ms/step - loss: 0.0902 - val_loss: 0.4184
Epoch 17/80
120/120 - 0s - 3ms/step - loss: 0.0872 - val_loss: 0.4309
Epoch 18/80
120/120 - 0s - 3ms/step - loss: 0.0861 - val_loss: 0.4573
Epoch 19/80
120/120 - 0s - 3ms/step - loss: 0.0841 - val_loss: 0.4388
Epoch 20/80
120/120 - 0s - 3ms/step - loss: 0.0809 - val_loss: 0.4374
Epoch 21/80
120/120 - 0s - 3ms/step - loss: 0.0825 - val_loss: 0.4159
Epoch 22/80
120/120 - 0s - 3ms/step - loss: 0.0793 - val_loss: 0.4185
Epoch 23/80
120/120 - 0s - 3ms/step - loss: 0.0783 - val_loss: 0.4197
Epoch 24/80
120/120 - 0s - 3ms/step - loss: 0.0769 - val_loss: 0.4157
Epoch 25/80
120/120 - 0s - 3ms/step - loss: 0.0776 - val_loss: 0.4181
Epoch 26/80
120/120 - 0s - 3ms/step - loss: 0.0778 - val_loss: 0.4427
Epoch 27/80
120/120 - 0s - 3ms/step - loss: 0.0776 - val_loss: 0.4272
Epoch 28/80
120/120 - 0s - 3ms/step - loss: 0.0763 - val_loss: 0.4181
Epoch 29/80
120/120 - 0s - 3ms/step - loss: 0.0751 - val_loss: 0.4277
Epoch 30/80
120/120 - 0s - 3ms/step - loss: 0.0746 - val_loss: 0.4338
Epoch 31/80
120/120 - 0s - 3ms/step - loss: 0.0733 - val_loss: 0.4296
Epoch 32/80
120/120 - 0s - 3ms/step - loss: 0.0707 - val_loss: 0.4230
Epoch 33/80
120/120 - 0s - 3ms/step - loss: 0.0719 - val_loss: 0.4065
Epoch 34/80
120/120 - 0s - 3ms/step - loss: 0.0711 - val_loss: 0.4257
Epoch 35/80
120/120 - 0s - 3ms/step - loss: 0.0694 - val_loss: 0.4255
Epoch 36/80
120/120 - 0s - 3ms/step - loss: 0.0717 - val_loss: 0.4227
Epoch 37/80
120/120 - 0s - 3ms/step - loss: 0.0700 - val_loss: 0.4214
Epoch 38/80
120/120 - 0s - 3ms/step - loss: 0.0674 - val_loss: 0.4185
Epoch 39/80
120/120 - 0s - 3ms/step - loss: 0.0670 - val_loss: 0.4248
Epoch 40/80
120/120 - 0s - 3ms/step - loss: 0.0669 - val_loss: 0.4187
Epoch 41/80
120/120 - 0s - 3ms/step - loss: 0.0682 - val_loss: 0.4067
Epoch 42/80
120/120 - 0s - 3ms/step - loss: 0.0673 - val_loss: 0.4097
Epoch 43/80
120/120 - 0s - 3ms/step - loss: 0.0702 - val_loss: 0.4110
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7780
Per-joint RMSE: 0.9986 1.1654 0.8675 0.4364 0.4311 0.3840
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:03:15.817047: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:03:15.841472: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 20
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:03:16.705969: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:16.710606: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:16.711401: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:16.713085: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:16.713874: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:16.714615: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:16.789109: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:16.789945: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:16.790743: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:16.791602: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:03:17.091356: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.652926e-01  RMSE=8.156547e-01
  per-joint RMSE: 1.0575 1.2122 0.9046 0.4520 0.4559 0.4167
Residual LSTM:  MSE=6.052918e-01      RMSE=7.780051e-01
  per-joint RMSE: 0.9986 1.1654 0.8675 0.4364 0.4311 0.3840
Combined torque MSE=6.052918e-01     RMSE=7.780051e-01
  per-joint RMSE: 0.9986 1.1654 0.8675 0.4364 0.4311 0.3840
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300.npz --H 25 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300.json
H=25, n_dof=6, feature_dim=18
X_train: (38086, 25, 18)  Y_train: (38086, 6)
X_test : (14734, 25, 18)  Y_test : (14734, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:03:19.232836: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:03:19.256604: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (38086, 25, 18), Y_train = (38086, 6)
  X_test  = (14734, 25, 18),  Y_test  = (14734, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:03:20.332850: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:20.337540: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:20.338942: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:20.340523: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:20.341312: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:20.342132: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:20.420596: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:20.421516: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:20.422258: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:20.422990: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:03:21.405314: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
120/120 - 2s - 14ms/step - loss: 0.2451 - val_loss: 0.5299
Epoch 2/80
120/120 - 0s - 3ms/step - loss: 0.1464 - val_loss: 0.5047
Epoch 3/80
120/120 - 0s - 3ms/step - loss: 0.1213 - val_loss: 0.4991
Epoch 4/80
120/120 - 0s - 3ms/step - loss: 0.1084 - val_loss: 0.4934
Epoch 5/80
120/120 - 0s - 3ms/step - loss: 0.1010 - val_loss: 0.4914
Epoch 6/80
120/120 - 0s - 3ms/step - loss: 0.0973 - val_loss: 0.4921
Epoch 7/80
120/120 - 0s - 3ms/step - loss: 0.0936 - val_loss: 0.4950
Epoch 8/80
120/120 - 0s - 3ms/step - loss: 0.0889 - val_loss: 0.4979
Epoch 9/80
120/120 - 0s - 3ms/step - loss: 0.0866 - val_loss: 0.4897
Epoch 10/80
120/120 - 0s - 3ms/step - loss: 0.0851 - val_loss: 0.4963
Epoch 11/80
120/120 - 0s - 3ms/step - loss: 0.0834 - val_loss: 0.4807
Epoch 12/80
120/120 - 0s - 3ms/step - loss: 0.0807 - val_loss: 0.4873
Epoch 13/80
120/120 - 0s - 3ms/step - loss: 0.0794 - val_loss: 0.4806
Epoch 14/80
120/120 - 0s - 3ms/step - loss: 0.0781 - val_loss: 0.4755
Epoch 15/80
120/120 - 0s - 3ms/step - loss: 0.0777 - val_loss: 0.4935
Epoch 16/80
120/120 - 0s - 3ms/step - loss: 0.0764 - val_loss: 0.4853
Epoch 17/80
120/120 - 0s - 3ms/step - loss: 0.0752 - val_loss: 0.4799
Epoch 18/80
120/120 - 0s - 3ms/step - loss: 0.0740 - val_loss: 0.4808
Epoch 19/80
120/120 - 0s - 3ms/step - loss: 0.0728 - val_loss: 0.4802
Epoch 20/80
120/120 - 0s - 3ms/step - loss: 0.0725 - val_loss: 0.4835
Epoch 21/80
120/120 - 0s - 3ms/step - loss: 0.0707 - val_loss: 0.4742
Epoch 22/80
120/120 - 0s - 3ms/step - loss: 0.0704 - val_loss: 0.4766
Epoch 23/80
120/120 - 0s - 3ms/step - loss: 0.0700 - val_loss: 0.4790
Epoch 24/80
120/120 - 0s - 3ms/step - loss: 0.0692 - val_loss: 0.4751
Epoch 25/80
120/120 - 0s - 3ms/step - loss: 0.0686 - val_loss: 0.4773
Epoch 26/80
120/120 - 0s - 3ms/step - loss: 0.0686 - val_loss: 0.4710
Epoch 27/80
120/120 - 0s - 3ms/step - loss: 0.0675 - val_loss: 0.4800
Epoch 28/80
120/120 - 0s - 3ms/step - loss: 0.0663 - val_loss: 0.4838
Epoch 29/80
120/120 - 0s - 3ms/step - loss: 0.0658 - val_loss: 0.4751
Epoch 30/80
120/120 - 0s - 3ms/step - loss: 0.0649 - val_loss: 0.4733
Epoch 31/80
120/120 - 0s - 3ms/step - loss: 0.0646 - val_loss: 0.4744
Epoch 32/80
120/120 - 0s - 3ms/step - loss: 0.0649 - val_loss: 0.4704
Epoch 33/80
120/120 - 0s - 3ms/step - loss: 0.0642 - val_loss: 0.4623
Epoch 34/80
120/120 - 0s - 3ms/step - loss: 0.0630 - val_loss: 0.4704
Epoch 35/80
120/120 - 0s - 3ms/step - loss: 0.0630 - val_loss: 0.4634
Epoch 36/80
120/120 - 0s - 3ms/step - loss: 0.0628 - val_loss: 0.4734
Epoch 37/80
120/120 - 0s - 3ms/step - loss: 0.0621 - val_loss: 0.4735
Epoch 38/80
120/120 - 0s - 3ms/step - loss: 0.0612 - val_loss: 0.4717
Epoch 39/80
120/120 - 0s - 3ms/step - loss: 0.0615 - val_loss: 0.4732
Epoch 40/80
120/120 - 0s - 3ms/step - loss: 0.0608 - val_loss: 0.4696
Epoch 41/80
120/120 - 0s - 3ms/step - loss: 0.0602 - val_loss: 0.4716
Epoch 42/80
120/120 - 0s - 3ms/step - loss: 0.0601 - val_loss: 0.4817
Epoch 43/80
120/120 - 0s - 3ms/step - loss: 0.0591 - val_loss: 0.4783
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6760
Per-joint RMSE: 0.8045 1.0688 0.7580 0.3688 0.3604 0.3342
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:03:36.929175: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:03:36.954003: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 20
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:03:37.811907: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:37.816463: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:37.817334: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:37.819191: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:37.819990: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:37.820730: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:37.899511: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:37.900430: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:37.901168: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:37.901892: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:03:38.214058: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.652926e-01  RMSE=8.156547e-01
  per-joint RMSE: 1.0575 1.2122 0.9046 0.4520 0.4559 0.4167
Residual LSTM:  MSE=4.569698e-01      RMSE=6.759954e-01
  per-joint RMSE: 0.8045 1.0688 0.7580 0.3688 0.3604 0.3342
Combined torque MSE=4.569698e-01     RMSE=6.759954e-01
  per-joint RMSE: 0.8045 1.0688 0.7580 0.3688 0.3604 0.3342
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300.npz --H 50 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300.json
H=50, n_dof=6, feature_dim=24
X_train: (37136, 50, 24)  Y_train: (37136, 6)
X_test : (14459, 50, 24)  Y_test : (14459, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:03:40.464869: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:03:40.488285: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (37136, 50, 24), Y_train = (37136, 6)
  X_test  = (14459, 50, 24),  Y_test  = (14459, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:03:41.871292: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:41.876267: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:41.877170: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:41.878968: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:41.879869: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:41.880726: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:41.973080: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:41.973971: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:41.974770: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:41.975641: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:03:43.063161: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
117/117 - 2s - 16ms/step - loss: 0.2461 - val_loss: 0.5588
Epoch 2/80
117/117 - 0s - 4ms/step - loss: 0.1393 - val_loss: 0.5611
Epoch 3/80
117/117 - 0s - 4ms/step - loss: 0.1163 - val_loss: 0.5547
Epoch 4/80
117/117 - 0s - 4ms/step - loss: 0.1055 - val_loss: 0.5641
Epoch 5/80
117/117 - 0s - 4ms/step - loss: 0.0984 - val_loss: 0.5445
Epoch 6/80
117/117 - 0s - 4ms/step - loss: 0.0944 - val_loss: 0.5423
Epoch 7/80
117/117 - 0s - 4ms/step - loss: 0.0906 - val_loss: 0.5324
Epoch 8/80
117/117 - 0s - 4ms/step - loss: 0.0882 - val_loss: 0.5061
Epoch 9/80
117/117 - 1s - 5ms/step - loss: 0.0869 - val_loss: 0.5195
Epoch 10/80
117/117 - 0s - 4ms/step - loss: 0.0834 - val_loss: 0.5269
Epoch 11/80
117/117 - 0s - 4ms/step - loss: 0.0816 - val_loss: 0.5017
Epoch 12/80
117/117 - 0s - 4ms/step - loss: 0.0796 - val_loss: 0.5146
Epoch 13/80
117/117 - 0s - 4ms/step - loss: 0.0795 - val_loss: 0.5066
Epoch 14/80
117/117 - 0s - 4ms/step - loss: 0.0775 - val_loss: 0.4923
Epoch 15/80
117/117 - 0s - 4ms/step - loss: 0.0761 - val_loss: 0.5016
Epoch 16/80
117/117 - 0s - 4ms/step - loss: 0.0745 - val_loss: 0.4942
Epoch 17/80
117/117 - 0s - 4ms/step - loss: 0.0741 - val_loss: 0.5095
Epoch 18/80
117/117 - 0s - 4ms/step - loss: 0.0728 - val_loss: 0.5086
Epoch 19/80
117/117 - 0s - 4ms/step - loss: 0.0714 - val_loss: 0.5132
Epoch 20/80
117/117 - 0s - 4ms/step - loss: 0.0705 - val_loss: 0.5006
Epoch 21/80
117/117 - 0s - 4ms/step - loss: 0.0703 - val_loss: 0.5172
Epoch 22/80
117/117 - 0s - 4ms/step - loss: 0.0692 - val_loss: 0.5041
Epoch 23/80
117/117 - 0s - 4ms/step - loss: 0.0680 - val_loss: 0.5130
Epoch 24/80
117/117 - 0s - 4ms/step - loss: 0.0666 - val_loss: 0.5135
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6807
Per-joint RMSE: 0.8263 1.0512 0.7642 0.3766 0.3756 0.3545
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:03:56.079294: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:03:56.104148: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 20
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 07:03:56.972666: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:56.977361: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:56.978153: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:56.979841: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:56.980634: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:56.981369: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:57.057036: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:57.057879: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:57.058615: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:03:57.059347: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:03:57.361507: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.738750e-01  RMSE=8.208989e-01
  per-joint RMSE: 1.0640 1.2206 0.9108 0.4537 0.4586 0.4190
Residual LSTM:  MSE=4.634035e-01      RMSE=6.807375e-01
  per-joint RMSE: 0.8263 1.0512 0.7642 0.3766 0.3756 0.3545
Combined torque MSE=4.634035e-01     RMSE=6.807375e-01
  per-joint RMSE: 0.8263 1.0512 0.7642 0.3766 0.3756 0.3545
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300.npz --H 50 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300.json
H=50, n_dof=6, feature_dim=6
X_train: (37136, 50, 6)  Y_train: (37136, 6)
X_test : (14459, 50, 6)  Y_test : (14459, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:03:59.516103: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:03:59.540090: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (37136, 50, 6), Y_train = (37136, 6)
  X_test  = (14459, 50, 6),  Y_test  = (14459, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:04:00.622531: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:00.627380: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:00.628242: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:00.629959: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:00.630931: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:00.631725: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:00.713193: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:00.714116: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:00.714948: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:00.715738: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:04:01.666088: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
117/117 - 2s - 15ms/step - loss: 0.5885 - val_loss: 1.7374
Epoch 2/80
117/117 - 0s - 4ms/step - loss: 0.3825 - val_loss: 1.6223
Epoch 3/80
117/117 - 0s - 4ms/step - loss: 0.3042 - val_loss: 1.5315
Epoch 4/80
117/117 - 0s - 4ms/step - loss: 0.2449 - val_loss: 1.1725
Epoch 5/80
117/117 - 0s - 4ms/step - loss: 0.2174 - val_loss: 1.1566
Epoch 6/80
117/117 - 0s - 4ms/step - loss: 0.1815 - val_loss: 1.2334
Epoch 7/80
117/117 - 0s - 4ms/step - loss: 0.1687 - val_loss: 1.1567
Epoch 8/80
117/117 - 0s - 4ms/step - loss: 0.1528 - val_loss: 1.2568
Epoch 9/80
117/117 - 1s - 5ms/step - loss: 0.1512 - val_loss: 1.1049
Epoch 10/80
117/117 - 0s - 4ms/step - loss: 0.1372 - val_loss: 1.1436
Epoch 11/80
117/117 - 0s - 4ms/step - loss: 0.1323 - val_loss: 1.1337
Epoch 12/80
117/117 - 0s - 4ms/step - loss: 0.1307 - val_loss: 1.2214
Epoch 13/80
117/117 - 0s - 4ms/step - loss: 0.1261 - val_loss: 1.1981
Epoch 14/80
117/117 - 0s - 4ms/step - loss: 0.1225 - val_loss: 1.2232
Epoch 15/80
117/117 - 0s - 4ms/step - loss: 0.1220 - val_loss: 1.2153
Epoch 16/80
117/117 - 0s - 4ms/step - loss: 0.1175 - val_loss: 1.1924
Epoch 17/80
117/117 - 0s - 4ms/step - loss: 0.1133 - val_loss: 1.1964
Epoch 18/80
117/117 - 0s - 4ms/step - loss: 0.1073 - val_loss: 1.1958
Epoch 19/80
117/117 - 0s - 4ms/step - loss: 0.1080 - val_loss: 1.2027
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7666
Per-joint RMSE: 1.0135 1.0884 0.8600 0.4598 0.4428 0.4092
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:04:12.154680: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:04:12.179139: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 20
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 07:04:13.033818: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:13.038363: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:13.039151: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:13.040782: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:13.041576: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:13.042307: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:13.124044: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:13.124968: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:13.125721: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:13.126455: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:04:13.429511: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.738750e-01  RMSE=8.208989e-01
  per-joint RMSE: 1.0640 1.2206 0.9108 0.4537 0.4586 0.4190
Residual LSTM:  MSE=5.877391e-01      RMSE=7.666414e-01
  per-joint RMSE: 1.0135 1.0884 0.8600 0.4598 0.4428 0.4092
Combined torque MSE=5.877391e-01     RMSE=7.666414e-01
  per-joint RMSE: 1.0135 1.0884 0.8600 0.4598 0.4428 0.4092
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300.npz --H 50 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300.json
H=50, n_dof=6, feature_dim=18
X_train: (37136, 50, 18)  Y_train: (37136, 6)
X_test : (14459, 50, 18)  Y_test : (14459, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:04:15.652163: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:04:15.675665: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (37136, 50, 18), Y_train = (37136, 6)
  X_test  = (14459, 50, 18),  Y_test  = (14459, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:04:16.906328: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:16.911716: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:16.912643: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:16.915029: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:16.915934: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:16.916794: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:17.002350: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:17.003322: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:17.004216: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:17.004992: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:04:17.980563: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
117/117 - 2s - 16ms/step - loss: 0.2921 - val_loss: 0.5041
Epoch 2/80
117/117 - 0s - 4ms/step - loss: 0.1732 - val_loss: 0.4830
Epoch 3/80
117/117 - 0s - 4ms/step - loss: 0.1476 - val_loss: 0.4583
Epoch 4/80
117/117 - 0s - 4ms/step - loss: 0.1344 - val_loss: 0.4678
Epoch 5/80
117/117 - 0s - 4ms/step - loss: 0.1252 - val_loss: 0.4671
Epoch 6/80
117/117 - 0s - 4ms/step - loss: 0.1189 - val_loss: 0.4385
Epoch 7/80
117/117 - 0s - 4ms/step - loss: 0.1128 - val_loss: 0.4418
Epoch 8/80
117/117 - 0s - 4ms/step - loss: 0.1085 - val_loss: 0.4715
Epoch 9/80
117/117 - 0s - 4ms/step - loss: 0.1038 - val_loss: 0.4595
Epoch 10/80
117/117 - 1s - 5ms/step - loss: 0.1022 - val_loss: 0.4473
Epoch 11/80
117/117 - 0s - 4ms/step - loss: 0.0998 - val_loss: 0.4597
Epoch 12/80
117/117 - 0s - 4ms/step - loss: 0.0980 - val_loss: 0.4325
Epoch 13/80
117/117 - 0s - 4ms/step - loss: 0.0966 - val_loss: 0.4500
Epoch 14/80
117/117 - 0s - 4ms/step - loss: 0.0940 - val_loss: 0.4525
Epoch 15/80
117/117 - 0s - 4ms/step - loss: 0.0922 - val_loss: 0.4543
Epoch 16/80
117/117 - 0s - 4ms/step - loss: 0.0887 - val_loss: 0.5139
Epoch 17/80
117/117 - 0s - 4ms/step - loss: 0.0900 - val_loss: 0.4935
Epoch 18/80
117/117 - 0s - 4ms/step - loss: 0.0869 - val_loss: 0.4361
Epoch 19/80
117/117 - 0s - 4ms/step - loss: 0.0842 - val_loss: 0.4643
Epoch 20/80
117/117 - 0s - 4ms/step - loss: 0.0830 - val_loss: 0.4507
Epoch 21/80
117/117 - 0s - 4ms/step - loss: 0.0819 - val_loss: 0.4733
Epoch 22/80
117/117 - 0s - 4ms/step - loss: 0.0791 - val_loss: 0.5291
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7902
Per-joint RMSE: 1.0269 1.1724 0.8853 0.4308 0.4444 0.3880
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:04:29.918445: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:04:29.944056: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 20
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:04:30.803828: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:30.808406: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:30.809197: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:30.810889: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:30.811678: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:30.812409: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:30.892175: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:30.893016: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:30.893838: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:30.894561: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:04:31.204168: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.738750e-01  RMSE=8.208989e-01
  per-joint RMSE: 1.0640 1.2206 0.9108 0.4537 0.4586 0.4190
Residual LSTM:  MSE=6.244103e-01      RMSE=7.901964e-01
  per-joint RMSE: 1.0269 1.1724 0.8853 0.4308 0.4444 0.3880
Combined torque MSE=6.244103e-01     RMSE=7.901964e-01
  per-joint RMSE: 1.0269 1.1724 0.8853 0.4308 0.4444 0.3880
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300.npz --H 50 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300.json
H=50, n_dof=6, feature_dim=18
X_train: (37136, 50, 18)  Y_train: (37136, 6)
X_test : (14459, 50, 18)  Y_test : (14459, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:04:33.420601: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:04:33.444092: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (37136, 50, 18), Y_train = (37136, 6)
  X_test  = (14459, 50, 18),  Y_test  = (14459, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:04:34.664696: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:34.669627: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:34.670492: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:34.672790: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:34.673660: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:34.674652: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:34.758019: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:34.758908: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:34.759712: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:34.760498: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:04:35.727665: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
117/117 - 2s - 16ms/step - loss: 0.2482 - val_loss: 0.5153
Epoch 2/80
117/117 - 0s - 4ms/step - loss: 0.1388 - val_loss: 0.5222
Epoch 3/80
117/117 - 0s - 4ms/step - loss: 0.1165 - val_loss: 0.5354
Epoch 4/80
117/117 - 0s - 4ms/step - loss: 0.1069 - val_loss: 0.5378
Epoch 5/80
117/117 - 0s - 4ms/step - loss: 0.0995 - val_loss: 0.5283
Epoch 6/80
117/117 - 0s - 4ms/step - loss: 0.0953 - val_loss: 0.5397
Epoch 7/80
117/117 - 0s - 4ms/step - loss: 0.0920 - val_loss: 0.5348
Epoch 8/80
117/117 - 0s - 4ms/step - loss: 0.0890 - val_loss: 0.5153
Epoch 9/80
117/117 - 0s - 4ms/step - loss: 0.0867 - val_loss: 0.5160
Epoch 10/80
117/117 - 1s - 4ms/step - loss: 0.0849 - val_loss: 0.5307
Epoch 11/80
117/117 - 0s - 4ms/step - loss: 0.0825 - val_loss: 0.5217
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7286
Per-joint RMSE: 0.9020 1.1195 0.8301 0.3900 0.3926 0.3501
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:04:42.519381: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:04:42.544709: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s1_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 20
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:04:43.394618: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:43.399131: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:43.399920: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:43.401584: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:43.402371: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:43.403107: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:43.479143: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:43.479978: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:43.480725: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:04:43.485213: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:04:43.795649: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.738750e-01  RMSE=8.208989e-01
  per-joint RMSE: 1.0640 1.2206 0.9108 0.4537 0.4586 0.4190
Residual LSTM:  MSE=5.307925e-01      RMSE=7.285551e-01
  per-joint RMSE: 0.9020 1.1195 0.8301 0.3900 0.3926 0.3501
Combined torque MSE=5.307925e-01     RMSE=7.285551e-01
  per-joint RMSE: 0.9020 1.1195 0.8301 0.3900 0.3926 0.3501
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=2                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz                                ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p2_seed0_dataset.npz -t structured -s 2 -r 0 --hp_preset fast_debug --epochs 300 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300.jax' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 300, 'lagrangian_type': <function structured_lagrangian_fn at 0x70b7c16c41f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K100_tf0p2_seed0_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p2_seed0_dataset.npz
   dt ≈ 0.022972524931080995
  dof = 6
  Train trajectories = 80
  Test trajectories  = 20
  Train samples = 39124
  Test samples  = 15025
################################################

2026-01-22 07:04:48.273859: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300 | type=structured | dof=6
################################################
2026-01-22 07:04:51.408068: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:04:51.408104: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:04:51.408110: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:04:51.408138: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:04:51.408143: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:04:51.408158: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:04:51.408196: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:04:51.408201: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:04:51.408217: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:04:51.408221: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.2s, Loss=1.00e+01, Inv=1.00e+01, For=1.35e+02, Power=2.60e+00
  [eval] test_mse=1.639e+00  (n=15025)
Epoch 00050: Time=  11.4s, Loss=2.56e+00, Inv=2.56e+00, For=1.08e+02, Power=1.30e+00
Epoch 00100: Time=  16.4s, Loss=2.30e+00, Inv=2.30e+00, For=1.18e+02, Power=1.11e+00
Epoch 00150: Time=  21.6s, Loss=2.17e+00, Inv=2.17e+00, For=1.63e+02, Power=1.03e+00
Epoch 00200: Time=  26.6s, Loss=2.10e+00, Inv=2.10e+00, For=2.63e+02, Power=9.94e-01
  [eval] test_mse=3.888e+00  (n=15025)
Epoch 00250: Time=  31.7s, Loss=2.05e+00, Inv=2.05e+00, For=3.13e+02, Power=9.75e-01
Epoch 00300: Time=  36.5s, Loss=2.01e+00, Inv=2.01e+00, For=3.44e+02, Power=9.64e-01
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300
Torque MSE  = 8.286e-01
Torque RMSE = 9.103e-01
Per-joint MSE : 1.178e+00 2.112e+00 1.214e+00 1.808e-01 1.400e-01 1.473e-01
Per-joint RMSE: 1.085e+00 1.453e+00 1.102e+00 4.252e-01 3.742e-01 3.838e-01
Comp Time per Sample = 2.259e-08s / 44270472.6Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p2_seed0_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p2_seed0_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300.jax
Detected n_dof=6 (seed=2)
2026-01-22 07:05:30.071698: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 80 trajectories
2026-01-22 07:05:31.394190: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:05:31.394203: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:05:33.038470: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:05:34.206067: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:05:34.206083: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/80
  done 50/80
2026-01-22 07:05:36.883022: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 75/80
2026-01-22 07:05:38.098185: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 80/80

Exporting split=test: 20 trajectories
  done 20/20

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300.npz --H 25 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300.json
H=25, n_dof=6, feature_dim=24
X_train: (38086, 25, 24)  Y_train: (38086, 6)
X_test : (14734, 25, 24)  Y_test : (14734, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:05:40.303626: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:05:40.327361: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (38086, 25, 24), Y_train = (38086, 6)
  X_test  = (14734, 25, 24),  Y_test  = (14734, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:05:41.496138: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:41.501505: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:41.502456: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:41.504104: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:41.505025: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:41.505903: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:41.596875: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:41.597934: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:41.598742: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:41.599525: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:05:42.597676: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
120/120 - 2s - 14ms/step - loss: 0.2460 - val_loss: 0.5048
Epoch 2/80
120/120 - 0s - 3ms/step - loss: 0.1417 - val_loss: 0.4960
Epoch 3/80
120/120 - 0s - 3ms/step - loss: 0.1192 - val_loss: 0.4969
Epoch 4/80
120/120 - 0s - 3ms/step - loss: 0.1096 - val_loss: 0.4854
Epoch 5/80
120/120 - 0s - 3ms/step - loss: 0.1023 - val_loss: 0.4740
Epoch 6/80
120/120 - 0s - 3ms/step - loss: 0.0960 - val_loss: 0.4722
Epoch 7/80
120/120 - 0s - 3ms/step - loss: 0.0925 - val_loss: 0.4685
Epoch 8/80
120/120 - 0s - 3ms/step - loss: 0.0901 - val_loss: 0.4772
Epoch 9/80
120/120 - 0s - 3ms/step - loss: 0.0889 - val_loss: 0.4749
Epoch 10/80
120/120 - 0s - 3ms/step - loss: 0.0843 - val_loss: 0.4737
Epoch 11/80
120/120 - 0s - 3ms/step - loss: 0.0819 - val_loss: 0.4747
Epoch 12/80
120/120 - 0s - 3ms/step - loss: 0.0801 - val_loss: 0.4724
Epoch 13/80
120/120 - 0s - 3ms/step - loss: 0.0795 - val_loss: 0.4687
Epoch 14/80
120/120 - 0s - 3ms/step - loss: 0.0772 - val_loss: 0.4736
Epoch 15/80
120/120 - 0s - 3ms/step - loss: 0.0764 - val_loss: 0.4733
Epoch 16/80
120/120 - 0s - 3ms/step - loss: 0.0753 - val_loss: 0.4707
Epoch 17/80
120/120 - 0s - 3ms/step - loss: 0.0746 - val_loss: 0.4787
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7594
Per-joint RMSE: 0.9136 1.1833 0.9456 0.3648 0.3234 0.3057
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:05:49.799293: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:05:49.824158: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 20
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 07:05:50.679748: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:50.684544: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:50.685383: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:50.687238: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:50.688099: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:50.688891: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:50.773551: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:50.774534: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:50.775324: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:50.776108: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:05:51.078357: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=8.412530e-01  RMSE=9.171985e-01
  per-joint RMSE: 1.0943 1.4644 1.1101 0.4274 0.3763 0.3860
Residual LSTM:  MSE=5.766822e-01      RMSE=7.593959e-01
  per-joint RMSE: 0.9136 1.1833 0.9456 0.3648 0.3234 0.3057
Combined torque MSE=5.766822e-01     RMSE=7.593959e-01
  per-joint RMSE: 0.9136 1.1833 0.9456 0.3648 0.3234 0.3057
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300.npz --H 25 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300.json
H=25, n_dof=6, feature_dim=6
X_train: (38086, 25, 6)  Y_train: (38086, 6)
X_test : (14734, 25, 6)  Y_test : (14734, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:05:53.180321: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:05:53.204468: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (38086, 25, 6), Y_train = (38086, 6)
  X_test  = (14734, 25, 6),  Y_test  = (14734, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:05:54.200003: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:54.204549: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:54.205416: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:54.206946: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:54.207728: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:54.208461: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:54.286994: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:54.287903: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:54.288647: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:05:54.289384: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:05:55.214596: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
120/120 - 2s - 14ms/step - loss: 0.6271 - val_loss: 1.6598
Epoch 2/80
120/120 - 0s - 3ms/step - loss: 0.4591 - val_loss: 1.7219
Epoch 3/80
120/120 - 0s - 3ms/step - loss: 0.3789 - val_loss: 1.6166
Epoch 4/80
120/120 - 0s - 3ms/step - loss: 0.3278 - val_loss: 1.4597
Epoch 5/80
120/120 - 0s - 3ms/step - loss: 0.2967 - val_loss: 1.5614
Epoch 6/80
120/120 - 0s - 3ms/step - loss: 0.3000 - val_loss: 1.3455
Epoch 7/80
120/120 - 0s - 3ms/step - loss: 0.2520 - val_loss: 1.4527
Epoch 8/80
120/120 - 0s - 3ms/step - loss: 0.2394 - val_loss: 1.3744
Epoch 9/80
120/120 - 0s - 3ms/step - loss: 0.2329 - val_loss: 1.4329
Epoch 10/80
120/120 - 0s - 3ms/step - loss: 0.2150 - val_loss: 1.4344
Epoch 11/80
120/120 - 0s - 3ms/step - loss: 0.1962 - val_loss: 1.2828
Epoch 12/80
120/120 - 0s - 3ms/step - loss: 0.1839 - val_loss: 1.4079
Epoch 13/80
120/120 - 0s - 3ms/step - loss: 0.1752 - val_loss: 1.4531
Epoch 14/80
120/120 - 0s - 3ms/step - loss: 0.1952 - val_loss: 1.3351
Epoch 15/80
120/120 - 0s - 3ms/step - loss: 0.2235 - val_loss: 1.4161
Epoch 16/80
120/120 - 0s - 3ms/step - loss: 0.1911 - val_loss: 1.3321
Epoch 17/80
120/120 - 0s - 3ms/step - loss: 0.1726 - val_loss: 1.3476
Epoch 18/80
120/120 - 0s - 3ms/step - loss: 0.1808 - val_loss: 1.4148
Epoch 19/80
120/120 - 0s - 3ms/step - loss: 0.1631 - val_loss: 1.3956
Epoch 20/80
120/120 - 0s - 3ms/step - loss: 0.1633 - val_loss: 1.3365
Epoch 21/80
120/120 - 0s - 3ms/step - loss: 0.1571 - val_loss: 1.2363
Epoch 22/80
120/120 - 0s - 3ms/step - loss: 0.1809 - val_loss: 1.2728
Epoch 23/80
120/120 - 0s - 3ms/step - loss: 0.1543 - val_loss: 1.3393
Epoch 24/80
120/120 - 0s - 3ms/step - loss: 0.1479 - val_loss: 1.2450
Epoch 25/80
120/120 - 0s - 3ms/step - loss: 0.1494 - val_loss: 1.2902
Epoch 26/80
120/120 - 0s - 3ms/step - loss: 0.1510 - val_loss: 1.3166
Epoch 27/80
120/120 - 0s - 3ms/step - loss: 0.1318 - val_loss: 1.2159
Epoch 28/80
120/120 - 0s - 3ms/step - loss: 0.1475 - val_loss: 1.3093
Epoch 29/80
120/120 - 0s - 3ms/step - loss: 0.1422 - val_loss: 1.3522
Epoch 30/80
120/120 - 0s - 3ms/step - loss: 0.1424 - val_loss: 1.3092
Epoch 31/80
120/120 - 0s - 3ms/step - loss: 0.1320 - val_loss: 1.3082
Epoch 32/80
120/120 - 0s - 3ms/step - loss: 0.1275 - val_loss: 1.2895
Epoch 33/80
120/120 - 0s - 3ms/step - loss: 0.1328 - val_loss: 1.2822
Epoch 34/80
120/120 - 0s - 3ms/step - loss: 0.1245 - val_loss: 1.3078
Epoch 35/80
120/120 - 0s - 3ms/step - loss: 0.1220 - val_loss: 1.2652
Epoch 36/80
120/120 - 0s - 3ms/step - loss: 0.1201 - val_loss: 1.3137
Epoch 37/80
120/120 - 0s - 3ms/step - loss: 0.1201 - val_loss: 1.3232
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.8515
Per-joint RMSE: 1.0654 1.2537 1.0890 0.4229 0.3703 0.3762
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:06:08.714840: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:06:08.739669: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 20
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 07:06:09.611128: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:09.615971: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:09.616775: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:09.618451: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:09.619248: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:09.619986: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:09.704101: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:09.705004: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:09.705748: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:09.706480: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:06:10.001754: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=8.412530e-01  RMSE=9.171985e-01
  per-joint RMSE: 1.0943 1.4644 1.1101 0.4274 0.3763 0.3860
Residual LSTM:  MSE=7.250305e-01      RMSE=8.514873e-01
  per-joint RMSE: 1.0654 1.2537 1.0890 0.4229 0.3703 0.3762
Combined torque MSE=7.250305e-01     RMSE=8.514873e-01
  per-joint RMSE: 1.0654 1.2537 1.0890 0.4229 0.3703 0.3762
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300.npz --H 25 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300.json
H=25, n_dof=6, feature_dim=18
X_train: (38086, 25, 18)  Y_train: (38086, 6)
X_test : (14734, 25, 18)  Y_test : (14734, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:06:12.146041: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:06:12.170091: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (38086, 25, 18), Y_train = (38086, 6)
  X_test  = (14734, 25, 18),  Y_test  = (14734, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:06:13.246087: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:13.250934: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:13.251799: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:13.253399: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:13.254177: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:13.254912: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:13.329185: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:13.330110: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:13.330861: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:13.331599: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:06:14.273136: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
120/120 - 2s - 14ms/step - loss: 0.2896 - val_loss: 0.5173
Epoch 2/80
120/120 - 0s - 3ms/step - loss: 0.1717 - val_loss: 0.4819
Epoch 3/80
120/120 - 0s - 3ms/step - loss: 0.1492 - val_loss: 0.4451
Epoch 4/80
120/120 - 0s - 3ms/step - loss: 0.1348 - val_loss: 0.4290
Epoch 5/80
120/120 - 0s - 3ms/step - loss: 0.1256 - val_loss: 0.4188
Epoch 6/80
120/120 - 0s - 3ms/step - loss: 0.1182 - val_loss: 0.4268
Epoch 7/80
120/120 - 0s - 3ms/step - loss: 0.1150 - val_loss: 0.4136
Epoch 8/80
120/120 - 0s - 3ms/step - loss: 0.1076 - val_loss: 0.4304
Epoch 9/80
120/120 - 0s - 3ms/step - loss: 0.1060 - val_loss: 0.4249
Epoch 10/80
120/120 - 0s - 3ms/step - loss: 0.0991 - val_loss: 0.4239
Epoch 11/80
120/120 - 0s - 3ms/step - loss: 0.1003 - val_loss: 0.4291
Epoch 12/80
120/120 - 0s - 2ms/step - loss: 0.0970 - val_loss: 0.4137
Epoch 13/80
120/120 - 0s - 3ms/step - loss: 0.0970 - val_loss: 0.4222
Epoch 14/80
120/120 - 0s - 3ms/step - loss: 0.0938 - val_loss: 0.4430
Epoch 15/80
120/120 - 0s - 3ms/step - loss: 0.0912 - val_loss: 0.4139
Epoch 16/80
120/120 - 0s - 3ms/step - loss: 0.0884 - val_loss: 0.4435
Epoch 17/80
120/120 - 0s - 3ms/step - loss: 0.0894 - val_loss: 0.4689
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.8784
Per-joint RMSE: 1.0597 1.3844 1.0853 0.4035 0.3575 0.3488
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:06:21.308121: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:06:21.333338: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 20
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:06:22.176895: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:22.181507: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:22.182380: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:22.184058: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:22.184932: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:22.185735: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:22.269553: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:22.270397: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:22.271142: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:22.271874: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:06:22.568293: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=8.412530e-01  RMSE=9.171985e-01
  per-joint RMSE: 1.0943 1.4644 1.1101 0.4274 0.3763 0.3860
Residual LSTM:  MSE=7.716302e-01      RMSE=8.784248e-01
  per-joint RMSE: 1.0597 1.3844 1.0853 0.4035 0.3575 0.3488
Combined torque MSE=7.716302e-01     RMSE=8.784248e-01
  per-joint RMSE: 1.0597 1.3844 1.0853 0.4035 0.3575 0.3488
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300.npz --H 25 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300.json
H=25, n_dof=6, feature_dim=18
X_train: (38086, 25, 18)  Y_train: (38086, 6)
X_test : (14734, 25, 18)  Y_test : (14734, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:06:24.702591: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:06:24.726508: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (38086, 25, 18), Y_train = (38086, 6)
  X_test  = (14734, 25, 18),  Y_test  = (14734, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:06:25.797981: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:25.802838: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:25.803628: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:25.805280: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:25.806077: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:25.806805: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:25.881391: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:25.882225: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:25.882967: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:25.883696: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:06:26.820301: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
120/120 - 2s - 14ms/step - loss: 0.2487 - val_loss: 0.5022
Epoch 2/80
120/120 - 0s - 3ms/step - loss: 0.1451 - val_loss: 0.4852
Epoch 3/80
120/120 - 0s - 3ms/step - loss: 0.1207 - val_loss: 0.4821
Epoch 4/80
120/120 - 0s - 3ms/step - loss: 0.1091 - val_loss: 0.4912
Epoch 5/80
120/120 - 0s - 3ms/step - loss: 0.1011 - val_loss: 0.4835
Epoch 6/80
120/120 - 0s - 3ms/step - loss: 0.0966 - val_loss: 0.4811
Epoch 7/80
120/120 - 0s - 3ms/step - loss: 0.0942 - val_loss: 0.4684
Epoch 8/80
120/120 - 0s - 3ms/step - loss: 0.0891 - val_loss: 0.4642
Epoch 9/80
120/120 - 0s - 3ms/step - loss: 0.0871 - val_loss: 0.4607
Epoch 10/80
120/120 - 0s - 3ms/step - loss: 0.0857 - val_loss: 0.4671
Epoch 11/80
120/120 - 0s - 3ms/step - loss: 0.0830 - val_loss: 0.4681
Epoch 12/80
120/120 - 0s - 3ms/step - loss: 0.0817 - val_loss: 0.4731
Epoch 13/80
120/120 - 0s - 3ms/step - loss: 0.0799 - val_loss: 0.4605
Epoch 14/80
120/120 - 0s - 3ms/step - loss: 0.0791 - val_loss: 0.4650
Epoch 15/80
120/120 - 0s - 3ms/step - loss: 0.0773 - val_loss: 0.4652
Epoch 16/80
120/120 - 0s - 3ms/step - loss: 0.0762 - val_loss: 0.4676
Epoch 17/80
120/120 - 0s - 3ms/step - loss: 0.0760 - val_loss: 0.4727
Epoch 18/80
120/120 - 0s - 3ms/step - loss: 0.0744 - val_loss: 0.4658
Epoch 19/80
120/120 - 0s - 3ms/step - loss: 0.0734 - val_loss: 0.4687
Epoch 20/80
120/120 - 0s - 3ms/step - loss: 0.0723 - val_loss: 0.4714
Epoch 21/80
120/120 - 0s - 3ms/step - loss: 0.0708 - val_loss: 0.4677
Epoch 22/80
120/120 - 0s - 3ms/step - loss: 0.0713 - val_loss: 0.4652
Epoch 23/80
120/120 - 0s - 3ms/step - loss: 0.0697 - val_loss: 0.4724
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7899
Per-joint RMSE: 0.8929 1.2843 0.9713 0.3851 0.3306 0.3094
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:06:35.871563: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:06:35.896565: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 20
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:06:36.750081: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:36.754711: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:36.755509: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:36.757146: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:36.757942: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:36.758741: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:36.844731: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:36.845588: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:36.846225: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:36.846966: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:06:37.147986: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=8.412530e-01  RMSE=9.171985e-01
  per-joint RMSE: 1.0943 1.4644 1.1101 0.4274 0.3763 0.3860
Residual LSTM:  MSE=6.239570e-01      RMSE=7.899095e-01
  per-joint RMSE: 0.8929 1.2843 0.9713 0.3851 0.3306 0.3094
Combined torque MSE=6.239570e-01     RMSE=7.899095e-01
  per-joint RMSE: 0.8929 1.2843 0.9713 0.3851 0.3306 0.3094
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300.npz --H 50 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300.json
H=50, n_dof=6, feature_dim=24
X_train: (37136, 50, 24)  Y_train: (37136, 6)
X_test : (14459, 50, 24)  Y_test : (14459, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:06:39.411018: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:06:39.434727: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (37136, 50, 24), Y_train = (37136, 6)
  X_test  = (14459, 50, 24),  Y_test  = (14459, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:06:40.788034: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:40.793050: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:40.793969: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:40.795671: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:40.796598: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:40.797454: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:40.884752: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:40.885650: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:40.886448: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:40.887238: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:06:41.969390: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
117/117 - 2s - 16ms/step - loss: 0.2459 - val_loss: 0.5274
Epoch 2/80
117/117 - 0s - 4ms/step - loss: 0.1405 - val_loss: 0.5264
Epoch 3/80
117/117 - 0s - 4ms/step - loss: 0.1184 - val_loss: 0.5210
Epoch 4/80
117/117 - 0s - 4ms/step - loss: 0.1078 - val_loss: 0.5104
Epoch 5/80
117/117 - 0s - 4ms/step - loss: 0.1003 - val_loss: 0.5070
Epoch 6/80
117/117 - 0s - 4ms/step - loss: 0.0950 - val_loss: 0.4998
Epoch 7/80
117/117 - 0s - 4ms/step - loss: 0.0914 - val_loss: 0.5177
Epoch 8/80
117/117 - 0s - 4ms/step - loss: 0.0880 - val_loss: 0.4975
Epoch 9/80
117/117 - 1s - 4ms/step - loss: 0.0863 - val_loss: 0.5045
Epoch 10/80
117/117 - 0s - 4ms/step - loss: 0.0840 - val_loss: 0.5249
Epoch 11/80
117/117 - 0s - 4ms/step - loss: 0.0826 - val_loss: 0.5100
Epoch 12/80
117/117 - 0s - 4ms/step - loss: 0.0806 - val_loss: 0.5077
Epoch 13/80
117/117 - 0s - 4ms/step - loss: 0.0789 - val_loss: 0.5021
Epoch 14/80
117/117 - 0s - 4ms/step - loss: 0.0779 - val_loss: 0.4927
Epoch 15/80
117/117 - 0s - 4ms/step - loss: 0.0766 - val_loss: 0.4941
Epoch 16/80
117/117 - 0s - 4ms/step - loss: 0.0750 - val_loss: 0.5037
Epoch 17/80
117/117 - 0s - 4ms/step - loss: 0.0754 - val_loss: 0.4956
Epoch 18/80
117/117 - 0s - 4ms/step - loss: 0.0737 - val_loss: 0.5330
Epoch 19/80
117/117 - 0s - 4ms/step - loss: 0.0725 - val_loss: 0.4972
Epoch 20/80
117/117 - 0s - 4ms/step - loss: 0.0710 - val_loss: 0.4990
Epoch 21/80
117/117 - 0s - 4ms/step - loss: 0.0708 - val_loss: 0.5033
Epoch 22/80
117/117 - 0s - 4ms/step - loss: 0.0699 - val_loss: 0.4928
Epoch 23/80
117/117 - 0s - 4ms/step - loss: 0.0687 - val_loss: 0.4876
Epoch 24/80
117/117 - 0s - 4ms/step - loss: 0.0679 - val_loss: 0.4967
Epoch 25/80
117/117 - 0s - 4ms/step - loss: 0.0673 - val_loss: 0.4957
Epoch 26/80
117/117 - 0s - 4ms/step - loss: 0.0670 - val_loss: 0.4930
Epoch 27/80
117/117 - 0s - 4ms/step - loss: 0.0660 - val_loss: 0.4942
Epoch 28/80
117/117 - 0s - 4ms/step - loss: 0.0652 - val_loss: 0.4941
Epoch 29/80
117/117 - 0s - 4ms/step - loss: 0.0649 - val_loss: 0.4956
Epoch 30/80
117/117 - 0s - 4ms/step - loss: 0.0640 - val_loss: 0.5082
Epoch 31/80
117/117 - 0s - 4ms/step - loss: 0.0641 - val_loss: 0.4922
Epoch 32/80
117/117 - 0s - 4ms/step - loss: 0.0635 - val_loss: 0.4908
Epoch 33/80
117/117 - 0s - 4ms/step - loss: 0.0629 - val_loss: 0.4920
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7629
Per-joint RMSE: 0.8871 1.2166 0.9509 0.3645 0.3061 0.3071
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:06:59.069020: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:06:59.094103: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 20
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 07:06:59.943950: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:59.948805: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:59.949664: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:59.951437: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:59.952315: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:06:59.953108: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:00.036767: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:00.037606: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:00.038408: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:00.039138: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:07:00.350061: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=8.545595e-01  RMSE=9.244239e-01
  per-joint RMSE: 1.1030 1.4766 1.1189 0.4291 0.3786 0.3884
Residual LSTM:  MSE=5.820112e-01      RMSE=7.628965e-01
  per-joint RMSE: 0.8871 1.2166 0.9509 0.3645 0.3061 0.3071
Combined torque MSE=5.820112e-01     RMSE=7.628965e-01
  per-joint RMSE: 0.8871 1.2166 0.9509 0.3645 0.3061 0.3071
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300.npz --H 50 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300.json
H=50, n_dof=6, feature_dim=6
X_train: (37136, 50, 6)  Y_train: (37136, 6)
X_test : (14459, 50, 6)  Y_test : (14459, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:07:02.500137: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:07:02.524317: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (37136, 50, 6), Y_train = (37136, 6)
  X_test  = (14459, 50, 6),  Y_test  = (14459, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:07:03.611211: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:03.616130: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:03.616921: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:03.618460: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:03.619238: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:03.619971: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:03.696265: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:03.697107: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:03.697861: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:03.698598: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:07:04.618612: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
117/117 - 2s - 15ms/step - loss: 0.5895 - val_loss: 1.7822
Epoch 2/80
117/117 - 0s - 4ms/step - loss: 0.3797 - val_loss: 1.8029
Epoch 3/80
117/117 - 0s - 4ms/step - loss: 0.2922 - val_loss: 1.3694
Epoch 4/80
117/117 - 0s - 4ms/step - loss: 0.2532 - val_loss: 1.2390
Epoch 5/80
117/117 - 0s - 4ms/step - loss: 0.2203 - val_loss: 1.3698
Epoch 6/80
117/117 - 0s - 4ms/step - loss: 0.1909 - val_loss: 1.3126
Epoch 7/80
117/117 - 0s - 4ms/step - loss: 0.1780 - val_loss: 1.4371
Epoch 8/80
117/117 - 0s - 4ms/step - loss: 0.1750 - val_loss: 1.4192
Epoch 9/80
117/117 - 0s - 4ms/step - loss: 0.1576 - val_loss: 1.4007
Epoch 10/80
117/117 - 1s - 4ms/step - loss: 0.1666 - val_loss: 1.3089
Epoch 11/80
117/117 - 0s - 4ms/step - loss: 0.1465 - val_loss: 1.2757
Epoch 12/80
117/117 - 0s - 4ms/step - loss: 0.1410 - val_loss: 1.2810
Epoch 13/80
117/117 - 0s - 4ms/step - loss: 0.1235 - val_loss: 1.2320
Epoch 14/80
117/117 - 0s - 4ms/step - loss: 0.1238 - val_loss: 1.1867
Epoch 15/80
117/117 - 0s - 4ms/step - loss: 0.1192 - val_loss: 1.2341
Epoch 16/80
117/117 - 0s - 4ms/step - loss: 0.1138 - val_loss: 1.2193
Epoch 17/80
117/117 - 0s - 4ms/step - loss: 0.1094 - val_loss: 1.2195
Epoch 18/80
117/117 - 0s - 4ms/step - loss: 0.1079 - val_loss: 1.2959
Epoch 19/80
117/117 - 0s - 4ms/step - loss: 0.1121 - val_loss: 1.1861
Epoch 20/80
117/117 - 0s - 4ms/step - loss: 0.1016 - val_loss: 1.2237
Epoch 21/80
117/117 - 0s - 4ms/step - loss: 0.0982 - val_loss: 1.2594
Epoch 22/80
117/117 - 0s - 4ms/step - loss: 0.0989 - val_loss: 1.2355
Epoch 23/80
117/117 - 0s - 4ms/step - loss: 0.0978 - val_loss: 1.2188
Epoch 24/80
117/117 - 0s - 4ms/step - loss: 0.1086 - val_loss: 1.2595
Epoch 25/80
117/117 - 0s - 4ms/step - loss: 0.1063 - val_loss: 1.2671
Epoch 26/80
117/117 - 0s - 4ms/step - loss: 0.0998 - val_loss: 1.2258
Epoch 27/80
117/117 - 0s - 4ms/step - loss: 0.0948 - val_loss: 1.2232
Epoch 28/80
117/117 - 0s - 4ms/step - loss: 0.0906 - val_loss: 1.2453
Epoch 29/80
117/117 - 0s - 4ms/step - loss: 0.0880 - val_loss: 1.1795
Epoch 30/80
117/117 - 0s - 4ms/step - loss: 0.0929 - val_loss: 1.2372
Epoch 31/80
117/117 - 0s - 4ms/step - loss: 0.0908 - val_loss: 1.2020
Epoch 32/80
117/117 - 0s - 4ms/step - loss: 0.0851 - val_loss: 1.2032
Epoch 33/80
117/117 - 0s - 4ms/step - loss: 0.0879 - val_loss: 1.2696
Epoch 34/80
117/117 - 0s - 4ms/step - loss: 0.0915 - val_loss: 1.2617
Epoch 35/80
117/117 - 0s - 4ms/step - loss: 0.0983 - val_loss: 1.3765
Epoch 36/80
117/117 - 0s - 4ms/step - loss: 0.1046 - val_loss: 1.2462
Epoch 37/80
117/117 - 0s - 4ms/step - loss: 0.0845 - val_loss: 1.1838
Epoch 38/80
117/117 - 0s - 4ms/step - loss: 0.1078 - val_loss: 1.3369
Epoch 39/80
117/117 - 0s - 4ms/step - loss: 0.0862 - val_loss: 1.3038
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.8972
Per-joint RMSE: 1.0668 1.4020 1.1240 0.4244 0.3702 0.3819
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:07:24.233764: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:07:24.258441: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 20
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 07:07:25.104323: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:25.109340: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:25.110267: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:25.111821: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:25.112618: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:25.113354: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:25.191947: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:25.192793: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:25.193533: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:25.194351: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:07:25.503264: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=8.545595e-01  RMSE=9.244239e-01
  per-joint RMSE: 1.1030 1.4766 1.1189 0.4291 0.3786 0.3884
Residual LSTM:  MSE=8.050072e-01      RMSE=8.972219e-01
  per-joint RMSE: 1.0668 1.4020 1.1240 0.4244 0.3702 0.3819
Combined torque MSE=8.050072e-01     RMSE=8.972219e-01
  per-joint RMSE: 1.0668 1.4020 1.1240 0.4244 0.3702 0.3819
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300.npz --H 50 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300.json
H=50, n_dof=6, feature_dim=18
X_train: (37136, 50, 18)  Y_train: (37136, 6)
X_test : (14459, 50, 18)  Y_test : (14459, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:07:27.765274: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:07:27.788662: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (37136, 50, 18), Y_train = (37136, 6)
  X_test  = (14459, 50, 18),  Y_test  = (14459, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:07:29.015395: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:29.020119: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:29.021172: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:29.023088: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:29.023992: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:29.024848: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:29.113509: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:29.114400: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:29.115210: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:29.116009: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:07:30.129966: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
117/117 - 2s - 16ms/step - loss: 0.2899 - val_loss: 0.4990
Epoch 2/80
117/117 - 0s - 4ms/step - loss: 0.1769 - val_loss: 0.4811
Epoch 3/80
117/117 - 0s - 4ms/step - loss: 0.1512 - val_loss: 0.4614
Epoch 4/80
117/117 - 0s - 4ms/step - loss: 0.1368 - val_loss: 0.4507
Epoch 5/80
117/117 - 0s - 4ms/step - loss: 0.1258 - val_loss: 0.4580
Epoch 6/80
117/117 - 0s - 4ms/step - loss: 0.1200 - val_loss: 0.4637
Epoch 7/80
117/117 - 0s - 4ms/step - loss: 0.1155 - val_loss: 0.4511
Epoch 8/80
117/117 - 0s - 4ms/step - loss: 0.1120 - val_loss: 0.4320
Epoch 9/80
117/117 - 1s - 5ms/step - loss: 0.1059 - val_loss: 0.4368
Epoch 10/80
117/117 - 0s - 4ms/step - loss: 0.1029 - val_loss: 0.4531
Epoch 11/80
117/117 - 0s - 4ms/step - loss: 0.1029 - val_loss: 0.4561
Epoch 12/80
117/117 - 0s - 4ms/step - loss: 0.0975 - val_loss: 0.4139
Epoch 13/80
117/117 - 0s - 4ms/step - loss: 0.0966 - val_loss: 0.4319
Epoch 14/80
117/117 - 0s - 4ms/step - loss: 0.0929 - val_loss: 0.4362
Epoch 15/80
117/117 - 0s - 4ms/step - loss: 0.0926 - val_loss: 0.4204
Epoch 16/80
117/117 - 0s - 4ms/step - loss: 0.0883 - val_loss: 0.4409
Epoch 17/80
117/117 - 0s - 4ms/step - loss: 0.0909 - val_loss: 0.4263
Epoch 18/80
117/117 - 0s - 4ms/step - loss: 0.0888 - val_loss: 0.4404
Epoch 19/80
117/117 - 0s - 4ms/step - loss: 0.0858 - val_loss: 0.4848
Epoch 20/80
117/117 - 0s - 4ms/step - loss: 0.0830 - val_loss: 0.4522
Epoch 21/80
117/117 - 0s - 4ms/step - loss: 0.0818 - val_loss: 0.4810
Epoch 22/80
117/117 - 0s - 4ms/step - loss: 0.0798 - val_loss: 0.4765
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.8844
Per-joint RMSE: 1.0756 1.3911 1.0895 0.3972 0.3638 0.3508
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:07:42.267691: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:07:42.292722: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 20
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:07:43.145267: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:43.150160: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:43.150948: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:43.152606: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:43.153394: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:43.154130: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:43.238950: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:43.239787: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:43.240545: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:43.241277: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:07:43.553184: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=8.545595e-01  RMSE=9.244239e-01
  per-joint RMSE: 1.1030 1.4766 1.1189 0.4291 0.3786 0.3884
Residual LSTM:  MSE=7.820801e-01      RMSE=8.843529e-01
  per-joint RMSE: 1.0756 1.3911 1.0895 0.3972 0.3638 0.3508
Combined torque MSE=7.820801e-01     RMSE=8.843529e-01
  per-joint RMSE: 1.0756 1.3911 1.0895 0.3972 0.3638 0.3508
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300.npz --H 50 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300.json
H=50, n_dof=6, feature_dim=18
X_train: (37136, 50, 18)  Y_train: (37136, 6)
X_test : (14459, 50, 18)  Y_test : (14459, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:07:45.780158: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:07:45.804976: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (37136, 50, 18), Y_train = (37136, 6)
  X_test  = (14459, 50, 18),  Y_test  = (14459, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:07:47.036760: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:47.041903: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:47.042907: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:47.044713: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:47.045618: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:47.046466: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:47.133398: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:47.134375: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:47.135171: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:07:47.135949: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:07:48.165868: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
117/117 - 2s - 16ms/step - loss: 0.2582 - val_loss: 0.5591
Epoch 2/80
117/117 - 0s - 4ms/step - loss: 0.1432 - val_loss: 0.5629
Epoch 3/80
117/117 - 0s - 4ms/step - loss: 0.1205 - val_loss: 0.5578
Epoch 4/80
117/117 - 0s - 4ms/step - loss: 0.1096 - val_loss: 0.5646
Epoch 5/80
117/117 - 0s - 4ms/step - loss: 0.1024 - val_loss: 0.5667
Epoch 6/80
117/117 - 0s - 4ms/step - loss: 0.0966 - val_loss: 0.5779
Epoch 7/80
117/117 - 0s - 4ms/step - loss: 0.0933 - val_loss: 0.5587
Epoch 8/80
117/117 - 0s - 4ms/step - loss: 0.0897 - val_loss: 0.5448
Epoch 9/80
117/117 - 0s - 4ms/step - loss: 0.0881 - val_loss: 0.5549
Epoch 10/80
117/117 - 1s - 5ms/step - loss: 0.0852 - val_loss: 0.5485
Epoch 11/80
117/117 - 0s - 4ms/step - loss: 0.0833 - val_loss: 0.5430
Epoch 12/80
117/117 - 0s - 4ms/step - loss: 0.0815 - val_loss: 0.5252
Epoch 13/80
117/117 - 0s - 4ms/step - loss: 0.0805 - val_loss: 0.5541
Epoch 14/80
117/117 - 0s - 4ms/step - loss: 0.0787 - val_loss: 0.5485
Epoch 15/80
117/117 - 0s - 4ms/step - loss: 0.0778 - val_loss: 0.5322
Epoch 16/80
117/117 - 0s - 4ms/step - loss: 0.0762 - val_loss: 0.5393
Epoch 17/80
117/117 - 0s - 4ms/step - loss: 0.0747 - val_loss: 0.5285
Epoch 18/80
117/117 - 0s - 4ms/step - loss: 0.0740 - val_loss: 0.5283
Epoch 19/80
117/117 - 0s - 4ms/step - loss: 0.0731 - val_loss: 0.5199
Epoch 20/80
117/117 - 0s - 4ms/step - loss: 0.0720 - val_loss: 0.5310
Epoch 21/80
117/117 - 0s - 4ms/step - loss: 0.0711 - val_loss: 0.5169
Epoch 22/80
117/117 - 0s - 4ms/step - loss: 0.0703 - val_loss: 0.5245
Epoch 23/80
117/117 - 0s - 4ms/step - loss: 0.0692 - val_loss: 0.5174
Epoch 24/80
117/117 - 0s - 4ms/step - loss: 0.0685 - val_loss: 0.5231
Epoch 25/80
117/117 - 0s - 4ms/step - loss: 0.0681 - val_loss: 0.5339
Epoch 26/80
117/117 - 0s - 4ms/step - loss: 0.0676 - val_loss: 0.5377
Epoch 27/80
117/117 - 0s - 4ms/step - loss: 0.0671 - val_loss: 0.5214
Epoch 28/80
117/117 - 0s - 4ms/step - loss: 0.0660 - val_loss: 0.5200
Epoch 29/80
117/117 - 0s - 4ms/step - loss: 0.0654 - val_loss: 0.5156
Epoch 30/80
117/117 - 0s - 4ms/step - loss: 0.0649 - val_loss: 0.5209
Epoch 31/80
117/117 - 0s - 4ms/step - loss: 0.0646 - val_loss: 0.5100
Epoch 32/80
117/117 - 0s - 4ms/step - loss: 0.0638 - val_loss: 0.5083
Epoch 33/80
117/117 - 0s - 4ms/step - loss: 0.0633 - val_loss: 0.5141
Epoch 34/80
117/117 - 0s - 4ms/step - loss: 0.0628 - val_loss: 0.5135
Epoch 35/80
117/117 - 0s - 4ms/step - loss: 0.0625 - val_loss: 0.5215
Epoch 36/80
117/117 - 0s - 4ms/step - loss: 0.0625 - val_loss: 0.5103
Epoch 37/80
117/117 - 0s - 4ms/step - loss: 0.0622 - val_loss: 0.5165
Epoch 38/80
117/117 - 0s - 4ms/step - loss: 0.0606 - val_loss: 0.5241
Epoch 39/80
117/117 - 0s - 4ms/step - loss: 0.0603 - val_loss: 0.5286
Epoch 40/80
117/117 - 0s - 4ms/step - loss: 0.0599 - val_loss: 0.5133
Epoch 41/80
117/117 - 0s - 4ms/step - loss: 0.0601 - val_loss: 0.5200
Epoch 42/80
117/117 - 0s - 4ms/step - loss: 0.0595 - val_loss: 0.5219
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.8052
Per-joint RMSE: 0.9013 1.3265 0.9856 0.3774 0.3220 0.3176
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:08:09.771931: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:08:09.797049: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p2__residual__delan_jax_struct_s2_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 20
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:08:10.662424: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:08:10.667169: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:08:10.667959: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:08:10.669875: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:08:10.670680: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:08:10.671486: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:08:10.749278: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:08:10.750182: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:08:10.750920: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:08:10.751649: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:08:11.061324: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=8.545595e-01  RMSE=9.244239e-01
  per-joint RMSE: 1.1030 1.4766 1.1189 0.4291 0.3786 0.3884
Residual LSTM:  MSE=6.483695e-01      RMSE=8.052139e-01
  per-joint RMSE: 0.9013 1.3265 0.9856 0.3774 0.3220 0.3176
Combined torque MSE=6.483695e-01     RMSE=8.052139e-01
  per-joint RMSE: 0.9013 1.3265 0.9856 0.3774 0.3220 0.3176
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p2__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

