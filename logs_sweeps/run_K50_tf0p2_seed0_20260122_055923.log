################################################################################################################
### RUN: K=50 test_fraction=0.2 seed=0                                                                       ###
### npz_in=/workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed0_dataset.npz ###
################################################################################################################

#####################
### 1) PREPROCESS ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_delan_dataset.py --qdd True --col_format wide --trajectory_amount 50 --test_fraction 0.2 --seed 0 --raw_csv /workspace/shared/data/raw/delan_UR3_Load0_combined_26.csv --out_npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed0_dataset.npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Saved: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed0_dataset.npz
Trajectories: train=40 test=10
Exists: True

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=0                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz                                 ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed0_dataset.npz -t structured -s 0 -r 0 --hp_preset fast_debug --epochs 200 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200.jax' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 200, 'lagrangian_type': <function structured_lagrangian_fn at 0x7fb25dbc41f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed0_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed0_dataset.npz
   dt ≈ 0.0241314790392838
  dof = 6
  Train trajectories = 40
  Test trajectories  = 10
  Train samples = 20560
  Test samples  = 4513
################################################

2026-01-22 05:27:26.064656: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200 | type=structured | dof=6
################################################
2026-01-22 05:27:29.194335: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:27:29.194372: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:27:29.194378: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:27:29.194406: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:27:29.194411: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:27:29.194426: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:27:29.194463: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:27:29.194469: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:27:29.194485: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:27:29.194489: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.1s, Loss=1.73e+01, Inv=1.73e+01, For=2.08e+02, Power=2.68e+00
  [eval] test_mse=3.289e+00  (n=4513)
Epoch 00050: Time=   9.0s, Loss=2.10e+00, Inv=2.10e+00, For=1.08e+02, Power=6.09e-01
Epoch 00100: Time=  11.5s, Loss=1.89e+00, Inv=1.89e+00, For=1.02e+02, Power=5.04e-01
Epoch 00150: Time=  14.0s, Loss=1.79e+00, Inv=1.79e+00, For=1.11e+02, Power=4.46e-01
Epoch 00200: Time=  16.6s, Loss=1.74e+00, Inv=1.74e+00, For=1.20e+02, Power=4.13e-01
  [eval] test_mse=4.089e+00  (n=4513)
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200
Torque MSE  = 6.815e-01
Torque RMSE = 8.255e-01
Per-joint MSE : 9.236e-01 9.420e-01 5.496e-01 2.355e-01 3.555e-01 1.083e+00
Per-joint RMSE: 9.611e-01 9.706e-01 7.413e-01 4.853e-01 5.962e-01 1.041e+00
Comp Time per Sample = 7.690e-08s / 13003440.3Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed0_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed0_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200.jax
Detected n_dof=6 (seed=0)
2026-01-22 05:27:47.959531: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 40 trajectories
2026-01-22 05:27:49.253770: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:27:50.457101: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:27:50.457113: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:27:52.037176: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:27:52.037189: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/40
  done 40/40

Exporting split=test: 10 trajectories
2026-01-22 05:27:53.491198: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 10/10

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200.npz --H 25 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200.json
H=25, n_dof=6, feature_dim=24
X_train: (20020, 25, 24)  Y_train: (20020, 6)
X_test : (4378, 25, 24)  Y_test : (4378, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:27:55.557139: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:27:55.581161: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (20020, 25, 24), Y_train = (20020, 6)
  X_test  = (4378, 25, 24),  Y_test  = (4378, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:27:56.585054: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:27:56.589756: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:27:56.590601: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:27:56.592230: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:27:56.593072: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:27:56.593865: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:27:56.667855: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:27:56.668745: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:27:56.669538: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:27:56.670320: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8942 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:27:57.595087: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
63/63 - 2s - 24ms/step - loss: 0.3176 - val_loss: 1.2274
Epoch 2/50
63/63 - 0s - 3ms/step - loss: 0.1807 - val_loss: 1.1573
Epoch 3/50
63/63 - 0s - 3ms/step - loss: 0.1527 - val_loss: 1.1622
Epoch 4/50
63/63 - 0s - 3ms/step - loss: 0.1398 - val_loss: 1.1938
Epoch 5/50
63/63 - 0s - 3ms/step - loss: 0.1305 - val_loss: 1.3771
Epoch 6/50
63/63 - 0s - 3ms/step - loss: 0.1245 - val_loss: 1.1337
Epoch 7/50
63/63 - 0s - 3ms/step - loss: 0.1208 - val_loss: 1.1639
Epoch 8/50
63/63 - 0s - 3ms/step - loss: 0.1163 - val_loss: 1.1777
Epoch 9/50
63/63 - 0s - 3ms/step - loss: 0.1131 - val_loss: 1.1754
Epoch 10/50
63/63 - 0s - 3ms/step - loss: 0.1095 - val_loss: 1.3211
Epoch 11/50
63/63 - 0s - 3ms/step - loss: 0.1078 - val_loss: 1.2332
Epoch 12/50
63/63 - 0s - 3ms/step - loss: 0.1049 - val_loss: 1.2408
Epoch 13/50
63/63 - 0s - 3ms/step - loss: 0.1029 - val_loss: 1.3150
Epoch 14/50
63/63 - 0s - 3ms/step - loss: 0.1007 - val_loss: 1.3411
Epoch 15/50
63/63 - 0s - 3ms/step - loss: 0.0992 - val_loss: 1.3435
Epoch 16/50
63/63 - 0s - 3ms/step - loss: 0.0974 - val_loss: 1.3998
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7591
Per-joint RMSE: 0.8288 0.8536 0.6989 0.4862 0.5653 0.9989
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:28:02.082730: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:28:02.106880: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 05:28:02.948662: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:02.953303: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:02.954092: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:02.955730: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:02.956513: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:02.957249: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:03.039841: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:03.040670: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:03.041407: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:03.042130: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8942 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:28:03.342011: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.887169e-01  RMSE=8.298897e-01
  per-joint RMSE: 0.9704 0.9610 0.7482 0.4907 0.6035 1.0498
Residual LSTM:  MSE=5.762797e-01      RMSE=7.591309e-01
  per-joint RMSE: 0.8288 0.8536 0.6989 0.4862 0.5653 0.9989
Combined torque MSE=5.762797e-01     RMSE=7.591309e-01
  per-joint RMSE: 0.8288 0.8536 0.6989 0.4862 0.5653 0.9989
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200.npz --H 25 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200.json
H=25, n_dof=6, feature_dim=6
X_train: (20020, 25, 6)  Y_train: (20020, 6)
X_test : (4378, 25, 6)  Y_test : (4378, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:28:05.204617: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:28:05.228366: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (20020, 25, 6), Y_train = (20020, 6)
  X_test  = (4378, 25, 6),  Y_test  = (4378, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:28:06.176420: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:06.181036: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:06.181826: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:06.183451: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:06.184242: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:06.184967: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:06.267301: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:06.268199: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:06.268937: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:06.269757: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8942 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:28:07.154272: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
63/63 - 2s - 24ms/step - loss: 0.5309 - val_loss: 2.1031
Epoch 2/50
63/63 - 0s - 3ms/step - loss: 0.3196 - val_loss: 2.4049
Epoch 3/50
63/63 - 0s - 3ms/step - loss: 0.2504 - val_loss: 2.5961
Epoch 4/50
63/63 - 0s - 3ms/step - loss: 0.2112 - val_loss: 2.7193
Epoch 5/50
63/63 - 0s - 3ms/step - loss: 0.1850 - val_loss: 2.6590
Epoch 6/50
63/63 - 0s - 3ms/step - loss: 0.1732 - val_loss: 2.7117
Epoch 7/50
63/63 - 0s - 3ms/step - loss: 0.1579 - val_loss: 2.6513
Epoch 8/50
63/63 - 0s - 3ms/step - loss: 0.1526 - val_loss: 2.5454
Epoch 9/50
63/63 - 0s - 3ms/step - loss: 0.1458 - val_loss: 2.5470
Epoch 10/50
63/63 - 0s - 3ms/step - loss: 0.1400 - val_loss: 2.5782
Epoch 11/50
63/63 - 0s - 3ms/step - loss: 0.1349 - val_loss: 2.5454
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.8135
Per-joint RMSE: 0.9964 0.8842 0.7631 0.4839 0.5959 1.0121
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:28:10.722855: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:28:10.747381: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 05:28:11.596521: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:11.601364: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:11.602153: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:11.603891: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:11.604674: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:11.605406: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:11.684805: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:11.685657: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:11.686398: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:11.687126: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:28:11.981641: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.887169e-01  RMSE=8.298897e-01
  per-joint RMSE: 0.9704 0.9610 0.7482 0.4907 0.6035 1.0498
Residual LSTM:  MSE=6.617362e-01      RMSE=8.134717e-01
  per-joint RMSE: 0.9964 0.8842 0.7631 0.4839 0.5959 1.0121
Combined torque MSE=6.617362e-01     RMSE=8.134717e-01
  per-joint RMSE: 0.9964 0.8842 0.7631 0.4839 0.5959 1.0121
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200.npz --H 25 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200.json
H=25, n_dof=6, feature_dim=18
X_train: (20020, 25, 18)  Y_train: (20020, 6)
X_test : (4378, 25, 18)  Y_test : (4378, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:28:13.854486: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:28:13.878361: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (20020, 25, 18), Y_train = (20020, 6)
  X_test  = (4378, 25, 18),  Y_test  = (4378, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:28:14.869452: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:14.874096: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:14.874880: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:14.876484: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:14.877272: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:14.878004: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:14.956449: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:14.957360: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:14.958106: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:14.958913: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8942 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:28:15.861912: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
63/63 - 2s - 24ms/step - loss: 0.3412 - val_loss: 1.1966
Epoch 2/50
63/63 - 0s - 3ms/step - loss: 0.2047 - val_loss: 1.3011
Epoch 3/50
63/63 - 0s - 3ms/step - loss: 0.1700 - val_loss: 1.2651
Epoch 4/50
63/63 - 0s - 3ms/step - loss: 0.1523 - val_loss: 1.3574
Epoch 5/50
63/63 - 0s - 3ms/step - loss: 0.1406 - val_loss: 1.3791
Epoch 6/50
63/63 - 0s - 3ms/step - loss: 0.1336 - val_loss: 1.2572
Epoch 7/50
63/63 - 0s - 3ms/step - loss: 0.1249 - val_loss: 1.3782
Epoch 8/50
63/63 - 0s - 3ms/step - loss: 0.1232 - val_loss: 1.3373
Epoch 9/50
63/63 - 0s - 3ms/step - loss: 0.1191 - val_loss: 1.2826
Epoch 10/50
63/63 - 0s - 3ms/step - loss: 0.1155 - val_loss: 1.2736
Epoch 11/50
63/63 - 0s - 3ms/step - loss: 0.1134 - val_loss: 1.2783
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7818
Per-joint RMSE: 0.8810 0.9304 0.7226 0.5068 0.5583 0.9667
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:28:19.410721: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:28:19.435578: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:28:20.279734: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:20.284653: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:20.285529: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:20.287207: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:20.288000: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:20.288738: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:20.363011: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:20.363996: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:20.364801: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:20.365575: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8943 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:28:20.660158: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.887169e-01  RMSE=8.298897e-01
  per-joint RMSE: 0.9704 0.9610 0.7482 0.4907 0.6035 1.0498
Residual LSTM:  MSE=6.112050e-01      RMSE=7.817960e-01
  per-joint RMSE: 0.8810 0.9304 0.7226 0.5068 0.5583 0.9667
Combined torque MSE=6.112050e-01     RMSE=7.817960e-01
  per-joint RMSE: 0.8810 0.9304 0.7226 0.5068 0.5583 0.9667
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200.npz --H 25 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200.json
H=25, n_dof=6, feature_dim=18
X_train: (20020, 25, 18)  Y_train: (20020, 6)
X_test : (4378, 25, 18)  Y_test : (4378, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:28:22.583386: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:28:22.607009: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (20020, 25, 18), Y_train = (20020, 6)
  X_test  = (4378, 25, 18),  Y_test  = (4378, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:28:23.595702: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:23.600488: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:23.601277: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:23.602881: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:23.603661: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:23.604399: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:23.676125: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:23.676966: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:23.677799: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:23.678530: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8942 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:28:24.619310: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
63/63 - 2s - 24ms/step - loss: 0.3264 - val_loss: 1.1727
Epoch 2/50
63/63 - 0s - 3ms/step - loss: 0.1909 - val_loss: 1.1610
Epoch 3/50
63/63 - 0s - 3ms/step - loss: 0.1610 - val_loss: 1.2121
Epoch 4/50
63/63 - 0s - 3ms/step - loss: 0.1428 - val_loss: 1.1747
Epoch 5/50
63/63 - 0s - 3ms/step - loss: 0.1331 - val_loss: 1.1742
Epoch 6/50
63/63 - 0s - 3ms/step - loss: 0.1266 - val_loss: 1.1771
Epoch 7/50
63/63 - 0s - 3ms/step - loss: 0.1216 - val_loss: 1.1461
Epoch 8/50
63/63 - 0s - 3ms/step - loss: 0.1178 - val_loss: 1.1131
Epoch 9/50
63/63 - 0s - 3ms/step - loss: 0.1131 - val_loss: 1.1411
Epoch 10/50
63/63 - 0s - 3ms/step - loss: 0.1104 - val_loss: 1.1759
Epoch 11/50
63/63 - 0s - 3ms/step - loss: 0.1068 - val_loss: 1.1588
Epoch 12/50
63/63 - 0s - 3ms/step - loss: 0.1044 - val_loss: 1.1591
Epoch 13/50
63/63 - 0s - 3ms/step - loss: 0.1032 - val_loss: 1.1953
Epoch 14/50
63/63 - 0s - 3ms/step - loss: 0.1016 - val_loss: 1.1946
Epoch 15/50
63/63 - 0s - 3ms/step - loss: 0.0997 - val_loss: 1.2107
Epoch 16/50
63/63 - 0s - 4ms/step - loss: 0.0979 - val_loss: 1.2168
Epoch 17/50
63/63 - 0s - 3ms/step - loss: 0.0961 - val_loss: 1.2420
Epoch 18/50
63/63 - 0s - 3ms/step - loss: 0.0966 - val_loss: 1.2399
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7531
Per-joint RMSE: 0.7647 0.9287 0.6735 0.4450 0.5813 0.9831
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:28:29.529367: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:28:29.553930: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:28:30.406544: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:30.411222: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:30.412091: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:30.413756: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:30.414544: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:30.415279: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:30.498724: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:30.499563: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:30.500305: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:30.501030: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8942 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:28:30.799586: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.887169e-01  RMSE=8.298897e-01
  per-joint RMSE: 0.9704 0.9610 0.7482 0.4907 0.6035 1.0498
Residual LSTM:  MSE=5.672048e-01      RMSE=7.531300e-01
  per-joint RMSE: 0.7647 0.9287 0.6735 0.4450 0.5813 0.9831
Combined torque MSE=5.672048e-01     RMSE=7.531300e-01
  per-joint RMSE: 0.7647 0.9287 0.6735 0.4450 0.5813 0.9831
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200.npz --H 50 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200.json
H=50, n_dof=6, feature_dim=24
X_train: (19520, 50, 24)  Y_train: (19520, 6)
X_test : (4253, 50, 24)  Y_test : (4253, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:28:32.726186: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:28:32.750307: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (19520, 50, 24), Y_train = (19520, 6)
  X_test  = (4253, 50, 24),  Y_test  = (4253, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:28:33.839583: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:33.844128: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:33.845001: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:33.846583: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:33.847375: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:33.848108: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:33.929397: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:33.930228: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:33.930968: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:33.931702: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8942 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:28:34.874561: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
61/61 - 2s - 25ms/step - loss: 0.3145 - val_loss: 1.4402
Epoch 2/50
61/61 - 0s - 4ms/step - loss: 0.1819 - val_loss: 1.4309
Epoch 3/50
61/61 - 0s - 4ms/step - loss: 0.1568 - val_loss: 1.3940
Epoch 4/50
61/61 - 0s - 4ms/step - loss: 0.1436 - val_loss: 1.3526
Epoch 5/50
61/61 - 0s - 4ms/step - loss: 0.1335 - val_loss: 1.3573
Epoch 6/50
61/61 - 0s - 4ms/step - loss: 0.1271 - val_loss: 1.3449
Epoch 7/50
61/61 - 0s - 4ms/step - loss: 0.1231 - val_loss: 1.3140
Epoch 8/50
61/61 - 0s - 4ms/step - loss: 0.1180 - val_loss: 1.3312
Epoch 9/50
61/61 - 0s - 4ms/step - loss: 0.1158 - val_loss: 1.2919
Epoch 10/50
61/61 - 0s - 4ms/step - loss: 0.1121 - val_loss: 1.3378
Epoch 11/50
61/61 - 0s - 4ms/step - loss: 0.1104 - val_loss: 1.2853
Epoch 12/50
61/61 - 0s - 4ms/step - loss: 0.1074 - val_loss: 1.2963
Epoch 13/50
61/61 - 0s - 4ms/step - loss: 0.1059 - val_loss: 1.3058
Epoch 14/50
61/61 - 0s - 4ms/step - loss: 0.1034 - val_loss: 1.2912
Epoch 15/50
61/61 - 0s - 4ms/step - loss: 0.1020 - val_loss: 1.2988
Epoch 16/50
61/61 - 0s - 4ms/step - loss: 0.1004 - val_loss: 1.2750
Epoch 17/50
61/61 - 0s - 5ms/step - loss: 0.0990 - val_loss: 1.2777
Epoch 18/50
61/61 - 0s - 4ms/step - loss: 0.0972 - val_loss: 1.2501
Epoch 19/50
61/61 - 0s - 4ms/step - loss: 0.0962 - val_loss: 1.2455
Epoch 20/50
61/61 - 0s - 4ms/step - loss: 0.0942 - val_loss: 1.2482
Epoch 21/50
61/61 - 0s - 4ms/step - loss: 0.0927 - val_loss: 1.2667
Epoch 22/50
61/61 - 0s - 4ms/step - loss: 0.0933 - val_loss: 1.2746
Epoch 23/50
61/61 - 0s - 4ms/step - loss: 0.0915 - val_loss: 1.2520
Epoch 24/50
61/61 - 0s - 4ms/step - loss: 0.0907 - val_loss: 1.2431
Epoch 25/50
61/61 - 0s - 4ms/step - loss: 0.0900 - val_loss: 1.2310
Epoch 26/50
61/61 - 0s - 4ms/step - loss: 0.0892 - val_loss: 1.2462
Epoch 27/50
61/61 - 0s - 4ms/step - loss: 0.0888 - val_loss: 1.2090
Epoch 28/50
61/61 - 0s - 4ms/step - loss: 0.0882 - val_loss: 1.2296
Epoch 29/50
61/61 - 0s - 4ms/step - loss: 0.0879 - val_loss: 1.2053
Epoch 30/50
61/61 - 0s - 4ms/step - loss: 0.0871 - val_loss: 1.2027
Epoch 31/50
61/61 - 0s - 4ms/step - loss: 0.0862 - val_loss: 1.1721
Epoch 32/50
61/61 - 0s - 4ms/step - loss: 0.0852 - val_loss: 1.1947
Epoch 33/50
61/61 - 0s - 4ms/step - loss: 0.0850 - val_loss: 1.1878
Epoch 34/50
61/61 - 0s - 4ms/step - loss: 0.0851 - val_loss: 1.1510
Epoch 35/50
61/61 - 0s - 4ms/step - loss: 0.0848 - val_loss: 1.1532
Epoch 36/50
61/61 - 0s - 4ms/step - loss: 0.0841 - val_loss: 1.1556
Epoch 37/50
61/61 - 0s - 4ms/step - loss: 0.0834 - val_loss: 1.1596
Epoch 38/50
61/61 - 0s - 4ms/step - loss: 0.0831 - val_loss: 1.1423
Epoch 39/50
61/61 - 0s - 4ms/step - loss: 0.0829 - val_loss: 1.1700
Epoch 40/50
61/61 - 0s - 4ms/step - loss: 0.0824 - val_loss: 1.1443
Epoch 41/50
61/61 - 0s - 4ms/step - loss: 0.0823 - val_loss: 1.1465
Epoch 42/50
61/61 - 0s - 4ms/step - loss: 0.0822 - val_loss: 1.1785
Epoch 43/50
61/61 - 0s - 4ms/step - loss: 0.0817 - val_loss: 1.1415
Epoch 44/50
61/61 - 0s - 4ms/step - loss: 0.0813 - val_loss: 1.1666
Epoch 45/50
61/61 - 0s - 4ms/step - loss: 0.0811 - val_loss: 1.1600
Epoch 46/50
61/61 - 0s - 4ms/step - loss: 0.0814 - val_loss: 1.1141
Epoch 47/50
61/61 - 0s - 4ms/step - loss: 0.0803 - val_loss: 1.1098
Epoch 48/50
61/61 - 0s - 4ms/step - loss: 0.0802 - val_loss: 1.1229
Epoch 49/50
61/61 - 0s - 4ms/step - loss: 0.0802 - val_loss: 1.1263
Epoch 50/50
61/61 - 0s - 4ms/step - loss: 0.0798 - val_loss: 1.1320
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7644
Per-joint RMSE: 0.8663 0.8199 0.7265 0.4857 0.5854 0.9884
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:28:49.043344: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:28:49.067803: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 05:28:49.924300: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:49.929047: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:49.929838: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:49.931630: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:49.932419: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:49.933151: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:50.014816: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:50.015652: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:50.016386: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:50.017198: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:28:50.319345: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.689108e-01  RMSE=8.178697e-01
  per-joint RMSE: 0.9705 0.9149 0.7394 0.4914 0.6034 1.0403
Residual LSTM:  MSE=5.843319e-01      RMSE=7.644160e-01
  per-joint RMSE: 0.8663 0.8199 0.7265 0.4857 0.5854 0.9884
Combined torque MSE=5.843319e-01     RMSE=7.644160e-01
  per-joint RMSE: 0.8663 0.8199 0.7265 0.4857 0.5854 0.9884
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200.npz --H 50 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200.json
H=50, n_dof=6, feature_dim=6
X_train: (19520, 50, 6)  Y_train: (19520, 6)
X_test : (4253, 50, 6)  Y_test : (4253, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:28:52.225273: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:28:52.249333: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (19520, 50, 6), Y_train = (19520, 6)
  X_test  = (4253, 50, 6),  Y_test  = (4253, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:28:53.240047: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:53.244563: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:53.245362: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:53.246905: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:53.247750: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:53.248527: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:53.325932: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:53.326779: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:53.327535: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:53.328279: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:28:54.208068: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
61/61 - 2s - 25ms/step - loss: 0.4858 - val_loss: 2.3257
Epoch 2/50
61/61 - 0s - 4ms/step - loss: 0.2677 - val_loss: 3.1163
Epoch 3/50
61/61 - 0s - 4ms/step - loss: 0.2015 - val_loss: 3.0932
Epoch 4/50
61/61 - 0s - 4ms/step - loss: 0.1815 - val_loss: 2.9712
Epoch 5/50
61/61 - 0s - 4ms/step - loss: 0.1674 - val_loss: 2.8831
Epoch 6/50
61/61 - 0s - 4ms/step - loss: 0.1583 - val_loss: 2.9124
Epoch 7/50
61/61 - 0s - 4ms/step - loss: 0.1503 - val_loss: 2.9194
Epoch 8/50
61/61 - 0s - 4ms/step - loss: 0.1459 - val_loss: 2.9209
Epoch 9/50
61/61 - 0s - 4ms/step - loss: 0.1398 - val_loss: 2.9005
Epoch 10/50
61/61 - 0s - 4ms/step - loss: 0.1352 - val_loss: 2.9075
Epoch 11/50
61/61 - 0s - 4ms/step - loss: 0.1315 - val_loss: 2.9069
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.8412
Per-joint RMSE: 0.9443 0.9292 0.8053 0.5155 0.6044 1.1003
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:28:58.490357: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:28:58.515514: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 05:28:59.372251: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:59.376942: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:59.377740: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:59.379651: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:59.380448: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:59.381282: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:59.461426: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:59.462330: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:59.463144: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:28:59.463865: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8942 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:28:59.759135: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.689108e-01  RMSE=8.178697e-01
  per-joint RMSE: 0.9705 0.9149 0.7394 0.4914 0.6034 1.0403
Residual LSTM:  MSE=7.075633e-01      RMSE=8.411679e-01
  per-joint RMSE: 0.9443 0.9292 0.8053 0.5155 0.6044 1.1003
Combined torque MSE=7.075633e-01     RMSE=8.411679e-01
  per-joint RMSE: 0.9443 0.9292 0.8053 0.5155 0.6044 1.1003
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200.npz --H 50 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200.json
H=50, n_dof=6, feature_dim=18
X_train: (19520, 50, 18)  Y_train: (19520, 6)
X_test : (4253, 50, 18)  Y_test : (4253, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:29:01.685948: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:29:01.709507: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (19520, 50, 18), Y_train = (19520, 6)
  X_test  = (4253, 50, 18),  Y_test  = (4253, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:29:02.771951: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:02.776505: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:02.777371: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:02.779072: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:02.779860: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:02.780605: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:02.858470: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:02.859730: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:02.860527: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:02.861356: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8942 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:29:03.790182: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
61/61 - 2s - 25ms/step - loss: 0.3476 - val_loss: 1.3704
Epoch 2/50
61/61 - 0s - 4ms/step - loss: 0.2073 - val_loss: 1.2765
Epoch 3/50
61/61 - 0s - 4ms/step - loss: 0.1749 - val_loss: 1.2539
Epoch 4/50
61/61 - 0s - 4ms/step - loss: 0.1569 - val_loss: 1.2712
Epoch 5/50
61/61 - 0s - 4ms/step - loss: 0.1463 - val_loss: 1.2538
Epoch 6/50
61/61 - 0s - 4ms/step - loss: 0.1383 - val_loss: 1.2683
Epoch 7/50
61/61 - 0s - 4ms/step - loss: 0.1309 - val_loss: 1.2411
Epoch 8/50
61/61 - 0s - 4ms/step - loss: 0.1270 - val_loss: 1.2296
Epoch 9/50
61/61 - 0s - 4ms/step - loss: 0.1241 - val_loss: 1.2388
Epoch 10/50
61/61 - 0s - 4ms/step - loss: 0.1191 - val_loss: 1.2169
Epoch 11/50
61/61 - 0s - 4ms/step - loss: 0.1161 - val_loss: 1.2164
Epoch 12/50
61/61 - 0s - 4ms/step - loss: 0.1153 - val_loss: 1.2232
Epoch 13/50
61/61 - 0s - 4ms/step - loss: 0.1124 - val_loss: 1.2090
Epoch 14/50
61/61 - 0s - 4ms/step - loss: 0.1104 - val_loss: 1.2323
Epoch 15/50
61/61 - 0s - 4ms/step - loss: 0.1071 - val_loss: 1.2166
Epoch 16/50
61/61 - 0s - 4ms/step - loss: 0.1046 - val_loss: 1.1922
Epoch 17/50
61/61 - 0s - 5ms/step - loss: 0.1030 - val_loss: 1.2214
Epoch 18/50
61/61 - 0s - 4ms/step - loss: 0.1015 - val_loss: 1.2208
Epoch 19/50
61/61 - 0s - 4ms/step - loss: 0.1009 - val_loss: 1.2224
Epoch 20/50
61/61 - 0s - 4ms/step - loss: 0.0991 - val_loss: 1.2611
Epoch 21/50
61/61 - 0s - 4ms/step - loss: 0.0987 - val_loss: 1.2587
Epoch 22/50
61/61 - 0s - 4ms/step - loss: 0.0970 - val_loss: 1.2380
Epoch 23/50
61/61 - 0s - 4ms/step - loss: 0.0962 - val_loss: 1.2085
Epoch 24/50
61/61 - 0s - 4ms/step - loss: 0.0943 - val_loss: 1.2287
Epoch 25/50
61/61 - 0s - 4ms/step - loss: 0.0934 - val_loss: 1.2480
Epoch 26/50
61/61 - 0s - 4ms/step - loss: 0.0925 - val_loss: 1.2374
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7707
Per-joint RMSE: 0.8793 0.8822 0.7290 0.5075 0.5363 0.9672
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:29:11.909729: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:29:11.934961: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:29:12.790095: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:12.794734: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:12.795615: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:12.797335: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:12.798122: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:12.798857: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:12.886223: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:12.887150: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:12.887898: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:12.888641: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:29:13.189059: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.689108e-01  RMSE=8.178697e-01
  per-joint RMSE: 0.9705 0.9149 0.7394 0.4914 0.6034 1.0403
Residual LSTM:  MSE=5.939618e-01      RMSE=7.706891e-01
  per-joint RMSE: 0.8793 0.8822 0.7290 0.5075 0.5363 0.9672
Combined torque MSE=5.939618e-01     RMSE=7.706891e-01
  per-joint RMSE: 0.8793 0.8822 0.7290 0.5075 0.5363 0.9672
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200.npz --H 50 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200.json
H=50, n_dof=6, feature_dim=18
X_train: (19520, 50, 18)  Y_train: (19520, 6)
X_test : (4253, 50, 18)  Y_test : (4253, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:29:15.146080: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:29:15.169783: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (19520, 50, 18), Y_train = (19520, 6)
  X_test  = (4253, 50, 18),  Y_test  = (4253, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:29:16.236315: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:16.240912: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:16.241755: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:16.243362: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:16.244231: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:16.244965: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:16.323015: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:16.323848: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:16.324594: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:16.325377: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:29:17.250614: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
61/61 - 2s - 25ms/step - loss: 0.3361 - val_loss: 1.2737
Epoch 2/50
61/61 - 0s - 4ms/step - loss: 0.1933 - val_loss: 1.2325
Epoch 3/50
61/61 - 0s - 4ms/step - loss: 0.1626 - val_loss: 1.2226
Epoch 4/50
61/61 - 0s - 4ms/step - loss: 0.1470 - val_loss: 1.2203
Epoch 5/50
61/61 - 0s - 4ms/step - loss: 0.1361 - val_loss: 1.1840
Epoch 6/50
61/61 - 0s - 4ms/step - loss: 0.1292 - val_loss: 1.1844
Epoch 7/50
61/61 - 0s - 4ms/step - loss: 0.1236 - val_loss: 1.1654
Epoch 8/50
61/61 - 0s - 4ms/step - loss: 0.1198 - val_loss: 1.1570
Epoch 9/50
61/61 - 0s - 4ms/step - loss: 0.1158 - val_loss: 1.1503
Epoch 10/50
61/61 - 0s - 4ms/step - loss: 0.1116 - val_loss: 1.1603
Epoch 11/50
61/61 - 0s - 4ms/step - loss: 0.1087 - val_loss: 1.1383
Epoch 12/50
61/61 - 0s - 4ms/step - loss: 0.1068 - val_loss: 1.1547
Epoch 13/50
61/61 - 0s - 4ms/step - loss: 0.1046 - val_loss: 1.1496
Epoch 14/50
61/61 - 0s - 4ms/step - loss: 0.1021 - val_loss: 1.1547
Epoch 15/50
61/61 - 0s - 4ms/step - loss: 0.1004 - val_loss: 1.1640
Epoch 16/50
61/61 - 0s - 4ms/step - loss: 0.0989 - val_loss: 1.1885
Epoch 17/50
61/61 - 0s - 5ms/step - loss: 0.0976 - val_loss: 1.1751
Epoch 18/50
61/61 - 0s - 4ms/step - loss: 0.0962 - val_loss: 1.1799
Epoch 19/50
61/61 - 0s - 4ms/step - loss: 0.0952 - val_loss: 1.2170
Epoch 20/50
61/61 - 0s - 4ms/step - loss: 0.0956 - val_loss: 1.1752
Epoch 21/50
61/61 - 0s - 4ms/step - loss: 0.0932 - val_loss: 1.1808
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7477
Per-joint RMSE: 0.8151 0.8724 0.6865 0.4750 0.5762 0.9484
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:29:24.169359: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:29:24.193739: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:29:25.032080: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:25.036683: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:25.037466: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:25.039124: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:25.039907: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:25.040642: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:25.118195: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:25.119107: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:25.119854: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:29:25.120594: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:29:25.418652: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.689108e-01  RMSE=8.178697e-01
  per-joint RMSE: 0.9705 0.9149 0.7394 0.4914 0.6034 1.0403
Residual LSTM:  MSE=5.589806e-01      RMSE=7.476501e-01
  per-joint RMSE: 0.8151 0.8724 0.6865 0.4750 0.5762 0.9484
Combined torque MSE=5.589806e-01     RMSE=7.476501e-01
  per-joint RMSE: 0.8151 0.8724 0.6865 0.4750 0.5762 0.9484
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=1                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz                                 ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed0_dataset.npz -t structured -s 1 -r 0 --hp_preset fast_debug --epochs 200 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200.jax' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 200, 'lagrangian_type': <function structured_lagrangian_fn at 0x7ddc356041f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed0_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed0_dataset.npz
   dt ≈ 0.0241314790392838
  dof = 6
  Train trajectories = 40
  Test trajectories  = 10
  Train samples = 20560
  Test samples  = 4513
################################################

2026-01-22 05:29:29.661138: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200 | type=structured | dof=6
################################################
2026-01-22 05:29:32.782746: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:29:32.782782: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:29:32.782788: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:29:32.782816: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:29:32.782821: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:29:32.782836: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:29:32.782873: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:29:32.782879: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:29:32.782894: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:29:32.782899: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.2s, Loss=1.80e+01, Inv=1.80e+01, For=2.18e+02, Power=2.44e+00
  [eval] test_mse=5.324e+00  (n=4513)
Epoch 00050: Time=   9.3s, Loss=2.13e+00, Inv=2.13e+00, For=8.78e+01, Power=6.12e-01
Epoch 00100: Time=  11.9s, Loss=1.89e+00, Inv=1.89e+00, For=1.02e+02, Power=4.89e-01
Epoch 00150: Time=  14.6s, Loss=1.79e+00, Inv=1.79e+00, For=1.17e+02, Power=4.32e-01
Epoch 00200: Time=  17.5s, Loss=1.72e+00, Inv=1.72e+00, For=1.32e+02, Power=3.97e-01
  [eval] test_mse=4.234e+00  (n=4513)
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200
Torque MSE  = 7.057e-01
Torque RMSE = 8.401e-01
Per-joint MSE : 9.435e-01 5.284e-01 3.865e-01 2.301e-01 1.566e+00 5.793e-01
Per-joint RMSE: 9.714e-01 7.269e-01 6.217e-01 4.797e-01 1.252e+00 7.611e-01
Comp Time per Sample = 6.030e-08s / 16583315.4Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed0_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed0_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200.jax
Detected n_dof=6 (seed=1)
2026-01-22 05:29:52.407858: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 40 trajectories
2026-01-22 05:29:53.732600: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:29:54.940771: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:29:54.940783: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:29:56.389240: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:29:56.389254: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/40
  done 40/40

Exporting split=test: 10 trajectories
2026-01-22 05:29:57.942432: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 10/10

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200.npz --H 25 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200.json
H=25, n_dof=6, feature_dim=24
X_train: (20020, 25, 24)  Y_train: (20020, 6)
X_test : (4378, 25, 24)  Y_test : (4378, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:30:00.071967: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:30:00.095645: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (20020, 25, 24), Y_train = (20020, 6)
  X_test  = (4378, 25, 24),  Y_test  = (4378, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:30:01.110525: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:01.115677: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:01.116809: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:01.118349: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:01.119165: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:01.120065: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:01.204395: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:01.205282: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:01.206079: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:01.206866: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:30:02.120742: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
63/63 - 2s - 24ms/step - loss: 0.3213 - val_loss: 1.1858
Epoch 2/50
63/63 - 0s - 3ms/step - loss: 0.1851 - val_loss: 1.2068
Epoch 3/50
63/63 - 0s - 3ms/step - loss: 0.1557 - val_loss: 1.2317
Epoch 4/50
63/63 - 0s - 3ms/step - loss: 0.1406 - val_loss: 1.2352
Epoch 5/50
63/63 - 0s - 3ms/step - loss: 0.1325 - val_loss: 1.2439
Epoch 6/50
63/63 - 0s - 3ms/step - loss: 0.1292 - val_loss: 1.1107
Epoch 7/50
63/63 - 0s - 3ms/step - loss: 0.1212 - val_loss: 1.1346
Epoch 8/50
63/63 - 0s - 3ms/step - loss: 0.1174 - val_loss: 1.1396
Epoch 9/50
63/63 - 0s - 3ms/step - loss: 0.1145 - val_loss: 1.1586
Epoch 10/50
63/63 - 0s - 3ms/step - loss: 0.1111 - val_loss: 1.1921
Epoch 11/50
63/63 - 0s - 3ms/step - loss: 0.1090 - val_loss: 1.1283
Epoch 12/50
63/63 - 0s - 3ms/step - loss: 0.1064 - val_loss: 1.1303
Epoch 13/50
63/63 - 0s - 3ms/step - loss: 0.1030 - val_loss: 1.1856
Epoch 14/50
63/63 - 0s - 3ms/step - loss: 0.1010 - val_loss: 1.1975
Epoch 15/50
63/63 - 0s - 3ms/step - loss: 0.1000 - val_loss: 1.1918
Epoch 16/50
63/63 - 0s - 3ms/step - loss: 0.0988 - val_loss: 1.2495
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7695
Per-joint RMSE: 0.8656 0.5767 0.5558 0.4420 1.2260 0.6807
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:30:06.661978: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:30:06.686511: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 05:30:07.529961: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:07.534680: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:07.535468: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:07.537066: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:07.537928: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:07.538666: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:07.610781: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:07.611704: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:07.612536: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:07.613270: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:30:07.912173: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.203524e-01  RMSE=8.487357e-01
  per-joint RMSE: 0.9821 0.7240 0.6267 0.4857 1.2693 0.7705
Residual LSTM:  MSE=5.920835e-01      RMSE=7.694696e-01
  per-joint RMSE: 0.8656 0.5767 0.5558 0.4420 1.2260 0.6807
Combined torque MSE=5.920835e-01     RMSE=7.694696e-01
  per-joint RMSE: 0.8656 0.5767 0.5558 0.4420 1.2260 0.6807
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200.npz --H 25 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200.json
H=25, n_dof=6, feature_dim=6
X_train: (20020, 25, 6)  Y_train: (20020, 6)
X_test : (4378, 25, 6)  Y_test : (4378, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:30:09.773962: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:30:09.798009: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (20020, 25, 6), Y_train = (20020, 6)
  X_test  = (4378, 25, 6),  Y_test  = (4378, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:30:10.754560: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:10.759484: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:10.760272: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:10.761818: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:10.762607: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:10.763347: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:10.842456: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:10.843300: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:10.844057: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:10.844792: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:30:11.724752: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
63/63 - 2s - 24ms/step - loss: 0.5297 - val_loss: 2.2531
Epoch 2/50
63/63 - 0s - 3ms/step - loss: 0.3334 - val_loss: 2.3126
Epoch 3/50
63/63 - 0s - 3ms/step - loss: 0.2592 - val_loss: 2.4782
Epoch 4/50
63/63 - 0s - 3ms/step - loss: 0.2222 - val_loss: 2.5417
Epoch 5/50
63/63 - 0s - 3ms/step - loss: 0.1948 - val_loss: 2.5025
Epoch 6/50
63/63 - 0s - 3ms/step - loss: 0.1798 - val_loss: 2.5261
Epoch 7/50
63/63 - 0s - 3ms/step - loss: 0.1666 - val_loss: 2.5400
Epoch 8/50
63/63 - 0s - 3ms/step - loss: 0.1583 - val_loss: 2.4756
Epoch 9/50
63/63 - 0s - 3ms/step - loss: 0.1527 - val_loss: 2.6023
Epoch 10/50
63/63 - 0s - 3ms/step - loss: 0.1441 - val_loss: 2.5402
Epoch 11/50
63/63 - 0s - 3ms/step - loss: 0.1390 - val_loss: 2.5495
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.8675
Per-joint RMSE: 1.0030 0.7678 0.7399 0.5016 1.2666 0.7188
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:30:15.311660: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:30:15.336238: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 05:30:16.178562: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:16.183193: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:16.183983: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:16.185600: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:16.186383: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:16.187205: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:16.267130: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:16.267958: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:16.268763: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:16.269531: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:30:16.562149: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.203524e-01  RMSE=8.487357e-01
  per-joint RMSE: 0.9821 0.7240 0.6267 0.4857 1.2693 0.7705
Residual LSTM:  MSE=7.526115e-01      RMSE=8.675318e-01
  per-joint RMSE: 1.0030 0.7678 0.7399 0.5016 1.2666 0.7188
Combined torque MSE=7.526115e-01     RMSE=8.675318e-01
  per-joint RMSE: 1.0030 0.7678 0.7399 0.5016 1.2666 0.7188
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200.npz --H 25 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200.json
H=25, n_dof=6, feature_dim=18
X_train: (20020, 25, 18)  Y_train: (20020, 6)
X_test : (4378, 25, 18)  Y_test : (4378, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:30:18.492768: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:30:18.516628: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (20020, 25, 18), Y_train = (20020, 6)
  X_test  = (4378, 25, 18),  Y_test  = (4378, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:30:19.500980: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:19.505918: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:19.506790: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:19.508341: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:19.509213: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:19.509955: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:19.580428: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:19.581264: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:19.582103: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:19.582834: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:30:20.486602: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
63/63 - 2s - 24ms/step - loss: 0.3436 - val_loss: 1.3066
Epoch 2/50
63/63 - 0s - 3ms/step - loss: 0.2073 - val_loss: 1.3562
Epoch 3/50
63/63 - 0s - 3ms/step - loss: 0.1706 - val_loss: 1.4209
Epoch 4/50
63/63 - 0s - 3ms/step - loss: 0.1529 - val_loss: 1.3136
Epoch 5/50
63/63 - 0s - 3ms/step - loss: 0.1423 - val_loss: 1.3643
Epoch 6/50
63/63 - 0s - 3ms/step - loss: 0.1334 - val_loss: 1.3533
Epoch 7/50
63/63 - 0s - 3ms/step - loss: 0.1267 - val_loss: 1.3361
Epoch 8/50
63/63 - 0s - 3ms/step - loss: 0.1222 - val_loss: 1.3340
Epoch 9/50
63/63 - 0s - 3ms/step - loss: 0.1202 - val_loss: 1.3217
Epoch 10/50
63/63 - 0s - 3ms/step - loss: 0.1153 - val_loss: 1.3375
Epoch 11/50
63/63 - 0s - 3ms/step - loss: 0.1126 - val_loss: 1.3692
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7997
Per-joint RMSE: 0.9255 0.6449 0.5462 0.4407 1.2462 0.7207
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:30:24.095340: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:30:24.119476: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:30:24.982296: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:24.986872: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:24.987662: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:24.989311: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:24.990098: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:24.990916: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:25.067597: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:25.068486: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:25.069271: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:25.069999: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:30:25.363998: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.203524e-01  RMSE=8.487357e-01
  per-joint RMSE: 0.9821 0.7240 0.6267 0.4857 1.2693 0.7705
Residual LSTM:  MSE=6.395661e-01      RMSE=7.997288e-01
  per-joint RMSE: 0.9255 0.6449 0.5462 0.4407 1.2462 0.7207
Combined torque MSE=6.395661e-01     RMSE=7.997288e-01
  per-joint RMSE: 0.9255 0.6449 0.5462 0.4407 1.2462 0.7207
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200.npz --H 25 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200.json
H=25, n_dof=6, feature_dim=18
X_train: (20020, 25, 18)  Y_train: (20020, 6)
X_test : (4378, 25, 18)  Y_test : (4378, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:30:27.252906: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:30:27.277183: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (20020, 25, 18), Y_train = (20020, 6)
  X_test  = (4378, 25, 18),  Y_test  = (4378, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:30:28.257270: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:28.261976: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:28.262765: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:28.264540: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:28.265324: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:28.266137: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:28.341834: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:28.342659: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:28.343400: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:28.344118: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:30:29.285935: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
63/63 - 2s - 24ms/step - loss: 0.3257 - val_loss: 1.0943
Epoch 2/50
63/63 - 0s - 3ms/step - loss: 0.1879 - val_loss: 1.1297
Epoch 3/50
63/63 - 0s - 3ms/step - loss: 0.1583 - val_loss: 1.1606
Epoch 4/50
63/63 - 0s - 3ms/step - loss: 0.1430 - val_loss: 1.1670
Epoch 5/50
63/63 - 0s - 3ms/step - loss: 0.1348 - val_loss: 1.1433
Epoch 6/50
63/63 - 0s - 3ms/step - loss: 0.1281 - val_loss: 1.1425
Epoch 7/50
63/63 - 0s - 3ms/step - loss: 0.1229 - val_loss: 1.1522
Epoch 8/50
63/63 - 0s - 3ms/step - loss: 0.1182 - val_loss: 1.1545
Epoch 9/50
63/63 - 0s - 3ms/step - loss: 0.1147 - val_loss: 1.1537
Epoch 10/50
63/63 - 0s - 3ms/step - loss: 0.1126 - val_loss: 1.1234
Epoch 11/50
63/63 - 0s - 3ms/step - loss: 0.1089 - val_loss: 1.1517
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7818
Per-joint RMSE: 0.8722 0.5722 0.5953 0.4491 1.2377 0.7006
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:30:32.912593: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:30:32.937705: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:30:33.783382: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:33.788010: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:33.788800: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:33.790459: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:33.791234: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:33.791965: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:33.871490: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:33.872399: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:33.873142: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:33.873875: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:30:34.171630: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.203524e-01  RMSE=8.487357e-01
  per-joint RMSE: 0.9821 0.7240 0.6267 0.4857 1.2693 0.7705
Residual LSTM:  MSE=6.111505e-01      RMSE=7.817612e-01
  per-joint RMSE: 0.8722 0.5722 0.5953 0.4491 1.2377 0.7006
Combined torque MSE=6.111505e-01     RMSE=7.817612e-01
  per-joint RMSE: 0.8722 0.5722 0.5953 0.4491 1.2377 0.7006
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200.npz --H 50 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200.json
H=50, n_dof=6, feature_dim=24
X_train: (19520, 50, 24)  Y_train: (19520, 6)
X_test : (4253, 50, 24)  Y_test : (4253, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:30:36.097207: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:30:36.120996: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (19520, 50, 24), Y_train = (19520, 6)
  X_test  = (4253, 50, 24),  Y_test  = (4253, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:30:37.207441: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:37.211997: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:37.212788: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:37.214457: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:37.215449: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:37.216287: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:37.295983: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:37.296910: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:37.297659: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:37.298394: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:30:38.234721: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
61/61 - 2s - 25ms/step - loss: 0.3236 - val_loss: 1.4048
Epoch 2/50
61/61 - 0s - 4ms/step - loss: 0.1840 - val_loss: 1.2814
Epoch 3/50
61/61 - 0s - 4ms/step - loss: 0.1585 - val_loss: 1.2720
Epoch 4/50
61/61 - 0s - 4ms/step - loss: 0.1435 - val_loss: 1.2672
Epoch 5/50
61/61 - 0s - 4ms/step - loss: 0.1337 - val_loss: 1.2335
Epoch 6/50
61/61 - 0s - 4ms/step - loss: 0.1280 - val_loss: 1.2656
Epoch 7/50
61/61 - 0s - 4ms/step - loss: 0.1235 - val_loss: 1.2688
Epoch 8/50
61/61 - 0s - 4ms/step - loss: 0.1197 - val_loss: 1.2492
Epoch 9/50
61/61 - 0s - 4ms/step - loss: 0.1163 - val_loss: 1.2529
Epoch 10/50
61/61 - 0s - 4ms/step - loss: 0.1136 - val_loss: 1.2233
Epoch 11/50
61/61 - 0s - 4ms/step - loss: 0.1103 - val_loss: 1.2775
Epoch 12/50
61/61 - 0s - 4ms/step - loss: 0.1085 - val_loss: 1.2138
Epoch 13/50
61/61 - 0s - 4ms/step - loss: 0.1060 - val_loss: 1.2308
Epoch 14/50
61/61 - 0s - 4ms/step - loss: 0.1036 - val_loss: 1.2060
Epoch 15/50
61/61 - 0s - 4ms/step - loss: 0.1024 - val_loss: 1.2283
Epoch 16/50
61/61 - 0s - 4ms/step - loss: 0.1006 - val_loss: 1.1930
Epoch 17/50
61/61 - 0s - 5ms/step - loss: 0.0987 - val_loss: 1.1707
Epoch 18/50
61/61 - 0s - 4ms/step - loss: 0.0975 - val_loss: 1.1575
Epoch 19/50
61/61 - 0s - 4ms/step - loss: 0.0958 - val_loss: 1.1993
Epoch 20/50
61/61 - 0s - 4ms/step - loss: 0.0961 - val_loss: 1.1739
Epoch 21/50
61/61 - 0s - 4ms/step - loss: 0.0935 - val_loss: 1.1396
Epoch 22/50
61/61 - 0s - 4ms/step - loss: 0.0928 - val_loss: 1.2015
Epoch 23/50
61/61 - 0s - 4ms/step - loss: 0.0927 - val_loss: 1.1374
Epoch 24/50
61/61 - 0s - 4ms/step - loss: 0.0915 - val_loss: 1.1583
Epoch 25/50
61/61 - 0s - 4ms/step - loss: 0.0908 - val_loss: 1.1190
Epoch 26/50
61/61 - 0s - 4ms/step - loss: 0.0907 - val_loss: 1.1504
Epoch 27/50
61/61 - 0s - 4ms/step - loss: 0.0892 - val_loss: 1.1352
Epoch 28/50
61/61 - 0s - 4ms/step - loss: 0.0892 - val_loss: 1.0961
Epoch 29/50
61/61 - 0s - 4ms/step - loss: 0.0880 - val_loss: 1.1188
Epoch 30/50
61/61 - 0s - 4ms/step - loss: 0.0878 - val_loss: 1.1050
Epoch 31/50
61/61 - 0s - 4ms/step - loss: 0.0865 - val_loss: 1.0857
Epoch 32/50
61/61 - 0s - 4ms/step - loss: 0.0870 - val_loss: 1.0885
Epoch 33/50
61/61 - 0s - 4ms/step - loss: 0.0863 - val_loss: 1.0948
Epoch 34/50
61/61 - 0s - 4ms/step - loss: 0.0852 - val_loss: 1.1133
Epoch 35/50
61/61 - 0s - 4ms/step - loss: 0.0851 - val_loss: 1.0983
Epoch 36/50
61/61 - 0s - 4ms/step - loss: 0.0849 - val_loss: 1.0842
Epoch 37/50
61/61 - 0s - 4ms/step - loss: 0.0842 - val_loss: 1.0783
Epoch 38/50
61/61 - 0s - 4ms/step - loss: 0.0842 - val_loss: 1.0842
Epoch 39/50
61/61 - 0s - 4ms/step - loss: 0.0842 - val_loss: 1.0942
Epoch 40/50
61/61 - 0s - 4ms/step - loss: 0.0826 - val_loss: 1.1262
Epoch 41/50
61/61 - 0s - 4ms/step - loss: 0.0827 - val_loss: 1.0907
Epoch 42/50
61/61 - 0s - 4ms/step - loss: 0.0821 - val_loss: 1.0988
Epoch 43/50
61/61 - 0s - 4ms/step - loss: 0.0819 - val_loss: 1.1072
Epoch 44/50
61/61 - 0s - 4ms/step - loss: 0.0822 - val_loss: 1.1024
Epoch 45/50
61/61 - 0s - 4ms/step - loss: 0.0815 - val_loss: 1.1007
Epoch 46/50
61/61 - 0s - 4ms/step - loss: 0.0811 - val_loss: 1.1128
Epoch 47/50
61/61 - 0s - 4ms/step - loss: 0.0808 - val_loss: 1.1151
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7697
Per-joint RMSE: 0.8562 0.5954 0.5493 0.4406 1.2252 0.6859
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:30:51.678121: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:30:51.702663: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 05:30:52.559628: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:52.564262: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:52.565141: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:52.566801: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:52.567595: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:52.568332: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:52.652164: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:52.653001: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:52.653827: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:52.654592: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:30:52.951540: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.093006e-01  RMSE=8.421999e-01
  per-joint RMSE: 0.9807 0.7067 0.6206 0.4867 1.2719 0.7449
Residual LSTM:  MSE=5.924780e-01      RMSE=7.697259e-01
  per-joint RMSE: 0.8562 0.5954 0.5493 0.4406 1.2252 0.6859
Combined torque MSE=5.924780e-01     RMSE=7.697259e-01
  per-joint RMSE: 0.8562 0.5954 0.5493 0.4406 1.2252 0.6859
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200.npz --H 50 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200.json
H=50, n_dof=6, feature_dim=6
X_train: (19520, 50, 6)  Y_train: (19520, 6)
X_test : (4253, 50, 6)  Y_test : (4253, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:30:54.847493: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:30:54.871444: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (19520, 50, 6), Y_train = (19520, 6)
  X_test  = (4253, 50, 6),  Y_test  = (4253, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:30:55.843554: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:55.848161: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:55.848953: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:55.850649: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:55.851435: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:55.852161: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:55.930429: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:55.931262: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:55.932009: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:30:55.932824: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:30:56.840355: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
61/61 - 2s - 25ms/step - loss: 0.4736 - val_loss: 2.4294
Epoch 2/50
61/61 - 0s - 4ms/step - loss: 0.2678 - val_loss: 3.3148
Epoch 3/50
61/61 - 0s - 4ms/step - loss: 0.2116 - val_loss: 3.0456
Epoch 4/50
61/61 - 0s - 4ms/step - loss: 0.1864 - val_loss: 3.1178
Epoch 5/50
61/61 - 0s - 4ms/step - loss: 0.1736 - val_loss: 3.0062
Epoch 6/50
61/61 - 0s - 4ms/step - loss: 0.1654 - val_loss: 2.9986
Epoch 7/50
61/61 - 0s - 4ms/step - loss: 0.1557 - val_loss: 3.0468
Epoch 8/50
61/61 - 0s - 4ms/step - loss: 0.1481 - val_loss: 2.9305
Epoch 9/50
61/61 - 0s - 4ms/step - loss: 0.1461 - val_loss: 2.9657
Epoch 10/50
61/61 - 0s - 4ms/step - loss: 0.1411 - val_loss: 2.9560
Epoch 11/50
61/61 - 0s - 4ms/step - loss: 0.1369 - val_loss: 2.9051
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.8733
Per-joint RMSE: 1.0204 0.7516 0.7212 0.5212 1.2745 0.7438
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:31:01.114749: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:31:01.139189: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 05:31:01.999706: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:02.004334: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:02.005281: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:02.006885: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:02.007680: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:02.008407: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:02.087693: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:02.088613: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:02.089417: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:02.090139: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:31:02.384127: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.093006e-01  RMSE=8.421999e-01
  per-joint RMSE: 0.9807 0.7067 0.6206 0.4867 1.2719 0.7449
Residual LSTM:  MSE=7.626083e-01      RMSE=8.732744e-01
  per-joint RMSE: 1.0204 0.7516 0.7212 0.5212 1.2745 0.7438
Combined torque MSE=7.626083e-01     RMSE=8.732744e-01
  per-joint RMSE: 1.0204 0.7516 0.7212 0.5212 1.2745 0.7438
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200.npz --H 50 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200.json
H=50, n_dof=6, feature_dim=18
X_train: (19520, 50, 18)  Y_train: (19520, 6)
X_test : (4253, 50, 18)  Y_test : (4253, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:31:04.323653: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:31:04.347456: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (19520, 50, 18), Y_train = (19520, 6)
  X_test  = (4253, 50, 18),  Y_test  = (4253, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:31:05.401476: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:05.406131: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:05.406925: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:05.408454: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:05.409322: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:05.410142: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:05.488660: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:05.489491: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:05.490234: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:05.490972: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:31:06.397906: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
61/61 - 2s - 25ms/step - loss: 0.3450 - val_loss: 1.4505
Epoch 2/50
61/61 - 0s - 4ms/step - loss: 0.2079 - val_loss: 1.3335
Epoch 3/50
61/61 - 0s - 4ms/step - loss: 0.1748 - val_loss: 1.3546
Epoch 4/50
61/61 - 0s - 4ms/step - loss: 0.1586 - val_loss: 1.2922
Epoch 5/50
61/61 - 0s - 4ms/step - loss: 0.1469 - val_loss: 1.2874
Epoch 6/50
61/61 - 0s - 4ms/step - loss: 0.1380 - val_loss: 1.3167
Epoch 7/50
61/61 - 0s - 4ms/step - loss: 0.1337 - val_loss: 1.2692
Epoch 8/50
61/61 - 0s - 4ms/step - loss: 0.1282 - val_loss: 1.2671
Epoch 9/50
61/61 - 0s - 4ms/step - loss: 0.1241 - val_loss: 1.2834
Epoch 10/50
61/61 - 0s - 4ms/step - loss: 0.1234 - val_loss: 1.3046
Epoch 11/50
61/61 - 0s - 4ms/step - loss: 0.1190 - val_loss: 1.2997
Epoch 12/50
61/61 - 0s - 4ms/step - loss: 0.1153 - val_loss: 1.3048
Epoch 13/50
61/61 - 0s - 4ms/step - loss: 0.1125 - val_loss: 1.3101
Epoch 14/50
61/61 - 0s - 4ms/step - loss: 0.1101 - val_loss: 1.3084
Epoch 15/50
61/61 - 0s - 4ms/step - loss: 0.1076 - val_loss: 1.3069
Epoch 16/50
61/61 - 0s - 4ms/step - loss: 0.1068 - val_loss: 1.3212
Epoch 17/50
61/61 - 0s - 4ms/step - loss: 0.1050 - val_loss: 1.3171
Epoch 18/50
61/61 - 0s - 5ms/step - loss: 0.1042 - val_loss: 1.3044
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7838
Per-joint RMSE: 0.8966 0.6165 0.5412 0.4297 1.2387 0.7002
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:31:12.499512: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:31:12.524418: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:31:13.376390: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:13.380978: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:13.381768: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:13.383445: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:13.384230: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:13.384968: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:13.464162: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:13.465071: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:13.465812: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:13.466542: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:31:13.763948: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.093006e-01  RMSE=8.421999e-01
  per-joint RMSE: 0.9807 0.7067 0.6206 0.4867 1.2719 0.7449
Residual LSTM:  MSE=6.143522e-01      RMSE=7.838062e-01
  per-joint RMSE: 0.8966 0.6165 0.5412 0.4297 1.2387 0.7002
Combined torque MSE=6.143522e-01     RMSE=7.838062e-01
  per-joint RMSE: 0.8966 0.6165 0.5412 0.4297 1.2387 0.7002
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200.npz --H 50 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200.json
H=50, n_dof=6, feature_dim=18
X_train: (19520, 50, 18)  Y_train: (19520, 6)
X_test : (4253, 50, 18)  Y_test : (4253, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:31:15.716790: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:31:15.740521: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (19520, 50, 18), Y_train = (19520, 6)
  X_test  = (4253, 50, 18),  Y_test  = (4253, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:31:16.817627: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:16.822267: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:16.823132: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:16.824622: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:16.825408: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:16.826147: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:16.906150: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:16.907062: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:16.907806: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:16.908537: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:31:17.821838: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
61/61 - 2s - 25ms/step - loss: 0.3263 - val_loss: 1.1764
Epoch 2/50
61/61 - 0s - 4ms/step - loss: 0.1947 - val_loss: 1.0783
Epoch 3/50
61/61 - 0s - 4ms/step - loss: 0.1637 - val_loss: 1.0669
Epoch 4/50
61/61 - 0s - 4ms/step - loss: 0.1481 - val_loss: 1.0209
Epoch 5/50
61/61 - 0s - 4ms/step - loss: 0.1380 - val_loss: 0.9935
Epoch 6/50
61/61 - 0s - 4ms/step - loss: 0.1304 - val_loss: 1.0150
Epoch 7/50
61/61 - 0s - 4ms/step - loss: 0.1249 - val_loss: 0.9926
Epoch 8/50
61/61 - 0s - 4ms/step - loss: 0.1209 - val_loss: 1.0048
Epoch 9/50
61/61 - 0s - 4ms/step - loss: 0.1173 - val_loss: 1.0143
Epoch 10/50
61/61 - 0s - 4ms/step - loss: 0.1149 - val_loss: 1.0038
Epoch 11/50
61/61 - 0s - 4ms/step - loss: 0.1120 - val_loss: 0.9929
Epoch 12/50
61/61 - 0s - 4ms/step - loss: 0.1096 - val_loss: 1.0030
Epoch 13/50
61/61 - 0s - 4ms/step - loss: 0.1074 - val_loss: 1.0031
Epoch 14/50
61/61 - 0s - 4ms/step - loss: 0.1044 - val_loss: 1.0148
Epoch 15/50
61/61 - 0s - 4ms/step - loss: 0.1037 - val_loss: 1.0063
Epoch 16/50
61/61 - 0s - 4ms/step - loss: 0.1015 - val_loss: 1.0036
Epoch 17/50
61/61 - 0s - 4ms/step - loss: 0.1001 - val_loss: 1.0185
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7550
Per-joint RMSE: 0.8257 0.5665 0.5204 0.4240 1.2268 0.6797
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:31:23.651989: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:31:23.676363: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:31:24.530640: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:24.535301: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:24.536100: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:24.537786: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:24.538668: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:24.539408: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:24.618551: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:24.619392: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:24.620133: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:24.620869: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:31:24.918402: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.093006e-01  RMSE=8.421999e-01
  per-joint RMSE: 0.9807 0.7067 0.6206 0.4867 1.2719 0.7449
Residual LSTM:  MSE=5.700519e-01      RMSE=7.550178e-01
  per-joint RMSE: 0.8257 0.5665 0.5204 0.4240 1.2268 0.6797
Combined torque MSE=5.700519e-01     RMSE=7.550178e-01
  per-joint RMSE: 0.8257 0.5665 0.5204 0.4240 1.2268 0.6797
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=2                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz                                 ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed0_dataset.npz -t structured -s 2 -r 0 --hp_preset fast_debug --epochs 200 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200.jax' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 200, 'lagrangian_type': <function structured_lagrangian_fn at 0x7c6053e701f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed0_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed0_dataset.npz
   dt ≈ 0.0241314790392838
  dof = 6
  Train trajectories = 40
  Test trajectories  = 10
  Train samples = 20560
  Test samples  = 4513
################################################

2026-01-22 05:31:29.180680: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200 | type=structured | dof=6
################################################
2026-01-22 05:31:32.305449: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:31:32.305484: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:31:32.305490: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:31:32.305517: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:31:32.305522: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:31:32.305537: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:31:32.305576: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:31:32.305582: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:31:32.305597: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:31:32.305602: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   4.8s, Loss=1.39e+01, Inv=1.39e+01, For=1.51e+02, Power=2.31e+00
  [eval] test_mse=3.389e+00  (n=4513)
Epoch 00050: Time=   9.1s, Loss=2.09e+00, Inv=2.09e+00, For=8.88e+01, Power=6.22e-01
Epoch 00100: Time=  11.8s, Loss=1.86e+00, Inv=1.86e+00, For=9.40e+01, Power=4.97e-01
Epoch 00150: Time=  14.3s, Loss=1.77e+00, Inv=1.77e+00, For=1.07e+02, Power=4.28e-01
Epoch 00200: Time=  16.8s, Loss=1.71e+00, Inv=1.71e+00, For=1.20e+02, Power=3.85e-01
  [eval] test_mse=4.174e+00  (n=4513)
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200
Torque MSE  = 6.957e-01
Torque RMSE = 8.341e-01
Per-joint MSE : 8.186e-01 5.456e-01 1.570e+00 1.948e-01 5.738e-01 4.709e-01
Per-joint RMSE: 9.047e-01 7.387e-01 1.253e+00 4.414e-01 7.575e-01 6.862e-01
Comp Time per Sample = 6.084e-08s / 16435951.6Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed0_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed0_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200.jax
Detected n_dof=6 (seed=2)
2026-01-22 05:31:51.281444: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 40 trajectories
2026-01-22 05:31:52.596796: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:31:53.781222: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:31:53.781234: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:31:55.351965: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:31:55.351978: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/40
  done 40/40

Exporting split=test: 10 trajectories
2026-01-22 05:31:56.851577: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 10/10

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200.npz --H 25 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200.json
H=25, n_dof=6, feature_dim=24
X_train: (20020, 25, 24)  Y_train: (20020, 6)
X_test : (4378, 25, 24)  Y_test : (4378, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:31:58.901281: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:31:58.925215: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (20020, 25, 24), Y_train = (20020, 6)
  X_test  = (4378, 25, 24),  Y_test  = (4378, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:31:59.930246: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:59.934886: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:59.935718: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:59.937314: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:59.938123: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:31:59.938947: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:00.015484: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:00.016342: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:00.017115: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:00.017876: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:32:00.968928: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
63/63 - 2s - 24ms/step - loss: 0.3218 - val_loss: 1.2286
Epoch 2/50
63/63 - 0s - 3ms/step - loss: 0.1880 - val_loss: 1.3586
Epoch 3/50
63/63 - 0s - 3ms/step - loss: 0.1598 - val_loss: 1.4980
Epoch 4/50
63/63 - 0s - 3ms/step - loss: 0.1457 - val_loss: 1.5144
Epoch 5/50
63/63 - 0s - 3ms/step - loss: 0.1371 - val_loss: 1.3505
Epoch 6/50
63/63 - 0s - 3ms/step - loss: 0.1292 - val_loss: 1.2917
Epoch 7/50
63/63 - 0s - 3ms/step - loss: 0.1235 - val_loss: 1.3387
Epoch 8/50
63/63 - 0s - 3ms/step - loss: 0.1195 - val_loss: 1.3624
Epoch 9/50
63/63 - 0s - 3ms/step - loss: 0.1158 - val_loss: 1.3839
Epoch 10/50
63/63 - 0s - 3ms/step - loss: 0.1122 - val_loss: 1.4007
Epoch 11/50
63/63 - 0s - 3ms/step - loss: 0.1094 - val_loss: 1.4429
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7827
Per-joint RMSE: 0.8055 0.6806 1.1940 0.4264 0.7563 0.6198
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:32:04.580944: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:32:04.606075: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 05:32:05.454350: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:05.458898: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:05.459692: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:05.461361: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:05.462145: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:05.462879: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:05.538245: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:05.539076: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:05.539816: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:05.540543: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:32:05.840862: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.095132e-01  RMSE=8.423260e-01
  per-joint RMSE: 0.9093 0.7392 1.2703 0.4458 0.7677 0.6944
Residual LSTM:  MSE=6.126019e-01      RMSE=7.826889e-01
  per-joint RMSE: 0.8055 0.6806 1.1940 0.4264 0.7563 0.6198
Combined torque MSE=6.126019e-01     RMSE=7.826889e-01
  per-joint RMSE: 0.8055 0.6806 1.1940 0.4264 0.7563 0.6198
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200.npz --H 25 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200.json
H=25, n_dof=6, feature_dim=6
X_train: (20020, 25, 6)  Y_train: (20020, 6)
X_test : (4378, 25, 6)  Y_test : (4378, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:32:07.742468: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:32:07.766290: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (20020, 25, 6), Y_train = (20020, 6)
  X_test  = (4378, 25, 6),  Y_test  = (4378, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:32:08.724863: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:08.729677: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:08.730646: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:08.732297: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:08.733111: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:08.733884: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:08.813618: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:08.814575: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:08.815348: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:08.816120: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:32:09.711007: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
63/63 - 2s - 24ms/step - loss: 0.5368 - val_loss: 2.1807
Epoch 2/50
63/63 - 0s - 3ms/step - loss: 0.3241 - val_loss: 2.4527
Epoch 3/50
63/63 - 0s - 3ms/step - loss: 0.2521 - val_loss: 2.8121
Epoch 4/50
63/63 - 0s - 3ms/step - loss: 0.2167 - val_loss: 2.8066
Epoch 5/50
63/63 - 0s - 3ms/step - loss: 0.1940 - val_loss: 2.8633
Epoch 6/50
63/63 - 0s - 3ms/step - loss: 0.1795 - val_loss: 2.6806
Epoch 7/50
63/63 - 0s - 3ms/step - loss: 0.1662 - val_loss: 2.8152
Epoch 8/50
63/63 - 0s - 3ms/step - loss: 0.1554 - val_loss: 2.7113
Epoch 9/50
63/63 - 0s - 3ms/step - loss: 0.1501 - val_loss: 2.7229
Epoch 10/50
63/63 - 0s - 3ms/step - loss: 0.1436 - val_loss: 2.6855
Epoch 11/50
63/63 - 0s - 3ms/step - loss: 0.1417 - val_loss: 2.7037
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.8277
Per-joint RMSE: 0.8946 0.7753 1.2140 0.4458 0.7669 0.6698
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:32:13.295511: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:32:13.320167: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 05:32:14.168283: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:14.173054: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:14.173928: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:14.175585: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:14.176370: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:14.177096: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:14.252211: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:14.253041: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:14.253789: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:14.254519: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:32:14.548127: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.095132e-01  RMSE=8.423260e-01
  per-joint RMSE: 0.9093 0.7392 1.2703 0.4458 0.7677 0.6944
Residual LSTM:  MSE=6.851238e-01      RMSE=8.277221e-01
  per-joint RMSE: 0.8946 0.7753 1.2140 0.4458 0.7669 0.6698
Combined torque MSE=6.851238e-01     RMSE=8.277221e-01
  per-joint RMSE: 0.8946 0.7753 1.2140 0.4458 0.7669 0.6698
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200.npz --H 25 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200.json
H=25, n_dof=6, feature_dim=18
X_train: (20020, 25, 18)  Y_train: (20020, 6)
X_test : (4378, 25, 18)  Y_test : (4378, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:32:16.453182: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:32:16.477020: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (20020, 25, 18), Y_train = (20020, 6)
  X_test  = (4378, 25, 18),  Y_test  = (4378, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:32:17.472780: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:17.477381: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:17.478327: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:17.479857: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:17.480634: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:17.481370: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:17.550567: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:17.551413: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:17.552153: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:17.552884: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:32:18.494454: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
63/63 - 2s - 24ms/step - loss: 0.3493 - val_loss: 1.2618
Epoch 2/50
63/63 - 0s - 3ms/step - loss: 0.2079 - val_loss: 1.3069
Epoch 3/50
63/63 - 0s - 3ms/step - loss: 0.1720 - val_loss: 1.2945
Epoch 4/50
63/63 - 0s - 3ms/step - loss: 0.1540 - val_loss: 1.2929
Epoch 5/50
63/63 - 0s - 3ms/step - loss: 0.1428 - val_loss: 1.3188
Epoch 6/50
63/63 - 0s - 3ms/step - loss: 0.1348 - val_loss: 1.3564
Epoch 7/50
63/63 - 0s - 3ms/step - loss: 0.1296 - val_loss: 1.3582
Epoch 8/50
63/63 - 0s - 3ms/step - loss: 0.1255 - val_loss: 1.3624
Epoch 9/50
63/63 - 0s - 3ms/step - loss: 0.1221 - val_loss: 1.4040
Epoch 10/50
63/63 - 0s - 3ms/step - loss: 0.1206 - val_loss: 1.3942
Epoch 11/50
63/63 - 0s - 3ms/step - loss: 0.1150 - val_loss: 1.3775
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.8260
Per-joint RMSE: 0.9151 0.8012 1.2490 0.3842 0.7257 0.6161
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:32:22.090051: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:32:22.114695: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:32:22.970505: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:22.975119: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:22.975912: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:22.977691: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:22.978487: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:22.979234: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:23.060436: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:23.061268: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:23.062009: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:23.062746: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:32:23.358694: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.095132e-01  RMSE=8.423260e-01
  per-joint RMSE: 0.9093 0.7392 1.2703 0.4458 0.7677 0.6944
Residual LSTM:  MSE=6.821937e-01      RMSE=8.259502e-01
  per-joint RMSE: 0.9151 0.8012 1.2490 0.3842 0.7257 0.6161
Combined torque MSE=6.821937e-01     RMSE=8.259502e-01
  per-joint RMSE: 0.9151 0.8012 1.2490 0.3842 0.7257 0.6161
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200.npz --H 25 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200.json
H=25, n_dof=6, feature_dim=18
X_train: (20020, 25, 18)  Y_train: (20020, 6)
X_test : (4378, 25, 18)  Y_test : (4378, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:32:25.239564: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:32:25.263416: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (20020, 25, 18), Y_train = (20020, 6)
  X_test  = (4378, 25, 18),  Y_test  = (4378, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:32:26.250021: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:26.254659: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:26.255445: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:26.256955: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:26.257745: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:26.258472: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:26.337986: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:26.338823: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:26.339667: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:26.340397: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:32:27.265794: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
63/63 - 2s - 24ms/step - loss: 0.3242 - val_loss: 1.0565
Epoch 2/50
63/63 - 0s - 3ms/step - loss: 0.1913 - val_loss: 1.1014
Epoch 3/50
63/63 - 0s - 3ms/step - loss: 0.1629 - val_loss: 1.1977
Epoch 4/50
63/63 - 0s - 3ms/step - loss: 0.1459 - val_loss: 1.2115
Epoch 5/50
63/63 - 0s - 3ms/step - loss: 0.1372 - val_loss: 1.2313
Epoch 6/50
63/63 - 0s - 3ms/step - loss: 0.1303 - val_loss: 1.2404
Epoch 7/50
63/63 - 0s - 3ms/step - loss: 0.1252 - val_loss: 1.2274
Epoch 8/50
63/63 - 0s - 3ms/step - loss: 0.1214 - val_loss: 1.2351
Epoch 9/50
63/63 - 0s - 3ms/step - loss: 0.1171 - val_loss: 1.2040
Epoch 10/50
63/63 - 0s - 3ms/step - loss: 0.1142 - val_loss: 1.1827
Epoch 11/50
63/63 - 0s - 3ms/step - loss: 0.1115 - val_loss: 1.1780
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7883
Per-joint RMSE: 0.8295 0.7625 1.1822 0.3906 0.7370 0.6047
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:32:30.869851: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:32:30.895309: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:32:31.746304: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:31.750883: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:31.751837: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:31.753522: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:31.754305: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:31.755040: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:31.836559: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:31.837398: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:31.838227: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:31.838962: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:32:32.140085: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.095132e-01  RMSE=8.423260e-01
  per-joint RMSE: 0.9093 0.7392 1.2703 0.4458 0.7677 0.6944
Residual LSTM:  MSE=6.214017e-01      RMSE=7.882903e-01
  per-joint RMSE: 0.8295 0.7625 1.1822 0.3906 0.7370 0.6047
Combined torque MSE=6.214017e-01     RMSE=7.882903e-01
  per-joint RMSE: 0.8295 0.7625 1.1822 0.3906 0.7370 0.6047
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200.npz --H 50 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200.json
H=50, n_dof=6, feature_dim=24
X_train: (19520, 50, 24)  Y_train: (19520, 6)
X_test : (4253, 50, 24)  Y_test : (4253, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:32:34.079233: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:32:34.103153: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (19520, 50, 24), Y_train = (19520, 6)
  X_test  = (4253, 50, 24),  Y_test  = (4253, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:32:35.193977: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:35.198606: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:35.199395: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:35.200919: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:35.201703: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:35.202436: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:35.284506: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:35.285341: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:35.286076: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:35.286808: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:32:36.185109: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
61/61 - 2s - 25ms/step - loss: 0.3319 - val_loss: 1.3545
Epoch 2/50
61/61 - 0s - 4ms/step - loss: 0.1896 - val_loss: 1.2387
Epoch 3/50
61/61 - 0s - 4ms/step - loss: 0.1625 - val_loss: 1.2685
Epoch 4/50
61/61 - 0s - 4ms/step - loss: 0.1491 - val_loss: 1.2790
Epoch 5/50
61/61 - 0s - 4ms/step - loss: 0.1391 - val_loss: 1.2517
Epoch 6/50
61/61 - 0s - 4ms/step - loss: 0.1326 - val_loss: 1.2491
Epoch 7/50
61/61 - 0s - 4ms/step - loss: 0.1263 - val_loss: 1.2372
Epoch 8/50
61/61 - 0s - 4ms/step - loss: 0.1222 - val_loss: 1.1716
Epoch 9/50
61/61 - 0s - 4ms/step - loss: 0.1186 - val_loss: 1.1479
Epoch 10/50
61/61 - 0s - 4ms/step - loss: 0.1154 - val_loss: 1.1429
Epoch 11/50
61/61 - 0s - 4ms/step - loss: 0.1121 - val_loss: 1.1583
Epoch 12/50
61/61 - 0s - 4ms/step - loss: 0.1102 - val_loss: 1.1033
Epoch 13/50
61/61 - 0s - 4ms/step - loss: 0.1078 - val_loss: 1.0869
Epoch 14/50
61/61 - 0s - 4ms/step - loss: 0.1046 - val_loss: 1.0933
Epoch 15/50
61/61 - 0s - 4ms/step - loss: 0.1031 - val_loss: 1.1059
Epoch 16/50
61/61 - 0s - 4ms/step - loss: 0.1012 - val_loss: 1.0913
Epoch 17/50
61/61 - 0s - 5ms/step - loss: 0.0995 - val_loss: 1.0852
Epoch 18/50
61/61 - 0s - 4ms/step - loss: 0.0977 - val_loss: 1.0819
Epoch 19/50
61/61 - 0s - 4ms/step - loss: 0.0967 - val_loss: 1.0778
Epoch 20/50
61/61 - 0s - 4ms/step - loss: 0.0962 - val_loss: 1.0624
Epoch 21/50
61/61 - 0s - 4ms/step - loss: 0.0941 - val_loss: 1.0915
Epoch 22/50
61/61 - 0s - 4ms/step - loss: 0.0937 - val_loss: 1.0955
Epoch 23/50
61/61 - 0s - 4ms/step - loss: 0.0930 - val_loss: 1.0884
Epoch 24/50
61/61 - 0s - 4ms/step - loss: 0.0925 - val_loss: 1.0614
Epoch 25/50
61/61 - 0s - 4ms/step - loss: 0.0909 - val_loss: 1.0663
Epoch 26/50
61/61 - 0s - 4ms/step - loss: 0.0905 - val_loss: 1.0646
Epoch 27/50
61/61 - 0s - 4ms/step - loss: 0.0898 - val_loss: 1.0925
Epoch 28/50
61/61 - 0s - 4ms/step - loss: 0.0890 - val_loss: 1.0834
Epoch 29/50
61/61 - 0s - 4ms/step - loss: 0.0889 - val_loss: 1.0580
Epoch 30/50
61/61 - 0s - 4ms/step - loss: 0.0884 - val_loss: 1.0663
Epoch 31/50
61/61 - 0s - 4ms/step - loss: 0.0880 - val_loss: 1.0780
Epoch 32/50
61/61 - 0s - 4ms/step - loss: 0.0873 - val_loss: 1.0776
Epoch 33/50
61/61 - 0s - 4ms/step - loss: 0.0870 - val_loss: 1.0641
Epoch 34/50
61/61 - 0s - 4ms/step - loss: 0.0859 - val_loss: 1.0614
Epoch 35/50
61/61 - 0s - 4ms/step - loss: 0.0857 - val_loss: 1.0595
Epoch 36/50
61/61 - 0s - 4ms/step - loss: 0.0851 - val_loss: 1.0724
Epoch 37/50
61/61 - 0s - 4ms/step - loss: 0.0852 - val_loss: 1.0678
Epoch 38/50
61/61 - 0s - 4ms/step - loss: 0.0850 - val_loss: 1.0784
Epoch 39/50
61/61 - 0s - 4ms/step - loss: 0.0845 - val_loss: 1.0607
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7912
Per-joint RMSE: 0.8248 0.6835 1.2203 0.4102 0.7356 0.6406
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:32:47.507693: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:32:47.532182: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 05:32:48.369260: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:48.373897: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:48.374745: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:48.376433: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:48.377291: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:48.378032: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:48.456386: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:48.457217: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:48.457960: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:48.458743: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:32:48.755550: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.052659e-01  RMSE=8.398011e-01
  per-joint RMSE: 0.9038 0.7348 1.2677 0.4483 0.7756 0.6821
Residual LSTM:  MSE=6.260373e-01      RMSE=7.912252e-01
  per-joint RMSE: 0.8248 0.6835 1.2203 0.4102 0.7356 0.6406
Combined torque MSE=6.260373e-01     RMSE=7.912252e-01
  per-joint RMSE: 0.8248 0.6835 1.2203 0.4102 0.7356 0.6406
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s0_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200.npz --H 50 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200.json
H=50, n_dof=6, feature_dim=6
X_train: (19520, 50, 6)  Y_train: (19520, 6)
X_test : (4253, 50, 6)  Y_test : (4253, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:32:50.656721: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:32:50.680228: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (19520, 50, 6), Y_train = (19520, 6)
  X_test  = (4253, 50, 6),  Y_test  = (4253, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:32:51.664010: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:51.668490: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:51.669272: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:51.670914: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:51.671753: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:51.672530: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:51.742203: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:51.743116: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:51.743943: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:51.744732: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:32:52.602936: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
61/61 - 2s - 25ms/step - loss: 0.4890 - val_loss: 2.4290
Epoch 2/50
61/61 - 0s - 4ms/step - loss: 0.2721 - val_loss: 3.1838
Epoch 3/50
61/61 - 0s - 4ms/step - loss: 0.2242 - val_loss: 2.8154
Epoch 4/50
61/61 - 0s - 4ms/step - loss: 0.1909 - val_loss: 3.0933
Epoch 5/50
61/61 - 0s - 4ms/step - loss: 0.1755 - val_loss: 3.0945
Epoch 6/50
61/61 - 0s - 4ms/step - loss: 0.1657 - val_loss: 3.0325
Epoch 7/50
61/61 - 0s - 4ms/step - loss: 0.1576 - val_loss: 3.0987
Epoch 8/50
61/61 - 0s - 4ms/step - loss: 0.1504 - val_loss: 3.1347
Epoch 9/50
61/61 - 0s - 4ms/step - loss: 0.1469 - val_loss: 3.1039
Epoch 10/50
61/61 - 0s - 4ms/step - loss: 0.1416 - val_loss: 3.1273
Epoch 11/50
61/61 - 0s - 4ms/step - loss: 0.1363 - val_loss: 3.1481
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.8342
Per-joint RMSE: 0.8748 0.7535 1.2330 0.4619 0.7704 0.7181
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:32:56.892451: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:32:56.917330: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 05:32:57.772520: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:57.777221: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:57.778010: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:57.779738: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:57.780527: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:57.781266: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:57.856137: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:57.857003: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:57.857741: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:32:57.858651: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:32:58.151839: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.052659e-01  RMSE=8.398011e-01
  per-joint RMSE: 0.9038 0.7348 1.2677 0.4483 0.7756 0.6821
Residual LSTM:  MSE=6.959319e-01      RMSE=8.342253e-01
  per-joint RMSE: 0.8748 0.7535 1.2330 0.4619 0.7704 0.7181
Combined torque MSE=6.959319e-01     RMSE=8.342253e-01
  per-joint RMSE: 0.8748 0.7535 1.2330 0.4619 0.7704 0.7181
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s0_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200.npz --H 50 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200.json
H=50, n_dof=6, feature_dim=18
X_train: (19520, 50, 18)  Y_train: (19520, 6)
X_test : (4253, 50, 18)  Y_test : (4253, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:33:00.177139: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:33:00.200643: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (19520, 50, 18), Y_train = (19520, 6)
  X_test  = (4253, 50, 18),  Y_test  = (4253, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:33:01.257964: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:01.262561: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:01.263348: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:01.264867: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:01.265647: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:01.266378: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:01.339731: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:01.340562: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:01.341301: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:01.342027: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:33:02.268784: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
61/61 - 2s - 25ms/step - loss: 0.3511 - val_loss: 1.3412
Epoch 2/50
61/61 - 0s - 4ms/step - loss: 0.2100 - val_loss: 1.1833
Epoch 3/50
61/61 - 0s - 4ms/step - loss: 0.1822 - val_loss: 1.2040
Epoch 4/50
61/61 - 0s - 4ms/step - loss: 0.1663 - val_loss: 1.2164
Epoch 5/50
61/61 - 0s - 4ms/step - loss: 0.1555 - val_loss: 1.1687
Epoch 6/50
61/61 - 0s - 4ms/step - loss: 0.1463 - val_loss: 1.1592
Epoch 7/50
61/61 - 0s - 4ms/step - loss: 0.1401 - val_loss: 1.2267
Epoch 8/50
61/61 - 0s - 4ms/step - loss: 0.1378 - val_loss: 1.1725
Epoch 9/50
61/61 - 0s - 4ms/step - loss: 0.1300 - val_loss: 1.1861
Epoch 10/50
61/61 - 0s - 4ms/step - loss: 0.1276 - val_loss: 1.1632
Epoch 11/50
61/61 - 0s - 4ms/step - loss: 0.1223 - val_loss: 1.1816
Epoch 12/50
61/61 - 0s - 4ms/step - loss: 0.1200 - val_loss: 1.1617
Epoch 13/50
61/61 - 0s - 4ms/step - loss: 0.1154 - val_loss: 1.1674
Epoch 14/50
61/61 - 0s - 4ms/step - loss: 0.1127 - val_loss: 1.1975
Epoch 15/50
61/61 - 0s - 4ms/step - loss: 0.1123 - val_loss: 1.2179
Epoch 16/50
61/61 - 0s - 4ms/step - loss: 0.1094 - val_loss: 1.1942
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.8283
Per-joint RMSE: 0.9071 0.7845 1.2708 0.3867 0.7224 0.6259
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:33:07.920007: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:33:07.944456: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:33:08.792334: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:08.796952: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:08.797837: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:08.799454: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:08.800243: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:08.800979: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:08.877075: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:08.877994: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:08.878731: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:08.879463: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:33:09.176711: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.052659e-01  RMSE=8.398011e-01
  per-joint RMSE: 0.9038 0.7348 1.2677 0.4483 0.7756 0.6821
Residual LSTM:  MSE=6.860524e-01      RMSE=8.282828e-01
  per-joint RMSE: 0.9071 0.7845 1.2708 0.3867 0.7224 0.6259
Combined torque MSE=6.860524e-01     RMSE=8.282828e-01
  per-joint RMSE: 0.9071 0.7845 1.2708 0.3867 0.7224 0.6259
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s0_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200.npz --H 50 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200.json
H=50, n_dof=6, feature_dim=18
X_train: (19520, 50, 18)  Y_train: (19520, 6)
X_test : (4253, 50, 18)  Y_test : (4253, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:33:11.099399: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:33:11.123190: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (19520, 50, 18), Y_train = (19520, 6)
  X_test  = (4253, 50, 18),  Y_test  = (4253, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:33:12.182234: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:12.186661: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:12.187448: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:12.189135: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:12.189919: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:12.190659: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:12.269385: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:12.270220: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:12.270962: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:12.271694: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:33:13.209337: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
61/61 - 2s - 25ms/step - loss: 0.3332 - val_loss: 1.1509
Epoch 2/50
61/61 - 0s - 4ms/step - loss: 0.1932 - val_loss: 1.1465
Epoch 3/50
61/61 - 0s - 4ms/step - loss: 0.1655 - val_loss: 1.1663
Epoch 4/50
61/61 - 0s - 4ms/step - loss: 0.1509 - val_loss: 1.1945
Epoch 5/50
61/61 - 0s - 4ms/step - loss: 0.1423 - val_loss: 1.1690
Epoch 6/50
61/61 - 0s - 4ms/step - loss: 0.1348 - val_loss: 1.1794
Epoch 7/50
61/61 - 0s - 4ms/step - loss: 0.1280 - val_loss: 1.1652
Epoch 8/50
61/61 - 0s - 4ms/step - loss: 0.1243 - val_loss: 1.1694
Epoch 9/50
61/61 - 0s - 4ms/step - loss: 0.1210 - val_loss: 1.1204
Epoch 10/50
61/61 - 0s - 4ms/step - loss: 0.1174 - val_loss: 1.1108
Epoch 11/50
61/61 - 0s - 4ms/step - loss: 0.1143 - val_loss: 1.1172
Epoch 12/50
61/61 - 0s - 4ms/step - loss: 0.1114 - val_loss: 1.1214
Epoch 13/50
61/61 - 0s - 4ms/step - loss: 0.1085 - val_loss: 1.1113
Epoch 14/50
61/61 - 0s - 4ms/step - loss: 0.1069 - val_loss: 1.1089
Epoch 15/50
61/61 - 0s - 4ms/step - loss: 0.1059 - val_loss: 1.1300
Epoch 16/50
61/61 - 0s - 4ms/step - loss: 0.1035 - val_loss: 1.0934
Epoch 17/50
61/61 - 0s - 4ms/step - loss: 0.1025 - val_loss: 1.1016
Epoch 18/50
61/61 - 0s - 5ms/step - loss: 0.1010 - val_loss: 1.0876
Epoch 19/50
61/61 - 0s - 4ms/step - loss: 0.0989 - val_loss: 1.0696
Epoch 20/50
61/61 - 0s - 4ms/step - loss: 0.0986 - val_loss: 1.0901
Epoch 21/50
61/61 - 0s - 4ms/step - loss: 0.0971 - val_loss: 1.0758
Epoch 22/50
61/61 - 0s - 4ms/step - loss: 0.0962 - val_loss: 1.0726
Epoch 23/50
61/61 - 0s - 4ms/step - loss: 0.0951 - val_loss: 1.0756
Epoch 24/50
61/61 - 0s - 4ms/step - loss: 0.0945 - val_loss: 1.0768
Epoch 25/50
61/61 - 0s - 4ms/step - loss: 0.0933 - val_loss: 1.0530
Epoch 26/50
61/61 - 0s - 4ms/step - loss: 0.0926 - val_loss: 1.0600
Epoch 27/50
61/61 - 0s - 4ms/step - loss: 0.0924 - val_loss: 1.0574
Epoch 28/50
61/61 - 0s - 4ms/step - loss: 0.0916 - val_loss: 1.0605
Epoch 29/50
61/61 - 0s - 4ms/step - loss: 0.0912 - val_loss: 1.0576
Epoch 30/50
61/61 - 0s - 4ms/step - loss: 0.0902 - val_loss: 1.0550
Epoch 31/50
61/61 - 0s - 4ms/step - loss: 0.0900 - val_loss: 1.0539
Epoch 32/50
61/61 - 0s - 4ms/step - loss: 0.0886 - val_loss: 1.0693
Epoch 33/50
61/61 - 0s - 4ms/step - loss: 0.0881 - val_loss: 1.0652
Epoch 34/50
61/61 - 0s - 4ms/step - loss: 0.0882 - val_loss: 1.0557
Epoch 35/50
61/61 - 0s - 4ms/step - loss: 0.0877 - val_loss: 1.0661
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7772
Per-joint RMSE: 0.7979 0.7376 1.1604 0.4109 0.7334 0.6249
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:33:23.580992: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:33:23.605463: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:33:24.440871: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:24.445477: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:24.446271: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:24.447984: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:24.448779: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:24.449516: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:24.526871: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:24.527781: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:24.528545: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:33:24.529275: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:33:24.828608: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.052659e-01  RMSE=8.398011e-01
  per-joint RMSE: 0.9038 0.7348 1.2677 0.4483 0.7756 0.6821
Residual LSTM:  MSE=6.040698e-01      RMSE=7.772193e-01
  per-joint RMSE: 0.7979 0.7376 1.1604 0.4109 0.7334 0.6249
Combined torque MSE=6.040698e-01     RMSE=7.772193e-01
  per-joint RMSE: 0.7979 0.7376 1.1604 0.4109 0.7334 0.6249
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s0_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

