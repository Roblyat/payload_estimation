################################################################################################################
### RUN: K=50 test_fraction=0.3 seed=1                                                                       ###
### npz_in=/workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p3_seed1_dataset.npz ###
################################################################################################################

#####################
### 1) PREPROCESS ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_delan_dataset.py --qdd True --col_format wide --trajectory_amount 50 --test_fraction 0.3 --seed 1 --raw_csv /workspace/shared/data/raw/delan_UR3_Load0_combined_26.csv --out_npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p3_seed1_dataset.npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Saved: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p3_seed1_dataset.npz
Trajectories: train=35 test=15
Exists: True

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=0                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz                                 ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p3_seed1_dataset.npz -t structured -s 0 -r 0 --hp_preset fast_debug --epochs 200 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200.jax' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 200, 'lagrangian_type': <function structured_lagrangian_fn at 0x7d037d6fc1f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K50_tf0p3_seed1_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p3_seed1_dataset.npz
   dt ≈ 0.031724498445888843
  dof = 6
  Train trajectories = 35
  Test trajectories  = 15
  Train samples = 16260
  Test samples  = 5024
################################################

2026-01-22 05:51:52.740944: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200 | type=structured | dof=6
################################################
2026-01-22 05:51:55.849068: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:51:55.849105: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:51:55.849111: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:51:55.849139: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:51:55.849144: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:51:55.849159: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:51:55.849195: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:51:55.849201: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:51:55.849217: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:51:55.849222: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.0s, Loss=1.16e+01, Inv=1.16e+01, For=1.56e+02, Power=1.80e+00
  [eval] test_mse=9.260e+00  (n=5024)
Epoch 00050: Time=   8.4s, Loss=2.75e+00, Inv=2.75e+00, For=1.09e+02, Power=1.09e+00
Epoch 00100: Time=  10.5s, Loss=2.41e+00, Inv=2.41e+00, For=1.16e+02, Power=1.06e+00
Epoch 00150: Time=  12.6s, Loss=2.18e+00, Inv=2.18e+00, For=1.43e+02, Power=1.03e+00
Epoch 00200: Time=  14.6s, Loss=2.03e+00, Inv=2.03e+00, For=2.20e+02, Power=1.02e+00
  [eval] test_mse=3.579e+01  (n=5024)
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200
Torque MSE  = 5.965e+00
Torque RMSE = 2.442e+00
Per-joint MSE : 1.062e+01 1.352e+01 2.638e+00 8.658e-01 1.034e+00 7.114e+00
Per-joint RMSE: 3.259e+00 3.677e+00 1.624e+00 9.305e-01 1.017e+00 2.667e+00
Comp Time per Sample = 6.391e-08s / 15646752.2Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p3_seed1_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p3_seed1_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200.jax
Detected n_dof=6 (seed=0)
2026-01-22 05:52:12.550721: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 35 trajectories
2026-01-22 05:52:13.866307: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:52:13.866321: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:52:15.349947: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:52:15.349960: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:52:16.861061: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/35
2026-01-22 05:52:18.074029: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:52:18.074063: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:52:18.074068: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 35/35

Exporting split=test: 15 trajectories
  done 15/15

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200.npz --H 25 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200.json
H=25, n_dof=6, feature_dim=24
X_train: (15840, 25, 24)  Y_train: (15840, 6)
X_test : (4832, 25, 24)  Y_test : (4832, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:52:20.393649: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:52:20.418367: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (15840, 25, 24), Y_train = (15840, 6)
  X_test  = (4832, 25, 24),  Y_test  = (4832, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:52:21.399019: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:21.403502: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:21.404933: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:21.406545: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:21.407359: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:21.408021: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:21.489469: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:21.490361: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:21.491157: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:21.491947: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8952 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:52:22.430761: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
50/50 - 2s - 30ms/step - loss: 0.3123 - val_loss: 0.7412
Epoch 2/50
50/50 - 0s - 3ms/step - loss: 0.1819 - val_loss: 0.7238
Epoch 3/50
50/50 - 0s - 3ms/step - loss: 0.1568 - val_loss: 0.7009
Epoch 4/50
50/50 - 0s - 3ms/step - loss: 0.1451 - val_loss: 0.6842
Epoch 5/50
50/50 - 0s - 3ms/step - loss: 0.1377 - val_loss: 0.6782
Epoch 6/50
50/50 - 0s - 3ms/step - loss: 0.1339 - val_loss: 0.6708
Epoch 7/50
50/50 - 0s - 3ms/step - loss: 0.1275 - val_loss: 0.6752
Epoch 8/50
50/50 - 0s - 3ms/step - loss: 0.1247 - val_loss: 0.6781
Epoch 9/50
50/50 - 0s - 3ms/step - loss: 0.1209 - val_loss: 0.6829
Epoch 10/50
50/50 - 0s - 3ms/step - loss: 0.1179 - val_loss: 0.6765
Epoch 11/50
50/50 - 0s - 3ms/step - loss: 0.1178 - val_loss: 0.6820
Epoch 12/50
50/50 - 0s - 3ms/step - loss: 0.1139 - val_loss: 0.6922
Epoch 13/50
50/50 - 0s - 3ms/step - loss: 0.1122 - val_loss: 0.6897
Epoch 14/50
50/50 - 0s - 3ms/step - loss: 0.1108 - val_loss: 0.6965
Epoch 15/50
50/50 - 0s - 3ms/step - loss: 0.1100 - val_loss: 0.6868
Epoch 16/50
50/50 - 0s - 3ms/step - loss: 0.1079 - val_loss: 0.7006
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 2.4248
Per-joint RMSE: 3.2050 3.7203 1.5500 0.9095 1.0051 2.6313
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:52:26.495074: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:52:26.519193: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 05:52:27.364068: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:27.368577: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:27.369460: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:27.371059: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:27.371919: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:27.372647: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:27.452946: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:27.453790: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:27.454535: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:27.455266: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:52:27.752977: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.054321e+00  RMSE=2.460553e+00
  per-joint RMSE: 3.3016 3.6768 1.6347 0.9432 1.0311 2.6984
Residual LSTM:  MSE=5.879443e+00      RMSE=2.424756e+00
  per-joint RMSE: 3.2050 3.7203 1.5500 0.9095 1.0051 2.6313
Combined torque MSE=5.879443e+00     RMSE=2.424756e+00
  per-joint RMSE: 3.2050 3.7203 1.5500 0.9095 1.0051 2.6313
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200.npz --H 25 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200.json
H=25, n_dof=6, feature_dim=6
X_train: (15840, 25, 6)  Y_train: (15840, 6)
X_test : (4832, 25, 6)  Y_test : (4832, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:52:29.671706: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:52:29.695197: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (15840, 25, 6), Y_train = (15840, 6)
  X_test  = (4832, 25, 6),  Y_test  = (4832, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:52:30.637554: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:30.642069: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:30.642863: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:30.644473: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:30.645262: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:30.646008: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:30.725385: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:30.726305: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:30.727052: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:30.727780: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:52:31.643734: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
50/50 - 2s - 30ms/step - loss: 0.5710 - val_loss: 1.8273
Epoch 2/50
50/50 - 0s - 3ms/step - loss: 0.3379 - val_loss: 1.7384
Epoch 3/50
50/50 - 0s - 3ms/step - loss: 0.2829 - val_loss: 1.4611
Epoch 4/50
50/50 - 0s - 3ms/step - loss: 0.2320 - val_loss: 1.4304
Epoch 5/50
50/50 - 0s - 3ms/step - loss: 0.2002 - val_loss: 1.3356
Epoch 6/50
50/50 - 0s - 3ms/step - loss: 0.1809 - val_loss: 1.3375
Epoch 7/50
50/50 - 0s - 3ms/step - loss: 0.1664 - val_loss: 1.3547
Epoch 8/50
50/50 - 0s - 3ms/step - loss: 0.1557 - val_loss: 1.3365
Epoch 9/50
50/50 - 0s - 3ms/step - loss: 0.1492 - val_loss: 1.3461
Epoch 10/50
50/50 - 0s - 3ms/step - loss: 0.1434 - val_loss: 1.3281
Epoch 11/50
50/50 - 0s - 3ms/step - loss: 0.1423 - val_loss: 1.3533
Epoch 12/50
50/50 - 0s - 3ms/step - loss: 0.1355 - val_loss: 1.3237
Epoch 13/50
50/50 - 0s - 3ms/step - loss: 0.1332 - val_loss: 1.2984
Epoch 14/50
50/50 - 0s - 3ms/step - loss: 0.1325 - val_loss: 1.3326
Epoch 15/50
50/50 - 0s - 3ms/step - loss: 0.1277 - val_loss: 1.3328
Epoch 16/50
50/50 - 0s - 3ms/step - loss: 0.1251 - val_loss: 1.3457
Epoch 17/50
50/50 - 0s - 3ms/step - loss: 0.1215 - val_loss: 1.3208
Epoch 18/50
50/50 - 0s - 3ms/step - loss: 0.1196 - val_loss: 1.3251
Epoch 19/50
50/50 - 0s - 4ms/step - loss: 0.1197 - val_loss: 1.3558
Epoch 20/50
50/50 - 0s - 3ms/step - loss: 0.1177 - val_loss: 1.3326
Epoch 21/50
50/50 - 0s - 3ms/step - loss: 0.1162 - val_loss: 1.3361
Epoch 22/50
50/50 - 0s - 3ms/step - loss: 0.1148 - val_loss: 1.3330
Epoch 23/50
50/50 - 0s - 3ms/step - loss: 0.1128 - val_loss: 1.3610
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 2.4864
Per-joint RMSE: 3.3305 3.7779 1.6099 0.9238 1.0068 2.6962
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:52:36.659995: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:52:36.684467: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 05:52:37.537967: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:37.542508: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:37.543292: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:37.545135: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:37.545917: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:37.546653: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:37.623899: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:37.624742: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:37.625493: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:37.626225: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8813 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:52:37.922452: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.054321e+00  RMSE=2.460553e+00
  per-joint RMSE: 3.3016 3.6768 1.6347 0.9432 1.0311 2.6984
Residual LSTM:  MSE=6.182195e+00      RMSE=2.486402e+00
  per-joint RMSE: 3.3305 3.7779 1.6099 0.9238 1.0068 2.6962
Combined torque MSE=6.182195e+00     RMSE=2.486402e+00
  per-joint RMSE: 3.3305 3.7779 1.6099 0.9238 1.0068 2.6962
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200.npz --H 25 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200.json
H=25, n_dof=6, feature_dim=18
X_train: (15840, 25, 18)  Y_train: (15840, 6)
X_test : (4832, 25, 18)  Y_test : (4832, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:52:39.854780: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:52:39.878265: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (15840, 25, 18), Y_train = (15840, 6)
  X_test  = (4832, 25, 18),  Y_test  = (4832, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:52:40.856396: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:40.860942: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:40.861807: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:40.863354: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:40.864219: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:40.864950: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:40.942041: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:40.942882: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:40.943632: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:40.944367: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:52:41.879617: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
50/50 - 1s - 30ms/step - loss: 0.3420 - val_loss: 0.8311
Epoch 2/50
50/50 - 0s - 3ms/step - loss: 0.2215 - val_loss: 0.8609
Epoch 3/50
50/50 - 0s - 3ms/step - loss: 0.1991 - val_loss: 0.8705
Epoch 4/50
50/50 - 0s - 3ms/step - loss: 0.1797 - val_loss: 0.8663
Epoch 5/50
50/50 - 0s - 3ms/step - loss: 0.1703 - val_loss: 0.8682
Epoch 6/50
50/50 - 0s - 3ms/step - loss: 0.1561 - val_loss: 0.8610
Epoch 7/50
50/50 - 0s - 3ms/step - loss: 0.1469 - val_loss: 0.8685
Epoch 8/50
50/50 - 0s - 3ms/step - loss: 0.1409 - val_loss: 0.8833
Epoch 9/50
50/50 - 0s - 3ms/step - loss: 0.1351 - val_loss: 0.8945
Epoch 10/50
50/50 - 0s - 3ms/step - loss: 0.1302 - val_loss: 0.9043
Epoch 11/50
50/50 - 0s - 3ms/step - loss: 0.1273 - val_loss: 0.9165
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 2.4495
Per-joint RMSE: 3.3042 3.6555 1.5932 0.9116 1.0392 2.6961
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:52:45.125987: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:52:45.151756: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:52:45.997145: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:46.001813: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:46.002601: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:46.004389: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:46.005198: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:46.005996: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:46.089239: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:46.090162: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:46.090993: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:46.091722: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:52:46.393432: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.054321e+00  RMSE=2.460553e+00
  per-joint RMSE: 3.3016 3.6768 1.6347 0.9432 1.0311 2.6984
Residual LSTM:  MSE=5.999858e+00      RMSE=2.449461e+00
  per-joint RMSE: 3.3042 3.6555 1.5932 0.9116 1.0392 2.6961
Combined torque MSE=5.999858e+00     RMSE=2.449461e+00
  per-joint RMSE: 3.3042 3.6555 1.5932 0.9116 1.0392 2.6961
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200.npz --H 25 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200.json
H=25, n_dof=6, feature_dim=18
X_train: (15840, 25, 18)  Y_train: (15840, 6)
X_test : (4832, 25, 18)  Y_test : (4832, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:52:48.349511: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:52:48.373131: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (15840, 25, 18), Y_train = (15840, 6)
  X_test  = (4832, 25, 18),  Y_test  = (4832, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:52:49.346823: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:49.351354: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:49.352139: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:49.353638: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:49.354425: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:49.355153: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:49.429605: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:49.430446: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:49.431179: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:49.431904: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:52:50.361136: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
50/50 - 1s - 30ms/step - loss: 0.3174 - val_loss: 0.7768
Epoch 2/50
50/50 - 0s - 3ms/step - loss: 0.1886 - val_loss: 0.7521
Epoch 3/50
50/50 - 0s - 3ms/step - loss: 0.1647 - val_loss: 0.7285
Epoch 4/50
50/50 - 0s - 3ms/step - loss: 0.1503 - val_loss: 0.7270
Epoch 5/50
50/50 - 0s - 3ms/step - loss: 0.1408 - val_loss: 0.7092
Epoch 6/50
50/50 - 0s - 3ms/step - loss: 0.1333 - val_loss: 0.7158
Epoch 7/50
50/50 - 0s - 3ms/step - loss: 0.1289 - val_loss: 0.7184
Epoch 8/50
50/50 - 0s - 3ms/step - loss: 0.1251 - val_loss: 0.7272
Epoch 9/50
50/50 - 0s - 3ms/step - loss: 0.1221 - val_loss: 0.7379
Epoch 10/50
50/50 - 0s - 3ms/step - loss: 0.1197 - val_loss: 0.7336
Epoch 11/50
50/50 - 0s - 3ms/step - loss: 0.1163 - val_loss: 0.7437
Epoch 12/50
50/50 - 0s - 3ms/step - loss: 0.1148 - val_loss: 0.7448
Epoch 13/50
50/50 - 0s - 3ms/step - loss: 0.1128 - val_loss: 0.7554
Epoch 14/50
50/50 - 0s - 3ms/step - loss: 0.1109 - val_loss: 0.7520
Epoch 15/50
50/50 - 0s - 3ms/step - loss: 0.1086 - val_loss: 0.7493
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 2.4500
Per-joint RMSE: 3.2830 3.7370 1.5774 0.9008 0.9710 2.6513
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:52:54.216728: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:52:54.240627: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:52:55.087060: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:55.091725: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:55.092511: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:55.094168: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:55.094958: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:55.095696: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:55.176433: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:55.177459: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:55.178264: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:55.178988: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:52:55.482366: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=6.054321e+00  RMSE=2.460553e+00
  per-joint RMSE: 3.3016 3.6768 1.6347 0.9432 1.0311 2.6984
Residual LSTM:  MSE=6.002499e+00      RMSE=2.450000e+00
  per-joint RMSE: 3.2830 3.7370 1.5774 0.9008 0.9710 2.6513
Combined torque MSE=6.002499e+00     RMSE=2.450000e+00
  per-joint RMSE: 3.2830 3.7370 1.5774 0.9008 0.9710 2.6513
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200.npz --H 50 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200.json
H=50, n_dof=6, feature_dim=24
X_train: (15465, 50, 24)  Y_train: (15465, 6)
X_test : (4657, 50, 24)  Y_test : (4657, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:52:57.486649: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:52:57.511240: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (15465, 50, 24), Y_train = (15465, 6)
  X_test  = (4657, 50, 24),  Y_test  = (4657, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:52:58.565569: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:58.570066: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:58.570849: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:58.572596: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:58.573679: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:58.574419: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:58.656131: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:58.657043: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:58.657794: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:52:58.658525: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:52:59.630795: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
49/49 - 2s - 32ms/step - loss: 0.3259 - val_loss: 0.8368
Epoch 2/50
49/49 - 0s - 5ms/step - loss: 0.1871 - val_loss: 0.7954
Epoch 3/50
49/49 - 0s - 5ms/step - loss: 0.1603 - val_loss: 0.7530
Epoch 4/50
49/49 - 0s - 5ms/step - loss: 0.1500 - val_loss: 0.7468
Epoch 5/50
49/49 - 0s - 5ms/step - loss: 0.1445 - val_loss: 0.7300
Epoch 6/50
49/49 - 0s - 5ms/step - loss: 0.1360 - val_loss: 0.7279
Epoch 7/50
49/49 - 0s - 4ms/step - loss: 0.1327 - val_loss: 0.7236
Epoch 8/50
49/49 - 0s - 4ms/step - loss: 0.1290 - val_loss: 0.7319
Epoch 9/50
49/49 - 0s - 4ms/step - loss: 0.1240 - val_loss: 0.7336
Epoch 10/50
49/49 - 0s - 4ms/step - loss: 0.1213 - val_loss: 0.7262
Epoch 11/50
49/49 - 0s - 4ms/step - loss: 0.1191 - val_loss: 0.7384
Epoch 12/50
49/49 - 0s - 4ms/step - loss: 0.1166 - val_loss: 0.7381
Epoch 13/50
49/49 - 0s - 4ms/step - loss: 0.1155 - val_loss: 0.7436
Epoch 14/50
49/49 - 0s - 4ms/step - loss: 0.1144 - val_loss: 0.7484
Epoch 15/50
49/49 - 0s - 4ms/step - loss: 0.1115 - val_loss: 0.7487
Epoch 16/50
49/49 - 0s - 4ms/step - loss: 0.1098 - val_loss: 0.7507
Epoch 17/50
49/49 - 0s - 4ms/step - loss: 0.1086 - val_loss: 0.7476
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 2.4092
Per-joint RMSE: 3.2456 3.6335 1.5471 0.8704 0.9860 2.6394
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:53:04.914747: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:53:04.940158: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 05:53:05.798309: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:05.802925: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:05.803798: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:05.805479: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:05.806267: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:05.807000: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:05.885084: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:05.885924: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:05.886675: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:05.887396: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:53:06.196339: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.874880e+00  RMSE=2.423815e+00
  per-joint RMSE: 3.2493 3.6191 1.6055 0.9276 1.0264 2.6649
Residual LSTM:  MSE=5.804424e+00      RMSE=2.409237e+00
  per-joint RMSE: 3.2456 3.6335 1.5471 0.8704 0.9860 2.6394
Combined torque MSE=5.804424e+00     RMSE=2.409237e+00
  per-joint RMSE: 3.2456 3.6335 1.5471 0.8704 0.9860 2.6394
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200.npz --H 50 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200.json
H=50, n_dof=6, feature_dim=6
X_train: (15465, 50, 6)  Y_train: (15465, 6)
X_test : (4657, 50, 6)  Y_test : (4657, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:53:08.149978: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:53:08.174424: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (15465, 50, 6), Y_train = (15465, 6)
  X_test  = (4657, 50, 6),  Y_test  = (4657, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:53:09.137444: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:09.142255: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:09.143062: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:09.144675: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:09.145473: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:09.146235: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:09.225063: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:09.226132: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:09.227581: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:09.228233: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:53:10.121692: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
49/49 - 2s - 32ms/step - loss: 0.4894 - val_loss: 1.6135
Epoch 2/50
49/49 - 0s - 5ms/step - loss: 0.2656 - val_loss: 1.5915
Epoch 3/50
49/49 - 0s - 4ms/step - loss: 0.2207 - val_loss: 1.4543
Epoch 4/50
49/49 - 0s - 4ms/step - loss: 0.2001 - val_loss: 1.3714
Epoch 5/50
49/49 - 0s - 4ms/step - loss: 0.1720 - val_loss: 1.3491
Epoch 6/50
49/49 - 0s - 4ms/step - loss: 0.1595 - val_loss: 1.3221
Epoch 7/50
49/49 - 0s - 4ms/step - loss: 0.1507 - val_loss: 1.3176
Epoch 8/50
49/49 - 0s - 4ms/step - loss: 0.1470 - val_loss: 1.3083
Epoch 9/50
49/49 - 0s - 4ms/step - loss: 0.1418 - val_loss: 1.2990
Epoch 10/50
49/49 - 0s - 4ms/step - loss: 0.1380 - val_loss: 1.3137
Epoch 11/50
49/49 - 0s - 4ms/step - loss: 0.1384 - val_loss: 1.2905
Epoch 12/50
49/49 - 0s - 4ms/step - loss: 0.1353 - val_loss: 1.3102
Epoch 13/50
49/49 - 0s - 4ms/step - loss: 0.1314 - val_loss: 1.3346
Epoch 14/50
49/49 - 0s - 4ms/step - loss: 0.1299 - val_loss: 1.2369
Epoch 15/50
49/49 - 0s - 4ms/step - loss: 0.1260 - val_loss: 1.2986
Epoch 16/50
49/49 - 0s - 4ms/step - loss: 0.1253 - val_loss: 1.2339
Epoch 17/50
49/49 - 0s - 4ms/step - loss: 0.1237 - val_loss: 1.2989
Epoch 18/50
49/49 - 0s - 4ms/step - loss: 0.1215 - val_loss: 1.2648
Epoch 19/50
49/49 - 0s - 4ms/step - loss: 0.1202 - val_loss: 1.2477
Epoch 20/50
49/49 - 0s - 5ms/step - loss: 0.1180 - val_loss: 1.2598
Epoch 21/50
49/49 - 0s - 4ms/step - loss: 0.1189 - val_loss: 1.2242
Epoch 22/50
49/49 - 0s - 4ms/step - loss: 0.1180 - val_loss: 1.2391
Epoch 23/50
49/49 - 0s - 4ms/step - loss: 0.1171 - val_loss: 1.2204
Epoch 24/50
49/49 - 0s - 4ms/step - loss: 0.1154 - val_loss: 1.2551
Epoch 25/50
49/49 - 0s - 4ms/step - loss: 0.1165 - val_loss: 1.1891
Epoch 26/50
49/49 - 0s - 4ms/step - loss: 0.1163 - val_loss: 1.2067
Epoch 27/50
49/49 - 0s - 4ms/step - loss: 0.1140 - val_loss: 1.1765
Epoch 28/50
49/49 - 0s - 4ms/step - loss: 0.1126 - val_loss: 1.1878
Epoch 29/50
49/49 - 0s - 4ms/step - loss: 0.1139 - val_loss: 1.1669
Epoch 30/50
49/49 - 0s - 4ms/step - loss: 0.1107 - val_loss: 1.1864
Epoch 31/50
49/49 - 0s - 4ms/step - loss: 0.1092 - val_loss: 1.1673
Epoch 32/50
49/49 - 0s - 4ms/step - loss: 0.1100 - val_loss: 1.2147
Epoch 33/50
49/49 - 0s - 4ms/step - loss: 0.1117 - val_loss: 1.1844
Epoch 34/50
49/49 - 0s - 4ms/step - loss: 0.1077 - val_loss: 1.1858
Epoch 35/50
49/49 - 0s - 4ms/step - loss: 0.1080 - val_loss: 1.2048
Epoch 36/50
49/49 - 0s - 4ms/step - loss: 0.1106 - val_loss: 1.1804
Epoch 37/50
49/49 - 0s - 4ms/step - loss: 0.1084 - val_loss: 1.1720
Epoch 38/50
49/49 - 0s - 4ms/step - loss: 0.1060 - val_loss: 1.1930
Epoch 39/50
49/49 - 0s - 4ms/step - loss: 0.1062 - val_loss: 1.1471
Epoch 40/50
49/49 - 0s - 4ms/step - loss: 0.1060 - val_loss: 1.1655
Epoch 41/50
49/49 - 0s - 4ms/step - loss: 0.1033 - val_loss: 1.1687
Epoch 42/50
49/49 - 0s - 4ms/step - loss: 0.1031 - val_loss: 1.1474
Epoch 43/50
49/49 - 0s - 4ms/step - loss: 0.1039 - val_loss: 1.1775
Epoch 44/50
49/49 - 0s - 4ms/step - loss: 0.1024 - val_loss: 1.1930
Epoch 45/50
49/49 - 0s - 4ms/step - loss: 0.1021 - val_loss: 1.2109
Epoch 46/50
49/49 - 0s - 4ms/step - loss: 0.1013 - val_loss: 1.1906
Epoch 47/50
49/49 - 0s - 4ms/step - loss: 0.1019 - val_loss: 1.1799
Epoch 48/50
49/49 - 0s - 4ms/step - loss: 0.1010 - val_loss: 1.2036
Epoch 49/50
49/49 - 0s - 4ms/step - loss: 0.1016 - val_loss: 1.1647
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 2.4200
Per-joint RMSE: 3.3677 3.5790 1.4512 0.9040 0.9847 2.6634
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:53:21.944161: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:53:21.968545: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 05:53:22.815965: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:22.820588: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:22.821375: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:22.823087: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:22.823878: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:22.824610: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:22.907539: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:22.908380: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:22.909124: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:22.909859: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8811 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:53:23.208844: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.874880e+00  RMSE=2.423815e+00
  per-joint RMSE: 3.2493 3.6191 1.6055 0.9276 1.0264 2.6649
Residual LSTM:  MSE=5.856217e+00      RMSE=2.419962e+00
  per-joint RMSE: 3.3677 3.5790 1.4512 0.9040 0.9847 2.6634
Combined torque MSE=5.856217e+00     RMSE=2.419962e+00
  per-joint RMSE: 3.3677 3.5790 1.4512 0.9040 0.9847 2.6634
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200.npz --H 50 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200.json
H=50, n_dof=6, feature_dim=18
X_train: (15465, 50, 18)  Y_train: (15465, 6)
X_test : (4657, 50, 18)  Y_test : (4657, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:53:25.200383: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:53:25.224020: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (15465, 50, 18), Y_train = (15465, 6)
  X_test  = (4657, 50, 18),  Y_test  = (4657, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:53:26.250760: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:26.255483: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:26.256361: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:26.257934: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:26.258782: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:26.259567: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:26.335611: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:26.336456: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:26.337293: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:26.338023: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8809 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:53:27.289392: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
49/49 - 2s - 32ms/step - loss: 0.3454 - val_loss: 0.8278
Epoch 2/50
49/49 - 0s - 4ms/step - loss: 0.2217 - val_loss: 0.8364
Epoch 3/50
49/49 - 0s - 4ms/step - loss: 0.1982 - val_loss: 0.8571
Epoch 4/50
49/49 - 0s - 4ms/step - loss: 0.1843 - val_loss: 0.8695
Epoch 5/50
49/49 - 0s - 4ms/step - loss: 0.1681 - val_loss: 0.8520
Epoch 6/50
49/49 - 0s - 4ms/step - loss: 0.1596 - val_loss: 0.8780
Epoch 7/50
49/49 - 0s - 4ms/step - loss: 0.1554 - val_loss: 0.8756
Epoch 8/50
49/49 - 0s - 4ms/step - loss: 0.1456 - val_loss: 0.8857
Epoch 9/50
49/49 - 0s - 4ms/step - loss: 0.1409 - val_loss: 0.9040
Epoch 10/50
49/49 - 0s - 4ms/step - loss: 0.1347 - val_loss: 0.9138
Epoch 11/50
49/49 - 0s - 4ms/step - loss: 0.1342 - val_loss: 0.9149
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 2.4074
Per-joint RMSE: 3.2577 3.5808 1.5419 0.9003 1.0230 2.6653
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:53:31.262902: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:53:31.287440: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:53:32.136441: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:32.141049: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:32.141921: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:32.143777: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:32.144574: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:32.145316: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:32.230987: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:32.231906: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:32.232650: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:32.233383: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:53:32.538610: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.874880e+00  RMSE=2.423815e+00
  per-joint RMSE: 3.2493 3.6191 1.6055 0.9276 1.0264 2.6649
Residual LSTM:  MSE=5.795459e+00      RMSE=2.407376e+00
  per-joint RMSE: 3.2577 3.5808 1.5419 0.9003 1.0230 2.6653
Combined torque MSE=5.795459e+00     RMSE=2.407376e+00
  per-joint RMSE: 3.2577 3.5808 1.5419 0.9003 1.0230 2.6653
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200.npz --H 50 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200.json
H=50, n_dof=6, feature_dim=18
X_train: (15465, 50, 18)  Y_train: (15465, 6)
X_test : (4657, 50, 18)  Y_test : (4657, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:53:34.519217: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:53:34.543203: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (15465, 50, 18), Y_train = (15465, 6)
  X_test  = (4657, 50, 18),  Y_test  = (4657, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:53:35.566605: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:35.571134: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:35.571923: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:35.573505: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:35.574294: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:35.575030: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:35.647868: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:35.648702: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:35.649438: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:35.650164: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:53:36.579197: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
49/49 - 2s - 32ms/step - loss: 0.3286 - val_loss: 0.8468
Epoch 2/50
49/49 - 0s - 5ms/step - loss: 0.1913 - val_loss: 0.8440
Epoch 3/50
49/49 - 0s - 4ms/step - loss: 0.1631 - val_loss: 0.8003
Epoch 4/50
49/49 - 0s - 4ms/step - loss: 0.1473 - val_loss: 0.7930
Epoch 5/50
49/49 - 0s - 4ms/step - loss: 0.1391 - val_loss: 0.7776
Epoch 6/50
49/49 - 0s - 4ms/step - loss: 0.1327 - val_loss: 0.7791
Epoch 7/50
49/49 - 0s - 4ms/step - loss: 0.1288 - val_loss: 0.7808
Epoch 8/50
49/49 - 0s - 4ms/step - loss: 0.1263 - val_loss: 0.7742
Epoch 9/50
49/49 - 0s - 4ms/step - loss: 0.1223 - val_loss: 0.7708
Epoch 10/50
49/49 - 0s - 4ms/step - loss: 0.1198 - val_loss: 0.7786
Epoch 11/50
49/49 - 0s - 4ms/step - loss: 0.1181 - val_loss: 0.7591
Epoch 12/50
49/49 - 0s - 4ms/step - loss: 0.1162 - val_loss: 0.7680
Epoch 13/50
49/49 - 0s - 4ms/step - loss: 0.1143 - val_loss: 0.7599
Epoch 14/50
49/49 - 0s - 4ms/step - loss: 0.1124 - val_loss: 0.7692
Epoch 15/50
49/49 - 0s - 4ms/step - loss: 0.1104 - val_loss: 0.7671
Epoch 16/50
49/49 - 0s - 4ms/step - loss: 0.1091 - val_loss: 0.7584
Epoch 17/50
49/49 - 0s - 4ms/step - loss: 0.1083 - val_loss: 0.7675
Epoch 18/50
49/49 - 0s - 4ms/step - loss: 0.1064 - val_loss: 0.7719
Epoch 19/50
49/49 - 0s - 4ms/step - loss: 0.1047 - val_loss: 0.7727
Epoch 20/50
49/49 - 0s - 5ms/step - loss: 0.1045 - val_loss: 0.7840
Epoch 21/50
49/49 - 0s - 4ms/step - loss: 0.1031 - val_loss: 0.7733
Epoch 22/50
49/49 - 0s - 4ms/step - loss: 0.1023 - val_loss: 0.7743
Epoch 23/50
49/49 - 0s - 4ms/step - loss: 0.1018 - val_loss: 0.7787
Epoch 24/50
49/49 - 0s - 4ms/step - loss: 0.1010 - val_loss: 0.7794
Epoch 25/50
49/49 - 0s - 4ms/step - loss: 0.1016 - val_loss: 0.7675
Epoch 26/50
49/49 - 0s - 4ms/step - loss: 0.0984 - val_loss: 0.7864
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 2.4054
Per-joint RMSE: 3.1460 3.7221 1.5994 0.8227 1.0073 2.5912
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:53:43.734533: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:53:43.760699: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s0_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:53:44.591573: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:44.596238: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:44.597107: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:44.598855: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:44.599642: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:44.600382: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:44.681766: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:44.682606: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:44.683481: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:53:44.684214: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8811 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:53:44.985928: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.874880e+00  RMSE=2.423815e+00
  per-joint RMSE: 3.2493 3.6191 1.6055 0.9276 1.0264 2.6649
Residual LSTM:  MSE=5.785813e+00      RMSE=2.405372e+00
  per-joint RMSE: 3.1460 3.7221 1.5994 0.8227 1.0073 2.5912
Combined torque MSE=5.785813e+00     RMSE=2.405372e+00
  per-joint RMSE: 3.1460 3.7221 1.5994 0.8227 1.0073 2.5912
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=1                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz                                 ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p3_seed1_dataset.npz -t structured -s 1 -r 0 --hp_preset fast_debug --epochs 200 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200.jax' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 200, 'lagrangian_type': <function structured_lagrangian_fn at 0x7dd040b081f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K50_tf0p3_seed1_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p3_seed1_dataset.npz
   dt ≈ 0.031724498445888843
  dof = 6
  Train trajectories = 35
  Test trajectories  = 15
  Train samples = 16260
  Test samples  = 5024
################################################

2026-01-22 05:53:49.245793: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200 | type=structured | dof=6
################################################
2026-01-22 05:53:52.355709: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:53:52.355744: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:53:52.355750: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:53:52.355777: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:53:52.355782: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:53:52.355796: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:53:52.355837: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:53:52.355845: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:53:52.355865: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:53:52.355872: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.0s, Loss=2.20e+01, Inv=2.20e+01, For=2.52e+02, Power=1.54e+00
  [eval] test_mse=4.565e+00  (n=5024)
Epoch 00050: Time=   8.7s, Loss=2.88e+00, Inv=2.88e+00, For=6.24e+01, Power=1.11e+00
Epoch 00100: Time=  10.9s, Loss=2.43e+00, Inv=2.43e+00, For=8.34e+01, Power=1.05e+00
Epoch 00150: Time=  13.2s, Loss=2.22e+00, Inv=2.22e+00, For=1.34e+02, Power=1.03e+00
Epoch 00200: Time=  15.3s, Loss=2.08e+00, Inv=2.08e+00, For=2.05e+02, Power=1.02e+00
  [eval] test_mse=3.283e+01  (n=5024)
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200
Torque MSE  = 5.472e+00
Torque RMSE = 2.339e+00
Per-joint MSE : 2.251e+00 1.226e+01 3.319e+00 1.030e+01 1.010e+00 3.695e+00
Per-joint RMSE: 1.500e+00 3.502e+00 1.822e+00 3.209e+00 1.005e+00 1.922e+00
Comp Time per Sample = 5.237e-08s / 19096126.4Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p3_seed1_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p3_seed1_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200.jax
Detected n_dof=6 (seed=1)
2026-01-22 05:54:09.756303: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 35 trajectories
2026-01-22 05:54:11.060937: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:54:11.060951: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:54:12.508931: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:54:12.508943: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:54:14.043749: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/35
2026-01-22 05:54:15.198328: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:54:15.198362: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:54:15.198369: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 35/35

Exporting split=test: 15 trajectories
  done 15/15

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200.npz --H 25 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200.json
H=25, n_dof=6, feature_dim=24
X_train: (15840, 25, 24)  Y_train: (15840, 6)
X_test : (4832, 25, 24)  Y_test : (4832, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:54:17.585055: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:54:17.608737: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (15840, 25, 24), Y_train = (15840, 6)
  X_test  = (4832, 25, 24),  Y_test  = (4832, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:54:18.619064: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:18.623649: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:18.624586: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:18.626241: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:18.627081: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:18.627881: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:18.709172: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:18.710149: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:18.710945: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:18.711732: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8816 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:54:19.632181: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
50/50 - 2s - 30ms/step - loss: 0.3283 - val_loss: 0.8418
Epoch 2/50
50/50 - 0s - 3ms/step - loss: 0.1830 - val_loss: 0.8390
Epoch 3/50
50/50 - 0s - 3ms/step - loss: 0.1577 - val_loss: 0.7971
Epoch 4/50
50/50 - 0s - 3ms/step - loss: 0.1467 - val_loss: 0.7626
Epoch 5/50
50/50 - 0s - 3ms/step - loss: 0.1387 - val_loss: 0.7672
Epoch 6/50
50/50 - 0s - 3ms/step - loss: 0.1330 - val_loss: 0.7721
Epoch 7/50
50/50 - 0s - 3ms/step - loss: 0.1285 - val_loss: 0.7895
Epoch 8/50
50/50 - 0s - 3ms/step - loss: 0.1234 - val_loss: 0.7998
Epoch 9/50
50/50 - 0s - 3ms/step - loss: 0.1213 - val_loss: 0.7888
Epoch 10/50
50/50 - 0s - 6ms/step - loss: 0.1186 - val_loss: 0.8088
Epoch 11/50
50/50 - 0s - 3ms/step - loss: 0.1151 - val_loss: 0.8019
Epoch 12/50
50/50 - 0s - 3ms/step - loss: 0.1135 - val_loss: 0.7877
Epoch 13/50
50/50 - 0s - 3ms/step - loss: 0.1140 - val_loss: 0.7895
Epoch 14/50
50/50 - 0s - 3ms/step - loss: 0.1107 - val_loss: 0.7938
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 2.2997
Per-joint RMSE: 1.4462 3.4015 1.7877 3.1912 0.9703 1.9360
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:54:23.500775: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:54:23.526545: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 05:54:24.375798: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:24.380409: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:24.381204: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:24.382956: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:24.383838: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:24.384586: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:24.459906: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:24.460826: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:24.461577: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:24.462374: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8809 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:54:24.764195: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.509686e+00  RMSE=2.347272e+00
  per-joint RMSE: 1.5139 3.4917 1.8159 3.2315 1.0210 1.9473
Residual LSTM:  MSE=5.288445e+00      RMSE=2.299662e+00
  per-joint RMSE: 1.4462 3.4015 1.7877 3.1912 0.9703 1.9360
Combined torque MSE=5.288445e+00     RMSE=2.299662e+00
  per-joint RMSE: 1.4462 3.4015 1.7877 3.1912 0.9703 1.9360
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200.npz --H 25 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200.json
H=25, n_dof=6, feature_dim=6
X_train: (15840, 25, 6)  Y_train: (15840, 6)
X_test : (4832, 25, 6)  Y_test : (4832, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:54:26.704818: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:54:26.728344: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (15840, 25, 6), Y_train = (15840, 6)
  X_test  = (4832, 25, 6),  Y_test  = (4832, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:54:27.672468: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:27.676979: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:27.677783: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:27.679316: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:27.680105: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:27.680928: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:27.754943: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:27.755778: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:27.756528: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:27.757248: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:54:28.638793: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
50/50 - 1s - 30ms/step - loss: 0.5705 - val_loss: 1.5982
Epoch 2/50
50/50 - 0s - 3ms/step - loss: 0.3542 - val_loss: 1.7327
Epoch 3/50
50/50 - 0s - 3ms/step - loss: 0.2682 - val_loss: 1.6296
Epoch 4/50
50/50 - 0s - 3ms/step - loss: 0.2258 - val_loss: 1.5183
Epoch 5/50
50/50 - 0s - 3ms/step - loss: 0.2052 - val_loss: 1.5331
Epoch 6/50
50/50 - 0s - 3ms/step - loss: 0.1694 - val_loss: 1.6226
Epoch 7/50
50/50 - 0s - 3ms/step - loss: 0.1567 - val_loss: 1.5813
Epoch 8/50
50/50 - 0s - 3ms/step - loss: 0.1477 - val_loss: 1.6098
Epoch 9/50
50/50 - 0s - 3ms/step - loss: 0.1422 - val_loss: 1.6198
Epoch 10/50
50/50 - 0s - 3ms/step - loss: 0.1392 - val_loss: 1.6182
Epoch 11/50
50/50 - 0s - 3ms/step - loss: 0.1353 - val_loss: 1.5738
Epoch 12/50
50/50 - 0s - 3ms/step - loss: 0.1354 - val_loss: 1.5763
Epoch 13/50
50/50 - 0s - 3ms/step - loss: 0.1320 - val_loss: 1.5727
Epoch 14/50
50/50 - 0s - 3ms/step - loss: 0.1338 - val_loss: 1.5281
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 2.3223
Per-joint RMSE: 1.4617 3.5138 1.8587 3.1373 0.9997 1.8914
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:54:32.312582: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:54:32.336990: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 05:54:33.185898: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:33.190514: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:33.191386: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:33.193150: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:33.193935: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:33.194675: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:33.275672: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:33.276500: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:33.277236: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:33.277960: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:54:33.575835: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.509686e+00  RMSE=2.347272e+00
  per-joint RMSE: 1.5139 3.4917 1.8159 3.2315 1.0210 1.9473
Residual LSTM:  MSE=5.392876e+00      RMSE=2.322257e+00
  per-joint RMSE: 1.4617 3.5138 1.8587 3.1373 0.9997 1.8914
Combined torque MSE=5.392876e+00     RMSE=2.322257e+00
  per-joint RMSE: 1.4617 3.5138 1.8587 3.1373 0.9997 1.8914
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200.npz --H 25 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200.json
H=25, n_dof=6, feature_dim=18
X_train: (15840, 25, 18)  Y_train: (15840, 6)
X_test : (4832, 25, 18)  Y_test : (4832, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:54:35.538986: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:54:35.562758: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (15840, 25, 18), Y_train = (15840, 6)
  X_test  = (4832, 25, 18),  Y_test  = (4832, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:54:36.540135: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:36.544750: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:36.545535: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:36.547107: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:36.547892: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:36.548630: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:36.624624: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:36.625457: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:36.626205: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:36.626937: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:54:37.557610: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
50/50 - 2s - 30ms/step - loss: 0.3425 - val_loss: 0.8344
Epoch 2/50
50/50 - 0s - 3ms/step - loss: 0.2231 - val_loss: 0.8735
Epoch 3/50
50/50 - 0s - 3ms/step - loss: 0.1986 - val_loss: 0.8684
Epoch 4/50
50/50 - 0s - 3ms/step - loss: 0.1784 - val_loss: 0.9155
Epoch 5/50
50/50 - 0s - 3ms/step - loss: 0.1635 - val_loss: 0.8994
Epoch 6/50
50/50 - 0s - 3ms/step - loss: 0.1502 - val_loss: 0.9043
Epoch 7/50
50/50 - 0s - 3ms/step - loss: 0.1432 - val_loss: 0.9385
Epoch 8/50
50/50 - 0s - 3ms/step - loss: 0.1392 - val_loss: 0.9338
Epoch 9/50
50/50 - 0s - 3ms/step - loss: 0.1341 - val_loss: 0.9569
Epoch 10/50
50/50 - 0s - 3ms/step - loss: 0.1299 - val_loss: 0.9598
Epoch 11/50
50/50 - 0s - 3ms/step - loss: 0.1254 - val_loss: 0.9714
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 2.3219
Per-joint RMSE: 1.5029 3.4437 1.7657 3.2063 1.0377 1.9374
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:54:40.796445: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:54:40.820906: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:54:41.674865: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:41.679493: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:41.680280: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:41.681907: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:41.682914: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:41.683652: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:41.766678: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:41.767507: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:41.768320: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:41.769125: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:54:42.065849: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.509686e+00  RMSE=2.347272e+00
  per-joint RMSE: 1.5139 3.4917 1.8159 3.2315 1.0210 1.9473
Residual LSTM:  MSE=5.391022e+00      RMSE=2.321857e+00
  per-joint RMSE: 1.5029 3.4437 1.7657 3.2063 1.0377 1.9374
Combined torque MSE=5.391022e+00     RMSE=2.321857e+00
  per-joint RMSE: 1.5029 3.4437 1.7657 3.2063 1.0377 1.9374
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200.npz --H 25 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200.json
H=25, n_dof=6, feature_dim=18
X_train: (15840, 25, 18)  Y_train: (15840, 6)
X_test : (4832, 25, 18)  Y_test : (4832, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:54:44.014162: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:54:44.038147: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (15840, 25, 18), Y_train = (15840, 6)
  X_test  = (4832, 25, 18),  Y_test  = (4832, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:54:45.016084: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:45.020657: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:45.021521: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:45.023161: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:45.023948: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:45.024674: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:45.102788: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:45.103765: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:45.104557: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:45.105283: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:54:45.998495: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
50/50 - 1s - 30ms/step - loss: 0.3248 - val_loss: 0.7767
Epoch 2/50
50/50 - 0s - 3ms/step - loss: 0.1957 - val_loss: 0.7706
Epoch 3/50
50/50 - 0s - 3ms/step - loss: 0.1630 - val_loss: 0.7662
Epoch 4/50
50/50 - 0s - 3ms/step - loss: 0.1469 - val_loss: 0.7595
Epoch 5/50
50/50 - 0s - 3ms/step - loss: 0.1388 - val_loss: 0.7412
Epoch 6/50
50/50 - 0s - 3ms/step - loss: 0.1313 - val_loss: 0.7348
Epoch 7/50
50/50 - 0s - 3ms/step - loss: 0.1268 - val_loss: 0.7290
Epoch 8/50
50/50 - 0s - 3ms/step - loss: 0.1220 - val_loss: 0.7378
Epoch 9/50
50/50 - 0s - 3ms/step - loss: 0.1195 - val_loss: 0.7292
Epoch 10/50
50/50 - 0s - 3ms/step - loss: 0.1159 - val_loss: 0.7314
Epoch 11/50
50/50 - 0s - 3ms/step - loss: 0.1142 - val_loss: 0.7283
Epoch 12/50
50/50 - 0s - 3ms/step - loss: 0.1121 - val_loss: 0.7323
Epoch 13/50
50/50 - 0s - 3ms/step - loss: 0.1095 - val_loss: 0.7301
Epoch 14/50
50/50 - 0s - 3ms/step - loss: 0.1087 - val_loss: 0.7356
Epoch 15/50
50/50 - 0s - 3ms/step - loss: 0.1055 - val_loss: 0.7403
Epoch 16/50
50/50 - 0s - 3ms/step - loss: 0.1055 - val_loss: 0.7453
Epoch 17/50
50/50 - 0s - 3ms/step - loss: 0.1020 - val_loss: 0.7465
Epoch 18/50
50/50 - 0s - 3ms/step - loss: 0.1016 - val_loss: 0.7529
Epoch 19/50
50/50 - 0s - 4ms/step - loss: 0.1013 - val_loss: 0.7614
Epoch 20/50
50/50 - 0s - 3ms/step - loss: 0.0991 - val_loss: 0.7588
Epoch 21/50
50/50 - 0s - 3ms/step - loss: 0.0995 - val_loss: 0.7688
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 2.3057
Per-joint RMSE: 1.4548 3.4367 1.8051 3.1714 0.9634 1.9304
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:54:50.831759: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:54:50.856000: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:54:51.692191: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:51.696784: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:51.697581: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:51.699272: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:51.700141: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:51.700891: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:51.778568: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:51.779410: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:51.780156: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:51.780889: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:54:52.080191: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.509686e+00  RMSE=2.347272e+00
  per-joint RMSE: 1.5139 3.4917 1.8159 3.2315 1.0210 1.9473
Residual LSTM:  MSE=5.316366e+00      RMSE=2.305725e+00
  per-joint RMSE: 1.4548 3.4367 1.8051 3.1714 0.9634 1.9304
Combined torque MSE=5.316366e+00     RMSE=2.305725e+00
  per-joint RMSE: 1.4548 3.4367 1.8051 3.1714 0.9634 1.9304
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200.npz --H 50 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200.json
H=50, n_dof=6, feature_dim=24
X_train: (15465, 50, 24)  Y_train: (15465, 6)
X_test : (4657, 50, 24)  Y_test : (4657, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:54:54.060129: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:54:54.084532: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (15465, 50, 24), Y_train = (15465, 6)
  X_test  = (4657, 50, 24),  Y_test  = (4657, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:54:55.152386: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:55.156988: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:55.157865: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:55.159541: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:55.160332: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:55.161148: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:55.240495: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:55.241420: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:55.242297: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:54:55.243019: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:54:56.206066: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
49/49 - 2s - 32ms/step - loss: 0.3266 - val_loss: 0.7885
Epoch 2/50
49/49 - 0s - 5ms/step - loss: 0.1853 - val_loss: 0.7767
Epoch 3/50
49/49 - 0s - 4ms/step - loss: 0.1588 - val_loss: 0.7709
Epoch 4/50
49/49 - 0s - 4ms/step - loss: 0.1465 - val_loss: 0.7727
Epoch 5/50
49/49 - 0s - 4ms/step - loss: 0.1398 - val_loss: 0.7745
Epoch 6/50
49/49 - 0s - 4ms/step - loss: 0.1337 - val_loss: 0.7783
Epoch 7/50
49/49 - 0s - 4ms/step - loss: 0.1292 - val_loss: 0.7894
Epoch 8/50
49/49 - 0s - 4ms/step - loss: 0.1264 - val_loss: 0.8019
Epoch 9/50
49/49 - 0s - 4ms/step - loss: 0.1223 - val_loss: 0.8028
Epoch 10/50
49/49 - 0s - 4ms/step - loss: 0.1202 - val_loss: 0.8184
Epoch 11/50
49/49 - 0s - 4ms/step - loss: 0.1177 - val_loss: 0.8220
Epoch 12/50
49/49 - 0s - 4ms/step - loss: 0.1156 - val_loss: 0.8237
Epoch 13/50
49/49 - 0s - 4ms/step - loss: 0.1135 - val_loss: 0.8217
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 2.3002
Per-joint RMSE: 1.5278 3.3696 1.7893 3.1894 0.9504 1.9440
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:55:00.690143: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:55:00.714330: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 05:55:01.575806: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:01.580355: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:01.581229: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:01.582982: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:01.583769: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:01.584500: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:01.664737: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:01.665647: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:01.666390: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:01.667210: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:55:01.969995: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.393660e+00  RMSE=2.322425e+00
  per-joint RMSE: 1.5076 3.4556 1.7994 3.1986 0.9973 1.9195
Residual LSTM:  MSE=5.290739e+00      RMSE=2.300161e+00
  per-joint RMSE: 1.5278 3.3696 1.7893 3.1894 0.9504 1.9440
Combined torque MSE=5.290739e+00     RMSE=2.300161e+00
  per-joint RMSE: 1.5278 3.3696 1.7893 3.1894 0.9504 1.9440
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200.npz --H 50 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200.json
H=50, n_dof=6, feature_dim=6
X_train: (15465, 50, 6)  Y_train: (15465, 6)
X_test : (4657, 50, 6)  Y_test : (4657, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:55:03.888855: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:55:03.912478: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (15465, 50, 6), Y_train = (15465, 6)
  X_test  = (4657, 50, 6),  Y_test  = (4657, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:55:04.885362: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:04.889828: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:04.890709: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:04.892260: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:04.893043: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:04.893790: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:04.967029: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:04.967874: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:04.968624: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:04.969365: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:55:05.849842: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
49/49 - 2s - 32ms/step - loss: 0.5031 - val_loss: 1.5714
Epoch 2/50
49/49 - 0s - 5ms/step - loss: 0.2803 - val_loss: 1.3312
Epoch 3/50
49/49 - 0s - 4ms/step - loss: 0.2220 - val_loss: 1.3007
Epoch 4/50
49/49 - 0s - 4ms/step - loss: 0.1920 - val_loss: 1.3151
Epoch 5/50
49/49 - 0s - 4ms/step - loss: 0.1679 - val_loss: 1.2905
Epoch 6/50
49/49 - 0s - 4ms/step - loss: 0.1551 - val_loss: 1.2685
Epoch 7/50
49/49 - 0s - 4ms/step - loss: 0.1494 - val_loss: 1.3080
Epoch 8/50
49/49 - 0s - 4ms/step - loss: 0.1430 - val_loss: 1.2629
Epoch 9/50
49/49 - 0s - 4ms/step - loss: 0.1407 - val_loss: 1.2876
Epoch 10/50
49/49 - 0s - 4ms/step - loss: 0.1384 - val_loss: 1.3002
Epoch 11/50
49/49 - 0s - 4ms/step - loss: 0.1339 - val_loss: 1.2945
Epoch 12/50
49/49 - 0s - 4ms/step - loss: 0.1360 - val_loss: 1.2743
Epoch 13/50
49/49 - 0s - 4ms/step - loss: 0.1308 - val_loss: 1.3022
Epoch 14/50
49/49 - 0s - 4ms/step - loss: 0.1273 - val_loss: 1.2970
Epoch 15/50
49/49 - 0s - 4ms/step - loss: 0.1268 - val_loss: 1.2606
Epoch 16/50
49/49 - 0s - 4ms/step - loss: 0.1237 - val_loss: 1.3298
Epoch 17/50
49/49 - 0s - 4ms/step - loss: 0.1264 - val_loss: 1.2968
Epoch 18/50
49/49 - 0s - 4ms/step - loss: 0.1362 - val_loss: 1.3361
Epoch 19/50
49/49 - 0s - 4ms/step - loss: 0.1252 - val_loss: 1.3161
Epoch 20/50
49/49 - 0s - 5ms/step - loss: 0.1213 - val_loss: 1.3010
Epoch 21/50
49/49 - 0s - 4ms/step - loss: 0.1191 - val_loss: 1.2869
Epoch 22/50
49/49 - 0s - 4ms/step - loss: 0.1189 - val_loss: 1.2745
Epoch 23/50
49/49 - 0s - 4ms/step - loss: 0.1190 - val_loss: 1.2729
Epoch 24/50
49/49 - 0s - 4ms/step - loss: 0.1174 - val_loss: 1.2537
Epoch 25/50
49/49 - 0s - 4ms/step - loss: 0.1171 - val_loss: 1.2981
Epoch 26/50
49/49 - 0s - 4ms/step - loss: 0.1144 - val_loss: 1.2689
Epoch 27/50
49/49 - 0s - 4ms/step - loss: 0.1125 - val_loss: 1.2566
Epoch 28/50
49/49 - 0s - 4ms/step - loss: 0.1106 - val_loss: 1.2701
Epoch 29/50
49/49 - 0s - 4ms/step - loss: 0.1108 - val_loss: 1.2461
Epoch 30/50
49/49 - 0s - 4ms/step - loss: 0.1105 - val_loss: 1.2513
Epoch 31/50
49/49 - 0s - 4ms/step - loss: 0.1125 - val_loss: 1.2955
Epoch 32/50
49/49 - 0s - 4ms/step - loss: 0.1123 - val_loss: 1.2564
Epoch 33/50
49/49 - 0s - 4ms/step - loss: 0.1082 - val_loss: 1.2550
Epoch 34/50
49/49 - 0s - 4ms/step - loss: 0.1083 - val_loss: 1.2794
Epoch 35/50
49/49 - 0s - 4ms/step - loss: 0.1080 - val_loss: 1.2649
Epoch 36/50
49/49 - 0s - 4ms/step - loss: 0.1071 - val_loss: 1.2733
Epoch 37/50
49/49 - 0s - 4ms/step - loss: 0.1063 - val_loss: 1.2373
Epoch 38/50
49/49 - 0s - 4ms/step - loss: 0.1051 - val_loss: 1.2750
Epoch 39/50
49/49 - 0s - 4ms/step - loss: 0.1047 - val_loss: 1.2583
Epoch 40/50
49/49 - 0s - 4ms/step - loss: 0.1047 - val_loss: 1.2685
Epoch 41/50
49/49 - 0s - 4ms/step - loss: 0.1039 - val_loss: 1.2711
Epoch 42/50
49/49 - 0s - 4ms/step - loss: 0.1035 - val_loss: 1.2363
Epoch 43/50
49/49 - 0s - 4ms/step - loss: 0.1038 - val_loss: 1.2560
Epoch 44/50
49/49 - 0s - 4ms/step - loss: 0.1011 - val_loss: 1.2724
Epoch 45/50
49/49 - 0s - 4ms/step - loss: 0.1021 - val_loss: 1.2515
Epoch 46/50
49/49 - 0s - 4ms/step - loss: 0.1007 - val_loss: 1.2513
Epoch 47/50
49/49 - 0s - 4ms/step - loss: 0.1012 - val_loss: 1.2591
Epoch 48/50
49/49 - 0s - 4ms/step - loss: 0.1014 - val_loss: 1.2729
Epoch 49/50
49/49 - 0s - 4ms/step - loss: 0.0998 - val_loss: 1.2367
Epoch 50/50
49/49 - 0s - 4ms/step - loss: 0.1002 - val_loss: 1.2561
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 2.3266
Per-joint RMSE: 1.5454 3.4593 1.7432 3.2295 0.9764 1.9240
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:55:17.857625: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:55:17.881699: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 05:55:18.734328: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:18.739047: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:18.739854: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:18.741640: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:18.742443: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:18.743185: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:18.818153: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:18.819077: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:18.819832: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:18.820553: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8811 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:55:19.112548: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.393660e+00  RMSE=2.322425e+00
  per-joint RMSE: 1.5076 3.4556 1.7994 3.1986 0.9973 1.9195
Residual LSTM:  MSE=5.413202e+00      RMSE=2.326629e+00
  per-joint RMSE: 1.5454 3.4593 1.7432 3.2295 0.9764 1.9240
Combined torque MSE=5.413202e+00     RMSE=2.326629e+00
  per-joint RMSE: 1.5454 3.4593 1.7432 3.2295 0.9764 1.9240
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200.npz --H 50 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200.json
H=50, n_dof=6, feature_dim=18
X_train: (15465, 50, 18)  Y_train: (15465, 6)
X_test : (4657, 50, 18)  Y_test : (4657, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:55:21.135728: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:55:21.159444: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (15465, 50, 18), Y_train = (15465, 6)
  X_test  = (4657, 50, 18),  Y_test  = (4657, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:55:22.182938: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:22.187743: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:22.188534: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:22.190072: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:22.190860: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:22.191600: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:22.271833: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:22.272671: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:22.273419: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:22.274146: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8809 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:55:23.234247: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
49/49 - 2s - 32ms/step - loss: 0.3423 - val_loss: 0.8555
Epoch 2/50
49/49 - 0s - 4ms/step - loss: 0.2252 - val_loss: 0.8711
Epoch 3/50
49/49 - 0s - 4ms/step - loss: 0.1979 - val_loss: 0.8768
Epoch 4/50
49/49 - 0s - 4ms/step - loss: 0.1743 - val_loss: 0.8762
Epoch 5/50
49/49 - 0s - 4ms/step - loss: 0.1597 - val_loss: 0.8893
Epoch 6/50
49/49 - 0s - 4ms/step - loss: 0.1499 - val_loss: 0.8965
Epoch 7/50
49/49 - 0s - 4ms/step - loss: 0.1440 - val_loss: 0.9276
Epoch 8/50
49/49 - 0s - 4ms/step - loss: 0.1403 - val_loss: 0.9166
Epoch 9/50
49/49 - 0s - 4ms/step - loss: 0.1321 - val_loss: 0.9363
Epoch 10/50
49/49 - 0s - 4ms/step - loss: 0.1288 - val_loss: 0.9408
Epoch 11/50
49/49 - 0s - 4ms/step - loss: 0.1270 - val_loss: 0.9363
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 2.2997
Per-joint RMSE: 1.4719 3.4339 1.7443 3.1778 1.0082 1.9014
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:55:27.211412: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:55:27.235572: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:55:28.092616: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:28.097264: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:28.098210: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:28.100074: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:28.100891: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:28.101622: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:28.181343: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:28.182173: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:28.183005: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:28.183732: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:55:28.488412: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.393660e+00  RMSE=2.322425e+00
  per-joint RMSE: 1.5076 3.4556 1.7994 3.1986 0.9973 1.9195
Residual LSTM:  MSE=5.288488e+00      RMSE=2.299671e+00
  per-joint RMSE: 1.4719 3.4339 1.7443 3.1778 1.0082 1.9014
Combined torque MSE=5.288488e+00     RMSE=2.299671e+00
  per-joint RMSE: 1.4719 3.4339 1.7443 3.1778 1.0082 1.9014
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200.npz --H 50 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200.json
H=50, n_dof=6, feature_dim=18
X_train: (15465, 50, 18)  Y_train: (15465, 6)
X_test : (4657, 50, 18)  Y_test : (4657, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:55:30.460731: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:55:30.484774: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (15465, 50, 18), Y_train = (15465, 6)
  X_test  = (4657, 50, 18),  Y_test  = (4657, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:55:31.524553: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:31.529662: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:31.530468: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:31.532187: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:31.532982: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:31.533813: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:31.612836: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:31.613746: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:31.614486: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:31.615217: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:55:32.550329: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
49/49 - 2s - 32ms/step - loss: 0.3277 - val_loss: 0.7421
Epoch 2/50
49/49 - 0s - 4ms/step - loss: 0.1927 - val_loss: 0.7595
Epoch 3/50
49/49 - 0s - 4ms/step - loss: 0.1622 - val_loss: 0.7801
Epoch 4/50
49/49 - 0s - 4ms/step - loss: 0.1472 - val_loss: 0.7549
Epoch 5/50
49/49 - 0s - 4ms/step - loss: 0.1388 - val_loss: 0.7549
Epoch 6/50
49/49 - 0s - 4ms/step - loss: 0.1334 - val_loss: 0.7572
Epoch 7/50
49/49 - 0s - 4ms/step - loss: 0.1283 - val_loss: 0.7677
Epoch 8/50
49/49 - 0s - 4ms/step - loss: 0.1264 - val_loss: 0.7594
Epoch 9/50
49/49 - 0s - 4ms/step - loss: 0.1233 - val_loss: 0.7502
Epoch 10/50
49/49 - 0s - 4ms/step - loss: 0.1208 - val_loss: 0.7506
Epoch 11/50
49/49 - 0s - 4ms/step - loss: 0.1175 - val_loss: 0.7558
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 2.2956
Per-joint RMSE: 1.4841 3.3809 1.8105 3.1683 0.9752 1.9284
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:55:36.521349: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:55:36.545644: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s1_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:55:37.382379: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:37.386981: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:37.387762: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:37.389512: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:37.390290: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:37.391031: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:37.467793: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:37.468621: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:37.469358: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:55:37.470083: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:55:37.769310: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.393660e+00  RMSE=2.322425e+00
  per-joint RMSE: 1.5076 3.4556 1.7994 3.1986 0.9973 1.9195
Residual LSTM:  MSE=5.269741e+00      RMSE=2.295592e+00
  per-joint RMSE: 1.4841 3.3809 1.8105 3.1683 0.9752 1.9284
Combined torque MSE=5.269741e+00     RMSE=2.295592e+00
  per-joint RMSE: 1.4841 3.3809 1.8105 3.1683 0.9752 1.9284
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=2                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz                                 ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p3_seed1_dataset.npz -t structured -s 2 -r 0 --hp_preset fast_debug --epochs 200 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200.jax' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 200, 'lagrangian_type': <function structured_lagrangian_fn at 0x797757a081f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K50_tf0p3_seed1_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p3_seed1_dataset.npz
   dt ≈ 0.031724498445888843
  dof = 6
  Train trajectories = 35
  Test trajectories  = 15
  Train samples = 16260
  Test samples  = 5024
################################################

2026-01-22 05:55:42.041482: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200 | type=structured | dof=6
################################################
2026-01-22 05:55:45.165925: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:55:45.165962: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:55:45.165967: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:55:45.165995: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:55:45.166000: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:55:45.166015: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:55:45.166051: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:55:45.166057: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:55:45.166073: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:55:45.166077: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   4.9s, Loss=1.10e+01, Inv=1.10e+01, For=1.34e+02, Power=3.33e+00
  [eval] test_mse=5.384e+00  (n=5024)
Epoch 00050: Time=   8.4s, Loss=2.73e+00, Inv=2.73e+00, For=6.21e+01, Power=1.09e+00
Epoch 00100: Time=  10.8s, Loss=2.39e+00, Inv=2.39e+00, For=9.14e+01, Power=1.06e+00
Epoch 00150: Time=  12.8s, Loss=2.18e+00, Inv=2.18e+00, For=1.53e+02, Power=1.03e+00
Epoch 00200: Time=  15.0s, Loss=2.05e+00, Inv=2.05e+00, For=2.48e+02, Power=1.02e+00
  [eval] test_mse=2.056e+01  (n=5024)
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200
Torque MSE  = 3.427e+00
Torque RMSE = 1.851e+00
Per-joint MSE : 1.080e+00 9.240e+00 6.048e-01 3.901e+00 7.147e-01 5.023e+00
Per-joint RMSE: 1.039e+00 3.040e+00 7.777e-01 1.975e+00 8.454e-01 2.241e+00
Comp Time per Sample = 5.892e-08s / 16972457.0Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p3_seed1_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p3_seed1_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200.jax
Detected n_dof=6 (seed=2)
2026-01-22 05:56:02.254050: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 35 trajectories
2026-01-22 05:56:03.560777: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:56:03.560791: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:56:05.004447: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:56:05.004461: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:56:06.540792: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/35
2026-01-22 05:56:07.684019: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:56:07.684054: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:56:07.684059: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 35/35

Exporting split=test: 15 trajectories
  done 15/15

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200.npz --H 25 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200.json
H=25, n_dof=6, feature_dim=24
X_train: (15840, 25, 24)  Y_train: (15840, 6)
X_test : (4832, 25, 24)  Y_test : (4832, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:56:10.067329: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:56:10.091011: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (15840, 25, 24), Y_train = (15840, 6)
  X_test  = (4832, 25, 24),  Y_test  = (4832, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:56:11.094704: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:11.099200: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:11.100018: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:11.101755: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:11.102570: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:11.103337: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:11.185066: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:11.185947: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:11.186746: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:11.187539: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8816 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:56:12.134576: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
50/50 - 2s - 30ms/step - loss: 0.3191 - val_loss: 0.7626
Epoch 2/50
50/50 - 0s - 3ms/step - loss: 0.1873 - val_loss: 0.7558
Epoch 3/50
50/50 - 0s - 3ms/step - loss: 0.1596 - val_loss: 0.7099
Epoch 4/50
50/50 - 0s - 3ms/step - loss: 0.1477 - val_loss: 0.6966
Epoch 5/50
50/50 - 0s - 3ms/step - loss: 0.1376 - val_loss: 0.6690
Epoch 6/50
50/50 - 0s - 3ms/step - loss: 0.1318 - val_loss: 0.6620
Epoch 7/50
50/50 - 0s - 3ms/step - loss: 0.1280 - val_loss: 0.6658
Epoch 8/50
50/50 - 0s - 3ms/step - loss: 0.1236 - val_loss: 0.6680
Epoch 9/50
50/50 - 0s - 3ms/step - loss: 0.1208 - val_loss: 0.6702
Epoch 10/50
50/50 - 0s - 3ms/step - loss: 0.1183 - val_loss: 0.6772
Epoch 11/50
50/50 - 0s - 3ms/step - loss: 0.1173 - val_loss: 0.6786
Epoch 12/50
50/50 - 0s - 3ms/step - loss: 0.1144 - val_loss: 0.6756
Epoch 13/50
50/50 - 0s - 3ms/step - loss: 0.1125 - val_loss: 0.6800
Epoch 14/50
50/50 - 0s - 3ms/step - loss: 0.1098 - val_loss: 0.6783
Epoch 15/50
50/50 - 0s - 3ms/step - loss: 0.1096 - val_loss: 0.6820
Epoch 16/50
50/50 - 0s - 3ms/step - loss: 0.1078 - val_loss: 0.6924
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.8136
Per-joint RMSE: 0.9475 2.9886 0.7190 1.9349 0.8038 2.2358
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:56:16.169373: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:56:16.193639: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 05:56:17.046121: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:17.050916: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:17.051704: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:17.053402: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:17.054194: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:17.054921: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:17.135135: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:17.136057: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:17.136798: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:17.137516: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8809 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:56:17.436387: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.487031e+00  RMSE=1.867359e+00
  per-joint RMSE: 1.0512 3.0504 0.7776 2.0040 0.8556 2.2715
Residual LSTM:  MSE=3.289170e+00      RMSE=1.813607e+00
  per-joint RMSE: 0.9475 2.9886 0.7190 1.9349 0.8038 2.2358
Combined torque MSE=3.289170e+00     RMSE=1.813607e+00
  per-joint RMSE: 0.9475 2.9886 0.7190 1.9349 0.8038 2.2358
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200.npz --H 25 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200.json
H=25, n_dof=6, feature_dim=6
X_train: (15840, 25, 6)  Y_train: (15840, 6)
X_test : (4832, 25, 6)  Y_test : (4832, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:56:19.350936: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:56:19.374618: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (15840, 25, 6), Y_train = (15840, 6)
  X_test  = (4832, 25, 6),  Y_test  = (4832, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:56:20.325586: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:20.330128: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:20.330917: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:20.332507: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:20.333287: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:20.334021: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:20.415822: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:20.416653: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:20.417390: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:20.418210: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:56:21.338820: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
50/50 - 1s - 30ms/step - loss: 0.5647 - val_loss: 1.5438
Epoch 2/50
50/50 - 0s - 3ms/step - loss: 0.3674 - val_loss: 1.5696
Epoch 3/50
50/50 - 0s - 3ms/step - loss: 0.2725 - val_loss: 1.4780
Epoch 4/50
50/50 - 0s - 3ms/step - loss: 0.2077 - val_loss: 1.3804
Epoch 5/50
50/50 - 0s - 3ms/step - loss: 0.1816 - val_loss: 1.3265
Epoch 6/50
50/50 - 0s - 3ms/step - loss: 0.1677 - val_loss: 1.2754
Epoch 7/50
50/50 - 0s - 3ms/step - loss: 0.1558 - val_loss: 1.3123
Epoch 8/50
50/50 - 0s - 3ms/step - loss: 0.1477 - val_loss: 1.2988
Epoch 9/50
50/50 - 0s - 3ms/step - loss: 0.1417 - val_loss: 1.3077
Epoch 10/50
50/50 - 0s - 3ms/step - loss: 0.1387 - val_loss: 1.2875
Epoch 11/50
50/50 - 0s - 3ms/step - loss: 0.1375 - val_loss: 1.2711
Epoch 12/50
50/50 - 0s - 3ms/step - loss: 0.1349 - val_loss: 1.2190
Epoch 13/50
50/50 - 0s - 3ms/step - loss: 0.1275 - val_loss: 1.2105
Epoch 14/50
50/50 - 0s - 3ms/step - loss: 0.1263 - val_loss: 1.1767
Epoch 15/50
50/50 - 0s - 3ms/step - loss: 0.1267 - val_loss: 1.1661
Epoch 16/50
50/50 - 0s - 3ms/step - loss: 0.1252 - val_loss: 1.1593
Epoch 17/50
50/50 - 0s - 3ms/step - loss: 0.1239 - val_loss: 1.1683
Epoch 18/50
50/50 - 0s - 3ms/step - loss: 0.1223 - val_loss: 1.1496
Epoch 19/50
50/50 - 0s - 4ms/step - loss: 0.1248 - val_loss: 1.1643
Epoch 20/50
50/50 - 0s - 3ms/step - loss: 0.1161 - val_loss: 1.1580
Epoch 21/50
50/50 - 0s - 3ms/step - loss: 0.1213 - val_loss: 1.1697
Epoch 22/50
50/50 - 0s - 3ms/step - loss: 0.1169 - val_loss: 1.1829
Epoch 23/50
50/50 - 0s - 3ms/step - loss: 0.1181 - val_loss: 1.1559
Epoch 24/50
50/50 - 0s - 3ms/step - loss: 0.1153 - val_loss: 1.1056
Epoch 25/50
50/50 - 0s - 3ms/step - loss: 0.1140 - val_loss: 1.1009
Epoch 26/50
50/50 - 0s - 3ms/step - loss: 0.1150 - val_loss: 1.1410
Epoch 27/50
50/50 - 0s - 3ms/step - loss: 0.1106 - val_loss: 1.1164
Epoch 28/50
50/50 - 0s - 3ms/step - loss: 0.1107 - val_loss: 1.1406
Epoch 29/50
50/50 - 0s - 3ms/step - loss: 0.1073 - val_loss: 1.1516
Epoch 30/50
50/50 - 0s - 3ms/step - loss: 0.1099 - val_loss: 1.1684
Epoch 31/50
50/50 - 0s - 3ms/step - loss: 0.1068 - val_loss: 1.1524
Epoch 32/50
50/50 - 0s - 3ms/step - loss: 0.1078 - val_loss: 1.1116
Epoch 33/50
50/50 - 0s - 3ms/step - loss: 0.1057 - val_loss: 1.1598
Epoch 34/50
50/50 - 0s - 3ms/step - loss: 0.1043 - val_loss: 1.1384
Epoch 35/50
50/50 - 0s - 3ms/step - loss: 0.1033 - val_loss: 1.1416
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.8577
Per-joint RMSE: 1.0514 2.9972 0.7109 2.0461 0.8451 2.2826
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:56:28.235381: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:56:28.259359: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 05:56:29.112729: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:29.117350: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:29.118143: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:29.119855: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:29.120647: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:29.121382: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:29.197379: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:29.198436: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:29.199174: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:29.199901: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8814 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:56:29.492990: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.487031e+00  RMSE=1.867359e+00
  per-joint RMSE: 1.0512 3.0504 0.7776 2.0040 0.8556 2.2715
Residual LSTM:  MSE=3.450876e+00      RMSE=1.857653e+00
  per-joint RMSE: 1.0514 2.9972 0.7109 2.0461 0.8451 2.2826
Combined torque MSE=3.450876e+00     RMSE=1.857653e+00
  per-joint RMSE: 1.0514 2.9972 0.7109 2.0461 0.8451 2.2826
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200.npz --H 25 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200.json
H=25, n_dof=6, feature_dim=18
X_train: (15840, 25, 18)  Y_train: (15840, 6)
X_test : (4832, 25, 18)  Y_test : (4832, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:56:31.463796: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:56:31.487965: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (15840, 25, 18), Y_train = (15840, 6)
  X_test  = (4832, 25, 18),  Y_test  = (4832, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:56:32.471299: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:32.475967: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:32.476838: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:32.478476: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:32.479347: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:32.480081: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:32.551092: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:32.551924: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:32.552687: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:32.553461: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8809 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:56:33.487342: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
50/50 - 1s - 30ms/step - loss: 0.3401 - val_loss: 0.8275
Epoch 2/50
50/50 - 0s - 3ms/step - loss: 0.2205 - val_loss: 0.8736
Epoch 3/50
50/50 - 0s - 3ms/step - loss: 0.1979 - val_loss: 0.8759
Epoch 4/50
50/50 - 0s - 3ms/step - loss: 0.1810 - val_loss: 0.9047
Epoch 5/50
50/50 - 0s - 3ms/step - loss: 0.1675 - val_loss: 0.9050
Epoch 6/50
50/50 - 0s - 3ms/step - loss: 0.1558 - val_loss: 0.9287
Epoch 7/50
50/50 - 0s - 3ms/step - loss: 0.1484 - val_loss: 0.9393
Epoch 8/50
50/50 - 0s - 3ms/step - loss: 0.1431 - val_loss: 0.9445
Epoch 9/50
50/50 - 0s - 3ms/step - loss: 0.1364 - val_loss: 0.9538
Epoch 10/50
50/50 - 0s - 3ms/step - loss: 0.1328 - val_loss: 0.9587
Epoch 11/50
50/50 - 0s - 3ms/step - loss: 0.1280 - val_loss: 0.9587
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.8489
Per-joint RMSE: 0.9703 3.0259 0.7085 1.9963 0.8485 2.2814
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:56:36.742667: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:56:36.766974: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:56:37.617917: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:37.622656: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:37.623446: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:37.625276: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:37.626068: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:37.626795: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:37.706907: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:37.707743: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:37.708494: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:37.709232: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:56:38.004735: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.487031e+00  RMSE=1.867359e+00
  per-joint RMSE: 1.0512 3.0504 0.7776 2.0040 0.8556 2.2715
Residual LSTM:  MSE=3.418272e+00      RMSE=1.848857e+00
  per-joint RMSE: 0.9703 3.0259 0.7085 1.9963 0.8485 2.2814
Combined torque MSE=3.418272e+00     RMSE=1.848857e+00
  per-joint RMSE: 0.9703 3.0259 0.7085 1.9963 0.8485 2.2814
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200.npz --H 25 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200.json
H=25, n_dof=6, feature_dim=18
X_train: (15840, 25, 18)  Y_train: (15840, 6)
X_test : (4832, 25, 18)  Y_test : (4832, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:56:39.937931: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:56:39.961802: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (15840, 25, 18), Y_train = (15840, 6)
  X_test  = (4832, 25, 18),  Y_test  = (4832, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:56:40.941716: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:40.946221: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:40.947008: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:40.948580: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:40.949359: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:40.950082: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:41.029802: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:41.030644: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:41.031387: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:41.032211: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:56:41.938320: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
50/50 - 1s - 29ms/step - loss: 0.3267 - val_loss: 0.7618
Epoch 2/50
50/50 - 0s - 3ms/step - loss: 0.1963 - val_loss: 0.7439
Epoch 3/50
50/50 - 0s - 3ms/step - loss: 0.1637 - val_loss: 0.7468
Epoch 4/50
50/50 - 0s - 3ms/step - loss: 0.1483 - val_loss: 0.7463
Epoch 5/50
50/50 - 0s - 3ms/step - loss: 0.1387 - val_loss: 0.7354
Epoch 6/50
50/50 - 0s - 3ms/step - loss: 0.1319 - val_loss: 0.7346
Epoch 7/50
50/50 - 0s - 3ms/step - loss: 0.1273 - val_loss: 0.7371
Epoch 8/50
50/50 - 0s - 3ms/step - loss: 0.1239 - val_loss: 0.7334
Epoch 9/50
50/50 - 0s - 3ms/step - loss: 0.1202 - val_loss: 0.7361
Epoch 10/50
50/50 - 0s - 3ms/step - loss: 0.1171 - val_loss: 0.7390
Epoch 11/50
50/50 - 0s - 3ms/step - loss: 0.1146 - val_loss: 0.7434
Epoch 12/50
50/50 - 0s - 3ms/step - loss: 0.1129 - val_loss: 0.7356
Epoch 13/50
50/50 - 0s - 3ms/step - loss: 0.1115 - val_loss: 0.7419
Epoch 14/50
50/50 - 0s - 3ms/step - loss: 0.1088 - val_loss: 0.7325
Epoch 15/50
50/50 - 0s - 3ms/step - loss: 0.1074 - val_loss: 0.7387
Epoch 16/50
50/50 - 0s - 3ms/step - loss: 0.1066 - val_loss: 0.7433
Epoch 17/50
50/50 - 0s - 3ms/step - loss: 0.1045 - val_loss: 0.7353
Epoch 18/50
50/50 - 0s - 3ms/step - loss: 0.1040 - val_loss: 0.7385
Epoch 19/50
50/50 - 0s - 4ms/step - loss: 0.1029 - val_loss: 0.7412
Epoch 20/50
50/50 - 0s - 3ms/step - loss: 0.1020 - val_loss: 0.7327
Epoch 21/50
50/50 - 0s - 3ms/step - loss: 0.1002 - val_loss: 0.7436
Epoch 22/50
50/50 - 0s - 3ms/step - loss: 0.0985 - val_loss: 0.7349
Epoch 23/50
50/50 - 0s - 3ms/step - loss: 0.0970 - val_loss: 0.7415
Epoch 24/50
50/50 - 0s - 3ms/step - loss: 0.0960 - val_loss: 0.7465
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.8318
Per-joint RMSE: 0.9672 3.0531 0.6772 1.9505 0.7926 2.2328
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:56:47.167259: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:56:47.191559: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:56:48.036195: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:48.040914: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:48.041695: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:48.043506: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:48.044372: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:48.045185: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:48.126213: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:48.127115: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:48.127939: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:48.128672: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8813 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:56:48.422106: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.487031e+00  RMSE=1.867359e+00
  per-joint RMSE: 1.0512 3.0504 0.7776 2.0040 0.8556 2.2715
Residual LSTM:  MSE=3.355574e+00      RMSE=1.831823e+00
  per-joint RMSE: 0.9672 3.0531 0.6772 1.9505 0.7926 2.2328
Combined torque MSE=3.355574e+00     RMSE=1.831823e+00
  per-joint RMSE: 0.9672 3.0531 0.6772 1.9505 0.7926 2.2328
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200.npz --H 50 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200.json
H=50, n_dof=6, feature_dim=24
X_train: (15465, 50, 24)  Y_train: (15465, 6)
X_test : (4657, 50, 24)  Y_test : (4657, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:56:50.423914: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:56:50.447832: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (15465, 50, 24), Y_train = (15465, 6)
  X_test  = (4657, 50, 24),  Y_test  = (4657, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:56:51.502697: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:51.507482: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:51.508349: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:51.510142: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:51.510927: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:51.511668: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:51.588611: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:51.589535: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:51.590284: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:51.591010: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:56:52.524934: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
49/49 - 2s - 32ms/step - loss: 0.3351 - val_loss: 0.8073
Epoch 2/50
49/49 - 0s - 5ms/step - loss: 0.1935 - val_loss: 0.7998
Epoch 3/50
49/49 - 0s - 5ms/step - loss: 0.1637 - val_loss: 0.7775
Epoch 4/50
49/49 - 0s - 4ms/step - loss: 0.1487 - val_loss: 0.7629
Epoch 5/50
49/49 - 0s - 4ms/step - loss: 0.1406 - val_loss: 0.7668
Epoch 6/50
49/49 - 0s - 4ms/step - loss: 0.1346 - val_loss: 0.7663
Epoch 7/50
49/49 - 0s - 4ms/step - loss: 0.1318 - val_loss: 0.7802
Epoch 8/50
49/49 - 0s - 4ms/step - loss: 0.1280 - val_loss: 0.7867
Epoch 9/50
49/49 - 0s - 4ms/step - loss: 0.1238 - val_loss: 0.7926
Epoch 10/50
49/49 - 0s - 4ms/step - loss: 0.1216 - val_loss: 0.8118
Epoch 11/50
49/49 - 0s - 4ms/step - loss: 0.1183 - val_loss: 0.8047
Epoch 12/50
49/49 - 0s - 4ms/step - loss: 0.1158 - val_loss: 0.8072
Epoch 13/50
49/49 - 0s - 4ms/step - loss: 0.1152 - val_loss: 0.8059
Epoch 14/50
49/49 - 0s - 4ms/step - loss: 0.1145 - val_loss: 0.8069
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.8064
Per-joint RMSE: 0.9645 2.9870 0.7056 1.9347 0.7761 2.2096
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:56:57.162729: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:56:57.186975: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 05:56:58.037361: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:58.042189: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:58.042980: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:58.044703: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:58.045488: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:58.046227: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:58.130932: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:58.131846: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:58.132676: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:56:58.133398: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:56:58.436864: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.422581e+00  RMSE=1.850022e+00
  per-joint RMSE: 1.0490 3.0213 0.7724 1.9794 0.8334 2.2579
Residual LSTM:  MSE=3.262959e+00      RMSE=1.806366e+00
  per-joint RMSE: 0.9645 2.9870 0.7056 1.9347 0.7761 2.2096
Combined torque MSE=3.262959e+00     RMSE=1.806366e+00
  per-joint RMSE: 0.9645 2.9870 0.7056 1.9347 0.7761 2.2096
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_full__lstm_s1_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200.npz --H 50 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200.json
H=50, n_dof=6, feature_dim=6
X_train: (15465, 50, 6)  Y_train: (15465, 6)
X_test : (4657, 50, 6)  Y_test : (4657, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:57:00.367823: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:57:00.391515: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (15465, 50, 6), Y_train = (15465, 6)
  X_test  = (4657, 50, 6),  Y_test  = (4657, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:57:01.362044: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:01.366475: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:01.367267: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:01.368909: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:01.369751: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:01.370529: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:01.444317: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:01.445231: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:01.445974: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:01.446698: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:57:02.336183: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
49/49 - 2s - 32ms/step - loss: 0.4857 - val_loss: 1.5757
Epoch 2/50
49/49 - 0s - 4ms/step - loss: 0.2786 - val_loss: 1.5804
Epoch 3/50
49/49 - 0s - 5ms/step - loss: 0.2157 - val_loss: 1.4052
Epoch 4/50
49/49 - 0s - 4ms/step - loss: 0.1815 - val_loss: 1.4096
Epoch 5/50
49/49 - 0s - 4ms/step - loss: 0.1662 - val_loss: 1.4199
Epoch 6/50
49/49 - 0s - 4ms/step - loss: 0.1543 - val_loss: 1.3981
Epoch 7/50
49/49 - 0s - 4ms/step - loss: 0.1481 - val_loss: 1.3758
Epoch 8/50
49/49 - 0s - 4ms/step - loss: 0.1436 - val_loss: 1.3973
Epoch 9/50
49/49 - 0s - 4ms/step - loss: 0.1401 - val_loss: 1.4294
Epoch 10/50
49/49 - 0s - 4ms/step - loss: 0.1349 - val_loss: 1.4710
Epoch 11/50
49/49 - 0s - 4ms/step - loss: 0.1342 - val_loss: 1.4413
Epoch 12/50
49/49 - 0s - 4ms/step - loss: 0.1323 - val_loss: 1.4126
Epoch 13/50
49/49 - 0s - 4ms/step - loss: 0.1278 - val_loss: 1.4247
Epoch 14/50
49/49 - 0s - 4ms/step - loss: 0.1267 - val_loss: 1.4543
Epoch 15/50
49/49 - 0s - 4ms/step - loss: 0.1275 - val_loss: 1.4072
Epoch 16/50
49/49 - 0s - 4ms/step - loss: 0.1216 - val_loss: 1.4422
Epoch 17/50
49/49 - 0s - 4ms/step - loss: 0.1214 - val_loss: 1.4447
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.8469
Per-joint RMSE: 1.0545 3.0388 0.7332 1.9795 0.8115 2.2371
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:57:07.540322: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:57:07.565963: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 05:57:08.405789: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:08.410977: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:08.411849: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:08.413572: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:08.414365: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:08.415095: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:08.495529: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:08.496367: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:08.497110: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:08.497840: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8813 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:57:08.796677: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.422581e+00  RMSE=1.850022e+00
  per-joint RMSE: 1.0490 3.0213 0.7724 1.9794 0.8334 2.2579
Residual LSTM:  MSE=3.410890e+00      RMSE=1.846859e+00
  per-joint RMSE: 1.0545 3.0388 0.7332 1.9795 0.8115 2.2371
Combined torque MSE=3.410890e+00     RMSE=1.846859e+00
  per-joint RMSE: 1.0545 3.0388 0.7332 1.9795 0.8115 2.2371
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s1_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200.npz --H 50 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200.json
H=50, n_dof=6, feature_dim=18
X_train: (15465, 50, 18)  Y_train: (15465, 6)
X_test : (4657, 50, 18)  Y_test : (4657, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:57:10.812413: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:57:10.836174: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (15465, 50, 18), Y_train = (15465, 6)
  X_test  = (4657, 50, 18),  Y_test  = (4657, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:57:11.872462: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:11.877286: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:11.878072: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:11.879689: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:11.880476: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:11.881212: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:11.964011: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:11.965019: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:11.965851: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:11.966594: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8813 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:57:12.893292: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
49/49 - 2s - 32ms/step - loss: 0.3515 - val_loss: 0.8638
Epoch 2/50
49/49 - 0s - 4ms/step - loss: 0.2220 - val_loss: 0.8769
Epoch 3/50
49/49 - 0s - 5ms/step - loss: 0.1990 - val_loss: 0.8621
Epoch 4/50
49/49 - 0s - 4ms/step - loss: 0.1836 - val_loss: 0.8748
Epoch 5/50
49/49 - 0s - 4ms/step - loss: 0.1657 - val_loss: 0.8987
Epoch 6/50
49/49 - 0s - 4ms/step - loss: 0.1590 - val_loss: 0.8794
Epoch 7/50
49/49 - 0s - 4ms/step - loss: 0.1521 - val_loss: 0.9061
Epoch 8/50
49/49 - 0s - 4ms/step - loss: 0.1456 - val_loss: 0.9229
Epoch 9/50
49/49 - 0s - 4ms/step - loss: 0.1392 - val_loss: 0.9238
Epoch 10/50
49/49 - 0s - 4ms/step - loss: 0.1333 - val_loss: 0.9216
Epoch 11/50
49/49 - 0s - 4ms/step - loss: 0.1302 - val_loss: 0.9233
Epoch 12/50
49/49 - 0s - 4ms/step - loss: 0.1275 - val_loss: 0.9220
Epoch 13/50
49/49 - 0s - 4ms/step - loss: 0.1232 - val_loss: 0.9235
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.8174
Per-joint RMSE: 0.9738 2.9679 0.7040 1.9675 0.8219 2.2401
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:57:17.258355: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:57:17.282673: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:57:18.129905: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:18.134478: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:18.135265: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:18.137007: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:18.137790: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:18.138520: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:18.215413: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:18.216246: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:18.216995: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:18.217720: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:57:18.516865: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.422581e+00  RMSE=1.850022e+00
  per-joint RMSE: 1.0490 3.0213 0.7724 1.9794 0.8334 2.2579
Residual LSTM:  MSE=3.302794e+00      RMSE=1.817359e+00
  per-joint RMSE: 0.9738 2.9679 0.7040 1.9675 0.8219 2.2401
Combined torque MSE=3.302794e+00     RMSE=1.817359e+00
  per-joint RMSE: 0.9738 2.9679 0.7040 1.9675 0.8219 2.2401
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state__lstm_s1_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200.npz --H 50 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200.json
H=50, n_dof=6, feature_dim=18
X_train: (15465, 50, 18)  Y_train: (15465, 6)
X_test : (4657, 50, 18)  Y_test : (4657, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:57:20.489242: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:57:20.513360: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (15465, 50, 18), Y_train = (15465, 6)
  X_test  = (4657, 50, 18),  Y_test  = (4657, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:57:21.543174: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:21.547759: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:21.548624: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:21.550289: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:21.551069: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:21.551883: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:21.624085: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:21.624928: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:21.625680: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:21.626410: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:57:22.549118: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
49/49 - 2s - 32ms/step - loss: 0.3290 - val_loss: 0.8128
Epoch 2/50
49/49 - 0s - 4ms/step - loss: 0.1980 - val_loss: 0.8278
Epoch 3/50
49/49 - 0s - 4ms/step - loss: 0.1640 - val_loss: 0.7712
Epoch 4/50
49/49 - 0s - 4ms/step - loss: 0.1485 - val_loss: 0.7751
Epoch 5/50
49/49 - 0s - 5ms/step - loss: 0.1403 - val_loss: 0.7521
Epoch 6/50
49/49 - 0s - 4ms/step - loss: 0.1343 - val_loss: 0.7502
Epoch 7/50
49/49 - 0s - 4ms/step - loss: 0.1291 - val_loss: 0.7602
Epoch 8/50
49/49 - 0s - 4ms/step - loss: 0.1252 - val_loss: 0.7825
Epoch 9/50
49/49 - 0s - 4ms/step - loss: 0.1220 - val_loss: 0.7752
Epoch 10/50
49/49 - 0s - 4ms/step - loss: 0.1201 - val_loss: 0.7822
Epoch 11/50
49/49 - 0s - 4ms/step - loss: 0.1172 - val_loss: 0.7986
Epoch 12/50
49/49 - 0s - 4ms/step - loss: 0.1149 - val_loss: 0.7946
Epoch 13/50
49/49 - 0s - 4ms/step - loss: 0.1139 - val_loss: 0.7985
Epoch 14/50
49/49 - 0s - 4ms/step - loss: 0.1123 - val_loss: 0.8031
Epoch 15/50
49/49 - 0s - 4ms/step - loss: 0.1111 - val_loss: 0.8011
Epoch 16/50
49/49 - 0s - 4ms/step - loss: 0.1120 - val_loss: 0.7942
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.8015
Per-joint RMSE: 0.9388 3.0011 0.7330 1.8914 0.7769 2.2058
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:57:27.554502: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:57:27.578992: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p3__residual__delan_jax_struct_s2_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:57:28.422987: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:28.427624: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:28.428410: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:28.430256: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:28.430960: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:28.431695: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:28.514127: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:28.517190: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:28.518190: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:57:28.518976: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8810 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:57:28.824203: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.422581e+00  RMSE=1.850022e+00
  per-joint RMSE: 1.0490 3.0213 0.7724 1.9794 0.8334 2.2579
Residual LSTM:  MSE=3.245264e+00      RMSE=1.801461e+00
  per-joint RMSE: 0.9388 3.0011 0.7330 1.8914 0.7769 2.2058
Combined torque MSE=3.245264e+00     RMSE=1.801461e+00
  per-joint RMSE: 0.9388 3.0011 0.7330 1.8914 0.7769 2.2058
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p3__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s1_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

