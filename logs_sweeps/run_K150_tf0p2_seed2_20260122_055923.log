#################################################################################################################
### RUN: K=150 test_fraction=0.2 seed=2                                                                       ###
### npz_in=/workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p2_seed2_dataset.npz ###
#################################################################################################################

#####################
### 1) PREPROCESS ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_delan_dataset.py --qdd True --col_format wide --trajectory_amount 150 --test_fraction 0.2 --seed 2 --raw_csv /workspace/shared/data/raw/delan_UR3_Load0_combined_26.csv --out_npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p2_seed2_dataset.npz' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Saved: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p2_seed2_dataset.npz
Trajectories: train=120 test=30
Exists: True

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=0                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz                                ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p2_seed2_dataset.npz -t structured -s 0 -r 0 --hp_preset fast_debug --epochs 400 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400.jax' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 400, 'lagrangian_type': <function structured_lagrangian_fn at 0x7a25d9b6c1f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K150_tf0p2_seed2_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p2_seed2_dataset.npz
   dt ≈ 0.02208891656001752
  dof = 6
  Train trajectories = 120
  Test trajectories  = 30
  Train samples = 72344
  Test samples  = 14539
################################################

2026-01-22 08:33:37.778661: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400 | type=structured | dof=6
################################################
2026-01-22 08:33:40.928432: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:33:40.928468: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:33:40.928475: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:33:40.928502: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:33:40.928507: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:33:40.928522: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:33:40.928559: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:33:40.928564: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:33:40.928583: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:33:40.928588: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.1s, Loss=9.50e+00, Inv=9.50e+00, For=1.33e+02, Power=2.53e+00
  [eval] test_mse=1.270e+00  (n=14539)
Epoch 00050: Time=  15.4s, Loss=2.65e+00, Inv=2.65e+00, For=8.05e+01, Power=1.33e+00
Epoch 00100: Time=  24.2s, Loss=2.45e+00, Inv=2.45e+00, For=1.21e+02, Power=1.25e+00
Epoch 00150: Time=  33.7s, Loss=2.35e+00, Inv=2.35e+00, For=1.52e+02, Power=1.21e+00
Epoch 00200: Time=  43.2s, Loss=2.30e+00, Inv=2.30e+00, For=1.73e+02, Power=1.20e+00
  [eval] test_mse=1.423e+00  (n=14539)
Epoch 00250: Time=  52.2s, Loss=2.26e+00, Inv=2.26e+00, For=1.77e+02, Power=1.18e+00
Epoch 00300: Time=  61.5s, Loss=2.24e+00, Inv=2.24e+00, For=1.82e+02, Power=1.17e+00
Epoch 00350: Time=  71.5s, Loss=2.22e+00, Inv=2.22e+00, For=1.84e+02, Power=1.17e+00
Epoch 00400: Time=  81.3s, Loss=2.20e+00, Inv=2.20e+00, For=1.88e+02, Power=1.16e+00
  [eval] test_mse=1.663e+00  (n=14539)
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400
Torque MSE  = 2.772e-01
Torque RMSE = 5.265e-01
Per-joint MSE : 3.628e-01 8.476e-01 2.120e-01 8.636e-02 9.073e-02 6.365e-02
Per-joint RMSE: 6.023e-01 9.206e-01 4.605e-01 2.939e-01 3.012e-01 2.523e-01
Comp Time per Sample = 2.242e-08s / 44609516.5Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p2_seed2_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p2_seed2_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400.jax
Detected n_dof=6 (seed=0)
2026-01-22 08:35:04.391647: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 120 trajectories
2026-01-22 08:35:05.691189: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:35:05.691202: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:35:07.235289: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:35:07.235304: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:35:08.687362: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/120
2026-01-22 08:35:09.939359: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:35:11.166850: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:35:11.166884: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:35:11.166889: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 50/120
  done 75/120
2026-01-22 08:35:12.756199: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:35:13.994497: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:35:15.318380: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 100/120
  done 120/120

Exporting split=test: 30 trajectories
  done 25/30
  done 30/30

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400.npz --H 25 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400.json
H=25, n_dof=6, feature_dim=24
X_train: (70535, 25, 24)  Y_train: (70535, 6)
X_test : (14092, 25, 24)  Y_test : (14092, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:35:19.105635: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:35:19.130859: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (70535, 25, 24), Y_train = (70535, 6)
  X_test  = (14092, 25, 24),  Y_test  = (14092, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:35:20.385397: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:20.390303: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:20.391292: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:20.392880: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:20.393682: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:20.394429: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:20.482013: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:20.482895: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:20.483685: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:20.484474: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8975 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:35:21.513308: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
221/221 - 2s - 9ms/step - loss: 0.2209 - val_loss: 0.2878
Epoch 2/100
221/221 - 1s - 3ms/step - loss: 0.1305 - val_loss: 0.2619
Epoch 3/100
221/221 - 1s - 3ms/step - loss: 0.1143 - val_loss: 0.2534
Epoch 4/100
221/221 - 1s - 3ms/step - loss: 0.1059 - val_loss: 0.2433
Epoch 5/100
221/221 - 1s - 3ms/step - loss: 0.0987 - val_loss: 0.2355
Epoch 6/100
221/221 - 1s - 3ms/step - loss: 0.0941 - val_loss: 0.2244
Epoch 7/100
221/221 - 1s - 3ms/step - loss: 0.0925 - val_loss: 0.2258
Epoch 8/100
221/221 - 1s - 3ms/step - loss: 0.0880 - val_loss: 0.2094
Epoch 9/100
221/221 - 1s - 3ms/step - loss: 0.0850 - val_loss: 0.2061
Epoch 10/100
221/221 - 1s - 3ms/step - loss: 0.0831 - val_loss: 0.1969
Epoch 11/100
221/221 - 1s - 3ms/step - loss: 0.0807 - val_loss: 0.1993
Epoch 12/100
221/221 - 1s - 3ms/step - loss: 0.0790 - val_loss: 0.1956
Epoch 13/100
221/221 - 1s - 3ms/step - loss: 0.0775 - val_loss: 0.1837
Epoch 14/100
221/221 - 1s - 3ms/step - loss: 0.0758 - val_loss: 0.1789
Epoch 15/100
221/221 - 1s - 3ms/step - loss: 0.0741 - val_loss: 0.1814
Epoch 16/100
221/221 - 1s - 3ms/step - loss: 0.0727 - val_loss: 0.1802
Epoch 17/100
221/221 - 1s - 3ms/step - loss: 0.0720 - val_loss: 0.1769
Epoch 18/100
221/221 - 1s - 3ms/step - loss: 0.0704 - val_loss: 0.1762
Epoch 19/100
221/221 - 1s - 3ms/step - loss: 0.0694 - val_loss: 0.1747
Epoch 20/100
221/221 - 1s - 3ms/step - loss: 0.0688 - val_loss: 0.1706
Epoch 21/100
221/221 - 1s - 3ms/step - loss: 0.0679 - val_loss: 0.1742
Epoch 22/100
221/221 - 1s - 3ms/step - loss: 0.0669 - val_loss: 0.1720
Epoch 23/100
221/221 - 1s - 3ms/step - loss: 0.0669 - val_loss: 0.1669
Epoch 24/100
221/221 - 1s - 3ms/step - loss: 0.0656 - val_loss: 0.1682
Epoch 25/100
221/221 - 1s - 3ms/step - loss: 0.0655 - val_loss: 0.1691
Epoch 26/100
221/221 - 1s - 3ms/step - loss: 0.0643 - val_loss: 0.1704
Epoch 27/100
221/221 - 1s - 3ms/step - loss: 0.0644 - val_loss: 0.1667
Epoch 28/100
221/221 - 1s - 3ms/step - loss: 0.0630 - val_loss: 0.1691
Epoch 29/100
221/221 - 1s - 3ms/step - loss: 0.0623 - val_loss: 0.1669
Epoch 30/100
221/221 - 1s - 3ms/step - loss: 0.0616 - val_loss: 0.1746
Epoch 31/100
221/221 - 1s - 3ms/step - loss: 0.0611 - val_loss: 0.1631
Epoch 32/100
221/221 - 1s - 3ms/step - loss: 0.0609 - val_loss: 0.1655
Epoch 33/100
221/221 - 1s - 3ms/step - loss: 0.0605 - val_loss: 0.1659
Epoch 34/100
221/221 - 1s - 2ms/step - loss: 0.0594 - val_loss: 0.1685
Epoch 35/100
221/221 - 1s - 2ms/step - loss: 0.0586 - val_loss: 0.1676
Epoch 36/100
221/221 - 1s - 3ms/step - loss: 0.0583 - val_loss: 0.1667
Epoch 37/100
221/221 - 1s - 3ms/step - loss: 0.0576 - val_loss: 0.1679
Epoch 38/100
221/221 - 1s - 3ms/step - loss: 0.0577 - val_loss: 0.1712
Epoch 39/100
221/221 - 1s - 3ms/step - loss: 0.0576 - val_loss: 0.1634
Epoch 40/100
221/221 - 1s - 3ms/step - loss: 0.0574 - val_loss: 0.1663
Epoch 41/100
221/221 - 1s - 3ms/step - loss: 0.0559 - val_loss: 0.1660
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3833
Per-joint RMSE: 0.4557 0.6390 0.3361 0.2461 0.2388 0.1874
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:35:46.504062: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:35:46.528152: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 08:35:47.379984: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:47.384525: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:47.385398: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:47.387116: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:47.387910: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:47.388656: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:47.473189: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:47.474023: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:47.474767: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:47.475501: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:35:47.768412: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.817817e-01  RMSE=5.308312e-01
  per-joint RMSE: 0.6063 0.9296 0.4624 0.2964 0.3045 0.2543
Residual LSTM:  MSE=1.469417e-01      RMSE=3.833297e-01
  per-joint RMSE: 0.4557 0.6390 0.3361 0.2461 0.2388 0.1874
Combined torque MSE=1.469417e-01     RMSE=3.833297e-01
  per-joint RMSE: 0.4557 0.6390 0.3361 0.2461 0.2388 0.1874
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400.npz --H 25 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400.json
H=25, n_dof=6, feature_dim=6
X_train: (70535, 25, 6)  Y_train: (70535, 6)
X_test : (14092, 25, 6)  Y_test : (14092, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:35:50.080524: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:35:50.104763: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (70535, 25, 6), Y_train = (70535, 6)
  X_test  = (14092, 25, 6),  Y_test  = (14092, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:35:51.162880: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:51.167742: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:51.168534: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:51.170112: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:51.170894: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:51.171720: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:51.251708: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:51.252545: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:51.253287: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:35:51.254023: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:35:52.202341: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
221/221 - 2s - 9ms/step - loss: 0.6859 - val_loss: 0.7139
Epoch 2/100
221/221 - 1s - 3ms/step - loss: 0.4468 - val_loss: 0.6880
Epoch 3/100
221/221 - 1s - 3ms/step - loss: 0.3749 - val_loss: 0.7666
Epoch 4/100
221/221 - 1s - 2ms/step - loss: 0.3227 - val_loss: 0.8080
Epoch 5/100
221/221 - 1s - 3ms/step - loss: 0.2926 - val_loss: 0.7657
Epoch 6/100
221/221 - 1s - 2ms/step - loss: 0.2539 - val_loss: 0.7561
Epoch 7/100
221/221 - 1s - 2ms/step - loss: 0.2278 - val_loss: 0.8050
Epoch 8/100
221/221 - 1s - 3ms/step - loss: 0.2187 - val_loss: 0.7575
Epoch 9/100
221/221 - 1s - 3ms/step - loss: 0.2007 - val_loss: 0.8509
Epoch 10/100
221/221 - 1s - 3ms/step - loss: 0.2167 - val_loss: 0.7878
Epoch 11/100
221/221 - 1s - 3ms/step - loss: 0.1936 - val_loss: 0.7447
Epoch 12/100
221/221 - 1s - 3ms/step - loss: 0.1749 - val_loss: 0.7669
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4633
Per-joint RMSE: 0.5641 0.7452 0.4295 0.2677 0.2702 0.2918
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:36:00.576201: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:36:00.600494: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 08:36:01.463508: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:01.468052: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:01.469008: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:01.470684: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:01.471475: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:01.472211: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:01.548999: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:01.549838: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:01.550575: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:01.551398: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:36:01.843542: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.817817e-01  RMSE=5.308312e-01
  per-joint RMSE: 0.6063 0.9296 0.4624 0.2964 0.3045 0.2543
Residual LSTM:  MSE=2.146388e-01      RMSE=4.632913e-01
  per-joint RMSE: 0.5641 0.7452 0.4295 0.2677 0.2702 0.2918
Combined torque MSE=2.146388e-01     RMSE=4.632913e-01
  per-joint RMSE: 0.5641 0.7452 0.4295 0.2677 0.2702 0.2918
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400.npz --H 25 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400.json
H=25, n_dof=6, feature_dim=18
X_train: (70535, 25, 18)  Y_train: (70535, 6)
X_test : (14092, 25, 18)  Y_test : (14092, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:36:04.273362: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:36:04.297440: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (70535, 25, 18), Y_train = (70535, 6)
  X_test  = (14092, 25, 18),  Y_test  = (14092, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:36:05.497119: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:05.501912: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:05.502844: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:05.504634: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:05.505542: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:05.506397: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:05.593182: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:05.594098: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:05.594950: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:05.595792: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:36:06.585338: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
221/221 - 2s - 9ms/step - loss: 0.2520 - val_loss: 0.3507
Epoch 2/100
221/221 - 1s - 3ms/step - loss: 0.1542 - val_loss: 0.3309
Epoch 3/100
221/221 - 1s - 3ms/step - loss: 0.1355 - val_loss: 0.3175
Epoch 4/100
221/221 - 1s - 3ms/step - loss: 0.1252 - val_loss: 0.3127
Epoch 5/100
221/221 - 1s - 3ms/step - loss: 0.1185 - val_loss: 0.3043
Epoch 6/100
221/221 - 1s - 3ms/step - loss: 0.1144 - val_loss: 0.2982
Epoch 7/100
221/221 - 1s - 3ms/step - loss: 0.1107 - val_loss: 0.2913
Epoch 8/100
221/221 - 1s - 3ms/step - loss: 0.1062 - val_loss: 0.2917
Epoch 9/100
221/221 - 1s - 3ms/step - loss: 0.1030 - val_loss: 0.2888
Epoch 10/100
221/221 - 1s - 3ms/step - loss: 0.1003 - val_loss: 0.2816
Epoch 11/100
221/221 - 1s - 3ms/step - loss: 0.0988 - val_loss: 0.2769
Epoch 12/100
221/221 - 1s - 3ms/step - loss: 0.0965 - val_loss: 0.2780
Epoch 13/100
221/221 - 1s - 3ms/step - loss: 0.0958 - val_loss: 0.2803
Epoch 14/100
221/221 - 1s - 3ms/step - loss: 0.0941 - val_loss: 0.2741
Epoch 15/100
221/221 - 1s - 3ms/step - loss: 0.0920 - val_loss: 0.2717
Epoch 16/100
221/221 - 1s - 3ms/step - loss: 0.0904 - val_loss: 0.2654
Epoch 17/100
221/221 - 1s - 3ms/step - loss: 0.0885 - val_loss: 0.2666
Epoch 18/100
221/221 - 1s - 3ms/step - loss: 0.0875 - val_loss: 0.2650
Epoch 19/100
221/221 - 1s - 3ms/step - loss: 0.0864 - val_loss: 0.2611
Epoch 20/100
221/221 - 1s - 3ms/step - loss: 0.0848 - val_loss: 0.2609
Epoch 21/100
221/221 - 1s - 3ms/step - loss: 0.0845 - val_loss: 0.2577
Epoch 22/100
221/221 - 1s - 3ms/step - loss: 0.0835 - val_loss: 0.2526
Epoch 23/100
221/221 - 1s - 3ms/step - loss: 0.0815 - val_loss: 0.2565
Epoch 24/100
221/221 - 1s - 3ms/step - loss: 0.0806 - val_loss: 0.2592
Epoch 25/100
221/221 - 1s - 3ms/step - loss: 0.0813 - val_loss: 0.2555
Epoch 26/100
221/221 - 1s - 3ms/step - loss: 0.0803 - val_loss: 0.2496
Epoch 27/100
221/221 - 1s - 3ms/step - loss: 0.0786 - val_loss: 0.2528
Epoch 28/100
221/221 - 1s - 3ms/step - loss: 0.0776 - val_loss: 0.2498
Epoch 29/100
221/221 - 1s - 3ms/step - loss: 0.0772 - val_loss: 0.2485
Epoch 30/100
221/221 - 1s - 3ms/step - loss: 0.0776 - val_loss: 0.2440
Epoch 31/100
221/221 - 1s - 3ms/step - loss: 0.0761 - val_loss: 0.2425
Epoch 32/100
221/221 - 1s - 3ms/step - loss: 0.0762 - val_loss: 0.2459
Epoch 33/100
221/221 - 1s - 3ms/step - loss: 0.0753 - val_loss: 0.2421
Epoch 34/100
221/221 - 1s - 3ms/step - loss: 0.0748 - val_loss: 0.2430
Epoch 35/100
221/221 - 1s - 3ms/step - loss: 0.0737 - val_loss: 0.2445
Epoch 36/100
221/221 - 1s - 3ms/step - loss: 0.0724 - val_loss: 0.2445
Epoch 37/100
221/221 - 1s - 3ms/step - loss: 0.0724 - val_loss: 0.2411
Epoch 38/100
221/221 - 1s - 3ms/step - loss: 0.0698 - val_loss: 0.2427
Epoch 39/100
221/221 - 1s - 3ms/step - loss: 0.0700 - val_loss: 0.2368
Epoch 40/100
221/221 - 1s - 3ms/step - loss: 0.0693 - val_loss: 0.2402
Epoch 41/100
221/221 - 1s - 3ms/step - loss: 0.0685 - val_loss: 0.2373
Epoch 42/100
221/221 - 1s - 3ms/step - loss: 0.0677 - val_loss: 0.2453
Epoch 43/100
221/221 - 1s - 3ms/step - loss: 0.0682 - val_loss: 0.2417
Epoch 44/100
221/221 - 1s - 3ms/step - loss: 0.0676 - val_loss: 0.2366
Epoch 45/100
221/221 - 1s - 3ms/step - loss: 0.0666 - val_loss: 0.2382
Epoch 46/100
221/221 - 1s - 3ms/step - loss: 0.0662 - val_loss: 0.2379
Epoch 47/100
221/221 - 1s - 3ms/step - loss: 0.0657 - val_loss: 0.2407
Epoch 48/100
221/221 - 1s - 3ms/step - loss: 0.0650 - val_loss: 0.2384
Epoch 49/100
221/221 - 1s - 3ms/step - loss: 0.0656 - val_loss: 0.2362
Epoch 50/100
221/221 - 1s - 3ms/step - loss: 0.0655 - val_loss: 0.2346
Epoch 51/100
221/221 - 1s - 3ms/step - loss: 0.0640 - val_loss: 0.2375
Epoch 52/100
221/221 - 1s - 3ms/step - loss: 0.0636 - val_loss: 0.2327
Epoch 53/100
221/221 - 1s - 3ms/step - loss: 0.0631 - val_loss: 0.2358
Epoch 54/100
221/221 - 1s - 3ms/step - loss: 0.0631 - val_loss: 0.2383
Epoch 55/100
221/221 - 1s - 3ms/step - loss: 0.0625 - val_loss: 0.2349
Epoch 56/100
221/221 - 1s - 3ms/step - loss: 0.0611 - val_loss: 0.2349
Epoch 57/100
221/221 - 1s - 3ms/step - loss: 0.0628 - val_loss: 0.2372
Epoch 58/100
221/221 - 1s - 3ms/step - loss: 0.0614 - val_loss: 0.2343
Epoch 59/100
221/221 - 1s - 3ms/step - loss: 0.0611 - val_loss: 0.2370
Epoch 60/100
221/221 - 1s - 3ms/step - loss: 0.0604 - val_loss: 0.2391
Epoch 61/100
221/221 - 1s - 3ms/step - loss: 0.0607 - val_loss: 0.2377
Epoch 62/100
221/221 - 1s - 3ms/step - loss: 0.0596 - val_loss: 0.2346
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4567
Per-joint RMSE: 0.5385 0.7815 0.3846 0.2649 0.2795 0.2334
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:36:43.532448: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:36:43.557254: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 08:36:44.418973: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:44.423498: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:44.424296: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:44.425966: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:44.426849: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:44.427595: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:44.505223: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:44.506132: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:44.506972: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:44.507705: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:36:44.803520: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.817817e-01  RMSE=5.308312e-01
  per-joint RMSE: 0.6063 0.9296 0.4624 0.2964 0.3045 0.2543
Residual LSTM:  MSE=2.085726e-01      RMSE=4.566975e-01
  per-joint RMSE: 0.5385 0.7815 0.3846 0.2649 0.2795 0.2334
Combined torque MSE=2.085726e-01     RMSE=4.566975e-01
  per-joint RMSE: 0.5385 0.7815 0.3846 0.2649 0.2795 0.2334
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400.npz --H 25 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400.json
H=25, n_dof=6, feature_dim=18
X_train: (70535, 25, 18)  Y_train: (70535, 6)
X_test : (14092, 25, 18)  Y_test : (14092, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:36:47.208760: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:36:47.232998: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (70535, 25, 18), Y_train = (70535, 6)
  X_test  = (14092, 25, 18),  Y_test  = (14092, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:36:48.419869: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:48.424429: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:48.425337: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:48.427007: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:48.427907: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:48.428864: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:48.513676: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:48.514565: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:48.515357: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:36:48.516133: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:36:49.472206: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
221/221 - 2s - 9ms/step - loss: 0.2275 - val_loss: 0.2805
Epoch 2/100
221/221 - 1s - 3ms/step - loss: 0.1364 - val_loss: 0.2550
Epoch 3/100
221/221 - 1s - 3ms/step - loss: 0.1182 - val_loss: 0.2422
Epoch 4/100
221/221 - 1s - 3ms/step - loss: 0.1079 - val_loss: 0.2326
Epoch 5/100
221/221 - 1s - 3ms/step - loss: 0.1007 - val_loss: 0.2245
Epoch 6/100
221/221 - 1s - 3ms/step - loss: 0.0955 - val_loss: 0.2198
Epoch 7/100
221/221 - 1s - 3ms/step - loss: 0.0920 - val_loss: 0.2079
Epoch 8/100
221/221 - 1s - 3ms/step - loss: 0.0885 - val_loss: 0.2067
Epoch 9/100
221/221 - 1s - 3ms/step - loss: 0.0849 - val_loss: 0.2020
Epoch 10/100
221/221 - 1s - 3ms/step - loss: 0.0830 - val_loss: 0.1992
Epoch 11/100
221/221 - 1s - 2ms/step - loss: 0.0812 - val_loss: 0.2048
Epoch 12/100
221/221 - 1s - 2ms/step - loss: 0.0794 - val_loss: 0.2000
Epoch 13/100
221/221 - 1s - 3ms/step - loss: 0.0783 - val_loss: 0.1922
Epoch 14/100
221/221 - 1s - 2ms/step - loss: 0.0756 - val_loss: 0.1981
Epoch 15/100
221/221 - 1s - 3ms/step - loss: 0.0743 - val_loss: 0.1933
Epoch 16/100
221/221 - 1s - 3ms/step - loss: 0.0730 - val_loss: 0.1891
Epoch 17/100
221/221 - 1s - 3ms/step - loss: 0.0718 - val_loss: 0.1908
Epoch 18/100
221/221 - 1s - 3ms/step - loss: 0.0716 - val_loss: 0.1876
Epoch 19/100
221/221 - 1s - 3ms/step - loss: 0.0702 - val_loss: 0.1848
Epoch 20/100
221/221 - 1s - 3ms/step - loss: 0.0687 - val_loss: 0.1842
Epoch 21/100
221/221 - 1s - 3ms/step - loss: 0.0681 - val_loss: 0.1851
Epoch 22/100
221/221 - 1s - 3ms/step - loss: 0.0671 - val_loss: 0.1843
Epoch 23/100
221/221 - 1s - 3ms/step - loss: 0.0663 - val_loss: 0.1828
Epoch 24/100
221/221 - 1s - 3ms/step - loss: 0.0653 - val_loss: 0.1833
Epoch 25/100
221/221 - 1s - 2ms/step - loss: 0.0648 - val_loss: 0.1849
Epoch 26/100
221/221 - 1s - 3ms/step - loss: 0.0649 - val_loss: 0.1858
Epoch 27/100
221/221 - 1s - 3ms/step - loss: 0.0655 - val_loss: 0.1881
Epoch 28/100
221/221 - 1s - 3ms/step - loss: 0.0626 - val_loss: 0.1810
Epoch 29/100
221/221 - 1s - 3ms/step - loss: 0.0624 - val_loss: 0.1824
Epoch 30/100
221/221 - 1s - 3ms/step - loss: 0.0614 - val_loss: 0.1807
Epoch 31/100
221/221 - 1s - 3ms/step - loss: 0.0618 - val_loss: 0.1804
Epoch 32/100
221/221 - 1s - 3ms/step - loss: 0.0608 - val_loss: 0.1779
Epoch 33/100
221/221 - 1s - 3ms/step - loss: 0.0601 - val_loss: 0.1864
Epoch 34/100
221/221 - 1s - 3ms/step - loss: 0.0601 - val_loss: 0.1790
Epoch 35/100
221/221 - 1s - 3ms/step - loss: 0.0587 - val_loss: 0.1808
Epoch 36/100
221/221 - 1s - 3ms/step - loss: 0.0594 - val_loss: 0.1825
Epoch 37/100
221/221 - 1s - 2ms/step - loss: 0.0589 - val_loss: 0.1828
Epoch 38/100
221/221 - 1s - 2ms/step - loss: 0.0582 - val_loss: 0.1830
Epoch 39/100
221/221 - 1s - 3ms/step - loss: 0.0572 - val_loss: 0.1805
Epoch 40/100
221/221 - 1s - 3ms/step - loss: 0.0571 - val_loss: 0.1791
Epoch 41/100
221/221 - 1s - 3ms/step - loss: 0.0570 - val_loss: 0.1795
Epoch 42/100
221/221 - 1s - 3ms/step - loss: 0.0562 - val_loss: 0.1798
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4059
Per-joint RMSE: 0.4879 0.6873 0.3525 0.2441 0.2396 0.1920
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:37:14.810108: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:37:14.835602: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 08:37:15.695136: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:37:15.699624: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:37:15.700414: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:37:15.702233: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:37:15.703038: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:37:15.703789: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:37:15.782619: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:37:15.783535: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:37:15.784284: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:37:15.785019: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:37:16.077096: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.817817e-01  RMSE=5.308312e-01
  per-joint RMSE: 0.6063 0.9296 0.4624 0.2964 0.3045 0.2543
Residual LSTM:  MSE=1.647442e-01      RMSE=4.058870e-01
  per-joint RMSE: 0.4879 0.6873 0.3525 0.2441 0.2396 0.1920
Combined torque MSE=1.647442e-01     RMSE=4.058870e-01
  per-joint RMSE: 0.4879 0.6873 0.3525 0.2441 0.2396 0.1920
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400.npz --H 50 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400.json
H=50, n_dof=6, feature_dim=24
X_train: (68810, 50, 24)  Y_train: (68810, 6)
X_test : (13667, 50, 24)  Y_test : (13667, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:37:18.806065: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:37:18.830580: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (68810, 50, 24), Y_train = (68810, 6)
  X_test  = (13667, 50, 24),  Y_test  = (13667, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:37:20.351115: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:37:20.356000: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:37:20.357009: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:37:20.358842: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:37:20.359762: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:37:20.360651: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:37:20.454470: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:37:20.455339: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:37:20.456132: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:37:20.456924: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8969 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:37:21.589992: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
216/216 - 2s - 10ms/step - loss: 0.2259 - val_loss: 0.2538
Epoch 2/100
216/216 - 1s - 4ms/step - loss: 0.1339 - val_loss: 0.2306
Epoch 3/100
216/216 - 1s - 4ms/step - loss: 0.1168 - val_loss: 0.2184
Epoch 4/100
216/216 - 1s - 4ms/step - loss: 0.1068 - val_loss: 0.2099
Epoch 5/100
216/216 - 1s - 4ms/step - loss: 0.1003 - val_loss: 0.2058
Epoch 6/100
216/216 - 1s - 4ms/step - loss: 0.0952 - val_loss: 0.1996
Epoch 7/100
216/216 - 1s - 4ms/step - loss: 0.0914 - val_loss: 0.1997
Epoch 8/100
216/216 - 1s - 4ms/step - loss: 0.0887 - val_loss: 0.1949
Epoch 9/100
216/216 - 1s - 4ms/step - loss: 0.0862 - val_loss: 0.1931
Epoch 10/100
216/216 - 1s - 4ms/step - loss: 0.0843 - val_loss: 0.1978
Epoch 11/100
216/216 - 1s - 4ms/step - loss: 0.0815 - val_loss: 0.1948
Epoch 12/100
216/216 - 1s - 4ms/step - loss: 0.0788 - val_loss: 0.1906
Epoch 13/100
216/216 - 1s - 4ms/step - loss: 0.0768 - val_loss: 0.1867
Epoch 14/100
216/216 - 1s - 4ms/step - loss: 0.0753 - val_loss: 0.1894
Epoch 15/100
216/216 - 1s - 4ms/step - loss: 0.0742 - val_loss: 0.1886
Epoch 16/100
216/216 - 1s - 4ms/step - loss: 0.0726 - val_loss: 0.1849
Epoch 17/100
216/216 - 1s - 4ms/step - loss: 0.0715 - val_loss: 0.1850
Epoch 18/100
216/216 - 1s - 4ms/step - loss: 0.0702 - val_loss: 0.1819
Epoch 19/100
216/216 - 1s - 4ms/step - loss: 0.0690 - val_loss: 0.1855
Epoch 20/100
216/216 - 1s - 4ms/step - loss: 0.0680 - val_loss: 0.1835
Epoch 21/100
216/216 - 1s - 4ms/step - loss: 0.0673 - val_loss: 0.1815
Epoch 22/100
216/216 - 1s - 4ms/step - loss: 0.0655 - val_loss: 0.1810
Epoch 23/100
216/216 - 1s - 4ms/step - loss: 0.0656 - val_loss: 0.1785
Epoch 24/100
216/216 - 1s - 4ms/step - loss: 0.0651 - val_loss: 0.1827
Epoch 25/100
216/216 - 1s - 4ms/step - loss: 0.0639 - val_loss: 0.1774
Epoch 26/100
216/216 - 1s - 4ms/step - loss: 0.0635 - val_loss: 0.1801
Epoch 27/100
216/216 - 1s - 4ms/step - loss: 0.0626 - val_loss: 0.1808
Epoch 28/100
216/216 - 1s - 4ms/step - loss: 0.0621 - val_loss: 0.1744
Epoch 29/100
216/216 - 1s - 4ms/step - loss: 0.0613 - val_loss: 0.1764
Epoch 30/100
216/216 - 1s - 4ms/step - loss: 0.0607 - val_loss: 0.1778
Epoch 31/100
216/216 - 1s - 4ms/step - loss: 0.0608 - val_loss: 0.1766
Epoch 32/100
216/216 - 1s - 4ms/step - loss: 0.0595 - val_loss: 0.1753
Epoch 33/100
216/216 - 1s - 4ms/step - loss: 0.0589 - val_loss: 0.1767
Epoch 34/100
216/216 - 1s - 4ms/step - loss: 0.0585 - val_loss: 0.1772
Epoch 35/100
216/216 - 1s - 4ms/step - loss: 0.0582 - val_loss: 0.1770
Epoch 36/100
216/216 - 1s - 4ms/step - loss: 0.0572 - val_loss: 0.1743
Epoch 37/100
216/216 - 1s - 4ms/step - loss: 0.0567 - val_loss: 0.1780
Epoch 38/100
216/216 - 1s - 4ms/step - loss: 0.0569 - val_loss: 0.1775
Epoch 39/100
216/216 - 1s - 4ms/step - loss: 0.0561 - val_loss: 0.1770
Epoch 40/100
216/216 - 1s - 4ms/step - loss: 0.0559 - val_loss: 0.1722
Epoch 41/100
216/216 - 1s - 4ms/step - loss: 0.0562 - val_loss: 0.1791
Epoch 42/100
216/216 - 1s - 4ms/step - loss: 0.0551 - val_loss: 0.1745
Epoch 43/100
216/216 - 1s - 4ms/step - loss: 0.0540 - val_loss: 0.1717
Epoch 44/100
216/216 - 1s - 4ms/step - loss: 0.0538 - val_loss: 0.1748
Epoch 45/100
216/216 - 1s - 4ms/step - loss: 0.0537 - val_loss: 0.1740
Epoch 46/100
216/216 - 1s - 4ms/step - loss: 0.0536 - val_loss: 0.1751
Epoch 47/100
216/216 - 1s - 4ms/step - loss: 0.0522 - val_loss: 0.1781
Epoch 48/100
216/216 - 1s - 4ms/step - loss: 0.0517 - val_loss: 0.1739
Epoch 49/100
216/216 - 1s - 4ms/step - loss: 0.0515 - val_loss: 0.1730
Epoch 50/100
216/216 - 1s - 4ms/step - loss: 0.0509 - val_loss: 0.1749
Epoch 51/100
216/216 - 1s - 4ms/step - loss: 0.0500 - val_loss: 0.1716
Epoch 52/100
216/216 - 1s - 4ms/step - loss: 0.0494 - val_loss: 0.1735
Epoch 53/100
216/216 - 1s - 4ms/step - loss: 0.0499 - val_loss: 0.1731
Epoch 54/100
216/216 - 1s - 4ms/step - loss: 0.0495 - val_loss: 0.1776
Epoch 55/100
216/216 - 1s - 4ms/step - loss: 0.0483 - val_loss: 0.1732
Epoch 56/100
216/216 - 1s - 4ms/step - loss: 0.0481 - val_loss: 0.1760
Epoch 57/100
216/216 - 1s - 4ms/step - loss: 0.0480 - val_loss: 0.1742
Epoch 58/100
216/216 - 1s - 4ms/step - loss: 0.0470 - val_loss: 0.1736
Epoch 59/100
216/216 - 1s - 4ms/step - loss: 0.0469 - val_loss: 0.1725
Epoch 60/100
216/216 - 1s - 4ms/step - loss: 0.0466 - val_loss: 0.1737
Epoch 61/100
216/216 - 1s - 4ms/step - loss: 0.0462 - val_loss: 0.1677
Epoch 62/100
216/216 - 1s - 4ms/step - loss: 0.0456 - val_loss: 0.1690
Epoch 63/100
216/216 - 1s - 4ms/step - loss: 0.0456 - val_loss: 0.1679
Epoch 64/100
216/216 - 1s - 4ms/step - loss: 0.0451 - val_loss: 0.1675
Epoch 65/100
216/216 - 1s - 4ms/step - loss: 0.0448 - val_loss: 0.1690
Epoch 66/100
216/216 - 1s - 4ms/step - loss: 0.0443 - val_loss: 0.1696
Epoch 67/100
216/216 - 1s - 4ms/step - loss: 0.0439 - val_loss: 0.1675
Epoch 68/100
216/216 - 1s - 4ms/step - loss: 0.0438 - val_loss: 0.1691
Epoch 69/100
216/216 - 1s - 4ms/step - loss: 0.0432 - val_loss: 0.1692
Epoch 70/100
216/216 - 1s - 4ms/step - loss: 0.0431 - val_loss: 0.1679
Epoch 71/100
216/216 - 1s - 4ms/step - loss: 0.0426 - val_loss: 0.1702
Epoch 72/100
216/216 - 1s - 4ms/step - loss: 0.0424 - val_loss: 0.1706
Epoch 73/100
216/216 - 1s - 4ms/step - loss: 0.0421 - val_loss: 0.1663
Epoch 74/100
216/216 - 1s - 4ms/step - loss: 0.0421 - val_loss: 0.1739
Epoch 75/100
216/216 - 1s - 4ms/step - loss: 0.0419 - val_loss: 0.1671
Epoch 76/100
216/216 - 1s - 4ms/step - loss: 0.0416 - val_loss: 0.1678
Epoch 77/100
216/216 - 1s - 4ms/step - loss: 0.0413 - val_loss: 0.1684
Epoch 78/100
216/216 - 1s - 4ms/step - loss: 0.0412 - val_loss: 0.1682
Epoch 79/100
216/216 - 1s - 4ms/step - loss: 0.0407 - val_loss: 0.1634
Epoch 80/100
216/216 - 1s - 4ms/step - loss: 0.0405 - val_loss: 0.1679
Epoch 81/100
216/216 - 1s - 4ms/step - loss: 0.0402 - val_loss: 0.1695
Epoch 82/100
216/216 - 1s - 4ms/step - loss: 0.0398 - val_loss: 0.1660
Epoch 83/100
216/216 - 1s - 4ms/step - loss: 0.0397 - val_loss: 0.1649
Epoch 84/100
216/216 - 1s - 4ms/step - loss: 0.0397 - val_loss: 0.1651
Epoch 85/100
216/216 - 1s - 4ms/step - loss: 0.0390 - val_loss: 0.1664
Epoch 86/100
216/216 - 1s - 4ms/step - loss: 0.0391 - val_loss: 0.1671
Epoch 87/100
216/216 - 1s - 4ms/step - loss: 0.0392 - val_loss: 0.1669
Epoch 88/100
216/216 - 1s - 4ms/step - loss: 0.0386 - val_loss: 0.1656
Epoch 89/100
216/216 - 1s - 4ms/step - loss: 0.0386 - val_loss: 0.1599
Epoch 90/100
216/216 - 1s - 4ms/step - loss: 0.0384 - val_loss: 0.1645
Epoch 91/100
216/216 - 1s - 4ms/step - loss: 0.0378 - val_loss: 0.1622
Epoch 92/100
216/216 - 1s - 4ms/step - loss: 0.0377 - val_loss: 0.1638
Epoch 93/100
216/216 - 1s - 4ms/step - loss: 0.0377 - val_loss: 0.1645
Epoch 94/100
216/216 - 1s - 4ms/step - loss: 0.0373 - val_loss: 0.1635
Epoch 95/100
216/216 - 1s - 4ms/step - loss: 0.0374 - val_loss: 0.1664
Epoch 96/100
216/216 - 1s - 4ms/step - loss: 0.0378 - val_loss: 0.1650
Epoch 97/100
216/216 - 1s - 4ms/step - loss: 0.0370 - val_loss: 0.1613
Epoch 98/100
216/216 - 1s - 4ms/step - loss: 0.0368 - val_loss: 0.1623
Epoch 99/100
216/216 - 1s - 4ms/step - loss: 0.0364 - val_loss: 0.1642
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3905
Per-joint RMSE: 0.4550 0.6557 0.3546 0.2484 0.2350 0.1883
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:38:46.935448: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:38:46.959822: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 08:38:47.825773: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:38:47.830336: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:38:47.831225: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:38:47.832912: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:38:47.833765: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:38:47.834552: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:38:47.912890: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:38:47.913800: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:38:47.914617: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:38:47.915417: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:38:48.214331: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.871260e-01  RMSE=5.358414e-01
  per-joint RMSE: 0.6111 0.9405 0.4660 0.2987 0.3066 0.2538
Residual LSTM:  MSE=1.525075e-01      RMSE=3.905222e-01
  per-joint RMSE: 0.4550 0.6557 0.3546 0.2484 0.2350 0.1883
Combined torque MSE=1.525075e-01     RMSE=3.905222e-01
  per-joint RMSE: 0.4550 0.6557 0.3546 0.2484 0.2350 0.1883
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400.npz --H 50 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400.json
H=50, n_dof=6, feature_dim=6
X_train: (68810, 50, 6)  Y_train: (68810, 6)
X_test : (13667, 50, 6)  Y_test : (13667, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:38:50.608140: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:38:50.632482: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (68810, 50, 6), Y_train = (68810, 6)
  X_test  = (13667, 50, 6),  Y_test  = (13667, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:38:51.830012: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:38:51.834720: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:38:51.838464: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:38:51.840230: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:38:51.841027: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:38:51.841771: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:38:51.925610: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:38:51.926599: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:38:51.927461: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:38:51.928337: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:38:52.881426: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
216/216 - 2s - 10ms/step - loss: 0.6350 - val_loss: 0.6904
Epoch 2/100
216/216 - 1s - 4ms/step - loss: 0.3939 - val_loss: 0.7187
Epoch 3/100
216/216 - 1s - 4ms/step - loss: 0.3015 - val_loss: 0.5227
Epoch 4/100
216/216 - 1s - 4ms/step - loss: 0.2593 - val_loss: 0.6593
Epoch 5/100
216/216 - 1s - 4ms/step - loss: 0.2325 - val_loss: 0.6598
Epoch 6/100
216/216 - 1s - 4ms/step - loss: 0.2216 - val_loss: 0.6457
Epoch 7/100
216/216 - 1s - 4ms/step - loss: 0.1964 - val_loss: 0.6728
Epoch 8/100
216/216 - 1s - 4ms/step - loss: 0.2101 - val_loss: 0.6916
Epoch 9/100
216/216 - 1s - 4ms/step - loss: 0.1931 - val_loss: 0.7204
Epoch 10/100
216/216 - 1s - 4ms/step - loss: 0.1892 - val_loss: 0.6765
Epoch 11/100
216/216 - 1s - 4ms/step - loss: 0.1836 - val_loss: 0.7067
Epoch 12/100
216/216 - 1s - 4ms/step - loss: 0.1948 - val_loss: 0.6549
Epoch 13/100
216/216 - 1s - 4ms/step - loss: 0.1899 - val_loss: 0.7060
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4559
Per-joint RMSE: 0.5802 0.7118 0.4022 0.2781 0.2760 0.2971
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:39:05.263228: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:39:05.288345: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 08:39:06.148152: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:06.152719: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:06.153603: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:06.155239: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:06.156039: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:06.156778: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:06.240480: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:06.241407: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:06.242158: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:06.242884: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:39:06.536772: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.871260e-01  RMSE=5.358414e-01
  per-joint RMSE: 0.6111 0.9405 0.4660 0.2987 0.3066 0.2538
Residual LSTM:  MSE=2.078072e-01      RMSE=4.558588e-01
  per-joint RMSE: 0.5802 0.7118 0.4022 0.2781 0.2760 0.2971
Combined torque MSE=2.078072e-01     RMSE=4.558588e-01
  per-joint RMSE: 0.5802 0.7118 0.4022 0.2781 0.2760 0.2971
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400.npz --H 50 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400.json
H=50, n_dof=6, feature_dim=18
X_train: (68810, 50, 18)  Y_train: (68810, 6)
X_test : (13667, 50, 18)  Y_test : (13667, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:39:09.147479: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:39:09.172071: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (68810, 50, 18), Y_train = (68810, 6)
  X_test  = (13667, 50, 18),  Y_test  = (13667, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:39:10.621452: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:10.626305: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:10.627226: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:10.629019: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:10.629931: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:10.630785: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:10.720563: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:10.721483: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:10.722293: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:10.723090: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8969 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:39:11.784313: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
216/216 - 2s - 10ms/step - loss: 0.2595 - val_loss: 0.3205
Epoch 2/100
216/216 - 1s - 4ms/step - loss: 0.1559 - val_loss: 0.3055
Epoch 3/100
216/216 - 1s - 4ms/step - loss: 0.1380 - val_loss: 0.2900
Epoch 4/100
216/216 - 1s - 4ms/step - loss: 0.1272 - val_loss: 0.2810
Epoch 5/100
216/216 - 1s - 4ms/step - loss: 0.1195 - val_loss: 0.2736
Epoch 6/100
216/216 - 1s - 4ms/step - loss: 0.1147 - val_loss: 0.2712
Epoch 7/100
216/216 - 1s - 4ms/step - loss: 0.1106 - val_loss: 0.2767
Epoch 8/100
216/216 - 1s - 4ms/step - loss: 0.1067 - val_loss: 0.2698
Epoch 9/100
216/216 - 1s - 4ms/step - loss: 0.1060 - val_loss: 0.2740
Epoch 10/100
216/216 - 1s - 4ms/step - loss: 0.1016 - val_loss: 0.2690
Epoch 11/100
216/216 - 1s - 4ms/step - loss: 0.0983 - val_loss: 0.2691
Epoch 12/100
216/216 - 1s - 4ms/step - loss: 0.0981 - val_loss: 0.2695
Epoch 13/100
216/216 - 1s - 4ms/step - loss: 0.0972 - val_loss: 0.2648
Epoch 14/100
216/216 - 1s - 4ms/step - loss: 0.0937 - val_loss: 0.2652
Epoch 15/100
216/216 - 1s - 4ms/step - loss: 0.0925 - val_loss: 0.2667
Epoch 16/100
216/216 - 1s - 4ms/step - loss: 0.0912 - val_loss: 0.2586
Epoch 17/100
216/216 - 1s - 4ms/step - loss: 0.0878 - val_loss: 0.2606
Epoch 18/100
216/216 - 1s - 4ms/step - loss: 0.0885 - val_loss: 0.2565
Epoch 19/100
216/216 - 1s - 4ms/step - loss: 0.0861 - val_loss: 0.2566
Epoch 20/100
216/216 - 1s - 4ms/step - loss: 0.0849 - val_loss: 0.2590
Epoch 21/100
216/216 - 1s - 4ms/step - loss: 0.0847 - val_loss: 0.2556
Epoch 22/100
216/216 - 1s - 4ms/step - loss: 0.0838 - val_loss: 0.2633
Epoch 23/100
216/216 - 1s - 4ms/step - loss: 0.0830 - val_loss: 0.2620
Epoch 24/100
216/216 - 1s - 4ms/step - loss: 0.0815 - val_loss: 0.2654
Epoch 25/100
216/216 - 1s - 4ms/step - loss: 0.0807 - val_loss: 0.2613
Epoch 26/100
216/216 - 1s - 4ms/step - loss: 0.0802 - val_loss: 0.2592
Epoch 27/100
216/216 - 1s - 4ms/step - loss: 0.0790 - val_loss: 0.2570
Epoch 28/100
216/216 - 1s - 4ms/step - loss: 0.0777 - val_loss: 0.2612
Epoch 29/100
216/216 - 1s - 4ms/step - loss: 0.0764 - val_loss: 0.2623
Epoch 30/100
216/216 - 1s - 4ms/step - loss: 0.0769 - val_loss: 0.2602
Epoch 31/100
216/216 - 1s - 4ms/step - loss: 0.0752 - val_loss: 0.2586
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4599
Per-joint RMSE: 0.5486 0.7718 0.3967 0.2738 0.2900 0.2361
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:39:39.736867: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:39:39.762511: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 08:39:40.606624: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:40.611333: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:40.612128: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:40.613997: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:40.614796: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:40.615534: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:40.697247: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:40.698163: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:40.698906: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:40.699634: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:39:40.995200: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.871260e-01  RMSE=5.358414e-01
  per-joint RMSE: 0.6111 0.9405 0.4660 0.2987 0.3066 0.2538
Residual LSTM:  MSE=2.114824e-01      RMSE=4.598721e-01
  per-joint RMSE: 0.5486 0.7718 0.3967 0.2738 0.2900 0.2361
Combined torque MSE=2.114824e-01     RMSE=4.598721e-01
  per-joint RMSE: 0.5486 0.7718 0.3967 0.2738 0.2900 0.2361
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400.npz --H 50 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400.json
H=50, n_dof=6, feature_dim=18
X_train: (68810, 50, 18)  Y_train: (68810, 6)
X_test : (13667, 50, 18)  Y_test : (13667, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:39:43.640690: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:39:43.664656: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (68810, 50, 18), Y_train = (68810, 6)
  X_test  = (13667, 50, 18),  Y_test  = (13667, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:39:45.095354: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:45.100008: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:45.100914: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:45.102799: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:45.103765: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:45.104663: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:45.188431: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:45.189330: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:45.190131: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:39:45.190934: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8969 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:39:46.254906: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
216/216 - 2s - 10ms/step - loss: 0.2279 - val_loss: 0.2666
Epoch 2/100
216/216 - 1s - 4ms/step - loss: 0.1362 - val_loss: 0.2344
Epoch 3/100
216/216 - 1s - 4ms/step - loss: 0.1191 - val_loss: 0.2155
Epoch 4/100
216/216 - 1s - 4ms/step - loss: 0.1107 - val_loss: 0.2048
Epoch 5/100
216/216 - 1s - 4ms/step - loss: 0.1018 - val_loss: 0.2032
Epoch 6/100
216/216 - 1s - 4ms/step - loss: 0.0957 - val_loss: 0.2040
Epoch 7/100
216/216 - 1s - 4ms/step - loss: 0.0922 - val_loss: 0.1999
Epoch 8/100
216/216 - 1s - 4ms/step - loss: 0.0893 - val_loss: 0.1981
Epoch 9/100
216/216 - 1s - 4ms/step - loss: 0.0857 - val_loss: 0.1962
Epoch 10/100
216/216 - 1s - 4ms/step - loss: 0.0835 - val_loss: 0.1903
Epoch 11/100
216/216 - 1s - 4ms/step - loss: 0.0808 - val_loss: 0.1888
Epoch 12/100
216/216 - 1s - 4ms/step - loss: 0.0789 - val_loss: 0.1902
Epoch 13/100
216/216 - 1s - 4ms/step - loss: 0.0775 - val_loss: 0.1889
Epoch 14/100
216/216 - 1s - 4ms/step - loss: 0.0761 - val_loss: 0.1851
Epoch 15/100
216/216 - 1s - 4ms/step - loss: 0.0747 - val_loss: 0.1850
Epoch 16/100
216/216 - 1s - 4ms/step - loss: 0.0731 - val_loss: 0.1841
Epoch 17/100
216/216 - 1s - 4ms/step - loss: 0.0720 - val_loss: 0.1848
Epoch 18/100
216/216 - 1s - 4ms/step - loss: 0.0701 - val_loss: 0.1878
Epoch 19/100
216/216 - 1s - 4ms/step - loss: 0.0692 - val_loss: 0.1860
Epoch 20/100
216/216 - 1s - 4ms/step - loss: 0.0684 - val_loss: 0.1860
Epoch 21/100
216/216 - 1s - 4ms/step - loss: 0.0678 - val_loss: 0.1849
Epoch 22/100
216/216 - 1s - 4ms/step - loss: 0.0669 - val_loss: 0.1842
Epoch 23/100
216/216 - 1s - 4ms/step - loss: 0.0663 - val_loss: 0.1817
Epoch 24/100
216/216 - 1s - 4ms/step - loss: 0.0653 - val_loss: 0.1841
Epoch 25/100
216/216 - 1s - 4ms/step - loss: 0.0645 - val_loss: 0.1808
Epoch 26/100
216/216 - 1s - 4ms/step - loss: 0.0637 - val_loss: 0.1789
Epoch 27/100
216/216 - 1s - 4ms/step - loss: 0.0631 - val_loss: 0.1774
Epoch 28/100
216/216 - 1s - 4ms/step - loss: 0.0631 - val_loss: 0.1802
Epoch 29/100
216/216 - 1s - 4ms/step - loss: 0.0617 - val_loss: 0.1786
Epoch 30/100
216/216 - 1s - 4ms/step - loss: 0.0614 - val_loss: 0.1773
Epoch 31/100
216/216 - 1s - 4ms/step - loss: 0.0610 - val_loss: 0.1789
Epoch 32/100
216/216 - 1s - 4ms/step - loss: 0.0599 - val_loss: 0.1783
Epoch 33/100
216/216 - 1s - 4ms/step - loss: 0.0598 - val_loss: 0.1793
Epoch 34/100
216/216 - 1s - 4ms/step - loss: 0.0589 - val_loss: 0.1761
Epoch 35/100
216/216 - 1s - 4ms/step - loss: 0.0587 - val_loss: 0.1793
Epoch 36/100
216/216 - 1s - 4ms/step - loss: 0.0582 - val_loss: 0.1792
Epoch 37/100
216/216 - 1s - 4ms/step - loss: 0.0594 - val_loss: 0.1741
Epoch 38/100
216/216 - 1s - 4ms/step - loss: 0.0574 - val_loss: 0.1801
Epoch 39/100
216/216 - 1s - 4ms/step - loss: 0.0568 - val_loss: 0.1788
Epoch 40/100
216/216 - 1s - 4ms/step - loss: 0.0563 - val_loss: 0.1794
Epoch 41/100
216/216 - 1s - 4ms/step - loss: 0.0556 - val_loss: 0.1786
Epoch 42/100
216/216 - 1s - 4ms/step - loss: 0.0554 - val_loss: 0.1768
Epoch 43/100
216/216 - 1s - 4ms/step - loss: 0.0550 - val_loss: 0.1768
Epoch 44/100
216/216 - 1s - 4ms/step - loss: 0.0553 - val_loss: 0.1778
Epoch 45/100
216/216 - 1s - 4ms/step - loss: 0.0546 - val_loss: 0.1793
Epoch 46/100
216/216 - 1s - 4ms/step - loss: 0.0539 - val_loss: 0.1777
Epoch 47/100
216/216 - 1s - 4ms/step - loss: 0.0531 - val_loss: 0.1818
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3940
Per-joint RMSE: 0.4650 0.6557 0.3597 0.2514 0.2432 0.1828
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:40:27.924951: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:40:27.950033: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s0_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 08:40:28.824147: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:40:28.828816: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:40:28.829623: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:40:28.831524: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:40:28.832326: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:40:28.833143: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:40:28.916914: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:40:28.917852: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:40:28.918667: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:40:28.919394: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:40:29.213098: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.871260e-01  RMSE=5.358414e-01
  per-joint RMSE: 0.6111 0.9405 0.4660 0.2987 0.3066 0.2538
Residual LSTM:  MSE=1.552224e-01      RMSE=3.939827e-01
  per-joint RMSE: 0.4650 0.6557 0.3597 0.2514 0.2432 0.1828
Combined torque MSE=1.552224e-01     RMSE=3.939827e-01
  per-joint RMSE: 0.4650 0.6557 0.3597 0.2514 0.2432 0.1828
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=1                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz                                ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p2_seed2_dataset.npz -t structured -s 1 -r 0 --hp_preset fast_debug --epochs 400 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400.jax' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 400, 'lagrangian_type': <function structured_lagrangian_fn at 0x78c89878c1f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K150_tf0p2_seed2_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p2_seed2_dataset.npz
   dt ≈ 0.02208891656001752
  dof = 6
  Train trajectories = 120
  Test trajectories  = 30
  Train samples = 72344
  Test samples  = 14539
################################################

2026-01-22 08:40:33.837866: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400 | type=structured | dof=6
################################################
2026-01-22 08:40:37.000095: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:40:37.000134: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:40:37.000142: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:40:37.000170: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:40:37.000175: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:40:37.000190: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:40:37.000226: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:40:37.000232: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:40:37.000247: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:40:37.000252: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.3s, Loss=1.05e+01, Inv=1.05e+01, For=1.18e+02, Power=2.44e+00
  [eval] test_mse=1.308e+00  (n=14539)
Epoch 00050: Time=  16.1s, Loss=2.71e+00, Inv=2.71e+00, For=7.74e+01, Power=1.37e+00
Epoch 00100: Time=  25.3s, Loss=2.46e+00, Inv=2.46e+00, For=1.01e+02, Power=1.26e+00
Epoch 00150: Time=  34.4s, Loss=2.36e+00, Inv=2.36e+00, For=1.41e+02, Power=1.22e+00
Epoch 00200: Time=  43.6s, Loss=2.30e+00, Inv=2.30e+00, For=1.84e+02, Power=1.19e+00
  [eval] test_mse=1.402e+00  (n=14539)
Epoch 00250: Time=  53.1s, Loss=2.27e+00, Inv=2.27e+00, For=2.31e+02, Power=1.17e+00
Epoch 00300: Time=  62.9s, Loss=2.24e+00, Inv=2.24e+00, For=2.72e+02, Power=1.17e+00
Epoch 00350: Time=  72.8s, Loss=2.22e+00, Inv=2.22e+00, For=3.11e+02, Power=1.16e+00
Epoch 00400: Time=  82.4s, Loss=2.20e+00, Inv=2.20e+00, For=3.54e+02, Power=1.15e+00
  [eval] test_mse=1.615e+00  (n=14539)
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400
Torque MSE  = 2.692e-01
Torque RMSE = 5.188e-01
Per-joint MSE : 3.657e-01 7.834e-01 2.216e-01 8.456e-02 9.995e-02 5.974e-02
Per-joint RMSE: 6.047e-01 8.851e-01 4.708e-01 2.908e-01 3.161e-01 2.444e-01
Comp Time per Sample = 2.276e-08s / 43940667.0Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p2_seed2_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p2_seed2_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400.jax
Detected n_dof=6 (seed=1)
2026-01-22 08:42:01.566947: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 120 trajectories
2026-01-22 08:42:02.891160: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:42:02.891173: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:42:04.480868: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:42:04.480881: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:42:05.951922: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/120
2026-01-22 08:42:07.107781: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:42:08.272441: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:42:08.272474: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:42:08.272479: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 50/120
  done 75/120
2026-01-22 08:42:09.786269: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:42:11.014426: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:42:12.289449: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 100/120
  done 120/120

Exporting split=test: 30 trajectories
  done 25/30
  done 30/30

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400.npz --H 25 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400.json
H=25, n_dof=6, feature_dim=24
X_train: (70535, 25, 24)  Y_train: (70535, 6)
X_test : (14092, 25, 24)  Y_test : (14092, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:42:16.197996: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:42:16.223799: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (70535, 25, 24), Y_train = (70535, 6)
  X_test  = (14092, 25, 24),  Y_test  = (14092, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:42:17.466257: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:17.470997: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:17.471925: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:17.473512: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:17.474447: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:17.475206: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:17.561196: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:17.562077: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:17.562954: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:17.563738: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8975 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:42:18.533971: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
221/221 - 2s - 9ms/step - loss: 0.2252 - val_loss: 0.2821
Epoch 2/100
221/221 - 1s - 3ms/step - loss: 0.1307 - val_loss: 0.2530
Epoch 3/100
221/221 - 1s - 3ms/step - loss: 0.1147 - val_loss: 0.2446
Epoch 4/100
221/221 - 1s - 3ms/step - loss: 0.1053 - val_loss: 0.2244
Epoch 5/100
221/221 - 1s - 3ms/step - loss: 0.0972 - val_loss: 0.2198
Epoch 6/100
221/221 - 1s - 3ms/step - loss: 0.0935 - val_loss: 0.2064
Epoch 7/100
221/221 - 1s - 3ms/step - loss: 0.0901 - val_loss: 0.2030
Epoch 8/100
221/221 - 1s - 3ms/step - loss: 0.0864 - val_loss: 0.1960
Epoch 9/100
221/221 - 1s - 3ms/step - loss: 0.0853 - val_loss: 0.1949
Epoch 10/100
221/221 - 1s - 3ms/step - loss: 0.0813 - val_loss: 0.1869
Epoch 11/100
221/221 - 1s - 3ms/step - loss: 0.0800 - val_loss: 0.1878
Epoch 12/100
221/221 - 1s - 3ms/step - loss: 0.0777 - val_loss: 0.1862
Epoch 13/100
221/221 - 1s - 3ms/step - loss: 0.0759 - val_loss: 0.1831
Epoch 14/100
221/221 - 1s - 2ms/step - loss: 0.0752 - val_loss: 0.1833
Epoch 15/100
221/221 - 1s - 3ms/step - loss: 0.0729 - val_loss: 0.1790
Epoch 16/100
221/221 - 1s - 3ms/step - loss: 0.0724 - val_loss: 0.1751
Epoch 17/100
221/221 - 1s - 2ms/step - loss: 0.0706 - val_loss: 0.1756
Epoch 18/100
221/221 - 1s - 2ms/step - loss: 0.0695 - val_loss: 0.1772
Epoch 19/100
221/221 - 1s - 3ms/step - loss: 0.0694 - val_loss: 0.1748
Epoch 20/100
221/221 - 1s - 3ms/step - loss: 0.0684 - val_loss: 0.1741
Epoch 21/100
221/221 - 1s - 2ms/step - loss: 0.0670 - val_loss: 0.1742
Epoch 22/100
221/221 - 1s - 2ms/step - loss: 0.0669 - val_loss: 0.1748
Epoch 23/100
221/221 - 1s - 3ms/step - loss: 0.0657 - val_loss: 0.1711
Epoch 24/100
221/221 - 1s - 3ms/step - loss: 0.0648 - val_loss: 0.1687
Epoch 25/100
221/221 - 1s - 3ms/step - loss: 0.0636 - val_loss: 0.1655
Epoch 26/100
221/221 - 1s - 3ms/step - loss: 0.0634 - val_loss: 0.1679
Epoch 27/100
221/221 - 1s - 3ms/step - loss: 0.0630 - val_loss: 0.1645
Epoch 28/100
221/221 - 1s - 2ms/step - loss: 0.0620 - val_loss: 0.1684
Epoch 29/100
221/221 - 1s - 2ms/step - loss: 0.0615 - val_loss: 0.1705
Epoch 30/100
221/221 - 1s - 2ms/step - loss: 0.0606 - val_loss: 0.1707
Epoch 31/100
221/221 - 1s - 2ms/step - loss: 0.0603 - val_loss: 0.1705
Epoch 32/100
221/221 - 1s - 2ms/step - loss: 0.0605 - val_loss: 0.1703
Epoch 33/100
221/221 - 1s - 3ms/step - loss: 0.0595 - val_loss: 0.1705
Epoch 34/100
221/221 - 1s - 2ms/step - loss: 0.0594 - val_loss: 0.1674
Epoch 35/100
221/221 - 1s - 2ms/step - loss: 0.0579 - val_loss: 0.1707
Epoch 36/100
221/221 - 1s - 2ms/step - loss: 0.0578 - val_loss: 0.1679
Epoch 37/100
221/221 - 1s - 2ms/step - loss: 0.0586 - val_loss: 0.1686
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3731
Per-joint RMSE: 0.4600 0.5804 0.3520 0.2504 0.2433 0.2027
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:42:40.950612: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:42:40.975283: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 08:42:41.834675: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:41.839242: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:41.840112: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:41.841877: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:41.842670: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:41.843414: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:41.922069: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:41.922912: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:41.923660: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:41.924384: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:42:42.221731: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.732198e-01  RMSE=5.227043e-01
  per-joint RMSE: 0.6089 0.8933 0.4714 0.2929 0.3194 0.2460
Residual LSTM:  MSE=1.392325e-01      RMSE=3.731387e-01
  per-joint RMSE: 0.4600 0.5804 0.3520 0.2504 0.2433 0.2027
Combined torque MSE=1.392325e-01     RMSE=3.731387e-01
  per-joint RMSE: 0.4600 0.5804 0.3520 0.2504 0.2433 0.2027
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400.npz --H 25 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400.json
H=25, n_dof=6, feature_dim=6
X_train: (70535, 25, 6)  Y_train: (70535, 6)
X_test : (14092, 25, 6)  Y_test : (14092, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:42:44.535463: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:42:44.559674: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (70535, 25, 6), Y_train = (70535, 6)
  X_test  = (14092, 25, 6),  Y_test  = (14092, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:42:45.634160: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:45.638714: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:45.639500: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:45.641370: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:45.642152: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:45.642889: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:45.729018: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:45.729969: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:45.730731: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:45.731488: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:42:46.681425: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
221/221 - 2s - 9ms/step - loss: 0.6918 - val_loss: 0.6994
Epoch 2/100
221/221 - 1s - 3ms/step - loss: 0.4611 - val_loss: 0.6748
Epoch 3/100
221/221 - 1s - 3ms/step - loss: 0.3807 - val_loss: 0.6778
Epoch 4/100
221/221 - 1s - 2ms/step - loss: 0.3076 - val_loss: 0.7103
Epoch 5/100
221/221 - 1s - 3ms/step - loss: 0.2601 - val_loss: 0.7215
Epoch 6/100
221/221 - 1s - 3ms/step - loss: 0.2343 - val_loss: 0.6498
Epoch 7/100
221/221 - 1s - 3ms/step - loss: 0.2338 - val_loss: 0.7119
Epoch 8/100
221/221 - 1s - 3ms/step - loss: 0.2283 - val_loss: 0.6556
Epoch 9/100
221/221 - 1s - 3ms/step - loss: 0.2015 - val_loss: 0.7714
Epoch 10/100
221/221 - 1s - 3ms/step - loss: 0.1885 - val_loss: 0.7550
Epoch 11/100
221/221 - 1s - 3ms/step - loss: 0.1530 - val_loss: 0.7114
Epoch 12/100
221/221 - 1s - 2ms/step - loss: 0.1533 - val_loss: 0.7331
Epoch 13/100
221/221 - 1s - 3ms/step - loss: 0.1451 - val_loss: 0.7329
Epoch 14/100
221/221 - 1s - 3ms/step - loss: 0.1384 - val_loss: 0.7694
Epoch 15/100
221/221 - 1s - 3ms/step - loss: 0.1732 - val_loss: 0.7168
Epoch 16/100
221/221 - 1s - 3ms/step - loss: 0.1416 - val_loss: 0.7094
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4480
Per-joint RMSE: 0.5512 0.7194 0.4035 0.2637 0.2854 0.2627
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:42:57.379776: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:42:57.404877: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 08:42:58.244880: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:58.249784: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:58.250707: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:58.252473: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:58.253393: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:58.254260: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:58.346078: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:58.346974: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:58.347771: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:42:58.348563: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:42:58.643660: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.732198e-01  RMSE=5.227043e-01
  per-joint RMSE: 0.6089 0.8933 0.4714 0.2929 0.3194 0.2460
Residual LSTM:  MSE=2.006878e-01      RMSE=4.479819e-01
  per-joint RMSE: 0.5512 0.7194 0.4035 0.2637 0.2854 0.2627
Combined torque MSE=2.006878e-01     RMSE=4.479819e-01
  per-joint RMSE: 0.5512 0.7194 0.4035 0.2637 0.2854 0.2627
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400.npz --H 25 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400.json
H=25, n_dof=6, feature_dim=18
X_train: (70535, 25, 18)  Y_train: (70535, 6)
X_test : (14092, 25, 18)  Y_test : (14092, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:43:01.083526: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:43:01.107723: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (70535, 25, 18), Y_train = (70535, 6)
  X_test  = (14092, 25, 18),  Y_test  = (14092, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:43:02.285673: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:02.290511: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:02.291420: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:02.293066: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:02.293976: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:02.294845: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:02.375701: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:02.376695: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:02.377485: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:02.378279: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:43:03.339675: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
221/221 - 2s - 9ms/step - loss: 0.2559 - val_loss: 0.3454
Epoch 2/100
221/221 - 1s - 3ms/step - loss: 0.1563 - val_loss: 0.3295
Epoch 3/100
221/221 - 1s - 3ms/step - loss: 0.1376 - val_loss: 0.3248
Epoch 4/100
221/221 - 1s - 3ms/step - loss: 0.1260 - val_loss: 0.3145
Epoch 5/100
221/221 - 1s - 3ms/step - loss: 0.1192 - val_loss: 0.3006
Epoch 6/100
221/221 - 1s - 2ms/step - loss: 0.1135 - val_loss: 0.3018
Epoch 7/100
221/221 - 1s - 3ms/step - loss: 0.1096 - val_loss: 0.2951
Epoch 8/100
221/221 - 1s - 3ms/step - loss: 0.1063 - val_loss: 0.2887
Epoch 9/100
221/221 - 1s - 3ms/step - loss: 0.1028 - val_loss: 0.2857
Epoch 10/100
221/221 - 1s - 2ms/step - loss: 0.1009 - val_loss: 0.2877
Epoch 11/100
221/221 - 1s - 3ms/step - loss: 0.0975 - val_loss: 0.2822
Epoch 12/100
221/221 - 1s - 3ms/step - loss: 0.0958 - val_loss: 0.2779
Epoch 13/100
221/221 - 1s - 3ms/step - loss: 0.0953 - val_loss: 0.2717
Epoch 14/100
221/221 - 1s - 2ms/step - loss: 0.0930 - val_loss: 0.2751
Epoch 15/100
221/221 - 1s - 3ms/step - loss: 0.0912 - val_loss: 0.2691
Epoch 16/100
221/221 - 1s - 3ms/step - loss: 0.0905 - val_loss: 0.2649
Epoch 17/100
221/221 - 1s - 3ms/step - loss: 0.0889 - val_loss: 0.2628
Epoch 18/100
221/221 - 1s - 3ms/step - loss: 0.0867 - val_loss: 0.2614
Epoch 19/100
221/221 - 1s - 2ms/step - loss: 0.0863 - val_loss: 0.2644
Epoch 20/100
221/221 - 1s - 3ms/step - loss: 0.0849 - val_loss: 0.2610
Epoch 21/100
221/221 - 1s - 2ms/step - loss: 0.0844 - val_loss: 0.2658
Epoch 22/100
221/221 - 1s - 2ms/step - loss: 0.0830 - val_loss: 0.2635
Epoch 23/100
221/221 - 1s - 2ms/step - loss: 0.0829 - val_loss: 0.2671
Epoch 24/100
221/221 - 1s - 2ms/step - loss: 0.0821 - val_loss: 0.2582
Epoch 25/100
221/221 - 1s - 2ms/step - loss: 0.0804 - val_loss: 0.2649
Epoch 26/100
221/221 - 1s - 3ms/step - loss: 0.0804 - val_loss: 0.2591
Epoch 27/100
221/221 - 1s - 3ms/step - loss: 0.0796 - val_loss: 0.2532
Epoch 28/100
221/221 - 1s - 3ms/step - loss: 0.0780 - val_loss: 0.2590
Epoch 29/100
221/221 - 1s - 3ms/step - loss: 0.0782 - val_loss: 0.2571
Epoch 30/100
221/221 - 1s - 2ms/step - loss: 0.0760 - val_loss: 0.2571
Epoch 31/100
221/221 - 1s - 3ms/step - loss: 0.0767 - val_loss: 0.2463
Epoch 32/100
221/221 - 1s - 2ms/step - loss: 0.0776 - val_loss: 0.2560
Epoch 33/100
221/221 - 1s - 2ms/step - loss: 0.0755 - val_loss: 0.2589
Epoch 34/100
221/221 - 1s - 2ms/step - loss: 0.0740 - val_loss: 0.2537
Epoch 35/100
221/221 - 1s - 2ms/step - loss: 0.0730 - val_loss: 0.2544
Epoch 36/100
221/221 - 1s - 2ms/step - loss: 0.0740 - val_loss: 0.2487
Epoch 37/100
221/221 - 1s - 3ms/step - loss: 0.0741 - val_loss: 0.2550
Epoch 38/100
221/221 - 1s - 3ms/step - loss: 0.0714 - val_loss: 0.2624
Epoch 39/100
221/221 - 1s - 2ms/step - loss: 0.0701 - val_loss: 0.2530
Epoch 40/100
221/221 - 1s - 2ms/step - loss: 0.0712 - val_loss: 0.2609
Epoch 41/100
221/221 - 1s - 2ms/step - loss: 0.0710 - val_loss: 0.2507
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4343
Per-joint RMSE: 0.5380 0.6967 0.3855 0.2479 0.3033 0.2345
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:43:27.868689: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:43:27.893436: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 08:43:28.750288: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:28.754805: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:28.755603: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:28.757421: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:28.758211: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:28.758961: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:28.838960: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:28.839808: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:28.840557: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:28.841279: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:43:29.131537: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.732198e-01  RMSE=5.227043e-01
  per-joint RMSE: 0.6089 0.8933 0.4714 0.2929 0.3194 0.2460
Residual LSTM:  MSE=1.886562e-01      RMSE=4.343458e-01
  per-joint RMSE: 0.5380 0.6967 0.3855 0.2479 0.3033 0.2345
Combined torque MSE=1.886562e-01     RMSE=4.343458e-01
  per-joint RMSE: 0.5380 0.6967 0.3855 0.2479 0.3033 0.2345
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400.npz --H 25 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400.json
H=25, n_dof=6, feature_dim=18
X_train: (70535, 25, 18)  Y_train: (70535, 6)
X_test : (14092, 25, 18)  Y_test : (14092, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:43:31.595305: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:43:31.619169: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (70535, 25, 18), Y_train = (70535, 6)
  X_test  = (14092, 25, 18),  Y_test  = (14092, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:43:32.814753: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:32.819430: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:32.820346: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:32.822132: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:32.823033: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:32.823775: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:32.906254: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:32.907146: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:32.907950: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:43:32.908744: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:43:33.895974: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
221/221 - 2s - 9ms/step - loss: 0.2255 - val_loss: 0.2932
Epoch 2/100
221/221 - 1s - 3ms/step - loss: 0.1352 - val_loss: 0.2602
Epoch 3/100
221/221 - 1s - 3ms/step - loss: 0.1169 - val_loss: 0.2483
Epoch 4/100
221/221 - 1s - 3ms/step - loss: 0.1074 - val_loss: 0.2428
Epoch 5/100
221/221 - 1s - 3ms/step - loss: 0.1000 - val_loss: 0.2364
Epoch 6/100
221/221 - 1s - 3ms/step - loss: 0.0955 - val_loss: 0.2303
Epoch 7/100
221/221 - 1s - 3ms/step - loss: 0.0900 - val_loss: 0.2278
Epoch 8/100
221/221 - 1s - 3ms/step - loss: 0.0871 - val_loss: 0.2220
Epoch 9/100
221/221 - 1s - 3ms/step - loss: 0.0849 - val_loss: 0.2186
Epoch 10/100
221/221 - 1s - 3ms/step - loss: 0.0822 - val_loss: 0.2155
Epoch 11/100
221/221 - 1s - 3ms/step - loss: 0.0807 - val_loss: 0.2120
Epoch 12/100
221/221 - 1s - 3ms/step - loss: 0.0783 - val_loss: 0.2092
Epoch 13/100
221/221 - 1s - 3ms/step - loss: 0.0764 - val_loss: 0.2061
Epoch 14/100
221/221 - 1s - 3ms/step - loss: 0.0747 - val_loss: 0.2055
Epoch 15/100
221/221 - 1s - 3ms/step - loss: 0.0738 - val_loss: 0.2056
Epoch 16/100
221/221 - 1s - 3ms/step - loss: 0.0734 - val_loss: 0.2100
Epoch 17/100
221/221 - 1s - 3ms/step - loss: 0.0719 - val_loss: 0.2010
Epoch 18/100
221/221 - 1s - 2ms/step - loss: 0.0709 - val_loss: 0.2025
Epoch 19/100
221/221 - 1s - 3ms/step - loss: 0.0694 - val_loss: 0.2019
Epoch 20/100
221/221 - 1s - 3ms/step - loss: 0.0685 - val_loss: 0.1980
Epoch 21/100
221/221 - 1s - 3ms/step - loss: 0.0676 - val_loss: 0.1979
Epoch 22/100
221/221 - 1s - 3ms/step - loss: 0.0666 - val_loss: 0.1987
Epoch 23/100
221/221 - 1s - 3ms/step - loss: 0.0661 - val_loss: 0.1956
Epoch 24/100
221/221 - 1s - 3ms/step - loss: 0.0652 - val_loss: 0.1911
Epoch 25/100
221/221 - 1s - 3ms/step - loss: 0.0649 - val_loss: 0.1942
Epoch 26/100
221/221 - 1s - 3ms/step - loss: 0.0638 - val_loss: 0.1928
Epoch 27/100
221/221 - 1s - 2ms/step - loss: 0.0636 - val_loss: 0.1914
Epoch 28/100
221/221 - 1s - 3ms/step - loss: 0.0629 - val_loss: 0.1907
Epoch 29/100
221/221 - 1s - 3ms/step - loss: 0.0622 - val_loss: 0.1904
Epoch 30/100
221/221 - 1s - 3ms/step - loss: 0.0618 - val_loss: 0.1909
Epoch 31/100
221/221 - 1s - 3ms/step - loss: 0.0608 - val_loss: 0.1973
Epoch 32/100
221/221 - 1s - 2ms/step - loss: 0.0606 - val_loss: 0.1917
Epoch 33/100
221/221 - 1s - 2ms/step - loss: 0.0599 - val_loss: 0.1933
Epoch 34/100
221/221 - 1s - 3ms/step - loss: 0.0596 - val_loss: 0.1919
Epoch 35/100
221/221 - 1s - 3ms/step - loss: 0.0591 - val_loss: 0.1918
Epoch 36/100
221/221 - 1s - 3ms/step - loss: 0.0584 - val_loss: 0.1933
Epoch 37/100
221/221 - 1s - 3ms/step - loss: 0.0576 - val_loss: 0.1865
Epoch 38/100
221/221 - 1s - 3ms/step - loss: 0.0580 - val_loss: 0.1894
Epoch 39/100
221/221 - 1s - 3ms/step - loss: 0.0573 - val_loss: 0.1895
Epoch 40/100
221/221 - 1s - 3ms/step - loss: 0.0573 - val_loss: 0.1903
Epoch 41/100
221/221 - 1s - 3ms/step - loss: 0.0565 - val_loss: 0.1899
Epoch 42/100
221/221 - 1s - 3ms/step - loss: 0.0560 - val_loss: 0.1879
Epoch 43/100
221/221 - 1s - 3ms/step - loss: 0.0553 - val_loss: 0.1875
Epoch 44/100
221/221 - 1s - 3ms/step - loss: 0.0547 - val_loss: 0.1909
Epoch 45/100
221/221 - 1s - 3ms/step - loss: 0.0547 - val_loss: 0.1848
Epoch 46/100
221/221 - 1s - 3ms/step - loss: 0.0546 - val_loss: 0.1852
Epoch 47/100
221/221 - 1s - 3ms/step - loss: 0.0534 - val_loss: 0.1916
Epoch 48/100
221/221 - 1s - 3ms/step - loss: 0.0533 - val_loss: 0.1941
Epoch 49/100
221/221 - 1s - 3ms/step - loss: 0.0531 - val_loss: 0.1918
Epoch 50/100
221/221 - 1s - 3ms/step - loss: 0.0525 - val_loss: 0.1906
Epoch 51/100
221/221 - 1s - 3ms/step - loss: 0.0526 - val_loss: 0.1883
Epoch 52/100
221/221 - 1s - 3ms/step - loss: 0.0520 - val_loss: 0.1847
Epoch 53/100
221/221 - 1s - 3ms/step - loss: 0.0512 - val_loss: 0.1872
Epoch 54/100
221/221 - 1s - 3ms/step - loss: 0.0512 - val_loss: 0.1887
Epoch 55/100
221/221 - 1s - 3ms/step - loss: 0.0501 - val_loss: 0.1883
Epoch 56/100
221/221 - 1s - 3ms/step - loss: 0.0503 - val_loss: 0.1853
Epoch 57/100
221/221 - 1s - 3ms/step - loss: 0.0493 - val_loss: 0.1851
Epoch 58/100
221/221 - 1s - 2ms/step - loss: 0.0490 - val_loss: 0.1885
Epoch 59/100
221/221 - 1s - 3ms/step - loss: 0.0485 - val_loss: 0.1862
Epoch 60/100
221/221 - 1s - 3ms/step - loss: 0.0485 - val_loss: 0.1841
Epoch 61/100
221/221 - 1s - 3ms/step - loss: 0.0479 - val_loss: 0.1836
Epoch 62/100
221/221 - 1s - 3ms/step - loss: 0.0473 - val_loss: 0.1811
Epoch 63/100
221/221 - 1s - 3ms/step - loss: 0.0471 - val_loss: 0.1850
Epoch 64/100
221/221 - 1s - 3ms/step - loss: 0.0467 - val_loss: 0.1791
Epoch 65/100
221/221 - 1s - 3ms/step - loss: 0.0465 - val_loss: 0.1768
Epoch 66/100
221/221 - 1s - 3ms/step - loss: 0.0463 - val_loss: 0.1793
Epoch 67/100
221/221 - 1s - 3ms/step - loss: 0.0455 - val_loss: 0.1775
Epoch 68/100
221/221 - 1s - 3ms/step - loss: 0.0454 - val_loss: 0.1799
Epoch 69/100
221/221 - 1s - 3ms/step - loss: 0.0458 - val_loss: 0.1796
Epoch 70/100
221/221 - 1s - 3ms/step - loss: 0.0453 - val_loss: 0.1789
Epoch 71/100
221/221 - 1s - 3ms/step - loss: 0.0448 - val_loss: 0.1790
Epoch 72/100
221/221 - 1s - 3ms/step - loss: 0.0447 - val_loss: 0.1744
Epoch 73/100
221/221 - 1s - 3ms/step - loss: 0.0443 - val_loss: 0.1753
Epoch 74/100
221/221 - 1s - 3ms/step - loss: 0.0443 - val_loss: 0.1761
Epoch 75/100
221/221 - 1s - 3ms/step - loss: 0.0434 - val_loss: 0.1766
Epoch 76/100
221/221 - 1s - 3ms/step - loss: 0.0434 - val_loss: 0.1707
Epoch 77/100
221/221 - 1s - 3ms/step - loss: 0.0432 - val_loss: 0.1701
Epoch 78/100
221/221 - 1s - 2ms/step - loss: 0.0444 - val_loss: 0.1720
Epoch 79/100
221/221 - 1s - 2ms/step - loss: 0.0428 - val_loss: 0.1747
Epoch 80/100
221/221 - 1s - 3ms/step - loss: 0.0423 - val_loss: 0.1718
Epoch 81/100
221/221 - 1s - 2ms/step - loss: 0.0420 - val_loss: 0.1753
Epoch 82/100
221/221 - 1s - 3ms/step - loss: 0.0416 - val_loss: 0.1731
Epoch 83/100
221/221 - 1s - 3ms/step - loss: 0.0416 - val_loss: 0.1687
Epoch 84/100
221/221 - 1s - 3ms/step - loss: 0.0412 - val_loss: 0.1683
Epoch 85/100
221/221 - 1s - 3ms/step - loss: 0.0413 - val_loss: 0.1703
Epoch 86/100
221/221 - 1s - 3ms/step - loss: 0.0411 - val_loss: 0.1724
Epoch 87/100
221/221 - 1s - 3ms/step - loss: 0.0413 - val_loss: 0.1719
Epoch 88/100
221/221 - 1s - 2ms/step - loss: 0.0407 - val_loss: 0.1700
Epoch 89/100
221/221 - 1s - 3ms/step - loss: 0.0398 - val_loss: 0.1727
Epoch 90/100
221/221 - 1s - 3ms/step - loss: 0.0399 - val_loss: 0.1731
Epoch 91/100
221/221 - 1s - 3ms/step - loss: 0.0395 - val_loss: 0.1707
Epoch 92/100
221/221 - 1s - 3ms/step - loss: 0.0396 - val_loss: 0.1676
Epoch 93/100
221/221 - 1s - 3ms/step - loss: 0.0394 - val_loss: 0.1715
Epoch 94/100
221/221 - 1s - 3ms/step - loss: 0.0390 - val_loss: 0.1695
Epoch 95/100
221/221 - 1s - 3ms/step - loss: 0.0389 - val_loss: 0.1706
Epoch 96/100
221/221 - 1s - 2ms/step - loss: 0.0388 - val_loss: 0.1708
Epoch 97/100
221/221 - 1s - 3ms/step - loss: 0.0387 - val_loss: 0.1697
Epoch 98/100
221/221 - 1s - 3ms/step - loss: 0.0384 - val_loss: 0.1664
Epoch 99/100
221/221 - 1s - 3ms/step - loss: 0.0383 - val_loss: 0.1683
Epoch 100/100
221/221 - 1s - 3ms/step - loss: 0.0379 - val_loss: 0.1683
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4008
Per-joint RMSE: 0.4488 0.6790 0.3711 0.2394 0.2568 0.2016
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:44:32.261804: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:44:32.286283: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 08:44:33.149413: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:44:33.154110: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:44:33.154990: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:44:33.156604: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:44:33.157400: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:44:33.158141: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:44:33.239044: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:44:33.239877: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:44:33.240625: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:44:33.241360: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:44:33.537359: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.732198e-01  RMSE=5.227043e-01
  per-joint RMSE: 0.6089 0.8933 0.4714 0.2929 0.3194 0.2460
Residual LSTM:  MSE=1.606734e-01      RMSE=4.008408e-01
  per-joint RMSE: 0.4488 0.6790 0.3711 0.2394 0.2568 0.2016
Combined torque MSE=1.606734e-01     RMSE=4.008408e-01
  per-joint RMSE: 0.4488 0.6790 0.3711 0.2394 0.2568 0.2016
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400.npz --H 50 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400.json
H=50, n_dof=6, feature_dim=24
X_train: (68810, 50, 24)  Y_train: (68810, 6)
X_test : (13667, 50, 24)  Y_test : (13667, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:44:36.259833: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:44:36.283903: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (68810, 50, 24), Y_train = (68810, 6)
  X_test  = (13667, 50, 24),  Y_test  = (13667, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:44:37.838341: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:44:37.843215: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:44:37.844246: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:44:37.845776: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:44:37.846687: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:44:37.847547: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:44:37.937864: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:44:37.938753: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:44:37.939556: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:44:37.940345: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8969 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:44:39.049499: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
216/216 - 2s - 10ms/step - loss: 0.2268 - val_loss: 0.2568
Epoch 2/100
216/216 - 1s - 4ms/step - loss: 0.1316 - val_loss: 0.2159
Epoch 3/100
216/216 - 1s - 4ms/step - loss: 0.1152 - val_loss: 0.2063
Epoch 4/100
216/216 - 1s - 4ms/step - loss: 0.1072 - val_loss: 0.1956
Epoch 5/100
216/216 - 1s - 4ms/step - loss: 0.0995 - val_loss: 0.1911
Epoch 6/100
216/216 - 1s - 4ms/step - loss: 0.0953 - val_loss: 0.1921
Epoch 7/100
216/216 - 1s - 4ms/step - loss: 0.0914 - val_loss: 0.1962
Epoch 8/100
216/216 - 1s - 4ms/step - loss: 0.0882 - val_loss: 0.1888
Epoch 9/100
216/216 - 1s - 4ms/step - loss: 0.0854 - val_loss: 0.1864
Epoch 10/100
216/216 - 1s - 4ms/step - loss: 0.0836 - val_loss: 0.1886
Epoch 11/100
216/216 - 1s - 4ms/step - loss: 0.0812 - val_loss: 0.1887
Epoch 12/100
216/216 - 1s - 4ms/step - loss: 0.0807 - val_loss: 0.1873
Epoch 13/100
216/216 - 1s - 4ms/step - loss: 0.0769 - val_loss: 0.1814
Epoch 14/100
216/216 - 1s - 4ms/step - loss: 0.0759 - val_loss: 0.1796
Epoch 15/100
216/216 - 1s - 4ms/step - loss: 0.0742 - val_loss: 0.1814
Epoch 16/100
216/216 - 1s - 4ms/step - loss: 0.0730 - val_loss: 0.1832
Epoch 17/100
216/216 - 1s - 4ms/step - loss: 0.0716 - val_loss: 0.1792
Epoch 18/100
216/216 - 1s - 4ms/step - loss: 0.0736 - val_loss: 0.1798
Epoch 19/100
216/216 - 1s - 4ms/step - loss: 0.0715 - val_loss: 0.1787
Epoch 20/100
216/216 - 1s - 4ms/step - loss: 0.0701 - val_loss: 0.1768
Epoch 21/100
216/216 - 1s - 4ms/step - loss: 0.0683 - val_loss: 0.1737
Epoch 22/100
216/216 - 1s - 4ms/step - loss: 0.0672 - val_loss: 0.1769
Epoch 23/100
216/216 - 1s - 4ms/step - loss: 0.0660 - val_loss: 0.1732
Epoch 24/100
216/216 - 1s - 4ms/step - loss: 0.0658 - val_loss: 0.1733
Epoch 25/100
216/216 - 1s - 4ms/step - loss: 0.0644 - val_loss: 0.1746
Epoch 26/100
216/216 - 1s - 4ms/step - loss: 0.0649 - val_loss: 0.1757
Epoch 27/100
216/216 - 1s - 4ms/step - loss: 0.0642 - val_loss: 0.1722
Epoch 28/100
216/216 - 1s - 4ms/step - loss: 0.0627 - val_loss: 0.1720
Epoch 29/100
216/216 - 1s - 4ms/step - loss: 0.0635 - val_loss: 0.1710
Epoch 30/100
216/216 - 1s - 4ms/step - loss: 0.0621 - val_loss: 0.1682
Epoch 31/100
216/216 - 1s - 4ms/step - loss: 0.0613 - val_loss: 0.1694
Epoch 32/100
216/216 - 1s - 4ms/step - loss: 0.0614 - val_loss: 0.1716
Epoch 33/100
216/216 - 1s - 4ms/step - loss: 0.0602 - val_loss: 0.1669
Epoch 34/100
216/216 - 1s - 4ms/step - loss: 0.0595 - val_loss: 0.1694
Epoch 35/100
216/216 - 1s - 4ms/step - loss: 0.0592 - val_loss: 0.1697
Epoch 36/100
216/216 - 1s - 4ms/step - loss: 0.0588 - val_loss: 0.1724
Epoch 37/100
216/216 - 1s - 4ms/step - loss: 0.0582 - val_loss: 0.1729
Epoch 38/100
216/216 - 1s - 4ms/step - loss: 0.0576 - val_loss: 0.1757
Epoch 39/100
216/216 - 1s - 4ms/step - loss: 0.0564 - val_loss: 0.1775
Epoch 40/100
216/216 - 1s - 4ms/step - loss: 0.0566 - val_loss: 0.1667
Epoch 41/100
216/216 - 1s - 4ms/step - loss: 0.0562 - val_loss: 0.1678
Epoch 42/100
216/216 - 1s - 4ms/step - loss: 0.0559 - val_loss: 0.1692
Epoch 43/100
216/216 - 1s - 4ms/step - loss: 0.0555 - val_loss: 0.1741
Epoch 44/100
216/216 - 1s - 4ms/step - loss: 0.0554 - val_loss: 0.1741
Epoch 45/100
216/216 - 1s - 4ms/step - loss: 0.0545 - val_loss: 0.1741
Epoch 46/100
216/216 - 1s - 4ms/step - loss: 0.0543 - val_loss: 0.1724
Epoch 47/100
216/216 - 1s - 4ms/step - loss: 0.0534 - val_loss: 0.1734
Epoch 48/100
216/216 - 1s - 4ms/step - loss: 0.0529 - val_loss: 0.1739
Epoch 49/100
216/216 - 1s - 4ms/step - loss: 0.0526 - val_loss: 0.1715
Epoch 50/100
216/216 - 1s - 4ms/step - loss: 0.0523 - val_loss: 0.1696
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3811
Per-joint RMSE: 0.4590 0.6088 0.3564 0.2405 0.2615 0.1919
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:45:22.618784: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:45:22.643511: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 08:45:23.489711: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:23.494270: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:23.495149: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:23.496843: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:23.497638: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:23.498376: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:23.583805: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:23.584730: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:23.585473: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:23.586212: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:45:23.884646: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.781095e-01  RMSE=5.273609e-01
  per-joint RMSE: 0.6131 0.9034 0.4747 0.2952 0.3221 0.2459
Residual LSTM:  MSE=1.452459e-01      RMSE=3.811113e-01
  per-joint RMSE: 0.4590 0.6088 0.3564 0.2405 0.2615 0.1919
Combined torque MSE=1.452459e-01     RMSE=3.811113e-01
  per-joint RMSE: 0.4590 0.6088 0.3564 0.2405 0.2615 0.1919
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400.npz --H 50 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400.json
H=50, n_dof=6, feature_dim=6
X_train: (68810, 50, 6)  Y_train: (68810, 6)
X_test : (13667, 50, 6)  Y_test : (13667, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:45:26.261853: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:45:26.285686: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (68810, 50, 6), Y_train = (68810, 6)
  X_test  = (13667, 50, 6),  Y_test  = (13667, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:45:27.475809: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:27.480742: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:27.481658: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:27.483320: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:27.484227: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:27.485083: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:27.576351: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:27.577326: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:27.578213: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:27.579005: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:45:28.540426: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
216/216 - 2s - 10ms/step - loss: 0.6485 - val_loss: 0.6608
Epoch 2/100
216/216 - 1s - 4ms/step - loss: 0.3993 - val_loss: 0.7629
Epoch 3/100
216/216 - 1s - 4ms/step - loss: 0.3016 - val_loss: 0.5850
Epoch 4/100
216/216 - 1s - 4ms/step - loss: 0.2402 - val_loss: 0.6296
Epoch 5/100
216/216 - 1s - 4ms/step - loss: 0.2220 - val_loss: 0.6843
Epoch 6/100
216/216 - 1s - 4ms/step - loss: 0.2257 - val_loss: 0.5878
Epoch 7/100
216/216 - 1s - 4ms/step - loss: 0.2125 - val_loss: 0.7452
Epoch 8/100
216/216 - 1s - 4ms/step - loss: 0.1937 - val_loss: 0.6461
Epoch 9/100
216/216 - 1s - 4ms/step - loss: 0.1855 - val_loss: 0.6443
Epoch 10/100
216/216 - 1s - 4ms/step - loss: 0.1768 - val_loss: 0.6905
Epoch 11/100
216/216 - 1s - 4ms/step - loss: 0.1837 - val_loss: 0.5418
Epoch 12/100
216/216 - 1s - 4ms/step - loss: 0.2038 - val_loss: 0.6770
Epoch 13/100
216/216 - 1s - 4ms/step - loss: 0.1896 - val_loss: 0.7136
Epoch 14/100
216/216 - 1s - 4ms/step - loss: 0.1681 - val_loss: 0.5982
Epoch 15/100
216/216 - 1s - 4ms/step - loss: 0.1789 - val_loss: 0.6522
Epoch 16/100
216/216 - 1s - 4ms/step - loss: 0.1486 - val_loss: 0.7408
Epoch 17/100
216/216 - 1s - 4ms/step - loss: 0.1524 - val_loss: 0.6872
Epoch 18/100
216/216 - 1s - 4ms/step - loss: 0.1620 - val_loss: 0.6625
Epoch 19/100
216/216 - 1s - 4ms/step - loss: 0.1696 - val_loss: 0.6945
Epoch 20/100
216/216 - 1s - 4ms/step - loss: 0.1567 - val_loss: 0.6696
Epoch 21/100
216/216 - 1s - 4ms/step - loss: 0.1429 - val_loss: 0.6812
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4546
Per-joint RMSE: 0.5633 0.7364 0.4042 0.2537 0.2756 0.2771
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:45:47.880795: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:45:47.906622: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 08:45:48.768655: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:48.773274: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:48.774072: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:48.775792: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:48.776610: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:48.777392: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:48.854574: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:48.855422: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:48.856263: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:48.857009: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:45:49.148001: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.781095e-01  RMSE=5.273609e-01
  per-joint RMSE: 0.6131 0.9034 0.4747 0.2952 0.3221 0.2459
Residual LSTM:  MSE=2.066858e-01      RMSE=4.546272e-01
  per-joint RMSE: 0.5633 0.7364 0.4042 0.2537 0.2756 0.2771
Combined torque MSE=2.066859e-01     RMSE=4.546272e-01
  per-joint RMSE: 0.5633 0.7364 0.4042 0.2537 0.2756 0.2771
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400.npz --H 50 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400.json
H=50, n_dof=6, feature_dim=18
X_train: (68810, 50, 18)  Y_train: (68810, 6)
X_test : (13667, 50, 18)  Y_test : (13667, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:45:51.787399: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:45:51.811292: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (68810, 50, 18), Y_train = (68810, 6)
  X_test  = (13667, 50, 18),  Y_test  = (13667, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:45:53.222108: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:53.226894: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:53.227808: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:53.229470: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:53.230373: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:53.231226: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:53.316267: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:53.317174: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:53.317984: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:45:53.318779: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8969 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:45:54.396699: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
216/216 - 2s - 10ms/step - loss: 0.2635 - val_loss: 0.3139
Epoch 2/100
216/216 - 1s - 4ms/step - loss: 0.1593 - val_loss: 0.3007
Epoch 3/100
216/216 - 1s - 4ms/step - loss: 0.1395 - val_loss: 0.2945
Epoch 4/100
216/216 - 1s - 4ms/step - loss: 0.1286 - val_loss: 0.2882
Epoch 5/100
216/216 - 1s - 4ms/step - loss: 0.1208 - val_loss: 0.2795
Epoch 6/100
216/216 - 1s - 4ms/step - loss: 0.1158 - val_loss: 0.2751
Epoch 7/100
216/216 - 1s - 4ms/step - loss: 0.1112 - val_loss: 0.2756
Epoch 8/100
216/216 - 1s - 4ms/step - loss: 0.1075 - val_loss: 0.2778
Epoch 9/100
216/216 - 1s - 4ms/step - loss: 0.1054 - val_loss: 0.2735
Epoch 10/100
216/216 - 1s - 4ms/step - loss: 0.1022 - val_loss: 0.2708
Epoch 11/100
216/216 - 1s - 4ms/step - loss: 0.0997 - val_loss: 0.2625
Epoch 12/100
216/216 - 1s - 4ms/step - loss: 0.0983 - val_loss: 0.2656
Epoch 13/100
216/216 - 1s - 4ms/step - loss: 0.0969 - val_loss: 0.2609
Epoch 14/100
216/216 - 1s - 4ms/step - loss: 0.0934 - val_loss: 0.2643
Epoch 15/100
216/216 - 1s - 4ms/step - loss: 0.0920 - val_loss: 0.2688
Epoch 16/100
216/216 - 1s - 4ms/step - loss: 0.0904 - val_loss: 0.2619
Epoch 17/100
216/216 - 1s - 4ms/step - loss: 0.0893 - val_loss: 0.2686
Epoch 18/100
216/216 - 1s - 4ms/step - loss: 0.0883 - val_loss: 0.2642
Epoch 19/100
216/216 - 1s - 4ms/step - loss: 0.0873 - val_loss: 0.2653
Epoch 20/100
216/216 - 1s - 4ms/step - loss: 0.0860 - val_loss: 0.2648
Epoch 21/100
216/216 - 1s - 4ms/step - loss: 0.0832 - val_loss: 0.2635
Epoch 22/100
216/216 - 1s - 4ms/step - loss: 0.0830 - val_loss: 0.2683
Epoch 23/100
216/216 - 1s - 4ms/step - loss: 0.0837 - val_loss: 0.2630
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4547
Per-joint RMSE: 0.5509 0.7368 0.3968 0.2682 0.3242 0.2442
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:46:15.651945: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:46:15.676492: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 08:46:16.542976: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:16.547766: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:16.548560: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:16.550167: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:16.550958: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:16.551699: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:16.632872: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:16.633760: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:16.634547: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:16.635275: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:46:16.929749: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.781095e-01  RMSE=5.273609e-01
  per-joint RMSE: 0.6131 0.9034 0.4747 0.2952 0.3221 0.2459
Residual LSTM:  MSE=2.067482e-01      RMSE=4.546957e-01
  per-joint RMSE: 0.5509 0.7368 0.3968 0.2682 0.3242 0.2442
Combined torque MSE=2.067482e-01     RMSE=4.546957e-01
  per-joint RMSE: 0.5509 0.7368 0.3968 0.2682 0.3242 0.2442
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400.npz --H 50 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400.json
H=50, n_dof=6, feature_dim=18
X_train: (68810, 50, 18)  Y_train: (68810, 6)
X_test : (13667, 50, 18)  Y_test : (13667, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:46:19.568441: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:46:19.592247: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (68810, 50, 18), Y_train = (68810, 6)
  X_test  = (13667, 50, 18),  Y_test  = (13667, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:46:21.024167: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:21.029000: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:21.029914: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:21.031420: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:21.032327: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:21.033171: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:21.125495: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:21.126390: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:21.127203: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:21.128007: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8969 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:46:22.173731: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
216/216 - 2s - 10ms/step - loss: 0.2269 - val_loss: 0.2642
Epoch 2/100
216/216 - 1s - 4ms/step - loss: 0.1370 - val_loss: 0.2349
Epoch 3/100
216/216 - 1s - 4ms/step - loss: 0.1182 - val_loss: 0.2261
Epoch 4/100
216/216 - 1s - 4ms/step - loss: 0.1093 - val_loss: 0.2304
Epoch 5/100
216/216 - 1s - 4ms/step - loss: 0.1023 - val_loss: 0.2239
Epoch 6/100
216/216 - 1s - 4ms/step - loss: 0.0967 - val_loss: 0.2252
Epoch 7/100
216/216 - 1s - 4ms/step - loss: 0.0922 - val_loss: 0.2236
Epoch 8/100
216/216 - 1s - 4ms/step - loss: 0.0893 - val_loss: 0.2216
Epoch 9/100
216/216 - 1s - 4ms/step - loss: 0.0862 - val_loss: 0.2170
Epoch 10/100
216/216 - 1s - 4ms/step - loss: 0.0839 - val_loss: 0.2131
Epoch 11/100
216/216 - 1s - 4ms/step - loss: 0.0819 - val_loss: 0.2062
Epoch 12/100
216/216 - 1s - 4ms/step - loss: 0.0808 - val_loss: 0.2084
Epoch 13/100
216/216 - 1s - 4ms/step - loss: 0.0784 - val_loss: 0.2070
Epoch 14/100
216/216 - 1s - 4ms/step - loss: 0.0763 - val_loss: 0.2035
Epoch 15/100
216/216 - 1s - 4ms/step - loss: 0.0752 - val_loss: 0.2012
Epoch 16/100
216/216 - 1s - 4ms/step - loss: 0.0743 - val_loss: 0.1954
Epoch 17/100
216/216 - 1s - 4ms/step - loss: 0.0727 - val_loss: 0.1956
Epoch 18/100
216/216 - 1s - 4ms/step - loss: 0.0719 - val_loss: 0.1898
Epoch 19/100
216/216 - 1s - 4ms/step - loss: 0.0710 - val_loss: 0.1905
Epoch 20/100
216/216 - 1s - 4ms/step - loss: 0.0699 - val_loss: 0.1921
Epoch 21/100
216/216 - 1s - 4ms/step - loss: 0.0684 - val_loss: 0.1907
Epoch 22/100
216/216 - 1s - 4ms/step - loss: 0.0682 - val_loss: 0.1909
Epoch 23/100
216/216 - 1s - 4ms/step - loss: 0.0667 - val_loss: 0.1878
Epoch 24/100
216/216 - 1s - 4ms/step - loss: 0.0662 - val_loss: 0.1904
Epoch 25/100
216/216 - 1s - 4ms/step - loss: 0.0656 - val_loss: 0.1907
Epoch 26/100
216/216 - 1s - 4ms/step - loss: 0.0655 - val_loss: 0.1894
Epoch 27/100
216/216 - 1s - 4ms/step - loss: 0.0641 - val_loss: 0.1904
Epoch 28/100
216/216 - 1s - 4ms/step - loss: 0.0634 - val_loss: 0.1908
Epoch 29/100
216/216 - 1s - 4ms/step - loss: 0.0637 - val_loss: 0.1896
Epoch 30/100
216/216 - 1s - 4ms/step - loss: 0.0628 - val_loss: 0.1877
Epoch 31/100
216/216 - 1s - 4ms/step - loss: 0.0620 - val_loss: 0.1897
Epoch 32/100
216/216 - 1s - 4ms/step - loss: 0.0618 - val_loss: 0.1886
Epoch 33/100
216/216 - 1s - 4ms/step - loss: 0.0608 - val_loss: 0.1925
Epoch 34/100
216/216 - 1s - 4ms/step - loss: 0.0603 - val_loss: 0.1892
Epoch 35/100
216/216 - 1s - 4ms/step - loss: 0.0598 - val_loss: 0.1923
Epoch 36/100
216/216 - 1s - 4ms/step - loss: 0.0598 - val_loss: 0.1898
Epoch 37/100
216/216 - 1s - 4ms/step - loss: 0.0588 - val_loss: 0.1938
Epoch 38/100
216/216 - 1s - 4ms/step - loss: 0.0587 - val_loss: 0.1915
Epoch 39/100
216/216 - 1s - 4ms/step - loss: 0.0576 - val_loss: 0.1931
Epoch 40/100
216/216 - 1s - 4ms/step - loss: 0.0573 - val_loss: 0.1963
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4088
Per-joint RMSE: 0.4853 0.6658 0.3811 0.2530 0.2686 0.2068
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:46:57.248944: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:46:57.273529: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s1_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 08:46:58.128040: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:58.132564: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:58.133365: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:58.135266: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:58.136154: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:58.136963: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:58.222332: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:58.223259: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:58.224011: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:46:58.224824: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:46:58.521991: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.781095e-01  RMSE=5.273609e-01
  per-joint RMSE: 0.6131 0.9034 0.4747 0.2952 0.3221 0.2459
Residual LSTM:  MSE=1.671523e-01      RMSE=4.088426e-01
  per-joint RMSE: 0.4853 0.6658 0.3811 0.2530 0.2686 0.2068
Combined torque MSE=1.671523e-01     RMSE=4.088426e-01
  per-joint RMSE: 0.4853 0.6658 0.3811 0.2530 0.2686 0.2068
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=2                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz                                ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p2_seed2_dataset.npz -t structured -s 2 -r 0 --hp_preset fast_debug --epochs 400 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400.jax' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 400, 'lagrangian_type': <function structured_lagrangian_fn at 0x787166c341f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K150_tf0p2_seed2_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p2_seed2_dataset.npz
   dt ≈ 0.02208891656001752
  dof = 6
  Train trajectories = 120
  Test trajectories  = 30
  Train samples = 72344
  Test samples  = 14539
################################################

2026-01-22 08:47:03.166248: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400 | type=structured | dof=6
################################################
2026-01-22 08:47:06.318219: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:47:06.318256: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:47:06.318262: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:47:06.318291: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:47:06.318296: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:47:06.318312: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:47:06.318359: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:47:06.318371: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:47:06.318391: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:47:06.318398: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.3s, Loss=8.05e+00, Inv=8.05e+00, For=8.71e+01, Power=2.50e+00
  [eval] test_mse=1.102e+00  (n=14539)
Epoch 00050: Time=  16.5s, Loss=2.67e+00, Inv=2.67e+00, For=8.61e+01, Power=1.36e+00
Epoch 00100: Time=  25.4s, Loss=2.46e+00, Inv=2.46e+00, For=1.34e+02, Power=1.26e+00
Epoch 00150: Time=  34.5s, Loss=2.37e+00, Inv=2.37e+00, For=2.10e+02, Power=1.22e+00
Epoch 00200: Time=  43.9s, Loss=2.31e+00, Inv=2.31e+00, For=3.33e+02, Power=1.19e+00
  [eval] test_mse=1.315e+00  (n=14539)
Epoch 00250: Time=  53.3s, Loss=2.28e+00, Inv=2.28e+00, For=4.64e+02, Power=1.18e+00
Epoch 00300: Time=  62.4s, Loss=2.25e+00, Inv=2.25e+00, For=5.69e+02, Power=1.17e+00
Epoch 00350: Time=  72.0s, Loss=2.23e+00, Inv=2.23e+00, For=7.24e+02, Power=1.15e+00
Epoch 00400: Time=  81.6s, Loss=2.21e+00, Inv=2.21e+00, For=8.99e+02, Power=1.15e+00
  [eval] test_mse=1.652e+00  (n=14539)
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400
Torque MSE  = 2.753e-01
Torque RMSE = 5.247e-01
Per-joint MSE : 3.720e-01 7.621e-01 2.659e-01 8.808e-02 9.147e-02 7.216e-02
Per-joint RMSE: 6.099e-01 8.730e-01 5.156e-01 2.968e-01 3.024e-01 2.686e-01
Comp Time per Sample = 2.215e-08s / 45140958.9Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p2_seed2_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p2_seed2_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400.jax
Detected n_dof=6 (seed=2)
2026-01-22 08:48:30.045775: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 120 trajectories
2026-01-22 08:48:31.366479: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:48:31.366491: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:48:32.976951: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:48:32.976965: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:48:34.588075: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/120
2026-01-22 08:48:35.846501: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:48:37.018155: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:48:37.018191: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:48:37.018196: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 50/120
  done 75/120
2026-01-22 08:48:38.595311: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:48:39.801068: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:48:41.004048: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 100/120
  done 120/120

Exporting split=test: 30 trajectories
  done 25/30
  done 30/30

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400.npz --H 25 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400.json
H=25, n_dof=6, feature_dim=24
X_train: (70535, 25, 24)  Y_train: (70535, 6)
X_test : (14092, 25, 24)  Y_test : (14092, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:48:44.855699: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:48:44.879519: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (70535, 25, 24), Y_train = (70535, 6)
  X_test  = (14092, 25, 24),  Y_test  = (14092, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:48:46.132843: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:48:46.137610: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:48:46.138531: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:48:46.140269: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:48:46.141311: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:48:46.142178: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:48:46.229192: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:48:46.230078: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:48:46.230875: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:48:46.231657: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8975 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:48:47.206409: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
221/221 - 2s - 9ms/step - loss: 0.2269 - val_loss: 0.2801
Epoch 2/100
221/221 - 1s - 3ms/step - loss: 0.1307 - val_loss: 0.2465
Epoch 3/100
221/221 - 1s - 3ms/step - loss: 0.1152 - val_loss: 0.2376
Epoch 4/100
221/221 - 1s - 3ms/step - loss: 0.1055 - val_loss: 0.2168
Epoch 5/100
221/221 - 1s - 3ms/step - loss: 0.0992 - val_loss: 0.2135
Epoch 6/100
221/221 - 1s - 3ms/step - loss: 0.0942 - val_loss: 0.2018
Epoch 7/100
221/221 - 1s - 3ms/step - loss: 0.0897 - val_loss: 0.1977
Epoch 8/100
221/221 - 1s - 3ms/step - loss: 0.0873 - val_loss: 0.1923
Epoch 9/100
221/221 - 1s - 3ms/step - loss: 0.0846 - val_loss: 0.1909
Epoch 10/100
221/221 - 1s - 3ms/step - loss: 0.0825 - val_loss: 0.1837
Epoch 11/100
221/221 - 1s - 3ms/step - loss: 0.0805 - val_loss: 0.1809
Epoch 12/100
221/221 - 1s - 3ms/step - loss: 0.0793 - val_loss: 0.1757
Epoch 13/100
221/221 - 1s - 3ms/step - loss: 0.0766 - val_loss: 0.1774
Epoch 14/100
221/221 - 1s - 3ms/step - loss: 0.0761 - val_loss: 0.1673
Epoch 15/100
221/221 - 1s - 3ms/step - loss: 0.0743 - val_loss: 0.1670
Epoch 16/100
221/221 - 1s - 2ms/step - loss: 0.0736 - val_loss: 0.1635
Epoch 17/100
221/221 - 1s - 3ms/step - loss: 0.0727 - val_loss: 0.1619
Epoch 18/100
221/221 - 1s - 3ms/step - loss: 0.0703 - val_loss: 0.1585
Epoch 19/100
221/221 - 1s - 2ms/step - loss: 0.0696 - val_loss: 0.1612
Epoch 20/100
221/221 - 1s - 2ms/step - loss: 0.0691 - val_loss: 0.1598
Epoch 21/100
221/221 - 1s - 3ms/step - loss: 0.0672 - val_loss: 0.1590
Epoch 22/100
221/221 - 1s - 3ms/step - loss: 0.0671 - val_loss: 0.1583
Epoch 23/100
221/221 - 1s - 3ms/step - loss: 0.0661 - val_loss: 0.1569
Epoch 24/100
221/221 - 1s - 3ms/step - loss: 0.0651 - val_loss: 0.1536
Epoch 25/100
221/221 - 1s - 3ms/step - loss: 0.0646 - val_loss: 0.1569
Epoch 26/100
221/221 - 1s - 2ms/step - loss: 0.0643 - val_loss: 0.1548
Epoch 27/100
221/221 - 1s - 2ms/step - loss: 0.0632 - val_loss: 0.1568
Epoch 28/100
221/221 - 1s - 2ms/step - loss: 0.0628 - val_loss: 0.1536
Epoch 29/100
221/221 - 1s - 3ms/step - loss: 0.0619 - val_loss: 0.1517
Epoch 30/100
221/221 - 1s - 3ms/step - loss: 0.0613 - val_loss: 0.1556
Epoch 31/100
221/221 - 1s - 2ms/step - loss: 0.0607 - val_loss: 0.1551
Epoch 32/100
221/221 - 1s - 3ms/step - loss: 0.0603 - val_loss: 0.1530
Epoch 33/100
221/221 - 1s - 3ms/step - loss: 0.0594 - val_loss: 0.1554
Epoch 34/100
221/221 - 1s - 2ms/step - loss: 0.0594 - val_loss: 0.1561
Epoch 35/100
221/221 - 1s - 3ms/step - loss: 0.0584 - val_loss: 0.1533
Epoch 36/100
221/221 - 1s - 3ms/step - loss: 0.0578 - val_loss: 0.1574
Epoch 37/100
221/221 - 1s - 2ms/step - loss: 0.0574 - val_loss: 0.1584
Epoch 38/100
221/221 - 1s - 2ms/step - loss: 0.0568 - val_loss: 0.1565
Epoch 39/100
221/221 - 1s - 3ms/step - loss: 0.0565 - val_loss: 0.1579
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3770
Per-joint RMSE: 0.4629 0.5688 0.3988 0.2425 0.2319 0.2080
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:49:10.802675: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:49:10.827472: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 08:49:11.685409: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:11.690111: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:11.690901: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:11.692743: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:11.693616: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:11.694352: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:11.771966: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:11.772798: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:11.773534: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:11.774269: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:49:12.068494: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.798468e-01  RMSE=5.290055e-01
  per-joint RMSE: 0.6144 0.8818 0.5180 0.2981 0.3051 0.2714
Residual LSTM:  MSE=1.421073e-01      RMSE=3.769712e-01
  per-joint RMSE: 0.4629 0.5688 0.3988 0.2425 0.2319 0.2080
Combined torque MSE=1.421073e-01     RMSE=3.769712e-01
  per-joint RMSE: 0.4629 0.5688 0.3988 0.2425 0.2319 0.2080
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400.npz --H 25 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400.json
H=25, n_dof=6, feature_dim=6
X_train: (70535, 25, 6)  Y_train: (70535, 6)
X_test : (14092, 25, 6)  Y_test : (14092, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:49:14.353299: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:49:14.376981: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (70535, 25, 6), Y_train = (70535, 6)
  X_test  = (14092, 25, 6),  Y_test  = (14092, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:49:15.422662: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:15.427200: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:15.427990: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:15.429563: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:15.430435: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:15.431175: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:15.516972: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:15.517894: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:15.518652: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:15.519387: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:49:16.456171: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
221/221 - 2s - 9ms/step - loss: 0.6958 - val_loss: 0.7000
Epoch 2/100
221/221 - 1s - 3ms/step - loss: 0.4467 - val_loss: 0.6495
Epoch 3/100
221/221 - 1s - 3ms/step - loss: 0.3565 - val_loss: 0.7321
Epoch 4/100
221/221 - 1s - 2ms/step - loss: 0.3049 - val_loss: 0.7381
Epoch 5/100
221/221 - 1s - 3ms/step - loss: 0.2704 - val_loss: 0.7331
Epoch 6/100
221/221 - 1s - 2ms/step - loss: 0.2443 - val_loss: 0.7195
Epoch 7/100
221/221 - 1s - 2ms/step - loss: 0.2402 - val_loss: 0.8064
Epoch 8/100
221/221 - 1s - 3ms/step - loss: 0.2297 - val_loss: 0.7972
Epoch 9/100
221/221 - 1s - 3ms/step - loss: 0.1989 - val_loss: 0.7440
Epoch 10/100
221/221 - 1s - 3ms/step - loss: 0.2015 - val_loss: 0.7670
Epoch 11/100
221/221 - 1s - 3ms/step - loss: 0.1887 - val_loss: 0.7193
Epoch 12/100
221/221 - 1s - 2ms/step - loss: 0.1717 - val_loss: 0.7624
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4551
Per-joint RMSE: 0.5513 0.7104 0.4680 0.2713 0.2697 0.2618
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:49:24.843146: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:49:24.867901: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 08:49:25.715503: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:25.720648: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:25.721578: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:25.723478: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:25.724408: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:25.725206: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:25.808242: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:25.809141: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:25.809945: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:25.810724: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:49:26.103463: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.798468e-01  RMSE=5.290055e-01
  per-joint RMSE: 0.6144 0.8818 0.5180 0.2981 0.3051 0.2714
Residual LSTM:  MSE=2.070937e-01      RMSE=4.550755e-01
  per-joint RMSE: 0.5513 0.7104 0.4680 0.2713 0.2697 0.2618
Combined torque MSE=2.070937e-01     RMSE=4.550755e-01
  per-joint RMSE: 0.5513 0.7104 0.4680 0.2713 0.2697 0.2618
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400.npz --H 25 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400.json
H=25, n_dof=6, feature_dim=18
X_train: (70535, 25, 18)  Y_train: (70535, 6)
X_test : (14092, 25, 18)  Y_test : (14092, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:49:28.579824: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:49:28.603429: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (70535, 25, 18), Y_train = (70535, 6)
  X_test  = (14092, 25, 18),  Y_test  = (14092, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:49:29.791846: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:29.796589: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:29.797510: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:29.799158: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:29.800064: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:29.800919: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:29.885933: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:29.886832: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:29.887631: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:29.888420: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:49:30.896930: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
221/221 - 2s - 9ms/step - loss: 0.2564 - val_loss: 0.3473
Epoch 2/100
221/221 - 1s - 3ms/step - loss: 0.1593 - val_loss: 0.3350
Epoch 3/100
221/221 - 1s - 3ms/step - loss: 0.1396 - val_loss: 0.3193
Epoch 4/100
221/221 - 1s - 3ms/step - loss: 0.1281 - val_loss: 0.3011
Epoch 5/100
221/221 - 1s - 3ms/step - loss: 0.1207 - val_loss: 0.2917
Epoch 6/100
221/221 - 1s - 3ms/step - loss: 0.1148 - val_loss: 0.2847
Epoch 7/100
221/221 - 1s - 3ms/step - loss: 0.1093 - val_loss: 0.2805
Epoch 8/100
221/221 - 1s - 3ms/step - loss: 0.1074 - val_loss: 0.2779
Epoch 9/100
221/221 - 1s - 3ms/step - loss: 0.1031 - val_loss: 0.2699
Epoch 10/100
221/221 - 1s - 3ms/step - loss: 0.1005 - val_loss: 0.2712
Epoch 11/100
221/221 - 1s - 3ms/step - loss: 0.0980 - val_loss: 0.2645
Epoch 12/100
221/221 - 1s - 3ms/step - loss: 0.0968 - val_loss: 0.2639
Epoch 13/100
221/221 - 1s - 3ms/step - loss: 0.0947 - val_loss: 0.2584
Epoch 14/100
221/221 - 1s - 3ms/step - loss: 0.0932 - val_loss: 0.2563
Epoch 15/100
221/221 - 1s - 3ms/step - loss: 0.0917 - val_loss: 0.2540
Epoch 16/100
221/221 - 1s - 3ms/step - loss: 0.0892 - val_loss: 0.2541
Epoch 17/100
221/221 - 1s - 3ms/step - loss: 0.0882 - val_loss: 0.2591
Epoch 18/100
221/221 - 1s - 3ms/step - loss: 0.0863 - val_loss: 0.2503
Epoch 19/100
221/221 - 1s - 2ms/step - loss: 0.0856 - val_loss: 0.2532
Epoch 20/100
221/221 - 1s - 3ms/step - loss: 0.0835 - val_loss: 0.2540
Epoch 21/100
221/221 - 1s - 3ms/step - loss: 0.0829 - val_loss: 0.2535
Epoch 22/100
221/221 - 1s - 3ms/step - loss: 0.0810 - val_loss: 0.2536
Epoch 23/100
221/221 - 1s - 3ms/step - loss: 0.0797 - val_loss: 0.2529
Epoch 24/100
221/221 - 1s - 3ms/step - loss: 0.0790 - val_loss: 0.2514
Epoch 25/100
221/221 - 1s - 2ms/step - loss: 0.0772 - val_loss: 0.2576
Epoch 26/100
221/221 - 1s - 3ms/step - loss: 0.0770 - val_loss: 0.2516
Epoch 27/100
221/221 - 1s - 3ms/step - loss: 0.0772 - val_loss: 0.2520
Epoch 28/100
221/221 - 1s - 3ms/step - loss: 0.0748 - val_loss: 0.2511
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4685
Per-joint RMSE: 0.5415 0.7780 0.4387 0.2588 0.2873 0.2765
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:49:48.492352: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:49:48.516904: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 08:49:49.366841: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:49.371466: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:49.372338: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:49.374186: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:49.374976: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:49.375718: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:49.460952: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:49.461861: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:49.462609: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:49.463336: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:49:49.756798: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.798468e-01  RMSE=5.290055e-01
  per-joint RMSE: 0.6144 0.8818 0.5180 0.2981 0.3051 0.2714
Residual LSTM:  MSE=2.194857e-01      RMSE=4.684930e-01
  per-joint RMSE: 0.5415 0.7780 0.4387 0.2588 0.2873 0.2765
Combined torque MSE=2.194857e-01     RMSE=4.684930e-01
  per-joint RMSE: 0.5415 0.7780 0.4387 0.2588 0.2873 0.2765
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400.npz --H 25 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400.json
H=25, n_dof=6, feature_dim=18
X_train: (70535, 25, 18)  Y_train: (70535, 6)
X_test : (14092, 25, 18)  Y_test : (14092, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:49:52.208033: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:49:52.232343: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (70535, 25, 18), Y_train = (70535, 6)
  X_test  = (14092, 25, 18),  Y_test  = (14092, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:49:53.427315: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:53.432026: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:53.432934: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:53.434883: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:53.435804: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:53.436653: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:53.556516: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:53.557408: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:53.558306: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:49:53.559178: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:49:54.523433: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
221/221 - 2s - 9ms/step - loss: 0.2316 - val_loss: 0.2978
Epoch 2/100
221/221 - 1s - 3ms/step - loss: 0.1364 - val_loss: 0.2571
Epoch 3/100
221/221 - 1s - 3ms/step - loss: 0.1182 - val_loss: 0.2414
Epoch 4/100
221/221 - 1s - 3ms/step - loss: 0.1078 - val_loss: 0.2328
Epoch 5/100
221/221 - 1s - 3ms/step - loss: 0.1002 - val_loss: 0.2223
Epoch 6/100
221/221 - 1s - 3ms/step - loss: 0.0955 - val_loss: 0.2209
Epoch 7/100
221/221 - 1s - 3ms/step - loss: 0.0901 - val_loss: 0.2158
Epoch 8/100
221/221 - 1s - 3ms/step - loss: 0.0874 - val_loss: 0.2080
Epoch 9/100
221/221 - 1s - 3ms/step - loss: 0.0849 - val_loss: 0.2052
Epoch 10/100
221/221 - 1s - 2ms/step - loss: 0.0838 - val_loss: 0.2064
Epoch 11/100
221/221 - 1s - 3ms/step - loss: 0.0809 - val_loss: 0.2035
Epoch 12/100
221/221 - 1s - 3ms/step - loss: 0.0792 - val_loss: 0.2002
Epoch 13/100
221/221 - 1s - 2ms/step - loss: 0.0771 - val_loss: 0.2008
Epoch 14/100
221/221 - 1s - 3ms/step - loss: 0.0753 - val_loss: 0.1983
Epoch 15/100
221/221 - 1s - 3ms/step - loss: 0.0742 - val_loss: 0.1959
Epoch 16/100
221/221 - 1s - 3ms/step - loss: 0.0740 - val_loss: 0.1923
Epoch 17/100
221/221 - 1s - 3ms/step - loss: 0.0718 - val_loss: 0.1918
Epoch 18/100
221/221 - 1s - 3ms/step - loss: 0.0706 - val_loss: 0.1897
Epoch 19/100
221/221 - 1s - 3ms/step - loss: 0.0690 - val_loss: 0.1889
Epoch 20/100
221/221 - 1s - 3ms/step - loss: 0.0687 - val_loss: 0.1861
Epoch 21/100
221/221 - 1s - 3ms/step - loss: 0.0672 - val_loss: 0.1845
Epoch 22/100
221/221 - 1s - 3ms/step - loss: 0.0666 - val_loss: 0.1840
Epoch 23/100
221/221 - 1s - 3ms/step - loss: 0.0662 - val_loss: 0.1839
Epoch 24/100
221/221 - 1s - 3ms/step - loss: 0.0653 - val_loss: 0.1820
Epoch 25/100
221/221 - 1s - 2ms/step - loss: 0.0649 - val_loss: 0.1832
Epoch 26/100
221/221 - 1s - 2ms/step - loss: 0.0641 - val_loss: 0.1822
Epoch 27/100
221/221 - 1s - 3ms/step - loss: 0.0635 - val_loss: 0.1831
Epoch 28/100
221/221 - 1s - 3ms/step - loss: 0.0629 - val_loss: 0.1821
Epoch 29/100
221/221 - 1s - 3ms/step - loss: 0.0619 - val_loss: 0.1827
Epoch 30/100
221/221 - 1s - 3ms/step - loss: 0.0614 - val_loss: 0.1812
Epoch 31/100
221/221 - 1s - 3ms/step - loss: 0.0612 - val_loss: 0.1765
Epoch 32/100
221/221 - 1s - 2ms/step - loss: 0.0613 - val_loss: 0.1818
Epoch 33/100
221/221 - 1s - 3ms/step - loss: 0.0598 - val_loss: 0.1788
Epoch 34/100
221/221 - 1s - 3ms/step - loss: 0.0598 - val_loss: 0.1780
Epoch 35/100
221/221 - 1s - 3ms/step - loss: 0.0590 - val_loss: 0.1797
Epoch 36/100
221/221 - 1s - 3ms/step - loss: 0.0588 - val_loss: 0.1812
Epoch 37/100
221/221 - 1s - 3ms/step - loss: 0.0580 - val_loss: 0.1815
Epoch 38/100
221/221 - 1s - 3ms/step - loss: 0.0576 - val_loss: 0.1798
Epoch 39/100
221/221 - 1s - 3ms/step - loss: 0.0573 - val_loss: 0.1772
Epoch 40/100
221/221 - 1s - 3ms/step - loss: 0.0565 - val_loss: 0.1796
Epoch 41/100
221/221 - 1s - 3ms/step - loss: 0.0562 - val_loss: 0.1799
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3963
Per-joint RMSE: 0.4574 0.6149 0.4300 0.2516 0.2479 0.2124
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:50:19.173373: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:50:19.198084: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 08:50:20.042685: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:50:20.047184: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:50:20.048062: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:50:20.049915: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:50:20.050712: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:50:20.051460: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:50:20.129959: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:50:20.130795: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:50:20.131536: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:50:20.132272: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:50:20.432252: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.798468e-01  RMSE=5.290055e-01
  per-joint RMSE: 0.6144 0.8818 0.5180 0.2981 0.3051 0.2714
Residual LSTM:  MSE=1.570175e-01      RMSE=3.962544e-01
  per-joint RMSE: 0.4574 0.6149 0.4300 0.2516 0.2479 0.2124
Combined torque MSE=1.570175e-01     RMSE=3.962544e-01
  per-joint RMSE: 0.4574 0.6149 0.4300 0.2516 0.2479 0.2124
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400.npz --H 50 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400.json
H=50, n_dof=6, feature_dim=24
X_train: (68810, 50, 24)  Y_train: (68810, 6)
X_test : (13667, 50, 24)  Y_test : (13667, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:50:23.119468: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:50:23.143334: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (68810, 50, 24), Y_train = (68810, 6)
  X_test  = (13667, 50, 24),  Y_test  = (13667, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:50:24.743936: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:50:24.749038: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:50:24.749988: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:50:24.751545: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:50:24.752577: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:50:24.753453: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:50:24.849260: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:50:24.850219: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:50:24.851027: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:50:24.851817: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8969 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:50:25.995740: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
216/216 - 2s - 10ms/step - loss: 0.2270 - val_loss: 0.2480
Epoch 2/100
216/216 - 1s - 4ms/step - loss: 0.1331 - val_loss: 0.2175
Epoch 3/100
216/216 - 1s - 4ms/step - loss: 0.1165 - val_loss: 0.2034
Epoch 4/100
216/216 - 1s - 4ms/step - loss: 0.1071 - val_loss: 0.1967
Epoch 5/100
216/216 - 1s - 4ms/step - loss: 0.1011 - val_loss: 0.1898
Epoch 6/100
216/216 - 1s - 4ms/step - loss: 0.0974 - val_loss: 0.1872
Epoch 7/100
216/216 - 1s - 4ms/step - loss: 0.0925 - val_loss: 0.1884
Epoch 8/100
216/216 - 1s - 4ms/step - loss: 0.0900 - val_loss: 0.1836
Epoch 9/100
216/216 - 1s - 4ms/step - loss: 0.0867 - val_loss: 0.1816
Epoch 10/100
216/216 - 1s - 4ms/step - loss: 0.0850 - val_loss: 0.1785
Epoch 11/100
216/216 - 1s - 4ms/step - loss: 0.0825 - val_loss: 0.1771
Epoch 12/100
216/216 - 1s - 4ms/step - loss: 0.0794 - val_loss: 0.1721
Epoch 13/100
216/216 - 1s - 4ms/step - loss: 0.0780 - val_loss: 0.1736
Epoch 14/100
216/216 - 1s - 4ms/step - loss: 0.0760 - val_loss: 0.1699
Epoch 15/100
216/216 - 1s - 4ms/step - loss: 0.0741 - val_loss: 0.1734
Epoch 16/100
216/216 - 1s - 4ms/step - loss: 0.0731 - val_loss: 0.1701
Epoch 17/100
216/216 - 1s - 4ms/step - loss: 0.0723 - val_loss: 0.1687
Epoch 18/100
216/216 - 1s - 4ms/step - loss: 0.0725 - val_loss: 0.1690
Epoch 19/100
216/216 - 1s - 4ms/step - loss: 0.0704 - val_loss: 0.1706
Epoch 20/100
216/216 - 1s - 4ms/step - loss: 0.0691 - val_loss: 0.1659
Epoch 21/100
216/216 - 1s - 4ms/step - loss: 0.0683 - val_loss: 0.1616
Epoch 22/100
216/216 - 1s - 4ms/step - loss: 0.0679 - val_loss: 0.1629
Epoch 23/100
216/216 - 1s - 4ms/step - loss: 0.0662 - val_loss: 0.1619
Epoch 24/100
216/216 - 1s - 4ms/step - loss: 0.0653 - val_loss: 0.1620
Epoch 25/100
216/216 - 1s - 4ms/step - loss: 0.0642 - val_loss: 0.1612
Epoch 26/100
216/216 - 1s - 4ms/step - loss: 0.0635 - val_loss: 0.1589
Epoch 27/100
216/216 - 1s - 4ms/step - loss: 0.0645 - val_loss: 0.1626
Epoch 28/100
216/216 - 1s - 4ms/step - loss: 0.0646 - val_loss: 0.1613
Epoch 29/100
216/216 - 1s - 4ms/step - loss: 0.0617 - val_loss: 0.1582
Epoch 30/100
216/216 - 1s - 4ms/step - loss: 0.0615 - val_loss: 0.1602
Epoch 31/100
216/216 - 1s - 4ms/step - loss: 0.0604 - val_loss: 0.1596
Epoch 32/100
216/216 - 1s - 4ms/step - loss: 0.0595 - val_loss: 0.1569
Epoch 33/100
216/216 - 1s - 4ms/step - loss: 0.0595 - val_loss: 0.1633
Epoch 34/100
216/216 - 1s - 4ms/step - loss: 0.0586 - val_loss: 0.1574
Epoch 35/100
216/216 - 1s - 4ms/step - loss: 0.0586 - val_loss: 0.1561
Epoch 36/100
216/216 - 1s - 4ms/step - loss: 0.0579 - val_loss: 0.1591
Epoch 37/100
216/216 - 1s - 4ms/step - loss: 0.0575 - val_loss: 0.1608
Epoch 38/100
216/216 - 1s - 4ms/step - loss: 0.0566 - val_loss: 0.1585
Epoch 39/100
216/216 - 1s - 4ms/step - loss: 0.0558 - val_loss: 0.1606
Epoch 40/100
216/216 - 1s - 4ms/step - loss: 0.0559 - val_loss: 0.1640
Epoch 41/100
216/216 - 1s - 4ms/step - loss: 0.0549 - val_loss: 0.1580
Epoch 42/100
216/216 - 1s - 4ms/step - loss: 0.0547 - val_loss: 0.1593
Epoch 43/100
216/216 - 1s - 4ms/step - loss: 0.0542 - val_loss: 0.1612
Epoch 44/100
216/216 - 1s - 4ms/step - loss: 0.0533 - val_loss: 0.1655
Epoch 45/100
216/216 - 1s - 4ms/step - loss: 0.0534 - val_loss: 0.1608
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3982
Per-joint RMSE: 0.4888 0.6079 0.4123 0.2526 0.2469 0.2189
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:51:05.752195: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:51:05.777161: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 08:51:06.651642: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:06.656378: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:06.657169: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:06.658844: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:06.659711: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:06.660443: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:06.744356: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:06.745277: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:06.746020: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:06.746836: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:51:07.044157: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.850094e-01  RMSE=5.338628e-01
  per-joint RMSE: 0.6184 0.8926 0.5224 0.3007 0.3070 0.2707
Residual LSTM:  MSE=1.585296e-01      RMSE=3.981578e-01
  per-joint RMSE: 0.4888 0.6079 0.4123 0.2526 0.2469 0.2189
Combined torque MSE=1.585296e-01     RMSE=3.981578e-01
  per-joint RMSE: 0.4888 0.6079 0.4123 0.2526 0.2469 0.2189
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400.npz --H 50 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400.json
H=50, n_dof=6, feature_dim=6
X_train: (68810, 50, 6)  Y_train: (68810, 6)
X_test : (13667, 50, 6)  Y_test : (13667, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:51:09.460709: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:51:09.485087: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (68810, 50, 6), Y_train = (68810, 6)
  X_test  = (13667, 50, 6),  Y_test  = (13667, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:51:10.668502: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:10.673529: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:10.674468: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:10.676278: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:10.677180: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:10.678040: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:10.764526: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:10.765487: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:10.766425: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:10.767397: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:51:11.735898: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
216/216 - 2s - 10ms/step - loss: 0.6205 - val_loss: 0.7198
Epoch 2/100
216/216 - 1s - 4ms/step - loss: 0.3514 - val_loss: 0.6669
Epoch 3/100
216/216 - 1s - 4ms/step - loss: 0.2764 - val_loss: 0.6118
Epoch 4/100
216/216 - 1s - 4ms/step - loss: 0.2398 - val_loss: 0.7316
Epoch 5/100
216/216 - 1s - 4ms/step - loss: 0.2227 - val_loss: 0.6632
Epoch 6/100
216/216 - 1s - 4ms/step - loss: 0.2112 - val_loss: 0.6069
Epoch 7/100
216/216 - 1s - 4ms/step - loss: 0.2177 - val_loss: 0.6014
Epoch 8/100
216/216 - 1s - 4ms/step - loss: 0.2259 - val_loss: 0.7624
Epoch 9/100
216/216 - 1s - 4ms/step - loss: 0.1951 - val_loss: 0.7026
Epoch 10/100
216/216 - 1s - 4ms/step - loss: 0.1846 - val_loss: 0.7685
Epoch 11/100
216/216 - 1s - 4ms/step - loss: 0.1922 - val_loss: 0.5880
Epoch 12/100
216/216 - 1s - 4ms/step - loss: 0.1898 - val_loss: 0.7707
Epoch 13/100
216/216 - 1s - 4ms/step - loss: 0.1764 - val_loss: 0.7544
Epoch 14/100
216/216 - 1s - 4ms/step - loss: 0.1641 - val_loss: 0.7473
Epoch 15/100
216/216 - 1s - 4ms/step - loss: 0.1540 - val_loss: 0.7294
Epoch 16/100
216/216 - 1s - 4ms/step - loss: 0.1467 - val_loss: 0.7233
Epoch 17/100
216/216 - 1s - 4ms/step - loss: 0.1581 - val_loss: 0.7074
Epoch 18/100
216/216 - 1s - 4ms/step - loss: 0.1511 - val_loss: 0.8117
Epoch 19/100
216/216 - 1s - 4ms/step - loss: 0.1551 - val_loss: 0.7665
Epoch 20/100
216/216 - 1s - 4ms/step - loss: 0.1413 - val_loss: 0.6637
Epoch 21/100
216/216 - 1s - 4ms/step - loss: 0.1281 - val_loss: 0.7484
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4674
Per-joint RMSE: 0.5714 0.7210 0.4601 0.2788 0.2726 0.3171
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:51:31.048367: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:51:31.072927: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 08:51:31.926557: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:31.931296: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:31.932093: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:31.933977: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:31.934882: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:31.935630: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:32.013380: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:32.014215: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:32.014959: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:32.015693: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:51:32.307308: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.850094e-01  RMSE=5.338628e-01
  per-joint RMSE: 0.6184 0.8926 0.5224 0.3007 0.3070 0.2707
Residual LSTM:  MSE=2.184445e-01      RMSE=4.673804e-01
  per-joint RMSE: 0.5714 0.7210 0.4601 0.2788 0.2726 0.3171
Combined torque MSE=2.184445e-01     RMSE=4.673804e-01
  per-joint RMSE: 0.5714 0.7210 0.4601 0.2788 0.2726 0.3171
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400.npz --H 50 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400.json
H=50, n_dof=6, feature_dim=18
X_train: (68810, 50, 18)  Y_train: (68810, 6)
X_test : (13667, 50, 18)  Y_test : (13667, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:51:34.965219: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:51:34.990233: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (68810, 50, 18), Y_train = (68810, 6)
  X_test  = (13667, 50, 18),  Y_test  = (13667, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:51:36.414751: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:36.419460: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:36.420373: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:36.421959: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:36.422863: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:36.423607: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:36.507494: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:36.508480: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:36.509285: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:51:36.510130: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8969 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:51:37.550706: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
216/216 - 2s - 10ms/step - loss: 0.2524 - val_loss: 0.3188
Epoch 2/100
216/216 - 1s - 4ms/step - loss: 0.1565 - val_loss: 0.2886
Epoch 3/100
216/216 - 1s - 4ms/step - loss: 0.1395 - val_loss: 0.2816
Epoch 4/100
216/216 - 1s - 4ms/step - loss: 0.1289 - val_loss: 0.2764
Epoch 5/100
216/216 - 1s - 4ms/step - loss: 0.1218 - val_loss: 0.2753
Epoch 6/100
216/216 - 1s - 4ms/step - loss: 0.1159 - val_loss: 0.2742
Epoch 7/100
216/216 - 1s - 4ms/step - loss: 0.1111 - val_loss: 0.2710
Epoch 8/100
216/216 - 1s - 4ms/step - loss: 0.1091 - val_loss: 0.2643
Epoch 9/100
216/216 - 1s - 4ms/step - loss: 0.1050 - val_loss: 0.2584
Epoch 10/100
216/216 - 1s - 4ms/step - loss: 0.1013 - val_loss: 0.2604
Epoch 11/100
216/216 - 1s - 4ms/step - loss: 0.0993 - val_loss: 0.2566
Epoch 12/100
216/216 - 1s - 4ms/step - loss: 0.0987 - val_loss: 0.2555
Epoch 13/100
216/216 - 1s - 4ms/step - loss: 0.0955 - val_loss: 0.2599
Epoch 14/100
216/216 - 1s - 4ms/step - loss: 0.0932 - val_loss: 0.2540
Epoch 15/100
216/216 - 1s - 4ms/step - loss: 0.0918 - val_loss: 0.2548
Epoch 16/100
216/216 - 1s - 4ms/step - loss: 0.0905 - val_loss: 0.2555
Epoch 17/100
216/216 - 1s - 4ms/step - loss: 0.0899 - val_loss: 0.2530
Epoch 18/100
216/216 - 1s - 4ms/step - loss: 0.0878 - val_loss: 0.2496
Epoch 19/100
216/216 - 1s - 4ms/step - loss: 0.0881 - val_loss: 0.2514
Epoch 20/100
216/216 - 1s - 4ms/step - loss: 0.0857 - val_loss: 0.2486
Epoch 21/100
216/216 - 1s - 4ms/step - loss: 0.0830 - val_loss: 0.2489
Epoch 22/100
216/216 - 1s - 4ms/step - loss: 0.0825 - val_loss: 0.2525
Epoch 23/100
216/216 - 1s - 4ms/step - loss: 0.0818 - val_loss: 0.2482
Epoch 24/100
216/216 - 1s - 4ms/step - loss: 0.0831 - val_loss: 0.2556
Epoch 25/100
216/216 - 1s - 4ms/step - loss: 0.0817 - val_loss: 0.2437
Epoch 26/100
216/216 - 1s - 4ms/step - loss: 0.0792 - val_loss: 0.2407
Epoch 27/100
216/216 - 1s - 4ms/step - loss: 0.0797 - val_loss: 0.2460
Epoch 28/100
216/216 - 1s - 4ms/step - loss: 0.0808 - val_loss: 0.2436
Epoch 29/100
216/216 - 1s - 4ms/step - loss: 0.0787 - val_loss: 0.2421
Epoch 30/100
216/216 - 1s - 4ms/step - loss: 0.0749 - val_loss: 0.2401
Epoch 31/100
216/216 - 1s - 4ms/step - loss: 0.0754 - val_loss: 0.2477
Epoch 32/100
216/216 - 1s - 4ms/step - loss: 0.0745 - val_loss: 0.2427
Epoch 33/100
216/216 - 1s - 4ms/step - loss: 0.0744 - val_loss: 0.2483
Epoch 34/100
216/216 - 1s - 4ms/step - loss: 0.0723 - val_loss: 0.2433
Epoch 35/100
216/216 - 1s - 4ms/step - loss: 0.0715 - val_loss: 0.2395
Epoch 36/100
216/216 - 1s - 4ms/step - loss: 0.0703 - val_loss: 0.2443
Epoch 37/100
216/216 - 1s - 4ms/step - loss: 0.0719 - val_loss: 0.2421
Epoch 38/100
216/216 - 1s - 4ms/step - loss: 0.0700 - val_loss: 0.2417
Epoch 39/100
216/216 - 1s - 4ms/step - loss: 0.0698 - val_loss: 0.2415
Epoch 40/100
216/216 - 1s - 4ms/step - loss: 0.0698 - val_loss: 0.2404
Epoch 41/100
216/216 - 1s - 4ms/step - loss: 0.0690 - val_loss: 0.2450
Epoch 42/100
216/216 - 1s - 4ms/step - loss: 0.0666 - val_loss: 0.2434
Epoch 43/100
216/216 - 1s - 4ms/step - loss: 0.0695 - val_loss: 0.2598
Epoch 44/100
216/216 - 1s - 4ms/step - loss: 0.0753 - val_loss: 0.2489
Epoch 45/100
216/216 - 1s - 4ms/step - loss: 0.0702 - val_loss: 0.2509
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4607
Per-joint RMSE: 0.5640 0.7269 0.4516 0.2657 0.2860 0.2655
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:52:16.779783: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:52:16.804715: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 08:52:17.672907: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:52:17.677628: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:52:17.678501: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:52:17.680193: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:52:17.680987: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:52:17.681732: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:52:17.760491: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:52:17.761332: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:52:17.762160: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:52:17.762890: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:52:18.056672: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.850094e-01  RMSE=5.338628e-01
  per-joint RMSE: 0.6184 0.8926 0.5224 0.3007 0.3070 0.2707
Residual LSTM:  MSE=2.122089e-01      RMSE=4.606614e-01
  per-joint RMSE: 0.5640 0.7269 0.4516 0.2657 0.2860 0.2655
Combined torque MSE=2.122089e-01     RMSE=4.606614e-01
  per-joint RMSE: 0.5640 0.7269 0.4516 0.2657 0.2860 0.2655
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400.npz --H 50 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400.json
H=50, n_dof=6, feature_dim=18
X_train: (68810, 50, 18)  Y_train: (68810, 6)
X_test : (13667, 50, 18)  Y_test : (13667, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:52:20.627694: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:52:20.651934: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (68810, 50, 18), Y_train = (68810, 6)
  X_test  = (13667, 50, 18),  Y_test  = (13667, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:52:22.071112: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:52:22.075920: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:52:22.076836: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:52:22.078535: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:52:22.079451: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:52:22.080316: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:52:22.173136: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:52:22.174042: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:52:22.174845: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:52:22.175643: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8969 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:52:23.251250: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
216/216 - 2s - 10ms/step - loss: 0.2366 - val_loss: 0.2587
Epoch 2/100
216/216 - 1s - 4ms/step - loss: 0.1366 - val_loss: 0.2247
Epoch 3/100
216/216 - 1s - 4ms/step - loss: 0.1184 - val_loss: 0.2179
Epoch 4/100
216/216 - 1s - 4ms/step - loss: 0.1088 - val_loss: 0.2147
Epoch 5/100
216/216 - 1s - 4ms/step - loss: 0.1017 - val_loss: 0.2133
Epoch 6/100
216/216 - 1s - 4ms/step - loss: 0.0962 - val_loss: 0.2131
Epoch 7/100
216/216 - 1s - 4ms/step - loss: 0.0943 - val_loss: 0.2075
Epoch 8/100
216/216 - 1s - 4ms/step - loss: 0.0916 - val_loss: 0.2051
Epoch 9/100
216/216 - 1s - 4ms/step - loss: 0.0881 - val_loss: 0.2018
Epoch 10/100
216/216 - 1s - 4ms/step - loss: 0.0853 - val_loss: 0.2043
Epoch 11/100
216/216 - 1s - 4ms/step - loss: 0.0823 - val_loss: 0.2014
Epoch 12/100
216/216 - 1s - 4ms/step - loss: 0.0801 - val_loss: 0.2021
Epoch 13/100
216/216 - 1s - 4ms/step - loss: 0.0780 - val_loss: 0.2012
Epoch 14/100
216/216 - 1s - 4ms/step - loss: 0.0761 - val_loss: 0.1982
Epoch 15/100
216/216 - 1s - 4ms/step - loss: 0.0754 - val_loss: 0.1972
Epoch 16/100
216/216 - 1s - 4ms/step - loss: 0.0737 - val_loss: 0.1995
Epoch 17/100
216/216 - 1s - 4ms/step - loss: 0.0723 - val_loss: 0.1969
Epoch 18/100
216/216 - 1s - 4ms/step - loss: 0.0711 - val_loss: 0.1946
Epoch 19/100
216/216 - 1s - 4ms/step - loss: 0.0700 - val_loss: 0.1898
Epoch 20/100
216/216 - 1s - 4ms/step - loss: 0.0693 - val_loss: 0.1895
Epoch 21/100
216/216 - 1s - 4ms/step - loss: 0.0686 - val_loss: 0.1906
Epoch 22/100
216/216 - 1s - 4ms/step - loss: 0.0679 - val_loss: 0.1914
Epoch 23/100
216/216 - 1s - 4ms/step - loss: 0.0667 - val_loss: 0.1901
Epoch 24/100
216/216 - 1s - 4ms/step - loss: 0.0657 - val_loss: 0.1897
Epoch 25/100
216/216 - 1s - 4ms/step - loss: 0.0647 - val_loss: 0.1878
Epoch 26/100
216/216 - 1s - 4ms/step - loss: 0.0647 - val_loss: 0.1880
Epoch 27/100
216/216 - 1s - 4ms/step - loss: 0.0632 - val_loss: 0.1874
Epoch 28/100
216/216 - 1s - 4ms/step - loss: 0.0631 - val_loss: 0.1816
Epoch 29/100
216/216 - 1s - 4ms/step - loss: 0.0627 - val_loss: 0.1845
Epoch 30/100
216/216 - 1s - 4ms/step - loss: 0.0622 - val_loss: 0.1834
Epoch 31/100
216/216 - 1s - 4ms/step - loss: 0.0614 - val_loss: 0.1791
Epoch 32/100
216/216 - 1s - 4ms/step - loss: 0.0621 - val_loss: 0.1818
Epoch 33/100
216/216 - 1s - 4ms/step - loss: 0.0611 - val_loss: 0.1778
Epoch 34/100
216/216 - 1s - 4ms/step - loss: 0.0607 - val_loss: 0.1803
Epoch 35/100
216/216 - 1s - 4ms/step - loss: 0.0594 - val_loss: 0.1803
Epoch 36/100
216/216 - 1s - 4ms/step - loss: 0.0593 - val_loss: 0.1766
Epoch 37/100
216/216 - 1s - 4ms/step - loss: 0.0588 - val_loss: 0.1761
Epoch 38/100
216/216 - 1s - 4ms/step - loss: 0.0586 - val_loss: 0.1762
Epoch 39/100
216/216 - 1s - 4ms/step - loss: 0.0580 - val_loss: 0.1762
Epoch 40/100
216/216 - 1s - 4ms/step - loss: 0.0571 - val_loss: 0.1748
Epoch 41/100
216/216 - 1s - 4ms/step - loss: 0.0570 - val_loss: 0.1757
Epoch 42/100
216/216 - 1s - 4ms/step - loss: 0.0566 - val_loss: 0.1742
Epoch 43/100
216/216 - 1s - 4ms/step - loss: 0.0563 - val_loss: 0.1736
Epoch 44/100
216/216 - 1s - 4ms/step - loss: 0.0553 - val_loss: 0.1776
Epoch 45/100
216/216 - 1s - 4ms/step - loss: 0.0551 - val_loss: 0.1770
Epoch 46/100
216/216 - 1s - 4ms/step - loss: 0.0548 - val_loss: 0.1792
Epoch 47/100
216/216 - 1s - 4ms/step - loss: 0.0541 - val_loss: 0.1720
Epoch 48/100
216/216 - 1s - 4ms/step - loss: 0.0539 - val_loss: 0.1726
Epoch 49/100
216/216 - 1s - 4ms/step - loss: 0.0535 - val_loss: 0.1736
Epoch 50/100
216/216 - 1s - 4ms/step - loss: 0.0528 - val_loss: 0.1753
Epoch 51/100
216/216 - 1s - 4ms/step - loss: 0.0523 - val_loss: 0.1731
Epoch 52/100
216/216 - 1s - 4ms/step - loss: 0.0520 - val_loss: 0.1738
Epoch 53/100
216/216 - 1s - 4ms/step - loss: 0.0511 - val_loss: 0.1736
Epoch 54/100
216/216 - 1s - 4ms/step - loss: 0.0514 - val_loss: 0.1732
Epoch 55/100
216/216 - 1s - 4ms/step - loss: 0.0509 - val_loss: 0.1713
Epoch 56/100
216/216 - 1s - 4ms/step - loss: 0.0508 - val_loss: 0.1710
Epoch 57/100
216/216 - 1s - 4ms/step - loss: 0.0500 - val_loss: 0.1724
Epoch 58/100
216/216 - 1s - 4ms/step - loss: 0.0493 - val_loss: 0.1701
Epoch 59/100
216/216 - 1s - 4ms/step - loss: 0.0489 - val_loss: 0.1707
Epoch 60/100
216/216 - 1s - 4ms/step - loss: 0.0483 - val_loss: 0.1668
Epoch 61/100
216/216 - 1s - 4ms/step - loss: 0.0480 - val_loss: 0.1705
Epoch 62/100
216/216 - 1s - 4ms/step - loss: 0.0477 - val_loss: 0.1692
Epoch 63/100
216/216 - 1s - 4ms/step - loss: 0.0474 - val_loss: 0.1695
Epoch 64/100
216/216 - 1s - 4ms/step - loss: 0.0472 - val_loss: 0.1657
Epoch 65/100
216/216 - 1s - 4ms/step - loss: 0.0467 - val_loss: 0.1672
Epoch 66/100
216/216 - 1s - 4ms/step - loss: 0.0466 - val_loss: 0.1671
Epoch 67/100
216/216 - 1s - 4ms/step - loss: 0.0461 - val_loss: 0.1707
Epoch 68/100
216/216 - 1s - 4ms/step - loss: 0.0458 - val_loss: 0.1682
Epoch 69/100
216/216 - 1s - 4ms/step - loss: 0.0455 - val_loss: 0.1686
Epoch 70/100
216/216 - 1s - 4ms/step - loss: 0.0452 - val_loss: 0.1654
Epoch 71/100
216/216 - 1s - 4ms/step - loss: 0.0449 - val_loss: 0.1684
Epoch 72/100
216/216 - 1s - 4ms/step - loss: 0.0448 - val_loss: 0.1656
Epoch 73/100
216/216 - 1s - 4ms/step - loss: 0.0446 - val_loss: 0.1720
Epoch 74/100
216/216 - 1s - 4ms/step - loss: 0.0442 - val_loss: 0.1672
Epoch 75/100
216/216 - 1s - 4ms/step - loss: 0.0436 - val_loss: 0.1690
Epoch 76/100
216/216 - 1s - 4ms/step - loss: 0.0436 - val_loss: 0.1671
Epoch 77/100
216/216 - 1s - 4ms/step - loss: 0.0435 - val_loss: 0.1682
Epoch 78/100
216/216 - 1s - 4ms/step - loss: 0.0432 - val_loss: 0.1695
Epoch 79/100
216/216 - 1s - 4ms/step - loss: 0.0431 - val_loss: 0.1683
Epoch 80/100
216/216 - 1s - 4ms/step - loss: 0.0430 - val_loss: 0.1673
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4025
Per-joint RMSE: 0.4812 0.6287 0.4160 0.2583 0.2436 0.2146
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:53:33.103403: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:53:33.128265: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p2__residual__delan_jax_struct_s2_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 08:53:33.987557: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:53:33.992259: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:53:33.993060: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:53:33.994686: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:53:33.995487: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:53:33.996226: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:53:34.075951: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:53:34.076787: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:53:34.077539: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:53:34.078272: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8835 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:53:34.371519: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.850094e-01  RMSE=5.338628e-01
  per-joint RMSE: 0.6184 0.8926 0.5224 0.3007 0.3070 0.2707
Residual LSTM:  MSE=1.620051e-01      RMSE=4.024986e-01
  per-joint RMSE: 0.4812 0.6287 0.4160 0.2583 0.2436 0.2146
Combined torque MSE=1.620051e-01     RMSE=4.024986e-01
  per-joint RMSE: 0.4812 0.6287 0.4160 0.2583 0.2436 0.2146
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p2__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

