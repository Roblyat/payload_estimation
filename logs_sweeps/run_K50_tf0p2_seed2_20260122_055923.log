################################################################################################################
### RUN: K=50 test_fraction=0.2 seed=2                                                                       ###
### npz_in=/workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed2_dataset.npz ###
################################################################################################################

#####################
### 1) PREPROCESS ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_delan_dataset.py --qdd True --col_format wide --trajectory_amount 50 --test_fraction 0.2 --seed 2 --raw_csv /workspace/shared/data/raw/delan_UR3_Load0_combined_26.csv --out_npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed2_dataset.npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Saved: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed2_dataset.npz
Trajectories: train=40 test=10
Exists: True

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=0                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz                                 ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed2_dataset.npz -t structured -s 0 -r 0 --hp_preset fast_debug --epochs 200 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200.jax' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 200, 'lagrangian_type': <function structured_lagrangian_fn at 0x7a0b0c1501f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed2_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed2_dataset.npz
   dt ≈ 0.023660096398761724
  dof = 6
  Train trajectories = 40
  Test trajectories  = 10
  Train samples = 23551
  Test samples  = 2018
################################################

2026-01-22 05:39:06.830256: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200 | type=structured | dof=6
################################################
2026-01-22 05:39:09.957711: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:39:09.957757: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:39:09.957766: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:39:09.957800: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:39:09.957807: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:39:09.957826: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:39:09.957874: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:39:09.957880: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:39:09.957896: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:39:09.957903: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   4.8s, Loss=2.20e+01, Inv=2.20e+01, For=1.71e+02, Power=4.29e+00
2026-01-22 05:39:14.680232: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  [eval] test_mse=7.429e+00  (n=2018)
Epoch 00050: Time=   9.2s, Loss=2.66e+00, Inv=2.66e+00, For=9.66e+01, Power=1.68e+00
Epoch 00100: Time=  12.2s, Loss=2.07e+00, Inv=2.07e+00, For=8.16e+01, Power=1.47e+00
Epoch 00150: Time=  15.2s, Loss=1.89e+00, Inv=1.89e+00, For=8.03e+01, Power=1.35e+00
Epoch 00200: Time=  18.1s, Loss=1.81e+00, Inv=1.81e+00, For=8.00e+01, Power=1.27e+00
  [eval] test_mse=3.225e+00  (n=2018)
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200
Torque MSE  = 5.375e-01
Torque RMSE = 7.332e-01
Per-joint MSE : 7.023e-01 4.445e-01 6.502e-01 2.628e-01 2.645e-01 9.007e-01
Per-joint RMSE: 8.381e-01 6.667e-01 8.064e-01 5.127e-01 5.143e-01 9.491e-01
Comp Time per Sample = 1.196e-07s / 8359257.4Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed2_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed2_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep200.jax
Detected n_dof=6 (seed=0)
2026-01-22 05:39:30.167554: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 40 trajectories
2026-01-22 05:39:31.459870: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:39:31.459883: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:39:32.915762: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:39:32.915774: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:39:34.467251: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/40
  done 40/40

Exporting split=test: 10 trajectories
  done 10/10

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200.npz --H 25 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200.json
H=25, n_dof=6, feature_dim=24
X_train: (22948, 25, 24)  Y_train: (22948, 6)
X_test : (1904, 25, 24)  Y_test : (1904, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:39:36.562348: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:39:36.586566: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep200.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (22948, 25, 24), Y_train = (22948, 6)
  X_test  = (1904, 25, 24),  Y_test  = (1904, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:39:37.589894: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:37.594527: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:37.595372: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:37.597159: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:37.598001: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:37.598791: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:37.674135: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:37.675035: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:37.675896: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:37.676670: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8952 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:39:38.634165: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
72/72 - 2s - 22ms/step - loss: 0.3736 - val_loss: 0.4621
Epoch 2/50
72/72 - 0s - 3ms/step - loss: 0.1989 - val_loss: 0.4246
Epoch 3/50
72/72 - 0s - 3ms/step - loss: 0.1626 - val_loss: 0.4144
Epoch 4/50
72/72 - 0s - 3ms/step - loss: 0.1452 - val_loss: 0.4041
Epoch 5/50
72/72 - 0s - 3ms/step - loss: 0.1347 - val_loss: 0.4019
Epoch 6/50
72/72 - 0s - 3ms/step - loss: 0.1269 - val_loss: 0.3957
Epoch 7/50
72/72 - 0s - 3ms/step - loss: 0.1229 - val_loss: 0.3963
Epoch 8/50
72/72 - 0s - 3ms/step - loss: 0.1183 - val_loss: 0.3927
Epoch 9/50
72/72 - 0s - 3ms/step - loss: 0.1145 - val_loss: 0.3968
Epoch 10/50
72/72 - 0s - 3ms/step - loss: 0.1129 - val_loss: 0.3888
Epoch 11/50
72/72 - 0s - 3ms/step - loss: 0.1083 - val_loss: 0.3947
Epoch 12/50
72/72 - 0s - 3ms/step - loss: 0.1077 - val_loss: 0.3898
Epoch 13/50
72/72 - 0s - 3ms/step - loss: 0.1060 - val_loss: 0.3833
Epoch 14/50
72/72 - 0s - 4ms/step - loss: 0.1036 - val_loss: 0.3818
Epoch 15/50
72/72 - 0s - 3ms/step - loss: 0.1025 - val_loss: 0.3732
Epoch 16/50
72/72 - 0s - 3ms/step - loss: 0.1005 - val_loss: 0.3727
Epoch 17/50
72/72 - 0s - 3ms/step - loss: 0.0985 - val_loss: 0.3807
Epoch 18/50
72/72 - 0s - 3ms/step - loss: 0.0981 - val_loss: 0.3787
Epoch 19/50
72/72 - 0s - 3ms/step - loss: 0.0977 - val_loss: 0.3666
Epoch 20/50
72/72 - 0s - 3ms/step - loss: 0.0953 - val_loss: 0.3699
Epoch 21/50
72/72 - 0s - 3ms/step - loss: 0.0947 - val_loss: 0.3700
Epoch 22/50
72/72 - 0s - 3ms/step - loss: 0.0941 - val_loss: 0.3726
Epoch 23/50
72/72 - 0s - 3ms/step - loss: 0.0929 - val_loss: 0.3737
Epoch 24/50
72/72 - 0s - 3ms/step - loss: 0.0929 - val_loss: 0.3766
Epoch 25/50
72/72 - 0s - 3ms/step - loss: 0.0912 - val_loss: 0.3690
Epoch 26/50
72/72 - 0s - 3ms/step - loss: 0.0908 - val_loss: 0.3765
Epoch 27/50
72/72 - 0s - 3ms/step - loss: 0.0914 - val_loss: 0.3665
Epoch 28/50
72/72 - 0s - 3ms/step - loss: 0.0897 - val_loss: 0.3750
Epoch 29/50
72/72 - 0s - 3ms/step - loss: 0.0891 - val_loss: 0.3737
Epoch 30/50
72/72 - 0s - 3ms/step - loss: 0.0889 - val_loss: 0.3687
Epoch 31/50
72/72 - 0s - 3ms/step - loss: 0.0873 - val_loss: 0.3745
Epoch 32/50
72/72 - 0s - 3ms/step - loss: 0.0877 - val_loss: 0.3730
Epoch 33/50
72/72 - 0s - 3ms/step - loss: 0.0871 - val_loss: 0.3718
Epoch 34/50
72/72 - 0s - 3ms/step - loss: 0.0865 - val_loss: 0.3722
Epoch 35/50
72/72 - 0s - 3ms/step - loss: 0.0863 - val_loss: 0.3644
Epoch 36/50
72/72 - 0s - 3ms/step - loss: 0.0857 - val_loss: 0.3648
Epoch 37/50
72/72 - 0s - 3ms/step - loss: 0.0846 - val_loss: 0.3750
Epoch 38/50
72/72 - 0s - 3ms/step - loss: 0.0852 - val_loss: 0.3752
Epoch 39/50
72/72 - 0s - 3ms/step - loss: 0.0843 - val_loss: 0.3721
Epoch 40/50
72/72 - 0s - 3ms/step - loss: 0.0829 - val_loss: 0.3684
Epoch 41/50
72/72 - 0s - 3ms/step - loss: 0.0839 - val_loss: 0.3708
Epoch 42/50
72/72 - 0s - 3ms/step - loss: 0.0829 - val_loss: 0.3683
Epoch 43/50
72/72 - 0s - 3ms/step - loss: 0.0831 - val_loss: 0.3674
Epoch 44/50
72/72 - 0s - 3ms/step - loss: 0.0817 - val_loss: 0.3713
Epoch 45/50
72/72 - 0s - 3ms/step - loss: 0.0809 - val_loss: 0.3679
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6837
Per-joint RMSE: 0.8091 0.6513 0.7580 0.4810 0.4566 0.8435
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:39:49.435472: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:39:49.460600: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 05:39:50.313460: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:50.318209: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:50.318998: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:50.320701: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:50.321493: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:50.322233: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:50.400736: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:50.401661: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:50.402404: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:50.403128: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:39:50.702952: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 10/10

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.594903e-01  RMSE=7.479908e-01
  per-joint RMSE: 0.8562 0.6642 0.8266 0.5248 0.5278 0.9724
Residual LSTM:  MSE=4.674553e-01      RMSE=6.837070e-01
  per-joint RMSE: 0.8091 0.6513 0.7580 0.4810 0.4566 0.8435
Combined torque MSE=4.674553e-01     RMSE=6.837070e-01
  per-joint RMSE: 0.8091 0.6513 0.7580 0.4810 0.4566 0.8435
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200.npz --H 25 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200.json
H=25, n_dof=6, feature_dim=6
X_train: (22948, 25, 6)  Y_train: (22948, 6)
X_test : (1904, 25, 6)  Y_test : (1904, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:39:52.563837: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:39:52.588000: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep200.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (22948, 25, 6), Y_train = (22948, 6)
  X_test  = (1904, 25, 6),  Y_test  = (1904, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:39:53.535880: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:53.540391: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:53.541176: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:53.542767: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:53.543543: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:53.544283: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:53.620121: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:53.621041: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:53.621787: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:39:53.622519: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:39:54.521549: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
72/72 - 2s - 21ms/step - loss: 0.6551 - val_loss: 0.7047
Epoch 2/50
72/72 - 0s - 3ms/step - loss: 0.4490 - val_loss: 0.5404
Epoch 3/50
72/72 - 0s - 3ms/step - loss: 0.3487 - val_loss: 0.5593
Epoch 4/50
72/72 - 0s - 3ms/step - loss: 0.2896 - val_loss: 0.5748
Epoch 5/50
72/72 - 0s - 3ms/step - loss: 0.2347 - val_loss: 0.5820
Epoch 6/50
72/72 - 0s - 3ms/step - loss: 0.2040 - val_loss: 0.5801
Epoch 7/50
72/72 - 0s - 3ms/step - loss: 0.1745 - val_loss: 0.5715
Epoch 8/50
72/72 - 0s - 3ms/step - loss: 0.1607 - val_loss: 0.5391
Epoch 9/50
72/72 - 0s - 3ms/step - loss: 0.1537 - val_loss: 0.4976
Epoch 10/50
72/72 - 0s - 3ms/step - loss: 0.1454 - val_loss: 0.5029
Epoch 11/50
72/72 - 0s - 3ms/step - loss: 0.1414 - val_loss: 0.5022
Epoch 12/50
72/72 - 0s - 3ms/step - loss: 0.1377 - val_loss: 0.4910
Epoch 13/50
72/72 - 0s - 3ms/step - loss: 0.1299 - val_loss: 0.4876
Epoch 14/50
72/72 - 0s - 4ms/step - loss: 0.1280 - val_loss: 0.4857
Epoch 15/50
72/72 - 0s - 3ms/step - loss: 0.1269 - val_loss: 0.4965
Epoch 16/50
72/72 - 0s - 3ms/step - loss: 0.1246 - val_loss: 0.4953
Epoch 17/50
72/72 - 0s - 3ms/step - loss: 0.1195 - val_loss: 0.5080
Epoch 18/50
72/72 - 0s - 3ms/step - loss: 0.1185 - val_loss: 0.4981
Epoch 19/50
72/72 - 0s - 3ms/step - loss: 0.1159 - val_loss: 0.5048
Epoch 20/50
72/72 - 0s - 3ms/step - loss: 0.1157 - val_loss: 0.5008
Epoch 21/50
72/72 - 0s - 3ms/step - loss: 0.1131 - val_loss: 0.5042
Epoch 22/50
72/72 - 0s - 3ms/step - loss: 0.1151 - val_loss: 0.4874
Epoch 23/50
72/72 - 0s - 3ms/step - loss: 0.1172 - val_loss: 0.5070
Epoch 24/50
72/72 - 0s - 3ms/step - loss: 0.1107 - val_loss: 0.4987
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7482
Per-joint RMSE: 0.7716 0.8025 0.8232 0.4902 0.5430 0.9520
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:40:00.910354: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:40:00.935390: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 05:40:01.792013: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:01.796812: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:01.797677: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:01.799314: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:01.800097: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:01.800830: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:01.887172: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:01.888094: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:01.888841: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:01.889571: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:40:02.185925: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 10/10

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.594903e-01  RMSE=7.479908e-01
  per-joint RMSE: 0.8562 0.6642 0.8266 0.5248 0.5278 0.9724
Residual LSTM:  MSE=5.597317e-01      RMSE=7.481521e-01
  per-joint RMSE: 0.7715 0.8024 0.8232 0.4902 0.5430 0.9520
Combined torque MSE=5.597316e-01     RMSE=7.481521e-01
  per-joint RMSE: 0.7715 0.8024 0.8232 0.4902 0.5430 0.9520
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200.npz --H 25 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200.json
H=25, n_dof=6, feature_dim=18
X_train: (22948, 25, 18)  Y_train: (22948, 6)
X_test : (1904, 25, 18)  Y_test : (1904, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:40:04.053990: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:40:04.078241: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep200.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (22948, 25, 18), Y_train = (22948, 6)
  X_test  = (1904, 25, 18),  Y_test  = (1904, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:40:05.079671: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:05.084312: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:05.085188: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:05.087010: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:05.087807: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:05.088556: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:05.165040: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:05.165959: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:05.166712: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:05.167452: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:40:06.117047: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
72/72 - 2s - 22ms/step - loss: 0.3894 - val_loss: 0.6226
Epoch 2/50
72/72 - 0s - 3ms/step - loss: 0.2350 - val_loss: 0.5798
Epoch 3/50
72/72 - 0s - 3ms/step - loss: 0.1943 - val_loss: 0.5417
Epoch 4/50
72/72 - 0s - 3ms/step - loss: 0.1651 - val_loss: 0.5566
Epoch 5/50
72/72 - 0s - 3ms/step - loss: 0.1488 - val_loss: 0.5664
Epoch 6/50
72/72 - 0s - 3ms/step - loss: 0.1404 - val_loss: 0.5580
Epoch 7/50
72/72 - 0s - 3ms/step - loss: 0.1319 - val_loss: 0.5651
Epoch 8/50
72/72 - 0s - 3ms/step - loss: 0.1274 - val_loss: 0.5653
Epoch 9/50
72/72 - 0s - 3ms/step - loss: 0.1218 - val_loss: 0.5609
Epoch 10/50
72/72 - 0s - 3ms/step - loss: 0.1192 - val_loss: 0.5622
Epoch 11/50
72/72 - 0s - 3ms/step - loss: 0.1152 - val_loss: 0.5662
Epoch 12/50
72/72 - 0s - 3ms/step - loss: 0.1150 - val_loss: 0.5586
Epoch 13/50
72/72 - 0s - 3ms/step - loss: 0.1099 - val_loss: 0.5603
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7521
Per-joint RMSE: 0.8910 0.6748 0.7828 0.5355 0.5451 0.9735
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:40:10.387638: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:40:10.412001: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:40:11.269454: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:11.274121: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:11.274906: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:11.276624: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:11.277403: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:11.278135: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:11.356917: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:11.357830: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:11.358572: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:11.359301: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:40:11.651914: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 10/10

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.594903e-01  RMSE=7.479908e-01
  per-joint RMSE: 0.8562 0.6642 0.8266 0.5248 0.5278 0.9724
Residual LSTM:  MSE=5.656312e-01      RMSE=7.520846e-01
  per-joint RMSE: 0.8910 0.6748 0.7828 0.5355 0.5451 0.9735
Combined torque MSE=5.656312e-01     RMSE=7.520846e-01
  per-joint RMSE: 0.8910 0.6748 0.7828 0.5355 0.5451 0.9735
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200.npz --H 25 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200.json
H=25, n_dof=6, feature_dim=18
X_train: (22948, 25, 18)  Y_train: (22948, 6)
X_test : (1904, 25, 18)  Y_test : (1904, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:40:13.543247: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:40:13.566884: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep200.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (22948, 25, 18), Y_train = (22948, 6)
  X_test  = (1904, 25, 18),  Y_test  = (1904, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:40:14.571040: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:14.575821: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:14.576745: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:14.578490: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:14.579274: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:14.580009: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:14.657139: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:14.658045: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:14.658784: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:14.659516: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:40:15.599466: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
72/72 - 2s - 21ms/step - loss: 0.3741 - val_loss: 0.4370
Epoch 2/50
72/72 - 0s - 3ms/step - loss: 0.2022 - val_loss: 0.3964
Epoch 3/50
72/72 - 0s - 3ms/step - loss: 0.1675 - val_loss: 0.3894
Epoch 4/50
72/72 - 0s - 3ms/step - loss: 0.1497 - val_loss: 0.3761
Epoch 5/50
72/72 - 0s - 3ms/step - loss: 0.1386 - val_loss: 0.3722
Epoch 6/50
72/72 - 0s - 3ms/step - loss: 0.1316 - val_loss: 0.3706
Epoch 7/50
72/72 - 0s - 3ms/step - loss: 0.1251 - val_loss: 0.3754
Epoch 8/50
72/72 - 0s - 3ms/step - loss: 0.1201 - val_loss: 0.3698
Epoch 9/50
72/72 - 0s - 3ms/step - loss: 0.1163 - val_loss: 0.3720
Epoch 10/50
72/72 - 0s - 3ms/step - loss: 0.1131 - val_loss: 0.3606
Epoch 11/50
72/72 - 0s - 3ms/step - loss: 0.1112 - val_loss: 0.3621
Epoch 12/50
72/72 - 0s - 3ms/step - loss: 0.1088 - val_loss: 0.3617
Epoch 13/50
72/72 - 0s - 3ms/step - loss: 0.1076 - val_loss: 0.3629
Epoch 14/50
72/72 - 0s - 3ms/step - loss: 0.1047 - val_loss: 0.3616
Epoch 15/50
72/72 - 0s - 4ms/step - loss: 0.1043 - val_loss: 0.3601
Epoch 16/50
72/72 - 0s - 3ms/step - loss: 0.1012 - val_loss: 0.3619
Epoch 17/50
72/72 - 0s - 3ms/step - loss: 0.0995 - val_loss: 0.3651
Epoch 18/50
72/72 - 0s - 3ms/step - loss: 0.0986 - val_loss: 0.3594
Epoch 19/50
72/72 - 0s - 3ms/step - loss: 0.0976 - val_loss: 0.3602
Epoch 20/50
72/72 - 0s - 3ms/step - loss: 0.0972 - val_loss: 0.3518
Epoch 21/50
72/72 - 0s - 3ms/step - loss: 0.0950 - val_loss: 0.3581
Epoch 22/50
72/72 - 0s - 3ms/step - loss: 0.0939 - val_loss: 0.3527
Epoch 23/50
72/72 - 0s - 3ms/step - loss: 0.0934 - val_loss: 0.3524
Epoch 24/50
72/72 - 0s - 3ms/step - loss: 0.0925 - val_loss: 0.3592
Epoch 25/50
72/72 - 0s - 3ms/step - loss: 0.0915 - val_loss: 0.3537
Epoch 26/50
72/72 - 0s - 3ms/step - loss: 0.0913 - val_loss: 0.3544
Epoch 27/50
72/72 - 0s - 3ms/step - loss: 0.0911 - val_loss: 0.3573
Epoch 28/50
72/72 - 0s - 3ms/step - loss: 0.0909 - val_loss: 0.3561
Epoch 29/50
72/72 - 0s - 3ms/step - loss: 0.0892 - val_loss: 0.3593
Epoch 30/50
72/72 - 0s - 3ms/step - loss: 0.0884 - val_loss: 0.3534
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6899
Per-joint RMSE: 0.7128 0.7231 0.7477 0.5347 0.4748 0.8686
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:40:23.373419: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:40:23.397970: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:40:24.236403: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:24.241158: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:24.241955: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:24.243628: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:24.244424: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:24.245160: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:24.318441: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:24.319356: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:24.320101: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:24.320828: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:40:24.616311: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 10/10

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.594903e-01  RMSE=7.479908e-01
  per-joint RMSE: 0.8562 0.6642 0.8266 0.5248 0.5278 0.9724
Residual LSTM:  MSE=4.759857e-01      RMSE=6.899172e-01
  per-joint RMSE: 0.7128 0.7231 0.7477 0.5347 0.4748 0.8686
Combined torque MSE=4.759857e-01     RMSE=6.899172e-01
  per-joint RMSE: 0.7128 0.7231 0.7477 0.5347 0.4748 0.8686
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200.npz --H 50 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200.json
H=50, n_dof=6, feature_dim=24
X_train: (22373, 50, 24)  Y_train: (22373, 6)
X_test : (1804, 50, 24)  Y_test : (1804, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:40:26.541018: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:40:26.565221: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (22373, 50, 24), Y_train = (22373, 6)
  X_test  = (1804, 50, 24),  Y_test  = (1804, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:40:27.667751: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:27.672330: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:27.673199: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:27.674780: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:27.675564: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:27.676306: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:27.752366: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:27.753351: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:27.754092: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:27.754822: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:40:28.751981: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
70/70 - 2s - 24ms/step - loss: 0.3795 - val_loss: 0.4965
Epoch 2/50
70/70 - 0s - 4ms/step - loss: 0.2022 - val_loss: 0.4420
Epoch 3/50
70/70 - 0s - 4ms/step - loss: 0.1660 - val_loss: 0.4322
Epoch 4/50
70/70 - 0s - 4ms/step - loss: 0.1499 - val_loss: 0.4336
Epoch 5/50
70/70 - 0s - 4ms/step - loss: 0.1410 - val_loss: 0.4360
Epoch 6/50
70/70 - 0s - 4ms/step - loss: 0.1329 - val_loss: 0.4250
Epoch 7/50
70/70 - 0s - 4ms/step - loss: 0.1275 - val_loss: 0.4250
Epoch 8/50
70/70 - 0s - 4ms/step - loss: 0.1229 - val_loss: 0.4169
Epoch 9/50
70/70 - 0s - 4ms/step - loss: 0.1200 - val_loss: 0.4152
Epoch 10/50
70/70 - 0s - 4ms/step - loss: 0.1155 - val_loss: 0.4136
Epoch 11/50
70/70 - 0s - 4ms/step - loss: 0.1131 - val_loss: 0.4103
Epoch 12/50
70/70 - 0s - 4ms/step - loss: 0.1108 - val_loss: 0.4130
Epoch 13/50
70/70 - 0s - 4ms/step - loss: 0.1087 - val_loss: 0.4057
Epoch 14/50
70/70 - 0s - 4ms/step - loss: 0.1067 - val_loss: 0.4091
Epoch 15/50
70/70 - 0s - 5ms/step - loss: 0.1049 - val_loss: 0.4097
Epoch 16/50
70/70 - 0s - 4ms/step - loss: 0.1046 - val_loss: 0.4108
Epoch 17/50
70/70 - 0s - 4ms/step - loss: 0.1018 - val_loss: 0.4129
Epoch 18/50
70/70 - 0s - 4ms/step - loss: 0.1009 - val_loss: 0.4040
Epoch 19/50
70/70 - 0s - 4ms/step - loss: 0.1001 - val_loss: 0.4046
Epoch 20/50
70/70 - 0s - 4ms/step - loss: 0.0996 - val_loss: 0.4131
Epoch 21/50
70/70 - 0s - 4ms/step - loss: 0.0979 - val_loss: 0.4069
Epoch 22/50
70/70 - 0s - 4ms/step - loss: 0.0969 - val_loss: 0.4053
Epoch 23/50
70/70 - 0s - 4ms/step - loss: 0.0959 - val_loss: 0.4017
Epoch 24/50
70/70 - 0s - 4ms/step - loss: 0.0948 - val_loss: 0.4054
Epoch 25/50
70/70 - 0s - 4ms/step - loss: 0.0942 - val_loss: 0.4042
Epoch 26/50
70/70 - 0s - 4ms/step - loss: 0.0933 - val_loss: 0.4045
Epoch 27/50
70/70 - 0s - 4ms/step - loss: 0.0930 - val_loss: 0.3992
Epoch 28/50
70/70 - 0s - 4ms/step - loss: 0.0905 - val_loss: 0.3939
Epoch 29/50
70/70 - 0s - 4ms/step - loss: 0.0921 - val_loss: 0.3914
Epoch 30/50
70/70 - 0s - 4ms/step - loss: 0.0904 - val_loss: 0.3882
Epoch 31/50
70/70 - 0s - 4ms/step - loss: 0.0891 - val_loss: 0.4051
Epoch 32/50
70/70 - 0s - 4ms/step - loss: 0.0887 - val_loss: 0.3938
Epoch 33/50
70/70 - 0s - 4ms/step - loss: 0.0883 - val_loss: 0.3911
Epoch 34/50
70/70 - 0s - 4ms/step - loss: 0.0877 - val_loss: 0.3925
Epoch 35/50
70/70 - 0s - 4ms/step - loss: 0.0865 - val_loss: 0.3878
Epoch 36/50
70/70 - 0s - 4ms/step - loss: 0.0864 - val_loss: 0.3938
Epoch 37/50
70/70 - 0s - 4ms/step - loss: 0.0862 - val_loss: 0.3864
Epoch 38/50
70/70 - 0s - 4ms/step - loss: 0.0850 - val_loss: 0.3818
Epoch 39/50
70/70 - 0s - 4ms/step - loss: 0.0853 - val_loss: 0.3882
Epoch 40/50
70/70 - 0s - 4ms/step - loss: 0.0845 - val_loss: 0.3786
Epoch 41/50
70/70 - 0s - 4ms/step - loss: 0.0844 - val_loss: 0.3833
Epoch 42/50
70/70 - 0s - 4ms/step - loss: 0.0829 - val_loss: 0.3868
Epoch 43/50
70/70 - 0s - 4ms/step - loss: 0.0834 - val_loss: 0.3809
Epoch 44/50
70/70 - 0s - 4ms/step - loss: 0.0834 - val_loss: 0.3812
Epoch 45/50
70/70 - 0s - 4ms/step - loss: 0.0823 - val_loss: 0.3778
Epoch 46/50
70/70 - 0s - 4ms/step - loss: 0.0819 - val_loss: 0.3769
Epoch 47/50
70/70 - 0s - 4ms/step - loss: 0.0820 - val_loss: 0.3726
Epoch 48/50
70/70 - 0s - 4ms/step - loss: 0.0814 - val_loss: 0.3767
Epoch 49/50
70/70 - 0s - 4ms/step - loss: 0.0810 - val_loss: 0.3757
Epoch 50/50
70/70 - 0s - 4ms/step - loss: 0.0804 - val_loss: 0.3711
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7130
Per-joint RMSE: 0.8200 0.6989 0.7678 0.5427 0.4913 0.8741
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:40:45.127916: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:40:45.152537: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 05:40:46.011784: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:46.016477: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:46.017257: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:46.018922: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:46.019709: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:46.020442: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:46.103623: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:46.104567: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:46.105365: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:46.106163: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:40:46.407837: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 10/10

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.394075e-01  RMSE=7.344437e-01
  per-joint RMSE: 0.8389 0.6434 0.8292 0.5163 0.5169 0.9474
Residual LSTM:  MSE=5.083984e-01      RMSE=7.130206e-01
  per-joint RMSE: 0.8200 0.6989 0.7678 0.5427 0.4913 0.8741
Combined torque MSE=5.083984e-01     RMSE=7.130206e-01
  per-joint RMSE: 0.8200 0.6989 0.7678 0.5427 0.4913 0.8741
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200.npz --H 50 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200.json
H=50, n_dof=6, feature_dim=6
X_train: (22373, 50, 6)  Y_train: (22373, 6)
X_test : (1804, 50, 6)  Y_test : (1804, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:40:48.233252: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:40:48.257419: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep200.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (22373, 50, 6), Y_train = (22373, 6)
  X_test  = (1804, 50, 6),  Y_test  = (1804, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:40:49.250799: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:49.255396: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:49.256187: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:49.257888: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:49.258674: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:49.259410: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:49.330677: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:49.331503: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:49.332249: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:40:49.332977: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:40:50.243355: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
70/70 - 2s - 23ms/step - loss: 0.6179 - val_loss: 0.6318
Epoch 2/50
70/70 - 0s - 4ms/step - loss: 0.3693 - val_loss: 0.5544
Epoch 3/50
70/70 - 0s - 4ms/step - loss: 0.2696 - val_loss: 0.5402
Epoch 4/50
70/70 - 0s - 4ms/step - loss: 0.2158 - val_loss: 0.5461
Epoch 5/50
70/70 - 0s - 4ms/step - loss: 0.1835 - val_loss: 0.5024
Epoch 6/50
70/70 - 0s - 4ms/step - loss: 0.1662 - val_loss: 0.5072
Epoch 7/50
70/70 - 0s - 4ms/step - loss: 0.1595 - val_loss: 0.5191
Epoch 8/50
70/70 - 0s - 4ms/step - loss: 0.1550 - val_loss: 0.5196
Epoch 9/50
70/70 - 0s - 4ms/step - loss: 0.1462 - val_loss: 0.4951
Epoch 10/50
70/70 - 0s - 4ms/step - loss: 0.1396 - val_loss: 0.5017
Epoch 11/50
70/70 - 0s - 4ms/step - loss: 0.1362 - val_loss: 0.5049
Epoch 12/50
70/70 - 0s - 4ms/step - loss: 0.1308 - val_loss: 0.4973
Epoch 13/50
70/70 - 0s - 4ms/step - loss: 0.1284 - val_loss: 0.4916
Epoch 14/50
70/70 - 0s - 4ms/step - loss: 0.1265 - val_loss: 0.4784
Epoch 15/50
70/70 - 0s - 5ms/step - loss: 0.1243 - val_loss: 0.4851
Epoch 16/50
70/70 - 0s - 4ms/step - loss: 0.1231 - val_loss: 0.4927
Epoch 17/50
70/70 - 0s - 4ms/step - loss: 0.1196 - val_loss: 0.4827
Epoch 18/50
70/70 - 0s - 4ms/step - loss: 0.1182 - val_loss: 0.4864
Epoch 19/50
70/70 - 0s - 4ms/step - loss: 0.1157 - val_loss: 0.4879
Epoch 20/50
70/70 - 0s - 4ms/step - loss: 0.1134 - val_loss: 0.4684
Epoch 21/50
70/70 - 0s - 4ms/step - loss: 0.1144 - val_loss: 0.4822
Epoch 22/50
70/70 - 0s - 4ms/step - loss: 0.1127 - val_loss: 0.4787
Epoch 23/50
70/70 - 0s - 4ms/step - loss: 0.1128 - val_loss: 0.4637
Epoch 24/50
70/70 - 0s - 4ms/step - loss: 0.1113 - val_loss: 0.4723
Epoch 25/50
70/70 - 0s - 4ms/step - loss: 0.1092 - val_loss: 0.4757
Epoch 26/50
70/70 - 0s - 4ms/step - loss: 0.1098 - val_loss: 0.4691
Epoch 27/50
70/70 - 0s - 4ms/step - loss: 0.1077 - val_loss: 0.4822
Epoch 28/50
70/70 - 0s - 4ms/step - loss: 0.1070 - val_loss: 0.4826
Epoch 29/50
70/70 - 0s - 4ms/step - loss: 0.1064 - val_loss: 0.4734
Epoch 30/50
70/70 - 0s - 4ms/step - loss: 0.1054 - val_loss: 0.4883
Epoch 31/50
70/70 - 0s - 4ms/step - loss: 0.1046 - val_loss: 0.4804
Epoch 32/50
70/70 - 0s - 4ms/step - loss: 0.1043 - val_loss: 0.4874
Epoch 33/50
70/70 - 0s - 4ms/step - loss: 0.1019 - val_loss: 0.4764
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7429
Per-joint RMSE: 0.7546 0.7160 0.9223 0.5278 0.5080 0.9178
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:41:01.338404: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:41:01.363148: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 05:41:02.203830: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:02.208442: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:02.209497: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:02.211183: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:02.212006: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:02.212830: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:02.287349: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:02.288269: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:02.289018: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:02.289837: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:41:02.586099: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 10/10

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.394075e-01  RMSE=7.344437e-01
  per-joint RMSE: 0.8389 0.6434 0.8292 0.5163 0.5169 0.9474
Residual LSTM:  MSE=5.519158e-01      RMSE=7.429103e-01
  per-joint RMSE: 0.7546 0.7160 0.9223 0.5278 0.5080 0.9178
Combined torque MSE=5.519158e-01     RMSE=7.429103e-01
  per-joint RMSE: 0.7546 0.7160 0.9223 0.5278 0.5080 0.9178
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200.npz --H 50 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200.json
H=50, n_dof=6, feature_dim=18
X_train: (22373, 50, 18)  Y_train: (22373, 6)
X_test : (1804, 50, 18)  Y_test : (1804, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:41:04.536816: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:41:04.560938: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (22373, 50, 18), Y_train = (22373, 6)
  X_test  = (1804, 50, 18),  Y_test  = (1804, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:41:05.621766: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:05.626335: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:05.627209: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:05.628766: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:05.629543: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:05.630282: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:05.703969: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:05.704888: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:05.705635: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:05.706366: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:41:06.647941: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
70/70 - 2s - 23ms/step - loss: 0.3888 - val_loss: 0.6404
Epoch 2/50
70/70 - 0s - 4ms/step - loss: 0.2350 - val_loss: 0.6024
Epoch 3/50
70/70 - 0s - 4ms/step - loss: 0.1998 - val_loss: 0.5919
Epoch 4/50
70/70 - 0s - 4ms/step - loss: 0.1732 - val_loss: 0.5841
Epoch 5/50
70/70 - 0s - 4ms/step - loss: 0.1584 - val_loss: 0.5631
Epoch 6/50
70/70 - 0s - 4ms/step - loss: 0.1475 - val_loss: 0.5598
Epoch 7/50
70/70 - 0s - 4ms/step - loss: 0.1404 - val_loss: 0.5646
Epoch 8/50
70/70 - 0s - 4ms/step - loss: 0.1349 - val_loss: 0.5721
Epoch 9/50
70/70 - 0s - 4ms/step - loss: 0.1304 - val_loss: 0.5757
Epoch 10/50
70/70 - 0s - 4ms/step - loss: 0.1248 - val_loss: 0.5743
Epoch 11/50
70/70 - 0s - 4ms/step - loss: 0.1231 - val_loss: 0.5516
Epoch 12/50
70/70 - 0s - 4ms/step - loss: 0.1187 - val_loss: 0.5554
Epoch 13/50
70/70 - 0s - 4ms/step - loss: 0.1152 - val_loss: 0.5687
Epoch 14/50
70/70 - 0s - 4ms/step - loss: 0.1145 - val_loss: 0.5675
Epoch 15/50
70/70 - 0s - 5ms/step - loss: 0.1114 - val_loss: 0.5635
Epoch 16/50
70/70 - 0s - 4ms/step - loss: 0.1117 - val_loss: 0.5779
Epoch 17/50
70/70 - 0s - 4ms/step - loss: 0.1077 - val_loss: 0.5700
Epoch 18/50
70/70 - 0s - 4ms/step - loss: 0.1077 - val_loss: 0.5592
Epoch 19/50
70/70 - 0s - 4ms/step - loss: 0.1062 - val_loss: 0.5587
Epoch 20/50
70/70 - 0s - 4ms/step - loss: 0.1048 - val_loss: 0.5666
Epoch 21/50
70/70 - 0s - 4ms/step - loss: 0.1049 - val_loss: 0.5638
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7406
Per-joint RMSE: 0.8744 0.6716 0.7894 0.5379 0.5153 0.9471
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:41:14.411118: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:41:14.435689: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:41:15.288283: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:15.292941: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:15.293735: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:15.295406: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:15.296194: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:15.296939: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:15.375471: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:15.376307: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:15.377050: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:15.377782: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:41:15.674597: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 10/10

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.394075e-01  RMSE=7.344437e-01
  per-joint RMSE: 0.8389 0.6434 0.8292 0.5163 0.5169 0.9474
Residual LSTM:  MSE=5.484303e-01      RMSE=7.405608e-01
  per-joint RMSE: 0.8744 0.6716 0.7894 0.5379 0.5153 0.9471
Combined torque MSE=5.484303e-01     RMSE=7.405608e-01
  per-joint RMSE: 0.8744 0.6716 0.7894 0.5379 0.5153 0.9471
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200.npz --H 50 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200.json
H=50, n_dof=6, feature_dim=18
X_train: (22373, 50, 18)  Y_train: (22373, 6)
X_test : (1804, 50, 18)  Y_test : (1804, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:41:17.599656: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:41:17.623379: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep200.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (22373, 50, 18), Y_train = (22373, 6)
  X_test  = (1804, 50, 18),  Y_test  = (1804, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:41:18.704918: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:18.709984: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:18.710940: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:18.712575: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:18.713361: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:18.714105: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:18.791956: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:18.792787: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:18.793609: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:18.794338: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:41:19.728027: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
70/70 - 2s - 23ms/step - loss: 0.3652 - val_loss: 0.4779
Epoch 2/50
70/70 - 0s - 4ms/step - loss: 0.2035 - val_loss: 0.4358
Epoch 3/50
70/70 - 0s - 4ms/step - loss: 0.1709 - val_loss: 0.4130
Epoch 4/50
70/70 - 0s - 4ms/step - loss: 0.1552 - val_loss: 0.4169
Epoch 5/50
70/70 - 0s - 4ms/step - loss: 0.1450 - val_loss: 0.4092
Epoch 6/50
70/70 - 0s - 4ms/step - loss: 0.1371 - val_loss: 0.4150
Epoch 7/50
70/70 - 0s - 4ms/step - loss: 0.1304 - val_loss: 0.4082
Epoch 8/50
70/70 - 0s - 4ms/step - loss: 0.1254 - val_loss: 0.4130
Epoch 9/50
70/70 - 0s - 4ms/step - loss: 0.1208 - val_loss: 0.4181
Epoch 10/50
70/70 - 0s - 4ms/step - loss: 0.1179 - val_loss: 0.4121
Epoch 11/50
70/70 - 0s - 4ms/step - loss: 0.1144 - val_loss: 0.4047
Epoch 12/50
70/70 - 0s - 4ms/step - loss: 0.1116 - val_loss: 0.4145
Epoch 13/50
70/70 - 0s - 4ms/step - loss: 0.1103 - val_loss: 0.4102
Epoch 14/50
70/70 - 0s - 4ms/step - loss: 0.1079 - val_loss: 0.4176
Epoch 15/50
70/70 - 0s - 5ms/step - loss: 0.1065 - val_loss: 0.4049
Epoch 16/50
70/70 - 0s - 4ms/step - loss: 0.1049 - val_loss: 0.4082
Epoch 17/50
70/70 - 0s - 4ms/step - loss: 0.1040 - val_loss: 0.4033
Epoch 18/50
70/70 - 0s - 4ms/step - loss: 0.1020 - val_loss: 0.4084
Epoch 19/50
70/70 - 0s - 4ms/step - loss: 0.1002 - val_loss: 0.4049
Epoch 20/50
70/70 - 0s - 4ms/step - loss: 0.0997 - val_loss: 0.4051
Epoch 21/50
70/70 - 0s - 4ms/step - loss: 0.0978 - val_loss: 0.4045
Epoch 22/50
70/70 - 0s - 4ms/step - loss: 0.0972 - val_loss: 0.4052
Epoch 23/50
70/70 - 0s - 4ms/step - loss: 0.0965 - val_loss: 0.4116
Epoch 24/50
70/70 - 0s - 4ms/step - loss: 0.0951 - val_loss: 0.4152
Epoch 25/50
70/70 - 0s - 4ms/step - loss: 0.0944 - val_loss: 0.4116
Epoch 26/50
70/70 - 0s - 4ms/step - loss: 0.0947 - val_loss: 0.4163
Epoch 27/50
70/70 - 0s - 4ms/step - loss: 0.0923 - val_loss: 0.4170
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6813
Per-joint RMSE: 0.6942 0.7090 0.7637 0.5036 0.4706 0.8615
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:41:29.175187: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:41:29.199972: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s0_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:41:30.043338: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:30.047946: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:30.048730: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:30.050838: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:30.051655: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:30.052373: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:30.133380: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:30.134209: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:30.134944: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:41:30.135726: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:41:30.434277: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 10/10

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.394075e-01  RMSE=7.344437e-01
  per-joint RMSE: 0.8389 0.6434 0.8292 0.5163 0.5169 0.9474
Residual LSTM:  MSE=4.641840e-01      RMSE=6.813105e-01
  per-joint RMSE: 0.6942 0.7090 0.7637 0.5036 0.4706 0.8615
Combined torque MSE=4.641840e-01     RMSE=6.813105e-01
  per-joint RMSE: 0.6942 0.7090 0.7637 0.5036 0.4706 0.8615
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s0_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=1                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz                                 ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed2_dataset.npz -t structured -s 1 -r 0 --hp_preset fast_debug --epochs 200 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200.jax' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 200, 'lagrangian_type': <function structured_lagrangian_fn at 0x726953a081f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed2_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed2_dataset.npz
   dt ≈ 0.023660096398761724
  dof = 6
  Train trajectories = 40
  Test trajectories  = 10
  Train samples = 23551
  Test samples  = 2018
################################################

2026-01-22 05:41:34.590886: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200 | type=structured | dof=6
################################################
2026-01-22 05:41:37.723691: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:41:37.723736: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:41:37.723745: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:41:37.723776: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:41:37.723783: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:41:37.723802: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:41:37.723843: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:41:37.723852: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:41:37.723871: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:41:37.723877: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   4.9s, Loss=2.38e+01, Inv=2.38e+01, For=1.59e+02, Power=4.16e+00
2026-01-22 05:41:42.466521: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  [eval] test_mse=2.889e+00  (n=2018)
Epoch 00050: Time=   9.1s, Loss=2.78e+00, Inv=2.78e+00, For=5.45e+01, Power=1.67e+00
Epoch 00100: Time=  12.0s, Loss=2.23e+00, Inv=2.23e+00, For=5.76e+01, Power=1.42e+00
Epoch 00150: Time=  15.0s, Loss=1.96e+00, Inv=1.96e+00, For=6.88e+01, Power=1.31e+00
Epoch 00200: Time=  17.9s, Loss=1.81e+00, Inv=1.81e+00, For=7.90e+01, Power=1.22e+00
  [eval] test_mse=1.844e+00  (n=2018)
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200
Torque MSE  = 3.073e-01
Torque RMSE = 5.543e-01
Per-joint MSE : 4.936e-01 1.524e-01 4.305e-01 3.101e-01 3.336e-01 1.234e-01
Per-joint RMSE: 7.026e-01 3.904e-01 6.561e-01 5.569e-01 5.776e-01 3.512e-01
Comp Time per Sample = 1.605e-07s / 6232261.3Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed2_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed2_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep200.jax
Detected n_dof=6 (seed=1)
2026-01-22 05:41:57.702236: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 40 trajectories
2026-01-22 05:41:59.022298: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:41:59.022311: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:42:00.538729: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:42:00.538741: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:42:02.013873: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/40
  done 40/40

Exporting split=test: 10 trajectories
  done 10/10

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200.npz --H 25 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200.json
H=25, n_dof=6, feature_dim=24
X_train: (22948, 25, 24)  Y_train: (22948, 6)
X_test : (1904, 25, 24)  Y_test : (1904, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:42:04.106426: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:42:04.130552: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep200.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (22948, 25, 24), Y_train = (22948, 6)
  X_test  = (1904, 25, 24),  Y_test  = (1904, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:42:05.150597: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:05.155473: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:05.156406: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:05.158259: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:05.159192: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:05.160063: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:05.249110: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:05.250079: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:05.250953: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:05.251738: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8952 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:42:06.171357: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
72/72 - 2s - 21ms/step - loss: 0.3750 - val_loss: 0.5076
Epoch 2/50
72/72 - 0s - 3ms/step - loss: 0.1912 - val_loss: 0.4922
Epoch 3/50
72/72 - 0s - 3ms/step - loss: 0.1549 - val_loss: 0.4611
Epoch 4/50
72/72 - 0s - 3ms/step - loss: 0.1399 - val_loss: 0.4434
Epoch 5/50
72/72 - 0s - 3ms/step - loss: 0.1302 - val_loss: 0.4397
Epoch 6/50
72/72 - 0s - 3ms/step - loss: 0.1229 - val_loss: 0.4345
Epoch 7/50
72/72 - 0s - 3ms/step - loss: 0.1177 - val_loss: 0.4277
Epoch 8/50
72/72 - 0s - 3ms/step - loss: 0.1147 - val_loss: 0.4122
Epoch 9/50
72/72 - 0s - 3ms/step - loss: 0.1110 - val_loss: 0.4084
Epoch 10/50
72/72 - 0s - 3ms/step - loss: 0.1093 - val_loss: 0.4111
Epoch 11/50
72/72 - 0s - 3ms/step - loss: 0.1066 - val_loss: 0.4100
Epoch 12/50
72/72 - 0s - 3ms/step - loss: 0.1043 - val_loss: 0.4091
Epoch 13/50
72/72 - 0s - 3ms/step - loss: 0.1032 - val_loss: 0.4028
Epoch 14/50
72/72 - 0s - 4ms/step - loss: 0.1008 - val_loss: 0.4015
Epoch 15/50
72/72 - 0s - 3ms/step - loss: 0.0986 - val_loss: 0.4048
Epoch 16/50
72/72 - 0s - 3ms/step - loss: 0.0982 - val_loss: 0.4028
Epoch 17/50
72/72 - 0s - 3ms/step - loss: 0.0979 - val_loss: 0.4010
Epoch 18/50
72/72 - 0s - 3ms/step - loss: 0.0965 - val_loss: 0.3918
Epoch 19/50
72/72 - 0s - 3ms/step - loss: 0.0953 - val_loss: 0.3959
Epoch 20/50
72/72 - 0s - 3ms/step - loss: 0.0939 - val_loss: 0.3998
Epoch 21/50
72/72 - 0s - 3ms/step - loss: 0.0932 - val_loss: 0.3908
Epoch 22/50
72/72 - 0s - 3ms/step - loss: 0.0927 - val_loss: 0.3881
Epoch 23/50
72/72 - 0s - 3ms/step - loss: 0.0924 - val_loss: 0.3848
Epoch 24/50
72/72 - 0s - 3ms/step - loss: 0.0913 - val_loss: 0.3878
Epoch 25/50
72/72 - 0s - 3ms/step - loss: 0.0908 - val_loss: 0.3798
Epoch 26/50
72/72 - 0s - 3ms/step - loss: 0.0891 - val_loss: 0.3788
Epoch 27/50
72/72 - 0s - 3ms/step - loss: 0.0889 - val_loss: 0.3816
Epoch 28/50
72/72 - 0s - 3ms/step - loss: 0.0886 - val_loss: 0.3768
Epoch 29/50
72/72 - 0s - 3ms/step - loss: 0.0887 - val_loss: 0.3777
Epoch 30/50
72/72 - 0s - 3ms/step - loss: 0.0865 - val_loss: 0.3811
Epoch 31/50
72/72 - 0s - 3ms/step - loss: 0.0869 - val_loss: 0.3810
Epoch 32/50
72/72 - 0s - 3ms/step - loss: 0.0874 - val_loss: 0.3828
Epoch 33/50
72/72 - 0s - 3ms/step - loss: 0.0846 - val_loss: 0.3759
Epoch 34/50
72/72 - 0s - 3ms/step - loss: 0.0856 - val_loss: 0.3777
Epoch 35/50
72/72 - 0s - 3ms/step - loss: 0.0841 - val_loss: 0.3765
Epoch 36/50
72/72 - 0s - 3ms/step - loss: 0.0831 - val_loss: 0.3760
Epoch 37/50
72/72 - 0s - 3ms/step - loss: 0.0857 - val_loss: 0.3722
Epoch 38/50
72/72 - 0s - 3ms/step - loss: 0.0843 - val_loss: 0.3768
Epoch 39/50
72/72 - 0s - 3ms/step - loss: 0.0819 - val_loss: 0.3776
Epoch 40/50
72/72 - 0s - 3ms/step - loss: 0.0830 - val_loss: 0.3783
Epoch 41/50
72/72 - 0s - 3ms/step - loss: 0.0813 - val_loss: 0.3784
Epoch 42/50
72/72 - 0s - 3ms/step - loss: 0.0815 - val_loss: 0.3713
Epoch 43/50
72/72 - 0s - 3ms/step - loss: 0.0803 - val_loss: 0.3775
Epoch 44/50
72/72 - 0s - 3ms/step - loss: 0.0804 - val_loss: 0.3776
Epoch 45/50
72/72 - 0s - 3ms/step - loss: 0.0793 - val_loss: 0.3691
Epoch 46/50
72/72 - 0s - 3ms/step - loss: 0.0806 - val_loss: 0.3808
Epoch 47/50
72/72 - 0s - 3ms/step - loss: 0.0783 - val_loss: 0.3815
Epoch 48/50
72/72 - 0s - 3ms/step - loss: 0.0794 - val_loss: 0.3751
Epoch 49/50
72/72 - 0s - 3ms/step - loss: 0.0785 - val_loss: 0.3731
Epoch 50/50
72/72 - 0s - 3ms/step - loss: 0.0777 - val_loss: 0.3763
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5204
Per-joint RMSE: 0.6106 0.4765 0.6044 0.5391 0.5351 0.2874
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:42:17.880335: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:42:17.905216: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 05:42:18.736771: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:18.741466: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:18.742416: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:18.744037: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:18.744823: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:18.745557: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:18.821546: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:18.822383: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:18.823131: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:18.823871: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:42:19.119166: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 10/10

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.168802e-01  RMSE=5.629211e-01
  per-joint RMSE: 0.7180 0.3624 0.6693 0.5707 0.5931 0.3588
Residual LSTM:  MSE=2.708107e-01      RMSE=5.203947e-01
  per-joint RMSE: 0.6106 0.4765 0.6044 0.5391 0.5351 0.2874
Combined torque MSE=2.708107e-01     RMSE=5.203947e-01
  per-joint RMSE: 0.6106 0.4765 0.6044 0.5391 0.5351 0.2874
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200.npz --H 25 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200.json
H=25, n_dof=6, feature_dim=6
X_train: (22948, 25, 6)  Y_train: (22948, 6)
X_test : (1904, 25, 6)  Y_test : (1904, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:42:20.941787: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:42:20.966431: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep200.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (22948, 25, 6), Y_train = (22948, 6)
  X_test  = (1904, 25, 6),  Y_test  = (1904, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:42:21.931151: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:21.935753: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:21.936629: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:21.938187: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:21.938980: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:21.939719: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:22.021664: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:22.022500: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:22.023245: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:22.023981: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:42:22.940839: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
72/72 - 2s - 21ms/step - loss: 0.6481 - val_loss: 0.6571
Epoch 2/50
72/72 - 0s - 3ms/step - loss: 0.4314 - val_loss: 0.5759
Epoch 3/50
72/72 - 0s - 3ms/step - loss: 0.3401 - val_loss: 0.5624
Epoch 4/50
72/72 - 0s - 3ms/step - loss: 0.2752 - val_loss: 0.6155
Epoch 5/50
72/72 - 0s - 3ms/step - loss: 0.2286 - val_loss: 0.5682
Epoch 6/50
72/72 - 0s - 3ms/step - loss: 0.1973 - val_loss: 0.5862
Epoch 7/50
72/72 - 0s - 3ms/step - loss: 0.1783 - val_loss: 0.5805
Epoch 8/50
72/72 - 0s - 3ms/step - loss: 0.1536 - val_loss: 0.5882
Epoch 9/50
72/72 - 0s - 3ms/step - loss: 0.1426 - val_loss: 0.5919
Epoch 10/50
72/72 - 0s - 3ms/step - loss: 0.1404 - val_loss: 0.5835
Epoch 11/50
72/72 - 0s - 3ms/step - loss: 0.1514 - val_loss: 0.5994
Epoch 12/50
72/72 - 0s - 3ms/step - loss: 0.1325 - val_loss: 0.5832
Epoch 13/50
72/72 - 0s - 3ms/step - loss: 0.1240 - val_loss: 0.5861
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5939
Per-joint RMSE: 0.6431 0.5423 0.6469 0.5786 0.7081 0.3926
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:42:27.172619: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:42:27.197736: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 05:42:28.059953: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:28.064743: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:28.065662: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:28.067378: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:28.068266: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:28.069115: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:28.154592: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:28.155480: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:28.156278: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:28.157064: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:42:28.448733: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 10/10

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.168802e-01  RMSE=5.629211e-01
  per-joint RMSE: 0.7180 0.3624 0.6693 0.5707 0.5931 0.3588
Residual LSTM:  MSE=3.527592e-01      RMSE=5.939353e-01
  per-joint RMSE: 0.6431 0.5423 0.6469 0.5786 0.7081 0.3926
Combined torque MSE=3.527592e-01     RMSE=5.939353e-01
  per-joint RMSE: 0.6431 0.5423 0.6469 0.5786 0.7081 0.3926
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200.npz --H 25 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200.json
H=25, n_dof=6, feature_dim=18
X_train: (22948, 25, 18)  Y_train: (22948, 6)
X_test : (1904, 25, 18)  Y_test : (1904, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:42:30.312140: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:42:30.336059: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep200.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (22948, 25, 18), Y_train = (22948, 6)
  X_test  = (1904, 25, 18),  Y_test  = (1904, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:42:31.335083: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:31.339826: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:31.340758: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:31.342601: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:31.343394: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:31.344128: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:31.420303: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:31.421219: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:31.421962: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:31.422786: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:42:32.360184: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
72/72 - 2s - 21ms/step - loss: 0.3737 - val_loss: 0.6233
Epoch 2/50
72/72 - 0s - 3ms/step - loss: 0.2206 - val_loss: 0.5547
Epoch 3/50
72/72 - 0s - 3ms/step - loss: 0.1839 - val_loss: 0.5328
Epoch 4/50
72/72 - 0s - 3ms/step - loss: 0.1594 - val_loss: 0.5170
Epoch 5/50
72/72 - 0s - 3ms/step - loss: 0.1455 - val_loss: 0.5160
Epoch 6/50
72/72 - 0s - 3ms/step - loss: 0.1357 - val_loss: 0.5150
Epoch 7/50
72/72 - 0s - 3ms/step - loss: 0.1287 - val_loss: 0.5130
Epoch 8/50
72/72 - 0s - 3ms/step - loss: 0.1246 - val_loss: 0.5108
Epoch 9/50
72/72 - 0s - 3ms/step - loss: 0.1200 - val_loss: 0.5201
Epoch 10/50
72/72 - 0s - 3ms/step - loss: 0.1162 - val_loss: 0.5139
Epoch 11/50
72/72 - 0s - 3ms/step - loss: 0.1129 - val_loss: 0.5188
Epoch 12/50
72/72 - 0s - 3ms/step - loss: 0.1104 - val_loss: 0.5128
Epoch 13/50
72/72 - 0s - 3ms/step - loss: 0.1089 - val_loss: 0.5134
Epoch 14/50
72/72 - 0s - 3ms/step - loss: 0.1067 - val_loss: 0.5243
Epoch 15/50
72/72 - 0s - 4ms/step - loss: 0.1055 - val_loss: 0.5160
Epoch 16/50
72/72 - 0s - 3ms/step - loss: 0.1031 - val_loss: 0.5129
Epoch 17/50
72/72 - 0s - 3ms/step - loss: 0.1016 - val_loss: 0.5172
Epoch 18/50
72/72 - 0s - 3ms/step - loss: 0.1012 - val_loss: 0.5194
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5631
Per-joint RMSE: 0.6588 0.4973 0.6129 0.5608 0.6480 0.3330
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:42:37.755504: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:42:37.779883: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:42:38.617677: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:38.622325: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:38.623119: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:38.624842: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:38.625631: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:38.626369: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:38.700061: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:38.700968: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:38.701713: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:38.702443: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:42:38.998448: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 10/10

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.168802e-01  RMSE=5.629211e-01
  per-joint RMSE: 0.7180 0.3624 0.6693 0.5707 0.5931 0.3588
Residual LSTM:  MSE=3.170425e-01      RMSE=5.630652e-01
  per-joint RMSE: 0.6588 0.4973 0.6129 0.5608 0.6480 0.3330
Combined torque MSE=3.170425e-01     RMSE=5.630652e-01
  per-joint RMSE: 0.6588 0.4973 0.6129 0.5608 0.6480 0.3330
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200.npz --H 25 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200.json
H=25, n_dof=6, feature_dim=18
X_train: (22948, 25, 18)  Y_train: (22948, 6)
X_test : (1904, 25, 18)  Y_test : (1904, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:42:40.832592: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:42:40.856268: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep200.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (22948, 25, 18), Y_train = (22948, 6)
  X_test  = (1904, 25, 18),  Y_test  = (1904, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:42:41.854404: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:41.859095: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:41.859883: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:41.861618: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:41.862405: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:41.863144: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:41.938464: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:41.939295: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:41.940047: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:41.940783: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:42:42.852192: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
72/72 - 2s - 21ms/step - loss: 0.3642 - val_loss: 0.4713
Epoch 2/50
72/72 - 0s - 3ms/step - loss: 0.1922 - val_loss: 0.4357
Epoch 3/50
72/72 - 0s - 3ms/step - loss: 0.1578 - val_loss: 0.4200
Epoch 4/50
72/72 - 0s - 3ms/step - loss: 0.1411 - val_loss: 0.4095
Epoch 5/50
72/72 - 0s - 3ms/step - loss: 0.1320 - val_loss: 0.4004
Epoch 6/50
72/72 - 0s - 3ms/step - loss: 0.1245 - val_loss: 0.3913
Epoch 7/50
72/72 - 0s - 3ms/step - loss: 0.1193 - val_loss: 0.3948
Epoch 8/50
72/72 - 0s - 3ms/step - loss: 0.1151 - val_loss: 0.3849
Epoch 9/50
72/72 - 0s - 3ms/step - loss: 0.1119 - val_loss: 0.3877
Epoch 10/50
72/72 - 0s - 3ms/step - loss: 0.1073 - val_loss: 0.3775
Epoch 11/50
72/72 - 0s - 3ms/step - loss: 0.1058 - val_loss: 0.3739
Epoch 12/50
72/72 - 0s - 3ms/step - loss: 0.1035 - val_loss: 0.3658
Epoch 13/50
72/72 - 0s - 3ms/step - loss: 0.1029 - val_loss: 0.3646
Epoch 14/50
72/72 - 0s - 3ms/step - loss: 0.1006 - val_loss: 0.3649
Epoch 15/50
72/72 - 0s - 4ms/step - loss: 0.0997 - val_loss: 0.3581
Epoch 16/50
72/72 - 0s - 3ms/step - loss: 0.0995 - val_loss: 0.3715
Epoch 17/50
72/72 - 0s - 3ms/step - loss: 0.0967 - val_loss: 0.3660
Epoch 18/50
72/72 - 0s - 3ms/step - loss: 0.0951 - val_loss: 0.3590
Epoch 19/50
72/72 - 0s - 3ms/step - loss: 0.0948 - val_loss: 0.3638
Epoch 20/50
72/72 - 0s - 3ms/step - loss: 0.0935 - val_loss: 0.3599
Epoch 21/50
72/72 - 0s - 3ms/step - loss: 0.0919 - val_loss: 0.3547
Epoch 22/50
72/72 - 0s - 3ms/step - loss: 0.0912 - val_loss: 0.3601
Epoch 23/50
72/72 - 0s - 3ms/step - loss: 0.0910 - val_loss: 0.3590
Epoch 24/50
72/72 - 0s - 3ms/step - loss: 0.0918 - val_loss: 0.3592
Epoch 25/50
72/72 - 0s - 3ms/step - loss: 0.0900 - val_loss: 0.3640
Epoch 26/50
72/72 - 0s - 3ms/step - loss: 0.0882 - val_loss: 0.3584
Epoch 27/50
72/72 - 0s - 3ms/step - loss: 0.0881 - val_loss: 0.3571
Epoch 28/50
72/72 - 0s - 3ms/step - loss: 0.0873 - val_loss: 0.3653
Epoch 29/50
72/72 - 0s - 3ms/step - loss: 0.0891 - val_loss: 0.3594
Epoch 30/50
72/72 - 0s - 3ms/step - loss: 0.0860 - val_loss: 0.3591
Epoch 31/50
72/72 - 0s - 3ms/step - loss: 0.0857 - val_loss: 0.3565
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4990
Per-joint RMSE: 0.5317 0.4674 0.5569 0.5795 0.5104 0.2941
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:42:50.672216: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:42:50.696613: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:42:51.545197: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:51.549950: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:51.550749: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:51.552373: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:51.553155: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:51.553896: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:51.633868: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:51.634849: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:51.635644: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:51.636379: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:42:51.934455: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 10/10

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.168802e-01  RMSE=5.629211e-01
  per-joint RMSE: 0.7180 0.3624 0.6693 0.5707 0.5931 0.3588
Residual LSTM:  MSE=2.490263e-01      RMSE=4.990253e-01
  per-joint RMSE: 0.5317 0.4674 0.5569 0.5795 0.5104 0.2941
Combined torque MSE=2.490263e-01     RMSE=4.990253e-01
  per-joint RMSE: 0.5317 0.4674 0.5569 0.5795 0.5104 0.2941
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200.npz --H 50 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200.json
H=50, n_dof=6, feature_dim=24
X_train: (22373, 50, 24)  Y_train: (22373, 6)
X_test : (1804, 50, 24)  Y_test : (1804, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:42:53.853426: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:42:53.877152: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep200.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (22373, 50, 24), Y_train = (22373, 6)
  X_test  = (1804, 50, 24),  Y_test  = (1804, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:42:54.984794: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:54.989292: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:54.990193: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:54.991873: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:54.992744: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:54.993541: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:55.071268: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:55.072135: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:55.072896: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:42:55.073644: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:42:56.020969: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
70/70 - 2s - 23ms/step - loss: 0.3614 - val_loss: 0.5020
Epoch 2/50
70/70 - 0s - 4ms/step - loss: 0.1913 - val_loss: 0.4465
Epoch 3/50
70/70 - 0s - 4ms/step - loss: 0.1584 - val_loss: 0.4258
Epoch 4/50
70/70 - 0s - 4ms/step - loss: 0.1443 - val_loss: 0.4139
Epoch 5/50
70/70 - 0s - 4ms/step - loss: 0.1331 - val_loss: 0.4089
Epoch 6/50
70/70 - 0s - 4ms/step - loss: 0.1269 - val_loss: 0.4024
Epoch 7/50
70/70 - 0s - 4ms/step - loss: 0.1224 - val_loss: 0.4083
Epoch 8/50
70/70 - 0s - 4ms/step - loss: 0.1180 - val_loss: 0.4043
Epoch 9/50
70/70 - 0s - 4ms/step - loss: 0.1136 - val_loss: 0.4011
Epoch 10/50
70/70 - 0s - 4ms/step - loss: 0.1116 - val_loss: 0.3989
Epoch 11/50
70/70 - 0s - 4ms/step - loss: 0.1094 - val_loss: 0.4017
Epoch 12/50
70/70 - 0s - 4ms/step - loss: 0.1075 - val_loss: 0.3962
Epoch 13/50
70/70 - 0s - 4ms/step - loss: 0.1061 - val_loss: 0.3982
Epoch 14/50
70/70 - 0s - 4ms/step - loss: 0.1039 - val_loss: 0.3961
Epoch 15/50
70/70 - 0s - 5ms/step - loss: 0.1024 - val_loss: 0.4012
Epoch 16/50
70/70 - 0s - 4ms/step - loss: 0.1019 - val_loss: 0.4054
Epoch 17/50
70/70 - 0s - 4ms/step - loss: 0.0993 - val_loss: 0.4011
Epoch 18/50
70/70 - 0s - 4ms/step - loss: 0.0983 - val_loss: 0.4037
Epoch 19/50
70/70 - 0s - 4ms/step - loss: 0.0971 - val_loss: 0.4023
Epoch 20/50
70/70 - 0s - 4ms/step - loss: 0.0964 - val_loss: 0.4061
Epoch 21/50
70/70 - 0s - 4ms/step - loss: 0.0953 - val_loss: 0.3967
Epoch 22/50
70/70 - 0s - 4ms/step - loss: 0.0951 - val_loss: 0.3947
Epoch 23/50
70/70 - 0s - 4ms/step - loss: 0.0942 - val_loss: 0.3947
Epoch 24/50
70/70 - 0s - 4ms/step - loss: 0.0929 - val_loss: 0.3951
Epoch 25/50
70/70 - 0s - 4ms/step - loss: 0.0908 - val_loss: 0.3894
Epoch 26/50
70/70 - 0s - 4ms/step - loss: 0.0907 - val_loss: 0.3898
Epoch 27/50
70/70 - 0s - 4ms/step - loss: 0.0904 - val_loss: 0.3892
Epoch 28/50
70/70 - 0s - 4ms/step - loss: 0.0891 - val_loss: 0.3852
Epoch 29/50
70/70 - 0s - 4ms/step - loss: 0.0880 - val_loss: 0.3871
Epoch 30/50
70/70 - 0s - 4ms/step - loss: 0.0879 - val_loss: 0.3806
Epoch 31/50
70/70 - 0s - 4ms/step - loss: 0.0875 - val_loss: 0.3852
Epoch 32/50
70/70 - 0s - 4ms/step - loss: 0.0868 - val_loss: 0.3867
Epoch 33/50
70/70 - 0s - 4ms/step - loss: 0.0861 - val_loss: 0.3850
Epoch 34/50
70/70 - 0s - 4ms/step - loss: 0.0861 - val_loss: 0.3855
Epoch 35/50
70/70 - 0s - 4ms/step - loss: 0.0857 - val_loss: 0.3824
Epoch 36/50
70/70 - 0s - 4ms/step - loss: 0.0845 - val_loss: 0.3819
Epoch 37/50
70/70 - 0s - 4ms/step - loss: 0.0842 - val_loss: 0.3822
Epoch 38/50
70/70 - 0s - 4ms/step - loss: 0.0834 - val_loss: 0.3823
Epoch 39/50
70/70 - 0s - 4ms/step - loss: 0.0825 - val_loss: 0.3740
Epoch 40/50
70/70 - 0s - 4ms/step - loss: 0.0830 - val_loss: 0.3756
Epoch 41/50
70/70 - 0s - 4ms/step - loss: 0.0818 - val_loss: 0.3772
Epoch 42/50
70/70 - 0s - 4ms/step - loss: 0.0811 - val_loss: 0.3729
Epoch 43/50
70/70 - 0s - 4ms/step - loss: 0.0809 - val_loss: 0.3722
Epoch 44/50
70/70 - 0s - 4ms/step - loss: 0.0802 - val_loss: 0.3740
Epoch 45/50
70/70 - 0s - 4ms/step - loss: 0.0802 - val_loss: 0.3692
Epoch 46/50
70/70 - 0s - 4ms/step - loss: 0.0798 - val_loss: 0.3675
Epoch 47/50
70/70 - 0s - 4ms/step - loss: 0.0800 - val_loss: 0.3684
Epoch 48/50
70/70 - 0s - 4ms/step - loss: 0.0795 - val_loss: 0.3667
Epoch 49/50
70/70 - 0s - 4ms/step - loss: 0.0792 - val_loss: 0.3665
Epoch 50/50
70/70 - 0s - 4ms/step - loss: 0.0780 - val_loss: 0.3632
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5185
Per-joint RMSE: 0.6205 0.4781 0.5520 0.5604 0.5334 0.3100
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:43:12.295271: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:43:12.319748: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 05:43:13.168963: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:13.173599: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:13.174387: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:13.176198: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:13.177012: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:13.177805: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:13.256004: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:13.256836: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:13.257577: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:13.258299: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:43:13.556905: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 10/10

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.046118e-01  RMSE=5.519165e-01
  per-joint RMSE: 0.7090 0.3607 0.6470 0.5590 0.5808 0.3556
Residual LSTM:  MSE=2.688185e-01      RMSE=5.184771e-01
  per-joint RMSE: 0.6205 0.4781 0.5520 0.5604 0.5334 0.3100
Combined torque MSE=2.688185e-01     RMSE=5.184771e-01
  per-joint RMSE: 0.6205 0.4781 0.5520 0.5604 0.5334 0.3100
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200.npz --H 50 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200.json
H=50, n_dof=6, feature_dim=6
X_train: (22373, 50, 6)  Y_train: (22373, 6)
X_test : (1804, 50, 6)  Y_test : (1804, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:43:15.389831: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:43:15.413674: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep200.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (22373, 50, 6), Y_train = (22373, 6)
  X_test  = (1804, 50, 6),  Y_test  = (1804, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:43:16.403065: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:16.407520: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:16.408308: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:16.409858: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:16.410654: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:16.411383: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:16.482030: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:16.482939: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:16.483678: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:16.484497: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:43:17.363353: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
70/70 - 2s - 23ms/step - loss: 0.6093 - val_loss: 0.6009
Epoch 2/50
70/70 - 0s - 4ms/step - loss: 0.3602 - val_loss: 0.5980
Epoch 3/50
70/70 - 0s - 4ms/step - loss: 0.2631 - val_loss: 0.6078
Epoch 4/50
70/70 - 0s - 4ms/step - loss: 0.2162 - val_loss: 0.5989
Epoch 5/50
70/70 - 0s - 4ms/step - loss: 0.1828 - val_loss: 0.5944
Epoch 6/50
70/70 - 0s - 4ms/step - loss: 0.1673 - val_loss: 0.5438
Epoch 7/50
70/70 - 0s - 4ms/step - loss: 0.1565 - val_loss: 0.5603
Epoch 8/50
70/70 - 0s - 4ms/step - loss: 0.1479 - val_loss: 0.5643
Epoch 9/50
70/70 - 0s - 4ms/step - loss: 0.1411 - val_loss: 0.5508
Epoch 10/50
70/70 - 0s - 4ms/step - loss: 0.1346 - val_loss: 0.5619
Epoch 11/50
70/70 - 0s - 4ms/step - loss: 0.1311 - val_loss: 0.5580
Epoch 12/50
70/70 - 0s - 4ms/step - loss: 0.1283 - val_loss: 0.5204
Epoch 13/50
70/70 - 0s - 4ms/step - loss: 0.1372 - val_loss: 0.5761
Epoch 14/50
70/70 - 0s - 4ms/step - loss: 0.1241 - val_loss: 0.5889
Epoch 15/50
70/70 - 0s - 5ms/step - loss: 0.1206 - val_loss: 0.5576
Epoch 16/50
70/70 - 0s - 4ms/step - loss: 0.1169 - val_loss: 0.5644
Epoch 17/50
70/70 - 0s - 4ms/step - loss: 0.1178 - val_loss: 0.5471
Epoch 18/50
70/70 - 0s - 4ms/step - loss: 0.1155 - val_loss: 0.5410
Epoch 19/50
70/70 - 0s - 4ms/step - loss: 0.1157 - val_loss: 0.5356
Epoch 20/50
70/70 - 0s - 4ms/step - loss: 0.1119 - val_loss: 0.5491
Epoch 21/50
70/70 - 0s - 4ms/step - loss: 0.1119 - val_loss: 0.5355
Epoch 22/50
70/70 - 0s - 4ms/step - loss: 0.1089 - val_loss: 0.5259
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5557
Per-joint RMSE: 0.6868 0.3799 0.6158 0.5399 0.6633 0.3554
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:43:25.246195: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:43:25.271418: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 05:43:26.145078: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:26.149707: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:26.150506: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:26.152169: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:26.152966: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:26.153709: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:26.231894: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:26.232808: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:26.233553: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:26.234288: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:43:26.531912: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 10/10

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.046118e-01  RMSE=5.519165e-01
  per-joint RMSE: 0.7090 0.3607 0.6470 0.5590 0.5808 0.3556
Residual LSTM:  MSE=3.088441e-01      RMSE=5.557375e-01
  per-joint RMSE: 0.6868 0.3799 0.6158 0.5399 0.6633 0.3554
Combined torque MSE=3.088441e-01     RMSE=5.557375e-01
  per-joint RMSE: 0.6868 0.3799 0.6158 0.5399 0.6633 0.3554
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200.npz --H 50 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200.json
H=50, n_dof=6, feature_dim=18
X_train: (22373, 50, 18)  Y_train: (22373, 6)
X_test : (1804, 50, 18)  Y_test : (1804, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:43:28.460847: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:43:28.484577: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep200.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (22373, 50, 18), Y_train = (22373, 6)
  X_test  = (1804, 50, 18),  Y_test  = (1804, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:43:29.545077: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:29.549775: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:29.550642: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:29.552268: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:29.553047: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:29.553785: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:29.633762: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:29.634603: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:29.635330: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:29.636064: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:43:30.579731: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
70/70 - 2s - 23ms/step - loss: 0.3865 - val_loss: 0.6000
Epoch 2/50
70/70 - 0s - 4ms/step - loss: 0.2264 - val_loss: 0.5352
Epoch 3/50
70/70 - 0s - 4ms/step - loss: 0.1868 - val_loss: 0.5151
Epoch 4/50
70/70 - 0s - 4ms/step - loss: 0.1649 - val_loss: 0.5091
Epoch 5/50
70/70 - 0s - 4ms/step - loss: 0.1501 - val_loss: 0.5165
Epoch 6/50
70/70 - 0s - 4ms/step - loss: 0.1417 - val_loss: 0.5096
Epoch 7/50
70/70 - 0s - 4ms/step - loss: 0.1338 - val_loss: 0.5066
Epoch 8/50
70/70 - 0s - 4ms/step - loss: 0.1285 - val_loss: 0.5033
Epoch 9/50
70/70 - 0s - 4ms/step - loss: 0.1251 - val_loss: 0.5105
Epoch 10/50
70/70 - 0s - 4ms/step - loss: 0.1222 - val_loss: 0.5068
Epoch 11/50
70/70 - 0s - 4ms/step - loss: 0.1185 - val_loss: 0.5157
Epoch 12/50
70/70 - 0s - 4ms/step - loss: 0.1156 - val_loss: 0.5146
Epoch 13/50
70/70 - 0s - 4ms/step - loss: 0.1141 - val_loss: 0.5086
Epoch 14/50
70/70 - 0s - 4ms/step - loss: 0.1112 - val_loss: 0.5149
Epoch 15/50
70/70 - 0s - 5ms/step - loss: 0.1101 - val_loss: 0.5144
Epoch 16/50
70/70 - 0s - 4ms/step - loss: 0.1100 - val_loss: 0.5153
Epoch 17/50
70/70 - 0s - 4ms/step - loss: 0.1063 - val_loss: 0.5149
Epoch 18/50
70/70 - 0s - 4ms/step - loss: 0.1052 - val_loss: 0.5076
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5724
Per-joint RMSE: 0.7505 0.5039 0.5873 0.5460 0.6326 0.3249
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:43:37.434903: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:43:37.459364: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:43:38.310385: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:38.315120: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:38.315906: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:38.317629: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:38.318410: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:38.319145: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:38.395833: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:38.396690: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:38.397434: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:38.398167: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:43:38.697979: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 10/10

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.046118e-01  RMSE=5.519165e-01
  per-joint RMSE: 0.7090 0.3607 0.6470 0.5590 0.5808 0.3556
Residual LSTM:  MSE=3.276378e-01      RMSE=5.723966e-01
  per-joint RMSE: 0.7505 0.5039 0.5873 0.5460 0.6326 0.3249
Combined torque MSE=3.276378e-01     RMSE=5.723966e-01
  per-joint RMSE: 0.7505 0.5039 0.5873 0.5460 0.6326 0.3249
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200.npz --H 50 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200.json
H=50, n_dof=6, feature_dim=18
X_train: (22373, 50, 18)  Y_train: (22373, 6)
X_test : (1804, 50, 18)  Y_test : (1804, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:43:40.613702: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:43:40.637584: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep200.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (22373, 50, 18), Y_train = (22373, 6)
  X_test  = (1804, 50, 18),  Y_test  = (1804, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:43:41.701226: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:41.706139: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:41.707042: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:41.708497: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:41.709279: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:41.710015: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:41.787115: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:41.788034: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:41.788782: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:41.789515: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:43:42.724612: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
70/70 - 2s - 23ms/step - loss: 0.3582 - val_loss: 0.4346
Epoch 2/50
70/70 - 0s - 4ms/step - loss: 0.1928 - val_loss: 0.4033
Epoch 3/50
70/70 - 0s - 4ms/step - loss: 0.1610 - val_loss: 0.3858
Epoch 4/50
70/70 - 0s - 4ms/step - loss: 0.1456 - val_loss: 0.3785
Epoch 5/50
70/70 - 0s - 4ms/step - loss: 0.1356 - val_loss: 0.3778
Epoch 6/50
70/70 - 0s - 4ms/step - loss: 0.1290 - val_loss: 0.3720
Epoch 7/50
70/70 - 0s - 4ms/step - loss: 0.1235 - val_loss: 0.3681
Epoch 8/50
70/70 - 0s - 4ms/step - loss: 0.1179 - val_loss: 0.3681
Epoch 9/50
70/70 - 0s - 4ms/step - loss: 0.1145 - val_loss: 0.3664
Epoch 10/50
70/70 - 0s - 4ms/step - loss: 0.1131 - val_loss: 0.3659
Epoch 11/50
70/70 - 0s - 4ms/step - loss: 0.1103 - val_loss: 0.3724
Epoch 12/50
70/70 - 0s - 4ms/step - loss: 0.1067 - val_loss: 0.3760
Epoch 13/50
70/70 - 0s - 4ms/step - loss: 0.1058 - val_loss: 0.3733
Epoch 14/50
70/70 - 0s - 4ms/step - loss: 0.1039 - val_loss: 0.3739
Epoch 15/50
70/70 - 0s - 5ms/step - loss: 0.1015 - val_loss: 0.3776
Epoch 16/50
70/70 - 0s - 4ms/step - loss: 0.1002 - val_loss: 0.3737
Epoch 17/50
70/70 - 0s - 4ms/step - loss: 0.0993 - val_loss: 0.3769
Epoch 18/50
70/70 - 0s - 4ms/step - loss: 0.0982 - val_loss: 0.3725
Epoch 19/50
70/70 - 0s - 4ms/step - loss: 0.0978 - val_loss: 0.3774
Epoch 20/50
70/70 - 0s - 4ms/step - loss: 0.0961 - val_loss: 0.3708
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4988
Per-joint RMSE: 0.5608 0.4816 0.5501 0.5388 0.5125 0.3009
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:43:50.241356: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:43:50.265410: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s1_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:43:51.116022: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:51.120673: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:51.121468: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:51.123267: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:51.124055: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:51.124801: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:51.210499: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:51.211480: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:51.212216: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:43:51.212936: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:43:51.513001: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 10/10

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.046118e-01  RMSE=5.519165e-01
  per-joint RMSE: 0.7090 0.3607 0.6470 0.5590 0.5808 0.3556
Residual LSTM:  MSE=2.487718e-01      RMSE=4.987702e-01
  per-joint RMSE: 0.5608 0.4816 0.5501 0.5388 0.5125 0.3009
Combined torque MSE=2.487718e-01     RMSE=4.987702e-01
  per-joint RMSE: 0.5608 0.4816 0.5501 0.5388 0.5125 0.3009
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s1_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=2                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz                                 ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed2_dataset.npz -t structured -s 2 -r 0 --hp_preset fast_debug --epochs 200 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200.jax' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 200, 'lagrangian_type': <function structured_lagrangian_fn at 0x71d5e2b941f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed2_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed2_dataset.npz
   dt ≈ 0.023660096398761724
  dof = 6
  Train trajectories = 40
  Test trajectories  = 10
  Train samples = 23551
  Test samples  = 2018
################################################

2026-01-22 05:43:55.697703: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200 | type=structured | dof=6
################################################
2026-01-22 05:43:58.826056: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:43:58.826093: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:43:58.826099: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:43:58.826126: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:43:58.826131: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:43:58.826146: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:43:58.826183: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:43:58.826188: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:43:58.826203: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:43:58.826208: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   4.9s, Loss=1.72e+01, Inv=1.72e+01, For=1.22e+02, Power=4.47e+00
2026-01-22 05:44:03.625410: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  [eval] test_mse=3.479e+00  (n=2018)
Epoch 00050: Time=   9.2s, Loss=2.59e+00, Inv=2.59e+00, For=4.83e+01, Power=1.65e+00
Epoch 00100: Time=  12.2s, Loss=2.11e+00, Inv=2.11e+00, For=6.27e+01, Power=1.46e+00
Epoch 00150: Time=  15.3s, Loss=1.93e+00, Inv=1.93e+00, For=7.52e+01, Power=1.32e+00
Epoch 00200: Time=  18.2s, Loss=1.83e+00, Inv=1.83e+00, For=8.37e+01, Power=1.22e+00
  [eval] test_mse=1.496e+00  (n=2018)
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200
Torque MSE  = 2.494e-01
Torque RMSE = 4.994e-01
Per-joint MSE : 5.147e-01 4.186e-01 2.740e-01 6.836e-02 1.204e-01 1.002e-01
Per-joint RMSE: 7.174e-01 6.470e-01 5.235e-01 2.615e-01 3.469e-01 3.165e-01
Comp Time per Sample = 1.682e-07s / 5946329.8Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed2_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K50_tf0p2_seed2_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep200.jax
Detected n_dof=6 (seed=2)
2026-01-22 05:44:19.198765: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 40 trajectories
2026-01-22 05:44:20.514614: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:44:20.514628: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:44:21.976375: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:44:21.976387: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 05:44:23.535027: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/40
  done 40/40

Exporting split=test: 10 trajectories
  done 10/10

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200.npz --H 25 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200.json
H=25, n_dof=6, feature_dim=24
X_train: (22948, 25, 24)  Y_train: (22948, 6)
X_test : (1904, 25, 24)  Y_test : (1904, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:44:25.548651: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:44:25.572234: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep200.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (22948, 25, 24), Y_train = (22948, 6)
  X_test  = (1904, 25, 24),  Y_test  = (1904, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:44:26.587816: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:26.592365: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:26.593181: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:26.594938: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:26.595806: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:26.596599: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:26.675644: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:26.676621: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:26.677418: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:26.678203: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8952 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:44:27.625980: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
72/72 - 2s - 21ms/step - loss: 0.3718 - val_loss: 0.4992
Epoch 2/50
72/72 - 0s - 3ms/step - loss: 0.1962 - val_loss: 0.4688
Epoch 3/50
72/72 - 0s - 3ms/step - loss: 0.1564 - val_loss: 0.4536
Epoch 4/50
72/72 - 0s - 3ms/step - loss: 0.1397 - val_loss: 0.4465
Epoch 5/50
72/72 - 0s - 3ms/step - loss: 0.1315 - val_loss: 0.4264
Epoch 6/50
72/72 - 0s - 3ms/step - loss: 0.1234 - val_loss: 0.4224
Epoch 7/50
72/72 - 0s - 3ms/step - loss: 0.1183 - val_loss: 0.4140
Epoch 8/50
72/72 - 0s - 3ms/step - loss: 0.1161 - val_loss: 0.4155
Epoch 9/50
72/72 - 0s - 3ms/step - loss: 0.1119 - val_loss: 0.4069
Epoch 10/50
72/72 - 0s - 3ms/step - loss: 0.1086 - val_loss: 0.4043
Epoch 11/50
72/72 - 0s - 3ms/step - loss: 0.1064 - val_loss: 0.4064
Epoch 12/50
72/72 - 0s - 3ms/step - loss: 0.1054 - val_loss: 0.4061
Epoch 13/50
72/72 - 0s - 3ms/step - loss: 0.1032 - val_loss: 0.4031
Epoch 14/50
72/72 - 0s - 4ms/step - loss: 0.1015 - val_loss: 0.3993
Epoch 15/50
72/72 - 0s - 3ms/step - loss: 0.0991 - val_loss: 0.4040
Epoch 16/50
72/72 - 0s - 3ms/step - loss: 0.0979 - val_loss: 0.4085
Epoch 17/50
72/72 - 0s - 3ms/step - loss: 0.0967 - val_loss: 0.4042
Epoch 18/50
72/72 - 0s - 3ms/step - loss: 0.0959 - val_loss: 0.4030
Epoch 19/50
72/72 - 0s - 3ms/step - loss: 0.0950 - val_loss: 0.4050
Epoch 20/50
72/72 - 0s - 3ms/step - loss: 0.0935 - val_loss: 0.4033
Epoch 21/50
72/72 - 0s - 3ms/step - loss: 0.0925 - val_loss: 0.4089
Epoch 22/50
72/72 - 0s - 3ms/step - loss: 0.0925 - val_loss: 0.4045
Epoch 23/50
72/72 - 0s - 3ms/step - loss: 0.0915 - val_loss: 0.4073
Epoch 24/50
72/72 - 0s - 3ms/step - loss: 0.0906 - val_loss: 0.4068
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4462
Per-joint RMSE: 0.6456 0.5814 0.4614 0.2255 0.3072 0.2855
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:44:34.228890: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:44:34.253745: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 05:44:35.103311: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:35.108039: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:35.108832: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:35.110663: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:35.111460: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:35.112292: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:35.195549: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:35.196399: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:35.197144: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:35.197869: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:44:35.496339: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 10/10

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.551834e-01  RMSE=5.051568e-01
  per-joint RMSE: 0.7325 0.6438 0.5282 0.2647 0.3552 0.3237
Residual LSTM:  MSE=1.990801e-01      RMSE=4.461840e-01
  per-joint RMSE: 0.6456 0.5814 0.4614 0.2255 0.3072 0.2855
Combined torque MSE=1.990801e-01     RMSE=4.461840e-01
  per-joint RMSE: 0.6456 0.5814 0.4614 0.2255 0.3072 0.2855
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200.npz --H 25 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200.json
H=25, n_dof=6, feature_dim=6
X_train: (22948, 25, 6)  Y_train: (22948, 6)
X_test : (1904, 25, 6)  Y_test : (1904, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:44:37.337891: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:44:37.361774: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep200.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (22948, 25, 6), Y_train = (22948, 6)
  X_test  = (1904, 25, 6),  Y_test  = (1904, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:44:38.323575: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:38.328157: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:38.328951: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:38.330533: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:38.331321: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:38.332056: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:38.410400: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:38.411247: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:38.411998: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:38.412738: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:44:39.334995: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
72/72 - 2s - 22ms/step - loss: 0.6533 - val_loss: 0.7628
Epoch 2/50
72/72 - 0s - 3ms/step - loss: 0.4325 - val_loss: 0.5575
Epoch 3/50
72/72 - 0s - 3ms/step - loss: 0.3316 - val_loss: 0.5474
Epoch 4/50
72/72 - 0s - 3ms/step - loss: 0.2686 - val_loss: 0.5904
Epoch 5/50
72/72 - 0s - 3ms/step - loss: 0.2204 - val_loss: 0.6243
Epoch 6/50
72/72 - 0s - 3ms/step - loss: 0.1944 - val_loss: 0.6127
Epoch 7/50
72/72 - 0s - 3ms/step - loss: 0.1793 - val_loss: 0.6153
Epoch 8/50
72/72 - 0s - 3ms/step - loss: 0.1625 - val_loss: 0.5390
Epoch 9/50
72/72 - 0s - 3ms/step - loss: 0.1523 - val_loss: 0.5475
Epoch 10/50
72/72 - 0s - 3ms/step - loss: 0.1439 - val_loss: 0.5292
Epoch 11/50
72/72 - 0s - 3ms/step - loss: 0.1367 - val_loss: 0.5083
Epoch 12/50
72/72 - 0s - 3ms/step - loss: 0.1409 - val_loss: 0.5191
Epoch 13/50
72/72 - 0s - 3ms/step - loss: 0.1264 - val_loss: 0.4933
Epoch 14/50
72/72 - 0s - 3ms/step - loss: 0.1356 - val_loss: 0.5190
Epoch 15/50
72/72 - 0s - 4ms/step - loss: 0.1234 - val_loss: 0.5010
Epoch 16/50
72/72 - 0s - 3ms/step - loss: 0.1211 - val_loss: 0.4941
Epoch 17/50
72/72 - 0s - 3ms/step - loss: 0.1224 - val_loss: 0.4749
Epoch 18/50
72/72 - 0s - 3ms/step - loss: 0.1175 - val_loss: 0.4886
Epoch 19/50
72/72 - 0s - 3ms/step - loss: 0.1144 - val_loss: 0.4718
Epoch 20/50
72/72 - 0s - 3ms/step - loss: 0.1132 - val_loss: 0.4749
Epoch 21/50
72/72 - 0s - 3ms/step - loss: 0.1213 - val_loss: 0.4623
Epoch 22/50
72/72 - 0s - 3ms/step - loss: 0.1198 - val_loss: 0.4578
Epoch 23/50
72/72 - 0s - 3ms/step - loss: 0.1097 - val_loss: 0.4569
Epoch 24/50
72/72 - 0s - 3ms/step - loss: 0.1093 - val_loss: 0.4525
Epoch 25/50
72/72 - 0s - 3ms/step - loss: 0.1080 - val_loss: 0.4577
Epoch 26/50
72/72 - 0s - 3ms/step - loss: 0.1056 - val_loss: 0.4409
Epoch 27/50
72/72 - 0s - 3ms/step - loss: 0.1162 - val_loss: 0.4636
Epoch 28/50
72/72 - 0s - 3ms/step - loss: 0.1141 - val_loss: 0.4471
Epoch 29/50
72/72 - 0s - 3ms/step - loss: 0.1030 - val_loss: 0.4494
Epoch 30/50
72/72 - 0s - 3ms/step - loss: 0.1053 - val_loss: 0.4481
Epoch 31/50
72/72 - 0s - 3ms/step - loss: 0.1008 - val_loss: 0.4380
Epoch 32/50
72/72 - 0s - 3ms/step - loss: 0.1036 - val_loss: 0.4514
Epoch 33/50
72/72 - 0s - 3ms/step - loss: 0.1017 - val_loss: 0.4440
Epoch 34/50
72/72 - 0s - 3ms/step - loss: 0.1028 - val_loss: 0.4411
Epoch 35/50
72/72 - 0s - 3ms/step - loss: 0.1011 - val_loss: 0.4533
Epoch 36/50
72/72 - 0s - 3ms/step - loss: 0.0994 - val_loss: 0.4486
Epoch 37/50
72/72 - 0s - 3ms/step - loss: 0.0970 - val_loss: 0.4487
Epoch 38/50
72/72 - 0s - 3ms/step - loss: 0.0983 - val_loss: 0.4517
Epoch 39/50
72/72 - 0s - 3ms/step - loss: 0.0972 - val_loss: 0.4443
Epoch 40/50
72/72 - 0s - 3ms/step - loss: 0.0962 - val_loss: 0.4346
Epoch 41/50
72/72 - 0s - 3ms/step - loss: 0.0958 - val_loss: 0.4348
Epoch 42/50
72/72 - 0s - 3ms/step - loss: 0.0963 - val_loss: 0.4446
Epoch 43/50
72/72 - 0s - 3ms/step - loss: 0.0946 - val_loss: 0.4359
Epoch 44/50
72/72 - 0s - 3ms/step - loss: 0.0940 - val_loss: 0.4437
Epoch 45/50
72/72 - 0s - 3ms/step - loss: 0.0957 - val_loss: 0.4536
Epoch 46/50
72/72 - 0s - 3ms/step - loss: 0.0941 - val_loss: 0.4496
Epoch 47/50
72/72 - 0s - 3ms/step - loss: 0.0933 - val_loss: 0.4482
Epoch 48/50
72/72 - 0s - 3ms/step - loss: 0.0926 - val_loss: 0.4525
Epoch 49/50
72/72 - 0s - 3ms/step - loss: 0.0915 - val_loss: 0.4464
Epoch 50/50
72/72 - 0s - 3ms/step - loss: 0.0920 - val_loss: 0.4652
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5192
Per-joint RMSE: 0.7632 0.5550 0.6216 0.2394 0.4197 0.3273
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:44:51.088362: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:44:51.112748: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 05:44:51.962060: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:51.966716: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:51.967598: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:51.969393: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:51.970185: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:51.970923: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:52.052670: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:52.053508: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:52.054256: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:52.054982: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:44:52.346389: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 10/10

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.551834e-01  RMSE=5.051568e-01
  per-joint RMSE: 0.7325 0.6438 0.5282 0.2647 0.3552 0.3237
Residual LSTM:  MSE=2.695874e-01      RMSE=5.192180e-01
  per-joint RMSE: 0.7632 0.5550 0.6216 0.2394 0.4197 0.3273
Combined torque MSE=2.695874e-01     RMSE=5.192180e-01
  per-joint RMSE: 0.7632 0.5550 0.6216 0.2394 0.4197 0.3273
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200.npz --H 25 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200.json
H=25, n_dof=6, feature_dim=18
X_train: (22948, 25, 18)  Y_train: (22948, 6)
X_test : (1904, 25, 18)  Y_test : (1904, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:44:54.231105: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:44:54.255762: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep200.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (22948, 25, 18), Y_train = (22948, 6)
  X_test  = (1904, 25, 18),  Y_test  = (1904, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:44:55.272133: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:55.276845: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:55.277636: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:55.279291: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:55.280078: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:55.280823: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:55.357213: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:55.358041: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:55.358872: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:44:55.359606: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:44:56.271551: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
72/72 - 2s - 21ms/step - loss: 0.3897 - val_loss: 0.6783
Epoch 2/50
72/72 - 0s - 3ms/step - loss: 0.2276 - val_loss: 0.6200
Epoch 3/50
72/72 - 0s - 3ms/step - loss: 0.1883 - val_loss: 0.5953
Epoch 4/50
72/72 - 0s - 3ms/step - loss: 0.1627 - val_loss: 0.5800
Epoch 5/50
72/72 - 0s - 3ms/step - loss: 0.1479 - val_loss: 0.5823
Epoch 6/50
72/72 - 0s - 3ms/step - loss: 0.1387 - val_loss: 0.5802
Epoch 7/50
72/72 - 0s - 3ms/step - loss: 0.1293 - val_loss: 0.5872
Epoch 8/50
72/72 - 0s - 3ms/step - loss: 0.1245 - val_loss: 0.5653
Epoch 9/50
72/72 - 0s - 3ms/step - loss: 0.1208 - val_loss: 0.5643
Epoch 10/50
72/72 - 0s - 3ms/step - loss: 0.1183 - val_loss: 0.5607
Epoch 11/50
72/72 - 0s - 3ms/step - loss: 0.1142 - val_loss: 0.5587
Epoch 12/50
72/72 - 0s - 3ms/step - loss: 0.1116 - val_loss: 0.5639
Epoch 13/50
72/72 - 0s - 3ms/step - loss: 0.1099 - val_loss: 0.5576
Epoch 14/50
72/72 - 0s - 3ms/step - loss: 0.1073 - val_loss: 0.5619
Epoch 15/50
72/72 - 0s - 4ms/step - loss: 0.1069 - val_loss: 0.5593
Epoch 16/50
72/72 - 0s - 3ms/step - loss: 0.1051 - val_loss: 0.5503
Epoch 17/50
72/72 - 0s - 3ms/step - loss: 0.1033 - val_loss: 0.5536
Epoch 18/50
72/72 - 0s - 3ms/step - loss: 0.1000 - val_loss: 0.5536
Epoch 19/50
72/72 - 0s - 3ms/step - loss: 0.1008 - val_loss: 0.5485
Epoch 20/50
72/72 - 0s - 3ms/step - loss: 0.0987 - val_loss: 0.5446
Epoch 21/50
72/72 - 0s - 3ms/step - loss: 0.0989 - val_loss: 0.5485
Epoch 22/50
72/72 - 0s - 3ms/step - loss: 0.0958 - val_loss: 0.5451
Epoch 23/50
72/72 - 0s - 3ms/step - loss: 0.0952 - val_loss: 0.5488
Epoch 24/50
72/72 - 0s - 3ms/step - loss: 0.0954 - val_loss: 0.5442
Epoch 25/50
72/72 - 0s - 3ms/step - loss: 0.0936 - val_loss: 0.5408
Epoch 26/50
72/72 - 0s - 3ms/step - loss: 0.0944 - val_loss: 0.5472
Epoch 27/50
72/72 - 0s - 3ms/step - loss: 0.0922 - val_loss: 0.5421
Epoch 28/50
72/72 - 0s - 3ms/step - loss: 0.0935 - val_loss: 0.5461
Epoch 29/50
72/72 - 0s - 3ms/step - loss: 0.0925 - val_loss: 0.5464
Epoch 30/50
72/72 - 0s - 3ms/step - loss: 0.0906 - val_loss: 0.5409
Epoch 31/50
72/72 - 0s - 3ms/step - loss: 0.0906 - val_loss: 0.5447
Epoch 32/50
72/72 - 0s - 3ms/step - loss: 0.0902 - val_loss: 0.5371
Epoch 33/50
72/72 - 0s - 3ms/step - loss: 0.0880 - val_loss: 0.5355
Epoch 34/50
72/72 - 0s - 3ms/step - loss: 0.0885 - val_loss: 0.5383
Epoch 35/50
72/72 - 0s - 3ms/step - loss: 0.0890 - val_loss: 0.5488
Epoch 36/50
72/72 - 0s - 3ms/step - loss: 0.0861 - val_loss: 0.5477
Epoch 37/50
72/72 - 0s - 3ms/step - loss: 0.0874 - val_loss: 0.5361
Epoch 38/50
72/72 - 0s - 3ms/step - loss: 0.0883 - val_loss: 0.5418
Epoch 39/50
72/72 - 0s - 3ms/step - loss: 0.0861 - val_loss: 0.5399
Epoch 40/50
72/72 - 0s - 3ms/step - loss: 0.0867 - val_loss: 0.5431
Epoch 41/50
72/72 - 0s - 3ms/step - loss: 0.0846 - val_loss: 0.5409
Epoch 42/50
72/72 - 0s - 3ms/step - loss: 0.0841 - val_loss: 0.5358
Epoch 43/50
72/72 - 0s - 3ms/step - loss: 0.0835 - val_loss: 0.5444
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5209
Per-joint RMSE: 0.7203 0.7530 0.4660 0.2818 0.3829 0.3143
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:45:06.508315: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:45:06.532577: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:45:07.383465: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:07.388131: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:07.388927: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:07.390611: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:07.391400: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:07.392138: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:07.469118: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:07.470039: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:07.470777: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:07.471599: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:45:07.769574: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 10/10

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.551834e-01  RMSE=5.051568e-01
  per-joint RMSE: 0.7325 0.6438 0.5282 0.2647 0.3552 0.3237
Residual LSTM:  MSE=2.713148e-01      RMSE=5.208789e-01
  per-joint RMSE: 0.7203 0.7530 0.4660 0.2818 0.3829 0.3143
Combined torque MSE=2.713148e-01     RMSE=5.208789e-01
  per-joint RMSE: 0.7203 0.7530 0.4660 0.2818 0.3829 0.3143
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200.npz --H 25 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200.json
H=25, n_dof=6, feature_dim=18
X_train: (22948, 25, 18)  Y_train: (22948, 6)
X_test : (1904, 25, 18)  Y_test : (1904, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:45:09.633867: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:45:09.657820: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep200.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (22948, 25, 18), Y_train = (22948, 6)
  X_test  = (1904, 25, 18),  Y_test  = (1904, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:45:10.662358: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:10.667022: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:10.667807: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:10.669484: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:10.670269: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:10.671010: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:10.747838: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:10.748679: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:10.749424: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:10.750236: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:45:11.653296: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
72/72 - 2s - 21ms/step - loss: 0.3641 - val_loss: 0.4617
Epoch 2/50
72/72 - 0s - 3ms/step - loss: 0.1955 - val_loss: 0.4283
Epoch 3/50
72/72 - 0s - 3ms/step - loss: 0.1620 - val_loss: 0.4115
Epoch 4/50
72/72 - 0s - 3ms/step - loss: 0.1457 - val_loss: 0.4003
Epoch 5/50
72/72 - 0s - 3ms/step - loss: 0.1357 - val_loss: 0.4018
Epoch 6/50
72/72 - 0s - 3ms/step - loss: 0.1274 - val_loss: 0.3976
Epoch 7/50
72/72 - 0s - 3ms/step - loss: 0.1209 - val_loss: 0.3876
Epoch 8/50
72/72 - 0s - 3ms/step - loss: 0.1161 - val_loss: 0.3951
Epoch 9/50
72/72 - 0s - 3ms/step - loss: 0.1123 - val_loss: 0.3893
Epoch 10/50
72/72 - 0s - 3ms/step - loss: 0.1097 - val_loss: 0.3925
Epoch 11/50
72/72 - 0s - 3ms/step - loss: 0.1073 - val_loss: 0.3844
Epoch 12/50
72/72 - 0s - 3ms/step - loss: 0.1044 - val_loss: 0.3844
Epoch 13/50
72/72 - 0s - 3ms/step - loss: 0.1030 - val_loss: 0.3833
Epoch 14/50
72/72 - 0s - 3ms/step - loss: 0.1008 - val_loss: 0.3854
Epoch 15/50
72/72 - 0s - 4ms/step - loss: 0.0992 - val_loss: 0.3904
Epoch 16/50
72/72 - 0s - 3ms/step - loss: 0.0988 - val_loss: 0.3907
Epoch 17/50
72/72 - 0s - 3ms/step - loss: 0.0977 - val_loss: 0.3870
Epoch 18/50
72/72 - 0s - 3ms/step - loss: 0.0951 - val_loss: 0.3869
Epoch 19/50
72/72 - 0s - 3ms/step - loss: 0.0957 - val_loss: 0.3789
Epoch 20/50
72/72 - 0s - 3ms/step - loss: 0.0936 - val_loss: 0.3864
Epoch 21/50
72/72 - 0s - 3ms/step - loss: 0.0921 - val_loss: 0.3915
Epoch 22/50
72/72 - 0s - 3ms/step - loss: 0.0919 - val_loss: 0.3930
Epoch 23/50
72/72 - 0s - 3ms/step - loss: 0.0912 - val_loss: 0.3893
Epoch 24/50
72/72 - 0s - 3ms/step - loss: 0.0907 - val_loss: 0.3856
Epoch 25/50
72/72 - 0s - 3ms/step - loss: 0.0888 - val_loss: 0.3922
Epoch 26/50
72/72 - 0s - 3ms/step - loss: 0.0883 - val_loss: 0.3871
Epoch 27/50
72/72 - 0s - 3ms/step - loss: 0.0880 - val_loss: 0.3830
Epoch 28/50
72/72 - 0s - 3ms/step - loss: 0.0872 - val_loss: 0.3860
Epoch 29/50
72/72 - 0s - 3ms/step - loss: 0.0865 - val_loss: 0.3826
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4370
Per-joint RMSE: 0.6627 0.5235 0.4509 0.2422 0.3232 0.2572
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:45:19.080714: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:45:19.104888: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:45:19.954034: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:19.958831: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:19.959623: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:19.961330: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:19.962114: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:19.962855: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:20.044800: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:20.045635: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:20.046376: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:20.047188: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:45:20.342358: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 10/10

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.551834e-01  RMSE=5.051568e-01
  per-joint RMSE: 0.7325 0.6438 0.5282 0.2647 0.3552 0.3237
Residual LSTM:  MSE=1.909772e-01      RMSE=4.370094e-01
  per-joint RMSE: 0.6627 0.5235 0.4509 0.2422 0.3232 0.2572
Combined torque MSE=1.909772e-01     RMSE=4.370094e-01
  per-joint RMSE: 0.6627 0.5235 0.4509 0.2422 0.3232 0.2572
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H25_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200.npz --H 50 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200.json
H=50, n_dof=6, feature_dim=24
X_train: (22373, 50, 24)  Y_train: (22373, 6)
X_test : (1804, 50, 24)  Y_test : (1804, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:45:22.257343: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:45:22.281332: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (22373, 50, 24), Y_train = (22373, 6)
  X_test  = (1804, 50, 24),  Y_test  = (1804, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:45:23.375285: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:23.379820: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:23.380615: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:23.382333: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:23.383117: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:23.383854: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:23.463660: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:23.464503: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:23.465252: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:23.465986: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:45:24.412148: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
70/70 - 2s - 23ms/step - loss: 0.3833 - val_loss: 0.5150
Epoch 2/50
70/70 - 0s - 4ms/step - loss: 0.1960 - val_loss: 0.4475
Epoch 3/50
70/70 - 0s - 4ms/step - loss: 0.1631 - val_loss: 0.4373
Epoch 4/50
70/70 - 0s - 4ms/step - loss: 0.1466 - val_loss: 0.4223
Epoch 5/50
70/70 - 0s - 4ms/step - loss: 0.1378 - val_loss: 0.4192
Epoch 6/50
70/70 - 0s - 4ms/step - loss: 0.1308 - val_loss: 0.4149
Epoch 7/50
70/70 - 0s - 4ms/step - loss: 0.1239 - val_loss: 0.4194
Epoch 8/50
70/70 - 0s - 4ms/step - loss: 0.1203 - val_loss: 0.4159
Epoch 9/50
70/70 - 0s - 4ms/step - loss: 0.1162 - val_loss: 0.4157
Epoch 10/50
70/70 - 0s - 4ms/step - loss: 0.1132 - val_loss: 0.4171
Epoch 11/50
70/70 - 0s - 4ms/step - loss: 0.1109 - val_loss: 0.4228
Epoch 12/50
70/70 - 0s - 4ms/step - loss: 0.1092 - val_loss: 0.4229
Epoch 13/50
70/70 - 0s - 4ms/step - loss: 0.1066 - val_loss: 0.4191
Epoch 14/50
70/70 - 0s - 4ms/step - loss: 0.1043 - val_loss: 0.4220
Epoch 15/50
70/70 - 0s - 5ms/step - loss: 0.1025 - val_loss: 0.4237
Epoch 16/50
70/70 - 0s - 4ms/step - loss: 0.1024 - val_loss: 0.4186
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4790
Per-joint RMSE: 0.6861 0.6770 0.4483 0.2496 0.3293 0.2751
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:45:30.772787: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:45:30.796862: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 05:45:31.648031: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:31.652812: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:31.653609: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:31.655298: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:31.656093: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:31.656828: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:31.738360: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:31.739204: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:31.739967: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:31.740700: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:45:32.039049: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 10/10

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.479018e-01  RMSE=4.978974e-01
  per-joint RMSE: 0.7238 0.6340 0.5167 0.2610 0.3529 0.3192
Residual LSTM:  MSE=2.294035e-01      RMSE=4.789608e-01
  per-joint RMSE: 0.6861 0.6770 0.4483 0.2496 0.3293 0.2751
Combined torque MSE=2.294035e-01     RMSE=4.789608e-01
  per-joint RMSE: 0.6861 0.6770 0.4483 0.2496 0.3293 0.2751
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_full__lstm_s2_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200.npz --H 50 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200.json
H=50, n_dof=6, feature_dim=6
X_train: (22373, 50, 6)  Y_train: (22373, 6)
X_test : (1804, 50, 6)  Y_test : (1804, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:45:33.846444: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:45:33.870423: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (22373, 50, 6), Y_train = (22373, 6)
  X_test  = (1804, 50, 6),  Y_test  = (1804, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:45:34.866413: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:34.871238: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:34.872110: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:34.873789: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:34.874592: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:34.875322: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:34.953591: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:34.954429: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:34.955176: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:34.955909: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:45:35.888775: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
70/70 - 2s - 23ms/step - loss: 0.6115 - val_loss: 0.6371
Epoch 2/50
70/70 - 0s - 4ms/step - loss: 0.3706 - val_loss: 0.6056
Epoch 3/50
70/70 - 0s - 4ms/step - loss: 0.2653 - val_loss: 0.5704
Epoch 4/50
70/70 - 0s - 4ms/step - loss: 0.2150 - val_loss: 0.5681
Epoch 5/50
70/70 - 0s - 4ms/step - loss: 0.1951 - val_loss: 0.5296
Epoch 6/50
70/70 - 0s - 4ms/step - loss: 0.1808 - val_loss: 0.5304
Epoch 7/50
70/70 - 0s - 4ms/step - loss: 0.1542 - val_loss: 0.5305
Epoch 8/50
70/70 - 0s - 4ms/step - loss: 0.1464 - val_loss: 0.5079
Epoch 9/50
70/70 - 0s - 4ms/step - loss: 0.1395 - val_loss: 0.5304
Epoch 10/50
70/70 - 0s - 4ms/step - loss: 0.1368 - val_loss: 0.5252
Epoch 11/50
70/70 - 0s - 4ms/step - loss: 0.1360 - val_loss: 0.5066
Epoch 12/50
70/70 - 0s - 4ms/step - loss: 0.1329 - val_loss: 0.5053
Epoch 13/50
70/70 - 0s - 4ms/step - loss: 0.1252 - val_loss: 0.5078
Epoch 14/50
70/70 - 0s - 4ms/step - loss: 0.1224 - val_loss: 0.5140
Epoch 15/50
70/70 - 0s - 5ms/step - loss: 0.1200 - val_loss: 0.5162
Epoch 16/50
70/70 - 0s - 4ms/step - loss: 0.1195 - val_loss: 0.5110
Epoch 17/50
70/70 - 0s - 4ms/step - loss: 0.1153 - val_loss: 0.5063
Epoch 18/50
70/70 - 0s - 4ms/step - loss: 0.1150 - val_loss: 0.5093
Epoch 19/50
70/70 - 0s - 4ms/step - loss: 0.1174 - val_loss: 0.5103
Epoch 20/50
70/70 - 0s - 4ms/step - loss: 0.1157 - val_loss: 0.5085
Epoch 21/50
70/70 - 0s - 4ms/step - loss: 0.1138 - val_loss: 0.5174
Epoch 22/50
70/70 - 0s - 4ms/step - loss: 0.1109 - val_loss: 0.4975
Epoch 23/50
70/70 - 0s - 4ms/step - loss: 0.1110 - val_loss: 0.5214
Epoch 24/50
70/70 - 0s - 4ms/step - loss: 0.1093 - val_loss: 0.5045
Epoch 25/50
70/70 - 0s - 4ms/step - loss: 0.1111 - val_loss: 0.4927
Epoch 26/50
70/70 - 0s - 4ms/step - loss: 0.1079 - val_loss: 0.4959
Epoch 27/50
70/70 - 0s - 4ms/step - loss: 0.1137 - val_loss: 0.4974
Epoch 28/50
70/70 - 0s - 4ms/step - loss: 0.1078 - val_loss: 0.5044
Epoch 29/50
70/70 - 0s - 4ms/step - loss: 0.1059 - val_loss: 0.5098
Epoch 30/50
70/70 - 0s - 4ms/step - loss: 0.1040 - val_loss: 0.5207
Epoch 31/50
70/70 - 0s - 4ms/step - loss: 0.1039 - val_loss: 0.5137
Epoch 32/50
70/70 - 0s - 4ms/step - loss: 0.1026 - val_loss: 0.5137
Epoch 33/50
70/70 - 0s - 4ms/step - loss: 0.1025 - val_loss: 0.5105
Epoch 34/50
70/70 - 0s - 4ms/step - loss: 0.1008 - val_loss: 0.5051
Epoch 35/50
70/70 - 0s - 4ms/step - loss: 0.0999 - val_loss: 0.5046
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5368
Per-joint RMSE: 0.9081 0.4575 0.6022 0.2798 0.3842 0.3264
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:45:47.591502: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:45:47.615552: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 05:45:48.455020: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:48.459733: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:48.460525: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:48.462210: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:48.462992: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:48.463738: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:48.539004: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:48.539842: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:48.540585: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:48.541313: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:45:48.837149: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 10/10

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.479018e-01  RMSE=4.978974e-01
  per-joint RMSE: 0.7238 0.6340 0.5167 0.2610 0.3529 0.3192
Residual LSTM:  MSE=2.881651e-01      RMSE=5.368102e-01
  per-joint RMSE: 0.9081 0.4575 0.6022 0.2798 0.3842 0.3264
Combined torque MSE=2.881651e-01     RMSE=5.368102e-01
  per-joint RMSE: 0.9081 0.4575 0.6022 0.2798 0.3842 0.3264
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_tau_hat__lstm_s2_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200.npz --H 50 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200.json
H=50, n_dof=6, feature_dim=18
X_train: (22373, 50, 18)  Y_train: (22373, 6)
X_test : (1804, 50, 18)  Y_test : (1804, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:45:50.750637: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:45:50.774255: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (22373, 50, 18), Y_train = (22373, 6)
  X_test  = (1804, 50, 18),  Y_test  = (1804, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:45:51.838801: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:51.843333: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:51.844208: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:51.845749: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:51.846538: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:51.847280: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:51.928959: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:51.929798: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:51.930545: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:45:51.931292: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:45:52.913288: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
70/70 - 2s - 24ms/step - loss: 0.3857 - val_loss: 0.6590
Epoch 2/50
70/70 - 0s - 4ms/step - loss: 0.2239 - val_loss: 0.6142
Epoch 3/50
70/70 - 0s - 4ms/step - loss: 0.1876 - val_loss: 0.6130
Epoch 4/50
70/70 - 0s - 4ms/step - loss: 0.1676 - val_loss: 0.6017
Epoch 5/50
70/70 - 0s - 4ms/step - loss: 0.1514 - val_loss: 0.5953
Epoch 6/50
70/70 - 0s - 4ms/step - loss: 0.1427 - val_loss: 0.5946
Epoch 7/50
70/70 - 0s - 4ms/step - loss: 0.1347 - val_loss: 0.5901
Epoch 8/50
70/70 - 0s - 4ms/step - loss: 0.1295 - val_loss: 0.5890
Epoch 9/50
70/70 - 0s - 4ms/step - loss: 0.1246 - val_loss: 0.6003
Epoch 10/50
70/70 - 0s - 4ms/step - loss: 0.1210 - val_loss: 0.5940
Epoch 11/50
70/70 - 0s - 4ms/step - loss: 0.1191 - val_loss: 0.5929
Epoch 12/50
70/70 - 0s - 4ms/step - loss: 0.1150 - val_loss: 0.5923
Epoch 13/50
70/70 - 0s - 4ms/step - loss: 0.1137 - val_loss: 0.5936
Epoch 14/50
70/70 - 0s - 4ms/step - loss: 0.1110 - val_loss: 0.5890
Epoch 15/50
70/70 - 0s - 5ms/step - loss: 0.1090 - val_loss: 0.5830
Epoch 16/50
70/70 - 0s - 4ms/step - loss: 0.1070 - val_loss: 0.5872
Epoch 17/50
70/70 - 0s - 4ms/step - loss: 0.1070 - val_loss: 0.5875
Epoch 18/50
70/70 - 0s - 4ms/step - loss: 0.1039 - val_loss: 0.5913
Epoch 19/50
70/70 - 0s - 4ms/step - loss: 0.1056 - val_loss: 0.5919
Epoch 20/50
70/70 - 0s - 4ms/step - loss: 0.1026 - val_loss: 0.5806
Epoch 21/50
70/70 - 0s - 4ms/step - loss: 0.1014 - val_loss: 0.5767
Epoch 22/50
70/70 - 0s - 4ms/step - loss: 0.0994 - val_loss: 0.5773
Epoch 23/50
70/70 - 0s - 4ms/step - loss: 0.0992 - val_loss: 0.5694
Epoch 24/50
70/70 - 0s - 4ms/step - loss: 0.0975 - val_loss: 0.5671
Epoch 25/50
70/70 - 0s - 4ms/step - loss: 0.0967 - val_loss: 0.5770
Epoch 26/50
70/70 - 0s - 4ms/step - loss: 0.0949 - val_loss: 0.5764
Epoch 27/50
70/70 - 0s - 4ms/step - loss: 0.0955 - val_loss: 0.5797
Epoch 28/50
70/70 - 0s - 4ms/step - loss: 0.0952 - val_loss: 0.5696
Epoch 29/50
70/70 - 0s - 4ms/step - loss: 0.0940 - val_loss: 0.5643
Epoch 30/50
70/70 - 0s - 4ms/step - loss: 0.0929 - val_loss: 0.5747
Epoch 31/50
70/70 - 0s - 4ms/step - loss: 0.0936 - val_loss: 0.5665
Epoch 32/50
70/70 - 0s - 4ms/step - loss: 0.0905 - val_loss: 0.5605
Epoch 33/50
70/70 - 0s - 4ms/step - loss: 0.0901 - val_loss: 0.5688
Epoch 34/50
70/70 - 0s - 4ms/step - loss: 0.0900 - val_loss: 0.5667
Epoch 35/50
70/70 - 0s - 4ms/step - loss: 0.0899 - val_loss: 0.5587
Epoch 36/50
70/70 - 0s - 4ms/step - loss: 0.0893 - val_loss: 0.5654
Epoch 37/50
70/70 - 0s - 4ms/step - loss: 0.0888 - val_loss: 0.5607
Epoch 38/50
70/70 - 0s - 4ms/step - loss: 0.0882 - val_loss: 0.5577
Epoch 39/50
70/70 - 0s - 4ms/step - loss: 0.0878 - val_loss: 0.5623
Epoch 40/50
70/70 - 0s - 4ms/step - loss: 0.0874 - val_loss: 0.5643
Epoch 41/50
70/70 - 0s - 4ms/step - loss: 0.0876 - val_loss: 0.5563
Epoch 42/50
70/70 - 0s - 4ms/step - loss: 0.0862 - val_loss: 0.5467
Epoch 43/50
70/70 - 0s - 4ms/step - loss: 0.0855 - val_loss: 0.5549
Epoch 44/50
70/70 - 0s - 4ms/step - loss: 0.0846 - val_loss: 0.5543
Epoch 45/50
70/70 - 0s - 4ms/step - loss: 0.0840 - val_loss: 0.5553
Epoch 46/50
70/70 - 0s - 4ms/step - loss: 0.0838 - val_loss: 0.5495
Epoch 47/50
70/70 - 0s - 4ms/step - loss: 0.0840 - val_loss: 0.5493
Epoch 48/50
70/70 - 0s - 4ms/step - loss: 0.0838 - val_loss: 0.5499
Epoch 49/50
70/70 - 0s - 4ms/step - loss: 0.0832 - val_loss: 0.5502
Epoch 50/50
70/70 - 0s - 4ms/step - loss: 0.0827 - val_loss: 0.5535
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4967
Per-joint RMSE: 0.7309 0.6373 0.4465 0.3215 0.3727 0.3138
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:46:09.298124: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:46:09.322896: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:46:10.171472: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:10.176095: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:10.176888: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:10.178634: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:10.179424: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:10.180153: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:10.256061: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:10.256969: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:10.257706: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:10.258434: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8951 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:46:10.559348: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 10/10

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.479018e-01  RMSE=4.978974e-01
  per-joint RMSE: 0.7238 0.6340 0.5167 0.2610 0.3529 0.3192
Residual LSTM:  MSE=2.467488e-01      RMSE=4.967381e-01
  per-joint RMSE: 0.7309 0.6373 0.4465 0.3215 0.3727 0.3138
Combined torque MSE=2.467488e-01     RMSE=4.967382e-01
  per-joint RMSE: 0.7309 0.6373 0.4465 0.3215 0.3727 0.3138
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state__lstm_s2_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200.npz --H 50 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200.json
H=50, n_dof=6, feature_dim=18
X_train: (22373, 50, 18)  Y_train: (22373, 6)
X_test : (1804, 50, 18)  Y_test : (1804, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 50 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:46:12.472380: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:46:12.495978: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (22373, 50, 18), Y_train = (22373, 6)
  X_test  = (1804, 50, 18),  Y_test  = (1804, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 05:46:13.570134: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:13.574734: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:13.575532: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:13.577071: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:13.577858: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:13.578597: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:13.663610: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:13.664673: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:13.665486: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:13.666222: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/50
2026-01-22 05:46:14.631744: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
70/70 - 2s - 23ms/step - loss: 0.3537 - val_loss: 0.4737
Epoch 2/50
70/70 - 0s - 4ms/step - loss: 0.1965 - val_loss: 0.4256
Epoch 3/50
70/70 - 0s - 4ms/step - loss: 0.1642 - val_loss: 0.4183
Epoch 4/50
70/70 - 0s - 4ms/step - loss: 0.1492 - val_loss: 0.4044
Epoch 5/50
70/70 - 0s - 4ms/step - loss: 0.1383 - val_loss: 0.3962
Epoch 6/50
70/70 - 0s - 4ms/step - loss: 0.1326 - val_loss: 0.3828
Epoch 7/50
70/70 - 0s - 4ms/step - loss: 0.1257 - val_loss: 0.3837
Epoch 8/50
70/70 - 0s - 4ms/step - loss: 0.1212 - val_loss: 0.3798
Epoch 9/50
70/70 - 0s - 4ms/step - loss: 0.1175 - val_loss: 0.3771
Epoch 10/50
70/70 - 0s - 4ms/step - loss: 0.1129 - val_loss: 0.3726
Epoch 11/50
70/70 - 0s - 4ms/step - loss: 0.1105 - val_loss: 0.3810
Epoch 12/50
70/70 - 0s - 4ms/step - loss: 0.1095 - val_loss: 0.3746
Epoch 13/50
70/70 - 0s - 4ms/step - loss: 0.1074 - val_loss: 0.3713
Epoch 14/50
70/70 - 0s - 4ms/step - loss: 0.1053 - val_loss: 0.3740
Epoch 15/50
70/70 - 0s - 5ms/step - loss: 0.1028 - val_loss: 0.3773
Epoch 16/50
70/70 - 0s - 4ms/step - loss: 0.1010 - val_loss: 0.3752
Epoch 17/50
70/70 - 0s - 4ms/step - loss: 0.0995 - val_loss: 0.3817
Epoch 18/50
70/70 - 0s - 4ms/step - loss: 0.0980 - val_loss: 0.3747
Epoch 19/50
70/70 - 0s - 4ms/step - loss: 0.0974 - val_loss: 0.3821
Epoch 20/50
70/70 - 0s - 4ms/step - loss: 0.0966 - val_loss: 0.3789
Epoch 21/50
70/70 - 0s - 4ms/step - loss: 0.0956 - val_loss: 0.3690
Epoch 22/50
70/70 - 0s - 4ms/step - loss: 0.0943 - val_loss: 0.3752
Epoch 23/50
70/70 - 0s - 4ms/step - loss: 0.0949 - val_loss: 0.3735
Epoch 24/50
70/70 - 0s - 4ms/step - loss: 0.0925 - val_loss: 0.3711
Epoch 25/50
70/70 - 0s - 4ms/step - loss: 0.0929 - val_loss: 0.3771
Epoch 26/50
70/70 - 0s - 4ms/step - loss: 0.0911 - val_loss: 0.3684
Epoch 27/50
70/70 - 0s - 4ms/step - loss: 0.0909 - val_loss: 0.3703
Epoch 28/50
70/70 - 0s - 4ms/step - loss: 0.0900 - val_loss: 0.3670
Epoch 29/50
70/70 - 0s - 4ms/step - loss: 0.0892 - val_loss: 0.3687
Epoch 30/50
70/70 - 0s - 4ms/step - loss: 0.0874 - val_loss: 0.3711
Epoch 31/50
70/70 - 0s - 4ms/step - loss: 0.0869 - val_loss: 0.3685
Epoch 32/50
70/70 - 0s - 4ms/step - loss: 0.0870 - val_loss: 0.3652
Epoch 33/50
70/70 - 0s - 4ms/step - loss: 0.0853 - val_loss: 0.3710
Epoch 34/50
70/70 - 0s - 4ms/step - loss: 0.0853 - val_loss: 0.3751
Epoch 35/50
70/70 - 0s - 4ms/step - loss: 0.0849 - val_loss: 0.3705
Epoch 36/50
70/70 - 0s - 4ms/step - loss: 0.0842 - val_loss: 0.3667
Epoch 37/50
70/70 - 0s - 4ms/step - loss: 0.0842 - val_loss: 0.3651
Epoch 38/50
70/70 - 0s - 4ms/step - loss: 0.0836 - val_loss: 0.3655
Epoch 39/50
70/70 - 0s - 4ms/step - loss: 0.0823 - val_loss: 0.3653
Epoch 40/50
70/70 - 0s - 4ms/step - loss: 0.0830 - val_loss: 0.3669
Epoch 41/50
70/70 - 0s - 4ms/step - loss: 0.0814 - val_loss: 0.3674
Epoch 42/50
70/70 - 0s - 4ms/step - loss: 0.0808 - val_loss: 0.3683
Epoch 43/50
70/70 - 0s - 4ms/step - loss: 0.0808 - val_loss: 0.3653
Epoch 44/50
70/70 - 0s - 4ms/step - loss: 0.0817 - val_loss: 0.3678
Epoch 45/50
70/70 - 0s - 4ms/step - loss: 0.0794 - val_loss: 0.3631
Epoch 46/50
70/70 - 0s - 4ms/step - loss: 0.0800 - val_loss: 0.3684
Epoch 47/50
70/70 - 0s - 4ms/step - loss: 0.0795 - val_loss: 0.3692
Epoch 48/50
70/70 - 0s - 4ms/step - loss: 0.0786 - val_loss: 0.3632
Epoch 49/50
70/70 - 0s - 4ms/step - loss: 0.0782 - val_loss: 0.3599
Epoch 50/50
70/70 - 0s - 4ms/step - loss: 0.0787 - val_loss: 0.3665
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4239
Per-joint RMSE: 0.6485 0.5260 0.3836 0.2566 0.3186 0.2576
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 05:46:31.027990: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 05:46:31.052082: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200/delan_UR3_Load0_combined_26__A__K50_tf0p2__residual__delan_jax_struct_s2_ep200.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 10
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 05:46:31.883015: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:31.887753: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:31.888541: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:31.890139: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:31.890926: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:31.891654: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:31.968566: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:31.969489: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:31.970232: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 05:46:31.970957: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 05:46:32.266514: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 10/10

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.479018e-01  RMSE=4.978974e-01
  per-joint RMSE: 0.7238 0.6340 0.5167 0.2610 0.3529 0.3192
Residual LSTM:  MSE=1.796842e-01      RMSE=4.238918e-01
  per-joint RMSE: 0.6485 0.5260 0.3836 0.2566 0.3186 0.2576
Combined torque MSE=1.796842e-01     RMSE=4.238918e-01
  per-joint RMSE: 0.6485 0.5260 0.3836 0.2566 0.3186 0.2576
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K50_tf0p2__delan_jax_struct_s2_ep200__feat_state_tauhat__lstm_s2_H50_ep50_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

