################################################################################################################
### RUN: K=75 test_fraction=0.3 seed=0                                                                       ###
### npz_in=/workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed0_dataset.npz ###
################################################################################################################

#####################
### 1) PREPROCESS ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_delan_dataset.py --qdd True --col_format wide --trajectory_amount 75 --test_fraction 0.3 --seed 0 --raw_csv /workspace/shared/data/raw/delan_UR3_Load0_combined_26.csv --out_npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed0_dataset.npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Saved: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed0_dataset.npz
Trajectories: train=53 test=22
Exists: True

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=0                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz                                 ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed0_dataset.npz -t structured -s 0 -r 0 --hp_preset fast_debug --epochs 250 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 250, 'lagrangian_type': <function structured_lagrangian_fn at 0x7c37074001f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed0_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed0_dataset.npz
   dt ≈ 0.022064047964597475
  dof = 6
  Train trajectories = 53
  Test trajectories  = 22
  Train samples = 25078
  Test samples  = 17028
################################################

2026-01-22 06:31:44.234874: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250 | type=structured | dof=6
################################################
2026-01-22 06:31:47.360745: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:31:47.360786: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:31:47.360794: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:31:47.360827: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:31:47.360832: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:31:47.360847: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:31:47.360890: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:31:47.360896: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:31:47.360912: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:31:47.360917: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.2s, Loss=1.61e+01, Inv=1.61e+01, For=1.87e+02, Power=1.91e+00
  [eval] test_mse=3.573e+00  (n=17028)
Epoch 00050: Time=   9.9s, Loss=2.73e+00, Inv=2.73e+00, For=8.63e+01, Power=6.06e-01
Epoch 00100: Time=  13.5s, Loss=2.51e+00, Inv=2.51e+00, For=1.01e+02, Power=5.52e-01
Epoch 00150: Time=  16.9s, Loss=2.41e+00, Inv=2.41e+00, For=1.14e+02, Power=5.38e-01
Epoch 00200: Time=  20.0s, Loss=2.33e+00, Inv=2.33e+00, For=1.24e+02, Power=5.29e-01
  [eval] test_mse=5.315e+00  (n=17028)
Epoch 00250: Time=  23.1s, Loss=2.27e+00, Inv=2.27e+00, For=1.30e+02, Power=5.14e-01
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250
Torque MSE  = 1.081e+00
Torque RMSE = 1.040e+00
Per-joint MSE : 1.524e+00 1.730e+00 1.174e+00 7.546e-01 6.583e-01 6.447e-01
Per-joint RMSE: 1.234e+00 1.315e+00 1.084e+00 8.687e-01 8.114e-01 8.029e-01
Comp Time per Sample = 2.018e-08s / 49542486.1Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed0_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed0_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax
Detected n_dof=6 (seed=0)
2026-01-22 06:32:12.535701: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 53 trajectories
2026-01-22 06:32:13.877911: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:32:13.877925: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:32:15.460072: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:32:15.460086: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:32:17.021465: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/53
  done 50/53
  done 53/53

Exporting split=test: 22 trajectories
2026-01-22 06:32:19.490353: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 22/22

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz --H 25 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.json
H=25, n_dof=6, feature_dim=24
X_train: (24352, 25, 24)  Y_train: (24352, 6)
X_test : (16710, 25, 24)  Y_test : (16710, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:32:21.637058: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:32:21.661203: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (24352, 25, 24), Y_train = (24352, 6)
  X_test  = (16710, 25, 24),  Y_test  = (16710, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:32:22.723147: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:22.728010: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:22.728938: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:22.730605: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:22.731441: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:22.732324: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:22.811529: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:22.812422: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:22.813225: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:22.814007: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:32:23.772435: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
77/77 - 2s - 21ms/step - loss: 0.2517 - val_loss: 1.3934
Epoch 2/60
77/77 - 0s - 3ms/step - loss: 0.1213 - val_loss: 1.3465
Epoch 3/60
77/77 - 0s - 3ms/step - loss: 0.1046 - val_loss: 1.3219
Epoch 4/60
77/77 - 0s - 3ms/step - loss: 0.0958 - val_loss: 1.2944
Epoch 5/60
77/77 - 0s - 3ms/step - loss: 0.0904 - val_loss: 1.2686
Epoch 6/60
77/77 - 0s - 3ms/step - loss: 0.0861 - val_loss: 1.2572
Epoch 7/60
77/77 - 0s - 3ms/step - loss: 0.0829 - val_loss: 1.2178
Epoch 8/60
77/77 - 0s - 3ms/step - loss: 0.0808 - val_loss: 1.1988
Epoch 9/60
77/77 - 0s - 3ms/step - loss: 0.0793 - val_loss: 1.1745
Epoch 10/60
77/77 - 0s - 3ms/step - loss: 0.0782 - val_loss: 1.1430
Epoch 11/60
77/77 - 0s - 3ms/step - loss: 0.0754 - val_loss: 1.1354
Epoch 12/60
77/77 - 0s - 3ms/step - loss: 0.0743 - val_loss: 1.1179
Epoch 13/60
77/77 - 0s - 4ms/step - loss: 0.0730 - val_loss: 1.1001
Epoch 14/60
77/77 - 0s - 3ms/step - loss: 0.0725 - val_loss: 1.0867
Epoch 15/60
77/77 - 0s - 3ms/step - loss: 0.0712 - val_loss: 1.0546
Epoch 16/60
77/77 - 0s - 3ms/step - loss: 0.0715 - val_loss: 1.0440
Epoch 17/60
77/77 - 0s - 3ms/step - loss: 0.0697 - val_loss: 1.0209
Epoch 18/60
77/77 - 0s - 3ms/step - loss: 0.0688 - val_loss: 1.0195
Epoch 19/60
77/77 - 0s - 3ms/step - loss: 0.0681 - val_loss: 0.9953
Epoch 20/60
77/77 - 0s - 3ms/step - loss: 0.0676 - val_loss: 0.9801
Epoch 21/60
77/77 - 0s - 3ms/step - loss: 0.0668 - val_loss: 0.9646
Epoch 22/60
77/77 - 0s - 3ms/step - loss: 0.0662 - val_loss: 0.9577
Epoch 23/60
77/77 - 0s - 3ms/step - loss: 0.0646 - val_loss: 0.9501
Epoch 24/60
77/77 - 0s - 3ms/step - loss: 0.0641 - val_loss: 0.9570
Epoch 25/60
77/77 - 0s - 3ms/step - loss: 0.0644 - val_loss: 0.9287
Epoch 26/60
77/77 - 0s - 3ms/step - loss: 0.0647 - val_loss: 0.9361
Epoch 27/60
77/77 - 0s - 3ms/step - loss: 0.0634 - val_loss: 0.9270
Epoch 28/60
77/77 - 0s - 3ms/step - loss: 0.0633 - val_loss: 0.9266
Epoch 29/60
77/77 - 0s - 3ms/step - loss: 0.0633 - val_loss: 0.8981
Epoch 30/60
77/77 - 0s - 3ms/step - loss: 0.0625 - val_loss: 0.9083
Epoch 31/60
77/77 - 0s - 3ms/step - loss: 0.0616 - val_loss: 0.9000
Epoch 32/60
77/77 - 0s - 3ms/step - loss: 0.0611 - val_loss: 0.8942
Epoch 33/60
77/77 - 0s - 3ms/step - loss: 0.0606 - val_loss: 0.8787
Epoch 34/60
77/77 - 0s - 3ms/step - loss: 0.0607 - val_loss: 0.8748
Epoch 35/60
77/77 - 0s - 3ms/step - loss: 0.0605 - val_loss: 0.8850
Epoch 36/60
77/77 - 0s - 3ms/step - loss: 0.0595 - val_loss: 0.8762
Epoch 37/60
77/77 - 0s - 3ms/step - loss: 0.0598 - val_loss: 0.8717
Epoch 38/60
77/77 - 0s - 3ms/step - loss: 0.0594 - val_loss: 0.8475
Epoch 39/60
77/77 - 0s - 3ms/step - loss: 0.0590 - val_loss: 0.8516
Epoch 40/60
77/77 - 0s - 3ms/step - loss: 0.0594 - val_loss: 0.8398
Epoch 41/60
77/77 - 0s - 3ms/step - loss: 0.0586 - val_loss: 0.8485
Epoch 42/60
77/77 - 0s - 3ms/step - loss: 0.0582 - val_loss: 0.8254
Epoch 43/60
77/77 - 0s - 3ms/step - loss: 0.0582 - val_loss: 0.8301
Epoch 44/60
77/77 - 0s - 3ms/step - loss: 0.0579 - val_loss: 0.8260
Epoch 45/60
77/77 - 0s - 3ms/step - loss: 0.0576 - val_loss: 0.8006
Epoch 46/60
77/77 - 0s - 3ms/step - loss: 0.0573 - val_loss: 0.7999
Epoch 47/60
77/77 - 0s - 3ms/step - loss: 0.0568 - val_loss: 0.7868
Epoch 48/60
77/77 - 0s - 3ms/step - loss: 0.0567 - val_loss: 0.7813
Epoch 49/60
77/77 - 0s - 3ms/step - loss: 0.0563 - val_loss: 0.7882
Epoch 50/60
77/77 - 0s - 3ms/step - loss: 0.0562 - val_loss: 0.7927
Epoch 51/60
77/77 - 0s - 3ms/step - loss: 0.0558 - val_loss: 0.7869
Epoch 52/60
77/77 - 0s - 3ms/step - loss: 0.0559 - val_loss: 0.7867
Epoch 53/60
77/77 - 0s - 3ms/step - loss: 0.0556 - val_loss: 0.7681
Epoch 54/60
77/77 - 0s - 3ms/step - loss: 0.0547 - val_loss: 0.7682
Epoch 55/60
77/77 - 0s - 3ms/step - loss: 0.0546 - val_loss: 0.7794
Epoch 56/60
77/77 - 0s - 3ms/step - loss: 0.0544 - val_loss: 0.7751
Epoch 57/60
77/77 - 0s - 3ms/step - loss: 0.0546 - val_loss: 0.7707
Epoch 58/60
77/77 - 0s - 3ms/step - loss: 0.0544 - val_loss: 0.8011
Epoch 59/60
77/77 - 0s - 3ms/step - loss: 0.0539 - val_loss: 0.7834
Epoch 60/60
77/77 - 0s - 3ms/step - loss: 0.0538 - val_loss: 0.7824
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.9632
Per-joint RMSE: 1.1382 1.1989 1.0232 0.8226 0.7525 0.7370
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:32:38.597083: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:32:38.621429: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:32:39.469951: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:39.474667: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:39.475478: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:39.477055: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:39.477928: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:39.478673: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:39.560041: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:39.560875: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:39.561630: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:39.562368: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:32:39.867197: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.096022e+00  RMSE=1.046911e+00
  per-joint RMSE: 1.2435 1.3226 1.0909 0.8752 0.8179 0.8097
Residual LSTM:  MSE=9.276666e-01      RMSE=9.631545e-01
  per-joint RMSE: 1.1382 1.1989 1.0232 0.8226 0.7525 0.7370
Combined torque MSE=9.276666e-01     RMSE=9.631545e-01
  per-joint RMSE: 1.1382 1.1989 1.0232 0.8226 0.7525 0.7370
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz --H 25 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.json
H=25, n_dof=6, feature_dim=6
X_train: (24352, 25, 6)  Y_train: (24352, 6)
X_test : (16710, 25, 6)  Y_test : (16710, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:32:42.028886: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:32:42.052637: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (24352, 25, 6), Y_train = (24352, 6)
  X_test  = (16710, 25, 6),  Y_test  = (16710, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:32:43.015327: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:43.019879: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:43.020668: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:43.022266: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:43.023054: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:43.023791: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:43.104801: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:43.105716: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:43.106467: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:43.107203: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:32:44.032923: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
77/77 - 2s - 20ms/step - loss: 0.7446 - val_loss: 2.1284
Epoch 2/60
77/77 - 0s - 3ms/step - loss: 0.5716 - val_loss: 2.1924
Epoch 3/60
77/77 - 0s - 3ms/step - loss: 0.5128 - val_loss: 2.0661
Epoch 4/60
77/77 - 0s - 3ms/step - loss: 0.4539 - val_loss: 2.0974
Epoch 5/60
77/77 - 0s - 3ms/step - loss: 0.4222 - val_loss: 2.1049
Epoch 6/60
77/77 - 0s - 3ms/step - loss: 0.4004 - val_loss: 2.1152
Epoch 7/60
77/77 - 0s - 3ms/step - loss: 0.3638 - val_loss: 2.1518
Epoch 8/60
77/77 - 0s - 3ms/step - loss: 0.3582 - val_loss: 2.1636
Epoch 9/60
77/77 - 0s - 3ms/step - loss: 0.3209 - val_loss: 2.0699
Epoch 10/60
77/77 - 0s - 3ms/step - loss: 0.3115 - val_loss: 2.0751
Epoch 11/60
77/77 - 0s - 3ms/step - loss: 0.2599 - val_loss: 2.0476
Epoch 12/60
77/77 - 0s - 3ms/step - loss: 0.2338 - val_loss: 2.0432
Epoch 13/60
77/77 - 0s - 3ms/step - loss: 0.2097 - val_loss: 2.0667
Epoch 14/60
77/77 - 0s - 4ms/step - loss: 0.2007 - val_loss: 2.0655
Epoch 15/60
77/77 - 0s - 3ms/step - loss: 0.1824 - val_loss: 2.0798
Epoch 16/60
77/77 - 0s - 3ms/step - loss: 0.1648 - val_loss: 2.0858
Epoch 17/60
77/77 - 0s - 3ms/step - loss: 0.1680 - val_loss: 2.0864
Epoch 18/60
77/77 - 0s - 3ms/step - loss: 0.1818 - val_loss: 2.0869
Epoch 19/60
77/77 - 0s - 3ms/step - loss: 0.1609 - val_loss: 2.0935
Epoch 20/60
77/77 - 0s - 3ms/step - loss: 0.1779 - val_loss: 2.0665
Epoch 21/60
77/77 - 0s - 3ms/step - loss: 0.1465 - val_loss: 2.0772
Epoch 22/60
77/77 - 0s - 3ms/step - loss: 0.1331 - val_loss: 2.0671
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.0091
Per-joint RMSE: 1.1996 1.2099 1.0855 0.8694 0.8025 0.7925
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:32:50.382780: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:32:50.407231: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:32:51.257058: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:51.261716: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:51.262604: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:51.264361: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:51.265158: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:51.265897: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:51.347747: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:51.348668: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:51.349420: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:51.350144: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:32:51.654760: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.096022e+00  RMSE=1.046911e+00
  per-joint RMSE: 1.2435 1.3226 1.0909 0.8752 0.8179 0.8097
Residual LSTM:  MSE=1.018221e+00      RMSE=1.009070e+00
  per-joint RMSE: 1.1996 1.2099 1.0855 0.8694 0.8025 0.7925
Combined torque MSE=1.018221e+00     RMSE=1.009070e+00
  per-joint RMSE: 1.1996 1.2099 1.0855 0.8694 0.8025 0.7925
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz --H 25 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (24352, 25, 18)  Y_train: (24352, 6)
X_test : (16710, 25, 18)  Y_test : (16710, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:32:53.845599: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:32:53.870235: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (24352, 25, 18), Y_train = (24352, 6)
  X_test  = (16710, 25, 18),  Y_test  = (16710, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:32:54.890410: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:54.894951: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:54.895823: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:54.897341: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:54.898125: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:54.898857: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:54.979231: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:54.980075: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:54.980914: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:32:54.981645: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:32:55.919241: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
77/77 - 2s - 20ms/step - loss: 0.2550 - val_loss: 1.4380
Epoch 2/60
77/77 - 0s - 3ms/step - loss: 0.1338 - val_loss: 1.3911
Epoch 3/60
77/77 - 0s - 3ms/step - loss: 0.1173 - val_loss: 1.3529
Epoch 4/60
77/77 - 0s - 3ms/step - loss: 0.1070 - val_loss: 1.3157
Epoch 5/60
77/77 - 0s - 3ms/step - loss: 0.1030 - val_loss: 1.3107
Epoch 6/60
77/77 - 0s - 3ms/step - loss: 0.0966 - val_loss: 1.3132
Epoch 7/60
77/77 - 0s - 3ms/step - loss: 0.0915 - val_loss: 1.3064
Epoch 8/60
77/77 - 0s - 3ms/step - loss: 0.0903 - val_loss: 1.3005
Epoch 9/60
77/77 - 0s - 3ms/step - loss: 0.0869 - val_loss: 1.2747
Epoch 10/60
77/77 - 0s - 3ms/step - loss: 0.0847 - val_loss: 1.2760
Epoch 11/60
77/77 - 0s - 3ms/step - loss: 0.0830 - val_loss: 1.2611
Epoch 12/60
77/77 - 0s - 3ms/step - loss: 0.0908 - val_loss: 1.2430
Epoch 13/60
77/77 - 0s - 4ms/step - loss: 0.0815 - val_loss: 1.2333
Epoch 14/60
77/77 - 0s - 3ms/step - loss: 0.0793 - val_loss: 1.2126
Epoch 15/60
77/77 - 0s - 3ms/step - loss: 0.0781 - val_loss: 1.1900
Epoch 16/60
77/77 - 0s - 3ms/step - loss: 0.0769 - val_loss: 1.1902
Epoch 17/60
77/77 - 0s - 3ms/step - loss: 0.0763 - val_loss: 1.2012
Epoch 18/60
77/77 - 0s - 3ms/step - loss: 0.0761 - val_loss: 1.1736
Epoch 19/60
77/77 - 0s - 3ms/step - loss: 0.0735 - val_loss: 1.1616
Epoch 20/60
77/77 - 0s - 3ms/step - loss: 0.0723 - val_loss: 1.1440
Epoch 21/60
77/77 - 0s - 3ms/step - loss: 0.0723 - val_loss: 1.1390
Epoch 22/60
77/77 - 0s - 3ms/step - loss: 0.0749 - val_loss: 1.1435
Epoch 23/60
77/77 - 0s - 3ms/step - loss: 0.0723 - val_loss: 1.1222
Epoch 24/60
77/77 - 0s - 3ms/step - loss: 0.0710 - val_loss: 1.1174
Epoch 25/60
77/77 - 0s - 3ms/step - loss: 0.0697 - val_loss: 1.1083
Epoch 26/60
77/77 - 0s - 3ms/step - loss: 0.0678 - val_loss: 1.1118
Epoch 27/60
77/77 - 0s - 3ms/step - loss: 0.0669 - val_loss: 1.1020
Epoch 28/60
77/77 - 0s - 3ms/step - loss: 0.0674 - val_loss: 1.0910
Epoch 29/60
77/77 - 0s - 3ms/step - loss: 0.0670 - val_loss: 1.0772
Epoch 30/60
77/77 - 0s - 3ms/step - loss: 0.0652 - val_loss: 1.0726
Epoch 31/60
77/77 - 0s - 3ms/step - loss: 0.0644 - val_loss: 1.0643
Epoch 32/60
77/77 - 0s - 3ms/step - loss: 0.0642 - val_loss: 1.0607
Epoch 33/60
77/77 - 0s - 3ms/step - loss: 0.0642 - val_loss: 1.0624
Epoch 34/60
77/77 - 0s - 3ms/step - loss: 0.0635 - val_loss: 1.0572
Epoch 35/60
77/77 - 0s - 3ms/step - loss: 0.0638 - val_loss: 1.0431
Epoch 36/60
77/77 - 0s - 3ms/step - loss: 0.0629 - val_loss: 1.0478
Epoch 37/60
77/77 - 0s - 3ms/step - loss: 0.0635 - val_loss: 1.0441
Epoch 38/60
77/77 - 0s - 3ms/step - loss: 0.0621 - val_loss: 1.0391
Epoch 39/60
77/77 - 0s - 3ms/step - loss: 0.0613 - val_loss: 1.0605
Epoch 40/60
77/77 - 0s - 3ms/step - loss: 0.0613 - val_loss: 1.0441
Epoch 41/60
77/77 - 0s - 3ms/step - loss: 0.0608 - val_loss: 1.0320
Epoch 42/60
77/77 - 0s - 3ms/step - loss: 0.0602 - val_loss: 1.0469
Epoch 43/60
77/77 - 0s - 3ms/step - loss: 0.0603 - val_loss: 1.0338
Epoch 44/60
77/77 - 0s - 3ms/step - loss: 0.0599 - val_loss: 1.0148
Epoch 45/60
77/77 - 0s - 3ms/step - loss: 0.0592 - val_loss: 1.0201
Epoch 46/60
77/77 - 0s - 3ms/step - loss: 0.0590 - val_loss: 1.0372
Epoch 47/60
77/77 - 0s - 3ms/step - loss: 0.0588 - val_loss: 1.0280
Epoch 48/60
77/77 - 0s - 3ms/step - loss: 0.0592 - val_loss: 1.0277
Epoch 49/60
77/77 - 0s - 3ms/step - loss: 0.0586 - val_loss: 1.0215
Epoch 50/60
77/77 - 0s - 3ms/step - loss: 0.0586 - val_loss: 1.0281
Epoch 51/60
77/77 - 0s - 3ms/step - loss: 0.0584 - val_loss: 1.0251
Epoch 52/60
77/77 - 0s - 3ms/step - loss: 0.0579 - val_loss: 1.0436
Epoch 53/60
77/77 - 0s - 3ms/step - loss: 0.0579 - val_loss: 1.0418
Epoch 54/60
77/77 - 0s - 3ms/step - loss: 0.0585 - val_loss: 1.0306
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.0272
Per-joint RMSE: 1.2316 1.2623 1.0940 0.8763 0.7933 0.7914
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:33:09.312332: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:33:09.336757: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:33:10.199226: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:10.203726: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:10.204514: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:10.206287: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:10.207158: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:10.207893: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:10.293079: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:10.293995: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:10.294743: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:10.295471: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:33:10.599794: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.096022e+00  RMSE=1.046911e+00
  per-joint RMSE: 1.2435 1.3226 1.0909 0.8752 0.8179 0.8097
Residual LSTM:  MSE=1.055125e+00      RMSE=1.027193e+00
  per-joint RMSE: 1.2316 1.2623 1.0940 0.8763 0.7933 0.7914
Combined torque MSE=1.055125e+00     RMSE=1.027193e+00
  per-joint RMSE: 1.2316 1.2623 1.0940 0.8763 0.7933 0.7914
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz --H 25 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (24352, 25, 18)  Y_train: (24352, 6)
X_test : (16710, 25, 18)  Y_test : (16710, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:33:12.763298: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:33:12.786980: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (24352, 25, 18), Y_train = (24352, 6)
  X_test  = (16710, 25, 18),  Y_test  = (16710, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:33:13.827150: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:13.832067: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:13.832945: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:13.836536: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:13.837326: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:13.838156: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:13.919079: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:13.919917: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:13.920661: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:13.921395: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:33:14.860475: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
77/77 - 2s - 20ms/step - loss: 0.2525 - val_loss: 1.3838
Epoch 2/60
77/77 - 0s - 3ms/step - loss: 0.1207 - val_loss: 1.2920
Epoch 3/60
77/77 - 0s - 3ms/step - loss: 0.1039 - val_loss: 1.2505
Epoch 4/60
77/77 - 0s - 3ms/step - loss: 0.0961 - val_loss: 1.2088
Epoch 5/60
77/77 - 0s - 3ms/step - loss: 0.0913 - val_loss: 1.1970
Epoch 6/60
77/77 - 0s - 3ms/step - loss: 0.0873 - val_loss: 1.1866
Epoch 7/60
77/77 - 0s - 3ms/step - loss: 0.0839 - val_loss: 1.1698
Epoch 8/60
77/77 - 0s - 3ms/step - loss: 0.0813 - val_loss: 1.1342
Epoch 9/60
77/77 - 0s - 3ms/step - loss: 0.0790 - val_loss: 1.1304
Epoch 10/60
77/77 - 0s - 3ms/step - loss: 0.0772 - val_loss: 1.1143
Epoch 11/60
77/77 - 0s - 3ms/step - loss: 0.0763 - val_loss: 1.1129
Epoch 12/60
77/77 - 0s - 3ms/step - loss: 0.0745 - val_loss: 1.0863
Epoch 13/60
77/77 - 0s - 4ms/step - loss: 0.0731 - val_loss: 1.0765
Epoch 14/60
77/77 - 0s - 3ms/step - loss: 0.0717 - val_loss: 1.0660
Epoch 15/60
77/77 - 0s - 3ms/step - loss: 0.0711 - val_loss: 1.0386
Epoch 16/60
77/77 - 0s - 3ms/step - loss: 0.0699 - val_loss: 1.0285
Epoch 17/60
77/77 - 0s - 3ms/step - loss: 0.0698 - val_loss: 1.0236
Epoch 18/60
77/77 - 0s - 3ms/step - loss: 0.0734 - val_loss: 1.0037
Epoch 19/60
77/77 - 0s - 3ms/step - loss: 0.0683 - val_loss: 1.0008
Epoch 20/60
77/77 - 0s - 3ms/step - loss: 0.0668 - val_loss: 0.9907
Epoch 21/60
77/77 - 0s - 3ms/step - loss: 0.0662 - val_loss: 0.9809
Epoch 22/60
77/77 - 0s - 3ms/step - loss: 0.0657 - val_loss: 0.9709
Epoch 23/60
77/77 - 0s - 3ms/step - loss: 0.0645 - val_loss: 0.9684
Epoch 24/60
77/77 - 0s - 3ms/step - loss: 0.0645 - val_loss: 0.9532
Epoch 25/60
77/77 - 0s - 3ms/step - loss: 0.0644 - val_loss: 0.9415
Epoch 26/60
77/77 - 0s - 3ms/step - loss: 0.0641 - val_loss: 0.9506
Epoch 27/60
77/77 - 0s - 3ms/step - loss: 0.0633 - val_loss: 0.9407
Epoch 28/60
77/77 - 0s - 3ms/step - loss: 0.0629 - val_loss: 0.9325
Epoch 29/60
77/77 - 0s - 3ms/step - loss: 0.0622 - val_loss: 0.9207
Epoch 30/60
77/77 - 0s - 3ms/step - loss: 0.0610 - val_loss: 0.9204
Epoch 31/60
77/77 - 0s - 3ms/step - loss: 0.0609 - val_loss: 0.9165
Epoch 32/60
77/77 - 0s - 3ms/step - loss: 0.0607 - val_loss: 0.9261
Epoch 33/60
77/77 - 0s - 3ms/step - loss: 0.0603 - val_loss: 0.9241
Epoch 34/60
77/77 - 0s - 3ms/step - loss: 0.0603 - val_loss: 0.9321
Epoch 35/60
77/77 - 0s - 3ms/step - loss: 0.0592 - val_loss: 0.9024
Epoch 36/60
77/77 - 0s - 3ms/step - loss: 0.0589 - val_loss: 0.9151
Epoch 37/60
77/77 - 0s - 3ms/step - loss: 0.0591 - val_loss: 0.9217
Epoch 38/60
77/77 - 0s - 3ms/step - loss: 0.0585 - val_loss: 0.9037
Epoch 39/60
77/77 - 0s - 3ms/step - loss: 0.0583 - val_loss: 0.9068
Epoch 40/60
77/77 - 0s - 3ms/step - loss: 0.0585 - val_loss: 0.9041
Epoch 41/60
77/77 - 0s - 3ms/step - loss: 0.0584 - val_loss: 0.8834
Epoch 42/60
77/77 - 0s - 3ms/step - loss: 0.0578 - val_loss: 0.8681
Epoch 43/60
77/77 - 0s - 3ms/step - loss: 0.0568 - val_loss: 0.8562
Epoch 44/60
77/77 - 0s - 3ms/step - loss: 0.0573 - val_loss: 0.8542
Epoch 45/60
77/77 - 0s - 3ms/step - loss: 0.0564 - val_loss: 0.8613
Epoch 46/60
77/77 - 0s - 3ms/step - loss: 0.0561 - val_loss: 0.8516
Epoch 47/60
77/77 - 0s - 3ms/step - loss: 0.0559 - val_loss: 0.8543
Epoch 48/60
77/77 - 0s - 3ms/step - loss: 0.0557 - val_loss: 0.8558
Epoch 49/60
77/77 - 0s - 3ms/step - loss: 0.0550 - val_loss: 0.8545
Epoch 50/60
77/77 - 0s - 3ms/step - loss: 0.0550 - val_loss: 0.8362
Epoch 51/60
77/77 - 0s - 3ms/step - loss: 0.0543 - val_loss: 0.8255
Epoch 52/60
77/77 - 0s - 3ms/step - loss: 0.0539 - val_loss: 0.8395
Epoch 53/60
77/77 - 0s - 3ms/step - loss: 0.0537 - val_loss: 0.8392
Epoch 54/60
77/77 - 0s - 3ms/step - loss: 0.0537 - val_loss: 0.8252
Epoch 55/60
77/77 - 0s - 3ms/step - loss: 0.0536 - val_loss: 0.8205
Epoch 56/60
77/77 - 0s - 3ms/step - loss: 0.0527 - val_loss: 0.8096
Epoch 57/60
77/77 - 0s - 3ms/step - loss: 0.0527 - val_loss: 0.8156
Epoch 58/60
77/77 - 0s - 3ms/step - loss: 0.0529 - val_loss: 0.8191
Epoch 59/60
77/77 - 0s - 3ms/step - loss: 0.0532 - val_loss: 0.7867
Epoch 60/60
77/77 - 0s - 3ms/step - loss: 0.0522 - val_loss: 0.7685
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.9657
Per-joint RMSE: 1.1048 1.2356 1.0281 0.8280 0.7542 0.7329
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:33:29.686967: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:33:29.711207: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:33:30.578562: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:30.583156: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:30.583943: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:30.585542: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:30.586333: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:30.587154: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:30.673773: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:30.674611: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:30.675350: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:30.676141: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:33:30.986245: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.096022e+00  RMSE=1.046911e+00
  per-joint RMSE: 1.2435 1.3226 1.0909 0.8752 0.8179 0.8097
Residual LSTM:  MSE=9.326400e-01      RMSE=9.657329e-01
  per-joint RMSE: 1.1048 1.2356 1.0281 0.8280 0.7542 0.7329
Combined torque MSE=9.326401e-01     RMSE=9.657329e-01
  per-joint RMSE: 1.1048 1.2356 1.0281 0.8280 0.7542 0.7329
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz --H 50 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.json
H=50, n_dof=6, feature_dim=24
X_train: (23677, 50, 24)  Y_train: (23677, 6)
X_test : (16410, 50, 24)  Y_test : (16410, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:33:33.249236: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:33:33.273888: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (23677, 50, 24), Y_train = (23677, 6)
  X_test  = (16410, 50, 24),  Y_test  = (16410, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:33:34.503827: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:34.508767: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:34.509674: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:34.511333: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:34.512237: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:34.512980: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:34.608151: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:34.609042: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:34.609848: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:34.610636: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:33:35.654131: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
74/74 - 2s - 23ms/step - loss: 0.2629 - val_loss: 0.5599
Epoch 2/60
74/74 - 0s - 4ms/step - loss: 0.1236 - val_loss: 0.5412
Epoch 3/60
74/74 - 0s - 4ms/step - loss: 0.1063 - val_loss: 0.5601
Epoch 4/60
74/74 - 0s - 4ms/step - loss: 0.0986 - val_loss: 0.5482
Epoch 5/60
74/74 - 0s - 4ms/step - loss: 0.0927 - val_loss: 0.5368
Epoch 6/60
74/74 - 0s - 4ms/step - loss: 0.0889 - val_loss: 0.5321
Epoch 7/60
74/74 - 0s - 4ms/step - loss: 0.0854 - val_loss: 0.5289
Epoch 8/60
74/74 - 0s - 4ms/step - loss: 0.0828 - val_loss: 0.5123
Epoch 9/60
74/74 - 0s - 4ms/step - loss: 0.0804 - val_loss: 0.5125
Epoch 10/60
74/74 - 0s - 4ms/step - loss: 0.0793 - val_loss: 0.4968
Epoch 11/60
74/74 - 0s - 4ms/step - loss: 0.0776 - val_loss: 0.4944
Epoch 12/60
74/74 - 0s - 4ms/step - loss: 0.0765 - val_loss: 0.4965
Epoch 13/60
74/74 - 0s - 4ms/step - loss: 0.0754 - val_loss: 0.5003
Epoch 14/60
74/74 - 0s - 5ms/step - loss: 0.0740 - val_loss: 0.4906
Epoch 15/60
74/74 - 0s - 4ms/step - loss: 0.0728 - val_loss: 0.4911
Epoch 16/60
74/74 - 0s - 4ms/step - loss: 0.0713 - val_loss: 0.4900
Epoch 17/60
74/74 - 0s - 4ms/step - loss: 0.0701 - val_loss: 0.4936
Epoch 18/60
74/74 - 0s - 4ms/step - loss: 0.0698 - val_loss: 0.4895
Epoch 19/60
74/74 - 0s - 4ms/step - loss: 0.0689 - val_loss: 0.4963
Epoch 20/60
74/74 - 0s - 4ms/step - loss: 0.0680 - val_loss: 0.5012
Epoch 21/60
74/74 - 0s - 4ms/step - loss: 0.0675 - val_loss: 0.4906
Epoch 22/60
74/74 - 0s - 4ms/step - loss: 0.0669 - val_loss: 0.4907
Epoch 23/60
74/74 - 0s - 4ms/step - loss: 0.0664 - val_loss: 0.4974
Epoch 24/60
74/74 - 0s - 4ms/step - loss: 0.0658 - val_loss: 0.4923
Epoch 25/60
74/74 - 0s - 4ms/step - loss: 0.0654 - val_loss: 0.5007
Epoch 26/60
74/74 - 0s - 4ms/step - loss: 0.0648 - val_loss: 0.4898
Epoch 27/60
74/74 - 0s - 4ms/step - loss: 0.0642 - val_loss: 0.4988
Epoch 28/60
74/74 - 0s - 4ms/step - loss: 0.0639 - val_loss: 0.4952
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.9827
Per-joint RMSE: 1.1543 1.2147 1.0583 0.8492 0.7586 0.7550
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:33:46.090085: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:33:46.114883: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:33:46.973041: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:46.977672: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:46.978459: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:46.980094: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:46.980879: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:46.981610: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:47.070533: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:47.071453: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:47.072193: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:47.072921: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:33:47.382661: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.111891e+00  RMSE=1.054463e+00
  per-joint RMSE: 1.2530 1.3323 1.0981 0.8812 0.8236 0.8159
Residual LSTM:  MSE=9.657485e-01      RMSE=9.827250e-01
  per-joint RMSE: 1.1543 1.2147 1.0583 0.8492 0.7586 0.7550
Combined torque MSE=9.657485e-01     RMSE=9.827250e-01
  per-joint RMSE: 1.1543 1.2147 1.0583 0.8492 0.7586 0.7550
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz --H 50 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.json
H=50, n_dof=6, feature_dim=6
X_train: (23677, 50, 6)  Y_train: (23677, 6)
X_test : (16410, 50, 6)  Y_test : (16410, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:33:49.573128: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:33:49.596916: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (23677, 50, 6), Y_train = (23677, 6)
  X_test  = (16410, 50, 6),  Y_test  = (16410, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:33:50.623755: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:50.628401: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:50.629195: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:50.630742: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:50.632357: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:50.633099: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:50.707405: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:50.708338: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:50.709319: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:50.710110: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:33:51.632865: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
74/74 - 2s - 22ms/step - loss: 0.7319 - val_loss: 1.1679
Epoch 2/60
74/74 - 0s - 4ms/step - loss: 0.5125 - val_loss: 0.9936
Epoch 3/60
74/74 - 0s - 4ms/step - loss: 0.4115 - val_loss: 1.0931
Epoch 4/60
74/74 - 0s - 4ms/step - loss: 0.3587 - val_loss: 1.0929
Epoch 5/60
74/74 - 0s - 4ms/step - loss: 0.3015 - val_loss: 1.0723
Epoch 6/60
74/74 - 0s - 4ms/step - loss: 0.2464 - val_loss: 1.2446
Epoch 7/60
74/74 - 0s - 4ms/step - loss: 0.2044 - val_loss: 1.1098
Epoch 8/60
74/74 - 0s - 4ms/step - loss: 0.1749 - val_loss: 1.0802
Epoch 9/60
74/74 - 0s - 4ms/step - loss: 0.1665 - val_loss: 1.0670
Epoch 10/60
74/74 - 0s - 4ms/step - loss: 0.1545 - val_loss: 1.0759
Epoch 11/60
74/74 - 0s - 4ms/step - loss: 0.1395 - val_loss: 1.0982
Epoch 12/60
74/74 - 0s - 4ms/step - loss: 0.1280 - val_loss: 1.0282
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.0234
Per-joint RMSE: 1.2259 1.2237 1.0993 0.8751 0.8067 0.8120
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:33:56.977747: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:33:57.001840: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:33:57.863867: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:57.868961: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:57.869770: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:57.871536: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:57.872326: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:57.873152: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:57.949576: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:57.950414: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:57.951158: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:33:57.951892: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:33:58.264921: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.111891e+00  RMSE=1.054463e+00
  per-joint RMSE: 1.2530 1.3323 1.0981 0.8812 0.8236 0.8159
Residual LSTM:  MSE=1.047426e+00      RMSE=1.023438e+00
  per-joint RMSE: 1.2259 1.2237 1.0993 0.8751 0.8067 0.8120
Combined torque MSE=1.047425e+00     RMSE=1.023438e+00
  per-joint RMSE: 1.2259 1.2237 1.0993 0.8751 0.8067 0.8120
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz --H 50 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (23677, 50, 18)  Y_train: (23677, 6)
X_test : (16410, 50, 18)  Y_test : (16410, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:34:00.507758: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:34:00.531594: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (23677, 50, 18), Y_train = (23677, 6)
  X_test  = (16410, 50, 18),  Y_test  = (16410, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:34:01.690978: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:01.696082: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:01.696997: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:01.698874: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:01.699780: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:01.700640: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:01.788776: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:01.789674: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:01.790470: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:01.791256: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:34:02.771690: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
74/74 - 2s - 23ms/step - loss: 0.2635 - val_loss: 0.5767
Epoch 2/60
74/74 - 0s - 4ms/step - loss: 0.1372 - val_loss: 0.5982
Epoch 3/60
74/74 - 0s - 4ms/step - loss: 0.1188 - val_loss: 0.5901
Epoch 4/60
74/74 - 0s - 4ms/step - loss: 0.1097 - val_loss: 0.6087
Epoch 5/60
74/74 - 0s - 4ms/step - loss: 0.1037 - val_loss: 0.5963
Epoch 6/60
74/74 - 0s - 4ms/step - loss: 0.0992 - val_loss: 0.6039
Epoch 7/60
74/74 - 0s - 4ms/step - loss: 0.0965 - val_loss: 0.5892
Epoch 8/60
74/74 - 0s - 4ms/step - loss: 0.0934 - val_loss: 0.5883
Epoch 9/60
74/74 - 0s - 4ms/step - loss: 0.0897 - val_loss: 0.5816
Epoch 10/60
74/74 - 0s - 4ms/step - loss: 0.0872 - val_loss: 0.5798
Epoch 11/60
74/74 - 0s - 4ms/step - loss: 0.0850 - val_loss: 0.5762
Epoch 12/60
74/74 - 0s - 4ms/step - loss: 0.0838 - val_loss: 0.5624
Epoch 13/60
74/74 - 0s - 4ms/step - loss: 0.0813 - val_loss: 0.5672
Epoch 14/60
74/74 - 0s - 5ms/step - loss: 0.0793 - val_loss: 0.5788
Epoch 15/60
74/74 - 0s - 4ms/step - loss: 0.0789 - val_loss: 0.5781
Epoch 16/60
74/74 - 0s - 4ms/step - loss: 0.0767 - val_loss: 0.5868
Epoch 17/60
74/74 - 0s - 4ms/step - loss: 0.0760 - val_loss: 0.5762
Epoch 18/60
74/74 - 0s - 4ms/step - loss: 0.0738 - val_loss: 0.5788
Epoch 19/60
74/74 - 0s - 4ms/step - loss: 0.0745 - val_loss: 0.5894
Epoch 20/60
74/74 - 0s - 4ms/step - loss: 0.0717 - val_loss: 0.5789
Epoch 21/60
74/74 - 0s - 4ms/step - loss: 0.0714 - val_loss: 0.5763
Epoch 22/60
74/74 - 0s - 4ms/step - loss: 0.0699 - val_loss: 0.5780
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.0301
Per-joint RMSE: 1.2413 1.2494 1.1027 0.8823 0.8027 0.7915
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:34:11.214611: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:34:11.239148: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:34:12.083070: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:12.087938: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:12.088735: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:12.090446: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:12.091315: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:12.092053: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:12.173770: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:12.174616: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:12.175355: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:12.176174: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:34:12.490402: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.111891e+00  RMSE=1.054463e+00
  per-joint RMSE: 1.2530 1.3323 1.0981 0.8812 0.8236 0.8159
Residual LSTM:  MSE=1.061183e+00      RMSE=1.030138e+00
  per-joint RMSE: 1.2413 1.2494 1.1027 0.8823 0.8027 0.7915
Combined torque MSE=1.061183e+00     RMSE=1.030138e+00
  per-joint RMSE: 1.2413 1.2494 1.1027 0.8823 0.8027 0.7915
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz --H 50 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (23677, 50, 18)  Y_train: (23677, 6)
X_test : (16410, 50, 18)  Y_test : (16410, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:34:14.764331: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:34:14.789425: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (23677, 50, 18), Y_train = (23677, 6)
  X_test  = (16410, 50, 18),  Y_test  = (16410, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:34:15.953957: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:15.958953: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:15.959829: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:15.961420: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:15.962206: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:15.962942: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:16.042684: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:16.043602: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:16.044341: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:16.045065: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:34:17.023014: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
74/74 - 2s - 22ms/step - loss: 0.2603 - val_loss: 0.5148
Epoch 2/60
74/74 - 0s - 4ms/step - loss: 0.1228 - val_loss: 0.4748
Epoch 3/60
74/74 - 0s - 4ms/step - loss: 0.1064 - val_loss: 0.4665
Epoch 4/60
74/74 - 0s - 4ms/step - loss: 0.0979 - val_loss: 0.4693
Epoch 5/60
74/74 - 0s - 4ms/step - loss: 0.0916 - val_loss: 0.4714
Epoch 6/60
74/74 - 0s - 4ms/step - loss: 0.0880 - val_loss: 0.4745
Epoch 7/60
74/74 - 0s - 4ms/step - loss: 0.0848 - val_loss: 0.4807
Epoch 8/60
74/74 - 0s - 4ms/step - loss: 0.0830 - val_loss: 0.4781
Epoch 9/60
74/74 - 0s - 4ms/step - loss: 0.0810 - val_loss: 0.4771
Epoch 10/60
74/74 - 0s - 4ms/step - loss: 0.0788 - val_loss: 0.4871
Epoch 11/60
74/74 - 0s - 4ms/step - loss: 0.0774 - val_loss: 0.4887
Epoch 12/60
74/74 - 0s - 4ms/step - loss: 0.0756 - val_loss: 0.4966
Epoch 13/60
74/74 - 0s - 4ms/step - loss: 0.0748 - val_loss: 0.4890
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.9831
Per-joint RMSE: 1.1573 1.2218 1.0892 0.8242 0.7429 0.7411
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:34:22.751919: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:34:22.776821: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:34:23.616366: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:23.621285: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:23.622070: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:23.623758: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:23.624539: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:23.625274: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:23.707235: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:23.708067: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:23.708804: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:34:23.709534: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:34:24.018270: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.111891e+00  RMSE=1.054463e+00
  per-joint RMSE: 1.2530 1.3323 1.0981 0.8812 0.8236 0.8159
Residual LSTM:  MSE=9.665359e-01      RMSE=9.831256e-01
  per-joint RMSE: 1.1573 1.2218 1.0892 0.8242 0.7429 0.7411
Combined torque MSE=9.665359e-01     RMSE=9.831256e-01
  per-joint RMSE: 1.1573 1.2218 1.0892 0.8242 0.7429 0.7411
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=1                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz                                 ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed0_dataset.npz -t structured -s 1 -r 0 --hp_preset fast_debug --epochs 250 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 250, 'lagrangian_type': <function structured_lagrangian_fn at 0x7426fbf441f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed0_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed0_dataset.npz
   dt ≈ 0.022064047964597475
  dof = 6
  Train trajectories = 53
  Test trajectories  = 22
  Train samples = 25078
  Test samples  = 17028
################################################

2026-01-22 06:34:28.583304: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250 | type=structured | dof=6
################################################
2026-01-22 06:34:31.705626: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:34:31.705667: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:34:31.705674: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:34:31.705701: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:34:31.705706: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:34:31.705720: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:34:31.705760: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:34:31.705766: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:34:31.705784: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:34:31.705789: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.0s, Loss=1.41e+01, Inv=1.41e+01, For=1.50e+02, Power=1.01e+00
  [eval] test_mse=4.300e+00  (n=17028)
Epoch 00050: Time=   9.5s, Loss=2.78e+00, Inv=2.78e+00, For=8.48e+01, Power=6.42e-01
Epoch 00100: Time=  12.6s, Loss=2.54e+00, Inv=2.54e+00, For=1.18e+02, Power=5.60e-01
Epoch 00150: Time=  15.8s, Loss=2.43e+00, Inv=2.43e+00, For=1.33e+02, Power=5.36e-01
Epoch 00200: Time=  18.9s, Loss=2.36e+00, Inv=2.36e+00, For=1.45e+02, Power=5.24e-01
  [eval] test_mse=5.806e+00  (n=17028)
Epoch 00250: Time=  22.2s, Loss=2.29e+00, Inv=2.29e+00, For=1.57e+02, Power=5.07e-01
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250
Torque MSE  = 1.204e+00
Torque RMSE = 1.097e+00
Per-joint MSE : 1.733e+00 1.612e+00 1.303e+00 5.151e-01 6.456e-01 1.413e+00
Per-joint RMSE: 1.316e+00 1.270e+00 1.141e+00 7.177e-01 8.035e-01 1.189e+00
Comp Time per Sample = 1.999e-08s / 50027175.7Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed0_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed0_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax
Detected n_dof=6 (seed=1)
2026-01-22 06:34:56.017561: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 53 trajectories
2026-01-22 06:34:57.347453: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:34:57.347469: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:34:58.835198: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:34:58.835210: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:35:00.329584: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/53
  done 50/53
  done 53/53

Exporting split=test: 22 trajectories
2026-01-22 06:35:02.910230: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 22/22

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz --H 25 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.json
H=25, n_dof=6, feature_dim=24
X_train: (24352, 25, 24)  Y_train: (24352, 6)
X_test : (16710, 25, 24)  Y_test : (16710, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:35:05.089157: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:35:05.113552: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (24352, 25, 24), Y_train = (24352, 6)
  X_test  = (16710, 25, 24),  Y_test  = (16710, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:35:06.196805: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:06.203698: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:06.204593: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:06.206253: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:06.207185: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:06.207928: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:06.295609: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:06.296499: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:06.297397: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:06.298174: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:35:07.258506: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
77/77 - 2s - 20ms/step - loss: 0.2524 - val_loss: 1.4291
Epoch 2/60
77/77 - 0s - 3ms/step - loss: 0.1194 - val_loss: 1.3439
Epoch 3/60
77/77 - 0s - 3ms/step - loss: 0.1046 - val_loss: 1.3501
Epoch 4/60
77/77 - 0s - 3ms/step - loss: 0.0960 - val_loss: 1.3240
Epoch 5/60
77/77 - 0s - 3ms/step - loss: 0.0915 - val_loss: 1.3073
Epoch 6/60
77/77 - 0s - 3ms/step - loss: 0.0879 - val_loss: 1.2755
Epoch 7/60
77/77 - 0s - 3ms/step - loss: 0.0851 - val_loss: 1.2727
Epoch 8/60
77/77 - 0s - 3ms/step - loss: 0.0825 - val_loss: 1.2567
Epoch 9/60
77/77 - 0s - 3ms/step - loss: 0.0794 - val_loss: 1.2320
Epoch 10/60
77/77 - 0s - 3ms/step - loss: 0.0781 - val_loss: 1.2038
Epoch 11/60
77/77 - 0s - 3ms/step - loss: 0.0768 - val_loss: 1.1659
Epoch 12/60
77/77 - 0s - 3ms/step - loss: 0.0750 - val_loss: 1.1456
Epoch 13/60
77/77 - 0s - 4ms/step - loss: 0.0739 - val_loss: 1.1350
Epoch 14/60
77/77 - 0s - 3ms/step - loss: 0.0734 - val_loss: 1.0885
Epoch 15/60
77/77 - 0s - 3ms/step - loss: 0.0715 - val_loss: 1.0766
Epoch 16/60
77/77 - 0s - 3ms/step - loss: 0.0709 - val_loss: 1.0662
Epoch 17/60
77/77 - 0s - 3ms/step - loss: 0.0703 - val_loss: 1.0469
Epoch 18/60
77/77 - 0s - 3ms/step - loss: 0.0693 - val_loss: 1.0354
Epoch 19/60
77/77 - 0s - 3ms/step - loss: 0.0702 - val_loss: 1.0081
Epoch 20/60
77/77 - 0s - 3ms/step - loss: 0.0672 - val_loss: 1.0154
Epoch 21/60
77/77 - 0s - 3ms/step - loss: 0.0667 - val_loss: 0.9889
Epoch 22/60
77/77 - 0s - 3ms/step - loss: 0.0658 - val_loss: 0.9747
Epoch 23/60
77/77 - 0s - 3ms/step - loss: 0.0653 - val_loss: 0.9585
Epoch 24/60
77/77 - 0s - 3ms/step - loss: 0.0651 - val_loss: 0.9563
Epoch 25/60
77/77 - 0s - 3ms/step - loss: 0.0645 - val_loss: 0.9445
Epoch 26/60
77/77 - 0s - 3ms/step - loss: 0.0640 - val_loss: 0.9440
Epoch 27/60
77/77 - 0s - 3ms/step - loss: 0.0636 - val_loss: 0.9385
Epoch 28/60
77/77 - 0s - 3ms/step - loss: 0.0635 - val_loss: 0.9175
Epoch 29/60
77/77 - 0s - 3ms/step - loss: 0.0621 - val_loss: 0.9276
Epoch 30/60
77/77 - 0s - 3ms/step - loss: 0.0622 - val_loss: 0.9118
Epoch 31/60
77/77 - 0s - 3ms/step - loss: 0.0619 - val_loss: 0.8966
Epoch 32/60
77/77 - 0s - 3ms/step - loss: 0.0614 - val_loss: 0.8957
Epoch 33/60
77/77 - 0s - 3ms/step - loss: 0.0609 - val_loss: 0.8894
Epoch 34/60
77/77 - 0s - 3ms/step - loss: 0.0612 - val_loss: 0.8745
Epoch 35/60
77/77 - 0s - 3ms/step - loss: 0.0602 - val_loss: 0.8601
Epoch 36/60
77/77 - 0s - 3ms/step - loss: 0.0602 - val_loss: 0.8545
Epoch 37/60
77/77 - 0s - 3ms/step - loss: 0.0592 - val_loss: 0.8714
Epoch 38/60
77/77 - 0s - 3ms/step - loss: 0.0590 - val_loss: 0.8485
Epoch 39/60
77/77 - 0s - 3ms/step - loss: 0.0588 - val_loss: 0.8366
Epoch 40/60
77/77 - 0s - 3ms/step - loss: 0.0586 - val_loss: 0.8415
Epoch 41/60
77/77 - 0s - 3ms/step - loss: 0.0580 - val_loss: 0.8312
Epoch 42/60
77/77 - 0s - 3ms/step - loss: 0.0573 - val_loss: 0.8314
Epoch 43/60
77/77 - 0s - 3ms/step - loss: 0.0575 - val_loss: 0.8449
Epoch 44/60
77/77 - 0s - 3ms/step - loss: 0.0578 - val_loss: 0.8406
Epoch 45/60
77/77 - 0s - 3ms/step - loss: 0.0568 - val_loss: 0.8477
Epoch 46/60
77/77 - 0s - 3ms/step - loss: 0.0560 - val_loss: 0.8387
Epoch 47/60
77/77 - 0s - 3ms/step - loss: 0.0563 - val_loss: 0.8415
Epoch 48/60
77/77 - 0s - 3ms/step - loss: 0.0557 - val_loss: 0.8196
Epoch 49/60
77/77 - 0s - 3ms/step - loss: 0.0555 - val_loss: 0.8138
Epoch 50/60
77/77 - 0s - 3ms/step - loss: 0.0553 - val_loss: 0.8255
Epoch 51/60
77/77 - 0s - 3ms/step - loss: 0.0549 - val_loss: 0.8213
Epoch 52/60
77/77 - 0s - 3ms/step - loss: 0.0542 - val_loss: 0.8541
Epoch 53/60
77/77 - 0s - 3ms/step - loss: 0.0544 - val_loss: 0.8463
Epoch 54/60
77/77 - 0s - 3ms/step - loss: 0.0539 - val_loss: 0.8146
Epoch 55/60
77/77 - 0s - 3ms/step - loss: 0.0541 - val_loss: 0.8550
Epoch 56/60
77/77 - 0s - 3ms/step - loss: 0.0538 - val_loss: 0.8224
Epoch 57/60
77/77 - 0s - 3ms/step - loss: 0.0531 - val_loss: 0.8300
Epoch 58/60
77/77 - 0s - 3ms/step - loss: 0.0538 - val_loss: 0.8287
Epoch 59/60
77/77 - 0s - 3ms/step - loss: 0.0530 - val_loss: 0.8402
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.0170
Per-joint RMSE: 1.2354 1.1410 1.0386 0.6705 0.7460 1.1370
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:35:22.015754: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:35:22.040734: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:35:22.914329: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:22.918996: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:22.919791: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:22.921458: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:22.922247: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:22.922989: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:23.001345: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:23.002186: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:23.003002: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:23.003795: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:35:23.314378: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.221314e+00  RMSE=1.105131e+00
  per-joint RMSE: 1.3266 1.2777 1.1487 0.7227 0.8099 1.1992
Residual LSTM:  MSE=1.034251e+00      RMSE=1.016981e+00
  per-joint RMSE: 1.2354 1.1410 1.0386 0.6705 0.7460 1.1370
Combined torque MSE=1.034251e+00     RMSE=1.016981e+00
  per-joint RMSE: 1.2354 1.1410 1.0386 0.6705 0.7460 1.1370
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz --H 25 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.json
H=25, n_dof=6, feature_dim=6
X_train: (24352, 25, 6)  Y_train: (24352, 6)
X_test : (16710, 25, 6)  Y_test : (16710, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:35:25.469696: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:35:25.494237: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (24352, 25, 6), Y_train = (24352, 6)
  X_test  = (16710, 25, 6),  Y_test  = (16710, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:35:26.485630: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:26.490425: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:26.491287: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:26.492801: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:26.493589: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:26.494318: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:26.574148: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:26.574983: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:26.575761: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:26.576535: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:35:27.513793: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
77/77 - 2s - 20ms/step - loss: 0.7391 - val_loss: 2.2590
Epoch 2/60
77/77 - 0s - 3ms/step - loss: 0.5510 - val_loss: 2.1577
Epoch 3/60
77/77 - 0s - 3ms/step - loss: 0.4776 - val_loss: 2.2256
Epoch 4/60
77/77 - 0s - 3ms/step - loss: 0.4366 - val_loss: 2.1822
Epoch 5/60
77/77 - 0s - 3ms/step - loss: 0.3881 - val_loss: 2.1983
Epoch 6/60
77/77 - 0s - 3ms/step - loss: 0.3671 - val_loss: 2.3139
Epoch 7/60
77/77 - 0s - 3ms/step - loss: 0.3136 - val_loss: 2.0811
Epoch 8/60
77/77 - 0s - 3ms/step - loss: 0.2799 - val_loss: 2.4437
Epoch 9/60
77/77 - 0s - 3ms/step - loss: 0.2694 - val_loss: 2.5868
Epoch 10/60
77/77 - 0s - 3ms/step - loss: 0.2319 - val_loss: 2.4817
Epoch 11/60
77/77 - 0s - 3ms/step - loss: 0.2473 - val_loss: 2.5047
Epoch 12/60
77/77 - 0s - 3ms/step - loss: 0.2248 - val_loss: 2.3218
Epoch 13/60
77/77 - 0s - 3ms/step - loss: 0.1941 - val_loss: 2.3267
Epoch 14/60
77/77 - 0s - 4ms/step - loss: 0.1985 - val_loss: 2.2611
Epoch 15/60
77/77 - 0s - 3ms/step - loss: 0.2026 - val_loss: 2.1502
Epoch 16/60
77/77 - 0s - 3ms/step - loss: 0.1760 - val_loss: 2.0638
Epoch 17/60
77/77 - 0s - 3ms/step - loss: 0.1693 - val_loss: 2.0798
Epoch 18/60
77/77 - 0s - 3ms/step - loss: 0.1682 - val_loss: 2.1411
Epoch 19/60
77/77 - 0s - 3ms/step - loss: 0.1583 - val_loss: 2.0433
Epoch 20/60
77/77 - 0s - 3ms/step - loss: 0.1488 - val_loss: 2.0050
Epoch 21/60
77/77 - 0s - 3ms/step - loss: 0.1423 - val_loss: 1.9989
Epoch 22/60
77/77 - 0s - 3ms/step - loss: 0.1419 - val_loss: 1.9961
Epoch 23/60
77/77 - 0s - 3ms/step - loss: 0.1393 - val_loss: 1.9770
Epoch 24/60
77/77 - 0s - 3ms/step - loss: 0.1311 - val_loss: 1.9507
Epoch 25/60
77/77 - 0s - 3ms/step - loss: 0.1273 - val_loss: 1.9664
Epoch 26/60
77/77 - 0s - 3ms/step - loss: 0.1299 - val_loss: 2.0194
Epoch 27/60
77/77 - 0s - 3ms/step - loss: 0.1280 - val_loss: 1.9579
Epoch 28/60
77/77 - 0s - 3ms/step - loss: 0.1233 - val_loss: 1.8906
Epoch 29/60
77/77 - 0s - 3ms/step - loss: 0.1265 - val_loss: 2.5937
Epoch 30/60
77/77 - 0s - 3ms/step - loss: 0.1591 - val_loss: 1.8362
Epoch 31/60
77/77 - 0s - 3ms/step - loss: 0.1139 - val_loss: 1.8694
Epoch 32/60
77/77 - 0s - 3ms/step - loss: 0.1135 - val_loss: 1.7946
Epoch 33/60
77/77 - 0s - 3ms/step - loss: 0.1105 - val_loss: 1.8381
Epoch 34/60
77/77 - 0s - 3ms/step - loss: 0.1140 - val_loss: 1.8715
Epoch 35/60
77/77 - 0s - 3ms/step - loss: 0.1018 - val_loss: 1.8685
Epoch 36/60
77/77 - 0s - 3ms/step - loss: 0.1018 - val_loss: 1.8850
Epoch 37/60
77/77 - 0s - 3ms/step - loss: 0.0929 - val_loss: 1.9177
Epoch 38/60
77/77 - 0s - 3ms/step - loss: 0.0935 - val_loss: 1.9273
Epoch 39/60
77/77 - 0s - 3ms/step - loss: 0.0930 - val_loss: 1.9109
Epoch 40/60
77/77 - 0s - 3ms/step - loss: 0.1477 - val_loss: 1.7012
Epoch 41/60
77/77 - 0s - 3ms/step - loss: 0.1053 - val_loss: 1.7510
Epoch 42/60
77/77 - 0s - 3ms/step - loss: 0.0938 - val_loss: 1.7923
Epoch 43/60
77/77 - 0s - 3ms/step - loss: 0.0945 - val_loss: 1.8106
Epoch 44/60
77/77 - 0s - 3ms/step - loss: 0.0875 - val_loss: 1.8288
Epoch 45/60
77/77 - 0s - 3ms/step - loss: 0.0858 - val_loss: 1.8265
Epoch 46/60
77/77 - 0s - 3ms/step - loss: 0.0822 - val_loss: 1.8847
Epoch 47/60
77/77 - 0s - 3ms/step - loss: 0.0939 - val_loss: 1.8111
Epoch 48/60
77/77 - 0s - 3ms/step - loss: 0.0932 - val_loss: 1.8213
Epoch 49/60
77/77 - 0s - 3ms/step - loss: 0.0874 - val_loss: 1.8030
Epoch 50/60
77/77 - 0s - 3ms/step - loss: 0.0893 - val_loss: 1.8070
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.0725
Per-joint RMSE: 1.2686 1.2188 1.1145 0.7318 0.7877 1.1867
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:35:39.937920: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:35:39.963214: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:35:40.816761: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:40.821505: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:40.822379: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:40.824080: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:40.824868: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:40.825609: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:40.907291: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:40.908136: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:40.908883: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:40.909616: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:35:41.210369: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.221314e+00  RMSE=1.105131e+00
  per-joint RMSE: 1.3266 1.2777 1.1487 0.7227 0.8099 1.1992
Residual LSTM:  MSE=1.150230e+00      RMSE=1.072488e+00
  per-joint RMSE: 1.2686 1.2188 1.1145 0.7318 0.7877 1.1867
Combined torque MSE=1.150230e+00     RMSE=1.072488e+00
  per-joint RMSE: 1.2686 1.2188 1.1145 0.7318 0.7877 1.1867
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz --H 25 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (24352, 25, 18)  Y_train: (24352, 6)
X_test : (16710, 25, 18)  Y_test : (16710, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:35:43.390584: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:35:43.419172: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (24352, 25, 18), Y_train = (24352, 6)
  X_test  = (16710, 25, 18),  Y_test  = (16710, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:35:44.438243: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:44.443105: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:44.443909: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:44.445499: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:44.446601: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:44.447331: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:44.532169: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:44.533091: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:44.533831: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:35:44.534567: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:35:45.457962: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
77/77 - 2s - 20ms/step - loss: 0.2607 - val_loss: 1.4824
Epoch 2/60
77/77 - 0s - 3ms/step - loss: 0.1356 - val_loss: 1.4348
Epoch 3/60
77/77 - 0s - 3ms/step - loss: 0.1166 - val_loss: 1.4042
Epoch 4/60
77/77 - 0s - 3ms/step - loss: 0.1133 - val_loss: 1.4128
Epoch 5/60
77/77 - 0s - 3ms/step - loss: 0.1021 - val_loss: 1.3968
Epoch 6/60
77/77 - 0s - 3ms/step - loss: 0.0975 - val_loss: 1.3633
Epoch 7/60
77/77 - 0s - 3ms/step - loss: 0.0931 - val_loss: 1.3334
Epoch 8/60
77/77 - 0s - 3ms/step - loss: 0.0906 - val_loss: 1.3240
Epoch 9/60
77/77 - 0s - 3ms/step - loss: 0.0898 - val_loss: 1.3093
Epoch 10/60
77/77 - 0s - 3ms/step - loss: 0.0857 - val_loss: 1.2947
Epoch 11/60
77/77 - 0s - 3ms/step - loss: 0.0837 - val_loss: 1.2696
Epoch 12/60
77/77 - 0s - 3ms/step - loss: 0.0827 - val_loss: 1.2763
Epoch 13/60
77/77 - 0s - 4ms/step - loss: 0.0800 - val_loss: 1.2441
Epoch 14/60
77/77 - 0s - 3ms/step - loss: 0.0774 - val_loss: 1.2241
Epoch 15/60
77/77 - 0s - 3ms/step - loss: 0.0763 - val_loss: 1.2150
Epoch 16/60
77/77 - 0s - 3ms/step - loss: 0.0764 - val_loss: 1.1881
Epoch 17/60
77/77 - 0s - 3ms/step - loss: 0.0751 - val_loss: 1.1739
Epoch 18/60
77/77 - 0s - 3ms/step - loss: 0.0741 - val_loss: 1.1828
Epoch 19/60
77/77 - 0s - 3ms/step - loss: 0.0748 - val_loss: 1.1686
Epoch 20/60
77/77 - 0s - 3ms/step - loss: 0.0741 - val_loss: 1.1658
Epoch 21/60
77/77 - 0s - 3ms/step - loss: 0.0716 - val_loss: 1.1774
Epoch 22/60
77/77 - 0s - 3ms/step - loss: 0.0704 - val_loss: 1.1470
Epoch 23/60
77/77 - 0s - 3ms/step - loss: 0.0700 - val_loss: 1.1431
Epoch 24/60
77/77 - 0s - 3ms/step - loss: 0.0691 - val_loss: 1.1378
Epoch 25/60
77/77 - 0s - 3ms/step - loss: 0.0682 - val_loss: 1.1593
Epoch 26/60
77/77 - 0s - 3ms/step - loss: 0.0677 - val_loss: 1.1414
Epoch 27/60
77/77 - 0s - 3ms/step - loss: 0.0669 - val_loss: 1.1464
Epoch 28/60
77/77 - 0s - 3ms/step - loss: 0.0666 - val_loss: 1.1557
Epoch 29/60
77/77 - 0s - 3ms/step - loss: 0.0659 - val_loss: 1.1364
Epoch 30/60
77/77 - 0s - 3ms/step - loss: 0.0654 - val_loss: 1.1692
Epoch 31/60
77/77 - 0s - 3ms/step - loss: 0.0650 - val_loss: 1.1542
Epoch 32/60
77/77 - 0s - 3ms/step - loss: 0.0655 - val_loss: 1.1427
Epoch 33/60
77/77 - 0s - 3ms/step - loss: 0.0634 - val_loss: 1.1229
Epoch 34/60
77/77 - 0s - 3ms/step - loss: 0.0631 - val_loss: 1.1352
Epoch 35/60
77/77 - 0s - 3ms/step - loss: 0.0625 - val_loss: 1.1582
Epoch 36/60
77/77 - 0s - 3ms/step - loss: 0.0626 - val_loss: 1.1548
Epoch 37/60
77/77 - 0s - 3ms/step - loss: 0.0624 - val_loss: 1.1384
Epoch 38/60
77/77 - 0s - 3ms/step - loss: 0.0614 - val_loss: 1.1320
Epoch 39/60
77/77 - 0s - 3ms/step - loss: 0.0611 - val_loss: 1.1235
Epoch 40/60
77/77 - 0s - 3ms/step - loss: 0.0617 - val_loss: 1.1348
Epoch 41/60
77/77 - 0s - 3ms/step - loss: 0.0608 - val_loss: 1.1322
Epoch 42/60
77/77 - 0s - 3ms/step - loss: 0.0599 - val_loss: 1.1236
Epoch 43/60
77/77 - 0s - 3ms/step - loss: 0.0598 - val_loss: 1.1056
Epoch 44/60
77/77 - 0s - 3ms/step - loss: 0.0608 - val_loss: 1.1089
Epoch 45/60
77/77 - 0s - 3ms/step - loss: 0.0602 - val_loss: 1.1233
Epoch 46/60
77/77 - 0s - 3ms/step - loss: 0.0595 - val_loss: 1.1275
Epoch 47/60
77/77 - 0s - 3ms/step - loss: 0.0586 - val_loss: 1.1223
Epoch 48/60
77/77 - 0s - 3ms/step - loss: 0.0586 - val_loss: 1.1027
Epoch 49/60
77/77 - 0s - 3ms/step - loss: 0.0583 - val_loss: 1.1229
Epoch 50/60
77/77 - 0s - 3ms/step - loss: 0.0578 - val_loss: 1.1234
Epoch 51/60
77/77 - 0s - 3ms/step - loss: 0.0580 - val_loss: 1.1339
Epoch 52/60
77/77 - 0s - 3ms/step - loss: 0.0576 - val_loss: 1.1319
Epoch 53/60
77/77 - 0s - 3ms/step - loss: 0.0578 - val_loss: 1.1443
Epoch 54/60
77/77 - 0s - 3ms/step - loss: 0.0574 - val_loss: 1.1134
Epoch 55/60
77/77 - 0s - 3ms/step - loss: 0.0571 - val_loss: 1.1047
Epoch 56/60
77/77 - 0s - 3ms/step - loss: 0.0573 - val_loss: 1.1249
Epoch 57/60
77/77 - 0s - 3ms/step - loss: 0.0570 - val_loss: 1.1427
Epoch 58/60
77/77 - 0s - 3ms/step - loss: 0.0563 - val_loss: 1.1215
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.0925
Per-joint RMSE: 1.3193 1.2235 1.1562 0.7038 0.8078 1.1995
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:35:59.515821: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:35:59.540330: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:36:00.382012: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:00.386615: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:00.387407: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:00.389219: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:00.390008: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:00.390831: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:00.470090: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:00.470930: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:00.471670: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:00.472488: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:36:00.779620: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.221314e+00  RMSE=1.105131e+00
  per-joint RMSE: 1.3266 1.2777 1.1487 0.7227 0.8099 1.1992
Residual LSTM:  MSE=1.193463e+00      RMSE=1.092457e+00
  per-joint RMSE: 1.3193 1.2235 1.1562 0.7038 0.8078 1.1995
Combined torque MSE=1.193463e+00     RMSE=1.092457e+00
  per-joint RMSE: 1.3193 1.2235 1.1562 0.7038 0.8078 1.1995
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz --H 25 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (24352, 25, 18)  Y_train: (24352, 6)
X_test : (16710, 25, 18)  Y_test : (16710, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:36:02.946484: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:36:02.970221: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (24352, 25, 18), Y_train = (24352, 6)
  X_test  = (16710, 25, 18),  Y_test  = (16710, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:36:04.009460: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:04.014513: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:04.015308: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:04.016948: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:04.017743: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:04.018489: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:04.096592: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:04.097524: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:04.098271: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:04.099009: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:36:05.072881: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
77/77 - 2s - 21ms/step - loss: 0.2488 - val_loss: 1.3861
Epoch 2/60
77/77 - 0s - 3ms/step - loss: 0.1226 - val_loss: 1.3408
Epoch 3/60
77/77 - 0s - 3ms/step - loss: 0.1057 - val_loss: 1.3263
Epoch 4/60
77/77 - 0s - 3ms/step - loss: 0.0981 - val_loss: 1.3099
Epoch 5/60
77/77 - 0s - 3ms/step - loss: 0.0912 - val_loss: 1.2687
Epoch 6/60
77/77 - 0s - 3ms/step - loss: 0.0884 - val_loss: 1.2625
Epoch 7/60
77/77 - 0s - 3ms/step - loss: 0.0837 - val_loss: 1.2348
Epoch 8/60
77/77 - 0s - 3ms/step - loss: 0.0820 - val_loss: 1.2150
Epoch 9/60
77/77 - 0s - 3ms/step - loss: 0.0792 - val_loss: 1.2104
Epoch 10/60
77/77 - 0s - 3ms/step - loss: 0.0791 - val_loss: 1.1737
Epoch 11/60
77/77 - 0s - 3ms/step - loss: 0.0762 - val_loss: 1.1682
Epoch 12/60
77/77 - 0s - 3ms/step - loss: 0.0753 - val_loss: 1.1383
Epoch 13/60
77/77 - 0s - 4ms/step - loss: 0.0737 - val_loss: 1.1412
Epoch 14/60
77/77 - 0s - 3ms/step - loss: 0.0724 - val_loss: 1.1108
Epoch 15/60
77/77 - 0s - 3ms/step - loss: 0.0717 - val_loss: 1.0977
Epoch 16/60
77/77 - 0s - 3ms/step - loss: 0.0726 - val_loss: 1.0812
Epoch 17/60
77/77 - 0s - 3ms/step - loss: 0.0694 - val_loss: 1.0672
Epoch 18/60
77/77 - 0s - 3ms/step - loss: 0.0682 - val_loss: 1.0589
Epoch 19/60
77/77 - 0s - 3ms/step - loss: 0.0685 - val_loss: 1.0486
Epoch 20/60
77/77 - 0s - 3ms/step - loss: 0.0683 - val_loss: 1.0499
Epoch 21/60
77/77 - 0s - 3ms/step - loss: 0.0661 - val_loss: 1.0243
Epoch 22/60
77/77 - 0s - 3ms/step - loss: 0.0658 - val_loss: 1.0198
Epoch 23/60
77/77 - 0s - 3ms/step - loss: 0.0655 - val_loss: 1.0076
Epoch 24/60
77/77 - 0s - 3ms/step - loss: 0.0651 - val_loss: 0.9962
Epoch 25/60
77/77 - 0s - 3ms/step - loss: 0.0647 - val_loss: 1.0041
Epoch 26/60
77/77 - 0s - 3ms/step - loss: 0.0637 - val_loss: 0.9645
Epoch 27/60
77/77 - 0s - 3ms/step - loss: 0.0632 - val_loss: 0.9850
Epoch 28/60
77/77 - 0s - 3ms/step - loss: 0.0628 - val_loss: 0.9525
Epoch 29/60
77/77 - 0s - 3ms/step - loss: 0.0626 - val_loss: 0.9440
Epoch 30/60
77/77 - 0s - 3ms/step - loss: 0.0621 - val_loss: 0.9602
Epoch 31/60
77/77 - 0s - 3ms/step - loss: 0.0613 - val_loss: 0.9442
Epoch 32/60
77/77 - 0s - 3ms/step - loss: 0.0612 - val_loss: 0.9454
Epoch 33/60
77/77 - 0s - 3ms/step - loss: 0.0604 - val_loss: 0.9385
Epoch 34/60
77/77 - 0s - 3ms/step - loss: 0.0604 - val_loss: 0.9373
Epoch 35/60
77/77 - 0s - 3ms/step - loss: 0.0608 - val_loss: 0.9303
Epoch 36/60
77/77 - 0s - 3ms/step - loss: 0.0603 - val_loss: 0.9265
Epoch 37/60
77/77 - 0s - 3ms/step - loss: 0.0595 - val_loss: 0.9197
Epoch 38/60
77/77 - 0s - 3ms/step - loss: 0.0589 - val_loss: 0.9331
Epoch 39/60
77/77 - 0s - 3ms/step - loss: 0.0589 - val_loss: 0.9340
Epoch 40/60
77/77 - 0s - 3ms/step - loss: 0.0581 - val_loss: 0.9427
Epoch 41/60
77/77 - 0s - 3ms/step - loss: 0.0577 - val_loss: 0.9068
Epoch 42/60
77/77 - 0s - 3ms/step - loss: 0.0583 - val_loss: 0.9143
Epoch 43/60
77/77 - 0s - 3ms/step - loss: 0.0580 - val_loss: 0.9124
Epoch 44/60
77/77 - 0s - 3ms/step - loss: 0.0569 - val_loss: 0.9331
Epoch 45/60
77/77 - 0s - 3ms/step - loss: 0.0571 - val_loss: 0.8947
Epoch 46/60
77/77 - 0s - 3ms/step - loss: 0.0566 - val_loss: 0.9297
Epoch 47/60
77/77 - 0s - 3ms/step - loss: 0.0562 - val_loss: 0.8990
Epoch 48/60
77/77 - 0s - 3ms/step - loss: 0.0562 - val_loss: 0.9030
Epoch 49/60
77/77 - 0s - 3ms/step - loss: 0.0559 - val_loss: 0.8895
Epoch 50/60
77/77 - 0s - 3ms/step - loss: 0.0561 - val_loss: 0.9381
Epoch 51/60
77/77 - 0s - 3ms/step - loss: 0.0558 - val_loss: 0.9106
Epoch 52/60
77/77 - 0s - 3ms/step - loss: 0.0552 - val_loss: 0.9315
Epoch 53/60
77/77 - 0s - 3ms/step - loss: 0.0549 - val_loss: 0.9473
Epoch 54/60
77/77 - 0s - 3ms/step - loss: 0.0543 - val_loss: 0.9453
Epoch 55/60
77/77 - 0s - 3ms/step - loss: 0.0544 - val_loss: 0.9210
Epoch 56/60
77/77 - 0s - 3ms/step - loss: 0.0538 - val_loss: 0.9561
Epoch 57/60
77/77 - 0s - 3ms/step - loss: 0.0539 - val_loss: 0.9664
Epoch 58/60
77/77 - 0s - 3ms/step - loss: 0.0535 - val_loss: 0.9282
Epoch 59/60
77/77 - 0s - 3ms/step - loss: 0.0532 - val_loss: 0.9549
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.0302
Per-joint RMSE: 1.1921 1.2044 1.0746 0.6867 0.7500 1.1436
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:36:19.805941: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:36:19.831068: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:36:20.678023: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:20.682986: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:20.683860: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:20.685567: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:20.686356: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:20.687093: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:20.764245: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:20.765161: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:20.765985: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:20.766711: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:36:21.073782: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.221314e+00  RMSE=1.105131e+00
  per-joint RMSE: 1.3266 1.2777 1.1487 0.7227 0.8099 1.1992
Residual LSTM:  MSE=1.061389e+00      RMSE=1.030237e+00
  per-joint RMSE: 1.1921 1.2044 1.0746 0.6867 0.7500 1.1436
Combined torque MSE=1.061389e+00     RMSE=1.030237e+00
  per-joint RMSE: 1.1921 1.2044 1.0746 0.6867 0.7500 1.1436
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz --H 50 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.json
H=50, n_dof=6, feature_dim=24
X_train: (23677, 50, 24)  Y_train: (23677, 6)
X_test : (16410, 50, 24)  Y_test : (16410, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:36:23.313152: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:36:23.338108: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (23677, 50, 24), Y_train = (23677, 6)
  X_test  = (16410, 50, 24),  Y_test  = (16410, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:36:24.544466: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:24.549313: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:24.550177: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:24.552132: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:24.552917: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:24.553647: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:24.632247: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:24.633132: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:24.633930: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:24.634716: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:36:25.640993: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
74/74 - 2s - 22ms/step - loss: 0.2568 - val_loss: 0.5036
Epoch 2/60
74/74 - 0s - 4ms/step - loss: 0.1234 - val_loss: 0.5001
Epoch 3/60
74/74 - 0s - 4ms/step - loss: 0.1069 - val_loss: 0.5017
Epoch 4/60
74/74 - 0s - 4ms/step - loss: 0.0979 - val_loss: 0.4902
Epoch 5/60
74/74 - 0s - 4ms/step - loss: 0.0919 - val_loss: 0.4910
Epoch 6/60
74/74 - 0s - 4ms/step - loss: 0.0879 - val_loss: 0.4943
Epoch 7/60
74/74 - 0s - 4ms/step - loss: 0.0852 - val_loss: 0.4993
Epoch 8/60
74/74 - 0s - 4ms/step - loss: 0.0827 - val_loss: 0.5019
Epoch 9/60
74/74 - 0s - 4ms/step - loss: 0.0808 - val_loss: 0.4948
Epoch 10/60
74/74 - 0s - 4ms/step - loss: 0.0791 - val_loss: 0.4993
Epoch 11/60
74/74 - 0s - 4ms/step - loss: 0.0777 - val_loss: 0.5003
Epoch 12/60
74/74 - 0s - 4ms/step - loss: 0.0762 - val_loss: 0.4940
Epoch 13/60
74/74 - 0s - 4ms/step - loss: 0.0758 - val_loss: 0.4910
Epoch 14/60
74/74 - 0s - 4ms/step - loss: 0.0743 - val_loss: 0.4909
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.0440
Per-joint RMSE: 1.2422 1.1765 1.0896 0.6944 0.7709 1.1614
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:36:31.693755: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:36:31.718539: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:36:32.557179: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:32.561830: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:32.562627: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:32.564284: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:32.565154: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:32.565892: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:32.646782: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:32.647619: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:32.648359: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:32.649099: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:36:32.960098: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.235879e+00  RMSE=1.111701e+00
  per-joint RMSE: 1.3356 1.2835 1.1542 0.7262 0.8144 1.2088
Residual LSTM:  MSE=1.089951e+00      RMSE=1.044007e+00
  per-joint RMSE: 1.2422 1.1765 1.0896 0.6944 0.7709 1.1614
Combined torque MSE=1.089951e+00     RMSE=1.044007e+00
  per-joint RMSE: 1.2422 1.1765 1.0896 0.6944 0.7709 1.1614
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz --H 50 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.json
H=50, n_dof=6, feature_dim=6
X_train: (23677, 50, 6)  Y_train: (23677, 6)
X_test : (16410, 50, 6)  Y_test : (16410, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:36:35.145345: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:36:35.169180: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (23677, 50, 6), Y_train = (23677, 6)
  X_test  = (16410, 50, 6),  Y_test  = (16410, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:36:36.196556: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:36.201139: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:36.202016: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:36.203630: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:36.204422: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:36.205162: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:36.283077: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:36.283919: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:36.284667: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:36.285402: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:36:37.186801: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
74/74 - 2s - 22ms/step - loss: 0.7157 - val_loss: 0.9307
Epoch 2/60
74/74 - 0s - 4ms/step - loss: 0.4815 - val_loss: 1.0020
Epoch 3/60
74/74 - 0s - 4ms/step - loss: 0.3764 - val_loss: 0.9269
Epoch 4/60
74/74 - 0s - 4ms/step - loss: 0.2863 - val_loss: 0.8966
Epoch 5/60
74/74 - 0s - 4ms/step - loss: 0.2442 - val_loss: 0.9715
Epoch 6/60
74/74 - 0s - 4ms/step - loss: 0.1986 - val_loss: 0.9267
Epoch 7/60
74/74 - 0s - 4ms/step - loss: 0.1774 - val_loss: 0.9309
Epoch 8/60
74/74 - 0s - 4ms/step - loss: 0.1602 - val_loss: 0.9879
Epoch 9/60
74/74 - 0s - 4ms/step - loss: 0.1448 - val_loss: 0.9854
Epoch 10/60
74/74 - 0s - 4ms/step - loss: 0.1328 - val_loss: 0.9887
Epoch 11/60
74/74 - 0s - 4ms/step - loss: 0.1224 - val_loss: 0.9776
Epoch 12/60
74/74 - 0s - 4ms/step - loss: 0.1165 - val_loss: 0.9573
Epoch 13/60
74/74 - 0s - 4ms/step - loss: 0.1075 - val_loss: 0.9725
Epoch 14/60
74/74 - 0s - 4ms/step - loss: 0.1036 - val_loss: 0.9543
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.0979
Per-joint RMSE: 1.3007 1.2799 1.1286 0.7404 0.8059 1.1965
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:36:43.078342: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:36:43.103540: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:36:43.975809: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:43.980550: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:43.981349: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:43.983227: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:43.984706: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:43.985439: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:44.066219: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:44.067052: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:44.068100: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:44.068891: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8950 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:36:44.375962: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.235879e+00  RMSE=1.111701e+00
  per-joint RMSE: 1.3356 1.2835 1.1542 0.7262 0.8144 1.2088
Residual LSTM:  MSE=1.205483e+00      RMSE=1.097945e+00
  per-joint RMSE: 1.3007 1.2799 1.1286 0.7404 0.8059 1.1965
Combined torque MSE=1.205483e+00     RMSE=1.097945e+00
  per-joint RMSE: 1.3007 1.2799 1.1286 0.7404 0.8059 1.1965
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz --H 50 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (23677, 50, 18)  Y_train: (23677, 6)
X_test : (16410, 50, 18)  Y_test : (16410, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:36:46.626983: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:36:46.651625: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (23677, 50, 18), Y_train = (23677, 6)
  X_test  = (16410, 50, 18),  Y_test  = (16410, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:36:47.799106: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:47.803823: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:47.804687: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:47.806420: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:47.807259: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:47.808062: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:47.886974: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:47.887951: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:47.888833: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:47.889621: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:36:48.877750: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
74/74 - 2s - 22ms/step - loss: 0.2676 - val_loss: 0.5357
Epoch 2/60
74/74 - 0s - 4ms/step - loss: 0.1342 - val_loss: 0.5506
Epoch 3/60
74/74 - 0s - 4ms/step - loss: 0.1171 - val_loss: 0.5411
Epoch 4/60
74/74 - 0s - 4ms/step - loss: 0.1080 - val_loss: 0.5474
Epoch 5/60
74/74 - 0s - 4ms/step - loss: 0.1029 - val_loss: 0.5425
Epoch 6/60
74/74 - 0s - 4ms/step - loss: 0.0973 - val_loss: 0.5458
Epoch 7/60
74/74 - 0s - 4ms/step - loss: 0.0940 - val_loss: 0.5172
Epoch 8/60
74/74 - 0s - 4ms/step - loss: 0.0907 - val_loss: 0.5221
Epoch 9/60
74/74 - 0s - 4ms/step - loss: 0.0882 - val_loss: 0.5171
Epoch 10/60
74/74 - 0s - 4ms/step - loss: 0.0861 - val_loss: 0.5196
Epoch 11/60
74/74 - 0s - 4ms/step - loss: 0.0841 - val_loss: 0.5230
Epoch 12/60
74/74 - 0s - 4ms/step - loss: 0.0820 - val_loss: 0.5237
Epoch 13/60
74/74 - 0s - 4ms/step - loss: 0.0804 - val_loss: 0.5235
Epoch 14/60
74/74 - 0s - 4ms/step - loss: 0.0791 - val_loss: 0.5260
Epoch 15/60
74/74 - 0s - 5ms/step - loss: 0.0779 - val_loss: 0.5165
Epoch 16/60
74/74 - 0s - 4ms/step - loss: 0.0758 - val_loss: 0.5251
Epoch 17/60
74/74 - 0s - 4ms/step - loss: 0.0744 - val_loss: 0.5259
Epoch 18/60
74/74 - 0s - 4ms/step - loss: 0.0736 - val_loss: 0.5336
Epoch 19/60
74/74 - 0s - 4ms/step - loss: 0.0729 - val_loss: 0.5289
Epoch 20/60
74/74 - 0s - 4ms/step - loss: 0.0719 - val_loss: 0.5366
Epoch 21/60
74/74 - 0s - 4ms/step - loss: 0.0712 - val_loss: 0.5323
Epoch 22/60
74/74 - 0s - 4ms/step - loss: 0.0705 - val_loss: 0.5260
Epoch 23/60
74/74 - 0s - 4ms/step - loss: 0.0702 - val_loss: 0.5213
Epoch 24/60
74/74 - 0s - 4ms/step - loss: 0.0687 - val_loss: 0.5337
Epoch 25/60
74/74 - 0s - 4ms/step - loss: 0.0679 - val_loss: 0.5357
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.0930
Per-joint RMSE: 1.3254 1.2322 1.1397 0.7087 0.8039 1.2025
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:36:58.310360: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:36:58.335725: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:36:59.200335: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:59.205466: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:59.206267: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:59.208117: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:59.208908: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:59.209635: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:59.288431: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:59.289344: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:59.290080: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:36:59.290807: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:36:59.602200: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.235879e+00  RMSE=1.111701e+00
  per-joint RMSE: 1.3356 1.2835 1.1542 0.7262 0.8144 1.2088
Residual LSTM:  MSE=1.194727e+00      RMSE=1.093036e+00
  per-joint RMSE: 1.3254 1.2322 1.1397 0.7087 0.8039 1.2025
Combined torque MSE=1.194727e+00     RMSE=1.093036e+00
  per-joint RMSE: 1.3254 1.2322 1.1397 0.7087 0.8039 1.2025
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz --H 50 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (23677, 50, 18)  Y_train: (23677, 6)
X_test : (16410, 50, 18)  Y_test : (16410, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:37:01.875656: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:37:01.900001: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (23677, 50, 18), Y_train = (23677, 6)
  X_test  = (16410, 50, 18),  Y_test  = (16410, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:37:03.046116: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:03.050907: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:03.051776: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:03.053676: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:03.054467: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:03.055203: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:03.141256: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:03.142356: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:03.143206: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:03.143989: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:37:04.125274: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
74/74 - 2s - 22ms/step - loss: 0.2642 - val_loss: 0.4838
Epoch 2/60
74/74 - 0s - 4ms/step - loss: 0.1223 - val_loss: 0.4671
Epoch 3/60
74/74 - 0s - 4ms/step - loss: 0.1063 - val_loss: 0.4497
Epoch 4/60
74/74 - 0s - 4ms/step - loss: 0.0971 - val_loss: 0.4410
Epoch 5/60
74/74 - 0s - 4ms/step - loss: 0.0916 - val_loss: 0.4302
Epoch 6/60
74/74 - 0s - 4ms/step - loss: 0.0878 - val_loss: 0.4319
Epoch 7/60
74/74 - 0s - 4ms/step - loss: 0.0845 - val_loss: 0.4336
Epoch 8/60
74/74 - 0s - 4ms/step - loss: 0.0823 - val_loss: 0.4301
Epoch 9/60
74/74 - 0s - 4ms/step - loss: 0.0805 - val_loss: 0.4264
Epoch 10/60
74/74 - 0s - 4ms/step - loss: 0.0795 - val_loss: 0.4203
Epoch 11/60
74/74 - 0s - 4ms/step - loss: 0.0777 - val_loss: 0.4248
Epoch 12/60
74/74 - 0s - 4ms/step - loss: 0.0757 - val_loss: 0.4315
Epoch 13/60
74/74 - 0s - 4ms/step - loss: 0.0749 - val_loss: 0.4309
Epoch 14/60
74/74 - 0s - 5ms/step - loss: 0.0738 - val_loss: 0.4287
Epoch 15/60
74/74 - 0s - 4ms/step - loss: 0.0721 - val_loss: 0.4427
Epoch 16/60
74/74 - 0s - 4ms/step - loss: 0.0712 - val_loss: 0.4401
Epoch 17/60
74/74 - 0s - 4ms/step - loss: 0.0708 - val_loss: 0.4427
Epoch 18/60
74/74 - 0s - 4ms/step - loss: 0.0704 - val_loss: 0.4465
Epoch 19/60
74/74 - 0s - 4ms/step - loss: 0.0688 - val_loss: 0.4479
Epoch 20/60
74/74 - 0s - 4ms/step - loss: 0.0684 - val_loss: 0.4432
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.0394
Per-joint RMSE: 1.2331 1.1774 1.0983 0.6775 0.7541 1.1584
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:37:12.113075: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:37:12.137919: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:37:12.992297: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:12.997051: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:12.997917: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:12.999623: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:13.000410: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:13.001138: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:13.094261: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:13.095102: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:13.095837: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:13.096571: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:37:13.409567: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.235879e+00  RMSE=1.111701e+00
  per-joint RMSE: 1.3356 1.2835 1.1542 0.7262 0.8144 1.2088
Residual LSTM:  MSE=1.080406e+00      RMSE=1.039426e+00
  per-joint RMSE: 1.2331 1.1774 1.0983 0.6775 0.7541 1.1584
Combined torque MSE=1.080406e+00     RMSE=1.039426e+00
  per-joint RMSE: 1.2331 1.1774 1.0983 0.6775 0.7541 1.1584
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=2                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz                                 ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed0_dataset.npz -t structured -s 2 -r 0 --hp_preset fast_debug --epochs 250 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 250, 'lagrangian_type': <function structured_lagrangian_fn at 0x7635418501f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed0_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed0_dataset.npz
   dt ≈ 0.022064047964597475
  dof = 6
  Train trajectories = 53
  Test trajectories  = 22
  Train samples = 25078
  Test samples  = 17028
################################################

2026-01-22 06:37:17.964146: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250 | type=structured | dof=6
################################################
2026-01-22 06:37:21.169183: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:37:21.169219: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:37:21.169225: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:37:21.169252: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:37:21.169258: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:37:21.169272: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:37:21.169317: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:37:21.169323: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:37:21.169338: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:37:21.169343: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   4.9s, Loss=1.04e+01, Inv=1.04e+01, For=1.13e+02, Power=1.62e+00
  [eval] test_mse=3.030e+00  (n=17028)
Epoch 00050: Time=   9.7s, Loss=2.77e+00, Inv=2.77e+00, For=1.15e+02, Power=6.27e-01
Epoch 00100: Time=  12.9s, Loss=2.56e+00, Inv=2.56e+00, For=1.32e+02, Power=5.67e-01
Epoch 00150: Time=  15.9s, Loss=2.45e+00, Inv=2.45e+00, For=1.28e+02, Power=5.48e-01
Epoch 00200: Time=  19.0s, Loss=2.36e+00, Inv=2.36e+00, For=1.26e+02, Power=5.27e-01
  [eval] test_mse=5.024e+00  (n=17028)
Epoch 00250: Time=  22.2s, Loss=2.29e+00, Inv=2.29e+00, For=1.28e+02, Power=5.15e-01
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250
Torque MSE  = 1.025e+00
Torque RMSE = 1.013e+00
Per-joint MSE : 1.132e+00 2.086e+00 1.071e+00 5.647e-01 5.287e-01 7.697e-01
Per-joint RMSE: 1.064e+00 1.444e+00 1.035e+00 7.514e-01 7.271e-01 8.773e-01
Comp Time per Sample = 1.994e-08s / 50144739.4Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed0_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p3_seed0_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax
Detected n_dof=6 (seed=2)
2026-01-22 06:37:45.491068: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 53 trajectories
2026-01-22 06:37:46.790968: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:37:46.790981: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:37:48.312930: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:37:48.312941: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:37:49.833919: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/53
  done 50/53
  done 53/53

Exporting split=test: 22 trajectories
2026-01-22 06:37:52.311434: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 22/22

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz --H 25 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.json
H=25, n_dof=6, feature_dim=24
X_train: (24352, 25, 24)  Y_train: (24352, 6)
X_test : (16710, 25, 24)  Y_test : (16710, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:37:54.555545: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:37:54.579372: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (24352, 25, 24), Y_train = (24352, 6)
  X_test  = (16710, 25, 24),  Y_test  = (16710, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:37:55.648533: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:55.653519: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:55.654369: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:55.656134: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:55.656979: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:55.657765: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:55.742663: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:55.743644: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:55.744527: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:37:55.745315: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:37:56.682439: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
77/77 - 2s - 20ms/step - loss: 0.2547 - val_loss: 1.2574
Epoch 2/60
77/77 - 0s - 3ms/step - loss: 0.1186 - val_loss: 1.1911
Epoch 3/60
77/77 - 0s - 3ms/step - loss: 0.1035 - val_loss: 1.1852
Epoch 4/60
77/77 - 0s - 3ms/step - loss: 0.0947 - val_loss: 1.1599
Epoch 5/60
77/77 - 0s - 3ms/step - loss: 0.0891 - val_loss: 1.1511
Epoch 6/60
77/77 - 0s - 3ms/step - loss: 0.0857 - val_loss: 1.1334
Epoch 7/60
77/77 - 0s - 3ms/step - loss: 0.0833 - val_loss: 1.1153
Epoch 8/60
77/77 - 0s - 3ms/step - loss: 0.0802 - val_loss: 1.1115
Epoch 9/60
77/77 - 0s - 3ms/step - loss: 0.0784 - val_loss: 1.0991
Epoch 10/60
77/77 - 0s - 3ms/step - loss: 0.0765 - val_loss: 1.0787
Epoch 11/60
77/77 - 0s - 3ms/step - loss: 0.0751 - val_loss: 1.0717
Epoch 12/60
77/77 - 0s - 3ms/step - loss: 0.0740 - val_loss: 1.0758
Epoch 13/60
77/77 - 0s - 4ms/step - loss: 0.0729 - val_loss: 1.0508
Epoch 14/60
77/77 - 0s - 3ms/step - loss: 0.0719 - val_loss: 1.0377
Epoch 15/60
77/77 - 0s - 3ms/step - loss: 0.0703 - val_loss: 1.0306
Epoch 16/60
77/77 - 0s - 3ms/step - loss: 0.0703 - val_loss: 1.0230
Epoch 17/60
77/77 - 0s - 3ms/step - loss: 0.0692 - val_loss: 1.0109
Epoch 18/60
77/77 - 0s - 3ms/step - loss: 0.0680 - val_loss: 0.9913
Epoch 19/60
77/77 - 0s - 3ms/step - loss: 0.0680 - val_loss: 0.9851
Epoch 20/60
77/77 - 0s - 3ms/step - loss: 0.0679 - val_loss: 0.9803
Epoch 21/60
77/77 - 0s - 3ms/step - loss: 0.0669 - val_loss: 0.9719
Epoch 22/60
77/77 - 0s - 3ms/step - loss: 0.0659 - val_loss: 0.9554
Epoch 23/60
77/77 - 0s - 3ms/step - loss: 0.0648 - val_loss: 0.9523
Epoch 24/60
77/77 - 0s - 3ms/step - loss: 0.0649 - val_loss: 0.9515
Epoch 25/60
77/77 - 0s - 3ms/step - loss: 0.0637 - val_loss: 0.9513
Epoch 26/60
77/77 - 0s - 3ms/step - loss: 0.0630 - val_loss: 0.9309
Epoch 27/60
77/77 - 0s - 3ms/step - loss: 0.0629 - val_loss: 0.9475
Epoch 28/60
77/77 - 0s - 3ms/step - loss: 0.0623 - val_loss: 0.9292
Epoch 29/60
77/77 - 0s - 3ms/step - loss: 0.0621 - val_loss: 0.9273
Epoch 30/60
77/77 - 0s - 3ms/step - loss: 0.0624 - val_loss: 0.9196
Epoch 31/60
77/77 - 0s - 3ms/step - loss: 0.0611 - val_loss: 0.9315
Epoch 32/60
77/77 - 0s - 3ms/step - loss: 0.0614 - val_loss: 0.9012
Epoch 33/60
77/77 - 0s - 3ms/step - loss: 0.0605 - val_loss: 0.9006
Epoch 34/60
77/77 - 0s - 3ms/step - loss: 0.0597 - val_loss: 0.8894
Epoch 35/60
77/77 - 0s - 3ms/step - loss: 0.0598 - val_loss: 0.8824
Epoch 36/60
77/77 - 0s - 3ms/step - loss: 0.0597 - val_loss: 0.9035
Epoch 37/60
77/77 - 0s - 3ms/step - loss: 0.0591 - val_loss: 0.9022
Epoch 38/60
77/77 - 0s - 3ms/step - loss: 0.0588 - val_loss: 0.8933
Epoch 39/60
77/77 - 0s - 3ms/step - loss: 0.0579 - val_loss: 0.8873
Epoch 40/60
77/77 - 0s - 3ms/step - loss: 0.0587 - val_loss: 0.8635
Epoch 41/60
77/77 - 0s - 3ms/step - loss: 0.0585 - val_loss: 0.8837
Epoch 42/60
77/77 - 0s - 3ms/step - loss: 0.0571 - val_loss: 0.8610
Epoch 43/60
77/77 - 0s - 3ms/step - loss: 0.0567 - val_loss: 0.8679
Epoch 44/60
77/77 - 0s - 3ms/step - loss: 0.0565 - val_loss: 0.8654
Epoch 45/60
77/77 - 0s - 3ms/step - loss: 0.0561 - val_loss: 0.8717
Epoch 46/60
77/77 - 0s - 3ms/step - loss: 0.0561 - val_loss: 0.8787
Epoch 47/60
77/77 - 0s - 3ms/step - loss: 0.0557 - val_loss: 0.8745
Epoch 48/60
77/77 - 0s - 3ms/step - loss: 0.0552 - val_loss: 0.8798
Epoch 49/60
77/77 - 0s - 3ms/step - loss: 0.0553 - val_loss: 0.8605
Epoch 50/60
77/77 - 0s - 3ms/step - loss: 0.0548 - val_loss: 0.8767
Epoch 51/60
77/77 - 0s - 3ms/step - loss: 0.0545 - val_loss: 0.8622
Epoch 52/60
77/77 - 0s - 3ms/step - loss: 0.0543 - val_loss: 0.8550
Epoch 53/60
77/77 - 0s - 3ms/step - loss: 0.0541 - val_loss: 0.8583
Epoch 54/60
77/77 - 0s - 3ms/step - loss: 0.0542 - val_loss: 0.8621
Epoch 55/60
77/77 - 0s - 3ms/step - loss: 0.0532 - val_loss: 0.8634
Epoch 56/60
77/77 - 0s - 3ms/step - loss: 0.0532 - val_loss: 0.8752
Epoch 57/60
77/77 - 0s - 3ms/step - loss: 0.0535 - val_loss: 0.8639
Epoch 58/60
77/77 - 0s - 3ms/step - loss: 0.0524 - val_loss: 0.8644
Epoch 59/60
77/77 - 0s - 3ms/step - loss: 0.0522 - val_loss: 0.8528
Epoch 60/60
77/77 - 0s - 3ms/step - loss: 0.0525 - val_loss: 0.8567
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.9372
Per-joint RMSE: 0.9703 1.3051 0.9859 0.7182 0.6705 0.8296
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:38:11.461384: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:38:11.486043: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:38:12.349475: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:12.354227: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:12.355010: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:12.356824: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:12.357609: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:12.358337: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:12.439017: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:12.439950: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:12.440749: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:12.441521: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:38:12.742934: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.039142e+00  RMSE=1.019383e+00
  per-joint RMSE: 1.0717 1.4519 1.0419 0.7569 0.7330 0.8845
Residual LSTM:  MSE=8.783627e-01      RMSE=9.372101e-01
  per-joint RMSE: 0.9703 1.3051 0.9859 0.7182 0.6705 0.8296
Combined torque MSE=8.783627e-01     RMSE=9.372101e-01
  per-joint RMSE: 0.9703 1.3051 0.9859 0.7182 0.6705 0.8296
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz --H 25 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.json
H=25, n_dof=6, feature_dim=6
X_train: (24352, 25, 6)  Y_train: (24352, 6)
X_test : (16710, 25, 6)  Y_test : (16710, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:38:14.870790: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:38:14.894977: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (24352, 25, 6), Y_train = (24352, 6)
  X_test  = (16710, 25, 6),  Y_test  = (16710, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:38:15.898267: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:15.902861: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:15.903659: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:15.905226: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:15.906010: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:15.906746: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:15.982160: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:15.983000: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:15.983740: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:15.984470: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:38:16.876525: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
77/77 - 2s - 20ms/step - loss: 0.7497 - val_loss: 2.0585
Epoch 2/60
77/77 - 0s - 3ms/step - loss: 0.5645 - val_loss: 2.0112
Epoch 3/60
77/77 - 0s - 3ms/step - loss: 0.4959 - val_loss: 2.0409
Epoch 4/60
77/77 - 0s - 3ms/step - loss: 0.4555 - val_loss: 1.9953
Epoch 5/60
77/77 - 0s - 3ms/step - loss: 0.4155 - val_loss: 2.0111
Epoch 6/60
77/77 - 0s - 3ms/step - loss: 0.3863 - val_loss: 2.0322
Epoch 7/60
77/77 - 0s - 3ms/step - loss: 0.3659 - val_loss: 2.0182
Epoch 8/60
77/77 - 0s - 3ms/step - loss: 0.3385 - val_loss: 1.9704
Epoch 9/60
77/77 - 0s - 3ms/step - loss: 0.3246 - val_loss: 2.0025
Epoch 10/60
77/77 - 0s - 3ms/step - loss: 0.2801 - val_loss: 1.9422
Epoch 11/60
77/77 - 0s - 3ms/step - loss: 0.2290 - val_loss: 1.9546
Epoch 12/60
77/77 - 0s - 3ms/step - loss: 0.2019 - val_loss: 1.9655
Epoch 13/60
77/77 - 0s - 3ms/step - loss: 0.1938 - val_loss: 1.9314
Epoch 14/60
77/77 - 0s - 4ms/step - loss: 0.1858 - val_loss: 1.9409
Epoch 15/60
77/77 - 0s - 3ms/step - loss: 0.1822 - val_loss: 1.9643
Epoch 16/60
77/77 - 0s - 3ms/step - loss: 0.1745 - val_loss: 1.9690
Epoch 17/60
77/77 - 0s - 3ms/step - loss: 0.1816 - val_loss: 1.9936
Epoch 18/60
77/77 - 0s - 3ms/step - loss: 0.1644 - val_loss: 1.9789
Epoch 19/60
77/77 - 0s - 3ms/step - loss: 0.1780 - val_loss: 1.9834
Epoch 20/60
77/77 - 0s - 3ms/step - loss: 0.2202 - val_loss: 1.9902
Epoch 21/60
77/77 - 0s - 3ms/step - loss: 0.1508 - val_loss: 1.9603
Epoch 22/60
77/77 - 0s - 3ms/step - loss: 0.1473 - val_loss: 1.9818
Epoch 23/60
77/77 - 0s - 3ms/step - loss: 0.1416 - val_loss: 1.9597
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.9854
Per-joint RMSE: 1.0659 1.3407 0.9995 0.7723 0.7298 0.8741
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:38:23.468289: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:38:23.493350: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:38:24.358704: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:24.363470: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:24.364337: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:24.366002: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:24.366793: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:24.367531: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:24.448969: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:24.449880: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:24.450625: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:24.451351: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:38:24.746436: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.039142e+00  RMSE=1.019383e+00
  per-joint RMSE: 1.0717 1.4519 1.0419 0.7569 0.7330 0.8845
Residual LSTM:  MSE=9.709895e-01      RMSE=9.853880e-01
  per-joint RMSE: 1.0659 1.3407 0.9995 0.7723 0.7298 0.8741
Combined torque MSE=9.709895e-01     RMSE=9.853880e-01
  per-joint RMSE: 1.0659 1.3407 0.9995 0.7723 0.7298 0.8741
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz --H 25 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (24352, 25, 18)  Y_train: (24352, 6)
X_test : (16710, 25, 18)  Y_test : (16710, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:38:26.928483: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:38:26.953053: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (24352, 25, 18), Y_train = (24352, 6)
  X_test  = (16710, 25, 18),  Y_test  = (16710, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:38:28.017396: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:28.022017: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:28.022817: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:28.024508: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:28.025300: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:28.026029: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:28.101212: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:28.102065: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:28.102812: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:28.103640: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:38:29.033133: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
77/77 - 2s - 20ms/step - loss: 0.2660 - val_loss: 1.3207
Epoch 2/60
77/77 - 0s - 3ms/step - loss: 0.1328 - val_loss: 1.2519
Epoch 3/60
77/77 - 0s - 3ms/step - loss: 0.1145 - val_loss: 1.2301
Epoch 4/60
77/77 - 0s - 3ms/step - loss: 0.1052 - val_loss: 1.2083
Epoch 5/60
77/77 - 0s - 3ms/step - loss: 0.1008 - val_loss: 1.2075
Epoch 6/60
77/77 - 0s - 3ms/step - loss: 0.0950 - val_loss: 1.2101
Epoch 7/60
77/77 - 0s - 3ms/step - loss: 0.0908 - val_loss: 1.1940
Epoch 8/60
77/77 - 0s - 3ms/step - loss: 0.0885 - val_loss: 1.1814
Epoch 9/60
77/77 - 0s - 3ms/step - loss: 0.0856 - val_loss: 1.1678
Epoch 10/60
77/77 - 0s - 3ms/step - loss: 0.0841 - val_loss: 1.1539
Epoch 11/60
77/77 - 0s - 3ms/step - loss: 0.0824 - val_loss: 1.1284
Epoch 12/60
77/77 - 0s - 3ms/step - loss: 0.0804 - val_loss: 1.1292
Epoch 13/60
77/77 - 0s - 3ms/step - loss: 0.0802 - val_loss: 1.1380
Epoch 14/60
77/77 - 0s - 3ms/step - loss: 0.0760 - val_loss: 1.1327
Epoch 15/60
77/77 - 0s - 3ms/step - loss: 0.0748 - val_loss: 1.1151
Epoch 16/60
77/77 - 0s - 3ms/step - loss: 0.0737 - val_loss: 1.1154
Epoch 17/60
77/77 - 0s - 3ms/step - loss: 0.0726 - val_loss: 1.0917
Epoch 18/60
77/77 - 0s - 3ms/step - loss: 0.0710 - val_loss: 1.0789
Epoch 19/60
77/77 - 0s - 3ms/step - loss: 0.0705 - val_loss: 1.0757
Epoch 20/60
77/77 - 0s - 3ms/step - loss: 0.0702 - val_loss: 1.0585
Epoch 21/60
77/77 - 0s - 3ms/step - loss: 0.0702 - val_loss: 1.0436
Epoch 22/60
77/77 - 0s - 3ms/step - loss: 0.0684 - val_loss: 1.0426
Epoch 23/60
77/77 - 0s - 3ms/step - loss: 0.0671 - val_loss: 1.0349
Epoch 24/60
77/77 - 0s - 3ms/step - loss: 0.0675 - val_loss: 1.0243
Epoch 25/60
77/77 - 0s - 3ms/step - loss: 0.0679 - val_loss: 1.0101
Epoch 26/60
77/77 - 0s - 3ms/step - loss: 0.0653 - val_loss: 1.0039
Epoch 27/60
77/77 - 0s - 3ms/step - loss: 0.0651 - val_loss: 1.0219
Epoch 28/60
77/77 - 0s - 3ms/step - loss: 0.0694 - val_loss: 1.0163
Epoch 29/60
77/77 - 0s - 3ms/step - loss: 0.0652 - val_loss: 1.0160
Epoch 30/60
77/77 - 0s - 3ms/step - loss: 0.0639 - val_loss: 1.0311
Epoch 31/60
77/77 - 0s - 3ms/step - loss: 0.0631 - val_loss: 0.9982
Epoch 32/60
77/77 - 0s - 3ms/step - loss: 0.0630 - val_loss: 1.0075
Epoch 33/60
77/77 - 0s - 3ms/step - loss: 0.0622 - val_loss: 0.9980
Epoch 34/60
77/77 - 0s - 3ms/step - loss: 0.0630 - val_loss: 0.9901
Epoch 35/60
77/77 - 0s - 3ms/step - loss: 0.0615 - val_loss: 0.9946
Epoch 36/60
77/77 - 0s - 3ms/step - loss: 0.0614 - val_loss: 1.0064
Epoch 37/60
77/77 - 0s - 3ms/step - loss: 0.0613 - val_loss: 1.0076
Epoch 38/60
77/77 - 0s - 3ms/step - loss: 0.0610 - val_loss: 0.9946
Epoch 39/60
77/77 - 0s - 3ms/step - loss: 0.0604 - val_loss: 0.9942
Epoch 40/60
77/77 - 0s - 3ms/step - loss: 0.0604 - val_loss: 0.9690
Epoch 41/60
77/77 - 0s - 3ms/step - loss: 0.0603 - val_loss: 0.9396
Epoch 42/60
77/77 - 0s - 3ms/step - loss: 0.0592 - val_loss: 0.9846
Epoch 43/60
77/77 - 0s - 3ms/step - loss: 0.0596 - val_loss: 0.9889
Epoch 44/60
77/77 - 0s - 3ms/step - loss: 0.0585 - val_loss: 0.9957
Epoch 45/60
77/77 - 0s - 3ms/step - loss: 0.0590 - val_loss: 0.9785
Epoch 46/60
77/77 - 0s - 3ms/step - loss: 0.0584 - val_loss: 0.9793
Epoch 47/60
77/77 - 0s - 3ms/step - loss: 0.0590 - val_loss: 0.9724
Epoch 48/60
77/77 - 0s - 3ms/step - loss: 0.0586 - val_loss: 0.9674
Epoch 49/60
77/77 - 0s - 3ms/step - loss: 0.0574 - val_loss: 0.9787
Epoch 50/60
77/77 - 0s - 3ms/step - loss: 0.0581 - val_loss: 0.9657
Epoch 51/60
77/77 - 0s - 3ms/step - loss: 0.0572 - val_loss: 0.9737
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.9878
Per-joint RMSE: 1.0625 1.3528 1.0399 0.7553 0.7122 0.8584
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:38:41.819186: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:38:41.844353: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:38:42.709871: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:42.714539: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:42.715402: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:42.717100: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:42.717897: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:42.718640: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:42.792792: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:42.793633: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:42.794387: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:42.795111: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:38:43.094352: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.039142e+00  RMSE=1.019383e+00
  per-joint RMSE: 1.0717 1.4519 1.0419 0.7569 0.7330 0.8845
Residual LSTM:  MSE=9.758298e-01      RMSE=9.878410e-01
  per-joint RMSE: 1.0625 1.3528 1.0399 0.7553 0.7122 0.8584
Combined torque MSE=9.758298e-01     RMSE=9.878410e-01
  per-joint RMSE: 1.0625 1.3528 1.0399 0.7553 0.7122 0.8584
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz --H 25 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (24352, 25, 18)  Y_train: (24352, 6)
X_test : (16710, 25, 18)  Y_test : (16710, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:38:45.279411: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:38:45.303202: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (24352, 25, 18), Y_train = (24352, 6)
  X_test  = (16710, 25, 18),  Y_test  = (16710, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:38:46.346410: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:46.351220: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:46.352010: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:46.353604: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:46.354392: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:46.355120: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:46.434464: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:46.435299: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:46.436035: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:38:46.436763: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:38:47.372131: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
77/77 - 2s - 21ms/step - loss: 0.2377 - val_loss: 1.3508
Epoch 2/60
77/77 - 0s - 3ms/step - loss: 0.1171 - val_loss: 1.2632
Epoch 3/60
77/77 - 0s - 3ms/step - loss: 0.1030 - val_loss: 1.2501
Epoch 4/60
77/77 - 0s - 3ms/step - loss: 0.0951 - val_loss: 1.2466
Epoch 5/60
77/77 - 0s - 3ms/step - loss: 0.0887 - val_loss: 1.2477
Epoch 6/60
77/77 - 0s - 3ms/step - loss: 0.0859 - val_loss: 1.2509
Epoch 7/60
77/77 - 0s - 3ms/step - loss: 0.0826 - val_loss: 1.2371
Epoch 8/60
77/77 - 0s - 3ms/step - loss: 0.0800 - val_loss: 1.2312
Epoch 9/60
77/77 - 0s - 3ms/step - loss: 0.0780 - val_loss: 1.1960
Epoch 10/60
77/77 - 0s - 3ms/step - loss: 0.0769 - val_loss: 1.1557
Epoch 11/60
77/77 - 0s - 3ms/step - loss: 0.0749 - val_loss: 1.1766
Epoch 12/60
77/77 - 0s - 3ms/step - loss: 0.0734 - val_loss: 1.1998
Epoch 13/60
77/77 - 0s - 3ms/step - loss: 0.0720 - val_loss: 1.1443
Epoch 14/60
77/77 - 0s - 4ms/step - loss: 0.0720 - val_loss: 1.1291
Epoch 15/60
77/77 - 0s - 3ms/step - loss: 0.0697 - val_loss: 1.1100
Epoch 16/60
77/77 - 0s - 3ms/step - loss: 0.0688 - val_loss: 1.1402
Epoch 17/60
77/77 - 0s - 3ms/step - loss: 0.0684 - val_loss: 1.1110
Epoch 18/60
77/77 - 0s - 3ms/step - loss: 0.0675 - val_loss: 1.0586
Epoch 19/60
77/77 - 0s - 3ms/step - loss: 0.0668 - val_loss: 1.0658
Epoch 20/60
77/77 - 0s - 3ms/step - loss: 0.0662 - val_loss: 1.1174
Epoch 21/60
77/77 - 0s - 3ms/step - loss: 0.0660 - val_loss: 1.0806
Epoch 22/60
77/77 - 0s - 3ms/step - loss: 0.0653 - val_loss: 1.0009
Epoch 23/60
77/77 - 0s - 3ms/step - loss: 0.0645 - val_loss: 1.0815
Epoch 24/60
77/77 - 0s - 3ms/step - loss: 0.0636 - val_loss: 0.9490
Epoch 25/60
77/77 - 0s - 3ms/step - loss: 0.0633 - val_loss: 0.9521
Epoch 26/60
77/77 - 0s - 3ms/step - loss: 0.0628 - val_loss: 0.9596
Epoch 27/60
77/77 - 0s - 3ms/step - loss: 0.0621 - val_loss: 0.9526
Epoch 28/60
77/77 - 0s - 3ms/step - loss: 0.0623 - val_loss: 0.9460
Epoch 29/60
77/77 - 0s - 3ms/step - loss: 0.0616 - val_loss: 0.9788
Epoch 30/60
77/77 - 0s - 3ms/step - loss: 0.0607 - val_loss: 0.9806
Epoch 31/60
77/77 - 0s - 3ms/step - loss: 0.0611 - val_loss: 0.9553
Epoch 32/60
77/77 - 0s - 3ms/step - loss: 0.0610 - val_loss: 0.8877
Epoch 33/60
77/77 - 0s - 3ms/step - loss: 0.0604 - val_loss: 0.9153
Epoch 34/60
77/77 - 0s - 3ms/step - loss: 0.0595 - val_loss: 0.9274
Epoch 35/60
77/77 - 0s - 3ms/step - loss: 0.0593 - val_loss: 0.8602
Epoch 36/60
77/77 - 0s - 3ms/step - loss: 0.0590 - val_loss: 0.8659
Epoch 37/60
77/77 - 0s - 3ms/step - loss: 0.0583 - val_loss: 0.9003
Epoch 38/60
77/77 - 0s - 3ms/step - loss: 0.0588 - val_loss: 0.9138
Epoch 39/60
77/77 - 0s - 3ms/step - loss: 0.0579 - val_loss: 0.9260
Epoch 40/60
77/77 - 0s - 3ms/step - loss: 0.0580 - val_loss: 0.8510
Epoch 41/60
77/77 - 0s - 3ms/step - loss: 0.0582 - val_loss: 0.8906
Epoch 42/60
77/77 - 0s - 3ms/step - loss: 0.0571 - val_loss: 0.8776
Epoch 43/60
77/77 - 0s - 3ms/step - loss: 0.0569 - val_loss: 0.8766
Epoch 44/60
77/77 - 0s - 3ms/step - loss: 0.0573 - val_loss: 0.8845
Epoch 45/60
77/77 - 0s - 3ms/step - loss: 0.0570 - val_loss: 0.8675
Epoch 46/60
77/77 - 0s - 3ms/step - loss: 0.0561 - val_loss: 0.8742
Epoch 47/60
77/77 - 0s - 3ms/step - loss: 0.0564 - val_loss: 0.8657
Epoch 48/60
77/77 - 0s - 3ms/step - loss: 0.0554 - val_loss: 0.8474
Epoch 49/60
77/77 - 0s - 3ms/step - loss: 0.0552 - val_loss: 0.8503
Epoch 50/60
77/77 - 0s - 3ms/step - loss: 0.0550 - val_loss: 0.8589
Epoch 51/60
77/77 - 0s - 3ms/step - loss: 0.0543 - val_loss: 0.8659
Epoch 52/60
77/77 - 0s - 3ms/step - loss: 0.0542 - val_loss: 0.8642
Epoch 53/60
77/77 - 0s - 3ms/step - loss: 0.0544 - val_loss: 0.8705
Epoch 54/60
77/77 - 0s - 3ms/step - loss: 0.0537 - val_loss: 0.8642
Epoch 55/60
77/77 - 0s - 3ms/step - loss: 0.0544 - val_loss: 0.8606
Epoch 56/60
77/77 - 0s - 3ms/step - loss: 0.0542 - val_loss: 0.8591
Epoch 57/60
77/77 - 0s - 3ms/step - loss: 0.0530 - val_loss: 0.8523
Epoch 58/60
77/77 - 0s - 3ms/step - loss: 0.0530 - val_loss: 0.8425
Epoch 59/60
77/77 - 0s - 3ms/step - loss: 0.0526 - val_loss: 0.8464
Epoch 60/60
77/77 - 0s - 3ms/step - loss: 0.0521 - val_loss: 0.8499
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.9484
Per-joint RMSE: 0.9889 1.3348 1.0022 0.7048 0.6719 0.8277
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:39:01.822964: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:39:01.847719: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:39:02.721379: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:02.726053: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:02.726994: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:02.728683: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:02.729470: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:02.730210: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:02.807554: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:02.808479: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:02.809300: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:02.810034: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:39:03.108208: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.039142e+00  RMSE=1.019383e+00
  per-joint RMSE: 1.0717 1.4519 1.0419 0.7569 0.7330 0.8845
Residual LSTM:  MSE=8.995520e-01      RMSE=9.484472e-01
  per-joint RMSE: 0.9889 1.3348 1.0022 0.7048 0.6719 0.8277
Combined torque MSE=8.995520e-01     RMSE=9.484472e-01
  per-joint RMSE: 0.9889 1.3348 1.0022 0.7048 0.6719 0.8277
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz --H 50 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.json
H=50, n_dof=6, feature_dim=24
X_train: (23677, 50, 24)  Y_train: (23677, 6)
X_test : (16410, 50, 24)  Y_test : (16410, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:39:05.436141: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:39:05.459928: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (23677, 50, 24), Y_train = (23677, 6)
  X_test  = (16410, 50, 24),  Y_test  = (16410, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:39:06.684611: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:06.689564: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:06.690473: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:06.692433: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:06.693339: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:06.694192: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:06.781528: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:06.782500: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:06.783295: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:06.784075: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:39:07.796497: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
74/74 - 2s - 22ms/step - loss: 0.2531 - val_loss: 0.4924
Epoch 2/60
74/74 - 0s - 4ms/step - loss: 0.1202 - val_loss: 0.4820
Epoch 3/60
74/74 - 0s - 4ms/step - loss: 0.1034 - val_loss: 0.4689
Epoch 4/60
74/74 - 0s - 4ms/step - loss: 0.0947 - val_loss: 0.4645
Epoch 5/60
74/74 - 0s - 4ms/step - loss: 0.0892 - val_loss: 0.4569
Epoch 6/60
74/74 - 0s - 4ms/step - loss: 0.0861 - val_loss: 0.4514
Epoch 7/60
74/74 - 0s - 4ms/step - loss: 0.0829 - val_loss: 0.4522
Epoch 8/60
74/74 - 0s - 4ms/step - loss: 0.0807 - val_loss: 0.4692
Epoch 9/60
74/74 - 0s - 4ms/step - loss: 0.0792 - val_loss: 0.4512
Epoch 10/60
74/74 - 0s - 4ms/step - loss: 0.0775 - val_loss: 0.4412
Epoch 11/60
74/74 - 0s - 4ms/step - loss: 0.0756 - val_loss: 0.4549
Epoch 12/60
74/74 - 0s - 4ms/step - loss: 0.0748 - val_loss: 0.4461
Epoch 13/60
74/74 - 0s - 4ms/step - loss: 0.0737 - val_loss: 0.4465
Epoch 14/60
74/74 - 0s - 5ms/step - loss: 0.0727 - val_loss: 0.4570
Epoch 15/60
74/74 - 0s - 4ms/step - loss: 0.0710 - val_loss: 0.4558
Epoch 16/60
74/74 - 0s - 4ms/step - loss: 0.0702 - val_loss: 0.4571
Epoch 17/60
74/74 - 0s - 4ms/step - loss: 0.0699 - val_loss: 0.4635
Epoch 18/60
74/74 - 0s - 4ms/step - loss: 0.0687 - val_loss: 0.4472
Epoch 19/60
74/74 - 0s - 4ms/step - loss: 0.0680 - val_loss: 0.4640
Epoch 20/60
74/74 - 0s - 4ms/step - loss: 0.0676 - val_loss: 0.4567
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.9534
Per-joint RMSE: 0.9672 1.3420 1.0028 0.7325 0.6862 0.8391
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:39:15.740537: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:39:15.765518: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:39:16.624097: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:16.629069: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:16.629867: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:16.631657: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:16.632440: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:16.633175: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:16.714317: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:16.715151: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:16.715895: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:16.716632: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:39:17.020653: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.052097e+00  RMSE=1.025718e+00
  per-joint RMSE: 1.0798 1.4593 1.0479 0.7625 0.7371 0.8912
Residual LSTM:  MSE=9.089395e-01      RMSE=9.533831e-01
  per-joint RMSE: 0.9672 1.3420 1.0028 0.7325 0.6862 0.8391
Combined torque MSE=9.089395e-01     RMSE=9.533831e-01
  per-joint RMSE: 0.9672 1.3420 1.0028 0.7325 0.6862 0.8391
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz --H 50 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.json
H=50, n_dof=6, feature_dim=6
X_train: (23677, 50, 6)  Y_train: (23677, 6)
X_test : (16410, 50, 6)  Y_test : (16410, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:39:19.225216: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:39:19.249475: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (23677, 50, 6), Y_train = (23677, 6)
  X_test  = (16410, 50, 6),  Y_test  = (16410, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:39:20.276602: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:20.281158: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:20.281952: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:20.283616: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:20.284413: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:20.285141: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:20.361535: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:20.362373: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:20.363114: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:20.363923: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:39:21.281024: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
74/74 - 2s - 22ms/step - loss: 0.7269 - val_loss: 1.0603
Epoch 2/60
74/74 - 0s - 4ms/step - loss: 0.4929 - val_loss: 1.1045
Epoch 3/60
74/74 - 0s - 4ms/step - loss: 0.4085 - val_loss: 1.1444
Epoch 4/60
74/74 - 0s - 4ms/step - loss: 0.3477 - val_loss: 1.1253
Epoch 5/60
74/74 - 0s - 4ms/step - loss: 0.2855 - val_loss: 1.1422
Epoch 6/60
74/74 - 0s - 4ms/step - loss: 0.2038 - val_loss: 1.1443
Epoch 7/60
74/74 - 0s - 4ms/step - loss: 0.1782 - val_loss: 1.1478
Epoch 8/60
74/74 - 0s - 4ms/step - loss: 0.1707 - val_loss: 1.1220
Epoch 9/60
74/74 - 0s - 4ms/step - loss: 0.1662 - val_loss: 1.1337
Epoch 10/60
74/74 - 0s - 4ms/step - loss: 0.1436 - val_loss: 1.1378
Epoch 11/60
74/74 - 0s - 4ms/step - loss: 0.1363 - val_loss: 1.1054
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 1.0177
Per-joint RMSE: 1.0888 1.4356 1.0149 0.7781 0.7519 0.8756
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:39:26.321430: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:39:26.346148: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:39:27.202111: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:27.206788: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:27.207588: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:27.209523: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:27.210307: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:27.211043: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:27.292022: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:27.292939: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:27.293678: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:27.294407: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:39:27.587660: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.052097e+00  RMSE=1.025718e+00
  per-joint RMSE: 1.0798 1.4593 1.0479 0.7625 0.7371 0.8912
Residual LSTM:  MSE=1.035690e+00      RMSE=1.017689e+00
  per-joint RMSE: 1.0888 1.4356 1.0149 0.7781 0.7519 0.8756
Combined torque MSE=1.035690e+00     RMSE=1.017689e+00
  per-joint RMSE: 1.0888 1.4356 1.0149 0.7781 0.7519 0.8756
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz --H 50 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (23677, 50, 18)  Y_train: (23677, 6)
X_test : (16410, 50, 18)  Y_test : (16410, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:39:29.833476: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:39:29.857336: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (23677, 50, 18), Y_train = (23677, 6)
  X_test  = (16410, 50, 18),  Y_test  = (16410, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:39:30.990019: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:30.994899: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:30.995692: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:30.997439: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:30.998302: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:30.999049: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:31.083248: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:31.084086: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:31.084830: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:31.085565: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:39:32.030704: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
74/74 - 2s - 22ms/step - loss: 0.2724 - val_loss: 0.5717
Epoch 2/60
74/74 - 0s - 4ms/step - loss: 0.1342 - val_loss: 0.5829
Epoch 3/60
74/74 - 0s - 4ms/step - loss: 0.1166 - val_loss: 0.5650
Epoch 4/60
74/74 - 0s - 4ms/step - loss: 0.1075 - val_loss: 0.5571
Epoch 5/60
74/74 - 0s - 4ms/step - loss: 0.1016 - val_loss: 0.5430
Epoch 6/60
74/74 - 0s - 4ms/step - loss: 0.0957 - val_loss: 0.5407
Epoch 7/60
74/74 - 0s - 4ms/step - loss: 0.0926 - val_loss: 0.5384
Epoch 8/60
74/74 - 0s - 4ms/step - loss: 0.0891 - val_loss: 0.5340
Epoch 9/60
74/74 - 0s - 4ms/step - loss: 0.0874 - val_loss: 0.5427
Epoch 10/60
74/74 - 0s - 4ms/step - loss: 0.0852 - val_loss: 0.5288
Epoch 11/60
74/74 - 0s - 4ms/step - loss: 0.0830 - val_loss: 0.5260
Epoch 12/60
74/74 - 0s - 4ms/step - loss: 0.0813 - val_loss: 0.5300
Epoch 13/60
74/74 - 0s - 4ms/step - loss: 0.0784 - val_loss: 0.5233
Epoch 14/60
74/74 - 0s - 5ms/step - loss: 0.0774 - val_loss: 0.5190
Epoch 15/60
74/74 - 0s - 4ms/step - loss: 0.0762 - val_loss: 0.5190
Epoch 16/60
74/74 - 0s - 4ms/step - loss: 0.0755 - val_loss: 0.5235
Epoch 17/60
74/74 - 0s - 4ms/step - loss: 0.0736 - val_loss: 0.5177
Epoch 18/60
74/74 - 0s - 4ms/step - loss: 0.0729 - val_loss: 0.5160
Epoch 19/60
74/74 - 0s - 4ms/step - loss: 0.0713 - val_loss: 0.5166
Epoch 20/60
74/74 - 0s - 4ms/step - loss: 0.0713 - val_loss: 0.5121
Epoch 21/60
74/74 - 0s - 4ms/step - loss: 0.0699 - val_loss: 0.5144
Epoch 22/60
74/74 - 0s - 4ms/step - loss: 0.0701 - val_loss: 0.5155
Epoch 23/60
74/74 - 0s - 4ms/step - loss: 0.0688 - val_loss: 0.5021
Epoch 24/60
74/74 - 0s - 4ms/step - loss: 0.0681 - val_loss: 0.5111
Epoch 25/60
74/74 - 0s - 4ms/step - loss: 0.0675 - val_loss: 0.5113
Epoch 26/60
74/74 - 0s - 4ms/step - loss: 0.0677 - val_loss: 0.5162
Epoch 27/60
74/74 - 0s - 4ms/step - loss: 0.0671 - val_loss: 0.5119
Epoch 28/60
74/74 - 0s - 4ms/step - loss: 0.0663 - val_loss: 0.5157
Epoch 29/60
74/74 - 0s - 4ms/step - loss: 0.0654 - val_loss: 0.5202
Epoch 30/60
74/74 - 0s - 4ms/step - loss: 0.0651 - val_loss: 0.5212
Epoch 31/60
74/74 - 0s - 4ms/step - loss: 0.0643 - val_loss: 0.5164
Epoch 32/60
74/74 - 0s - 4ms/step - loss: 0.0645 - val_loss: 0.5107
Epoch 33/60
74/74 - 0s - 4ms/step - loss: 0.0644 - val_loss: 0.5198
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.9999
Per-joint RMSE: 1.0779 1.3531 1.0648 0.7560 0.7321 0.8746
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:39:43.872810: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:39:43.897765: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:39:44.759214: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:44.763860: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:44.764705: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:44.766537: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:44.767375: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:44.768157: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:44.849224: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:44.850203: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:44.851000: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:44.851790: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:39:45.159041: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.052097e+00  RMSE=1.025718e+00
  per-joint RMSE: 1.0798 1.4593 1.0479 0.7625 0.7371 0.8912
Residual LSTM:  MSE=9.998412e-01      RMSE=9.999205e-01
  per-joint RMSE: 1.0779 1.3531 1.0648 0.7560 0.7321 0.8746
Combined torque MSE=9.998412e-01     RMSE=9.999205e-01
  per-joint RMSE: 1.0779 1.3531 1.0648 0.7560 0.7321 0.8746
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz --H 50 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (23677, 50, 18)  Y_train: (23677, 6)
X_test : (16410, 50, 18)  Y_test : (16410, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:39:47.439554: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:39:47.463615: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (23677, 50, 18), Y_train = (23677, 6)
  X_test  = (16410, 50, 18),  Y_test  = (16410, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:39:48.615736: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:48.620504: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:48.621381: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:48.623178: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:48.623967: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:48.624704: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:48.708292: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:48.709188: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:48.709977: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:48.710712: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:39:49.664650: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
74/74 - 2s - 22ms/step - loss: 0.2497 - val_loss: 0.4968
Epoch 2/60
74/74 - 0s - 4ms/step - loss: 0.1216 - val_loss: 0.4563
Epoch 3/60
74/74 - 0s - 4ms/step - loss: 0.1050 - val_loss: 0.4363
Epoch 4/60
74/74 - 0s - 4ms/step - loss: 0.0961 - val_loss: 0.4309
Epoch 5/60
74/74 - 0s - 4ms/step - loss: 0.0904 - val_loss: 0.4273
Epoch 6/60
74/74 - 0s - 4ms/step - loss: 0.0866 - val_loss: 0.4256
Epoch 7/60
74/74 - 0s - 4ms/step - loss: 0.0837 - val_loss: 0.4303
Epoch 8/60
74/74 - 0s - 4ms/step - loss: 0.0816 - val_loss: 0.4406
Epoch 9/60
74/74 - 0s - 4ms/step - loss: 0.0797 - val_loss: 0.4376
Epoch 10/60
74/74 - 0s - 4ms/step - loss: 0.0779 - val_loss: 0.4360
Epoch 11/60
74/74 - 0s - 4ms/step - loss: 0.0761 - val_loss: 0.4423
Epoch 12/60
74/74 - 0s - 4ms/step - loss: 0.0745 - val_loss: 0.4480
Epoch 13/60
74/74 - 0s - 4ms/step - loss: 0.0736 - val_loss: 0.4500
Epoch 14/60
74/74 - 0s - 5ms/step - loss: 0.0723 - val_loss: 0.4457
Epoch 15/60
74/74 - 0s - 4ms/step - loss: 0.0713 - val_loss: 0.4475
Epoch 16/60
74/74 - 0s - 4ms/step - loss: 0.0702 - val_loss: 0.4391
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.9665
Per-joint RMSE: 0.9786 1.3891 1.0081 0.7197 0.6898 0.8409
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:39:56.275676: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:39:56.300472: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p3__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 22
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:39:57.150535: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:57.155126: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:57.155924: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:57.157578: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:57.158367: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:57.159106: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:57.243364: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:57.244350: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:57.245083: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:39:57.245811: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:39:57.558499: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.052097e+00  RMSE=1.025718e+00
  per-joint RMSE: 1.0798 1.4593 1.0479 0.7625 0.7371 0.8912
Residual LSTM:  MSE=9.340311e-01      RMSE=9.664528e-01
  per-joint RMSE: 0.9786 1.3891 1.0081 0.7197 0.6898 0.8409
Combined torque MSE=9.340311e-01     RMSE=9.664528e-01
  per-joint RMSE: 0.9786 1.3891 1.0081 0.7197 0.6898 0.8409
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p3__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

