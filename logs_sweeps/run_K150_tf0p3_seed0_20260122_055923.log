#################################################################################################################
### RUN: K=150 test_fraction=0.3 seed=0                                                                       ###
### npz_in=/workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed0_dataset.npz ###
#################################################################################################################

#####################
### 1) PREPROCESS ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_delan_dataset.py --qdd True --col_format wide --trajectory_amount 150 --test_fraction 0.3 --seed 0 --raw_csv /workspace/shared/data/raw/delan_UR3_Load0_combined_26.csv --out_npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed0_dataset.npz' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Saved: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed0_dataset.npz
Trajectories: train=105 test=45
Exists: True

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=0                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz                                ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed0_dataset.npz -t structured -s 0 -r 0 --hp_preset fast_debug --epochs 400 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400.jax' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 400, 'lagrangian_type': <function structured_lagrangian_fn at 0x73d2789341f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed0_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed0_dataset.npz
   dt ≈ 0.02164581443156888
  dof = 6
  Train trajectories = 105
  Test trajectories  = 45
  Train samples = 64153
  Test samples  = 23070
################################################

2026-01-22 08:53:41.698143: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400 | type=structured | dof=6
################################################
2026-01-22 08:53:44.836134: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:53:44.836171: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:53:44.836177: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:53:44.836205: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:53:44.836210: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:53:44.836224: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:53:44.836262: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:53:44.836267: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:53:44.836283: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:53:44.836287: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.1s, Loss=8.58e+00, Inv=8.58e+00, For=1.56e+02, Power=1.74e+00
  [eval] test_mse=1.444e+00  (n=23070)
Epoch 00050: Time=  14.7s, Loss=2.75e+00, Inv=2.75e+00, For=1.04e+02, Power=9.88e-01
Epoch 00100: Time=  22.8s, Loss=2.45e+00, Inv=2.45e+00, For=1.42e+02, Power=9.11e-01
Epoch 00150: Time=  31.4s, Loss=2.33e+00, Inv=2.33e+00, For=1.75e+02, Power=8.83e-01
Epoch 00200: Time=  40.1s, Loss=2.29e+00, Inv=2.29e+00, For=1.82e+02, Power=8.74e-01
  [eval] test_mse=1.714e+00  (n=23070)
Epoch 00250: Time=  48.6s, Loss=2.25e+00, Inv=2.25e+00, For=1.90e+02, Power=8.61e-01
Epoch 00300: Time=  57.1s, Loss=2.23e+00, Inv=2.23e+00, For=1.96e+02, Power=8.48e-01
Epoch 00350: Time=  66.1s, Loss=2.20e+00, Inv=2.20e+00, For=2.01e+02, Power=8.41e-01
Epoch 00400: Time=  74.9s, Loss=2.19e+00, Inv=2.19e+00, For=2.05e+02, Power=8.38e-01
  [eval] test_mse=2.186e+00  (n=23070)
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400
Torque MSE  = 3.643e-01
Torque RMSE = 6.036e-01
Per-joint MSE : 4.795e-01 9.630e-01 3.838e-01 1.944e-01 6.561e-02 9.964e-02
Per-joint RMSE: 6.925e-01 9.813e-01 6.195e-01 4.409e-01 2.561e-01 3.157e-01
Comp Time per Sample = 1.382e-08s / 72338116.5Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed0_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed0_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400.jax
Detected n_dof=6 (seed=0)
2026-01-22 08:55:01.863014: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 105 trajectories
2026-01-22 08:55:03.174006: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:55:03.174018: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:55:04.757364: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:55:04.757379: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:55:06.181912: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/105
2026-01-22 08:55:08.633373: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 50/105
2026-01-22 08:55:09.829480: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 08:55:11.131410: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 75/105
  done 100/105
  done 105/105

Exporting split=test: 45 trajectories
  done 25/45
  done 45/45

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400.npz --H 25 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400.json
H=25, n_dof=6, feature_dim=24
X_train: (62725, 25, 24)  Y_train: (62725, 6)
X_test : (22494, 25, 24)  Y_test : (22494, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:55:13.453187: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:55:13.477258: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (62725, 25, 24), Y_train = (62725, 6)
  X_test  = (22494, 25, 24),  Y_test  = (22494, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:55:14.706558: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:55:14.711441: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:55:14.712476: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:55:14.714288: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:55:14.715217: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:55:14.716100: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:55:14.805868: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:55:14.806943: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:55:14.807743: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:55:14.808531: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8835 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:55:15.806377: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
197/197 - 2s - 10ms/step - loss: 0.2421 - val_loss: 0.1964
Epoch 2/100
197/197 - 1s - 3ms/step - loss: 0.1490 - val_loss: 0.1612
Epoch 3/100
197/197 - 1s - 3ms/step - loss: 0.1263 - val_loss: 0.1513
Epoch 4/100
197/197 - 1s - 3ms/step - loss: 0.1194 - val_loss: 0.1436
Epoch 5/100
197/197 - 1s - 3ms/step - loss: 0.1136 - val_loss: 0.1385
Epoch 6/100
197/197 - 1s - 3ms/step - loss: 0.1024 - val_loss: 0.1329
Epoch 7/100
197/197 - 1s - 3ms/step - loss: 0.0956 - val_loss: 0.1304
Epoch 8/100
197/197 - 1s - 3ms/step - loss: 0.0926 - val_loss: 0.1275
Epoch 9/100
197/197 - 1s - 3ms/step - loss: 0.0899 - val_loss: 0.1274
Epoch 10/100
197/197 - 1s - 3ms/step - loss: 0.0873 - val_loss: 0.1224
Epoch 11/100
197/197 - 1s - 3ms/step - loss: 0.0863 - val_loss: 0.1249
Epoch 12/100
197/197 - 1s - 3ms/step - loss: 0.0835 - val_loss: 0.1224
Epoch 13/100
197/197 - 1s - 3ms/step - loss: 0.0897 - val_loss: 0.1194
Epoch 14/100
197/197 - 1s - 3ms/step - loss: 0.0900 - val_loss: 0.1255
Epoch 15/100
197/197 - 1s - 3ms/step - loss: 0.0897 - val_loss: 0.1184
Epoch 16/100
197/197 - 0s - 3ms/step - loss: 0.0849 - val_loss: 0.1191
Epoch 17/100
197/197 - 1s - 3ms/step - loss: 0.0838 - val_loss: 0.1178
Epoch 18/100
197/197 - 1s - 4ms/step - loss: 0.0785 - val_loss: 0.1139
Epoch 19/100
197/197 - 1s - 3ms/step - loss: 0.0735 - val_loss: 0.1133
Epoch 20/100
197/197 - 1s - 3ms/step - loss: 0.0722 - val_loss: 0.1132
Epoch 21/100
197/197 - 0s - 3ms/step - loss: 0.0714 - val_loss: 0.1145
Epoch 22/100
197/197 - 1s - 3ms/step - loss: 0.0711 - val_loss: 0.1146
Epoch 23/100
197/197 - 1s - 3ms/step - loss: 0.0707 - val_loss: 0.1126
Epoch 24/100
197/197 - 0s - 3ms/step - loss: 0.0695 - val_loss: 0.1158
Epoch 25/100
197/197 - 0s - 2ms/step - loss: 0.0693 - val_loss: 0.1140
Epoch 26/100
197/197 - 0s - 2ms/step - loss: 0.0678 - val_loss: 0.1131
Epoch 27/100
197/197 - 0s - 3ms/step - loss: 0.0670 - val_loss: 0.1109
Epoch 28/100
197/197 - 1s - 3ms/step - loss: 0.0663 - val_loss: 0.1104
Epoch 29/100
197/197 - 1s - 3ms/step - loss: 0.0661 - val_loss: 0.1089
Epoch 30/100
197/197 - 1s - 3ms/step - loss: 0.0652 - val_loss: 0.1080
Epoch 31/100
197/197 - 1s - 3ms/step - loss: 0.0646 - val_loss: 0.1065
Epoch 32/100
197/197 - 0s - 3ms/step - loss: 0.0636 - val_loss: 0.1072
Epoch 33/100
197/197 - 0s - 3ms/step - loss: 0.0632 - val_loss: 0.1061
Epoch 34/100
197/197 - 0s - 3ms/step - loss: 0.0624 - val_loss: 0.1081
Epoch 35/100
197/197 - 0s - 2ms/step - loss: 0.0632 - val_loss: 0.1072
Epoch 36/100
197/197 - 0s - 2ms/step - loss: 0.0619 - val_loss: 0.1074
Epoch 37/100
197/197 - 1s - 3ms/step - loss: 0.0616 - val_loss: 0.1065
Epoch 38/100
197/197 - 1s - 3ms/step - loss: 0.0613 - val_loss: 0.1050
Epoch 39/100
197/197 - 1s - 3ms/step - loss: 0.0605 - val_loss: 0.1057
Epoch 40/100
197/197 - 1s - 3ms/step - loss: 0.0601 - val_loss: 0.1041
Epoch 41/100
197/197 - 1s - 3ms/step - loss: 0.0597 - val_loss: 0.1063
Epoch 42/100
197/197 - 0s - 3ms/step - loss: 0.0588 - val_loss: 0.1072
Epoch 43/100
197/197 - 0s - 3ms/step - loss: 0.0586 - val_loss: 0.1050
Epoch 44/100
197/197 - 0s - 2ms/step - loss: 0.0578 - val_loss: 0.1068
Epoch 45/100
197/197 - 0s - 3ms/step - loss: 0.0585 - val_loss: 0.1028
Epoch 46/100
197/197 - 0s - 2ms/step - loss: 0.0585 - val_loss: 0.1049
Epoch 47/100
197/197 - 0s - 2ms/step - loss: 0.0573 - val_loss: 0.1041
Epoch 48/100
197/197 - 1s - 3ms/step - loss: 0.0565 - val_loss: 0.1030
Epoch 49/100
197/197 - 1s - 3ms/step - loss: 0.0566 - val_loss: 0.1059
Epoch 50/100
197/197 - 1s - 3ms/step - loss: 0.0575 - val_loss: 0.1024
Epoch 51/100
197/197 - 0s - 3ms/step - loss: 0.0555 - val_loss: 0.1041
Epoch 52/100
197/197 - 1s - 3ms/step - loss: 0.0558 - val_loss: 0.1004
Epoch 53/100
197/197 - 0s - 3ms/step - loss: 0.0555 - val_loss: 0.1034
Epoch 54/100
197/197 - 0s - 3ms/step - loss: 0.0547 - val_loss: 0.1022
Epoch 55/100
197/197 - 0s - 3ms/step - loss: 0.0542 - val_loss: 0.1040
Epoch 56/100
197/197 - 0s - 2ms/step - loss: 0.0543 - val_loss: 0.1046
Epoch 57/100
197/197 - 1s - 3ms/step - loss: 0.0538 - val_loss: 0.0991
Epoch 58/100
197/197 - 1s - 3ms/step - loss: 0.0527 - val_loss: 0.1011
Epoch 59/100
197/197 - 0s - 3ms/step - loss: 0.0524 - val_loss: 0.1000
Epoch 60/100
197/197 - 0s - 2ms/step - loss: 0.0519 - val_loss: 0.1007
Epoch 61/100
197/197 - 0s - 2ms/step - loss: 0.0519 - val_loss: 0.0994
Epoch 62/100
197/197 - 1s - 3ms/step - loss: 0.0509 - val_loss: 0.1023
Epoch 63/100
197/197 - 1s - 3ms/step - loss: 0.0512 - val_loss: 0.1016
Epoch 64/100
197/197 - 0s - 2ms/step - loss: 0.0498 - val_loss: 0.1001
Epoch 65/100
197/197 - 0s - 2ms/step - loss: 0.0497 - val_loss: 0.1019
Epoch 66/100
197/197 - 0s - 3ms/step - loss: 0.0497 - val_loss: 0.1002
Epoch 67/100
197/197 - 1s - 3ms/step - loss: 0.0491 - val_loss: 0.0974
Epoch 68/100
197/197 - 0s - 2ms/step - loss: 0.0487 - val_loss: 0.0983
Epoch 69/100
197/197 - 0s - 2ms/step - loss: 0.0482 - val_loss: 0.1012
Epoch 70/100
197/197 - 1s - 3ms/step - loss: 0.0479 - val_loss: 0.0964
Epoch 71/100
197/197 - 1s - 3ms/step - loss: 0.0472 - val_loss: 0.1000
Epoch 72/100
197/197 - 0s - 3ms/step - loss: 0.0473 - val_loss: 0.1009
Epoch 73/100
197/197 - 1s - 3ms/step - loss: 0.0463 - val_loss: 0.0987
Epoch 74/100
197/197 - 0s - 2ms/step - loss: 0.0464 - val_loss: 0.1005
Epoch 75/100
197/197 - 1s - 3ms/step - loss: 0.0460 - val_loss: 0.0990
Epoch 76/100
197/197 - 0s - 3ms/step - loss: 0.0457 - val_loss: 0.1003
Epoch 77/100
197/197 - 1s - 3ms/step - loss: 0.0457 - val_loss: 0.0959
Epoch 78/100
197/197 - 1s - 3ms/step - loss: 0.0447 - val_loss: 0.0948
Epoch 79/100
197/197 - 1s - 3ms/step - loss: 0.0441 - val_loss: 0.0954
Epoch 80/100
197/197 - 1s - 3ms/step - loss: 0.0442 - val_loss: 0.0917
Epoch 81/100
197/197 - 1s - 3ms/step - loss: 0.0444 - val_loss: 0.0944
Epoch 82/100
197/197 - 0s - 2ms/step - loss: 0.0438 - val_loss: 0.0946
Epoch 83/100
197/197 - 1s - 3ms/step - loss: 0.0436 - val_loss: 0.0944
Epoch 84/100
197/197 - 1s - 3ms/step - loss: 0.0431 - val_loss: 0.0925
Epoch 85/100
197/197 - 1s - 3ms/step - loss: 0.0429 - val_loss: 0.0976
Epoch 86/100
197/197 - 1s - 3ms/step - loss: 0.0426 - val_loss: 0.0942
Epoch 87/100
197/197 - 0s - 2ms/step - loss: 0.0420 - val_loss: 0.0956
Epoch 88/100
197/197 - 1s - 3ms/step - loss: 0.0422 - val_loss: 0.0947
Epoch 89/100
197/197 - 1s - 3ms/step - loss: 0.0415 - val_loss: 0.0945
Epoch 90/100
197/197 - 1s - 3ms/step - loss: 0.0413 - val_loss: 0.0958
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4779
Per-joint RMSE: 0.5712 0.7401 0.5047 0.3996 0.1879 0.2154
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:56:03.142335: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:56:03.167535: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 08:56:04.035629: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:04.040284: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:04.041080: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:04.042874: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:04.043916: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:04.044791: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:04.124702: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:04.125539: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:04.126286: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:04.127015: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8835 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:56:04.430742: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.701963e-01  RMSE=6.084376e-01
  per-joint RMSE: 0.6984 0.9891 0.6246 0.4449 0.2569 0.3177
Residual LSTM:  MSE=2.283489e-01      RMSE=4.778587e-01
  per-joint RMSE: 0.5712 0.7401 0.5047 0.3996 0.1879 0.2154
Combined torque MSE=2.283489e-01     RMSE=4.778587e-01
  per-joint RMSE: 0.5712 0.7401 0.5047 0.3996 0.1879 0.2154
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400.npz --H 25 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400.json
H=25, n_dof=6, feature_dim=6
X_train: (62725, 25, 6)  Y_train: (62725, 6)
X_test : (22494, 25, 6)  Y_test : (22494, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:56:06.832873: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:56:06.856875: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (62725, 25, 6), Y_train = (62725, 6)
  X_test  = (22494, 25, 6),  Y_test  = (22494, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:56:07.917696: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:07.922941: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:07.923843: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:07.925506: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:07.926384: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:07.927203: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:08.008989: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:08.009981: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:08.010732: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:08.011463: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8835 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:56:08.954363: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
197/197 - 2s - 9ms/step - loss: 0.7458 - val_loss: 0.8090
Epoch 2/100
197/197 - 1s - 3ms/step - loss: 0.5627 - val_loss: 0.6776
Epoch 3/100
197/197 - 1s - 3ms/step - loss: 0.3971 - val_loss: 0.7001
Epoch 4/100
197/197 - 1s - 3ms/step - loss: 0.3337 - val_loss: 0.6649
Epoch 5/100
197/197 - 1s - 3ms/step - loss: 0.2843 - val_loss: 0.6209
Epoch 6/100
197/197 - 1s - 3ms/step - loss: 0.2527 - val_loss: 0.6318
Epoch 7/100
197/197 - 1s - 3ms/step - loss: 0.2307 - val_loss: 0.5764
Epoch 8/100
197/197 - 1s - 3ms/step - loss: 0.2066 - val_loss: 0.4832
Epoch 9/100
197/197 - 1s - 3ms/step - loss: 0.1797 - val_loss: 0.4755
Epoch 10/100
197/197 - 1s - 3ms/step - loss: 0.1901 - val_loss: 0.5124
Epoch 11/100
197/197 - 0s - 3ms/step - loss: 0.1569 - val_loss: 0.4812
Epoch 12/100
197/197 - 1s - 3ms/step - loss: 0.1624 - val_loss: 0.4858
Epoch 13/100
197/197 - 1s - 3ms/step - loss: 0.1448 - val_loss: 0.4590
Epoch 14/100
197/197 - 1s - 3ms/step - loss: 0.1400 - val_loss: 0.4490
Epoch 15/100
197/197 - 1s - 3ms/step - loss: 0.1496 - val_loss: 0.4262
Epoch 16/100
197/197 - 1s - 3ms/step - loss: 0.1588 - val_loss: 0.4571
Epoch 17/100
197/197 - 0s - 3ms/step - loss: 0.1363 - val_loss: 0.4384
Epoch 18/100
197/197 - 1s - 3ms/step - loss: 0.1266 - val_loss: 0.4733
Epoch 19/100
197/197 - 1s - 3ms/step - loss: 0.1291 - val_loss: 0.4353
Epoch 20/100
197/197 - 0s - 2ms/step - loss: 0.1219 - val_loss: 0.4294
Epoch 21/100
197/197 - 0s - 3ms/step - loss: 0.1299 - val_loss: 0.4981
Epoch 22/100
197/197 - 0s - 2ms/step - loss: 0.1425 - val_loss: 0.4505
Epoch 23/100
197/197 - 1s - 3ms/step - loss: 0.1708 - val_loss: 0.5324
Epoch 24/100
197/197 - 0s - 3ms/step - loss: 0.1605 - val_loss: 0.4690
Epoch 25/100
197/197 - 1s - 3ms/step - loss: 0.1289 - val_loss: 0.4760
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5516
Per-joint RMSE: 0.6492 0.8405 0.5891 0.4415 0.2501 0.3048
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:56:23.337741: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:56:23.362243: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 08:56:24.229330: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:24.233965: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:24.234759: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:24.236360: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:24.237146: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:24.237880: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:24.317835: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:24.318751: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:24.319501: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:24.320232: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8835 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:56:24.618604: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.701963e-01  RMSE=6.084376e-01
  per-joint RMSE: 0.6984 0.9891 0.6246 0.4449 0.2569 0.3177
Residual LSTM:  MSE=3.042318e-01      RMSE=5.515721e-01
  per-joint RMSE: 0.6492 0.8405 0.5891 0.4415 0.2501 0.3048
Combined torque MSE=3.042318e-01     RMSE=5.515721e-01
  per-joint RMSE: 0.6492 0.8405 0.5891 0.4415 0.2501 0.3048
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400.npz --H 25 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400.json
H=25, n_dof=6, feature_dim=18
X_train: (62725, 25, 18)  Y_train: (62725, 6)
X_test : (22494, 25, 18)  Y_test : (22494, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:56:27.128963: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:56:27.152702: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (62725, 25, 18), Y_train = (62725, 6)
  X_test  = (22494, 25, 18),  Y_test  = (22494, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:56:28.318315: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:28.322934: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:28.323721: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:28.325483: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:28.326272: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:28.327008: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:28.414353: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:28.415233: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:28.416364: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:28.417149: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8835 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:56:29.387595: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
197/197 - 2s - 9ms/step - loss: 0.2804 - val_loss: 0.2397
Epoch 2/100
197/197 - 1s - 3ms/step - loss: 0.1829 - val_loss: 0.2041
Epoch 3/100
197/197 - 1s - 3ms/step - loss: 0.1588 - val_loss: 0.1966
Epoch 4/100
197/197 - 0s - 3ms/step - loss: 0.1404 - val_loss: 0.1837
Epoch 5/100
197/197 - 0s - 3ms/step - loss: 0.1334 - val_loss: 0.1807
Epoch 6/100
197/197 - 1s - 3ms/step - loss: 0.1257 - val_loss: 0.1773
Epoch 7/100
197/197 - 1s - 3ms/step - loss: 0.1220 - val_loss: 0.1704
Epoch 8/100
197/197 - 1s - 3ms/step - loss: 0.1150 - val_loss: 0.1671
Epoch 9/100
197/197 - 1s - 3ms/step - loss: 0.1110 - val_loss: 0.1634
Epoch 10/100
197/197 - 0s - 2ms/step - loss: 0.1074 - val_loss: 0.1648
Epoch 11/100
197/197 - 0s - 3ms/step - loss: 0.1048 - val_loss: 0.1626
Epoch 12/100
197/197 - 1s - 3ms/step - loss: 0.1027 - val_loss: 0.1579
Epoch 13/100
197/197 - 0s - 3ms/step - loss: 0.1022 - val_loss: 0.1615
Epoch 14/100
197/197 - 1s - 3ms/step - loss: 0.0997 - val_loss: 0.1557
Epoch 15/100
197/197 - 0s - 3ms/step - loss: 0.0985 - val_loss: 0.1575
Epoch 16/100
197/197 - 0s - 3ms/step - loss: 0.0958 - val_loss: 0.1547
Epoch 17/100
197/197 - 0s - 2ms/step - loss: 0.0951 - val_loss: 0.1557
Epoch 18/100
197/197 - 1s - 3ms/step - loss: 0.0927 - val_loss: 0.1531
Epoch 19/100
197/197 - 0s - 2ms/step - loss: 0.0920 - val_loss: 0.1549
Epoch 20/100
197/197 - 0s - 2ms/step - loss: 0.0904 - val_loss: 0.1580
Epoch 21/100
197/197 - 0s - 2ms/step - loss: 0.0896 - val_loss: 0.1541
Epoch 22/100
197/197 - 0s - 2ms/step - loss: 0.0871 - val_loss: 0.1531
Epoch 23/100
197/197 - 1s - 3ms/step - loss: 0.0859 - val_loss: 0.1533
Epoch 24/100
197/197 - 0s - 2ms/step - loss: 0.0854 - val_loss: 0.1555
Epoch 25/100
197/197 - 0s - 3ms/step - loss: 0.0845 - val_loss: 0.1556
Epoch 26/100
197/197 - 1s - 3ms/step - loss: 0.0831 - val_loss: 0.1485
Epoch 27/100
197/197 - 0s - 3ms/step - loss: 0.0804 - val_loss: 0.1498
Epoch 28/100
197/197 - 0s - 2ms/step - loss: 0.0811 - val_loss: 0.1533
Epoch 29/100
197/197 - 0s - 2ms/step - loss: 0.0801 - val_loss: 0.1515
Epoch 30/100
197/197 - 1s - 3ms/step - loss: 0.0795 - val_loss: 0.1474
Epoch 31/100
197/197 - 0s - 3ms/step - loss: 0.0787 - val_loss: 0.1524
Epoch 32/100
197/197 - 0s - 3ms/step - loss: 0.0772 - val_loss: 0.1495
Epoch 33/100
197/197 - 0s - 2ms/step - loss: 0.0763 - val_loss: 0.1489
Epoch 34/100
197/197 - 0s - 3ms/step - loss: 0.0764 - val_loss: 0.1519
Epoch 35/100
197/197 - 0s - 2ms/step - loss: 0.0754 - val_loss: 0.1539
Epoch 36/100
197/197 - 0s - 2ms/step - loss: 0.0743 - val_loss: 0.1500
Epoch 37/100
197/197 - 1s - 3ms/step - loss: 0.0745 - val_loss: 0.1459
Epoch 38/100
197/197 - 0s - 3ms/step - loss: 0.0732 - val_loss: 0.1477
Epoch 39/100
197/197 - 0s - 3ms/step - loss: 0.0728 - val_loss: 0.1463
Epoch 40/100
197/197 - 0s - 2ms/step - loss: 0.0717 - val_loss: 0.1482
Epoch 41/100
197/197 - 0s - 2ms/step - loss: 0.0722 - val_loss: 0.1471
Epoch 42/100
197/197 - 0s - 2ms/step - loss: 0.0717 - val_loss: 0.1498
Epoch 43/100
197/197 - 0s - 2ms/step - loss: 0.0702 - val_loss: 0.1492
Epoch 44/100
197/197 - 1s - 3ms/step - loss: 0.0707 - val_loss: 0.1453
Epoch 45/100
197/197 - 0s - 2ms/step - loss: 0.0717 - val_loss: 0.1482
Epoch 46/100
197/197 - 0s - 2ms/step - loss: 0.0689 - val_loss: 0.1484
Epoch 47/100
197/197 - 0s - 3ms/step - loss: 0.0706 - val_loss: 0.1487
Epoch 48/100
197/197 - 0s - 3ms/step - loss: 0.0681 - val_loss: 0.1465
Epoch 49/100
197/197 - 0s - 2ms/step - loss: 0.0692 - val_loss: 0.1487
Epoch 50/100
197/197 - 0s - 2ms/step - loss: 0.0678 - val_loss: 0.1524
Epoch 51/100
197/197 - 0s - 3ms/step - loss: 0.0694 - val_loss: 0.1489
Epoch 52/100
197/197 - 0s - 3ms/step - loss: 0.0660 - val_loss: 0.1471
Epoch 53/100
197/197 - 0s - 3ms/step - loss: 0.0672 - val_loss: 0.1479
Epoch 54/100
197/197 - 0s - 2ms/step - loss: 0.0658 - val_loss: 0.1458
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5591
Per-joint RMSE: 0.6766 0.8774 0.6006 0.4070 0.2233 0.2680
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:56:57.959930: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:56:57.986090: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 08:56:58.819119: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:58.823716: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:58.824505: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:58.826253: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:58.827053: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:58.827796: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:58.906515: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:58.907359: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:58.908103: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:56:58.908912: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8835 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:56:59.208354: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.701963e-01  RMSE=6.084376e-01
  per-joint RMSE: 0.6984 0.9891 0.6246 0.4449 0.2569 0.3177
Residual LSTM:  MSE=3.126153e-01      RMSE=5.591201e-01
  per-joint RMSE: 0.6766 0.8774 0.6006 0.4070 0.2233 0.2680
Combined torque MSE=3.126153e-01     RMSE=5.591201e-01
  per-joint RMSE: 0.6766 0.8774 0.6006 0.4070 0.2233 0.2680
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400.npz --H 25 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400.json
H=25, n_dof=6, feature_dim=18
X_train: (62725, 25, 18)  Y_train: (62725, 6)
X_test : (22494, 25, 18)  Y_test : (22494, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:57:01.681941: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:57:01.705756: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (62725, 25, 18), Y_train = (62725, 6)
  X_test  = (22494, 25, 18),  Y_test  = (22494, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:57:02.883324: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:02.887720: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:02.888593: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:02.890343: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:02.891119: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:02.891856: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:02.974359: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:02.975239: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:02.976032: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:02.976823: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8835 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:57:03.953498: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
197/197 - 2s - 9ms/step - loss: 0.2473 - val_loss: 0.1973
Epoch 2/100
197/197 - 1s - 3ms/step - loss: 0.1521 - val_loss: 0.1659
Epoch 3/100
197/197 - 1s - 3ms/step - loss: 0.1307 - val_loss: 0.1570
Epoch 4/100
197/197 - 1s - 3ms/step - loss: 0.1164 - val_loss: 0.1532
Epoch 5/100
197/197 - 0s - 3ms/step - loss: 0.1080 - val_loss: 0.1495
Epoch 6/100
197/197 - 1s - 3ms/step - loss: 0.1037 - val_loss: 0.1433
Epoch 7/100
197/197 - 1s - 3ms/step - loss: 0.0990 - val_loss: 0.1416
Epoch 8/100
197/197 - 1s - 3ms/step - loss: 0.0956 - val_loss: 0.1375
Epoch 9/100
197/197 - 0s - 2ms/step - loss: 0.0914 - val_loss: 0.1383
Epoch 10/100
197/197 - 0s - 3ms/step - loss: 0.0890 - val_loss: 0.1349
Epoch 11/100
197/197 - 1s - 3ms/step - loss: 0.0870 - val_loss: 0.1348
Epoch 12/100
197/197 - 1s - 3ms/step - loss: 0.0849 - val_loss: 0.1342
Epoch 13/100
197/197 - 1s - 3ms/step - loss: 0.0835 - val_loss: 0.1311
Epoch 14/100
197/197 - 1s - 3ms/step - loss: 0.0807 - val_loss: 0.1315
Epoch 15/100
197/197 - 1s - 3ms/step - loss: 0.0798 - val_loss: 0.1268
Epoch 16/100
197/197 - 1s - 3ms/step - loss: 0.0774 - val_loss: 0.1270
Epoch 17/100
197/197 - 1s - 3ms/step - loss: 0.0768 - val_loss: 0.1255
Epoch 18/100
197/197 - 1s - 3ms/step - loss: 0.0757 - val_loss: 0.1240
Epoch 19/100
197/197 - 0s - 3ms/step - loss: 0.0749 - val_loss: 0.1243
Epoch 20/100
197/197 - 0s - 2ms/step - loss: 0.0727 - val_loss: 0.1241
Epoch 21/100
197/197 - 1s - 3ms/step - loss: 0.0720 - val_loss: 0.1229
Epoch 22/100
197/197 - 0s - 2ms/step - loss: 0.0708 - val_loss: 0.1238
Epoch 23/100
197/197 - 1s - 3ms/step - loss: 0.0707 - val_loss: 0.1220
Epoch 24/100
197/197 - 0s - 2ms/step - loss: 0.0707 - val_loss: 0.1226
Epoch 25/100
197/197 - 0s - 3ms/step - loss: 0.0691 - val_loss: 0.1221
Epoch 26/100
197/197 - 0s - 3ms/step - loss: 0.0679 - val_loss: 0.1234
Epoch 27/100
197/197 - 0s - 3ms/step - loss: 0.0675 - val_loss: 0.1201
Epoch 28/100
197/197 - 0s - 2ms/step - loss: 0.0671 - val_loss: 0.1244
Epoch 29/100
197/197 - 0s - 2ms/step - loss: 0.0661 - val_loss: 0.1220
Epoch 30/100
197/197 - 0s - 2ms/step - loss: 0.0662 - val_loss: 0.1233
Epoch 31/100
197/197 - 0s - 2ms/step - loss: 0.0641 - val_loss: 0.1239
Epoch 32/100
197/197 - 0s - 2ms/step - loss: 0.0645 - val_loss: 0.1215
Epoch 33/100
197/197 - 0s - 3ms/step - loss: 0.0671 - val_loss: 0.1212
Epoch 34/100
197/197 - 0s - 2ms/step - loss: 0.0636 - val_loss: 0.1206
Epoch 35/100
197/197 - 0s - 2ms/step - loss: 0.0635 - val_loss: 0.1220
Epoch 36/100
197/197 - 0s - 2ms/step - loss: 0.0622 - val_loss: 0.1236
Epoch 37/100
197/197 - 0s - 3ms/step - loss: 0.0620 - val_loss: 0.1222
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4863
Per-joint RMSE: 0.5205 0.7955 0.5165 0.4067 0.1912 0.2154
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:57:24.180794: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:57:24.205379: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 08:57:25.049718: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:25.054286: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:25.055077: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:25.056750: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:25.057539: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:25.058278: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:25.139163: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:25.140016: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:25.140771: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:25.141505: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8835 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:57:25.442745: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.701963e-01  RMSE=6.084376e-01
  per-joint RMSE: 0.6984 0.9891 0.6246 0.4449 0.2569 0.3177
Residual LSTM:  MSE=2.364768e-01      RMSE=4.862888e-01
  per-joint RMSE: 0.5205 0.7955 0.5165 0.4067 0.1912 0.2154
Combined torque MSE=2.364768e-01     RMSE=4.862888e-01
  per-joint RMSE: 0.5205 0.7955 0.5165 0.4067 0.1912 0.2154
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400.npz --H 50 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400.json
H=50, n_dof=6, feature_dim=24
X_train: (61400, 50, 24)  Y_train: (61400, 6)
X_test : (21969, 50, 24)  Y_test : (21969, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:57:28.140006: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:57:28.164423: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (61400, 50, 24), Y_train = (61400, 6)
  X_test  = (21969, 50, 24),  Y_test  = (21969, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:57:29.950739: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:29.955418: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:29.956454: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:29.958283: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:29.959185: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:29.960211: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:30.056444: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:30.057346: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:30.058134: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:57:30.058923: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8834 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:57:31.309065: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
192/192 - 2s - 11ms/step - loss: 0.2458 - val_loss: 0.1452
Epoch 2/100
192/192 - 1s - 4ms/step - loss: 0.1474 - val_loss: 0.1256
Epoch 3/100
192/192 - 1s - 4ms/step - loss: 0.1278 - val_loss: 0.1207
Epoch 4/100
192/192 - 1s - 4ms/step - loss: 0.1147 - val_loss: 0.1158
Epoch 5/100
192/192 - 1s - 4ms/step - loss: 0.1073 - val_loss: 0.1121
Epoch 6/100
192/192 - 1s - 4ms/step - loss: 0.1007 - val_loss: 0.1092
Epoch 7/100
192/192 - 1s - 4ms/step - loss: 0.0963 - val_loss: 0.1073
Epoch 8/100
192/192 - 1s - 4ms/step - loss: 0.0921 - val_loss: 0.1044
Epoch 9/100
192/192 - 1s - 4ms/step - loss: 0.0896 - val_loss: 0.1036
Epoch 10/100
192/192 - 1s - 4ms/step - loss: 0.0867 - val_loss: 0.1020
Epoch 11/100
192/192 - 1s - 4ms/step - loss: 0.0845 - val_loss: 0.1014
Epoch 12/100
192/192 - 1s - 4ms/step - loss: 0.0826 - val_loss: 0.1004
Epoch 13/100
192/192 - 1s - 4ms/step - loss: 0.0809 - val_loss: 0.0992
Epoch 14/100
192/192 - 1s - 4ms/step - loss: 0.0793 - val_loss: 0.0981
Epoch 15/100
192/192 - 1s - 4ms/step - loss: 0.0772 - val_loss: 0.0973
Epoch 16/100
192/192 - 1s - 4ms/step - loss: 0.0759 - val_loss: 0.0972
Epoch 17/100
192/192 - 1s - 4ms/step - loss: 0.0755 - val_loss: 0.0974
Epoch 18/100
192/192 - 1s - 4ms/step - loss: 0.0744 - val_loss: 0.0965
Epoch 19/100
192/192 - 1s - 4ms/step - loss: 0.0733 - val_loss: 0.0945
Epoch 20/100
192/192 - 1s - 4ms/step - loss: 0.0718 - val_loss: 0.0944
Epoch 21/100
192/192 - 1s - 4ms/step - loss: 0.0714 - val_loss: 0.0953
Epoch 22/100
192/192 - 1s - 4ms/step - loss: 0.0706 - val_loss: 0.0946
Epoch 23/100
192/192 - 1s - 4ms/step - loss: 0.0696 - val_loss: 0.0943
Epoch 24/100
192/192 - 1s - 4ms/step - loss: 0.0688 - val_loss: 0.0940
Epoch 25/100
192/192 - 1s - 4ms/step - loss: 0.0685 - val_loss: 0.0931
Epoch 26/100
192/192 - 1s - 4ms/step - loss: 0.0674 - val_loss: 0.0931
Epoch 27/100
192/192 - 1s - 4ms/step - loss: 0.0668 - val_loss: 0.0930
Epoch 28/100
192/192 - 1s - 4ms/step - loss: 0.0660 - val_loss: 0.0919
Epoch 29/100
192/192 - 1s - 4ms/step - loss: 0.0650 - val_loss: 0.0925
Epoch 30/100
192/192 - 1s - 4ms/step - loss: 0.0648 - val_loss: 0.0914
Epoch 31/100
192/192 - 1s - 4ms/step - loss: 0.0646 - val_loss: 0.0910
Epoch 32/100
192/192 - 1s - 4ms/step - loss: 0.0639 - val_loss: 0.0909
Epoch 33/100
192/192 - 1s - 4ms/step - loss: 0.0627 - val_loss: 0.0916
Epoch 34/100
192/192 - 1s - 4ms/step - loss: 0.0628 - val_loss: 0.0898
Epoch 35/100
192/192 - 1s - 4ms/step - loss: 0.0617 - val_loss: 0.0903
Epoch 36/100
192/192 - 1s - 4ms/step - loss: 0.0618 - val_loss: 0.0894
Epoch 37/100
192/192 - 1s - 4ms/step - loss: 0.0612 - val_loss: 0.0890
Epoch 38/100
192/192 - 1s - 4ms/step - loss: 0.0605 - val_loss: 0.0878
Epoch 39/100
192/192 - 1s - 4ms/step - loss: 0.0602 - val_loss: 0.0882
Epoch 40/100
192/192 - 1s - 4ms/step - loss: 0.0599 - val_loss: 0.0874
Epoch 41/100
192/192 - 1s - 4ms/step - loss: 0.0598 - val_loss: 0.0880
Epoch 42/100
192/192 - 1s - 4ms/step - loss: 0.0593 - val_loss: 0.0872
Epoch 43/100
192/192 - 1s - 4ms/step - loss: 0.0589 - val_loss: 0.0874
Epoch 44/100
192/192 - 1s - 4ms/step - loss: 0.0588 - val_loss: 0.0876
Epoch 45/100
192/192 - 1s - 4ms/step - loss: 0.0577 - val_loss: 0.0874
Epoch 46/100
192/192 - 1s - 4ms/step - loss: 0.0580 - val_loss: 0.0867
Epoch 47/100
192/192 - 1s - 4ms/step - loss: 0.0570 - val_loss: 0.0857
Epoch 48/100
192/192 - 1s - 4ms/step - loss: 0.0568 - val_loss: 0.0863
Epoch 49/100
192/192 - 1s - 4ms/step - loss: 0.0562 - val_loss: 0.0871
Epoch 50/100
192/192 - 1s - 4ms/step - loss: 0.0560 - val_loss: 0.0864
Epoch 51/100
192/192 - 1s - 4ms/step - loss: 0.0559 - val_loss: 0.0856
Epoch 52/100
192/192 - 1s - 4ms/step - loss: 0.0554 - val_loss: 0.0846
Epoch 53/100
192/192 - 1s - 4ms/step - loss: 0.0548 - val_loss: 0.0840
Epoch 54/100
192/192 - 1s - 4ms/step - loss: 0.0548 - val_loss: 0.0841
Epoch 55/100
192/192 - 1s - 4ms/step - loss: 0.0542 - val_loss: 0.0859
Epoch 56/100
192/192 - 1s - 4ms/step - loss: 0.0540 - val_loss: 0.0840
Epoch 57/100
192/192 - 1s - 4ms/step - loss: 0.0532 - val_loss: 0.0833
Epoch 58/100
192/192 - 1s - 4ms/step - loss: 0.0530 - val_loss: 0.0834
Epoch 59/100
192/192 - 1s - 4ms/step - loss: 0.0520 - val_loss: 0.0824
Epoch 60/100
192/192 - 1s - 4ms/step - loss: 0.0519 - val_loss: 0.0828
Epoch 61/100
192/192 - 1s - 4ms/step - loss: 0.0518 - val_loss: 0.0835
Epoch 62/100
192/192 - 1s - 4ms/step - loss: 0.0508 - val_loss: 0.0822
Epoch 63/100
192/192 - 1s - 4ms/step - loss: 0.0502 - val_loss: 0.0820
Epoch 64/100
192/192 - 1s - 4ms/step - loss: 0.0495 - val_loss: 0.0821
Epoch 65/100
192/192 - 1s - 4ms/step - loss: 0.0493 - val_loss: 0.0816
Epoch 66/100
192/192 - 1s - 4ms/step - loss: 0.0496 - val_loss: 0.0817
Epoch 67/100
192/192 - 1s - 4ms/step - loss: 0.0488 - val_loss: 0.0801
Epoch 68/100
192/192 - 1s - 4ms/step - loss: 0.0483 - val_loss: 0.0813
Epoch 69/100
192/192 - 1s - 4ms/step - loss: 0.0478 - val_loss: 0.0802
Epoch 70/100
192/192 - 1s - 4ms/step - loss: 0.0474 - val_loss: 0.0814
Epoch 71/100
192/192 - 1s - 4ms/step - loss: 0.0473 - val_loss: 0.0796
Epoch 72/100
192/192 - 1s - 4ms/step - loss: 0.0469 - val_loss: 0.0808
Epoch 73/100
192/192 - 1s - 4ms/step - loss: 0.0462 - val_loss: 0.0800
Epoch 74/100
192/192 - 1s - 4ms/step - loss: 0.0458 - val_loss: 0.0794
Epoch 75/100
192/192 - 1s - 4ms/step - loss: 0.0457 - val_loss: 0.0799
Epoch 76/100
192/192 - 1s - 4ms/step - loss: 0.0453 - val_loss: 0.0795
Epoch 77/100
192/192 - 1s - 4ms/step - loss: 0.0448 - val_loss: 0.0805
Epoch 78/100
192/192 - 1s - 4ms/step - loss: 0.0446 - val_loss: 0.0785
Epoch 79/100
192/192 - 1s - 4ms/step - loss: 0.0439 - val_loss: 0.0798
Epoch 80/100
192/192 - 1s - 4ms/step - loss: 0.0437 - val_loss: 0.0807
Epoch 81/100
192/192 - 1s - 4ms/step - loss: 0.0441 - val_loss: 0.0795
Epoch 82/100
192/192 - 1s - 4ms/step - loss: 0.0434 - val_loss: 0.0810
Epoch 83/100
192/192 - 1s - 4ms/step - loss: 0.0429 - val_loss: 0.0801
Epoch 84/100
192/192 - 1s - 4ms/step - loss: 0.0430 - val_loss: 0.0818
Epoch 85/100
192/192 - 1s - 4ms/step - loss: 0.0424 - val_loss: 0.0800
Epoch 86/100
192/192 - 1s - 4ms/step - loss: 0.0422 - val_loss: 0.0812
Epoch 87/100
192/192 - 1s - 4ms/step - loss: 0.0419 - val_loss: 0.0807
Epoch 88/100
192/192 - 1s - 4ms/step - loss: 0.0420 - val_loss: 0.0808
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4740
Per-joint RMSE: 0.5251 0.7504 0.5093 0.3929 0.1899 0.2439
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:58:39.768085: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:58:39.792811: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 08:58:40.645808: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:58:40.650734: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:58:40.651528: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:58:40.653148: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:58:40.653943: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:58:40.654739: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:58:40.741578: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:58:40.742502: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:58:40.743246: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:58:40.743985: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8835 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:58:41.047041: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.758951e-01  RMSE=6.131028e-01
  per-joint RMSE: 0.7045 0.9968 0.6294 0.4485 0.2573 0.3195
Residual LSTM:  MSE=2.247067e-01      RMSE=4.740324e-01
  per-joint RMSE: 0.5251 0.7504 0.5093 0.3929 0.1899 0.2439
Combined torque MSE=2.247067e-01     RMSE=4.740323e-01
  per-joint RMSE: 0.5251 0.7504 0.5093 0.3929 0.1899 0.2439
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400.npz --H 50 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400.json
H=50, n_dof=6, feature_dim=6
X_train: (61400, 50, 6)  Y_train: (61400, 6)
X_test : (21969, 50, 6)  Y_test : (21969, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:58:43.570490: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:58:43.594675: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (61400, 50, 6), Y_train = (61400, 6)
  X_test  = (21969, 50, 6),  Y_test  = (21969, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:58:44.790489: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:58:44.795754: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:58:44.796670: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:58:44.798447: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:58:44.799354: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:58:44.800211: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:58:44.881673: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:58:44.882553: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:58:44.883342: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:58:44.884116: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8835 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:58:45.854795: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
192/192 - 2s - 11ms/step - loss: 0.6950 - val_loss: 0.7799
Epoch 2/100
192/192 - 1s - 4ms/step - loss: 0.3958 - val_loss: 0.5867
Epoch 3/100
192/192 - 1s - 4ms/step - loss: 0.2914 - val_loss: 0.4643
Epoch 4/100
192/192 - 1s - 4ms/step - loss: 0.2366 - val_loss: 0.4635
Epoch 5/100
192/192 - 1s - 4ms/step - loss: 0.2026 - val_loss: 0.4222
Epoch 6/100
192/192 - 1s - 4ms/step - loss: 0.1954 - val_loss: 0.4077
Epoch 7/100
192/192 - 1s - 4ms/step - loss: 0.1714 - val_loss: 0.4484
Epoch 8/100
192/192 - 1s - 4ms/step - loss: 0.1530 - val_loss: 0.3860
Epoch 9/100
192/192 - 1s - 4ms/step - loss: 0.1577 - val_loss: 0.4657
Epoch 10/100
192/192 - 1s - 4ms/step - loss: 0.1421 - val_loss: 0.4954
Epoch 11/100
192/192 - 1s - 4ms/step - loss: 0.1334 - val_loss: 0.4949
Epoch 12/100
192/192 - 1s - 4ms/step - loss: 0.1778 - val_loss: 0.3986
Epoch 13/100
192/192 - 1s - 4ms/step - loss: 0.1287 - val_loss: 0.4119
Epoch 14/100
192/192 - 1s - 4ms/step - loss: 0.1284 - val_loss: 0.4008
Epoch 15/100
192/192 - 1s - 4ms/step - loss: 0.1238 - val_loss: 0.3790
Epoch 16/100
192/192 - 1s - 4ms/step - loss: 0.1354 - val_loss: 0.3721
Epoch 17/100
192/192 - 1s - 4ms/step - loss: 0.1302 - val_loss: 0.3764
Epoch 18/100
192/192 - 1s - 4ms/step - loss: 0.1212 - val_loss: 0.3539
Epoch 19/100
192/192 - 1s - 4ms/step - loss: 0.1204 - val_loss: 0.3929
Epoch 20/100
192/192 - 1s - 4ms/step - loss: 0.1129 - val_loss: 0.3799
Epoch 21/100
192/192 - 1s - 4ms/step - loss: 0.1180 - val_loss: 0.3591
Epoch 22/100
192/192 - 1s - 4ms/step - loss: 0.1257 - val_loss: 0.3880
Epoch 23/100
192/192 - 1s - 4ms/step - loss: 0.1106 - val_loss: 0.3852
Epoch 24/100
192/192 - 1s - 4ms/step - loss: 0.1175 - val_loss: 0.3360
Epoch 25/100
192/192 - 1s - 4ms/step - loss: 0.1068 - val_loss: 0.3254
Epoch 26/100
192/192 - 1s - 4ms/step - loss: 0.1148 - val_loss: 0.3788
Epoch 27/100
192/192 - 1s - 4ms/step - loss: 0.1651 - val_loss: 0.4224
Epoch 28/100
192/192 - 1s - 4ms/step - loss: 0.1208 - val_loss: 0.4232
Epoch 29/100
192/192 - 1s - 4ms/step - loss: 0.1121 - val_loss: 0.4087
Epoch 30/100
192/192 - 1s - 4ms/step - loss: 0.1160 - val_loss: 0.3744
Epoch 31/100
192/192 - 1s - 4ms/step - loss: 0.1079 - val_loss: 0.4238
Epoch 32/100
192/192 - 1s - 4ms/step - loss: 0.1034 - val_loss: 0.4144
Epoch 33/100
192/192 - 1s - 4ms/step - loss: 0.1469 - val_loss: 0.4443
Epoch 34/100
192/192 - 1s - 4ms/step - loss: 0.1186 - val_loss: 0.4521
Epoch 35/100
192/192 - 1s - 4ms/step - loss: 0.0992 - val_loss: 0.4409
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5741
Per-joint RMSE: 0.7166 0.8618 0.6021 0.4488 0.2479 0.3098
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:59:13.730804: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:59:13.755711: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 08:59:14.624650: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:14.629454: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:14.630288: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:14.632008: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:14.632812: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:14.633556: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:14.710746: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:14.711583: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:14.712316: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:14.713052: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8835 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:59:15.010399: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.758951e-01  RMSE=6.131028e-01
  per-joint RMSE: 0.7045 0.9968 0.6294 0.4485 0.2573 0.3195
Residual LSTM:  MSE=3.296295e-01      RMSE=5.741337e-01
  per-joint RMSE: 0.7166 0.8618 0.6021 0.4488 0.2479 0.3098
Combined torque MSE=3.296295e-01     RMSE=5.741337e-01
  per-joint RMSE: 0.7166 0.8618 0.6021 0.4488 0.2479 0.3098
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400.npz --H 50 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400.json
H=50, n_dof=6, feature_dim=18
X_train: (61400, 50, 18)  Y_train: (61400, 6)
X_test : (21969, 50, 18)  Y_test : (21969, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:59:17.697309: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:59:17.720320: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (61400, 50, 18), Y_train = (61400, 6)
  X_test  = (21969, 50, 18),  Y_test  = (21969, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:59:19.137334: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:19.142195: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:19.143206: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:19.144950: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:19.145860: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:19.146711: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:19.243400: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:19.244376: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:19.245182: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:19.245974: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8834 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:59:20.323437: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
192/192 - 2s - 11ms/step - loss: 0.2785 - val_loss: 0.1786
Epoch 2/100
192/192 - 1s - 4ms/step - loss: 0.1811 - val_loss: 0.1681
Epoch 3/100
192/192 - 1s - 4ms/step - loss: 0.1594 - val_loss: 0.1639
Epoch 4/100
192/192 - 1s - 4ms/step - loss: 0.1454 - val_loss: 0.1552
Epoch 5/100
192/192 - 1s - 4ms/step - loss: 0.1325 - val_loss: 0.1507
Epoch 6/100
192/192 - 1s - 4ms/step - loss: 0.1251 - val_loss: 0.1498
Epoch 7/100
192/192 - 1s - 4ms/step - loss: 0.1207 - val_loss: 0.1489
Epoch 8/100
192/192 - 1s - 4ms/step - loss: 0.1160 - val_loss: 0.1431
Epoch 9/100
192/192 - 1s - 4ms/step - loss: 0.1111 - val_loss: 0.1434
Epoch 10/100
192/192 - 1s - 4ms/step - loss: 0.1084 - val_loss: 0.1427
Epoch 11/100
192/192 - 1s - 4ms/step - loss: 0.1053 - val_loss: 0.1410
Epoch 12/100
192/192 - 1s - 4ms/step - loss: 0.1033 - val_loss: 0.1390
Epoch 13/100
192/192 - 1s - 4ms/step - loss: 0.1012 - val_loss: 0.1391
Epoch 14/100
192/192 - 1s - 4ms/step - loss: 0.0998 - val_loss: 0.1370
Epoch 15/100
192/192 - 1s - 4ms/step - loss: 0.0964 - val_loss: 0.1347
Epoch 16/100
192/192 - 1s - 4ms/step - loss: 0.0961 - val_loss: 0.1336
Epoch 17/100
192/192 - 1s - 4ms/step - loss: 0.0949 - val_loss: 0.1318
Epoch 18/100
192/192 - 1s - 4ms/step - loss: 0.0929 - val_loss: 0.1339
Epoch 19/100
192/192 - 1s - 4ms/step - loss: 0.0906 - val_loss: 0.1326
Epoch 20/100
192/192 - 1s - 4ms/step - loss: 0.0905 - val_loss: 0.1332
Epoch 21/100
192/192 - 1s - 4ms/step - loss: 0.0874 - val_loss: 0.1320
Epoch 22/100
192/192 - 1s - 4ms/step - loss: 0.0869 - val_loss: 0.1291
Epoch 23/100
192/192 - 1s - 4ms/step - loss: 0.0861 - val_loss: 0.1276
Epoch 24/100
192/192 - 1s - 4ms/step - loss: 0.0857 - val_loss: 0.1289
Epoch 25/100
192/192 - 1s - 4ms/step - loss: 0.0847 - val_loss: 0.1287
Epoch 26/100
192/192 - 1s - 4ms/step - loss: 0.0843 - val_loss: 0.1303
Epoch 27/100
192/192 - 1s - 4ms/step - loss: 0.0829 - val_loss: 0.1298
Epoch 28/100
192/192 - 1s - 4ms/step - loss: 0.0799 - val_loss: 0.1260
Epoch 29/100
192/192 - 1s - 4ms/step - loss: 0.0811 - val_loss: 0.1262
Epoch 30/100
192/192 - 1s - 4ms/step - loss: 0.0789 - val_loss: 0.1274
Epoch 31/100
192/192 - 1s - 4ms/step - loss: 0.0770 - val_loss: 0.1294
Epoch 32/100
192/192 - 1s - 4ms/step - loss: 0.0771 - val_loss: 0.1294
Epoch 33/100
192/192 - 1s - 4ms/step - loss: 0.0761 - val_loss: 0.1278
Epoch 34/100
192/192 - 1s - 4ms/step - loss: 0.0786 - val_loss: 0.1322
Epoch 35/100
192/192 - 1s - 4ms/step - loss: 0.0777 - val_loss: 0.1296
Epoch 36/100
192/192 - 1s - 4ms/step - loss: 0.0751 - val_loss: 0.1327
Epoch 37/100
192/192 - 1s - 4ms/step - loss: 0.0744 - val_loss: 0.1331
Epoch 38/100
192/192 - 1s - 4ms/step - loss: 0.0748 - val_loss: 0.1286
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5611
Per-joint RMSE: 0.6793 0.8814 0.5880 0.4300 0.2173 0.2701
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:59:50.990164: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:59:51.014646: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 08:59:51.872772: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:51.877548: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:51.878362: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:51.880172: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:51.880969: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:51.881714: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:51.958033: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:51.958872: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:51.959619: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:51.960345: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8835 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 08:59:52.258266: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.758951e-01  RMSE=6.131028e-01
  per-joint RMSE: 0.7045 0.9968 0.6294 0.4485 0.2573 0.3195
Residual LSTM:  MSE=3.148491e-01      RMSE=5.611142e-01
  per-joint RMSE: 0.6793 0.8814 0.5880 0.4300 0.2173 0.2701
Combined torque MSE=3.148491e-01     RMSE=5.611142e-01
  per-joint RMSE: 0.6793 0.8814 0.5880 0.4300 0.2173 0.2701
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400.npz --H 50 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400.json
H=50, n_dof=6, feature_dim=18
X_train: (61400, 50, 18)  Y_train: (61400, 6)
X_test : (21969, 50, 18)  Y_test : (21969, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 08:59:54.880949: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 08:59:54.904447: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (61400, 50, 18), Y_train = (61400, 6)
  X_test  = (21969, 50, 18),  Y_test  = (21969, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 08:59:56.324315: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:56.328998: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:56.329900: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:56.331849: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:56.332745: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:56.333601: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:56.420590: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:56.421489: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:56.422297: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 08:59:56.423089: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8834 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 08:59:57.482419: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
192/192 - 2s - 11ms/step - loss: 0.2429 - val_loss: 0.1411
Epoch 2/100
192/192 - 1s - 4ms/step - loss: 0.1488 - val_loss: 0.1260
Epoch 3/100
192/192 - 1s - 4ms/step - loss: 0.1257 - val_loss: 0.1183
Epoch 4/100
192/192 - 1s - 4ms/step - loss: 0.1144 - val_loss: 0.1150
Epoch 5/100
192/192 - 1s - 4ms/step - loss: 0.1074 - val_loss: 0.1134
Epoch 6/100
192/192 - 1s - 4ms/step - loss: 0.1017 - val_loss: 0.1095
Epoch 7/100
192/192 - 1s - 4ms/step - loss: 0.0975 - val_loss: 0.1086
Epoch 8/100
192/192 - 1s - 4ms/step - loss: 0.0939 - val_loss: 0.1068
Epoch 9/100
192/192 - 1s - 4ms/step - loss: 0.0906 - val_loss: 0.1054
Epoch 10/100
192/192 - 1s - 4ms/step - loss: 0.0885 - val_loss: 0.1061
Epoch 11/100
192/192 - 1s - 4ms/step - loss: 0.0852 - val_loss: 0.1037
Epoch 12/100
192/192 - 1s - 4ms/step - loss: 0.0835 - val_loss: 0.1040
Epoch 13/100
192/192 - 1s - 4ms/step - loss: 0.0821 - val_loss: 0.1032
Epoch 14/100
192/192 - 1s - 4ms/step - loss: 0.0802 - val_loss: 0.1014
Epoch 15/100
192/192 - 1s - 4ms/step - loss: 0.0793 - val_loss: 0.1014
Epoch 16/100
192/192 - 1s - 4ms/step - loss: 0.0772 - val_loss: 0.1010
Epoch 17/100
192/192 - 1s - 4ms/step - loss: 0.0752 - val_loss: 0.1014
Epoch 18/100
192/192 - 1s - 4ms/step - loss: 0.0743 - val_loss: 0.0996
Epoch 19/100
192/192 - 1s - 4ms/step - loss: 0.0736 - val_loss: 0.0999
Epoch 20/100
192/192 - 1s - 4ms/step - loss: 0.0728 - val_loss: 0.1012
Epoch 21/100
192/192 - 1s - 4ms/step - loss: 0.0718 - val_loss: 0.0990
Epoch 22/100
192/192 - 1s - 4ms/step - loss: 0.0702 - val_loss: 0.0984
Epoch 23/100
192/192 - 1s - 4ms/step - loss: 0.0698 - val_loss: 0.0977
Epoch 24/100
192/192 - 1s - 4ms/step - loss: 0.0691 - val_loss: 0.0974
Epoch 25/100
192/192 - 1s - 4ms/step - loss: 0.0684 - val_loss: 0.0970
Epoch 26/100
192/192 - 1s - 4ms/step - loss: 0.0677 - val_loss: 0.0968
Epoch 27/100
192/192 - 1s - 4ms/step - loss: 0.0669 - val_loss: 0.0948
Epoch 28/100
192/192 - 1s - 4ms/step - loss: 0.0665 - val_loss: 0.0965
Epoch 29/100
192/192 - 1s - 4ms/step - loss: 0.0657 - val_loss: 0.0961
Epoch 30/100
192/192 - 1s - 4ms/step - loss: 0.0648 - val_loss: 0.0953
Epoch 31/100
192/192 - 1s - 4ms/step - loss: 0.0637 - val_loss: 0.0950
Epoch 32/100
192/192 - 1s - 4ms/step - loss: 0.0642 - val_loss: 0.0940
Epoch 33/100
192/192 - 1s - 4ms/step - loss: 0.0630 - val_loss: 0.0952
Epoch 34/100
192/192 - 1s - 4ms/step - loss: 0.0625 - val_loss: 0.0951
Epoch 35/100
192/192 - 1s - 4ms/step - loss: 0.0630 - val_loss: 0.0939
Epoch 36/100
192/192 - 1s - 4ms/step - loss: 0.0618 - val_loss: 0.0936
Epoch 37/100
192/192 - 1s - 4ms/step - loss: 0.0613 - val_loss: 0.0946
Epoch 38/100
192/192 - 1s - 4ms/step - loss: 0.0607 - val_loss: 0.0930
Epoch 39/100
192/192 - 1s - 4ms/step - loss: 0.0601 - val_loss: 0.0940
Epoch 40/100
192/192 - 1s - 4ms/step - loss: 0.0601 - val_loss: 0.0926
Epoch 41/100
192/192 - 1s - 4ms/step - loss: 0.0596 - val_loss: 0.0935
Epoch 42/100
192/192 - 1s - 4ms/step - loss: 0.0594 - val_loss: 0.0930
Epoch 43/100
192/192 - 1s - 4ms/step - loss: 0.0584 - val_loss: 0.0926
Epoch 44/100
192/192 - 1s - 4ms/step - loss: 0.0581 - val_loss: 0.0926
Epoch 45/100
192/192 - 1s - 4ms/step - loss: 0.0579 - val_loss: 0.0919
Epoch 46/100
192/192 - 1s - 4ms/step - loss: 0.0577 - val_loss: 0.0934
Epoch 47/100
192/192 - 1s - 4ms/step - loss: 0.0565 - val_loss: 0.0922
Epoch 48/100
192/192 - 1s - 4ms/step - loss: 0.0564 - val_loss: 0.0912
Epoch 49/100
192/192 - 1s - 4ms/step - loss: 0.0559 - val_loss: 0.0918
Epoch 50/100
192/192 - 1s - 4ms/step - loss: 0.0560 - val_loss: 0.0904
Epoch 51/100
192/192 - 1s - 4ms/step - loss: 0.0550 - val_loss: 0.0907
Epoch 52/100
192/192 - 1s - 4ms/step - loss: 0.0545 - val_loss: 0.0911
Epoch 53/100
192/192 - 1s - 4ms/step - loss: 0.0545 - val_loss: 0.0906
Epoch 54/100
192/192 - 1s - 4ms/step - loss: 0.0540 - val_loss: 0.0918
Epoch 55/100
192/192 - 1s - 4ms/step - loss: 0.0532 - val_loss: 0.0910
Epoch 56/100
192/192 - 1s - 4ms/step - loss: 0.0530 - val_loss: 0.0895
Epoch 57/100
192/192 - 1s - 4ms/step - loss: 0.0532 - val_loss: 0.0904
Epoch 58/100
192/192 - 1s - 4ms/step - loss: 0.0519 - val_loss: 0.0900
Epoch 59/100
192/192 - 1s - 4ms/step - loss: 0.0518 - val_loss: 0.0895
Epoch 60/100
192/192 - 1s - 4ms/step - loss: 0.0508 - val_loss: 0.0903
Epoch 61/100
192/192 - 1s - 4ms/step - loss: 0.0507 - val_loss: 0.0890
Epoch 62/100
192/192 - 1s - 4ms/step - loss: 0.0504 - val_loss: 0.0904
Epoch 63/100
192/192 - 1s - 4ms/step - loss: 0.0503 - val_loss: 0.0886
Epoch 64/100
192/192 - 1s - 4ms/step - loss: 0.0506 - val_loss: 0.0889
Epoch 65/100
192/192 - 1s - 4ms/step - loss: 0.0492 - val_loss: 0.0886
Epoch 66/100
192/192 - 1s - 4ms/step - loss: 0.0489 - val_loss: 0.0893
Epoch 67/100
192/192 - 1s - 4ms/step - loss: 0.0485 - val_loss: 0.0885
Epoch 68/100
192/192 - 1s - 4ms/step - loss: 0.0482 - val_loss: 0.0877
Epoch 69/100
192/192 - 1s - 4ms/step - loss: 0.0478 - val_loss: 0.0891
Epoch 70/100
192/192 - 1s - 4ms/step - loss: 0.0474 - val_loss: 0.0881
Epoch 71/100
192/192 - 1s - 4ms/step - loss: 0.0473 - val_loss: 0.0885
Epoch 72/100
192/192 - 1s - 4ms/step - loss: 0.0472 - val_loss: 0.0902
Epoch 73/100
192/192 - 1s - 4ms/step - loss: 0.0469 - val_loss: 0.0886
Epoch 74/100
192/192 - 1s - 4ms/step - loss: 0.0460 - val_loss: 0.0884
Epoch 75/100
192/192 - 1s - 4ms/step - loss: 0.0465 - val_loss: 0.0873
Epoch 76/100
192/192 - 1s - 4ms/step - loss: 0.0460 - val_loss: 0.0874
Epoch 77/100
192/192 - 1s - 4ms/step - loss: 0.0456 - val_loss: 0.0882
Epoch 78/100
192/192 - 1s - 4ms/step - loss: 0.0449 - val_loss: 0.0865
Epoch 79/100
192/192 - 1s - 4ms/step - loss: 0.0450 - val_loss: 0.0853
Epoch 80/100
192/192 - 1s - 4ms/step - loss: 0.0442 - val_loss: 0.0871
Epoch 81/100
192/192 - 1s - 4ms/step - loss: 0.0442 - val_loss: 0.0857
Epoch 82/100
192/192 - 1s - 4ms/step - loss: 0.0441 - val_loss: 0.0868
Epoch 83/100
192/192 - 1s - 4ms/step - loss: 0.0441 - val_loss: 0.0877
Epoch 84/100
192/192 - 1s - 4ms/step - loss: 0.0437 - val_loss: 0.0874
Epoch 85/100
192/192 - 1s - 4ms/step - loss: 0.0436 - val_loss: 0.0870
Epoch 86/100
192/192 - 1s - 4ms/step - loss: 0.0434 - val_loss: 0.0853
Epoch 87/100
192/192 - 1s - 4ms/step - loss: 0.0428 - val_loss: 0.0853
Epoch 88/100
192/192 - 1s - 4ms/step - loss: 0.0428 - val_loss: 0.0863
Epoch 89/100
192/192 - 1s - 4ms/step - loss: 0.0433 - val_loss: 0.0868
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4947
Per-joint RMSE: 0.5559 0.7963 0.5209 0.4100 0.1920 0.2218
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:01:06.571237: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:01:06.596479: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 09:01:07.449370: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:01:07.454107: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:01:07.454925: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:01:07.456503: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:01:07.457308: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:01:07.458052: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:01:07.534030: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:01:07.534876: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:01:07.535630: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:01:07.536357: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:01:07.834621: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.758951e-01  RMSE=6.131028e-01
  per-joint RMSE: 0.7045 0.9968 0.6294 0.4485 0.2573 0.3195
Residual LSTM:  MSE=2.447727e-01      RMSE=4.947451e-01
  per-joint RMSE: 0.5559 0.7963 0.5209 0.4100 0.1920 0.2218
Combined torque MSE=2.447727e-01     RMSE=4.947451e-01
  per-joint RMSE: 0.5559 0.7963 0.5209 0.4100 0.1920 0.2218
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=1                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz                                ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed0_dataset.npz -t structured -s 1 -r 0 --hp_preset fast_debug --epochs 400 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400.jax' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 400, 'lagrangian_type': <function structured_lagrangian_fn at 0x7d7fa41641f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed0_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed0_dataset.npz
   dt ≈ 0.02164581443156888
  dof = 6
  Train trajectories = 105
  Test trajectories  = 45
  Train samples = 64153
  Test samples  = 23070
################################################

2026-01-22 09:01:12.639958: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400 | type=structured | dof=6
################################################
2026-01-22 09:01:15.785942: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:01:15.785981: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:01:15.785987: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:01:15.786015: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:01:15.786020: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:01:15.786035: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:01:15.786072: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:01:15.786078: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:01:15.786094: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:01:15.786098: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.1s, Loss=9.32e+00, Inv=9.32e+00, For=1.27e+02, Power=1.68e+00
  [eval] test_mse=1.620e+00  (n=23070)
Epoch 00050: Time=  14.6s, Loss=2.76e+00, Inv=2.76e+00, For=8.49e+01, Power=1.00e+00
Epoch 00100: Time=  22.4s, Loss=2.48e+00, Inv=2.48e+00, For=1.01e+02, Power=9.18e-01
Epoch 00150: Time=  30.8s, Loss=2.38e+00, Inv=2.38e+00, For=1.08e+02, Power=8.98e-01
Epoch 00200: Time=  39.5s, Loss=2.31e+00, Inv=2.31e+00, For=1.05e+02, Power=8.78e-01
  [eval] test_mse=1.928e+00  (n=23070)
Epoch 00250: Time=  48.3s, Loss=2.27e+00, Inv=2.27e+00, For=1.14e+02, Power=8.57e-01
Epoch 00300: Time=  56.6s, Loss=2.23e+00, Inv=2.23e+00, For=1.26e+02, Power=8.51e-01
Epoch 00350: Time=  64.7s, Loss=2.21e+00, Inv=2.21e+00, For=1.50e+02, Power=8.38e-01
Epoch 00400: Time=  73.0s, Loss=2.19e+00, Inv=2.19e+00, For=1.72e+02, Power=8.35e-01
  [eval] test_mse=2.499e+00  (n=23070)
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400
Torque MSE  = 4.164e-01
Torque RMSE = 6.453e-01
Per-joint MSE : 8.474e-01 8.733e-01 5.052e-01 1.272e-01 6.487e-02 8.070e-02
Per-joint RMSE: 9.205e-01 9.345e-01 7.108e-01 3.566e-01 2.547e-01 2.841e-01
Comp Time per Sample = 1.474e-08s / 67863320.8Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed0_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed0_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400.jax
Detected n_dof=6 (seed=1)
2026-01-22 09:02:30.943975: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 105 trajectories
2026-01-22 09:02:32.282803: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:02:32.282815: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:02:33.869414: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:02:33.869428: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:02:35.361760: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/105
2026-01-22 09:02:37.802779: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 50/105
2026-01-22 09:02:39.045994: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:02:40.348305: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 75/105
  done 100/105
  done 105/105

Exporting split=test: 45 trajectories
  done 25/45
  done 45/45

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400.npz --H 25 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400.json
H=25, n_dof=6, feature_dim=24
X_train: (62725, 25, 24)  Y_train: (62725, 6)
X_test : (22494, 25, 24)  Y_test : (22494, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:02:42.639938: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:02:42.663577: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (62725, 25, 24), Y_train = (62725, 6)
  X_test  = (22494, 25, 24),  Y_test  = (22494, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:02:43.940106: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:02:43.945115: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:02:43.946049: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:02:43.947792: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:02:43.948604: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:02:43.949469: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:02:44.038958: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:02:44.039932: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:02:44.040736: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:02:44.041527: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:02:45.115186: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
197/197 - 2s - 9ms/step - loss: 0.2421 - val_loss: 0.2221
Epoch 2/100
197/197 - 1s - 3ms/step - loss: 0.1494 - val_loss: 0.1619
Epoch 3/100
197/197 - 1s - 3ms/step - loss: 0.1275 - val_loss: 0.1516
Epoch 4/100
197/197 - 1s - 3ms/step - loss: 0.1148 - val_loss: 0.1434
Epoch 5/100
197/197 - 1s - 3ms/step - loss: 0.1172 - val_loss: 0.1404
Epoch 6/100
197/197 - 1s - 3ms/step - loss: 0.1099 - val_loss: 0.1359
Epoch 7/100
197/197 - 1s - 3ms/step - loss: 0.1059 - val_loss: 0.1305
Epoch 8/100
197/197 - 1s - 3ms/step - loss: 0.0984 - val_loss: 0.1233
Epoch 9/100
197/197 - 1s - 3ms/step - loss: 0.0922 - val_loss: 0.1235
Epoch 10/100
197/197 - 1s - 3ms/step - loss: 0.0900 - val_loss: 0.1192
Epoch 11/100
197/197 - 1s - 3ms/step - loss: 0.0869 - val_loss: 0.1190
Epoch 12/100
197/197 - 1s - 3ms/step - loss: 0.0848 - val_loss: 0.1180
Epoch 13/100
197/197 - 1s - 3ms/step - loss: 0.0832 - val_loss: 0.1173
Epoch 14/100
197/197 - 1s - 3ms/step - loss: 0.0812 - val_loss: 0.1169
Epoch 15/100
197/197 - 1s - 3ms/step - loss: 0.0794 - val_loss: 0.1134
Epoch 16/100
197/197 - 0s - 3ms/step - loss: 0.0779 - val_loss: 0.1146
Epoch 17/100
197/197 - 1s - 3ms/step - loss: 0.0772 - val_loss: 0.1149
Epoch 18/100
197/197 - 1s - 3ms/step - loss: 0.0756 - val_loss: 0.1138
Epoch 19/100
197/197 - 1s - 3ms/step - loss: 0.0742 - val_loss: 0.1127
Epoch 20/100
197/197 - 1s - 3ms/step - loss: 0.0728 - val_loss: 0.1143
Epoch 21/100
197/197 - 1s - 3ms/step - loss: 0.0723 - val_loss: 0.1140
Epoch 22/100
197/197 - 1s - 3ms/step - loss: 0.0715 - val_loss: 0.1110
Epoch 23/100
197/197 - 1s - 3ms/step - loss: 0.0707 - val_loss: 0.1117
Epoch 24/100
197/197 - 0s - 2ms/step - loss: 0.0694 - val_loss: 0.1116
Epoch 25/100
197/197 - 1s - 3ms/step - loss: 0.0700 - val_loss: 0.1092
Epoch 26/100
197/197 - 0s - 3ms/step - loss: 0.0684 - val_loss: 0.1122
Epoch 27/100
197/197 - 1s - 3ms/step - loss: 0.0669 - val_loss: 0.1114
Epoch 28/100
197/197 - 0s - 3ms/step - loss: 0.0666 - val_loss: 0.1106
Epoch 29/100
197/197 - 1s - 3ms/step - loss: 0.0658 - val_loss: 0.1109
Epoch 30/100
197/197 - 1s - 3ms/step - loss: 0.0651 - val_loss: 0.1113
Epoch 31/100
197/197 - 1s - 3ms/step - loss: 0.0650 - val_loss: 0.1121
Epoch 32/100
197/197 - 1s - 3ms/step - loss: 0.0643 - val_loss: 0.1116
Epoch 33/100
197/197 - 1s - 3ms/step - loss: 0.0639 - val_loss: 0.1083
Epoch 34/100
197/197 - 1s - 3ms/step - loss: 0.0625 - val_loss: 0.1104
Epoch 35/100
197/197 - 1s - 3ms/step - loss: 0.0629 - val_loss: 0.1076
Epoch 36/100
197/197 - 1s - 3ms/step - loss: 0.0618 - val_loss: 0.1117
Epoch 37/100
197/197 - 0s - 3ms/step - loss: 0.0618 - val_loss: 0.1120
Epoch 38/100
197/197 - 1s - 3ms/step - loss: 0.0608 - val_loss: 0.1104
Epoch 39/100
197/197 - 1s - 3ms/step - loss: 0.0603 - val_loss: 0.1101
Epoch 40/100
197/197 - 1s - 3ms/step - loss: 0.0604 - val_loss: 0.1106
Epoch 41/100
197/197 - 1s - 3ms/step - loss: 0.0597 - val_loss: 0.1101
Epoch 42/100
197/197 - 1s - 3ms/step - loss: 0.0595 - val_loss: 0.1106
Epoch 43/100
197/197 - 1s - 3ms/step - loss: 0.0588 - val_loss: 0.1091
Epoch 44/100
197/197 - 1s - 3ms/step - loss: 0.0585 - val_loss: 0.1083
Epoch 45/100
197/197 - 0s - 3ms/step - loss: 0.0575 - val_loss: 0.1095
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5232
Per-joint RMSE: 0.7692 0.7179 0.6033 0.3154 0.1949 0.1840
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:03:09.761179: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:03:09.786682: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 09:03:10.649933: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:10.654583: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:10.655385: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:10.657150: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:10.657941: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:10.658736: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:10.735987: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:10.736918: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:10.737715: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:10.738447: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:03:11.036054: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.239002e-01  RMSE=6.510761e-01
  per-joint RMSE: 0.9304 0.9418 0.7172 0.3598 0.2552 0.2860
Residual LSTM:  MSE=2.737528e-01      RMSE=5.232139e-01
  per-joint RMSE: 0.7692 0.7179 0.6033 0.3154 0.1949 0.1840
Combined torque MSE=2.737528e-01     RMSE=5.232139e-01
  per-joint RMSE: 0.7692 0.7179 0.6033 0.3154 0.1949 0.1840
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400.npz --H 25 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400.json
H=25, n_dof=6, feature_dim=6
X_train: (62725, 25, 6)  Y_train: (62725, 6)
X_test : (22494, 25, 6)  Y_test : (22494, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:03:13.487887: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:03:13.512438: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (62725, 25, 6), Y_train = (62725, 6)
  X_test  = (22494, 25, 6),  Y_test  = (22494, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:03:14.565417: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:14.570045: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:14.570921: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:14.572609: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:14.573410: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:14.574143: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:14.654208: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:14.655044: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:14.655884: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:14.656621: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:03:15.608158: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
197/197 - 2s - 9ms/step - loss: 0.7516 - val_loss: 0.6892
Epoch 2/100
197/197 - 1s - 3ms/step - loss: 0.5669 - val_loss: 0.5970
Epoch 3/100
197/197 - 1s - 3ms/step - loss: 0.4517 - val_loss: 0.4872
Epoch 4/100
197/197 - 1s - 3ms/step - loss: 0.3681 - val_loss: 0.4988
Epoch 5/100
197/197 - 1s - 3ms/step - loss: 0.2885 - val_loss: 0.4628
Epoch 6/100
197/197 - 1s - 3ms/step - loss: 0.2858 - val_loss: 0.4454
Epoch 7/100
197/197 - 1s - 3ms/step - loss: 0.2381 - val_loss: 0.4303
Epoch 8/100
197/197 - 1s - 3ms/step - loss: 0.2208 - val_loss: 0.3746
Epoch 9/100
197/197 - 1s - 3ms/step - loss: 0.2114 - val_loss: 0.3693
Epoch 10/100
197/197 - 1s - 3ms/step - loss: 0.1945 - val_loss: 0.3690
Epoch 11/100
197/197 - 0s - 3ms/step - loss: 0.1779 - val_loss: 0.3746
Epoch 12/100
197/197 - 1s - 3ms/step - loss: 0.1592 - val_loss: 0.3367
Epoch 13/100
197/197 - 0s - 2ms/step - loss: 0.1575 - val_loss: 0.3389
Epoch 14/100
197/197 - 1s - 3ms/step - loss: 0.1601 - val_loss: 0.3243
Epoch 15/100
197/197 - 1s - 3ms/step - loss: 0.1411 - val_loss: 0.3324
Epoch 16/100
197/197 - 1s - 3ms/step - loss: 0.1367 - val_loss: 0.3354
Epoch 17/100
197/197 - 1s - 3ms/step - loss: 0.1372 - val_loss: 0.3219
Epoch 18/100
197/197 - 1s - 3ms/step - loss: 0.1426 - val_loss: 0.3196
Epoch 19/100
197/197 - 1s - 3ms/step - loss: 0.1279 - val_loss: 0.3364
Epoch 20/100
197/197 - 1s - 3ms/step - loss: 0.1283 - val_loss: 0.3217
Epoch 21/100
197/197 - 1s - 3ms/step - loss: 0.1331 - val_loss: 0.3443
Epoch 22/100
197/197 - 0s - 3ms/step - loss: 0.1210 - val_loss: 0.3366
Epoch 23/100
197/197 - 0s - 2ms/step - loss: 0.1246 - val_loss: 0.3572
Epoch 24/100
197/197 - 0s - 2ms/step - loss: 0.1323 - val_loss: 0.3262
Epoch 25/100
197/197 - 0s - 3ms/step - loss: 0.1348 - val_loss: 0.3263
Epoch 26/100
197/197 - 0s - 3ms/step - loss: 0.1147 - val_loss: 0.3206
Epoch 27/100
197/197 - 1s - 3ms/step - loss: 0.1171 - val_loss: 0.3397
Epoch 28/100
197/197 - 0s - 2ms/step - loss: 0.1188 - val_loss: 0.3314
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5923
Per-joint RMSE: 0.8698 0.7843 0.6816 0.3642 0.2391 0.2809
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:03:31.489493: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:03:31.513900: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 09:03:32.374454: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:32.379241: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:32.380034: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:32.381641: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:32.382442: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:32.383181: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:32.463235: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:32.464080: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:32.464832: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:32.465574: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:03:32.764661: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.239002e-01  RMSE=6.510761e-01
  per-joint RMSE: 0.9304 0.9418 0.7172 0.3598 0.2552 0.2860
Residual LSTM:  MSE=3.508671e-01      RMSE=5.923404e-01
  per-joint RMSE: 0.8698 0.7843 0.6816 0.3642 0.2391 0.2809
Combined torque MSE=3.508671e-01     RMSE=5.923404e-01
  per-joint RMSE: 0.8698 0.7843 0.6816 0.3642 0.2391 0.2809
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400.npz --H 25 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400.json
H=25, n_dof=6, feature_dim=18
X_train: (62725, 25, 18)  Y_train: (62725, 6)
X_test : (22494, 25, 18)  Y_test : (22494, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:03:35.266309: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:03:35.290253: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (62725, 25, 18), Y_train = (62725, 6)
  X_test  = (22494, 25, 18),  Y_test  = (22494, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:03:36.465417: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:36.470087: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:36.471000: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:36.472587: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:36.473491: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:36.474343: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:36.560337: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:36.561229: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:36.562038: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:03:36.562822: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:03:37.568944: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
197/197 - 2s - 10ms/step - loss: 0.2800 - val_loss: 0.2377
Epoch 2/100
197/197 - 1s - 3ms/step - loss: 0.1818 - val_loss: 0.2012
Epoch 3/100
197/197 - 1s - 3ms/step - loss: 0.1588 - val_loss: 0.1782
Epoch 4/100
197/197 - 1s - 3ms/step - loss: 0.1458 - val_loss: 0.1774
Epoch 5/100
197/197 - 1s - 3ms/step - loss: 0.1375 - val_loss: 0.1783
Epoch 6/100
197/197 - 1s - 3ms/step - loss: 0.1350 - val_loss: 0.1741
Epoch 7/100
197/197 - 1s - 3ms/step - loss: 0.1244 - val_loss: 0.1667
Epoch 8/100
197/197 - 1s - 3ms/step - loss: 0.1244 - val_loss: 0.1680
Epoch 9/100
197/197 - 1s - 3ms/step - loss: 0.1249 - val_loss: 0.1667
Epoch 10/100
197/197 - 1s - 3ms/step - loss: 0.1247 - val_loss: 0.1680
Epoch 11/100
197/197 - 1s - 3ms/step - loss: 0.1192 - val_loss: 0.1673
Epoch 12/100
197/197 - 1s - 3ms/step - loss: 0.1117 - val_loss: 0.1616
Epoch 13/100
197/197 - 1s - 3ms/step - loss: 0.1076 - val_loss: 0.1558
Epoch 14/100
197/197 - 1s - 3ms/step - loss: 0.1067 - val_loss: 0.1570
Epoch 15/100
197/197 - 0s - 3ms/step - loss: 0.1038 - val_loss: 0.1566
Epoch 16/100
197/197 - 1s - 3ms/step - loss: 0.1029 - val_loss: 0.1523
Epoch 17/100
197/197 - 1s - 3ms/step - loss: 0.1014 - val_loss: 0.1513
Epoch 18/100
197/197 - 1s - 3ms/step - loss: 0.0991 - val_loss: 0.1533
Epoch 19/100
197/197 - 1s - 3ms/step - loss: 0.1005 - val_loss: 0.1516
Epoch 20/100
197/197 - 1s - 3ms/step - loss: 0.0957 - val_loss: 0.1513
Epoch 21/100
197/197 - 0s - 3ms/step - loss: 0.0948 - val_loss: 0.1529
Epoch 22/100
197/197 - 1s - 3ms/step - loss: 0.0936 - val_loss: 0.1507
Epoch 23/100
197/197 - 1s - 3ms/step - loss: 0.0922 - val_loss: 0.1485
Epoch 24/100
197/197 - 1s - 3ms/step - loss: 0.0895 - val_loss: 0.1501
Epoch 25/100
197/197 - 0s - 3ms/step - loss: 0.0896 - val_loss: 0.1485
Epoch 26/100
197/197 - 1s - 3ms/step - loss: 0.0929 - val_loss: 0.1431
Epoch 27/100
197/197 - 0s - 3ms/step - loss: 0.0887 - val_loss: 0.1452
Epoch 28/100
197/197 - 1s - 3ms/step - loss: 0.0878 - val_loss: 0.1461
Epoch 29/100
197/197 - 1s - 3ms/step - loss: 0.0870 - val_loss: 0.1430
Epoch 30/100
197/197 - 1s - 3ms/step - loss: 0.0854 - val_loss: 0.1424
Epoch 31/100
197/197 - 1s - 3ms/step - loss: 0.0855 - val_loss: 0.1419
Epoch 32/100
197/197 - 0s - 3ms/step - loss: 0.0858 - val_loss: 0.1430
Epoch 33/100
197/197 - 0s - 3ms/step - loss: 0.0840 - val_loss: 0.1436
Epoch 34/100
197/197 - 1s - 3ms/step - loss: 0.0842 - val_loss: 0.1419
Epoch 35/100
197/197 - 1s - 3ms/step - loss: 0.0835 - val_loss: 0.1397
Epoch 36/100
197/197 - 1s - 3ms/step - loss: 0.0811 - val_loss: 0.1426
Epoch 37/100
197/197 - 1s - 3ms/step - loss: 0.0768 - val_loss: 0.1446
Epoch 38/100
197/197 - 1s - 3ms/step - loss: 0.0746 - val_loss: 0.1397
Epoch 39/100
197/197 - 1s - 3ms/step - loss: 0.0739 - val_loss: 0.1407
Epoch 40/100
197/197 - 1s - 3ms/step - loss: 0.0734 - val_loss: 0.1424
Epoch 41/100
197/197 - 1s - 3ms/step - loss: 0.0729 - val_loss: 0.1439
Epoch 42/100
197/197 - 0s - 3ms/step - loss: 0.0721 - val_loss: 0.1414
Epoch 43/100
197/197 - 0s - 3ms/step - loss: 0.0705 - val_loss: 0.1443
Epoch 44/100
197/197 - 0s - 3ms/step - loss: 0.0711 - val_loss: 0.1427
Epoch 45/100
197/197 - 1s - 3ms/step - loss: 0.0703 - val_loss: 0.1405
Epoch 46/100
197/197 - 1s - 3ms/step - loss: 0.0695 - val_loss: 0.1441
Epoch 47/100
197/197 - 1s - 3ms/step - loss: 0.0688 - val_loss: 0.1408
Epoch 48/100
197/197 - 1s - 3ms/step - loss: 0.0690 - val_loss: 0.1415
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5970
Per-joint RMSE: 0.8983 0.8184 0.6750 0.3214 0.2216 0.2309
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:04:03.857329: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:04:03.883499: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 09:04:04.765310: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:04.770150: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:04.771038: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:04.772786: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:04.773590: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:04.774321: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:04.853328: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:04.854257: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:04.855084: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:04.855895: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:04:05.155903: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.239002e-01  RMSE=6.510761e-01
  per-joint RMSE: 0.9304 0.9418 0.7172 0.3598 0.2552 0.2860
Residual LSTM:  MSE=3.563625e-01      RMSE=5.969611e-01
  per-joint RMSE: 0.8983 0.8184 0.6750 0.3214 0.2216 0.2309
Combined torque MSE=3.563625e-01     RMSE=5.969611e-01
  per-joint RMSE: 0.8983 0.8184 0.6750 0.3214 0.2216 0.2309
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400.npz --H 25 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400.json
H=25, n_dof=6, feature_dim=18
X_train: (62725, 25, 18)  Y_train: (62725, 6)
X_test : (22494, 25, 18)  Y_test : (22494, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:04:07.655535: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:04:07.680299: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (62725, 25, 18), Y_train = (62725, 6)
  X_test  = (22494, 25, 18),  Y_test  = (22494, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:04:08.853085: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:08.857852: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:08.858769: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:08.860428: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:08.861344: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:08.862200: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:08.949850: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:08.950756: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:08.951650: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:08.952434: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:04:09.937417: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
197/197 - 2s - 10ms/step - loss: 0.2441 - val_loss: 0.1856
Epoch 2/100
197/197 - 1s - 3ms/step - loss: 0.1526 - val_loss: 0.1683
Epoch 3/100
197/197 - 1s - 3ms/step - loss: 0.1285 - val_loss: 0.1587
Epoch 4/100
197/197 - 0s - 3ms/step - loss: 0.1165 - val_loss: 0.1477
Epoch 5/100
197/197 - 0s - 3ms/step - loss: 0.1081 - val_loss: 0.1454
Epoch 6/100
197/197 - 1s - 3ms/step - loss: 0.1027 - val_loss: 0.1421
Epoch 7/100
197/197 - 1s - 3ms/step - loss: 0.0978 - val_loss: 0.1377
Epoch 8/100
197/197 - 0s - 3ms/step - loss: 0.0946 - val_loss: 0.1372
Epoch 9/100
197/197 - 1s - 3ms/step - loss: 0.0911 - val_loss: 0.1332
Epoch 10/100
197/197 - 1s - 3ms/step - loss: 0.0897 - val_loss: 0.1330
Epoch 11/100
197/197 - 1s - 3ms/step - loss: 0.0861 - val_loss: 0.1320
Epoch 12/100
197/197 - 1s - 3ms/step - loss: 0.0843 - val_loss: 0.1296
Epoch 13/100
197/197 - 0s - 3ms/step - loss: 0.0830 - val_loss: 0.1273
Epoch 14/100
197/197 - 0s - 3ms/step - loss: 0.0816 - val_loss: 0.1271
Epoch 15/100
197/197 - 1s - 3ms/step - loss: 0.0791 - val_loss: 0.1253
Epoch 16/100
197/197 - 0s - 2ms/step - loss: 0.0779 - val_loss: 0.1263
Epoch 17/100
197/197 - 1s - 3ms/step - loss: 0.0766 - val_loss: 0.1233
Epoch 18/100
197/197 - 0s - 3ms/step - loss: 0.0752 - val_loss: 0.1243
Epoch 19/100
197/197 - 1s - 3ms/step - loss: 0.0738 - val_loss: 0.1221
Epoch 20/100
197/197 - 1s - 3ms/step - loss: 0.0727 - val_loss: 0.1199
Epoch 21/100
197/197 - 1s - 3ms/step - loss: 0.0723 - val_loss: 0.1225
Epoch 22/100
197/197 - 0s - 2ms/step - loss: 0.0708 - val_loss: 0.1212
Epoch 23/100
197/197 - 1s - 3ms/step - loss: 0.0701 - val_loss: 0.1191
Epoch 24/100
197/197 - 1s - 3ms/step - loss: 0.0693 - val_loss: 0.1185
Epoch 25/100
197/197 - 1s - 3ms/step - loss: 0.0682 - val_loss: 0.1160
Epoch 26/100
197/197 - 0s - 2ms/step - loss: 0.0672 - val_loss: 0.1169
Epoch 27/100
197/197 - 1s - 3ms/step - loss: 0.0679 - val_loss: 0.1177
Epoch 28/100
197/197 - 1s - 3ms/step - loss: 0.0663 - val_loss: 0.1185
Epoch 29/100
197/197 - 1s - 3ms/step - loss: 0.0658 - val_loss: 0.1154
Epoch 30/100
197/197 - 0s - 3ms/step - loss: 0.0651 - val_loss: 0.1161
Epoch 31/100
197/197 - 1s - 3ms/step - loss: 0.0645 - val_loss: 0.1153
Epoch 32/100
197/197 - 1s - 3ms/step - loss: 0.0639 - val_loss: 0.1136
Epoch 33/100
197/197 - 1s - 3ms/step - loss: 0.0636 - val_loss: 0.1155
Epoch 34/100
197/197 - 0s - 2ms/step - loss: 0.0633 - val_loss: 0.1140
Epoch 35/100
197/197 - 1s - 3ms/step - loss: 0.0622 - val_loss: 0.1153
Epoch 36/100
197/197 - 0s - 3ms/step - loss: 0.0621 - val_loss: 0.1147
Epoch 37/100
197/197 - 0s - 3ms/step - loss: 0.0611 - val_loss: 0.1155
Epoch 38/100
197/197 - 0s - 3ms/step - loss: 0.0611 - val_loss: 0.1136
Epoch 39/100
197/197 - 1s - 3ms/step - loss: 0.0602 - val_loss: 0.1159
Epoch 40/100
197/197 - 1s - 3ms/step - loss: 0.0599 - val_loss: 0.1149
Epoch 41/100
197/197 - 0s - 3ms/step - loss: 0.0594 - val_loss: 0.1168
Epoch 42/100
197/197 - 1s - 3ms/step - loss: 0.0591 - val_loss: 0.1153
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5428
Per-joint RMSE: 0.7758 0.7881 0.6074 0.3172 0.1949 0.1922
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:04:32.869825: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:04:32.894516: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 09:04:33.756926: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:33.761492: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:33.762424: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:33.764241: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:33.765032: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:33.765774: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:33.844069: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:33.844912: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:33.845655: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:33.846390: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:04:34.157405: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.239002e-01  RMSE=6.510761e-01
  per-joint RMSE: 0.9304 0.9418 0.7172 0.3598 0.2552 0.2860
Residual LSTM:  MSE=2.945789e-01      RMSE=5.427513e-01
  per-joint RMSE: 0.7758 0.7881 0.6074 0.3172 0.1949 0.1922
Combined torque MSE=2.945789e-01     RMSE=5.427513e-01
  per-joint RMSE: 0.7758 0.7881 0.6074 0.3172 0.1949 0.1922
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400.npz --H 50 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400.json
H=50, n_dof=6, feature_dim=24
X_train: (61400, 50, 24)  Y_train: (61400, 6)
X_test : (21969, 50, 24)  Y_test : (21969, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:04:36.876811: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:04:36.901149: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (61400, 50, 24), Y_train = (61400, 6)
  X_test  = (21969, 50, 24),  Y_test  = (21969, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:04:38.747319: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:38.752278: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:38.753210: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:38.755185: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:38.756119: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:38.757010: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:38.842532: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:38.843429: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:38.844225: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:04:38.845019: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:04:40.123839: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
192/192 - 2s - 11ms/step - loss: 0.2428 - val_loss: 0.1413
Epoch 2/100
192/192 - 1s - 4ms/step - loss: 0.1467 - val_loss: 0.1220
Epoch 3/100
192/192 - 1s - 4ms/step - loss: 0.1272 - val_loss: 0.1138
Epoch 4/100
192/192 - 1s - 4ms/step - loss: 0.1162 - val_loss: 0.1093
Epoch 5/100
192/192 - 1s - 4ms/step - loss: 0.1072 - val_loss: 0.1045
Epoch 6/100
192/192 - 1s - 4ms/step - loss: 0.1016 - val_loss: 0.1031
Epoch 7/100
192/192 - 1s - 4ms/step - loss: 0.0963 - val_loss: 0.0993
Epoch 8/100
192/192 - 1s - 4ms/step - loss: 0.0937 - val_loss: 0.1027
Epoch 9/100
192/192 - 1s - 4ms/step - loss: 0.0903 - val_loss: 0.0974
Epoch 10/100
192/192 - 1s - 4ms/step - loss: 0.0873 - val_loss: 0.0977
Epoch 11/100
192/192 - 1s - 4ms/step - loss: 0.0854 - val_loss: 0.0987
Epoch 12/100
192/192 - 1s - 4ms/step - loss: 0.0826 - val_loss: 0.0947
Epoch 13/100
192/192 - 1s - 4ms/step - loss: 0.0816 - val_loss: 0.0936
Epoch 14/100
192/192 - 1s - 4ms/step - loss: 0.0794 - val_loss: 0.0937
Epoch 15/100
192/192 - 1s - 4ms/step - loss: 0.0774 - val_loss: 0.0927
Epoch 16/100
192/192 - 1s - 4ms/step - loss: 0.0767 - val_loss: 0.0923
Epoch 17/100
192/192 - 1s - 4ms/step - loss: 0.0754 - val_loss: 0.0915
Epoch 18/100
192/192 - 1s - 4ms/step - loss: 0.0745 - val_loss: 0.0917
Epoch 19/100
192/192 - 1s - 4ms/step - loss: 0.0736 - val_loss: 0.0910
Epoch 20/100
192/192 - 1s - 4ms/step - loss: 0.0719 - val_loss: 0.0895
Epoch 21/100
192/192 - 1s - 4ms/step - loss: 0.0712 - val_loss: 0.0902
Epoch 22/100
192/192 - 1s - 4ms/step - loss: 0.0700 - val_loss: 0.0893
Epoch 23/100
192/192 - 1s - 4ms/step - loss: 0.0696 - val_loss: 0.0870
Epoch 24/100
192/192 - 1s - 4ms/step - loss: 0.0687 - val_loss: 0.0871
Epoch 25/100
192/192 - 1s - 4ms/step - loss: 0.0680 - val_loss: 0.0865
Epoch 26/100
192/192 - 1s - 4ms/step - loss: 0.0670 - val_loss: 0.0871
Epoch 27/100
192/192 - 1s - 4ms/step - loss: 0.0665 - val_loss: 0.0868
Epoch 28/100
192/192 - 1s - 4ms/step - loss: 0.0659 - val_loss: 0.0864
Epoch 29/100
192/192 - 1s - 4ms/step - loss: 0.0648 - val_loss: 0.0852
Epoch 30/100
192/192 - 1s - 4ms/step - loss: 0.0646 - val_loss: 0.0859
Epoch 31/100
192/192 - 1s - 4ms/step - loss: 0.0636 - val_loss: 0.0851
Epoch 32/100
192/192 - 1s - 4ms/step - loss: 0.0655 - val_loss: 0.0851
Epoch 33/100
192/192 - 1s - 4ms/step - loss: 0.0636 - val_loss: 0.0845
Epoch 34/100
192/192 - 1s - 4ms/step - loss: 0.0624 - val_loss: 0.0850
Epoch 35/100
192/192 - 1s - 4ms/step - loss: 0.0627 - val_loss: 0.0836
Epoch 36/100
192/192 - 1s - 4ms/step - loss: 0.0617 - val_loss: 0.0845
Epoch 37/100
192/192 - 1s - 4ms/step - loss: 0.0613 - val_loss: 0.0841
Epoch 38/100
192/192 - 1s - 4ms/step - loss: 0.0604 - val_loss: 0.0848
Epoch 39/100
192/192 - 1s - 4ms/step - loss: 0.0601 - val_loss: 0.0836
Epoch 40/100
192/192 - 1s - 4ms/step - loss: 0.0594 - val_loss: 0.0823
Epoch 41/100
192/192 - 1s - 4ms/step - loss: 0.0589 - val_loss: 0.0840
Epoch 42/100
192/192 - 1s - 4ms/step - loss: 0.0586 - val_loss: 0.0821
Epoch 43/100
192/192 - 1s - 4ms/step - loss: 0.0593 - val_loss: 0.0831
Epoch 44/100
192/192 - 1s - 4ms/step - loss: 0.0587 - val_loss: 0.0832
Epoch 45/100
192/192 - 1s - 4ms/step - loss: 0.0578 - val_loss: 0.0826
Epoch 46/100
192/192 - 1s - 4ms/step - loss: 0.0574 - val_loss: 0.0835
Epoch 47/100
192/192 - 1s - 4ms/step - loss: 0.0568 - val_loss: 0.0799
Epoch 48/100
192/192 - 1s - 4ms/step - loss: 0.0564 - val_loss: 0.0817
Epoch 49/100
192/192 - 1s - 4ms/step - loss: 0.0560 - val_loss: 0.0815
Epoch 50/100
192/192 - 1s - 4ms/step - loss: 0.0560 - val_loss: 0.0822
Epoch 51/100
192/192 - 1s - 4ms/step - loss: 0.0554 - val_loss: 0.0814
Epoch 52/100
192/192 - 1s - 4ms/step - loss: 0.0543 - val_loss: 0.0829
Epoch 53/100
192/192 - 1s - 4ms/step - loss: 0.0547 - val_loss: 0.0821
Epoch 54/100
192/192 - 1s - 4ms/step - loss: 0.0539 - val_loss: 0.0820
Epoch 55/100
192/192 - 1s - 4ms/step - loss: 0.0537 - val_loss: 0.0811
Epoch 56/100
192/192 - 1s - 4ms/step - loss: 0.0534 - val_loss: 0.0809
Epoch 57/100
192/192 - 1s - 4ms/step - loss: 0.0525 - val_loss: 0.0804
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5130
Per-joint RMSE: 0.7677 0.7080 0.5578 0.3142 0.1969 0.1987
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:05:25.300142: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:05:25.325196: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 09:05:26.190375: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:26.195468: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:26.196333: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:26.198105: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:26.198896: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:26.199628: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:26.286420: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:26.287510: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:26.288337: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:26.289065: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:05:26.596709: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.309373e-01  RMSE=6.564582e-01
  per-joint RMSE: 0.9398 0.9488 0.7233 0.3625 0.2546 0.2877
Residual LSTM:  MSE=2.631234e-01      RMSE=5.129555e-01
  per-joint RMSE: 0.7677 0.7080 0.5578 0.3142 0.1969 0.1987
Combined torque MSE=2.631234e-01     RMSE=5.129555e-01
  per-joint RMSE: 0.7677 0.7080 0.5578 0.3142 0.1969 0.1987
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400.npz --H 50 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400.json
H=50, n_dof=6, feature_dim=6
X_train: (61400, 50, 6)  Y_train: (61400, 6)
X_test : (21969, 50, 6)  Y_test : (21969, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:05:29.108068: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:05:29.132380: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (61400, 50, 6), Y_train = (61400, 6)
  X_test  = (21969, 50, 6),  Y_test  = (21969, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:05:30.300117: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:30.304763: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:30.305556: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:30.307068: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:30.307862: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:30.308597: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:30.388202: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:30.389051: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:30.389793: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:30.390531: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:05:31.339995: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
192/192 - 2s - 11ms/step - loss: 0.6961 - val_loss: 0.6009
Epoch 2/100
192/192 - 1s - 4ms/step - loss: 0.3983 - val_loss: 0.4654
Epoch 3/100
192/192 - 1s - 4ms/step - loss: 0.2669 - val_loss: 0.4211
Epoch 4/100
192/192 - 1s - 4ms/step - loss: 0.2348 - val_loss: 0.3413
Epoch 5/100
192/192 - 1s - 4ms/step - loss: 0.1963 - val_loss: 0.3606
Epoch 6/100
192/192 - 1s - 4ms/step - loss: 0.1738 - val_loss: 0.3448
Epoch 7/100
192/192 - 1s - 4ms/step - loss: 0.1554 - val_loss: 0.3494
Epoch 8/100
192/192 - 1s - 4ms/step - loss: 0.1585 - val_loss: 0.3448
Epoch 9/100
192/192 - 1s - 4ms/step - loss: 0.1940 - val_loss: 0.4235
Epoch 10/100
192/192 - 1s - 4ms/step - loss: 0.1495 - val_loss: 0.3461
Epoch 11/100
192/192 - 1s - 4ms/step - loss: 0.1439 - val_loss: 0.3812
Epoch 12/100
192/192 - 1s - 4ms/step - loss: 0.1410 - val_loss: 0.3769
Epoch 13/100
192/192 - 1s - 4ms/step - loss: 0.1242 - val_loss: 0.4258
Epoch 14/100
192/192 - 1s - 4ms/step - loss: 0.1353 - val_loss: 0.3856
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6248
Per-joint RMSE: 0.9655 0.8076 0.7042 0.3382 0.2476 0.2936
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:05:43.393766: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:05:43.419148: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 09:05:44.289470: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:44.294240: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:44.295038: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:44.296654: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:44.297452: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:44.298285: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:44.382331: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:44.383242: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:44.383987: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:44.384715: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:05:44.684463: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.309373e-01  RMSE=6.564582e-01
  per-joint RMSE: 0.9398 0.9488 0.7233 0.3625 0.2546 0.2877
Residual LSTM:  MSE=3.903502e-01      RMSE=6.247801e-01
  per-joint RMSE: 0.9655 0.8076 0.7042 0.3382 0.2476 0.2936
Combined torque MSE=3.903502e-01     RMSE=6.247801e-01
  per-joint RMSE: 0.9655 0.8076 0.7042 0.3382 0.2476 0.2936
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400.npz --H 50 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400.json
H=50, n_dof=6, feature_dim=18
X_train: (61400, 50, 18)  Y_train: (61400, 6)
X_test : (21969, 50, 18)  Y_test : (21969, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:05:47.350661: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:05:47.374817: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (61400, 50, 18), Y_train = (61400, 6)
  X_test  = (21969, 50, 18),  Y_test  = (21969, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:05:48.803060: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:48.807669: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:48.808585: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:48.810431: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:48.811354: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:48.812202: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:48.901409: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:48.902354: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:48.903161: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:05:48.903961: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:05:49.947803: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
192/192 - 2s - 11ms/step - loss: 0.2782 - val_loss: 0.1646
Epoch 2/100
192/192 - 1s - 4ms/step - loss: 0.1782 - val_loss: 0.1476
Epoch 3/100
192/192 - 1s - 4ms/step - loss: 0.1549 - val_loss: 0.1451
Epoch 4/100
192/192 - 1s - 4ms/step - loss: 0.1397 - val_loss: 0.1412
Epoch 5/100
192/192 - 1s - 4ms/step - loss: 0.1301 - val_loss: 0.1390
Epoch 6/100
192/192 - 1s - 4ms/step - loss: 0.1245 - val_loss: 0.1362
Epoch 7/100
192/192 - 1s - 4ms/step - loss: 0.1188 - val_loss: 0.1340
Epoch 8/100
192/192 - 1s - 4ms/step - loss: 0.1127 - val_loss: 0.1332
Epoch 9/100
192/192 - 1s - 4ms/step - loss: 0.1077 - val_loss: 0.1323
Epoch 10/100
192/192 - 1s - 4ms/step - loss: 0.1056 - val_loss: 0.1300
Epoch 11/100
192/192 - 1s - 4ms/step - loss: 0.1026 - val_loss: 0.1297
Epoch 12/100
192/192 - 1s - 4ms/step - loss: 0.0996 - val_loss: 0.1282
Epoch 13/100
192/192 - 1s - 4ms/step - loss: 0.0972 - val_loss: 0.1264
Epoch 14/100
192/192 - 1s - 4ms/step - loss: 0.0979 - val_loss: 0.1295
Epoch 15/100
192/192 - 1s - 4ms/step - loss: 0.0956 - val_loss: 0.1274
Epoch 16/100
192/192 - 1s - 4ms/step - loss: 0.0927 - val_loss: 0.1283
Epoch 17/100
192/192 - 1s - 4ms/step - loss: 0.0912 - val_loss: 0.1254
Epoch 18/100
192/192 - 1s - 4ms/step - loss: 0.0893 - val_loss: 0.1235
Epoch 19/100
192/192 - 1s - 4ms/step - loss: 0.0866 - val_loss: 0.1255
Epoch 20/100
192/192 - 1s - 4ms/step - loss: 0.0863 - val_loss: 0.1262
Epoch 21/100
192/192 - 1s - 4ms/step - loss: 0.0850 - val_loss: 0.1246
Epoch 22/100
192/192 - 1s - 4ms/step - loss: 0.0832 - val_loss: 0.1229
Epoch 23/100
192/192 - 1s - 4ms/step - loss: 0.0817 - val_loss: 0.1251
Epoch 24/100
192/192 - 1s - 4ms/step - loss: 0.0806 - val_loss: 0.1233
Epoch 25/100
192/192 - 1s - 4ms/step - loss: 0.0803 - val_loss: 0.1232
Epoch 26/100
192/192 - 1s - 4ms/step - loss: 0.0877 - val_loss: 0.1255
Epoch 27/100
192/192 - 1s - 4ms/step - loss: 0.0823 - val_loss: 0.1241
Epoch 28/100
192/192 - 1s - 4ms/step - loss: 0.0807 - val_loss: 0.1256
Epoch 29/100
192/192 - 1s - 4ms/step - loss: 0.0796 - val_loss: 0.1224
Epoch 30/100
192/192 - 1s - 4ms/step - loss: 0.0762 - val_loss: 0.1227
Epoch 31/100
192/192 - 1s - 4ms/step - loss: 0.0770 - val_loss: 0.1256
Epoch 32/100
192/192 - 1s - 4ms/step - loss: 0.0764 - val_loss: 0.1235
Epoch 33/100
192/192 - 1s - 4ms/step - loss: 0.0739 - val_loss: 0.1227
Epoch 34/100
192/192 - 1s - 4ms/step - loss: 0.0731 - val_loss: 0.1218
Epoch 35/100
192/192 - 1s - 4ms/step - loss: 0.0731 - val_loss: 0.1234
Epoch 36/100
192/192 - 1s - 4ms/step - loss: 0.0723 - val_loss: 0.1211
Epoch 37/100
192/192 - 1s - 4ms/step - loss: 0.0723 - val_loss: 0.1210
Epoch 38/100
192/192 - 1s - 4ms/step - loss: 0.0715 - val_loss: 0.1237
Epoch 39/100
192/192 - 1s - 4ms/step - loss: 0.0713 - val_loss: 0.1209
Epoch 40/100
192/192 - 1s - 4ms/step - loss: 0.0711 - val_loss: 0.1226
Epoch 41/100
192/192 - 1s - 4ms/step - loss: 0.0700 - val_loss: 0.1211
Epoch 42/100
192/192 - 1s - 4ms/step - loss: 0.0695 - val_loss: 0.1233
Epoch 43/100
192/192 - 1s - 4ms/step - loss: 0.0693 - val_loss: 0.1222
Epoch 44/100
192/192 - 1s - 4ms/step - loss: 0.0692 - val_loss: 0.1225
Epoch 45/100
192/192 - 1s - 4ms/step - loss: 0.0683 - val_loss: 0.1227
Epoch 46/100
192/192 - 1s - 4ms/step - loss: 0.0680 - val_loss: 0.1217
Epoch 47/100
192/192 - 1s - 4ms/step - loss: 0.0674 - val_loss: 0.1216
Epoch 48/100
192/192 - 1s - 4ms/step - loss: 0.0690 - val_loss: 0.1218
Epoch 49/100
192/192 - 1s - 4ms/step - loss: 0.0669 - val_loss: 0.1209
Epoch 50/100
192/192 - 1s - 4ms/step - loss: 0.0662 - val_loss: 0.1206
Epoch 51/100
192/192 - 1s - 4ms/step - loss: 0.0665 - val_loss: 0.1193
Epoch 52/100
192/192 - 1s - 4ms/step - loss: 0.0655 - val_loss: 0.1209
Epoch 53/100
192/192 - 1s - 4ms/step - loss: 0.0648 - val_loss: 0.1220
Epoch 54/100
192/192 - 1s - 4ms/step - loss: 0.0642 - val_loss: 0.1198
Epoch 55/100
192/192 - 1s - 4ms/step - loss: 0.0636 - val_loss: 0.1224
Epoch 56/100
192/192 - 1s - 4ms/step - loss: 0.0634 - val_loss: 0.1225
Epoch 57/100
192/192 - 1s - 4ms/step - loss: 0.0628 - val_loss: 0.1184
Epoch 58/100
192/192 - 1s - 4ms/step - loss: 0.0627 - val_loss: 0.1200
Epoch 59/100
192/192 - 1s - 4ms/step - loss: 0.0616 - val_loss: 0.1189
Epoch 60/100
192/192 - 1s - 4ms/step - loss: 0.0622 - val_loss: 0.1221
Epoch 61/100
192/192 - 1s - 4ms/step - loss: 0.0606 - val_loss: 0.1196
Epoch 62/100
192/192 - 1s - 4ms/step - loss: 0.0601 - val_loss: 0.1211
Epoch 63/100
192/192 - 1s - 4ms/step - loss: 0.0596 - val_loss: 0.1201
Epoch 64/100
192/192 - 1s - 4ms/step - loss: 0.0594 - val_loss: 0.1204
Epoch 65/100
192/192 - 1s - 4ms/step - loss: 0.0595 - val_loss: 0.1187
Epoch 66/100
192/192 - 1s - 4ms/step - loss: 0.0606 - val_loss: 0.1199
Epoch 67/100
192/192 - 1s - 4ms/step - loss: 0.0599 - val_loss: 0.1201
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6100
Per-joint RMSE: 0.9308 0.8299 0.6783 0.3358 0.2234 0.2344
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:06:41.557815: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:06:41.582708: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 09:06:42.457081: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:06:42.461807: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:06:42.462607: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:06:42.464393: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:06:42.465187: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:06:42.465930: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:06:42.550360: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:06:42.551194: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:06:42.551934: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:06:42.552660: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:06:42.852852: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.309373e-01  RMSE=6.564582e-01
  per-joint RMSE: 0.9398 0.9488 0.7233 0.3625 0.2546 0.2877
Residual LSTM:  MSE=3.721410e-01      RMSE=6.100336e-01
  per-joint RMSE: 0.9308 0.8299 0.6783 0.3358 0.2234 0.2344
Combined torque MSE=3.721410e-01     RMSE=6.100336e-01
  per-joint RMSE: 0.9308 0.8299 0.6783 0.3358 0.2234 0.2344
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400.npz --H 50 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400.json
H=50, n_dof=6, feature_dim=18
X_train: (61400, 50, 18)  Y_train: (61400, 6)
X_test : (21969, 50, 18)  Y_test : (21969, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:06:45.506269: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:06:45.530125: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (61400, 50, 18), Y_train = (61400, 6)
  X_test  = (21969, 50, 18),  Y_test  = (21969, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:06:46.955303: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:06:46.960504: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:06:46.961425: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:06:46.963171: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:06:46.964083: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:06:46.964943: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:06:47.061566: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:06:47.062466: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:06:47.063277: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:06:47.064078: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:06:48.162136: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
192/192 - 2s - 11ms/step - loss: 0.2424 - val_loss: 0.1366
Epoch 2/100
192/192 - 1s - 4ms/step - loss: 0.1474 - val_loss: 0.1206
Epoch 3/100
192/192 - 1s - 4ms/step - loss: 0.1264 - val_loss: 0.1115
Epoch 4/100
192/192 - 1s - 4ms/step - loss: 0.1143 - val_loss: 0.1078
Epoch 5/100
192/192 - 1s - 4ms/step - loss: 0.1075 - val_loss: 0.1037
Epoch 6/100
192/192 - 1s - 4ms/step - loss: 0.1012 - val_loss: 0.1031
Epoch 7/100
192/192 - 1s - 4ms/step - loss: 0.0972 - val_loss: 0.1010
Epoch 8/100
192/192 - 1s - 4ms/step - loss: 0.0931 - val_loss: 0.1007
Epoch 9/100
192/192 - 1s - 4ms/step - loss: 0.0902 - val_loss: 0.0985
Epoch 10/100
192/192 - 1s - 4ms/step - loss: 0.0877 - val_loss: 0.0980
Epoch 11/100
192/192 - 1s - 4ms/step - loss: 0.0850 - val_loss: 0.0974
Epoch 12/100
192/192 - 1s - 4ms/step - loss: 0.0835 - val_loss: 0.0959
Epoch 13/100
192/192 - 1s - 4ms/step - loss: 0.0812 - val_loss: 0.0948
Epoch 14/100
192/192 - 1s - 4ms/step - loss: 0.0792 - val_loss: 0.0950
Epoch 15/100
192/192 - 1s - 4ms/step - loss: 0.0779 - val_loss: 0.0953
Epoch 16/100
192/192 - 1s - 4ms/step - loss: 0.0763 - val_loss: 0.0932
Epoch 17/100
192/192 - 1s - 4ms/step - loss: 0.0755 - val_loss: 0.0941
Epoch 18/100
192/192 - 1s - 4ms/step - loss: 0.0742 - val_loss: 0.0925
Epoch 19/100
192/192 - 1s - 4ms/step - loss: 0.0729 - val_loss: 0.0957
Epoch 20/100
192/192 - 1s - 4ms/step - loss: 0.0718 - val_loss: 0.0917
Epoch 21/100
192/192 - 1s - 4ms/step - loss: 0.0709 - val_loss: 0.0914
Epoch 22/100
192/192 - 1s - 4ms/step - loss: 0.0701 - val_loss: 0.0906
Epoch 23/100
192/192 - 1s - 4ms/step - loss: 0.0689 - val_loss: 0.0904
Epoch 24/100
192/192 - 1s - 4ms/step - loss: 0.0686 - val_loss: 0.0895
Epoch 25/100
192/192 - 1s - 4ms/step - loss: 0.0680 - val_loss: 0.0897
Epoch 26/100
192/192 - 1s - 4ms/step - loss: 0.0671 - val_loss: 0.0897
Epoch 27/100
192/192 - 1s - 4ms/step - loss: 0.0662 - val_loss: 0.0895
Epoch 28/100
192/192 - 1s - 4ms/step - loss: 0.0662 - val_loss: 0.0896
Epoch 29/100
192/192 - 1s - 4ms/step - loss: 0.0643 - val_loss: 0.0896
Epoch 30/100
192/192 - 1s - 4ms/step - loss: 0.0646 - val_loss: 0.0884
Epoch 31/100
192/192 - 1s - 4ms/step - loss: 0.0634 - val_loss: 0.0885
Epoch 32/100
192/192 - 1s - 4ms/step - loss: 0.0636 - val_loss: 0.0882
Epoch 33/100
192/192 - 1s - 4ms/step - loss: 0.0628 - val_loss: 0.0876
Epoch 34/100
192/192 - 1s - 4ms/step - loss: 0.0621 - val_loss: 0.0870
Epoch 35/100
192/192 - 1s - 4ms/step - loss: 0.0617 - val_loss: 0.0880
Epoch 36/100
192/192 - 1s - 4ms/step - loss: 0.0611 - val_loss: 0.0881
Epoch 37/100
192/192 - 1s - 4ms/step - loss: 0.0608 - val_loss: 0.0860
Epoch 38/100
192/192 - 1s - 4ms/step - loss: 0.0605 - val_loss: 0.0879
Epoch 39/100
192/192 - 1s - 4ms/step - loss: 0.0596 - val_loss: 0.0868
Epoch 40/100
192/192 - 1s - 4ms/step - loss: 0.0592 - val_loss: 0.0852
Epoch 41/100
192/192 - 1s - 4ms/step - loss: 0.0591 - val_loss: 0.0848
Epoch 42/100
192/192 - 1s - 4ms/step - loss: 0.0586 - val_loss: 0.0865
Epoch 43/100
192/192 - 1s - 4ms/step - loss: 0.0584 - val_loss: 0.0856
Epoch 44/100
192/192 - 1s - 4ms/step - loss: 0.0585 - val_loss: 0.0862
Epoch 45/100
192/192 - 1s - 4ms/step - loss: 0.0571 - val_loss: 0.0868
Epoch 46/100
192/192 - 1s - 4ms/step - loss: 0.0570 - val_loss: 0.0854
Epoch 47/100
192/192 - 1s - 4ms/step - loss: 0.0568 - val_loss: 0.0842
Epoch 48/100
192/192 - 1s - 4ms/step - loss: 0.0562 - val_loss: 0.0845
Epoch 49/100
192/192 - 1s - 4ms/step - loss: 0.0564 - val_loss: 0.0829
Epoch 50/100
192/192 - 1s - 4ms/step - loss: 0.0546 - val_loss: 0.0836
Epoch 51/100
192/192 - 1s - 4ms/step - loss: 0.0540 - val_loss: 0.0824
Epoch 52/100
192/192 - 1s - 4ms/step - loss: 0.0533 - val_loss: 0.0815
Epoch 53/100
192/192 - 1s - 4ms/step - loss: 0.0526 - val_loss: 0.0820
Epoch 54/100
192/192 - 1s - 4ms/step - loss: 0.0519 - val_loss: 0.0816
Epoch 55/100
192/192 - 1s - 4ms/step - loss: 0.0516 - val_loss: 0.0817
Epoch 56/100
192/192 - 1s - 4ms/step - loss: 0.0515 - val_loss: 0.0820
Epoch 57/100
192/192 - 1s - 4ms/step - loss: 0.0512 - val_loss: 0.0804
Epoch 58/100
192/192 - 1s - 4ms/step - loss: 0.0509 - val_loss: 0.0816
Epoch 59/100
192/192 - 1s - 4ms/step - loss: 0.0504 - val_loss: 0.0817
Epoch 60/100
192/192 - 1s - 4ms/step - loss: 0.0503 - val_loss: 0.0810
Epoch 61/100
192/192 - 1s - 4ms/step - loss: 0.0500 - val_loss: 0.0811
Epoch 62/100
192/192 - 1s - 4ms/step - loss: 0.0499 - val_loss: 0.0810
Epoch 63/100
192/192 - 1s - 4ms/step - loss: 0.0493 - val_loss: 0.0804
Epoch 64/100
192/192 - 1s - 4ms/step - loss: 0.0489 - val_loss: 0.0806
Epoch 65/100
192/192 - 1s - 4ms/step - loss: 0.0489 - val_loss: 0.0809
Epoch 66/100
192/192 - 1s - 4ms/step - loss: 0.0485 - val_loss: 0.0797
Epoch 67/100
192/192 - 1s - 4ms/step - loss: 0.0482 - val_loss: 0.0794
Epoch 68/100
192/192 - 1s - 4ms/step - loss: 0.0479 - val_loss: 0.0810
Epoch 69/100
192/192 - 1s - 4ms/step - loss: 0.0476 - val_loss: 0.0783
Epoch 70/100
192/192 - 1s - 4ms/step - loss: 0.0477 - val_loss: 0.0805
Epoch 71/100
192/192 - 1s - 4ms/step - loss: 0.0468 - val_loss: 0.0801
Epoch 72/100
192/192 - 1s - 4ms/step - loss: 0.0471 - val_loss: 0.0799
Epoch 73/100
192/192 - 1s - 4ms/step - loss: 0.0465 - val_loss: 0.0790
Epoch 74/100
192/192 - 1s - 4ms/step - loss: 0.0462 - val_loss: 0.0798
Epoch 75/100
192/192 - 1s - 4ms/step - loss: 0.0460 - val_loss: 0.0793
Epoch 76/100
192/192 - 1s - 4ms/step - loss: 0.0489 - val_loss: 0.0798
Epoch 77/100
192/192 - 1s - 4ms/step - loss: 0.0473 - val_loss: 0.0798
Epoch 78/100
192/192 - 1s - 4ms/step - loss: 0.0454 - val_loss: 0.0800
Epoch 79/100
192/192 - 1s - 4ms/step - loss: 0.0450 - val_loss: 0.0784
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5578
Per-joint RMSE: 0.8034 0.8009 0.6310 0.3264 0.2043 0.1840
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:07:49.950202: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:07:49.975139: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 09:07:50.821757: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:07:50.826454: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:07:50.827243: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:07:50.829095: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:07:50.829890: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:07:50.830627: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:07:50.911697: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:07:50.912557: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:07:50.913217: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:07:50.914004: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:07:51.211619: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.309373e-01  RMSE=6.564582e-01
  per-joint RMSE: 0.9398 0.9488 0.7233 0.3625 0.2546 0.2877
Residual LSTM:  MSE=3.111942e-01      RMSE=5.578478e-01
  per-joint RMSE: 0.8034 0.8009 0.6310 0.3264 0.2043 0.1840
Combined torque MSE=3.111942e-01     RMSE=5.578478e-01
  per-joint RMSE: 0.8034 0.8009 0.6310 0.3264 0.2043 0.1840
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=2                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz                                ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed0_dataset.npz -t structured -s 2 -r 0 --hp_preset fast_debug --epochs 400 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400.jax' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 400, 'lagrangian_type': <function structured_lagrangian_fn at 0x7cb02d1701f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed0_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed0_dataset.npz
   dt ≈ 0.02164581443156888
  dof = 6
  Train trajectories = 105
  Test trajectories  = 45
  Train samples = 64153
  Test samples  = 23070
################################################

2026-01-22 09:07:56.018868: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400 | type=structured | dof=6
################################################
2026-01-22 09:07:59.145164: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:07:59.145201: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:07:59.145207: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:07:59.145234: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:07:59.145239: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:07:59.145253: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:07:59.145290: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:07:59.145296: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:07:59.145312: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:07:59.145317: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.3s, Loss=7.74e+00, Inv=7.74e+00, For=9.40e+01, Power=1.64e+00
  [eval] test_mse=1.316e+00  (n=23070)
Epoch 00050: Time=  14.7s, Loss=2.76e+00, Inv=2.76e+00, For=1.13e+02, Power=1.02e+00
Epoch 00100: Time=  23.0s, Loss=2.47e+00, Inv=2.47e+00, For=1.53e+02, Power=9.24e-01
Epoch 00150: Time=  30.9s, Loss=2.35e+00, Inv=2.35e+00, For=1.71e+02, Power=8.70e-01
Epoch 00200: Time=  39.6s, Loss=2.30e+00, Inv=2.30e+00, For=2.10e+02, Power=8.66e-01
  [eval] test_mse=2.045e+00  (n=23070)
Epoch 00250: Time=  47.5s, Loss=2.26e+00, Inv=2.26e+00, For=2.28e+02, Power=8.57e-01
Epoch 00300: Time=  55.7s, Loss=2.23e+00, Inv=2.23e+00, For=2.29e+02, Power=8.50e-01
Epoch 00350: Time=  64.4s, Loss=2.21e+00, Inv=2.21e+00, For=2.35e+02, Power=8.45e-01
Epoch 00400: Time=  72.7s, Loss=2.19e+00, Inv=2.19e+00, For=2.51e+02, Power=8.35e-01
  [eval] test_mse=2.260e+00  (n=23070)
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400
Torque MSE  = 3.766e-01
Torque RMSE = 6.137e-01
Per-joint MSE : 4.919e-01 8.407e-01 5.145e-01 2.495e-01 6.937e-02 9.378e-02
Per-joint RMSE: 7.013e-01 9.169e-01 7.173e-01 4.995e-01 2.634e-01 3.062e-01
Comp Time per Sample = 1.379e-08s / 72533939.8Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed0_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed0_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400.jax
Detected n_dof=6 (seed=2)
2026-01-22 09:09:13.974523: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 105 trajectories
2026-01-22 09:09:15.288933: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:09:15.288944: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:09:16.870545: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:09:16.870559: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:09:18.416993: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/105
2026-01-22 09:09:21.016825: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 50/105
2026-01-22 09:09:22.242571: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:09:23.485372: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 75/105
  done 100/105
  done 105/105

Exporting split=test: 45 trajectories
  done 25/45
  done 45/45

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400.npz --H 25 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400.json
H=25, n_dof=6, feature_dim=24
X_train: (62725, 25, 24)  Y_train: (62725, 6)
X_test : (22494, 25, 24)  Y_test : (22494, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:09:25.759853: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:09:25.784272: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (62725, 25, 24), Y_train = (62725, 6)
  X_test  = (22494, 25, 24),  Y_test  = (22494, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:09:27.079741: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:27.084619: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:27.085550: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:27.087452: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:27.088379: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:27.089258: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:27.172118: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:27.173004: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:27.173806: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:27.174609: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:09:28.229100: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
197/197 - 2s - 10ms/step - loss: 0.2420 - val_loss: 0.1827
Epoch 2/100
197/197 - 1s - 3ms/step - loss: 0.1510 - val_loss: 0.1630
Epoch 3/100
197/197 - 1s - 3ms/step - loss: 0.1312 - val_loss: 0.1497
Epoch 4/100
197/197 - 1s - 3ms/step - loss: 0.1241 - val_loss: 0.1446
Epoch 5/100
197/197 - 1s - 3ms/step - loss: 0.1208 - val_loss: 0.1384
Epoch 6/100
197/197 - 1s - 3ms/step - loss: 0.1100 - val_loss: 0.1365
Epoch 7/100
197/197 - 1s - 3ms/step - loss: 0.1031 - val_loss: 0.1333
Epoch 8/100
197/197 - 1s - 3ms/step - loss: 0.1026 - val_loss: 0.1292
Epoch 9/100
197/197 - 1s - 3ms/step - loss: 0.0978 - val_loss: 0.1267
Epoch 10/100
197/197 - 1s - 3ms/step - loss: 0.0936 - val_loss: 0.1285
Epoch 11/100
197/197 - 1s - 3ms/step - loss: 0.0948 - val_loss: 0.1235
Epoch 12/100
197/197 - 1s - 3ms/step - loss: 0.0908 - val_loss: 0.1229
Epoch 13/100
197/197 - 1s - 3ms/step - loss: 0.0886 - val_loss: 0.1233
Epoch 14/100
197/197 - 1s - 3ms/step - loss: 0.0865 - val_loss: 0.1190
Epoch 15/100
197/197 - 1s - 3ms/step - loss: 0.0861 - val_loss: 0.1167
Epoch 16/100
197/197 - 1s - 3ms/step - loss: 0.0845 - val_loss: 0.1200
Epoch 17/100
197/197 - 0s - 3ms/step - loss: 0.0843 - val_loss: 0.1193
Epoch 18/100
197/197 - 1s - 3ms/step - loss: 0.0830 - val_loss: 0.1148
Epoch 19/100
197/197 - 1s - 3ms/step - loss: 0.0808 - val_loss: 0.1146
Epoch 20/100
197/197 - 1s - 3ms/step - loss: 0.0778 - val_loss: 0.1123
Epoch 21/100
197/197 - 1s - 3ms/step - loss: 0.0762 - val_loss: 0.1128
Epoch 22/100
197/197 - 1s - 3ms/step - loss: 0.0728 - val_loss: 0.1123
Epoch 23/100
197/197 - 1s - 3ms/step - loss: 0.0708 - val_loss: 0.1130
Epoch 24/100
197/197 - 1s - 3ms/step - loss: 0.0693 - val_loss: 0.1120
Epoch 25/100
197/197 - 1s - 3ms/step - loss: 0.0680 - val_loss: 0.1127
Epoch 26/100
197/197 - 1s - 3ms/step - loss: 0.0676 - val_loss: 0.1147
Epoch 27/100
197/197 - 1s - 3ms/step - loss: 0.0670 - val_loss: 0.1141
Epoch 28/100
197/197 - 1s - 3ms/step - loss: 0.0676 - val_loss: 0.1101
Epoch 29/100
197/197 - 1s - 3ms/step - loss: 0.0668 - val_loss: 0.1106
Epoch 30/100
197/197 - 1s - 3ms/step - loss: 0.0671 - val_loss: 0.1119
Epoch 31/100
197/197 - 0s - 3ms/step - loss: 0.0664 - val_loss: 0.1132
Epoch 32/100
197/197 - 0s - 2ms/step - loss: 0.0643 - val_loss: 0.1124
Epoch 33/100
197/197 - 0s - 3ms/step - loss: 0.0635 - val_loss: 0.1127
Epoch 34/100
197/197 - 1s - 3ms/step - loss: 0.0630 - val_loss: 0.1104
Epoch 35/100
197/197 - 0s - 3ms/step - loss: 0.0627 - val_loss: 0.1146
Epoch 36/100
197/197 - 0s - 3ms/step - loss: 0.0621 - val_loss: 0.1129
Epoch 37/100
197/197 - 0s - 3ms/step - loss: 0.0614 - val_loss: 0.1123
Epoch 38/100
197/197 - 1s - 3ms/step - loss: 0.0612 - val_loss: 0.1131
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4687
Per-joint RMSE: 0.5067 0.6236 0.6116 0.4650 0.1871 0.2179
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:09:49.349049: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:09:49.374112: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 09:09:50.226389: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:50.231096: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:50.231888: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:50.233541: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:50.234339: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:50.235086: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:50.315029: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:50.315888: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:50.316765: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:50.317552: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:09:50.612470: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.828444e-01  RMSE=6.187442e-01
  per-joint RMSE: 0.7076 0.9237 0.7238 0.5045 0.2643 0.3080
Residual LSTM:  MSE=2.197198e-01      RMSE=4.687428e-01
  per-joint RMSE: 0.5067 0.6236 0.6116 0.4650 0.1871 0.2179
Combined torque MSE=2.197198e-01     RMSE=4.687428e-01
  per-joint RMSE: 0.5067 0.6236 0.6116 0.4650 0.1871 0.2179
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400.npz --H 25 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400.json
H=25, n_dof=6, feature_dim=6
X_train: (62725, 25, 6)  Y_train: (62725, 6)
X_test : (22494, 25, 6)  Y_test : (22494, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:09:53.069699: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:09:53.093618: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (62725, 25, 6), Y_train = (62725, 6)
  X_test  = (22494, 25, 6),  Y_test  = (22494, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:09:54.148053: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:54.152717: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:54.153509: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:54.155075: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:54.157212: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:54.157942: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:54.244091: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:54.244928: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:54.245839: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:09:54.246571: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:09:55.179339: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
197/197 - 2s - 10ms/step - loss: 0.7452 - val_loss: 0.7564
Epoch 2/100
197/197 - 1s - 3ms/step - loss: 0.5658 - val_loss: 0.6026
Epoch 3/100
197/197 - 1s - 3ms/step - loss: 0.4390 - val_loss: 0.5864
Epoch 4/100
197/197 - 0s - 3ms/step - loss: 0.3301 - val_loss: 0.5331
Epoch 5/100
197/197 - 1s - 3ms/step - loss: 0.2640 - val_loss: 0.5034
Epoch 6/100
197/197 - 1s - 3ms/step - loss: 0.2363 - val_loss: 0.4674
Epoch 7/100
197/197 - 0s - 3ms/step - loss: 0.2210 - val_loss: 0.4551
Epoch 8/100
197/197 - 0s - 2ms/step - loss: 0.1870 - val_loss: 0.4573
Epoch 9/100
197/197 - 0s - 3ms/step - loss: 0.1751 - val_loss: 0.4523
Epoch 10/100
197/197 - 1s - 3ms/step - loss: 0.1999 - val_loss: 0.4443
Epoch 11/100
197/197 - 0s - 2ms/step - loss: 0.1678 - val_loss: 0.4867
Epoch 12/100
197/197 - 1s - 3ms/step - loss: 0.1700 - val_loss: 0.4291
Epoch 13/100
197/197 - 0s - 2ms/step - loss: 0.1450 - val_loss: 0.4295
Epoch 14/100
197/197 - 1s - 3ms/step - loss: 0.1563 - val_loss: 0.3919
Epoch 15/100
197/197 - 1s - 3ms/step - loss: 0.1365 - val_loss: 0.3875
Epoch 16/100
197/197 - 0s - 2ms/step - loss: 0.1544 - val_loss: 0.3981
Epoch 17/100
197/197 - 0s - 2ms/step - loss: 0.1660 - val_loss: 0.3965
Epoch 18/100
197/197 - 0s - 2ms/step - loss: 0.1354 - val_loss: 0.4130
Epoch 19/100
197/197 - 0s - 2ms/step - loss: 0.1235 - val_loss: 0.3620
Epoch 20/100
197/197 - 0s - 2ms/step - loss: 0.1205 - val_loss: 0.3665
Epoch 21/100
197/197 - 1s - 3ms/step - loss: 0.1189 - val_loss: 0.3739
Epoch 22/100
197/197 - 0s - 3ms/step - loss: 0.1166 - val_loss: 0.3737
Epoch 23/100
197/197 - 1s - 3ms/step - loss: 0.1264 - val_loss: 0.3439
Epoch 24/100
197/197 - 0s - 2ms/step - loss: 0.1118 - val_loss: 0.3793
Epoch 25/100
197/197 - 0s - 3ms/step - loss: 0.1103 - val_loss: 0.3599
Epoch 26/100
197/197 - 0s - 2ms/step - loss: 0.1145 - val_loss: 0.3768
Epoch 27/100
197/197 - 0s - 2ms/step - loss: 0.1156 - val_loss: 0.3873
Epoch 28/100
197/197 - 0s - 3ms/step - loss: 0.1089 - val_loss: 0.3593
Epoch 29/100
197/197 - 1s - 3ms/step - loss: 0.1314 - val_loss: 0.3465
Epoch 30/100
197/197 - 0s - 2ms/step - loss: 0.1198 - val_loss: 0.3556
Epoch 31/100
197/197 - 1s - 3ms/step - loss: 0.1210 - val_loss: 0.3725
Epoch 32/100
197/197 - 0s - 3ms/step - loss: 0.1052 - val_loss: 0.3829
Epoch 33/100
197/197 - 0s - 3ms/step - loss: 0.1094 - val_loss: 0.3645
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5469
Per-joint RMSE: 0.6269 0.7218 0.6841 0.5104 0.2477 0.3008
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:10:13.321218: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:10:13.345554: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 09:10:14.199549: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:10:14.204337: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:10:14.205226: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:10:14.206901: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:10:14.207703: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:10:14.208446: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:10:14.292303: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:10:14.293144: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:10:14.293978: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:10:14.294705: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:10:14.590932: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.828444e-01  RMSE=6.187442e-01
  per-joint RMSE: 0.7076 0.9237 0.7238 0.5045 0.2643 0.3080
Residual LSTM:  MSE=2.990565e-01      RMSE=5.468606e-01
  per-joint RMSE: 0.6269 0.7218 0.6841 0.5104 0.2477 0.3008
Combined torque MSE=2.990565e-01     RMSE=5.468606e-01
  per-joint RMSE: 0.6269 0.7218 0.6841 0.5104 0.2477 0.3008
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400.npz --H 25 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400.json
H=25, n_dof=6, feature_dim=18
X_train: (62725, 25, 18)  Y_train: (62725, 6)
X_test : (22494, 25, 18)  Y_test : (22494, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:10:17.077383: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:10:17.101273: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (62725, 25, 18), Y_train = (62725, 6)
  X_test  = (22494, 25, 18),  Y_test  = (22494, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:10:18.270459: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:10:18.274965: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:10:18.275831: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:10:18.277418: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:10:18.278202: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:10:18.278933: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:10:18.363872: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:10:18.364763: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:10:18.365558: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:10:18.366348: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:10:19.354451: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
197/197 - 2s - 9ms/step - loss: 0.2819 - val_loss: 0.2215
Epoch 2/100
197/197 - 1s - 3ms/step - loss: 0.1795 - val_loss: 0.2100
Epoch 3/100
197/197 - 1s - 3ms/step - loss: 0.1635 - val_loss: 0.1908
Epoch 4/100
197/197 - 1s - 3ms/step - loss: 0.1425 - val_loss: 0.1821
Epoch 5/100
197/197 - 1s - 3ms/step - loss: 0.1331 - val_loss: 0.1767
Epoch 6/100
197/197 - 1s - 3ms/step - loss: 0.1269 - val_loss: 0.1738
Epoch 7/100
197/197 - 0s - 3ms/step - loss: 0.1198 - val_loss: 0.1762
Epoch 8/100
197/197 - 1s - 3ms/step - loss: 0.1171 - val_loss: 0.1748
Epoch 9/100
197/197 - 1s - 3ms/step - loss: 0.1124 - val_loss: 0.1761
Epoch 10/100
197/197 - 1s - 3ms/step - loss: 0.1093 - val_loss: 0.1746
Epoch 11/100
197/197 - 1s - 3ms/step - loss: 0.1057 - val_loss: 0.1703
Epoch 12/100
197/197 - 1s - 3ms/step - loss: 0.1038 - val_loss: 0.1703
Epoch 13/100
197/197 - 1s - 3ms/step - loss: 0.1017 - val_loss: 0.1686
Epoch 14/100
197/197 - 1s - 3ms/step - loss: 0.0985 - val_loss: 0.1681
Epoch 15/100
197/197 - 1s - 3ms/step - loss: 0.0969 - val_loss: 0.1659
Epoch 16/100
197/197 - 1s - 3ms/step - loss: 0.0959 - val_loss: 0.1655
Epoch 17/100
197/197 - 1s - 3ms/step - loss: 0.0940 - val_loss: 0.1664
Epoch 18/100
197/197 - 1s - 3ms/step - loss: 0.0936 - val_loss: 0.1631
Epoch 19/100
197/197 - 1s - 3ms/step - loss: 0.0923 - val_loss: 0.1599
Epoch 20/100
197/197 - 1s - 3ms/step - loss: 0.0915 - val_loss: 0.1564
Epoch 21/100
197/197 - 1s - 3ms/step - loss: 0.0883 - val_loss: 0.1547
Epoch 22/100
197/197 - 1s - 3ms/step - loss: 0.0872 - val_loss: 0.1565
Epoch 23/100
197/197 - 1s - 3ms/step - loss: 0.0865 - val_loss: 0.1548
Epoch 24/100
197/197 - 1s - 3ms/step - loss: 0.0859 - val_loss: 0.1555
Epoch 25/100
197/197 - 1s - 3ms/step - loss: 0.0853 - val_loss: 0.1573
Epoch 26/100
197/197 - 0s - 3ms/step - loss: 0.0834 - val_loss: 0.1575
Epoch 27/100
197/197 - 1s - 3ms/step - loss: 0.0839 - val_loss: 0.1566
Epoch 28/100
197/197 - 1s - 3ms/step - loss: 0.0812 - val_loss: 0.1570
Epoch 29/100
197/197 - 1s - 3ms/step - loss: 0.0830 - val_loss: 0.1560
Epoch 30/100
197/197 - 1s - 3ms/step - loss: 0.0827 - val_loss: 0.1581
Epoch 31/100
197/197 - 1s - 3ms/step - loss: 0.0791 - val_loss: 0.1535
Epoch 32/100
197/197 - 1s - 3ms/step - loss: 0.0790 - val_loss: 0.1566
Epoch 33/100
197/197 - 1s - 3ms/step - loss: 0.0779 - val_loss: 0.1530
Epoch 34/100
197/197 - 1s - 3ms/step - loss: 0.0779 - val_loss: 0.1520
Epoch 35/100
197/197 - 1s - 3ms/step - loss: 0.0765 - val_loss: 0.1495
Epoch 36/100
197/197 - 1s - 3ms/step - loss: 0.0762 - val_loss: 0.1516
Epoch 37/100
197/197 - 1s - 3ms/step - loss: 0.0765 - val_loss: 0.1527
Epoch 38/100
197/197 - 1s - 3ms/step - loss: 0.0771 - val_loss: 0.1539
Epoch 39/100
197/197 - 1s - 3ms/step - loss: 0.0747 - val_loss: 0.1560
Epoch 40/100
197/197 - 1s - 3ms/step - loss: 0.0747 - val_loss: 0.1508
Epoch 41/100
197/197 - 0s - 3ms/step - loss: 0.0741 - val_loss: 0.1532
Epoch 42/100
197/197 - 1s - 3ms/step - loss: 0.0736 - val_loss: 0.1529
Epoch 43/100
197/197 - 1s - 3ms/step - loss: 0.0723 - val_loss: 0.1491
Epoch 44/100
197/197 - 1s - 3ms/step - loss: 0.0721 - val_loss: 0.1510
Epoch 45/100
197/197 - 1s - 3ms/step - loss: 0.0707 - val_loss: 0.1539
Epoch 46/100
197/197 - 1s - 3ms/step - loss: 0.0707 - val_loss: 0.1494
Epoch 47/100
197/197 - 0s - 3ms/step - loss: 0.0700 - val_loss: 0.1513
Epoch 48/100
197/197 - 1s - 3ms/step - loss: 0.0692 - val_loss: 0.1502
Epoch 49/100
197/197 - 1s - 3ms/step - loss: 0.0686 - val_loss: 0.1537
Epoch 50/100
197/197 - 1s - 3ms/step - loss: 0.0695 - val_loss: 0.1477
Epoch 51/100
197/197 - 1s - 3ms/step - loss: 0.0681 - val_loss: 0.1482
Epoch 52/100
197/197 - 1s - 3ms/step - loss: 0.0685 - val_loss: 0.1498
Epoch 53/100
197/197 - 0s - 3ms/step - loss: 0.0685 - val_loss: 0.1481
Epoch 54/100
197/197 - 1s - 3ms/step - loss: 0.0665 - val_loss: 0.1479
Epoch 55/100
197/197 - 1s - 3ms/step - loss: 0.0666 - val_loss: 0.1464
Epoch 56/100
197/197 - 0s - 3ms/step - loss: 0.0660 - val_loss: 0.1465
Epoch 57/100
197/197 - 1s - 3ms/step - loss: 0.0652 - val_loss: 0.1474
Epoch 58/100
197/197 - 1s - 3ms/step - loss: 0.0657 - val_loss: 0.1484
Epoch 59/100
197/197 - 1s - 3ms/step - loss: 0.0650 - val_loss: 0.1481
Epoch 60/100
197/197 - 1s - 3ms/step - loss: 0.0649 - val_loss: 0.1486
Epoch 61/100
197/197 - 1s - 3ms/step - loss: 0.0647 - val_loss: 0.1471
Epoch 62/100
197/197 - 1s - 3ms/step - loss: 0.0645 - val_loss: 0.1463
Epoch 63/100
197/197 - 1s - 3ms/step - loss: 0.0639 - val_loss: 0.1457
Epoch 64/100
197/197 - 1s - 3ms/step - loss: 0.0646 - val_loss: 0.1439
Epoch 65/100
197/197 - 1s - 3ms/step - loss: 0.0629 - val_loss: 0.1465
Epoch 66/100
197/197 - 1s - 3ms/step - loss: 0.0624 - val_loss: 0.1426
Epoch 67/100
197/197 - 0s - 3ms/step - loss: 0.0621 - val_loss: 0.1443
Epoch 68/100
197/197 - 1s - 3ms/step - loss: 0.0614 - val_loss: 0.1446
Epoch 69/100
197/197 - 1s - 3ms/step - loss: 0.0615 - val_loss: 0.1435
Epoch 70/100
197/197 - 1s - 3ms/step - loss: 0.0614 - val_loss: 0.1449
Epoch 71/100
197/197 - 1s - 3ms/step - loss: 0.0608 - val_loss: 0.1455
Epoch 72/100
197/197 - 1s - 3ms/step - loss: 0.0604 - val_loss: 0.1436
Epoch 73/100
197/197 - 1s - 3ms/step - loss: 0.0595 - val_loss: 0.1431
Epoch 74/100
197/197 - 1s - 3ms/step - loss: 0.0596 - val_loss: 0.1428
Epoch 75/100
197/197 - 0s - 3ms/step - loss: 0.0589 - val_loss: 0.1441
Epoch 76/100
197/197 - 1s - 3ms/step - loss: 0.0585 - val_loss: 0.1421
Epoch 77/100
197/197 - 1s - 3ms/step - loss: 0.0582 - val_loss: 0.1432
Epoch 78/100
197/197 - 1s - 3ms/step - loss: 0.0589 - val_loss: 0.1437
Epoch 79/100
197/197 - 1s - 3ms/step - loss: 0.0579 - val_loss: 0.1445
Epoch 80/100
197/197 - 1s - 3ms/step - loss: 0.0583 - val_loss: 0.1479
Epoch 81/100
197/197 - 1s - 3ms/step - loss: 0.0577 - val_loss: 0.1444
Epoch 82/100
197/197 - 1s - 3ms/step - loss: 0.0576 - val_loss: 0.1454
Epoch 83/100
197/197 - 1s - 3ms/step - loss: 0.0575 - val_loss: 0.1444
Epoch 84/100
197/197 - 0s - 3ms/step - loss: 0.0568 - val_loss: 0.1508
Epoch 85/100
197/197 - 1s - 3ms/step - loss: 0.0567 - val_loss: 0.1443
Epoch 86/100
197/197 - 1s - 3ms/step - loss: 0.0560 - val_loss: 0.1450
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5693
Per-joint RMSE: 0.6699 0.8163 0.6924 0.4736 0.2318 0.2685
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:11:05.015915: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:11:05.040484: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 09:11:05.892370: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:05.897051: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:05.897919: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:05.899610: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:05.900403: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:05.901145: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:05.982269: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:05.983197: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:05.983940: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:05.984664: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:11:06.277943: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.828444e-01  RMSE=6.187442e-01
  per-joint RMSE: 0.7076 0.9237 0.7238 0.5045 0.2643 0.3080
Residual LSTM:  MSE=3.241427e-01      RMSE=5.693353e-01
  per-joint RMSE: 0.6699 0.8163 0.6924 0.4736 0.2318 0.2685
Combined torque MSE=3.241427e-01     RMSE=5.693353e-01
  per-joint RMSE: 0.6699 0.8163 0.6924 0.4736 0.2318 0.2685
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400.npz --H 25 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400.json
H=25, n_dof=6, feature_dim=18
X_train: (62725, 25, 18)  Y_train: (62725, 6)
X_test : (22494, 25, 18)  Y_test : (22494, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:11:08.781052: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:11:08.804903: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (62725, 25, 18), Y_train = (62725, 6)
  X_test  = (22494, 25, 18),  Y_test  = (22494, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:11:10.000817: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:10.005402: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:10.006313: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:10.008063: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:10.008973: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:10.009821: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:10.102854: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:10.103848: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:10.104545: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:10.105331: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:11:11.112626: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
197/197 - 2s - 10ms/step - loss: 0.2412 - val_loss: 0.1816
Epoch 2/100
197/197 - 1s - 3ms/step - loss: 0.1546 - val_loss: 0.1615
Epoch 3/100
197/197 - 1s - 3ms/step - loss: 0.1291 - val_loss: 0.1494
Epoch 4/100
197/197 - 1s - 3ms/step - loss: 0.1171 - val_loss: 0.1480
Epoch 5/100
197/197 - 1s - 3ms/step - loss: 0.1081 - val_loss: 0.1429
Epoch 6/100
197/197 - 1s - 3ms/step - loss: 0.1034 - val_loss: 0.1411
Epoch 7/100
197/197 - 1s - 3ms/step - loss: 0.1001 - val_loss: 0.1422
Epoch 8/100
197/197 - 1s - 3ms/step - loss: 0.0952 - val_loss: 0.1378
Epoch 9/100
197/197 - 1s - 3ms/step - loss: 0.0925 - val_loss: 0.1345
Epoch 10/100
197/197 - 1s - 3ms/step - loss: 0.0899 - val_loss: 0.1344
Epoch 11/100
197/197 - 1s - 3ms/step - loss: 0.0872 - val_loss: 0.1316
Epoch 12/100
197/197 - 1s - 3ms/step - loss: 0.0857 - val_loss: 0.1300
Epoch 13/100
197/197 - 1s - 3ms/step - loss: 0.0834 - val_loss: 0.1294
Epoch 14/100
197/197 - 1s - 3ms/step - loss: 0.0815 - val_loss: 0.1286
Epoch 15/100
197/197 - 1s - 3ms/step - loss: 0.0791 - val_loss: 0.1274
Epoch 16/100
197/197 - 1s - 3ms/step - loss: 0.0788 - val_loss: 0.1258
Epoch 17/100
197/197 - 1s - 3ms/step - loss: 0.0769 - val_loss: 0.1248
Epoch 18/100
197/197 - 1s - 3ms/step - loss: 0.0752 - val_loss: 0.1227
Epoch 19/100
197/197 - 1s - 3ms/step - loss: 0.0744 - val_loss: 0.1244
Epoch 20/100
197/197 - 1s - 3ms/step - loss: 0.0741 - val_loss: 0.1249
Epoch 21/100
197/197 - 1s - 3ms/step - loss: 0.0736 - val_loss: 0.1244
Epoch 22/100
197/197 - 1s - 3ms/step - loss: 0.0722 - val_loss: 0.1220
Epoch 23/100
197/197 - 1s - 3ms/step - loss: 0.0703 - val_loss: 0.1216
Epoch 24/100
197/197 - 1s - 3ms/step - loss: 0.0701 - val_loss: 0.1229
Epoch 25/100
197/197 - 1s - 3ms/step - loss: 0.0696 - val_loss: 0.1211
Epoch 26/100
197/197 - 1s - 3ms/step - loss: 0.0693 - val_loss: 0.1204
Epoch 27/100
197/197 - 1s - 3ms/step - loss: 0.0672 - val_loss: 0.1197
Epoch 28/100
197/197 - 1s - 3ms/step - loss: 0.0674 - val_loss: 0.1205
Epoch 29/100
197/197 - 1s - 3ms/step - loss: 0.0660 - val_loss: 0.1216
Epoch 30/100
197/197 - 1s - 3ms/step - loss: 0.0660 - val_loss: 0.1212
Epoch 31/100
197/197 - 1s - 3ms/step - loss: 0.0648 - val_loss: 0.1193
Epoch 32/100
197/197 - 1s - 3ms/step - loss: 0.0642 - val_loss: 0.1200
Epoch 33/100
197/197 - 1s - 3ms/step - loss: 0.0636 - val_loss: 0.1195
Epoch 34/100
197/197 - 1s - 3ms/step - loss: 0.0632 - val_loss: 0.1218
Epoch 35/100
197/197 - 1s - 3ms/step - loss: 0.0628 - val_loss: 0.1207
Epoch 36/100
197/197 - 1s - 3ms/step - loss: 0.0624 - val_loss: 0.1212
Epoch 37/100
197/197 - 1s - 3ms/step - loss: 0.0618 - val_loss: 0.1194
Epoch 38/100
197/197 - 1s - 3ms/step - loss: 0.0616 - val_loss: 0.1207
Epoch 39/100
197/197 - 1s - 3ms/step - loss: 0.0613 - val_loss: 0.1205
Epoch 40/100
197/197 - 1s - 3ms/step - loss: 0.0630 - val_loss: 0.1206
Epoch 41/100
197/197 - 1s - 3ms/step - loss: 0.0612 - val_loss: 0.1193
Epoch 42/100
197/197 - 1s - 3ms/step - loss: 0.0598 - val_loss: 0.1198
Epoch 43/100
197/197 - 1s - 3ms/step - loss: 0.0594 - val_loss: 0.1228
Epoch 44/100
197/197 - 1s - 3ms/step - loss: 0.0587 - val_loss: 0.1201
Epoch 45/100
197/197 - 1s - 3ms/step - loss: 0.0581 - val_loss: 0.1213
Epoch 46/100
197/197 - 1s - 3ms/step - loss: 0.0583 - val_loss: 0.1229
Epoch 47/100
197/197 - 1s - 3ms/step - loss: 0.0579 - val_loss: 0.1212
Epoch 48/100
197/197 - 1s - 3ms/step - loss: 0.0573 - val_loss: 0.1218
Epoch 49/100
197/197 - 1s - 3ms/step - loss: 0.0572 - val_loss: 0.1225
Epoch 50/100
197/197 - 1s - 3ms/step - loss: 0.0567 - val_loss: 0.1228
Epoch 51/100
197/197 - 1s - 3ms/step - loss: 0.0581 - val_loss: 0.1203
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4976
Per-joint RMSE: 0.5520 0.6861 0.6348 0.4745 0.1988 0.2062
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:11:39.174857: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:11:39.199474: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 09:11:40.056992: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:40.061669: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:40.062466: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:40.064164: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:40.064961: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:40.065701: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:40.146026: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:40.146867: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:40.147621: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:40.148356: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:11:40.450780: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.828444e-01  RMSE=6.187442e-01
  per-joint RMSE: 0.7076 0.9237 0.7238 0.5045 0.2643 0.3080
Residual LSTM:  MSE=2.476045e-01      RMSE=4.975987e-01
  per-joint RMSE: 0.5520 0.6861 0.6348 0.4745 0.1988 0.2062
Combined torque MSE=2.476045e-01     RMSE=4.975987e-01
  per-joint RMSE: 0.5520 0.6861 0.6348 0.4745 0.1988 0.2062
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400.npz --H 50 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400.json
H=50, n_dof=6, feature_dim=24
X_train: (61400, 50, 24)  Y_train: (61400, 6)
X_test : (21969, 50, 24)  Y_test : (21969, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:11:43.169598: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:11:43.193215: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (61400, 50, 24), Y_train = (61400, 6)
  X_test  = (21969, 50, 24),  Y_test  = (21969, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:11:45.067676: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:45.072637: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:45.073580: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:45.075626: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:45.076555: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:45.077439: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:45.167918: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:45.168794: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:45.169589: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:11:45.170369: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:11:46.448421: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
192/192 - 2s - 11ms/step - loss: 0.2446 - val_loss: 0.1464
Epoch 2/100
192/192 - 1s - 4ms/step - loss: 0.1483 - val_loss: 0.1254
Epoch 3/100
192/192 - 1s - 4ms/step - loss: 0.1281 - val_loss: 0.1179
Epoch 4/100
192/192 - 1s - 4ms/step - loss: 0.1158 - val_loss: 0.1142
Epoch 5/100
192/192 - 1s - 4ms/step - loss: 0.1073 - val_loss: 0.1091
Epoch 6/100
192/192 - 1s - 4ms/step - loss: 0.0999 - val_loss: 0.1059
Epoch 7/100
192/192 - 1s - 4ms/step - loss: 0.0954 - val_loss: 0.1031
Epoch 8/100
192/192 - 1s - 4ms/step - loss: 0.0922 - val_loss: 0.1019
Epoch 9/100
192/192 - 1s - 4ms/step - loss: 0.0891 - val_loss: 0.1006
Epoch 10/100
192/192 - 1s - 4ms/step - loss: 0.0874 - val_loss: 0.1016
Epoch 11/100
192/192 - 1s - 4ms/step - loss: 0.0847 - val_loss: 0.0991
Epoch 12/100
192/192 - 1s - 4ms/step - loss: 0.0825 - val_loss: 0.0973
Epoch 13/100
192/192 - 1s - 4ms/step - loss: 0.0804 - val_loss: 0.0974
Epoch 14/100
192/192 - 1s - 4ms/step - loss: 0.0785 - val_loss: 0.0960
Epoch 15/100
192/192 - 1s - 4ms/step - loss: 0.0772 - val_loss: 0.0952
Epoch 16/100
192/192 - 1s - 4ms/step - loss: 0.0761 - val_loss: 0.0948
Epoch 17/100
192/192 - 1s - 4ms/step - loss: 0.0746 - val_loss: 0.0966
Epoch 18/100
192/192 - 1s - 4ms/step - loss: 0.0740 - val_loss: 0.0957
Epoch 19/100
192/192 - 1s - 4ms/step - loss: 0.0735 - val_loss: 0.0966
Epoch 20/100
192/192 - 1s - 4ms/step - loss: 0.0715 - val_loss: 0.0943
Epoch 21/100
192/192 - 1s - 4ms/step - loss: 0.0707 - val_loss: 0.0939
Epoch 22/100
192/192 - 1s - 4ms/step - loss: 0.0698 - val_loss: 0.0930
Epoch 23/100
192/192 - 1s - 4ms/step - loss: 0.0689 - val_loss: 0.0925
Epoch 24/100
192/192 - 1s - 4ms/step - loss: 0.0685 - val_loss: 0.0937
Epoch 25/100
192/192 - 1s - 4ms/step - loss: 0.0676 - val_loss: 0.0914
Epoch 26/100
192/192 - 1s - 4ms/step - loss: 0.0674 - val_loss: 0.0919
Epoch 27/100
192/192 - 1s - 4ms/step - loss: 0.0660 - val_loss: 0.0914
Epoch 28/100
192/192 - 1s - 4ms/step - loss: 0.0666 - val_loss: 0.0909
Epoch 29/100
192/192 - 1s - 4ms/step - loss: 0.0651 - val_loss: 0.0904
Epoch 30/100
192/192 - 1s - 4ms/step - loss: 0.0644 - val_loss: 0.0920
Epoch 31/100
192/192 - 1s - 4ms/step - loss: 0.0641 - val_loss: 0.0890
Epoch 32/100
192/192 - 1s - 4ms/step - loss: 0.0636 - val_loss: 0.0881
Epoch 33/100
192/192 - 1s - 4ms/step - loss: 0.0630 - val_loss: 0.0879
Epoch 34/100
192/192 - 1s - 4ms/step - loss: 0.0627 - val_loss: 0.0884
Epoch 35/100
192/192 - 1s - 4ms/step - loss: 0.0622 - val_loss: 0.0872
Epoch 36/100
192/192 - 1s - 4ms/step - loss: 0.0616 - val_loss: 0.0877
Epoch 37/100
192/192 - 1s - 4ms/step - loss: 0.0613 - val_loss: 0.0873
Epoch 38/100
192/192 - 1s - 4ms/step - loss: 0.0603 - val_loss: 0.0886
Epoch 39/100
192/192 - 1s - 4ms/step - loss: 0.0601 - val_loss: 0.0882
Epoch 40/100
192/192 - 1s - 4ms/step - loss: 0.0601 - val_loss: 0.0866
Epoch 41/100
192/192 - 1s - 4ms/step - loss: 0.0597 - val_loss: 0.0860
Epoch 42/100
192/192 - 1s - 4ms/step - loss: 0.0593 - val_loss: 0.0864
Epoch 43/100
192/192 - 1s - 4ms/step - loss: 0.0590 - val_loss: 0.0867
Epoch 44/100
192/192 - 1s - 4ms/step - loss: 0.0584 - val_loss: 0.0858
Epoch 45/100
192/192 - 1s - 4ms/step - loss: 0.0577 - val_loss: 0.0862
Epoch 46/100
192/192 - 1s - 4ms/step - loss: 0.0576 - val_loss: 0.0854
Epoch 47/100
192/192 - 1s - 4ms/step - loss: 0.0568 - val_loss: 0.0861
Epoch 48/100
192/192 - 1s - 4ms/step - loss: 0.0568 - val_loss: 0.0859
Epoch 49/100
192/192 - 1s - 4ms/step - loss: 0.0570 - val_loss: 0.0844
Epoch 50/100
192/192 - 1s - 4ms/step - loss: 0.0563 - val_loss: 0.0861
Epoch 51/100
192/192 - 1s - 4ms/step - loss: 0.0555 - val_loss: 0.0853
Epoch 52/100
192/192 - 1s - 4ms/step - loss: 0.0556 - val_loss: 0.0851
Epoch 53/100
192/192 - 1s - 4ms/step - loss: 0.0552 - val_loss: 0.0859
Epoch 54/100
192/192 - 1s - 4ms/step - loss: 0.0543 - val_loss: 0.0847
Epoch 55/100
192/192 - 1s - 4ms/step - loss: 0.0539 - val_loss: 0.0845
Epoch 56/100
192/192 - 1s - 4ms/step - loss: 0.0541 - val_loss: 0.0847
Epoch 57/100
192/192 - 1s - 4ms/step - loss: 0.0535 - val_loss: 0.0828
Epoch 58/100
192/192 - 1s - 4ms/step - loss: 0.0532 - val_loss: 0.0844
Epoch 59/100
192/192 - 1s - 4ms/step - loss: 0.0525 - val_loss: 0.0823
Epoch 60/100
192/192 - 1s - 4ms/step - loss: 0.0521 - val_loss: 0.0828
Epoch 61/100
192/192 - 1s - 4ms/step - loss: 0.0512 - val_loss: 0.0828
Epoch 62/100
192/192 - 1s - 4ms/step - loss: 0.0509 - val_loss: 0.0839
Epoch 63/100
192/192 - 1s - 4ms/step - loss: 0.0503 - val_loss: 0.0828
Epoch 64/100
192/192 - 1s - 4ms/step - loss: 0.0505 - val_loss: 0.0831
Epoch 65/100
192/192 - 1s - 4ms/step - loss: 0.0496 - val_loss: 0.0838
Epoch 66/100
192/192 - 1s - 4ms/step - loss: 0.0494 - val_loss: 0.0834
Epoch 67/100
192/192 - 1s - 4ms/step - loss: 0.0485 - val_loss: 0.0821
Epoch 68/100
192/192 - 1s - 4ms/step - loss: 0.0493 - val_loss: 0.0821
Epoch 69/100
192/192 - 1s - 4ms/step - loss: 0.0487 - val_loss: 0.0828
Epoch 70/100
192/192 - 1s - 4ms/step - loss: 0.0483 - val_loss: 0.0822
Epoch 71/100
192/192 - 1s - 4ms/step - loss: 0.0483 - val_loss: 0.0831
Epoch 72/100
192/192 - 1s - 4ms/step - loss: 0.0477 - val_loss: 0.0815
Epoch 73/100
192/192 - 1s - 4ms/step - loss: 0.0471 - val_loss: 0.0830
Epoch 74/100
192/192 - 1s - 4ms/step - loss: 0.0469 - val_loss: 0.0825
Epoch 75/100
192/192 - 1s - 4ms/step - loss: 0.0467 - val_loss: 0.0824
Epoch 76/100
192/192 - 1s - 4ms/step - loss: 0.0465 - val_loss: 0.0821
Epoch 77/100
192/192 - 1s - 4ms/step - loss: 0.0458 - val_loss: 0.0820
Epoch 78/100
192/192 - 1s - 4ms/step - loss: 0.0453 - val_loss: 0.0833
Epoch 79/100
192/192 - 1s - 4ms/step - loss: 0.0452 - val_loss: 0.0811
Epoch 80/100
192/192 - 1s - 4ms/step - loss: 0.0444 - val_loss: 0.0817
Epoch 81/100
192/192 - 1s - 4ms/step - loss: 0.0445 - val_loss: 0.0825
Epoch 82/100
192/192 - 1s - 4ms/step - loss: 0.0442 - val_loss: 0.0824
Epoch 83/100
192/192 - 1s - 4ms/step - loss: 0.0437 - val_loss: 0.0824
Epoch 84/100
192/192 - 1s - 4ms/step - loss: 0.0435 - val_loss: 0.0812
Epoch 85/100
192/192 - 1s - 4ms/step - loss: 0.0428 - val_loss: 0.0829
Epoch 86/100
192/192 - 1s - 4ms/step - loss: 0.0425 - val_loss: 0.0824
Epoch 87/100
192/192 - 1s - 4ms/step - loss: 0.0429 - val_loss: 0.0821
Epoch 88/100
192/192 - 1s - 4ms/step - loss: 0.0421 - val_loss: 0.0812
Epoch 89/100
192/192 - 1s - 4ms/step - loss: 0.0421 - val_loss: 0.0835
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4863
Per-joint RMSE: 0.5715 0.6279 0.6373 0.4523 0.1947 0.2221
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:12:55.727987: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:12:55.752567: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 09:12:56.621664: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:12:56.626453: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:12:56.627329: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:12:56.629241: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:12:56.630037: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:12:56.630781: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:12:56.711475: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:12:56.712314: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:12:56.713110: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:12:56.713888: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:12:57.023482: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.886756e-01  RMSE=6.234385e-01
  per-joint RMSE: 0.7130 0.9307 0.7294 0.5090 0.2652 0.3098
Residual LSTM:  MSE=2.364575e-01      RMSE=4.862689e-01
  per-joint RMSE: 0.5715 0.6279 0.6373 0.4523 0.1947 0.2221
Combined torque MSE=2.364575e-01     RMSE=4.862689e-01
  per-joint RMSE: 0.5715 0.6279 0.6373 0.4523 0.1947 0.2221
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s0_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400.npz --H 50 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400.json
H=50, n_dof=6, feature_dim=6
X_train: (61400, 50, 6)  Y_train: (61400, 6)
X_test : (21969, 50, 6)  Y_test : (21969, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:12:59.548974: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:12:59.573676: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (61400, 50, 6), Y_train = (61400, 6)
  X_test  = (21969, 50, 6),  Y_test  = (21969, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:13:00.757996: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:00.762863: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:00.763664: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:00.765216: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:00.766008: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:00.766834: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:00.846181: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:00.847021: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:00.847762: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:00.848492: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:13:01.828827: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
192/192 - 2s - 11ms/step - loss: 0.6939 - val_loss: 0.6658
Epoch 2/100
192/192 - 1s - 4ms/step - loss: 0.4007 - val_loss: 0.3959
Epoch 3/100
192/192 - 1s - 4ms/step - loss: 0.2607 - val_loss: 0.3486
Epoch 4/100
192/192 - 1s - 4ms/step - loss: 0.2210 - val_loss: 0.3448
Epoch 5/100
192/192 - 1s - 4ms/step - loss: 0.1806 - val_loss: 0.3612
Epoch 6/100
192/192 - 1s - 4ms/step - loss: 0.1950 - val_loss: 0.3460
Epoch 7/100
192/192 - 1s - 4ms/step - loss: 0.1539 - val_loss: 0.3237
Epoch 8/100
192/192 - 1s - 4ms/step - loss: 0.1430 - val_loss: 0.3515
Epoch 9/100
192/192 - 1s - 4ms/step - loss: 0.1391 - val_loss: 0.3316
Epoch 10/100
192/192 - 1s - 4ms/step - loss: 0.1372 - val_loss: 0.3181
Epoch 11/100
192/192 - 1s - 4ms/step - loss: 0.1344 - val_loss: 0.3026
Epoch 12/100
192/192 - 1s - 4ms/step - loss: 0.1262 - val_loss: 0.3020
Epoch 13/100
192/192 - 1s - 4ms/step - loss: 0.1596 - val_loss: 0.3301
Epoch 14/100
192/192 - 1s - 4ms/step - loss: 0.1315 - val_loss: 0.3035
Epoch 15/100
192/192 - 1s - 4ms/step - loss: 0.1197 - val_loss: 0.3000
Epoch 16/100
192/192 - 1s - 4ms/step - loss: 0.1149 - val_loss: 0.3086
Epoch 17/100
192/192 - 1s - 4ms/step - loss: 0.1138 - val_loss: 0.3090
Epoch 18/100
192/192 - 1s - 4ms/step - loss: 0.1355 - val_loss: 0.2980
Epoch 19/100
192/192 - 1s - 4ms/step - loss: 0.1160 - val_loss: 0.3153
Epoch 20/100
192/192 - 1s - 4ms/step - loss: 0.1100 - val_loss: 0.2796
Epoch 21/100
192/192 - 1s - 4ms/step - loss: 0.1066 - val_loss: 0.2781
Epoch 22/100
192/192 - 1s - 4ms/step - loss: 0.1076 - val_loss: 0.2992
Epoch 23/100
192/192 - 1s - 4ms/step - loss: 0.1036 - val_loss: 0.2966
Epoch 24/100
192/192 - 1s - 4ms/step - loss: 0.1076 - val_loss: 0.2970
Epoch 25/100
192/192 - 1s - 4ms/step - loss: 0.1029 - val_loss: 0.3040
Epoch 26/100
192/192 - 1s - 4ms/step - loss: 0.1084 - val_loss: 0.2891
Epoch 27/100
192/192 - 1s - 4ms/step - loss: 0.1119 - val_loss: 0.2920
Epoch 28/100
192/192 - 1s - 4ms/step - loss: 0.1023 - val_loss: 0.2849
Epoch 29/100
192/192 - 1s - 4ms/step - loss: 0.0987 - val_loss: 0.2843
Epoch 30/100
192/192 - 1s - 4ms/step - loss: 0.0997 - val_loss: 0.3039
Epoch 31/100
192/192 - 1s - 4ms/step - loss: 0.0973 - val_loss: 0.3019
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5670
Per-joint RMSE: 0.6767 0.7577 0.6979 0.5022 0.2574 0.3026
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:13:26.831079: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:13:26.855792: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 09:13:27.710330: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:27.715201: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:27.715992: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:27.717835: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:27.718627: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:27.719364: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:27.797550: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:27.798401: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:27.799147: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:27.799884: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:13:28.099766: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.886756e-01  RMSE=6.234385e-01
  per-joint RMSE: 0.7130 0.9307 0.7294 0.5090 0.2652 0.3098
Residual LSTM:  MSE=3.215143e-01      RMSE=5.670223e-01
  per-joint RMSE: 0.6767 0.7577 0.6979 0.5022 0.2574 0.3026
Combined torque MSE=3.215143e-01     RMSE=5.670223e-01
  per-joint RMSE: 0.6767 0.7577 0.6979 0.5022 0.2574 0.3026
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s0_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400.npz --H 50 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400.json
H=50, n_dof=6, feature_dim=18
X_train: (61400, 50, 18)  Y_train: (61400, 6)
X_test : (21969, 50, 18)  Y_test : (21969, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:13:30.781469: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:13:30.805812: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (61400, 50, 18), Y_train = (61400, 6)
  X_test  = (21969, 50, 18),  Y_test  = (21969, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:13:32.240461: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:32.245283: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:32.246197: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:32.248018: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:32.248941: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:32.249812: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:32.335953: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:32.337084: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:32.337957: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:13:32.338745: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:13:33.432702: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
192/192 - 2s - 11ms/step - loss: 0.2789 - val_loss: 0.1701
Epoch 2/100
192/192 - 1s - 4ms/step - loss: 0.1813 - val_loss: 0.1549
Epoch 3/100
192/192 - 1s - 4ms/step - loss: 0.1571 - val_loss: 0.1491
Epoch 4/100
192/192 - 1s - 4ms/step - loss: 0.1418 - val_loss: 0.1502
Epoch 5/100
192/192 - 1s - 4ms/step - loss: 0.1321 - val_loss: 0.1436
Epoch 6/100
192/192 - 1s - 4ms/step - loss: 0.1252 - val_loss: 0.1446
Epoch 7/100
192/192 - 1s - 4ms/step - loss: 0.1207 - val_loss: 0.1414
Epoch 8/100
192/192 - 1s - 4ms/step - loss: 0.1158 - val_loss: 0.1386
Epoch 9/100
192/192 - 1s - 4ms/step - loss: 0.1128 - val_loss: 0.1382
Epoch 10/100
192/192 - 1s - 4ms/step - loss: 0.1099 - val_loss: 0.1371
Epoch 11/100
192/192 - 1s - 4ms/step - loss: 0.1059 - val_loss: 0.1355
Epoch 12/100
192/192 - 1s - 4ms/step - loss: 0.1048 - val_loss: 0.1364
Epoch 13/100
192/192 - 1s - 4ms/step - loss: 0.1019 - val_loss: 0.1344
Epoch 14/100
192/192 - 1s - 4ms/step - loss: 0.0985 - val_loss: 0.1374
Epoch 15/100
192/192 - 1s - 4ms/step - loss: 0.0971 - val_loss: 0.1337
Epoch 16/100
192/192 - 1s - 4ms/step - loss: 0.0945 - val_loss: 0.1358
Epoch 17/100
192/192 - 1s - 4ms/step - loss: 0.0925 - val_loss: 0.1344
Epoch 18/100
192/192 - 1s - 4ms/step - loss: 0.0913 - val_loss: 0.1376
Epoch 19/100
192/192 - 1s - 4ms/step - loss: 0.0893 - val_loss: 0.1340
Epoch 20/100
192/192 - 1s - 4ms/step - loss: 0.0904 - val_loss: 0.1365
Epoch 21/100
192/192 - 1s - 4ms/step - loss: 0.0868 - val_loss: 0.1353
Epoch 22/100
192/192 - 1s - 4ms/step - loss: 0.0866 - val_loss: 0.1334
Epoch 23/100
192/192 - 1s - 4ms/step - loss: 0.0879 - val_loss: 0.1374
Epoch 24/100
192/192 - 1s - 4ms/step - loss: 0.0850 - val_loss: 0.1354
Epoch 25/100
192/192 - 1s - 4ms/step - loss: 0.0843 - val_loss: 0.1397
Epoch 26/100
192/192 - 1s - 4ms/step - loss: 0.0846 - val_loss: 0.1336
Epoch 27/100
192/192 - 1s - 4ms/step - loss: 0.0831 - val_loss: 0.1336
Epoch 28/100
192/192 - 1s - 4ms/step - loss: 0.0813 - val_loss: 0.1315
Epoch 29/100
192/192 - 1s - 4ms/step - loss: 0.0804 - val_loss: 0.1304
Epoch 30/100
192/192 - 1s - 4ms/step - loss: 0.0798 - val_loss: 0.1313
Epoch 31/100
192/192 - 1s - 4ms/step - loss: 0.0785 - val_loss: 0.1320
Epoch 32/100
192/192 - 1s - 4ms/step - loss: 0.0763 - val_loss: 0.1314
Epoch 33/100
192/192 - 1s - 4ms/step - loss: 0.0772 - val_loss: 0.1283
Epoch 34/100
192/192 - 1s - 4ms/step - loss: 0.0751 - val_loss: 0.1299
Epoch 35/100
192/192 - 1s - 4ms/step - loss: 0.0748 - val_loss: 0.1306
Epoch 36/100
192/192 - 1s - 4ms/step - loss: 0.0759 - val_loss: 0.1338
Epoch 37/100
192/192 - 1s - 4ms/step - loss: 0.0750 - val_loss: 0.1315
Epoch 38/100
192/192 - 1s - 4ms/step - loss: 0.0737 - val_loss: 0.1296
Epoch 39/100
192/192 - 1s - 4ms/step - loss: 0.0726 - val_loss: 0.1263
Epoch 40/100
192/192 - 1s - 4ms/step - loss: 0.0732 - val_loss: 0.1304
Epoch 41/100
192/192 - 1s - 4ms/step - loss: 0.0713 - val_loss: 0.1288
Epoch 42/100
192/192 - 1s - 4ms/step - loss: 0.0717 - val_loss: 0.1304
Epoch 43/100
192/192 - 1s - 4ms/step - loss: 0.0711 - val_loss: 0.1280
Epoch 44/100
192/192 - 1s - 4ms/step - loss: 0.0709 - val_loss: 0.1266
Epoch 45/100
192/192 - 1s - 4ms/step - loss: 0.0704 - val_loss: 0.1289
Epoch 46/100
192/192 - 1s - 4ms/step - loss: 0.0697 - val_loss: 0.1296
Epoch 47/100
192/192 - 1s - 4ms/step - loss: 0.0688 - val_loss: 0.1280
Epoch 48/100
192/192 - 1s - 4ms/step - loss: 0.0691 - val_loss: 0.1279
Epoch 49/100
192/192 - 1s - 4ms/step - loss: 0.0694 - val_loss: 0.1252
Epoch 50/100
192/192 - 1s - 4ms/step - loss: 0.0686 - val_loss: 0.1271
Epoch 51/100
192/192 - 1s - 4ms/step - loss: 0.0680 - val_loss: 0.1286
Epoch 52/100
192/192 - 1s - 4ms/step - loss: 0.0666 - val_loss: 0.1261
Epoch 53/100
192/192 - 1s - 4ms/step - loss: 0.0662 - val_loss: 0.1264
Epoch 54/100
192/192 - 1s - 4ms/step - loss: 0.0664 - val_loss: 0.1289
Epoch 55/100
192/192 - 1s - 4ms/step - loss: 0.0661 - val_loss: 0.1238
Epoch 56/100
192/192 - 1s - 4ms/step - loss: 0.0641 - val_loss: 0.1248
Epoch 57/100
192/192 - 1s - 4ms/step - loss: 0.0657 - val_loss: 0.1261
Epoch 58/100
192/192 - 1s - 4ms/step - loss: 0.0657 - val_loss: 0.1232
Epoch 59/100
192/192 - 1s - 4ms/step - loss: 0.0650 - val_loss: 0.1287
Epoch 60/100
192/192 - 1s - 4ms/step - loss: 0.0654 - val_loss: 0.1214
Epoch 61/100
192/192 - 1s - 4ms/step - loss: 0.0641 - val_loss: 0.1225
Epoch 62/100
192/192 - 1s - 4ms/step - loss: 0.0631 - val_loss: 0.1267
Epoch 63/100
192/192 - 1s - 4ms/step - loss: 0.0622 - val_loss: 0.1259
Epoch 64/100
192/192 - 1s - 4ms/step - loss: 0.0613 - val_loss: 0.1236
Epoch 65/100
192/192 - 1s - 4ms/step - loss: 0.0617 - val_loss: 0.1246
Epoch 66/100
192/192 - 1s - 4ms/step - loss: 0.0610 - val_loss: 0.1224
Epoch 67/100
192/192 - 1s - 4ms/step - loss: 0.0606 - val_loss: 0.1252
Epoch 68/100
192/192 - 1s - 4ms/step - loss: 0.0584 - val_loss: 0.1253
Epoch 69/100
192/192 - 1s - 4ms/step - loss: 0.0579 - val_loss: 0.1270
Epoch 70/100
192/192 - 1s - 4ms/step - loss: 0.0594 - val_loss: 0.1234
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5685
Per-joint RMSE: 0.6770 0.8078 0.6845 0.4870 0.2294 0.2638
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:14:27.294673: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:14:27.319048: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 09:14:28.181411: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:14:28.186591: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:14:28.187407: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:14:28.189057: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:14:28.189934: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:14:28.190675: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:14:28.267281: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:14:28.268117: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:14:28.268854: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:14:28.269583: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:14:28.571098: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.886756e-01  RMSE=6.234385e-01
  per-joint RMSE: 0.7130 0.9307 0.7294 0.5090 0.2652 0.3098
Residual LSTM:  MSE=3.231433e-01      RMSE=5.684569e-01
  per-joint RMSE: 0.6770 0.8078 0.6845 0.4870 0.2294 0.2638
Combined torque MSE=3.231433e-01     RMSE=5.684569e-01
  per-joint RMSE: 0.6770 0.8078 0.6845 0.4870 0.2294 0.2638
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s0_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400.npz --H 50 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400.json
H=50, n_dof=6, feature_dim=18
X_train: (61400, 50, 18)  Y_train: (61400, 6)
X_test : (21969, 50, 18)  Y_test : (21969, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:14:31.262525: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:14:31.286590: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (61400, 50, 18), Y_train = (61400, 6)
  X_test  = (21969, 50, 18),  Y_test  = (21969, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:14:32.790634: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:14:32.795717: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:14:32.796639: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:14:32.798397: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:14:32.799302: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:14:32.800159: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:14:32.896296: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:14:32.897268: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:14:32.898068: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:14:32.898865: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:14:34.035672: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
192/192 - 2s - 11ms/step - loss: 0.2461 - val_loss: 0.1442
Epoch 2/100
192/192 - 1s - 4ms/step - loss: 0.1505 - val_loss: 0.1295
Epoch 3/100
192/192 - 1s - 4ms/step - loss: 0.1268 - val_loss: 0.1223
Epoch 4/100
192/192 - 1s - 4ms/step - loss: 0.1153 - val_loss: 0.1165
Epoch 5/100
192/192 - 1s - 4ms/step - loss: 0.1078 - val_loss: 0.1149
Epoch 6/100
192/192 - 1s - 4ms/step - loss: 0.1031 - val_loss: 0.1113
Epoch 7/100
192/192 - 1s - 4ms/step - loss: 0.0979 - val_loss: 0.1107
Epoch 8/100
192/192 - 1s - 4ms/step - loss: 0.0939 - val_loss: 0.1078
Epoch 9/100
192/192 - 1s - 4ms/step - loss: 0.0904 - val_loss: 0.1065
Epoch 10/100
192/192 - 1s - 4ms/step - loss: 0.0874 - val_loss: 0.1061
Epoch 11/100
192/192 - 1s - 4ms/step - loss: 0.0858 - val_loss: 0.1045
Epoch 12/100
192/192 - 1s - 4ms/step - loss: 0.0836 - val_loss: 0.1040
Epoch 13/100
192/192 - 1s - 4ms/step - loss: 0.0816 - val_loss: 0.1034
Epoch 14/100
192/192 - 1s - 4ms/step - loss: 0.0803 - val_loss: 0.1013
Epoch 15/100
192/192 - 1s - 4ms/step - loss: 0.0788 - val_loss: 0.1009
Epoch 16/100
192/192 - 1s - 4ms/step - loss: 0.0769 - val_loss: 0.0997
Epoch 17/100
192/192 - 1s - 4ms/step - loss: 0.0760 - val_loss: 0.1008
Epoch 18/100
192/192 - 1s - 4ms/step - loss: 0.0747 - val_loss: 0.1019
Epoch 19/100
192/192 - 1s - 4ms/step - loss: 0.0741 - val_loss: 0.1002
Epoch 20/100
192/192 - 1s - 4ms/step - loss: 0.0728 - val_loss: 0.0980
Epoch 21/100
192/192 - 1s - 4ms/step - loss: 0.0719 - val_loss: 0.0991
Epoch 22/100
192/192 - 1s - 4ms/step - loss: 0.0711 - val_loss: 0.0986
Epoch 23/100
192/192 - 1s - 4ms/step - loss: 0.0706 - val_loss: 0.0988
Epoch 24/100
192/192 - 1s - 4ms/step - loss: 0.0699 - val_loss: 0.0981
Epoch 25/100
192/192 - 1s - 4ms/step - loss: 0.0687 - val_loss: 0.0982
Epoch 26/100
192/192 - 1s - 4ms/step - loss: 0.0678 - val_loss: 0.0973
Epoch 27/100
192/192 - 1s - 4ms/step - loss: 0.0670 - val_loss: 0.0961
Epoch 28/100
192/192 - 1s - 4ms/step - loss: 0.0663 - val_loss: 0.0972
Epoch 29/100
192/192 - 1s - 4ms/step - loss: 0.0660 - val_loss: 0.0982
Epoch 30/100
192/192 - 1s - 4ms/step - loss: 0.0655 - val_loss: 0.0970
Epoch 31/100
192/192 - 1s - 4ms/step - loss: 0.0674 - val_loss: 0.0963
Epoch 32/100
192/192 - 1s - 4ms/step - loss: 0.0648 - val_loss: 0.0963
Epoch 33/100
192/192 - 1s - 4ms/step - loss: 0.0636 - val_loss: 0.0977
Epoch 34/100
192/192 - 1s - 4ms/step - loss: 0.0632 - val_loss: 0.0958
Epoch 35/100
192/192 - 1s - 4ms/step - loss: 0.0635 - val_loss: 0.0962
Epoch 36/100
192/192 - 1s - 4ms/step - loss: 0.0623 - val_loss: 0.0960
Epoch 37/100
192/192 - 1s - 4ms/step - loss: 0.0621 - val_loss: 0.0963
Epoch 38/100
192/192 - 1s - 4ms/step - loss: 0.0612 - val_loss: 0.0951
Epoch 39/100
192/192 - 1s - 4ms/step - loss: 0.0610 - val_loss: 0.0956
Epoch 40/100
192/192 - 1s - 4ms/step - loss: 0.0601 - val_loss: 0.0943
Epoch 41/100
192/192 - 1s - 4ms/step - loss: 0.0596 - val_loss: 0.0935
Epoch 42/100
192/192 - 1s - 4ms/step - loss: 0.0595 - val_loss: 0.0938
Epoch 43/100
192/192 - 1s - 4ms/step - loss: 0.0593 - val_loss: 0.0943
Epoch 44/100
192/192 - 1s - 4ms/step - loss: 0.0595 - val_loss: 0.0943
Epoch 45/100
192/192 - 1s - 4ms/step - loss: 0.0586 - val_loss: 0.0951
Epoch 46/100
192/192 - 1s - 4ms/step - loss: 0.0581 - val_loss: 0.0946
Epoch 47/100
192/192 - 1s - 4ms/step - loss: 0.0580 - val_loss: 0.0935
Epoch 48/100
192/192 - 1s - 4ms/step - loss: 0.0576 - val_loss: 0.0943
Epoch 49/100
192/192 - 1s - 4ms/step - loss: 0.0574 - val_loss: 0.0943
Epoch 50/100
192/192 - 1s - 4ms/step - loss: 0.0565 - val_loss: 0.0946
Epoch 51/100
192/192 - 1s - 4ms/step - loss: 0.0564 - val_loss: 0.0952
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5060
Per-joint RMSE: 0.5464 0.7163 0.6396 0.4748 0.1933 0.2299
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:15:14.623242: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:15:14.648140: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 09:15:15.508319: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:15:15.512972: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:15:15.513936: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:15:15.515743: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:15:15.516534: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:15:15.517270: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:15:15.599176: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:15:15.600020: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:15:15.600853: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:15:15.601588: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:15:15.903825: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.886756e-01  RMSE=6.234385e-01
  per-joint RMSE: 0.7130 0.9307 0.7294 0.5090 0.2652 0.3098
Residual LSTM:  MSE=2.560636e-01      RMSE=5.060273e-01
  per-joint RMSE: 0.5464 0.7163 0.6396 0.4748 0.1933 0.2299
Combined torque MSE=2.560636e-01     RMSE=5.060273e-01
  per-joint RMSE: 0.5464 0.7163 0.6396 0.4748 0.1933 0.2299
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s0_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

