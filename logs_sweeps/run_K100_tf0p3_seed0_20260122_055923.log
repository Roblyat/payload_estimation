#################################################################################################################
### RUN: K=100 test_fraction=0.3 seed=0                                                                       ###
### npz_in=/workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed0_dataset.npz ###
#################################################################################################################

#####################
### 1) PREPROCESS ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_delan_dataset.py --qdd True --col_format wide --trajectory_amount 100 --test_fraction 0.3 --seed 0 --raw_csv /workspace/shared/data/raw/delan_UR3_Load0_combined_26.csv --out_npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed0_dataset.npz' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Saved: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed0_dataset.npz
Trajectories: train=70 test=30
Exists: True

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=0                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz                                ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed0_dataset.npz -t structured -s 0 -r 0 --hp_preset fast_debug --epochs 300 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300.jax' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 300, 'lagrangian_type': <function structured_lagrangian_fn at 0x7a60eac901f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed0_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed0_dataset.npz
   dt ≈ 0.022972524931080995
  dof = 6
  Train trajectories = 70
  Test trajectories  = 30
  Train samples = 34106
  Test samples  = 20043
################################################

2026-01-22 07:28:52.807391: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300 | type=structured | dof=6
################################################
2026-01-22 07:28:55.982367: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:28:55.982403: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:28:55.982410: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:28:55.982438: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:28:55.982443: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:28:55.982457: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:28:55.982494: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:28:55.982500: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:28:55.982516: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:28:55.982520: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.1s, Loss=1.25e+01, Inv=1.25e+01, For=2.19e+02, Power=2.58e+00
  [eval] test_mse=2.263e+00  (n=20043)
Epoch 00050: Time=  10.7s, Loss=2.64e+00, Inv=2.64e+00, For=1.52e+02, Power=1.29e+00
Epoch 00100: Time=  15.0s, Loss=2.39e+00, Inv=2.39e+00, For=1.63e+02, Power=1.18e+00
Epoch 00150: Time=  19.4s, Loss=2.28e+00, Inv=2.28e+00, For=1.67e+02, Power=1.13e+00
Epoch 00200: Time=  24.4s, Loss=2.22e+00, Inv=2.22e+00, For=1.66e+02, Power=1.10e+00
  [eval] test_mse=2.422e+00  (n=20043)
Epoch 00250: Time=  28.8s, Loss=2.17e+00, Inv=2.17e+00, For=1.84e+02, Power=1.08e+00
Epoch 00300: Time=  33.0s, Loss=2.14e+00, Inv=2.14e+00, For=2.17e+02, Power=1.06e+00
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300
Torque MSE  = 4.885e-01
Torque RMSE = 6.990e-01
Per-joint MSE : 7.591e-01 1.129e+00 5.921e-01 1.633e-01 1.397e-01 1.478e-01
Per-joint RMSE: 8.712e-01 1.063e+00 7.695e-01 4.041e-01 3.738e-01 3.844e-01
Comp Time per Sample = 1.652e-08s / 60545919.6Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed0_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed0_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300.jax
Detected n_dof=6 (seed=0)
2026-01-22 07:29:31.054712: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 70 trajectories
2026-01-22 07:29:32.383588: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:29:32.383605: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:29:33.891950: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:29:33.891965: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:29:35.436985: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/70
  done 50/70
2026-01-22 07:29:37.932215: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:29:39.209265: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 70/70

Exporting split=test: 30 trajectories
  done 25/30
  done 30/30

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300.npz --H 25 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300.json
H=25, n_dof=6, feature_dim=24
X_train: (33182, 25, 24)  Y_train: (33182, 6)
X_test : (19638, 25, 24)  Y_test : (19638, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:29:41.460153: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:29:41.484314: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (33182, 25, 24), Y_train = (33182, 6)
  X_test  = (19638, 25, 24),  Y_test  = (19638, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:29:42.593628: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:29:42.598634: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:29:42.599667: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:29:42.601488: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:29:42.602414: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:29:42.603290: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:29:42.687902: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:29:42.688875: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:29:42.689661: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:29:42.690444: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:29:43.670882: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
104/104 - 2s - 16ms/step - loss: 0.2950 - val_loss: 0.2672
Epoch 2/80
104/104 - 0s - 3ms/step - loss: 0.1619 - val_loss: 0.2239
Epoch 3/80
104/104 - 0s - 3ms/step - loss: 0.1343 - val_loss: 0.2037
Epoch 4/80
104/104 - 0s - 3ms/step - loss: 0.1195 - val_loss: 0.1875
Epoch 5/80
104/104 - 0s - 3ms/step - loss: 0.1104 - val_loss: 0.1799
Epoch 6/80
104/104 - 0s - 3ms/step - loss: 0.1050 - val_loss: 0.1759
Epoch 7/80
104/104 - 0s - 3ms/step - loss: 0.0988 - val_loss: 0.1711
Epoch 8/80
104/104 - 0s - 3ms/step - loss: 0.0939 - val_loss: 0.1710
Epoch 9/80
104/104 - 0s - 3ms/step - loss: 0.0912 - val_loss: 0.1709
Epoch 10/80
104/104 - 0s - 3ms/step - loss: 0.0882 - val_loss: 0.1698
Epoch 11/80
104/104 - 0s - 3ms/step - loss: 0.0861 - val_loss: 0.1666
Epoch 12/80
104/104 - 0s - 3ms/step - loss: 0.0840 - val_loss: 0.1681
Epoch 13/80
104/104 - 0s - 3ms/step - loss: 0.0826 - val_loss: 0.1678
Epoch 14/80
104/104 - 0s - 3ms/step - loss: 0.0807 - val_loss: 0.1661
Epoch 15/80
104/104 - 0s - 3ms/step - loss: 0.0797 - val_loss: 0.1627
Epoch 16/80
104/104 - 0s - 3ms/step - loss: 0.0773 - val_loss: 0.1651
Epoch 17/80
104/104 - 0s - 3ms/step - loss: 0.0767 - val_loss: 0.1650
Epoch 18/80
104/104 - 0s - 3ms/step - loss: 0.0764 - val_loss: 0.1627
Epoch 19/80
104/104 - 0s - 3ms/step - loss: 0.0727 - val_loss: 0.1615
Epoch 20/80
104/104 - 0s - 3ms/step - loss: 0.0731 - val_loss: 0.1623
Epoch 21/80
104/104 - 0s - 3ms/step - loss: 0.0709 - val_loss: 0.1631
Epoch 22/80
104/104 - 0s - 3ms/step - loss: 0.0711 - val_loss: 0.1626
Epoch 23/80
104/104 - 0s - 3ms/step - loss: 0.0711 - val_loss: 0.1610
Epoch 24/80
104/104 - 0s - 3ms/step - loss: 0.0681 - val_loss: 0.1598
Epoch 25/80
104/104 - 0s - 3ms/step - loss: 0.0683 - val_loss: 0.1600
Epoch 26/80
104/104 - 0s - 3ms/step - loss: 0.0676 - val_loss: 0.1574
Epoch 27/80
104/104 - 0s - 3ms/step - loss: 0.0670 - val_loss: 0.1565
Epoch 28/80
104/104 - 0s - 3ms/step - loss: 0.0651 - val_loss: 0.1589
Epoch 29/80
104/104 - 0s - 3ms/step - loss: 0.0647 - val_loss: 0.1578
Epoch 30/80
104/104 - 0s - 3ms/step - loss: 0.0647 - val_loss: 0.1582
Epoch 31/80
104/104 - 0s - 3ms/step - loss: 0.0633 - val_loss: 0.1562
Epoch 32/80
104/104 - 0s - 3ms/step - loss: 0.0625 - val_loss: 0.1563
Epoch 33/80
104/104 - 0s - 3ms/step - loss: 0.0629 - val_loss: 0.1561
Epoch 34/80
104/104 - 0s - 3ms/step - loss: 0.0621 - val_loss: 0.1557
Epoch 35/80
104/104 - 0s - 3ms/step - loss: 0.0610 - val_loss: 0.1543
Epoch 36/80
104/104 - 0s - 3ms/step - loss: 0.0603 - val_loss: 0.1542
Epoch 37/80
104/104 - 0s - 3ms/step - loss: 0.0600 - val_loss: 0.1537
Epoch 38/80
104/104 - 0s - 3ms/step - loss: 0.0602 - val_loss: 0.1554
Epoch 39/80
104/104 - 0s - 3ms/step - loss: 0.0594 - val_loss: 0.1528
Epoch 40/80
104/104 - 0s - 3ms/step - loss: 0.0583 - val_loss: 0.1546
Epoch 41/80
104/104 - 0s - 3ms/step - loss: 0.0580 - val_loss: 0.1516
Epoch 42/80
104/104 - 0s - 3ms/step - loss: 0.0581 - val_loss: 0.1528
Epoch 43/80
104/104 - 0s - 3ms/step - loss: 0.0581 - val_loss: 0.1533
Epoch 44/80
104/104 - 0s - 3ms/step - loss: 0.0569 - val_loss: 0.1541
Epoch 45/80
104/104 - 0s - 3ms/step - loss: 0.0561 - val_loss: 0.1522
Epoch 46/80
104/104 - 0s - 3ms/step - loss: 0.0562 - val_loss: 0.1508
Epoch 47/80
104/104 - 0s - 3ms/step - loss: 0.0563 - val_loss: 0.1525
Epoch 48/80
104/104 - 0s - 3ms/step - loss: 0.0552 - val_loss: 0.1542
Epoch 49/80
104/104 - 0s - 3ms/step - loss: 0.0552 - val_loss: 0.1548
Epoch 50/80
104/104 - 0s - 3ms/step - loss: 0.0549 - val_loss: 0.1545
Epoch 51/80
104/104 - 0s - 3ms/step - loss: 0.0547 - val_loss: 0.1541
Epoch 52/80
104/104 - 0s - 3ms/step - loss: 0.0541 - val_loss: 0.1520
Epoch 53/80
104/104 - 0s - 3ms/step - loss: 0.0547 - val_loss: 0.1527
Epoch 54/80
104/104 - 0s - 3ms/step - loss: 0.0540 - val_loss: 0.1546
Epoch 55/80
104/104 - 0s - 3ms/step - loss: 0.0531 - val_loss: 0.1551
Epoch 56/80
104/104 - 0s - 3ms/step - loss: 0.0540 - val_loss: 0.1534
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5849
Per-joint RMSE: 0.6883 0.9174 0.6610 0.3346 0.2873 0.3258
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:30:01.411521: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:30:01.436428: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 07:30:02.286550: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:02.291147: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:02.292020: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:02.293789: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:02.294576: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:02.295306: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:02.367739: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:02.368574: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:02.369308: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:02.370038: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:30:02.659953: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.947035e-01  RMSE=7.033516e-01
  per-joint RMSE: 0.8777 1.0690 0.7738 0.4063 0.3762 0.3870
Residual LSTM:  MSE=3.421656e-01      RMSE=5.849492e-01
  per-joint RMSE: 0.6883 0.9174 0.6610 0.3346 0.2873 0.3258
Combined torque MSE=3.421656e-01     RMSE=5.849492e-01
  per-joint RMSE: 0.6883 0.9174 0.6610 0.3346 0.2873 0.3258
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300.npz --H 25 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300.json
H=25, n_dof=6, feature_dim=6
X_train: (33182, 25, 6)  Y_train: (33182, 6)
X_test : (19638, 25, 6)  Y_test : (19638, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:30:04.851031: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:30:04.874727: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (33182, 25, 6), Y_train = (33182, 6)
  X_test  = (19638, 25, 6),  Y_test  = (19638, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:30:05.872017: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:05.876674: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:05.878539: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:05.880309: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:05.881097: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:05.881833: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:05.957237: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:05.958071: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:05.958889: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:05.959614: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:30:06.874802: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
104/104 - 2s - 16ms/step - loss: 0.8090 - val_loss: 0.7267
Epoch 2/80
104/104 - 0s - 3ms/step - loss: 0.6252 - val_loss: 0.6263
Epoch 3/80
104/104 - 0s - 3ms/step - loss: 0.5114 - val_loss: 0.6019
Epoch 4/80
104/104 - 0s - 3ms/step - loss: 0.4275 - val_loss: 0.5810
Epoch 5/80
104/104 - 0s - 3ms/step - loss: 0.3490 - val_loss: 0.5526
Epoch 6/80
104/104 - 0s - 3ms/step - loss: 0.3232 - val_loss: 0.5043
Epoch 7/80
104/104 - 0s - 3ms/step - loss: 0.3172 - val_loss: 0.4251
Epoch 8/80
104/104 - 0s - 3ms/step - loss: 0.2909 - val_loss: 0.4373
Epoch 9/80
104/104 - 0s - 3ms/step - loss: 0.2557 - val_loss: 0.3597
Epoch 10/80
104/104 - 0s - 3ms/step - loss: 0.2290 - val_loss: 0.3304
Epoch 11/80
104/104 - 0s - 3ms/step - loss: 0.2428 - val_loss: 0.3726
Epoch 12/80
104/104 - 0s - 3ms/step - loss: 0.2369 - val_loss: 0.3204
Epoch 13/80
104/104 - 0s - 3ms/step - loss: 0.2095 - val_loss: 0.3417
Epoch 14/80
104/104 - 0s - 3ms/step - loss: 0.2009 - val_loss: 0.3098
Epoch 15/80
104/104 - 0s - 3ms/step - loss: 0.1828 - val_loss: 0.3063
Epoch 16/80
104/104 - 0s - 3ms/step - loss: 0.1856 - val_loss: 0.3038
Epoch 17/80
104/104 - 0s - 3ms/step - loss: 0.1693 - val_loss: 0.3143
Epoch 18/80
104/104 - 0s - 3ms/step - loss: 0.1740 - val_loss: 0.3040
Epoch 19/80
104/104 - 0s - 3ms/step - loss: 0.1915 - val_loss: 0.3595
Epoch 20/80
104/104 - 0s - 3ms/step - loss: 0.1741 - val_loss: 0.2946
Epoch 21/80
104/104 - 0s - 3ms/step - loss: 0.1537 - val_loss: 0.2817
Epoch 22/80
104/104 - 0s - 3ms/step - loss: 0.1447 - val_loss: 0.2933
Epoch 23/80
104/104 - 0s - 3ms/step - loss: 0.1536 - val_loss: 0.3150
Epoch 24/80
104/104 - 0s - 3ms/step - loss: 0.1456 - val_loss: 0.2898
Epoch 25/80
104/104 - 0s - 3ms/step - loss: 0.1468 - val_loss: 0.3013
Epoch 26/80
104/104 - 0s - 3ms/step - loss: 0.1376 - val_loss: 0.2908
Epoch 27/80
104/104 - 0s - 3ms/step - loss: 0.1394 - val_loss: 0.3121
Epoch 28/80
104/104 - 0s - 3ms/step - loss: 0.1343 - val_loss: 0.2935
Epoch 29/80
104/104 - 0s - 3ms/step - loss: 0.1346 - val_loss: 0.2858
Epoch 30/80
104/104 - 0s - 3ms/step - loss: 0.1327 - val_loss: 0.2864
Epoch 31/80
104/104 - 0s - 3ms/step - loss: 0.1330 - val_loss: 0.4349
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6454
Per-joint RMSE: 0.8193 0.9209 0.7366 0.4060 0.3613 0.3770
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:30:17.307666: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:30:17.331741: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 07:30:18.184888: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:18.189751: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:18.190548: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:18.192205: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:18.192996: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:18.193732: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:18.275848: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:18.276683: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:18.277421: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:18.278150: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:30:18.568814: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.947035e-01  RMSE=7.033516e-01
  per-joint RMSE: 0.8777 1.0690 0.7738 0.4063 0.3762 0.3870
Residual LSTM:  MSE=4.165903e-01      RMSE=6.454381e-01
  per-joint RMSE: 0.8193 0.9209 0.7366 0.4060 0.3613 0.3770
Combined torque MSE=4.165903e-01     RMSE=6.454381e-01
  per-joint RMSE: 0.8193 0.9209 0.7366 0.4060 0.3613 0.3770
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300.npz --H 25 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300.json
H=25, n_dof=6, feature_dim=18
X_train: (33182, 25, 18)  Y_train: (33182, 6)
X_test : (19638, 25, 18)  Y_test : (19638, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:30:20.847589: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:30:20.871878: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (33182, 25, 18), Y_train = (33182, 6)
  X_test  = (19638, 25, 18),  Y_test  = (19638, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:30:21.940345: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:21.944873: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:21.945663: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:21.947406: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:21.948189: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:21.948933: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:22.023155: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:22.023989: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:22.024732: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:22.025461: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:30:22.985989: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
104/104 - 2s - 16ms/step - loss: 0.3352 - val_loss: 0.3151
Epoch 2/80
104/104 - 0s - 3ms/step - loss: 0.1951 - val_loss: 0.2872
Epoch 3/80
104/104 - 0s - 3ms/step - loss: 0.1624 - val_loss: 0.2716
Epoch 4/80
104/104 - 0s - 3ms/step - loss: 0.1464 - val_loss: 0.2636
Epoch 5/80
104/104 - 0s - 3ms/step - loss: 0.1366 - val_loss: 0.2558
Epoch 6/80
104/104 - 0s - 3ms/step - loss: 0.1308 - val_loss: 0.2599
Epoch 7/80
104/104 - 0s - 3ms/step - loss: 0.1234 - val_loss: 0.2493
Epoch 8/80
104/104 - 0s - 3ms/step - loss: 0.1197 - val_loss: 0.2472
Epoch 9/80
104/104 - 0s - 3ms/step - loss: 0.1128 - val_loss: 0.2503
Epoch 10/80
104/104 - 0s - 3ms/step - loss: 0.1103 - val_loss: 0.2452
Epoch 11/80
104/104 - 0s - 3ms/step - loss: 0.1075 - val_loss: 0.2502
Epoch 12/80
104/104 - 0s - 3ms/step - loss: 0.1076 - val_loss: 0.2472
Epoch 13/80
104/104 - 0s - 3ms/step - loss: 0.1037 - val_loss: 0.2319
Epoch 14/80
104/104 - 0s - 3ms/step - loss: 0.0987 - val_loss: 0.2433
Epoch 15/80
104/104 - 0s - 3ms/step - loss: 0.0958 - val_loss: 0.2496
Epoch 16/80
104/104 - 0s - 3ms/step - loss: 0.0931 - val_loss: 0.2471
Epoch 17/80
104/104 - 0s - 3ms/step - loss: 0.0949 - val_loss: 0.2406
Epoch 18/80
104/104 - 0s - 3ms/step - loss: 0.0911 - val_loss: 0.2468
Epoch 19/80
104/104 - 0s - 3ms/step - loss: 0.0906 - val_loss: 0.2410
Epoch 20/80
104/104 - 0s - 3ms/step - loss: 0.0935 - val_loss: 0.2309
Epoch 21/80
104/104 - 0s - 3ms/step - loss: 0.0895 - val_loss: 0.2383
Epoch 22/80
104/104 - 0s - 3ms/step - loss: 0.0871 - val_loss: 0.2457
Epoch 23/80
104/104 - 0s - 3ms/step - loss: 0.0815 - val_loss: 0.2315
Epoch 24/80
104/104 - 0s - 3ms/step - loss: 0.0813 - val_loss: 0.2390
Epoch 25/80
104/104 - 0s - 3ms/step - loss: 0.0790 - val_loss: 0.2327
Epoch 26/80
104/104 - 0s - 3ms/step - loss: 0.0785 - val_loss: 0.2289
Epoch 27/80
104/104 - 0s - 3ms/step - loss: 0.0774 - val_loss: 0.2290
Epoch 28/80
104/104 - 0s - 3ms/step - loss: 0.0786 - val_loss: 0.2647
Epoch 29/80
104/104 - 0s - 3ms/step - loss: 0.0787 - val_loss: 0.2298
Epoch 30/80
104/104 - 0s - 3ms/step - loss: 0.0745 - val_loss: 0.2284
Epoch 31/80
104/104 - 0s - 3ms/step - loss: 0.0753 - val_loss: 0.2315
Epoch 32/80
104/104 - 0s - 3ms/step - loss: 0.0735 - val_loss: 0.2245
Epoch 33/80
104/104 - 0s - 3ms/step - loss: 0.0725 - val_loss: 0.2231
Epoch 34/80
104/104 - 0s - 3ms/step - loss: 0.0723 - val_loss: 0.2326
Epoch 35/80
104/104 - 0s - 3ms/step - loss: 0.0723 - val_loss: 0.2542
Epoch 36/80
104/104 - 0s - 3ms/step - loss: 0.0762 - val_loss: 0.2314
Epoch 37/80
104/104 - 0s - 3ms/step - loss: 0.0759 - val_loss: 0.2406
Epoch 38/80
104/104 - 0s - 3ms/step - loss: 0.0724 - val_loss: 0.2272
Epoch 39/80
104/104 - 0s - 3ms/step - loss: 0.0704 - val_loss: 0.2369
Epoch 40/80
104/104 - 0s - 3ms/step - loss: 0.0690 - val_loss: 0.2265
Epoch 41/80
104/104 - 0s - 3ms/step - loss: 0.0687 - val_loss: 0.2250
Epoch 42/80
104/104 - 0s - 3ms/step - loss: 0.0667 - val_loss: 0.2233
Epoch 43/80
104/104 - 0s - 3ms/step - loss: 0.0672 - val_loss: 0.2223
Epoch 44/80
104/104 - 0s - 3ms/step - loss: 0.0663 - val_loss: 0.2239
Epoch 45/80
104/104 - 0s - 3ms/step - loss: 0.0657 - val_loss: 0.2232
Epoch 46/80
104/104 - 0s - 3ms/step - loss: 0.0661 - val_loss: 0.2276
Epoch 47/80
104/104 - 0s - 3ms/step - loss: 0.0661 - val_loss: 0.2282
Epoch 48/80
104/104 - 0s - 3ms/step - loss: 0.0657 - val_loss: 0.2223
Epoch 49/80
104/104 - 0s - 3ms/step - loss: 0.0653 - val_loss: 0.2284
Epoch 50/80
104/104 - 0s - 3ms/step - loss: 0.0651 - val_loss: 0.2213
Epoch 51/80
104/104 - 0s - 3ms/step - loss: 0.0683 - val_loss: 0.2365
Epoch 52/80
104/104 - 0s - 3ms/step - loss: 0.0657 - val_loss: 0.2376
Epoch 53/80
104/104 - 0s - 3ms/step - loss: 0.0658 - val_loss: 0.2341
Epoch 54/80
104/104 - 0s - 3ms/step - loss: 0.0677 - val_loss: 0.2255
Epoch 55/80
104/104 - 0s - 3ms/step - loss: 0.0681 - val_loss: 0.2318
Epoch 56/80
104/104 - 0s - 3ms/step - loss: 0.0658 - val_loss: 0.2400
Epoch 57/80
104/104 - 0s - 3ms/step - loss: 0.0644 - val_loss: 0.2282
Epoch 58/80
104/104 - 0s - 3ms/step - loss: 0.0624 - val_loss: 0.2365
Epoch 59/80
104/104 - 0s - 3ms/step - loss: 0.0612 - val_loss: 0.2429
Epoch 60/80
104/104 - 0s - 3ms/step - loss: 0.0611 - val_loss: 0.2338
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6796
Per-joint RMSE: 0.8739 1.0173 0.7479 0.3795 0.3771 0.3561
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:30:41.536951: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:30:41.561605: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:30:42.426272: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:42.430826: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:42.431626: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:42.433321: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:42.434285: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:42.435021: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:42.514841: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:42.515670: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:42.516413: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:42.517149: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:30:42.818075: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.947035e-01  RMSE=7.033516e-01
  per-joint RMSE: 0.8777 1.0690 0.7738 0.4063 0.3762 0.3870
Residual LSTM:  MSE=4.618471e-01      RMSE=6.795933e-01
  per-joint RMSE: 0.8739 1.0173 0.7479 0.3795 0.3771 0.3561
Combined torque MSE=4.618471e-01     RMSE=6.795933e-01
  per-joint RMSE: 0.8739 1.0173 0.7479 0.3795 0.3771 0.3561
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300.npz --H 25 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300.json
H=25, n_dof=6, feature_dim=18
X_train: (33182, 25, 18)  Y_train: (33182, 6)
X_test : (19638, 25, 18)  Y_test : (19638, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:30:45.070123: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:30:45.093972: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (33182, 25, 18), Y_train = (33182, 6)
  X_test  = (19638, 25, 18),  Y_test  = (19638, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:30:46.154743: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:46.159400: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:46.160195: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:46.161959: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:46.162749: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:46.163480: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:46.247608: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:46.248446: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:46.249275: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:30:46.250006: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:30:47.204493: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
104/104 - 2s - 16ms/step - loss: 0.2862 - val_loss: 0.2545
Epoch 2/80
104/104 - 0s - 3ms/step - loss: 0.1615 - val_loss: 0.2129
Epoch 3/80
104/104 - 0s - 3ms/step - loss: 0.1346 - val_loss: 0.2006
Epoch 4/80
104/104 - 0s - 3ms/step - loss: 0.1222 - val_loss: 0.1916
Epoch 5/80
104/104 - 0s - 3ms/step - loss: 0.1120 - val_loss: 0.1836
Epoch 6/80
104/104 - 0s - 3ms/step - loss: 0.1054 - val_loss: 0.1791
Epoch 7/80
104/104 - 0s - 3ms/step - loss: 0.0999 - val_loss: 0.1743
Epoch 8/80
104/104 - 0s - 3ms/step - loss: 0.0962 - val_loss: 0.1705
Epoch 9/80
104/104 - 0s - 3ms/step - loss: 0.0931 - val_loss: 0.1710
Epoch 10/80
104/104 - 0s - 3ms/step - loss: 0.0893 - val_loss: 0.1663
Epoch 11/80
104/104 - 0s - 3ms/step - loss: 0.0872 - val_loss: 0.1668
Epoch 12/80
104/104 - 0s - 3ms/step - loss: 0.0854 - val_loss: 0.1631
Epoch 13/80
104/104 - 0s - 3ms/step - loss: 0.0839 - val_loss: 0.1615
Epoch 14/80
104/104 - 0s - 3ms/step - loss: 0.0810 - val_loss: 0.1622
Epoch 15/80
104/104 - 0s - 3ms/step - loss: 0.0798 - val_loss: 0.1622
Epoch 16/80
104/104 - 0s - 3ms/step - loss: 0.0793 - val_loss: 0.1593
Epoch 17/80
104/104 - 0s - 3ms/step - loss: 0.0776 - val_loss: 0.1597
Epoch 18/80
104/104 - 0s - 3ms/step - loss: 0.0755 - val_loss: 0.1582
Epoch 19/80
104/104 - 0s - 3ms/step - loss: 0.0757 - val_loss: 0.1580
Epoch 20/80
104/104 - 0s - 3ms/step - loss: 0.0737 - val_loss: 0.1549
Epoch 21/80
104/104 - 0s - 3ms/step - loss: 0.0728 - val_loss: 0.1543
Epoch 22/80
104/104 - 0s - 3ms/step - loss: 0.0718 - val_loss: 0.1556
Epoch 23/80
104/104 - 0s - 3ms/step - loss: 0.0715 - val_loss: 0.1554
Epoch 24/80
104/104 - 0s - 3ms/step - loss: 0.0704 - val_loss: 0.1542
Epoch 25/80
104/104 - 0s - 3ms/step - loss: 0.0684 - val_loss: 0.1536
Epoch 26/80
104/104 - 0s - 3ms/step - loss: 0.0674 - val_loss: 0.1520
Epoch 27/80
104/104 - 0s - 3ms/step - loss: 0.0684 - val_loss: 0.1522
Epoch 28/80
104/104 - 0s - 3ms/step - loss: 0.0664 - val_loss: 0.1499
Epoch 29/80
104/104 - 0s - 3ms/step - loss: 0.0661 - val_loss: 0.1504
Epoch 30/80
104/104 - 0s - 3ms/step - loss: 0.0651 - val_loss: 0.1508
Epoch 31/80
104/104 - 0s - 3ms/step - loss: 0.0645 - val_loss: 0.1514
Epoch 32/80
104/104 - 0s - 3ms/step - loss: 0.0642 - val_loss: 0.1486
Epoch 33/80
104/104 - 0s - 3ms/step - loss: 0.0639 - val_loss: 0.1508
Epoch 34/80
104/104 - 0s - 3ms/step - loss: 0.0635 - val_loss: 0.1497
Epoch 35/80
104/104 - 0s - 3ms/step - loss: 0.0629 - val_loss: 0.1476
Epoch 36/80
104/104 - 0s - 3ms/step - loss: 0.0619 - val_loss: 0.1517
Epoch 37/80
104/104 - 0s - 3ms/step - loss: 0.0625 - val_loss: 0.1466
Epoch 38/80
104/104 - 0s - 3ms/step - loss: 0.0612 - val_loss: 0.1483
Epoch 39/80
104/104 - 0s - 3ms/step - loss: 0.0605 - val_loss: 0.1476
Epoch 40/80
104/104 - 0s - 3ms/step - loss: 0.0593 - val_loss: 0.1484
Epoch 41/80
104/104 - 0s - 3ms/step - loss: 0.0598 - val_loss: 0.1478
Epoch 42/80
104/104 - 0s - 3ms/step - loss: 0.0593 - val_loss: 0.1496
Epoch 43/80
104/104 - 0s - 3ms/step - loss: 0.0587 - val_loss: 0.1485
Epoch 44/80
104/104 - 0s - 3ms/step - loss: 0.0584 - val_loss: 0.1496
Epoch 45/80
104/104 - 0s - 3ms/step - loss: 0.0587 - val_loss: 0.1482
Epoch 46/80
104/104 - 0s - 3ms/step - loss: 0.0578 - val_loss: 0.1483
Epoch 47/80
104/104 - 0s - 3ms/step - loss: 0.0581 - val_loss: 0.1483
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6045
Per-joint RMSE: 0.6954 0.9614 0.6903 0.3399 0.3038 0.3161
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:31:02.125558: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:31:02.149956: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:31:02.997644: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:03.002292: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:03.003205: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:03.004892: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:03.005805: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:03.006678: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:03.101340: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:03.102227: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:03.103029: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:03.103807: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:31:03.410717: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.947035e-01  RMSE=7.033516e-01
  per-joint RMSE: 0.8777 1.0690 0.7738 0.4063 0.3762 0.3870
Residual LSTM:  MSE=3.653872e-01      RMSE=6.044726e-01
  per-joint RMSE: 0.6954 0.9614 0.6903 0.3399 0.3038 0.3161
Combined torque MSE=3.653872e-01     RMSE=6.044726e-01
  per-joint RMSE: 0.6954 0.9614 0.6903 0.3399 0.3038 0.3161
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300.npz --H 50 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300.json
H=50, n_dof=6, feature_dim=24
X_train: (32332, 50, 24)  Y_train: (32332, 6)
X_test : (19263, 50, 24)  Y_test : (19263, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:31:05.729985: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:31:05.753714: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (32332, 50, 24), Y_train = (32332, 6)
  X_test  = (19263, 50, 24),  Y_test  = (19263, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:31:07.085524: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:07.090265: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:07.091167: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:07.092955: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:07.093856: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:07.094702: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:07.187018: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:07.187904: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:07.188696: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:07.189473: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:31:08.262220: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
102/102 - 2s - 17ms/step - loss: 0.2957 - val_loss: 0.2872
Epoch 2/80
102/102 - 0s - 4ms/step - loss: 0.1742 - val_loss: 0.2371
Epoch 3/80
102/102 - 0s - 4ms/step - loss: 0.1436 - val_loss: 0.2141
Epoch 4/80
102/102 - 0s - 4ms/step - loss: 0.1268 - val_loss: 0.2003
Epoch 5/80
102/102 - 0s - 4ms/step - loss: 0.1182 - val_loss: 0.1904
Epoch 6/80
102/102 - 0s - 4ms/step - loss: 0.1100 - val_loss: 0.1816
Epoch 7/80
102/102 - 0s - 4ms/step - loss: 0.1058 - val_loss: 0.1795
Epoch 8/80
102/102 - 0s - 4ms/step - loss: 0.0991 - val_loss: 0.1783
Epoch 9/80
102/102 - 0s - 4ms/step - loss: 0.0983 - val_loss: 0.1773
Epoch 10/80
102/102 - 0s - 4ms/step - loss: 0.0940 - val_loss: 0.1742
Epoch 11/80
102/102 - 0s - 5ms/step - loss: 0.0919 - val_loss: 0.1754
Epoch 12/80
102/102 - 0s - 4ms/step - loss: 0.0882 - val_loss: 0.1741
Epoch 13/80
102/102 - 0s - 4ms/step - loss: 0.0857 - val_loss: 0.1721
Epoch 14/80
102/102 - 0s - 4ms/step - loss: 0.0847 - val_loss: 0.1727
Epoch 15/80
102/102 - 0s - 4ms/step - loss: 0.0830 - val_loss: 0.1682
Epoch 16/80
102/102 - 0s - 4ms/step - loss: 0.0794 - val_loss: 0.1708
Epoch 17/80
102/102 - 0s - 4ms/step - loss: 0.0788 - val_loss: 0.1676
Epoch 18/80
102/102 - 0s - 4ms/step - loss: 0.0776 - val_loss: 0.1700
Epoch 19/80
102/102 - 0s - 4ms/step - loss: 0.0782 - val_loss: 0.1669
Epoch 20/80
102/102 - 0s - 4ms/step - loss: 0.0768 - val_loss: 0.1683
Epoch 21/80
102/102 - 0s - 4ms/step - loss: 0.0766 - val_loss: 0.1659
Epoch 22/80
102/102 - 0s - 4ms/step - loss: 0.0734 - val_loss: 0.1642
Epoch 23/80
102/102 - 0s - 4ms/step - loss: 0.0747 - val_loss: 0.1671
Epoch 24/80
102/102 - 0s - 4ms/step - loss: 0.0718 - val_loss: 0.1640
Epoch 25/80
102/102 - 0s - 4ms/step - loss: 0.0700 - val_loss: 0.1630
Epoch 26/80
102/102 - 0s - 4ms/step - loss: 0.0690 - val_loss: 0.1636
Epoch 27/80
102/102 - 0s - 4ms/step - loss: 0.0695 - val_loss: 0.1621
Epoch 28/80
102/102 - 0s - 4ms/step - loss: 0.0676 - val_loss: 0.1598
Epoch 29/80
102/102 - 0s - 4ms/step - loss: 0.0673 - val_loss: 0.1612
Epoch 30/80
102/102 - 0s - 4ms/step - loss: 0.0670 - val_loss: 0.1606
Epoch 31/80
102/102 - 0s - 4ms/step - loss: 0.0657 - val_loss: 0.1594
Epoch 32/80
102/102 - 0s - 4ms/step - loss: 0.0641 - val_loss: 0.1609
Epoch 33/80
102/102 - 0s - 4ms/step - loss: 0.0643 - val_loss: 0.1615
Epoch 34/80
102/102 - 0s - 4ms/step - loss: 0.0648 - val_loss: 0.1585
Epoch 35/80
102/102 - 0s - 4ms/step - loss: 0.0640 - val_loss: 0.1608
Epoch 36/80
102/102 - 0s - 4ms/step - loss: 0.0657 - val_loss: 0.1582
Epoch 37/80
102/102 - 0s - 4ms/step - loss: 0.0632 - val_loss: 0.1586
Epoch 38/80
102/102 - 0s - 4ms/step - loss: 0.0620 - val_loss: 0.1571
Epoch 39/80
102/102 - 0s - 4ms/step - loss: 0.0614 - val_loss: 0.1579
Epoch 40/80
102/102 - 0s - 4ms/step - loss: 0.0611 - val_loss: 0.1549
Epoch 41/80
102/102 - 0s - 4ms/step - loss: 0.0601 - val_loss: 0.1562
Epoch 42/80
102/102 - 0s - 4ms/step - loss: 0.0602 - val_loss: 0.1558
Epoch 43/80
102/102 - 0s - 4ms/step - loss: 0.0603 - val_loss: 0.1569
Epoch 44/80
102/102 - 0s - 4ms/step - loss: 0.0594 - val_loss: 0.1596
Epoch 45/80
102/102 - 0s - 4ms/step - loss: 0.0586 - val_loss: 0.1547
Epoch 46/80
102/102 - 0s - 4ms/step - loss: 0.0590 - val_loss: 0.1556
Epoch 47/80
102/102 - 0s - 4ms/step - loss: 0.0594 - val_loss: 0.1547
Epoch 48/80
102/102 - 0s - 4ms/step - loss: 0.0580 - val_loss: 0.1562
Epoch 49/80
102/102 - 0s - 4ms/step - loss: 0.0601 - val_loss: 0.1534
Epoch 50/80
102/102 - 0s - 4ms/step - loss: 0.0571 - val_loss: 0.1558
Epoch 51/80
102/102 - 0s - 4ms/step - loss: 0.0564 - val_loss: 0.1535
Epoch 52/80
102/102 - 0s - 4ms/step - loss: 0.0562 - val_loss: 0.1527
Epoch 53/80
102/102 - 0s - 4ms/step - loss: 0.0564 - val_loss: 0.1538
Epoch 54/80
102/102 - 0s - 4ms/step - loss: 0.0560 - val_loss: 0.1536
Epoch 55/80
102/102 - 0s - 4ms/step - loss: 0.0550 - val_loss: 0.1537
Epoch 56/80
102/102 - 0s - 4ms/step - loss: 0.0556 - val_loss: 0.1515
Epoch 57/80
102/102 - 0s - 4ms/step - loss: 0.0556 - val_loss: 0.1502
Epoch 58/80
102/102 - 0s - 4ms/step - loss: 0.0541 - val_loss: 0.1507
Epoch 59/80
102/102 - 0s - 4ms/step - loss: 0.0544 - val_loss: 0.1516
Epoch 60/80
102/102 - 0s - 4ms/step - loss: 0.0535 - val_loss: 0.1550
Epoch 61/80
102/102 - 0s - 4ms/step - loss: 0.0543 - val_loss: 0.1521
Epoch 62/80
102/102 - 0s - 4ms/step - loss: 0.0530 - val_loss: 0.1541
Epoch 63/80
102/102 - 0s - 4ms/step - loss: 0.0529 - val_loss: 0.1514
Epoch 64/80
102/102 - 0s - 4ms/step - loss: 0.0531 - val_loss: 0.1498
Epoch 65/80
102/102 - 0s - 4ms/step - loss: 0.0521 - val_loss: 0.1518
Epoch 66/80
102/102 - 0s - 4ms/step - loss: 0.0516 - val_loss: 0.1514
Epoch 67/80
102/102 - 0s - 4ms/step - loss: 0.0522 - val_loss: 0.1539
Epoch 68/80
102/102 - 0s - 4ms/step - loss: 0.0533 - val_loss: 0.1532
Epoch 69/80
102/102 - 0s - 4ms/step - loss: 0.0510 - val_loss: 0.1500
Epoch 70/80
102/102 - 0s - 4ms/step - loss: 0.0511 - val_loss: 0.1522
Epoch 71/80
102/102 - 0s - 4ms/step - loss: 0.0521 - val_loss: 0.1511
Epoch 72/80
102/102 - 0s - 4ms/step - loss: 0.0510 - val_loss: 0.1514
Epoch 73/80
102/102 - 0s - 4ms/step - loss: 0.0500 - val_loss: 0.1510
Epoch 74/80
102/102 - 0s - 4ms/step - loss: 0.0502 - val_loss: 0.1531
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5923
Per-joint RMSE: 0.7013 0.9118 0.6838 0.3399 0.2964 0.3328
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:31:40.445846: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:31:40.470956: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 07:31:41.328436: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:41.333038: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:41.333827: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:41.335505: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:41.336285: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:41.337022: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:41.411682: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:41.412519: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:41.413264: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:41.413990: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8959 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:31:41.719030: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.995069e-01  RMSE=7.067580e-01
  per-joint RMSE: 0.8825 1.0723 0.7787 0.4083 0.3790 0.3894
Residual LSTM:  MSE=3.508376e-01      RMSE=5.923154e-01
  per-joint RMSE: 0.7013 0.9118 0.6838 0.3399 0.2964 0.3328
Combined torque MSE=3.508375e-01     RMSE=5.923154e-01
  per-joint RMSE: 0.7013 0.9118 0.6838 0.3399 0.2964 0.3328
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300.npz --H 50 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300.json
H=50, n_dof=6, feature_dim=6
X_train: (32332, 50, 6)  Y_train: (32332, 6)
X_test : (19263, 50, 6)  Y_test : (19263, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:31:43.991274: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:31:44.015377: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (32332, 50, 6), Y_train = (32332, 6)
  X_test  = (19263, 50, 6),  Y_test  = (19263, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:31:45.068064: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:45.072542: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:45.073331: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:45.074935: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:45.075716: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:45.076451: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:45.151855: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:45.152777: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:45.153615: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:31:45.154346: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:31:46.125742: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
102/102 - 2s - 18ms/step - loss: 0.7532 - val_loss: 0.7086
Epoch 2/80
102/102 - 0s - 4ms/step - loss: 0.5375 - val_loss: 0.8775
Epoch 3/80
102/102 - 0s - 4ms/step - loss: 0.4772 - val_loss: 0.5126
Epoch 4/80
102/102 - 0s - 4ms/step - loss: 0.3741 - val_loss: 0.4755
Epoch 5/80
102/102 - 0s - 4ms/step - loss: 0.2899 - val_loss: 0.3690
Epoch 6/80
102/102 - 0s - 4ms/step - loss: 0.2432 - val_loss: 0.3488
Epoch 7/80
102/102 - 0s - 4ms/step - loss: 0.2161 - val_loss: 0.3696
Epoch 8/80
102/102 - 0s - 4ms/step - loss: 0.2134 - val_loss: 0.3216
Epoch 9/80
102/102 - 0s - 4ms/step - loss: 0.2019 - val_loss: 0.3321
Epoch 10/80
102/102 - 0s - 4ms/step - loss: 0.2297 - val_loss: 0.3134
Epoch 11/80
102/102 - 0s - 5ms/step - loss: 0.1797 - val_loss: 0.3020
Epoch 12/80
102/102 - 0s - 4ms/step - loss: 0.1593 - val_loss: 0.3067
Epoch 13/80
102/102 - 0s - 4ms/step - loss: 0.1583 - val_loss: 0.3076
Epoch 14/80
102/102 - 0s - 4ms/step - loss: 0.1469 - val_loss: 0.3157
Epoch 15/80
102/102 - 0s - 4ms/step - loss: 0.1955 - val_loss: 0.3238
Epoch 16/80
102/102 - 0s - 4ms/step - loss: 0.1442 - val_loss: 0.3019
Epoch 17/80
102/102 - 0s - 4ms/step - loss: 0.1336 - val_loss: 0.3316
Epoch 18/80
102/102 - 0s - 4ms/step - loss: 0.1417 - val_loss: 0.3023
Epoch 19/80
102/102 - 0s - 4ms/step - loss: 0.1293 - val_loss: 0.3182
Epoch 20/80
102/102 - 0s - 4ms/step - loss: 0.1286 - val_loss: 0.3080
Epoch 21/80
102/102 - 0s - 4ms/step - loss: 0.1197 - val_loss: 0.2978
Epoch 22/80
102/102 - 0s - 4ms/step - loss: 0.1237 - val_loss: 0.3108
Epoch 23/80
102/102 - 0s - 4ms/step - loss: 0.1181 - val_loss: 0.4325
Epoch 24/80
102/102 - 0s - 4ms/step - loss: 0.2577 - val_loss: 0.3308
Epoch 25/80
102/102 - 0s - 4ms/step - loss: 0.1548 - val_loss: 0.3545
Epoch 26/80
102/102 - 0s - 4ms/step - loss: 0.1270 - val_loss: 0.3337
Epoch 27/80
102/102 - 0s - 4ms/step - loss: 0.1244 - val_loss: 0.3355
Epoch 28/80
102/102 - 0s - 4ms/step - loss: 0.1429 - val_loss: 0.3532
Epoch 29/80
102/102 - 0s - 4ms/step - loss: 0.1211 - val_loss: 0.2907
Epoch 30/80
102/102 - 0s - 4ms/step - loss: 0.1109 - val_loss: 0.2911
Epoch 31/80
102/102 - 0s - 4ms/step - loss: 0.1037 - val_loss: 0.3248
Epoch 32/80
102/102 - 0s - 4ms/step - loss: 0.1112 - val_loss: 0.3372
Epoch 33/80
102/102 - 0s - 4ms/step - loss: 0.1164 - val_loss: 0.3114
Epoch 34/80
102/102 - 0s - 4ms/step - loss: 0.1072 - val_loss: 0.3276
Epoch 35/80
102/102 - 0s - 4ms/step - loss: 0.1017 - val_loss: 0.3091
Epoch 36/80
102/102 - 0s - 4ms/step - loss: 0.1022 - val_loss: 0.3210
Epoch 37/80
102/102 - 0s - 4ms/step - loss: 0.1020 - val_loss: 0.3079
Epoch 38/80
102/102 - 0s - 4ms/step - loss: 0.0962 - val_loss: 0.3097
Epoch 39/80
102/102 - 0s - 4ms/step - loss: 0.0966 - val_loss: 0.3254
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6617
Per-joint RMSE: 0.8330 0.9699 0.7314 0.4071 0.3827 0.3816
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:32:03.812704: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:32:03.837056: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 07:32:04.683703: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:04.688377: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:04.689256: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:04.690957: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:04.691752: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:04.692498: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:04.770728: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:04.771571: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:04.772374: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:04.773112: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:32:05.077419: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.995069e-01  RMSE=7.067580e-01
  per-joint RMSE: 0.8825 1.0723 0.7787 0.4083 0.3790 0.3894
Residual LSTM:  MSE=4.378987e-01      RMSE=6.617392e-01
  per-joint RMSE: 0.8330 0.9699 0.7314 0.4071 0.3827 0.3816
Combined torque MSE=4.378987e-01     RMSE=6.617392e-01
  per-joint RMSE: 0.8330 0.9699 0.7314 0.4071 0.3827 0.3816
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300.npz --H 50 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300.json
H=50, n_dof=6, feature_dim=18
X_train: (32332, 50, 18)  Y_train: (32332, 6)
X_test : (19263, 50, 18)  Y_test : (19263, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:32:07.431708: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:32:07.455992: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (32332, 50, 18), Y_train = (32332, 6)
  X_test  = (19263, 50, 18),  Y_test  = (19263, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:32:08.672777: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:08.677948: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:08.678863: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:08.680642: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:08.681551: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:08.682405: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:08.775539: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:08.776435: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:08.777251: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:08.778029: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:32:09.783041: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
102/102 - 2s - 17ms/step - loss: 0.3335 - val_loss: 0.3196
Epoch 2/80
102/102 - 0s - 4ms/step - loss: 0.2012 - val_loss: 0.2856
Epoch 3/80
102/102 - 0s - 4ms/step - loss: 0.1736 - val_loss: 0.2666
Epoch 4/80
102/102 - 0s - 4ms/step - loss: 0.1542 - val_loss: 0.2564
Epoch 5/80
102/102 - 0s - 4ms/step - loss: 0.1470 - val_loss: 0.2445
Epoch 6/80
102/102 - 0s - 4ms/step - loss: 0.1369 - val_loss: 0.2505
Epoch 7/80
102/102 - 0s - 4ms/step - loss: 0.1291 - val_loss: 0.2426
Epoch 8/80
102/102 - 0s - 4ms/step - loss: 0.1226 - val_loss: 0.2419
Epoch 9/80
102/102 - 0s - 4ms/step - loss: 0.1149 - val_loss: 0.2478
Epoch 10/80
102/102 - 0s - 4ms/step - loss: 0.1180 - val_loss: 0.2403
Epoch 11/80
102/102 - 0s - 5ms/step - loss: 0.1088 - val_loss: 0.2252
Epoch 12/80
102/102 - 0s - 4ms/step - loss: 0.1079 - val_loss: 0.2446
Epoch 13/80
102/102 - 0s - 4ms/step - loss: 0.1054 - val_loss: 0.2382
Epoch 14/80
102/102 - 0s - 4ms/step - loss: 0.1044 - val_loss: 0.2319
Epoch 15/80
102/102 - 0s - 4ms/step - loss: 0.1008 - val_loss: 0.2252
Epoch 16/80
102/102 - 0s - 4ms/step - loss: 0.1022 - val_loss: 0.2375
Epoch 17/80
102/102 - 0s - 4ms/step - loss: 0.0953 - val_loss: 0.2319
Epoch 18/80
102/102 - 0s - 4ms/step - loss: 0.0923 - val_loss: 0.2275
Epoch 19/80
102/102 - 0s - 4ms/step - loss: 0.0905 - val_loss: 0.2253
Epoch 20/80
102/102 - 0s - 4ms/step - loss: 0.0880 - val_loss: 0.2249
Epoch 21/80
102/102 - 0s - 4ms/step - loss: 0.0856 - val_loss: 0.2288
Epoch 22/80
102/102 - 0s - 4ms/step - loss: 0.0855 - val_loss: 0.2384
Epoch 23/80
102/102 - 0s - 4ms/step - loss: 0.0813 - val_loss: 0.2372
Epoch 24/80
102/102 - 0s - 4ms/step - loss: 0.0817 - val_loss: 0.2465
Epoch 25/80
102/102 - 0s - 4ms/step - loss: 0.0809 - val_loss: 0.2219
Epoch 26/80
102/102 - 0s - 4ms/step - loss: 0.0796 - val_loss: 0.2325
Epoch 27/80
102/102 - 0s - 4ms/step - loss: 0.0793 - val_loss: 0.2272
Epoch 28/80
102/102 - 0s - 4ms/step - loss: 0.0774 - val_loss: 0.2395
Epoch 29/80
102/102 - 0s - 4ms/step - loss: 0.0803 - val_loss: 0.2396
Epoch 30/80
102/102 - 0s - 4ms/step - loss: 0.0836 - val_loss: 0.2156
Epoch 31/80
102/102 - 0s - 4ms/step - loss: 0.0819 - val_loss: 0.2126
Epoch 32/80
102/102 - 0s - 4ms/step - loss: 0.0818 - val_loss: 0.2157
Epoch 33/80
102/102 - 0s - 4ms/step - loss: 0.0803 - val_loss: 0.2139
Epoch 34/80
102/102 - 0s - 4ms/step - loss: 0.0791 - val_loss: 0.2102
Epoch 35/80
102/102 - 0s - 4ms/step - loss: 0.0784 - val_loss: 0.2087
Epoch 36/80
102/102 - 0s - 4ms/step - loss: 0.0752 - val_loss: 0.2133
Epoch 37/80
102/102 - 0s - 4ms/step - loss: 0.0732 - val_loss: 0.2216
Epoch 38/80
102/102 - 0s - 4ms/step - loss: 0.0729 - val_loss: 0.2222
Epoch 39/80
102/102 - 0s - 4ms/step - loss: 0.0733 - val_loss: 0.2274
Epoch 40/80
102/102 - 0s - 4ms/step - loss: 0.0728 - val_loss: 0.2354
Epoch 41/80
102/102 - 0s - 4ms/step - loss: 0.0716 - val_loss: 0.2261
Epoch 42/80
102/102 - 0s - 4ms/step - loss: 0.0702 - val_loss: 0.2258
Epoch 43/80
102/102 - 0s - 4ms/step - loss: 0.0682 - val_loss: 0.2223
Epoch 44/80
102/102 - 0s - 4ms/step - loss: 0.0684 - val_loss: 0.2201
Epoch 45/80
102/102 - 0s - 4ms/step - loss: 0.0676 - val_loss: 0.2238
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6869
Per-joint RMSE: 0.8619 1.0241 0.7855 0.3851 0.3761 0.3640
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:32:30.345590: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:32:30.370957: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:32:31.225489: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:31.230148: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:31.230943: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:31.232807: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:31.233608: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:31.234418: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:31.318213: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:31.319049: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:31.319795: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:31.320528: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:32:31.632558: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.995069e-01  RMSE=7.067580e-01
  per-joint RMSE: 0.8825 1.0723 0.7787 0.4083 0.3790 0.3894
Residual LSTM:  MSE=4.718068e-01      RMSE=6.868820e-01
  per-joint RMSE: 0.8619 1.0241 0.7855 0.3851 0.3761 0.3640
Combined torque MSE=4.718068e-01     RMSE=6.868820e-01
  per-joint RMSE: 0.8619 1.0241 0.7855 0.3851 0.3761 0.3640
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300.npz --H 50 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300.json
H=50, n_dof=6, feature_dim=18
X_train: (32332, 50, 18)  Y_train: (32332, 6)
X_test : (19263, 50, 18)  Y_test : (19263, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:32:33.995455: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:32:34.019105: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (32332, 50, 18), Y_train = (32332, 6)
  X_test  = (19263, 50, 18),  Y_test  = (19263, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:32:35.235907: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:35.240748: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:35.241661: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:35.243306: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:35.244203: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:35.245058: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:35.332881: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:35.333860: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:35.334650: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:32:35.335438: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:32:36.339897: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
102/102 - 2s - 17ms/step - loss: 0.2951 - val_loss: 0.2896
Epoch 2/80
102/102 - 0s - 4ms/step - loss: 0.1753 - val_loss: 0.2170
Epoch 3/80
102/102 - 0s - 4ms/step - loss: 0.1435 - val_loss: 0.2025
Epoch 4/80
102/102 - 0s - 4ms/step - loss: 0.1286 - val_loss: 0.1890
Epoch 5/80
102/102 - 0s - 4ms/step - loss: 0.1202 - val_loss: 0.1842
Epoch 6/80
102/102 - 0s - 4ms/step - loss: 0.1115 - val_loss: 0.1789
Epoch 7/80
102/102 - 0s - 4ms/step - loss: 0.1075 - val_loss: 0.1711
Epoch 8/80
102/102 - 0s - 4ms/step - loss: 0.1004 - val_loss: 0.1709
Epoch 9/80
102/102 - 0s - 4ms/step - loss: 0.0968 - val_loss: 0.1733
Epoch 10/80
102/102 - 0s - 4ms/step - loss: 0.0971 - val_loss: 0.1670
Epoch 11/80
102/102 - 0s - 5ms/step - loss: 0.0930 - val_loss: 0.1696
Epoch 12/80
102/102 - 0s - 4ms/step - loss: 0.0899 - val_loss: 0.1684
Epoch 13/80
102/102 - 0s - 4ms/step - loss: 0.0877 - val_loss: 0.1686
Epoch 14/80
102/102 - 0s - 4ms/step - loss: 0.0849 - val_loss: 0.1639
Epoch 15/80
102/102 - 0s - 4ms/step - loss: 0.0825 - val_loss: 0.1664
Epoch 16/80
102/102 - 0s - 4ms/step - loss: 0.0808 - val_loss: 0.1688
Epoch 17/80
102/102 - 0s - 4ms/step - loss: 0.0793 - val_loss: 0.1653
Epoch 18/80
102/102 - 0s - 4ms/step - loss: 0.0780 - val_loss: 0.1689
Epoch 19/80
102/102 - 0s - 4ms/step - loss: 0.0776 - val_loss: 0.1657
Epoch 20/80
102/102 - 0s - 4ms/step - loss: 0.0751 - val_loss: 0.1632
Epoch 21/80
102/102 - 0s - 4ms/step - loss: 0.0747 - val_loss: 0.1623
Epoch 22/80
102/102 - 0s - 4ms/step - loss: 0.0738 - val_loss: 0.1638
Epoch 23/80
102/102 - 0s - 4ms/step - loss: 0.0733 - val_loss: 0.1618
Epoch 24/80
102/102 - 0s - 4ms/step - loss: 0.0736 - val_loss: 0.1627
Epoch 25/80
102/102 - 0s - 4ms/step - loss: 0.0718 - val_loss: 0.1630
Epoch 26/80
102/102 - 0s - 4ms/step - loss: 0.0701 - val_loss: 0.1605
Epoch 27/80
102/102 - 0s - 4ms/step - loss: 0.0695 - val_loss: 0.1603
Epoch 28/80
102/102 - 0s - 4ms/step - loss: 0.0690 - val_loss: 0.1607
Epoch 29/80
102/102 - 0s - 4ms/step - loss: 0.0678 - val_loss: 0.1579
Epoch 30/80
102/102 - 0s - 4ms/step - loss: 0.0670 - val_loss: 0.1590
Epoch 31/80
102/102 - 0s - 4ms/step - loss: 0.0660 - val_loss: 0.1574
Epoch 32/80
102/102 - 0s - 4ms/step - loss: 0.0660 - val_loss: 0.1591
Epoch 33/80
102/102 - 0s - 4ms/step - loss: 0.0649 - val_loss: 0.1569
Epoch 34/80
102/102 - 0s - 4ms/step - loss: 0.0644 - val_loss: 0.1586
Epoch 35/80
102/102 - 0s - 4ms/step - loss: 0.0646 - val_loss: 0.1562
Epoch 36/80
102/102 - 0s - 4ms/step - loss: 0.0657 - val_loss: 0.1572
Epoch 37/80
102/102 - 0s - 4ms/step - loss: 0.0640 - val_loss: 0.1548
Epoch 38/80
102/102 - 0s - 4ms/step - loss: 0.0623 - val_loss: 0.1563
Epoch 39/80
102/102 - 0s - 4ms/step - loss: 0.0615 - val_loss: 0.1549
Epoch 40/80
102/102 - 0s - 4ms/step - loss: 0.0622 - val_loss: 0.1549
Epoch 41/80
102/102 - 0s - 4ms/step - loss: 0.0623 - val_loss: 0.1520
Epoch 42/80
102/102 - 0s - 4ms/step - loss: 0.0602 - val_loss: 0.1529
Epoch 43/80
102/102 - 0s - 4ms/step - loss: 0.0603 - val_loss: 0.1525
Epoch 44/80
102/102 - 0s - 4ms/step - loss: 0.0598 - val_loss: 0.1534
Epoch 45/80
102/102 - 0s - 4ms/step - loss: 0.0584 - val_loss: 0.1536
Epoch 46/80
102/102 - 0s - 4ms/step - loss: 0.0587 - val_loss: 0.1521
Epoch 47/80
102/102 - 0s - 4ms/step - loss: 0.0578 - val_loss: 0.1563
Epoch 48/80
102/102 - 0s - 4ms/step - loss: 0.0583 - val_loss: 0.1521
Epoch 49/80
102/102 - 0s - 4ms/step - loss: 0.0571 - val_loss: 0.1524
Epoch 50/80
102/102 - 0s - 4ms/step - loss: 0.0572 - val_loss: 0.1545
Epoch 51/80
102/102 - 0s - 4ms/step - loss: 0.0567 - val_loss: 0.1539
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6093
Per-joint RMSE: 0.7247 0.9574 0.6803 0.3565 0.2991 0.3266
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:32:59.399884: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:32:59.425056: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:33:00.277376: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:33:00.282014: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:33:00.282811: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:33:00.284680: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:33:00.285471: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:33:00.286206: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:33:00.363177: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:33:00.364019: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:33:00.364853: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:33:00.365594: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:33:00.678345: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.995069e-01  RMSE=7.067580e-01
  per-joint RMSE: 0.8825 1.0723 0.7787 0.4083 0.3790 0.3894
Residual LSTM:  MSE=3.713062e-01      RMSE=6.093490e-01
  per-joint RMSE: 0.7247 0.9574 0.6803 0.3565 0.2991 0.3266
Combined torque MSE=3.713062e-01     RMSE=6.093490e-01
  per-joint RMSE: 0.7247 0.9574 0.6803 0.3565 0.2991 0.3266
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=1                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz                                ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed0_dataset.npz -t structured -s 1 -r 0 --hp_preset fast_debug --epochs 300 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300.jax' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 300, 'lagrangian_type': <function structured_lagrangian_fn at 0x7bea2054c1f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed0_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed0_dataset.npz
   dt ≈ 0.022972524931080995
  dof = 6
  Train trajectories = 70
  Test trajectories  = 30
  Train samples = 34106
  Test samples  = 20043
################################################

2026-01-22 07:33:05.295210: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300 | type=structured | dof=6
################################################
2026-01-22 07:33:08.451605: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:33:08.451640: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:33:08.451646: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:33:08.451673: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:33:08.451678: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:33:08.451693: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:33:08.451730: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:33:08.451736: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:33:08.451751: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:33:08.451756: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.0s, Loss=1.18e+01, Inv=1.18e+01, For=1.74e+02, Power=2.44e+00
  [eval] test_mse=2.510e+00  (n=20043)
Epoch 00050: Time=  10.6s, Loss=2.68e+00, Inv=2.68e+00, For=9.73e+01, Power=1.33e+00
Epoch 00100: Time=  14.9s, Loss=2.44e+00, Inv=2.44e+00, For=1.08e+02, Power=1.19e+00
Epoch 00150: Time=  19.1s, Loss=2.31e+00, Inv=2.31e+00, For=1.22e+02, Power=1.13e+00
Epoch 00200: Time=  23.5s, Loss=2.24e+00, Inv=2.24e+00, For=1.50e+02, Power=1.09e+00
  [eval] test_mse=2.388e+00  (n=20043)
Epoch 00250: Time=  28.5s, Loss=2.19e+00, Inv=2.19e+00, For=1.74e+02, Power=1.08e+00
Epoch 00300: Time=  33.2s, Loss=2.16e+00, Inv=2.16e+00, For=1.86e+02, Power=1.07e+00
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300
Torque MSE  = 4.554e-01
Torque RMSE = 6.749e-01
Per-joint MSE : 7.390e-01 1.038e+00 5.078e-01 1.557e-01 1.491e-01 1.432e-01
Per-joint RMSE: 8.596e-01 1.019e+00 7.126e-01 3.946e-01 3.861e-01 3.784e-01
Comp Time per Sample = 1.497e-08s / 66779059.1Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed0_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed0_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300.jax
Detected n_dof=6 (seed=1)
2026-01-22 07:33:43.720575: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 70 trajectories
2026-01-22 07:33:45.016351: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:33:45.016365: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:33:46.574893: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:33:46.574908: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:33:48.178256: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/70
  done 50/70
2026-01-22 07:33:50.630938: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:33:51.796265: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 70/70

Exporting split=test: 30 trajectories
  done 25/30
  done 30/30

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300.npz --H 25 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300.json
H=25, n_dof=6, feature_dim=24
X_train: (33182, 25, 24)  Y_train: (33182, 6)
X_test : (19638, 25, 24)  Y_test : (19638, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:33:54.048493: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:33:54.072072: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (33182, 25, 24), Y_train = (33182, 6)
  X_test  = (19638, 25, 24),  Y_test  = (19638, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:33:55.186863: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:33:55.191941: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:33:55.192872: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:33:55.194699: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:33:55.195716: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:33:55.196596: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:33:55.286017: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:33:55.286908: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:33:55.287775: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:33:55.288604: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:33:56.282383: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
104/104 - 2s - 16ms/step - loss: 0.2867 - val_loss: 0.2680
Epoch 2/80
104/104 - 0s - 3ms/step - loss: 0.1578 - val_loss: 0.2206
Epoch 3/80
104/104 - 0s - 3ms/step - loss: 0.1335 - val_loss: 0.1987
Epoch 4/80
104/104 - 0s - 3ms/step - loss: 0.1179 - val_loss: 0.1936
Epoch 5/80
104/104 - 0s - 3ms/step - loss: 0.1091 - val_loss: 0.1871
Epoch 6/80
104/104 - 0s - 3ms/step - loss: 0.1029 - val_loss: 0.1808
Epoch 7/80
104/104 - 0s - 3ms/step - loss: 0.0979 - val_loss: 0.1797
Epoch 8/80
104/104 - 0s - 3ms/step - loss: 0.0932 - val_loss: 0.1769
Epoch 9/80
104/104 - 0s - 3ms/step - loss: 0.0905 - val_loss: 0.1756
Epoch 10/80
104/104 - 0s - 3ms/step - loss: 0.0885 - val_loss: 0.1712
Epoch 11/80
104/104 - 0s - 3ms/step - loss: 0.0872 - val_loss: 0.1701
Epoch 12/80
104/104 - 0s - 3ms/step - loss: 0.0838 - val_loss: 0.1689
Epoch 13/80
104/104 - 0s - 3ms/step - loss: 0.0824 - val_loss: 0.1677
Epoch 14/80
104/104 - 0s - 3ms/step - loss: 0.0808 - val_loss: 0.1661
Epoch 15/80
104/104 - 0s - 3ms/step - loss: 0.0790 - val_loss: 0.1650
Epoch 16/80
104/104 - 0s - 3ms/step - loss: 0.0779 - val_loss: 0.1638
Epoch 17/80
104/104 - 0s - 3ms/step - loss: 0.0781 - val_loss: 0.1624
Epoch 18/80
104/104 - 0s - 3ms/step - loss: 0.0763 - val_loss: 0.1643
Epoch 19/80
104/104 - 0s - 3ms/step - loss: 0.0740 - val_loss: 0.1625
Epoch 20/80
104/104 - 0s - 3ms/step - loss: 0.0733 - val_loss: 0.1643
Epoch 21/80
104/104 - 0s - 3ms/step - loss: 0.0726 - val_loss: 0.1604
Epoch 22/80
104/104 - 0s - 3ms/step - loss: 0.0711 - val_loss: 0.1620
Epoch 23/80
104/104 - 0s - 3ms/step - loss: 0.0706 - val_loss: 0.1612
Epoch 24/80
104/104 - 0s - 3ms/step - loss: 0.0695 - val_loss: 0.1628
Epoch 25/80
104/104 - 0s - 3ms/step - loss: 0.0696 - val_loss: 0.1596
Epoch 26/80
104/104 - 0s - 3ms/step - loss: 0.0685 - val_loss: 0.1587
Epoch 27/80
104/104 - 0s - 3ms/step - loss: 0.0682 - val_loss: 0.1590
Epoch 28/80
104/104 - 0s - 3ms/step - loss: 0.0677 - val_loss: 0.1571
Epoch 29/80
104/104 - 0s - 3ms/step - loss: 0.0656 - val_loss: 0.1579
Epoch 30/80
104/104 - 0s - 3ms/step - loss: 0.0650 - val_loss: 0.1562
Epoch 31/80
104/104 - 0s - 3ms/step - loss: 0.0641 - val_loss: 0.1589
Epoch 32/80
104/104 - 0s - 3ms/step - loss: 0.0646 - val_loss: 0.1593
Epoch 33/80
104/104 - 0s - 3ms/step - loss: 0.0646 - val_loss: 0.1574
Epoch 34/80
104/104 - 0s - 3ms/step - loss: 0.0637 - val_loss: 0.1570
Epoch 35/80
104/104 - 0s - 3ms/step - loss: 0.0625 - val_loss: 0.1556
Epoch 36/80
104/104 - 0s - 3ms/step - loss: 0.0623 - val_loss: 0.1559
Epoch 37/80
104/104 - 0s - 3ms/step - loss: 0.0608 - val_loss: 0.1589
Epoch 38/80
104/104 - 0s - 3ms/step - loss: 0.0605 - val_loss: 0.1552
Epoch 39/80
104/104 - 0s - 3ms/step - loss: 0.0606 - val_loss: 0.1538
Epoch 40/80
104/104 - 0s - 3ms/step - loss: 0.0594 - val_loss: 0.1540
Epoch 41/80
104/104 - 0s - 3ms/step - loss: 0.0589 - val_loss: 0.1554
Epoch 42/80
104/104 - 0s - 3ms/step - loss: 0.0585 - val_loss: 0.1543
Epoch 43/80
104/104 - 0s - 3ms/step - loss: 0.0587 - val_loss: 0.1518
Epoch 44/80
104/104 - 0s - 3ms/step - loss: 0.0573 - val_loss: 0.1554
Epoch 45/80
104/104 - 0s - 3ms/step - loss: 0.0573 - val_loss: 0.1534
Epoch 46/80
104/104 - 0s - 3ms/step - loss: 0.0569 - val_loss: 0.1538
Epoch 47/80
104/104 - 0s - 3ms/step - loss: 0.0577 - val_loss: 0.1521
Epoch 48/80
104/104 - 0s - 3ms/step - loss: 0.0562 - val_loss: 0.1528
Epoch 49/80
104/104 - 0s - 3ms/step - loss: 0.0563 - val_loss: 0.1514
Epoch 50/80
104/104 - 0s - 3ms/step - loss: 0.0552 - val_loss: 0.1537
Epoch 51/80
104/104 - 0s - 3ms/step - loss: 0.0554 - val_loss: 0.1533
Epoch 52/80
104/104 - 0s - 3ms/step - loss: 0.0544 - val_loss: 0.1527
Epoch 53/80
104/104 - 0s - 3ms/step - loss: 0.0545 - val_loss: 0.1532
Epoch 54/80
104/104 - 0s - 3ms/step - loss: 0.0537 - val_loss: 0.1516
Epoch 55/80
104/104 - 0s - 3ms/step - loss: 0.0541 - val_loss: 0.1517
Epoch 56/80
104/104 - 0s - 3ms/step - loss: 0.0533 - val_loss: 0.1520
Epoch 57/80
104/104 - 0s - 3ms/step - loss: 0.0527 - val_loss: 0.1525
Epoch 58/80
104/104 - 0s - 3ms/step - loss: 0.0527 - val_loss: 0.1501
Epoch 59/80
104/104 - 0s - 3ms/step - loss: 0.0524 - val_loss: 0.1511
Epoch 60/80
104/104 - 0s - 3ms/step - loss: 0.0521 - val_loss: 0.1512
Epoch 61/80
104/104 - 0s - 3ms/step - loss: 0.0523 - val_loss: 0.1532
Epoch 62/80
104/104 - 0s - 3ms/step - loss: 0.0521 - val_loss: 0.1506
Epoch 63/80
104/104 - 0s - 3ms/step - loss: 0.0510 - val_loss: 0.1517
Epoch 64/80
104/104 - 0s - 3ms/step - loss: 0.0513 - val_loss: 0.1508
Epoch 65/80
104/104 - 0s - 3ms/step - loss: 0.0508 - val_loss: 0.1518
Epoch 66/80
104/104 - 0s - 3ms/step - loss: 0.0505 - val_loss: 0.1532
Epoch 67/80
104/104 - 0s - 3ms/step - loss: 0.0501 - val_loss: 0.1533
Epoch 68/80
104/104 - 0s - 3ms/step - loss: 0.0508 - val_loss: 0.1520
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5630
Per-joint RMSE: 0.6924 0.8816 0.5864 0.3075 0.3252 0.3181
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:34:17.448353: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:34:17.472499: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 07:34:18.314094: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:18.318691: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:18.319474: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:18.321113: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:18.321904: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:18.322643: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:18.398636: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:18.399469: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:18.400300: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:18.401027: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:34:18.711021: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.610699e-01  RMSE=6.790213e-01
  per-joint RMSE: 0.8661 1.0245 0.7166 0.3965 0.3885 0.3808
Residual LSTM:  MSE=3.170067e-01      RMSE=5.630335e-01
  per-joint RMSE: 0.6924 0.8816 0.5864 0.3075 0.3252 0.3181
Combined torque MSE=3.170067e-01     RMSE=5.630335e-01
  per-joint RMSE: 0.6924 0.8816 0.5864 0.3075 0.3252 0.3181
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300.npz --H 25 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300.json
H=25, n_dof=6, feature_dim=6
X_train: (33182, 25, 6)  Y_train: (33182, 6)
X_test : (19638, 25, 6)  Y_test : (19638, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:34:20.913216: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:34:20.937358: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (33182, 25, 6), Y_train = (33182, 6)
  X_test  = (19638, 25, 6),  Y_test  = (19638, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:34:21.922733: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:21.927428: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:21.928220: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:21.929901: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:21.930746: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:21.931526: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:22.006885: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:22.007716: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:22.008456: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:22.009195: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:34:22.923107: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
104/104 - 2s - 16ms/step - loss: 0.8134 - val_loss: 0.7918
Epoch 2/80
104/104 - 0s - 3ms/step - loss: 0.6494 - val_loss: 0.6489
Epoch 3/80
104/104 - 0s - 3ms/step - loss: 0.5280 - val_loss: 0.5953
Epoch 4/80
104/104 - 0s - 3ms/step - loss: 0.4397 - val_loss: 0.5255
Epoch 5/80
104/104 - 0s - 3ms/step - loss: 0.3902 - val_loss: 0.5339
Epoch 6/80
104/104 - 0s - 3ms/step - loss: 0.3372 - val_loss: 0.4685
Epoch 7/80
104/104 - 0s - 3ms/step - loss: 0.3205 - val_loss: 0.4329
Epoch 8/80
104/104 - 0s - 3ms/step - loss: 0.2804 - val_loss: 0.4080
Epoch 9/80
104/104 - 0s - 3ms/step - loss: 0.2613 - val_loss: 0.3469
Epoch 10/80
104/104 - 0s - 3ms/step - loss: 0.2589 - val_loss: 0.3319
Epoch 11/80
104/104 - 0s - 3ms/step - loss: 0.2350 - val_loss: 0.3194
Epoch 12/80
104/104 - 0s - 3ms/step - loss: 0.2176 - val_loss: 0.3097
Epoch 13/80
104/104 - 0s - 3ms/step - loss: 0.2210 - val_loss: 0.3541
Epoch 14/80
104/104 - 0s - 3ms/step - loss: 0.2245 - val_loss: 0.3034
Epoch 15/80
104/104 - 0s - 3ms/step - loss: 0.2061 - val_loss: 0.3195
Epoch 16/80
104/104 - 0s - 3ms/step - loss: 0.2051 - val_loss: 0.3228
Epoch 17/80
104/104 - 0s - 3ms/step - loss: 0.1876 - val_loss: 0.2825
Epoch 18/80
104/104 - 0s - 3ms/step - loss: 0.1672 - val_loss: 0.2832
Epoch 19/80
104/104 - 0s - 3ms/step - loss: 0.1736 - val_loss: 0.2727
Epoch 20/80
104/104 - 0s - 3ms/step - loss: 0.1738 - val_loss: 0.2808
Epoch 21/80
104/104 - 0s - 3ms/step - loss: 0.1606 - val_loss: 0.2723
Epoch 22/80
104/104 - 0s - 3ms/step - loss: 0.1508 - val_loss: 0.2686
Epoch 23/80
104/104 - 0s - 3ms/step - loss: 0.1517 - val_loss: 0.2730
Epoch 24/80
104/104 - 0s - 3ms/step - loss: 0.1519 - val_loss: 0.2719
Epoch 25/80
104/104 - 0s - 3ms/step - loss: 0.1566 - val_loss: 0.2741
Epoch 26/80
104/104 - 0s - 3ms/step - loss: 0.1822 - val_loss: 0.2717
Epoch 27/80
104/104 - 0s - 3ms/step - loss: 0.1443 - val_loss: 0.2761
Epoch 28/80
104/104 - 0s - 3ms/step - loss: 0.1462 - val_loss: 0.2930
Epoch 29/80
104/104 - 0s - 3ms/step - loss: 0.1379 - val_loss: 0.2759
Epoch 30/80
104/104 - 0s - 3ms/step - loss: 0.1273 - val_loss: 0.2708
Epoch 31/80
104/104 - 0s - 3ms/step - loss: 0.1228 - val_loss: 0.2743
Epoch 32/80
104/104 - 0s - 3ms/step - loss: 0.1297 - val_loss: 0.2762
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6406
Per-joint RMSE: 0.8661 0.8886 0.6944 0.4111 0.3691 0.3677
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:34:33.440261: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:34:33.464665: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 07:34:34.306271: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:34.310897: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:34.311744: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:34.313686: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:34.314522: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:34.315313: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:34.394016: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:34.394904: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:34.395750: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:34.396580: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:34:34.697460: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.610699e-01  RMSE=6.790213e-01
  per-joint RMSE: 0.8661 1.0245 0.7166 0.3965 0.3885 0.3808
Residual LSTM:  MSE=4.103880e-01      RMSE=6.406153e-01
  per-joint RMSE: 0.8661 0.8886 0.6944 0.4111 0.3691 0.3677
Combined torque MSE=4.103880e-01     RMSE=6.406153e-01
  per-joint RMSE: 0.8661 0.8886 0.6944 0.4111 0.3691 0.3677
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300.npz --H 25 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300.json
H=25, n_dof=6, feature_dim=18
X_train: (33182, 25, 18)  Y_train: (33182, 6)
X_test : (19638, 25, 18)  Y_test : (19638, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:34:36.960806: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:34:36.984260: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (33182, 25, 18), Y_train = (33182, 6)
  X_test  = (19638, 25, 18),  Y_test  = (19638, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:34:38.071814: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:38.076762: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:38.077775: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:38.079505: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:38.080300: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:38.081041: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:38.162726: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:38.163639: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:38.164380: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:38.165115: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:34:39.092628: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
104/104 - 2s - 16ms/step - loss: 0.3249 - val_loss: 0.3146
Epoch 2/80
104/104 - 0s - 3ms/step - loss: 0.1886 - val_loss: 0.2868
Epoch 3/80
104/104 - 0s - 3ms/step - loss: 0.1582 - val_loss: 0.2786
Epoch 4/80
104/104 - 0s - 3ms/step - loss: 0.1446 - val_loss: 0.2659
Epoch 5/80
104/104 - 0s - 3ms/step - loss: 0.1339 - val_loss: 0.2579
Epoch 6/80
104/104 - 0s - 3ms/step - loss: 0.1289 - val_loss: 0.2533
Epoch 7/80
104/104 - 0s - 3ms/step - loss: 0.1243 - val_loss: 0.2499
Epoch 8/80
104/104 - 0s - 3ms/step - loss: 0.1162 - val_loss: 0.2468
Epoch 9/80
104/104 - 0s - 3ms/step - loss: 0.1132 - val_loss: 0.2416
Epoch 10/80
104/104 - 0s - 3ms/step - loss: 0.1111 - val_loss: 0.2343
Epoch 11/80
104/104 - 0s - 3ms/step - loss: 0.1066 - val_loss: 0.2458
Epoch 12/80
104/104 - 0s - 3ms/step - loss: 0.1056 - val_loss: 0.2315
Epoch 13/80
104/104 - 0s - 3ms/step - loss: 0.1015 - val_loss: 0.2287
Epoch 14/80
104/104 - 0s - 3ms/step - loss: 0.1011 - val_loss: 0.2379
Epoch 15/80
104/104 - 0s - 3ms/step - loss: 0.0999 - val_loss: 0.2432
Epoch 16/80
104/104 - 0s - 3ms/step - loss: 0.0946 - val_loss: 0.2251
Epoch 17/80
104/104 - 0s - 3ms/step - loss: 0.0927 - val_loss: 0.2305
Epoch 18/80
104/104 - 0s - 3ms/step - loss: 0.0925 - val_loss: 0.2274
Epoch 19/80
104/104 - 0s - 3ms/step - loss: 0.0876 - val_loss: 0.2222
Epoch 20/80
104/104 - 0s - 3ms/step - loss: 0.0897 - val_loss: 0.2398
Epoch 21/80
104/104 - 0s - 3ms/step - loss: 0.0849 - val_loss: 0.2283
Epoch 22/80
104/104 - 0s - 3ms/step - loss: 0.0870 - val_loss: 0.2282
Epoch 23/80
104/104 - 0s - 3ms/step - loss: 0.0877 - val_loss: 0.2251
Epoch 24/80
104/104 - 0s - 3ms/step - loss: 0.0843 - val_loss: 0.2227
Epoch 25/80
104/104 - 0s - 3ms/step - loss: 0.0839 - val_loss: 0.2296
Epoch 26/80
104/104 - 0s - 3ms/step - loss: 0.0794 - val_loss: 0.2285
Epoch 27/80
104/104 - 0s - 3ms/step - loss: 0.0768 - val_loss: 0.2198
Epoch 28/80
104/104 - 0s - 3ms/step - loss: 0.0772 - val_loss: 0.2237
Epoch 29/80
104/104 - 0s - 3ms/step - loss: 0.0764 - val_loss: 0.2230
Epoch 30/80
104/104 - 0s - 3ms/step - loss: 0.0757 - val_loss: 0.2210
Epoch 31/80
104/104 - 0s - 3ms/step - loss: 0.0749 - val_loss: 0.2134
Epoch 32/80
104/104 - 0s - 3ms/step - loss: 0.0738 - val_loss: 0.2183
Epoch 33/80
104/104 - 0s - 3ms/step - loss: 0.0728 - val_loss: 0.2177
Epoch 34/80
104/104 - 0s - 3ms/step - loss: 0.0722 - val_loss: 0.2210
Epoch 35/80
104/104 - 0s - 3ms/step - loss: 0.0712 - val_loss: 0.2196
Epoch 36/80
104/104 - 0s - 3ms/step - loss: 0.0713 - val_loss: 0.2224
Epoch 37/80
104/104 - 0s - 3ms/step - loss: 0.0700 - val_loss: 0.2206
Epoch 38/80
104/104 - 0s - 3ms/step - loss: 0.0694 - val_loss: 0.2272
Epoch 39/80
104/104 - 0s - 3ms/step - loss: 0.0693 - val_loss: 0.2183
Epoch 40/80
104/104 - 0s - 3ms/step - loss: 0.0683 - val_loss: 0.2240
Epoch 41/80
104/104 - 0s - 3ms/step - loss: 0.0672 - val_loss: 0.2254
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6595
Per-joint RMSE: 0.8662 0.9796 0.6975 0.3840 0.3730 0.3554
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:34:52.414740: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:34:52.439283: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:34:53.292690: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:53.297342: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:53.298296: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:53.299894: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:53.300682: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:53.301422: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:53.379319: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:53.380241: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:53.380984: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:53.381717: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:34:53.695880: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.610699e-01  RMSE=6.790213e-01
  per-joint RMSE: 0.8661 1.0245 0.7166 0.3965 0.3885 0.3808
Residual LSTM:  MSE=4.348877e-01      RMSE=6.594602e-01
  per-joint RMSE: 0.8662 0.9796 0.6975 0.3840 0.3730 0.3554
Combined torque MSE=4.348878e-01     RMSE=6.594602e-01
  per-joint RMSE: 0.8662 0.9796 0.6975 0.3840 0.3730 0.3554
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300.npz --H 25 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300.json
H=25, n_dof=6, feature_dim=18
X_train: (33182, 25, 18)  Y_train: (33182, 6)
X_test : (19638, 25, 18)  Y_test : (19638, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:34:55.948012: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:34:55.971395: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (33182, 25, 18), Y_train = (33182, 6)
  X_test  = (19638, 25, 18),  Y_test  = (19638, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:34:57.066489: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:57.071496: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:57.072289: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:57.073964: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:57.074905: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:57.075642: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:57.163706: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:57.164537: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:57.165279: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:34:57.166012: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:34:58.105139: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
104/104 - 2s - 16ms/step - loss: 0.2871 - val_loss: 0.2562
Epoch 2/80
104/104 - 0s - 3ms/step - loss: 0.1573 - val_loss: 0.2175
Epoch 3/80
104/104 - 0s - 3ms/step - loss: 0.1307 - val_loss: 0.1981
Epoch 4/80
104/104 - 0s - 3ms/step - loss: 0.1170 - val_loss: 0.1884
Epoch 5/80
104/104 - 0s - 3ms/step - loss: 0.1078 - val_loss: 0.1804
Epoch 6/80
104/104 - 0s - 3ms/step - loss: 0.1019 - val_loss: 0.1755
Epoch 7/80
104/104 - 0s - 3ms/step - loss: 0.0971 - val_loss: 0.1758
Epoch 8/80
104/104 - 0s - 3ms/step - loss: 0.0940 - val_loss: 0.1709
Epoch 9/80
104/104 - 0s - 3ms/step - loss: 0.0895 - val_loss: 0.1701
Epoch 10/80
104/104 - 0s - 3ms/step - loss: 0.0882 - val_loss: 0.1689
Epoch 11/80
104/104 - 0s - 3ms/step - loss: 0.0857 - val_loss: 0.1686
Epoch 12/80
104/104 - 0s - 3ms/step - loss: 0.0831 - val_loss: 0.1671
Epoch 13/80
104/104 - 0s - 3ms/step - loss: 0.0814 - val_loss: 0.1662
Epoch 14/80
104/104 - 0s - 3ms/step - loss: 0.0799 - val_loss: 0.1636
Epoch 15/80
104/104 - 0s - 3ms/step - loss: 0.0778 - val_loss: 0.1625
Epoch 16/80
104/104 - 0s - 3ms/step - loss: 0.0768 - val_loss: 0.1634
Epoch 17/80
104/104 - 0s - 3ms/step - loss: 0.0758 - val_loss: 0.1620
Epoch 18/80
104/104 - 0s - 3ms/step - loss: 0.0759 - val_loss: 0.1582
Epoch 19/80
104/104 - 0s - 3ms/step - loss: 0.0752 - val_loss: 0.1587
Epoch 20/80
104/104 - 0s - 3ms/step - loss: 0.0740 - val_loss: 0.1592
Epoch 21/80
104/104 - 0s - 3ms/step - loss: 0.0719 - val_loss: 0.1584
Epoch 22/80
104/104 - 0s - 3ms/step - loss: 0.0717 - val_loss: 0.1607
Epoch 23/80
104/104 - 0s - 3ms/step - loss: 0.0705 - val_loss: 0.1588
Epoch 24/80
104/104 - 0s - 3ms/step - loss: 0.0693 - val_loss: 0.1575
Epoch 25/80
104/104 - 0s - 3ms/step - loss: 0.0685 - val_loss: 0.1544
Epoch 26/80
104/104 - 0s - 3ms/step - loss: 0.0681 - val_loss: 0.1567
Epoch 27/80
104/104 - 0s - 3ms/step - loss: 0.0678 - val_loss: 0.1555
Epoch 28/80
104/104 - 0s - 3ms/step - loss: 0.0667 - val_loss: 0.1552
Epoch 29/80
104/104 - 0s - 3ms/step - loss: 0.0660 - val_loss: 0.1552
Epoch 30/80
104/104 - 0s - 3ms/step - loss: 0.0657 - val_loss: 0.1547
Epoch 31/80
104/104 - 0s - 3ms/step - loss: 0.0655 - val_loss: 0.1554
Epoch 32/80
104/104 - 0s - 3ms/step - loss: 0.0641 - val_loss: 0.1535
Epoch 33/80
104/104 - 0s - 3ms/step - loss: 0.0640 - val_loss: 0.1521
Epoch 34/80
104/104 - 0s - 3ms/step - loss: 0.0631 - val_loss: 0.1546
Epoch 35/80
104/104 - 0s - 3ms/step - loss: 0.0626 - val_loss: 0.1517
Epoch 36/80
104/104 - 0s - 3ms/step - loss: 0.0621 - val_loss: 0.1524
Epoch 37/80
104/104 - 0s - 3ms/step - loss: 0.0613 - val_loss: 0.1531
Epoch 38/80
104/104 - 0s - 3ms/step - loss: 0.0613 - val_loss: 0.1511
Epoch 39/80
104/104 - 0s - 3ms/step - loss: 0.0604 - val_loss: 0.1509
Epoch 40/80
104/104 - 0s - 3ms/step - loss: 0.0595 - val_loss: 0.1516
Epoch 41/80
104/104 - 0s - 3ms/step - loss: 0.0595 - val_loss: 0.1494
Epoch 42/80
104/104 - 0s - 3ms/step - loss: 0.0592 - val_loss: 0.1501
Epoch 43/80
104/104 - 0s - 3ms/step - loss: 0.0583 - val_loss: 0.1481
Epoch 44/80
104/104 - 0s - 3ms/step - loss: 0.0583 - val_loss: 0.1520
Epoch 45/80
104/104 - 0s - 3ms/step - loss: 0.0583 - val_loss: 0.1499
Epoch 46/80
104/104 - 0s - 3ms/step - loss: 0.0578 - val_loss: 0.1503
Epoch 47/80
104/104 - 0s - 3ms/step - loss: 0.0576 - val_loss: 0.1474
Epoch 48/80
104/104 - 0s - 3ms/step - loss: 0.0565 - val_loss: 0.1516
Epoch 49/80
104/104 - 0s - 3ms/step - loss: 0.0563 - val_loss: 0.1497
Epoch 50/80
104/104 - 0s - 3ms/step - loss: 0.0561 - val_loss: 0.1498
Epoch 51/80
104/104 - 0s - 3ms/step - loss: 0.0558 - val_loss: 0.1512
Epoch 52/80
104/104 - 0s - 3ms/step - loss: 0.0563 - val_loss: 0.1493
Epoch 53/80
104/104 - 0s - 3ms/step - loss: 0.0550 - val_loss: 0.1493
Epoch 54/80
104/104 - 0s - 3ms/step - loss: 0.0547 - val_loss: 0.1495
Epoch 55/80
104/104 - 0s - 3ms/step - loss: 0.0546 - val_loss: 0.1475
Epoch 56/80
104/104 - 0s - 3ms/step - loss: 0.0547 - val_loss: 0.1504
Epoch 57/80
104/104 - 0s - 3ms/step - loss: 0.0542 - val_loss: 0.1486
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5843
Per-joint RMSE: 0.6644 0.9615 0.6178 0.3310 0.3150 0.3029
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:35:15.785873: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:35:15.810630: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:35:16.673095: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:16.678151: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:16.678953: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:16.680809: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:16.681605: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:16.682343: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:16.761018: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:16.762020: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:16.762767: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:16.763502: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:35:17.080794: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.610699e-01  RMSE=6.790213e-01
  per-joint RMSE: 0.8661 1.0245 0.7166 0.3965 0.3885 0.3808
Residual LSTM:  MSE=3.413602e-01      RMSE=5.842604e-01
  per-joint RMSE: 0.6644 0.9615 0.6178 0.3310 0.3150 0.3029
Combined torque MSE=3.413602e-01     RMSE=5.842604e-01
  per-joint RMSE: 0.6644 0.9615 0.6178 0.3310 0.3150 0.3029
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300.npz --H 50 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300.json
H=50, n_dof=6, feature_dim=24
X_train: (32332, 50, 24)  Y_train: (32332, 6)
X_test : (19263, 50, 24)  Y_test : (19263, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:35:19.433831: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:35:19.459414: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (32332, 50, 24), Y_train = (32332, 6)
  X_test  = (19263, 50, 24),  Y_test  = (19263, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:35:20.878430: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:20.883277: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:20.884190: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:20.886072: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:20.886975: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:20.887830: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:20.980865: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:20.981881: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:20.982680: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:20.983471: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:35:22.103126: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
102/102 - 2s - 18ms/step - loss: 0.2934 - val_loss: 0.2820
Epoch 2/80
102/102 - 0s - 4ms/step - loss: 0.1662 - val_loss: 0.2382
Epoch 3/80
102/102 - 0s - 4ms/step - loss: 0.1377 - val_loss: 0.2068
Epoch 4/80
102/102 - 0s - 4ms/step - loss: 0.1231 - val_loss: 0.1936
Epoch 5/80
102/102 - 0s - 4ms/step - loss: 0.1121 - val_loss: 0.1902
Epoch 6/80
102/102 - 0s - 4ms/step - loss: 0.1049 - val_loss: 0.1804
Epoch 7/80
102/102 - 0s - 4ms/step - loss: 0.0999 - val_loss: 0.1763
Epoch 8/80
102/102 - 0s - 4ms/step - loss: 0.0958 - val_loss: 0.1748
Epoch 9/80
102/102 - 0s - 4ms/step - loss: 0.0943 - val_loss: 0.1705
Epoch 10/80
102/102 - 0s - 4ms/step - loss: 0.0901 - val_loss: 0.1738
Epoch 11/80
102/102 - 0s - 5ms/step - loss: 0.0899 - val_loss: 0.1706
Epoch 12/80
102/102 - 0s - 4ms/step - loss: 0.0856 - val_loss: 0.1677
Epoch 13/80
102/102 - 0s - 4ms/step - loss: 0.0840 - val_loss: 0.1712
Epoch 14/80
102/102 - 0s - 4ms/step - loss: 0.0820 - val_loss: 0.1690
Epoch 15/80
102/102 - 0s - 4ms/step - loss: 0.0800 - val_loss: 0.1660
Epoch 16/80
102/102 - 0s - 4ms/step - loss: 0.0788 - val_loss: 0.1634
Epoch 17/80
102/102 - 0s - 4ms/step - loss: 0.0776 - val_loss: 0.1677
Epoch 18/80
102/102 - 0s - 4ms/step - loss: 0.0762 - val_loss: 0.1685
Epoch 19/80
102/102 - 0s - 4ms/step - loss: 0.0751 - val_loss: 0.1641
Epoch 20/80
102/102 - 0s - 4ms/step - loss: 0.0743 - val_loss: 0.1665
Epoch 21/80
102/102 - 0s - 4ms/step - loss: 0.0786 - val_loss: 0.1624
Epoch 22/80
102/102 - 0s - 4ms/step - loss: 0.0734 - val_loss: 0.1654
Epoch 23/80
102/102 - 0s - 4ms/step - loss: 0.0745 - val_loss: 0.1643
Epoch 24/80
102/102 - 0s - 4ms/step - loss: 0.0742 - val_loss: 0.1620
Epoch 25/80
102/102 - 0s - 4ms/step - loss: 0.0736 - val_loss: 0.1629
Epoch 26/80
102/102 - 0s - 4ms/step - loss: 0.0717 - val_loss: 0.1615
Epoch 27/80
102/102 - 0s - 4ms/step - loss: 0.0699 - val_loss: 0.1622
Epoch 28/80
102/102 - 0s - 4ms/step - loss: 0.0671 - val_loss: 0.1597
Epoch 29/80
102/102 - 0s - 4ms/step - loss: 0.0671 - val_loss: 0.1559
Epoch 30/80
102/102 - 0s - 4ms/step - loss: 0.0658 - val_loss: 0.1585
Epoch 31/80
102/102 - 0s - 4ms/step - loss: 0.0653 - val_loss: 0.1574
Epoch 32/80
102/102 - 0s - 4ms/step - loss: 0.0664 - val_loss: 0.1555
Epoch 33/80
102/102 - 0s - 4ms/step - loss: 0.0645 - val_loss: 0.1577
Epoch 34/80
102/102 - 0s - 4ms/step - loss: 0.0637 - val_loss: 0.1565
Epoch 35/80
102/102 - 0s - 4ms/step - loss: 0.0630 - val_loss: 0.1574
Epoch 36/80
102/102 - 0s - 4ms/step - loss: 0.0635 - val_loss: 0.1554
Epoch 37/80
102/102 - 0s - 4ms/step - loss: 0.0624 - val_loss: 0.1568
Epoch 38/80
102/102 - 0s - 4ms/step - loss: 0.0615 - val_loss: 0.1535
Epoch 39/80
102/102 - 0s - 4ms/step - loss: 0.0608 - val_loss: 0.1537
Epoch 40/80
102/102 - 0s - 4ms/step - loss: 0.0608 - val_loss: 0.1533
Epoch 41/80
102/102 - 0s - 4ms/step - loss: 0.0594 - val_loss: 0.1554
Epoch 42/80
102/102 - 0s - 4ms/step - loss: 0.0596 - val_loss: 0.1517
Epoch 43/80
102/102 - 0s - 4ms/step - loss: 0.0596 - val_loss: 0.1533
Epoch 44/80
102/102 - 0s - 4ms/step - loss: 0.0583 - val_loss: 0.1554
Epoch 45/80
102/102 - 0s - 4ms/step - loss: 0.0589 - val_loss: 0.1536
Epoch 46/80
102/102 - 0s - 4ms/step - loss: 0.0577 - val_loss: 0.1497
Epoch 47/80
102/102 - 0s - 4ms/step - loss: 0.0579 - val_loss: 0.1519
Epoch 48/80
102/102 - 0s - 4ms/step - loss: 0.0571 - val_loss: 0.1520
Epoch 49/80
102/102 - 0s - 4ms/step - loss: 0.0567 - val_loss: 0.1514
Epoch 50/80
102/102 - 0s - 4ms/step - loss: 0.0561 - val_loss: 0.1519
Epoch 51/80
102/102 - 0s - 4ms/step - loss: 0.0572 - val_loss: 0.1513
Epoch 52/80
102/102 - 0s - 4ms/step - loss: 0.0560 - val_loss: 0.1542
Epoch 53/80
102/102 - 0s - 4ms/step - loss: 0.0559 - val_loss: 0.1524
Epoch 54/80
102/102 - 0s - 4ms/step - loss: 0.0551 - val_loss: 0.1527
Epoch 55/80
102/102 - 0s - 4ms/step - loss: 0.0544 - val_loss: 0.1522
Epoch 56/80
102/102 - 0s - 4ms/step - loss: 0.0543 - val_loss: 0.1507
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5678
Per-joint RMSE: 0.6775 0.8955 0.6194 0.3086 0.3139 0.3095
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:35:47.212877: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:35:47.239289: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 07:35:48.114079: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:48.118892: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:48.119741: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:48.121537: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:48.122329: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:48.123747: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:48.206942: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:48.207932: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:48.208680: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:48.209404: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:35:48.505971: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.661615e-01  RMSE=6.827602e-01
  per-joint RMSE: 0.8721 1.0299 0.7204 0.3978 0.3900 0.3825
Residual LSTM:  MSE=3.223697e-01      RMSE=5.677761e-01
  per-joint RMSE: 0.6775 0.8955 0.6194 0.3086 0.3139 0.3095
Combined torque MSE=3.223697e-01     RMSE=5.677761e-01
  per-joint RMSE: 0.6775 0.8955 0.6194 0.3086 0.3139 0.3095
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300.npz --H 50 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300.json
H=50, n_dof=6, feature_dim=6
X_train: (32332, 50, 6)  Y_train: (32332, 6)
X_test : (19263, 50, 6)  Y_test : (19263, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:35:50.806589: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:35:50.831026: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (32332, 50, 6), Y_train = (32332, 6)
  X_test  = (19263, 50, 6),  Y_test  = (19263, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:35:51.899125: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:51.903738: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:51.904519: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:51.906180: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:51.906959: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:51.907691: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:51.980473: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:51.981307: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:51.982052: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:35:51.982787: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:35:52.948987: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
102/102 - 2s - 17ms/step - loss: 0.7750 - val_loss: 0.7564
Epoch 2/80
102/102 - 0s - 4ms/step - loss: 0.5579 - val_loss: 0.6808
Epoch 3/80
102/102 - 0s - 4ms/step - loss: 0.4509 - val_loss: 0.6016
Epoch 4/80
102/102 - 0s - 4ms/step - loss: 0.3398 - val_loss: 0.5067
Epoch 5/80
102/102 - 0s - 4ms/step - loss: 0.2964 - val_loss: 0.4141
Epoch 6/80
102/102 - 0s - 4ms/step - loss: 0.2459 - val_loss: 0.4850
Epoch 7/80
102/102 - 0s - 4ms/step - loss: 0.2242 - val_loss: 0.5214
Epoch 8/80
102/102 - 0s - 4ms/step - loss: 0.2037 - val_loss: 0.4280
Epoch 9/80
102/102 - 0s - 4ms/step - loss: 0.1907 - val_loss: 0.4658
Epoch 10/80
102/102 - 0s - 4ms/step - loss: 0.1721 - val_loss: 0.4999
Epoch 11/80
102/102 - 0s - 5ms/step - loss: 0.1649 - val_loss: 0.3972
Epoch 12/80
102/102 - 0s - 4ms/step - loss: 0.1718 - val_loss: 0.4004
Epoch 13/80
102/102 - 0s - 4ms/step - loss: 0.1568 - val_loss: 0.4462
Epoch 14/80
102/102 - 0s - 4ms/step - loss: 0.1431 - val_loss: 0.3545
Epoch 15/80
102/102 - 0s - 4ms/step - loss: 0.1405 - val_loss: 0.4148
Epoch 16/80
102/102 - 0s - 4ms/step - loss: 0.1671 - val_loss: 0.3286
Epoch 17/80
102/102 - 0s - 4ms/step - loss: 0.1328 - val_loss: 0.3542
Epoch 18/80
102/102 - 0s - 4ms/step - loss: 0.1235 - val_loss: 0.3140
Epoch 19/80
102/102 - 0s - 4ms/step - loss: 0.1337 - val_loss: 0.3608
Epoch 20/80
102/102 - 0s - 4ms/step - loss: 0.1436 - val_loss: 0.3615
Epoch 21/80
102/102 - 0s - 4ms/step - loss: 0.1381 - val_loss: 0.3322
Epoch 22/80
102/102 - 0s - 4ms/step - loss: 0.1150 - val_loss: 0.3208
Epoch 23/80
102/102 - 0s - 4ms/step - loss: 0.1136 - val_loss: 0.3179
Epoch 24/80
102/102 - 0s - 4ms/step - loss: 0.1110 - val_loss: 0.3397
Epoch 25/80
102/102 - 0s - 4ms/step - loss: 0.1703 - val_loss: 0.3710
Epoch 26/80
102/102 - 0s - 4ms/step - loss: 0.1465 - val_loss: 0.3655
Epoch 27/80
102/102 - 0s - 4ms/step - loss: 0.1109 - val_loss: 0.3279
Epoch 28/80
102/102 - 0s - 4ms/step - loss: 0.1481 - val_loss: 0.4300
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6679
Per-joint RMSE: 0.8725 0.9611 0.7339 0.4137 0.3842 0.3662
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:36:06.165467: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:36:06.192221: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 07:36:07.057158: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:07.061785: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:07.062585: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:07.064494: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:07.065367: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:07.066105: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:07.149873: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:07.150782: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:07.151570: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:07.152391: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:36:07.460266: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.661615e-01  RMSE=6.827602e-01
  per-joint RMSE: 0.8721 1.0299 0.7204 0.3978 0.3900 0.3825
Residual LSTM:  MSE=4.460886e-01      RMSE=6.678986e-01
  per-joint RMSE: 0.8725 0.9611 0.7339 0.4137 0.3842 0.3662
Combined torque MSE=4.460885e-01     RMSE=6.678986e-01
  per-joint RMSE: 0.8725 0.9611 0.7339 0.4137 0.3842 0.3662
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300.npz --H 50 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300.json
H=50, n_dof=6, feature_dim=18
X_train: (32332, 50, 18)  Y_train: (32332, 6)
X_test : (19263, 50, 18)  Y_test : (19263, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:36:09.823550: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:36:09.847299: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (32332, 50, 18), Y_train = (32332, 6)
  X_test  = (19263, 50, 18),  Y_test  = (19263, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:36:11.076927: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:11.081844: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:11.082792: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:11.084595: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:11.085503: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:11.086358: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:11.180735: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:11.181773: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:11.182703: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:11.183491: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:36:12.150929: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
102/102 - 2s - 17ms/step - loss: 0.3302 - val_loss: 0.3346
Epoch 2/80
102/102 - 0s - 4ms/step - loss: 0.2048 - val_loss: 0.3027
Epoch 3/80
102/102 - 0s - 4ms/step - loss: 0.1758 - val_loss: 0.2950
Epoch 4/80
102/102 - 0s - 4ms/step - loss: 0.1531 - val_loss: 0.2864
Epoch 5/80
102/102 - 0s - 4ms/step - loss: 0.1419 - val_loss: 0.2722
Epoch 6/80
102/102 - 0s - 4ms/step - loss: 0.1339 - val_loss: 0.2688
Epoch 7/80
102/102 - 0s - 4ms/step - loss: 0.1294 - val_loss: 0.2587
Epoch 8/80
102/102 - 0s - 4ms/step - loss: 0.1239 - val_loss: 0.2473
Epoch 9/80
102/102 - 0s - 4ms/step - loss: 0.1188 - val_loss: 0.2524
Epoch 10/80
102/102 - 0s - 4ms/step - loss: 0.1170 - val_loss: 0.2546
Epoch 11/80
102/102 - 0s - 5ms/step - loss: 0.1121 - val_loss: 0.2454
Epoch 12/80
102/102 - 0s - 4ms/step - loss: 0.1082 - val_loss: 0.2603
Epoch 13/80
102/102 - 0s - 4ms/step - loss: 0.1063 - val_loss: 0.2477
Epoch 14/80
102/102 - 0s - 4ms/step - loss: 0.1060 - val_loss: 0.2364
Epoch 15/80
102/102 - 0s - 4ms/step - loss: 0.1001 - val_loss: 0.2393
Epoch 16/80
102/102 - 0s - 4ms/step - loss: 0.0974 - val_loss: 0.2404
Epoch 17/80
102/102 - 0s - 4ms/step - loss: 0.0984 - val_loss: 0.2357
Epoch 18/80
102/102 - 0s - 4ms/step - loss: 0.0983 - val_loss: 0.2390
Epoch 19/80
102/102 - 0s - 4ms/step - loss: 0.0968 - val_loss: 0.2353
Epoch 20/80
102/102 - 0s - 4ms/step - loss: 0.0967 - val_loss: 0.2301
Epoch 21/80
102/102 - 0s - 4ms/step - loss: 0.0948 - val_loss: 0.2479
Epoch 22/80
102/102 - 0s - 4ms/step - loss: 0.0947 - val_loss: 0.2400
Epoch 23/80
102/102 - 0s - 4ms/step - loss: 0.0910 - val_loss: 0.2221
Epoch 24/80
102/102 - 0s - 4ms/step - loss: 0.0880 - val_loss: 0.2421
Epoch 25/80
102/102 - 0s - 4ms/step - loss: 0.0847 - val_loss: 0.2241
Epoch 26/80
102/102 - 0s - 4ms/step - loss: 0.0814 - val_loss: 0.2461
Epoch 27/80
102/102 - 0s - 4ms/step - loss: 0.0883 - val_loss: 0.2385
Epoch 28/80
102/102 - 0s - 4ms/step - loss: 0.0863 - val_loss: 0.2250
Epoch 29/80
102/102 - 0s - 4ms/step - loss: 0.0839 - val_loss: 0.2238
Epoch 30/80
102/102 - 0s - 4ms/step - loss: 0.0829 - val_loss: 0.2242
Epoch 31/80
102/102 - 0s - 4ms/step - loss: 0.0802 - val_loss: 0.2174
Epoch 32/80
102/102 - 0s - 4ms/step - loss: 0.0780 - val_loss: 0.2295
Epoch 33/80
102/102 - 0s - 4ms/step - loss: 0.0748 - val_loss: 0.2311
Epoch 34/80
102/102 - 0s - 4ms/step - loss: 0.0745 - val_loss: 0.2239
Epoch 35/80
102/102 - 0s - 4ms/step - loss: 0.0738 - val_loss: 0.2307
Epoch 36/80
102/102 - 0s - 4ms/step - loss: 0.0727 - val_loss: 0.2266
Epoch 37/80
102/102 - 0s - 4ms/step - loss: 0.0715 - val_loss: 0.2282
Epoch 38/80
102/102 - 0s - 4ms/step - loss: 0.0715 - val_loss: 0.2351
Epoch 39/80
102/102 - 0s - 4ms/step - loss: 0.0747 - val_loss: 0.2225
Epoch 40/80
102/102 - 0s - 4ms/step - loss: 0.0701 - val_loss: 0.2299
Epoch 41/80
102/102 - 0s - 4ms/step - loss: 0.0688 - val_loss: 0.2271
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6586
Per-joint RMSE: 0.8591 0.9819 0.6894 0.3863 0.3850 0.3575
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:36:30.680798: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:36:30.705416: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:36:31.558355: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:31.562986: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:31.563783: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:31.565487: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:31.566275: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:31.567017: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:31.645793: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:31.648662: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:31.649409: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:31.650145: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:36:31.955695: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.661615e-01  RMSE=6.827602e-01
  per-joint RMSE: 0.8721 1.0299 0.7204 0.3978 0.3900 0.3825
Residual LSTM:  MSE=4.337975e-01      RMSE=6.586331e-01
  per-joint RMSE: 0.8591 0.9819 0.6894 0.3863 0.3850 0.3575
Combined torque MSE=4.337975e-01     RMSE=6.586331e-01
  per-joint RMSE: 0.8591 0.9819 0.6894 0.3863 0.3850 0.3575
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300.npz --H 50 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300.json
H=50, n_dof=6, feature_dim=18
X_train: (32332, 50, 18)  Y_train: (32332, 6)
X_test : (19263, 50, 18)  Y_test : (19263, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:36:34.367181: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:36:34.391744: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (32332, 50, 18), Y_train = (32332, 6)
  X_test  = (19263, 50, 18),  Y_test  = (19263, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:36:35.604437: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:35.609419: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:35.610308: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:35.612068: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:35.612877: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:35.613635: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:35.697286: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:35.698176: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:35.698972: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:36:35.699759: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:36:36.720749: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
102/102 - 2s - 17ms/step - loss: 0.2905 - val_loss: 0.2824
Epoch 2/80
102/102 - 0s - 4ms/step - loss: 0.1671 - val_loss: 0.2281
Epoch 3/80
102/102 - 0s - 4ms/step - loss: 0.1356 - val_loss: 0.2007
Epoch 4/80
102/102 - 0s - 4ms/step - loss: 0.1254 - val_loss: 0.1945
Epoch 5/80
102/102 - 0s - 4ms/step - loss: 0.1214 - val_loss: 0.1797
Epoch 6/80
102/102 - 0s - 4ms/step - loss: 0.1091 - val_loss: 0.1786
Epoch 7/80
102/102 - 0s - 4ms/step - loss: 0.1015 - val_loss: 0.1733
Epoch 8/80
102/102 - 0s - 4ms/step - loss: 0.0988 - val_loss: 0.1737
Epoch 9/80
102/102 - 0s - 4ms/step - loss: 0.0946 - val_loss: 0.1706
Epoch 10/80
102/102 - 0s - 4ms/step - loss: 0.0928 - val_loss: 0.1686
Epoch 11/80
102/102 - 0s - 5ms/step - loss: 0.0892 - val_loss: 0.1670
Epoch 12/80
102/102 - 0s - 4ms/step - loss: 0.0869 - val_loss: 0.1664
Epoch 13/80
102/102 - 0s - 4ms/step - loss: 0.0854 - val_loss: 0.1672
Epoch 14/80
102/102 - 0s - 4ms/step - loss: 0.0838 - val_loss: 0.1637
Epoch 15/80
102/102 - 0s - 4ms/step - loss: 0.0852 - val_loss: 0.1696
Epoch 16/80
102/102 - 0s - 4ms/step - loss: 0.0812 - val_loss: 0.1644
Epoch 17/80
102/102 - 0s - 4ms/step - loss: 0.0796 - val_loss: 0.1658
Epoch 18/80
102/102 - 0s - 4ms/step - loss: 0.0778 - val_loss: 0.1627
Epoch 19/80
102/102 - 0s - 4ms/step - loss: 0.0769 - val_loss: 0.1635
Epoch 20/80
102/102 - 0s - 4ms/step - loss: 0.0750 - val_loss: 0.1647
Epoch 21/80
102/102 - 0s - 4ms/step - loss: 0.0740 - val_loss: 0.1635
Epoch 22/80
102/102 - 0s - 4ms/step - loss: 0.0731 - val_loss: 0.1630
Epoch 23/80
102/102 - 0s - 4ms/step - loss: 0.0717 - val_loss: 0.1619
Epoch 24/80
102/102 - 0s - 4ms/step - loss: 0.0710 - val_loss: 0.1626
Epoch 25/80
102/102 - 0s - 4ms/step - loss: 0.0701 - val_loss: 0.1615
Epoch 26/80
102/102 - 0s - 4ms/step - loss: 0.0693 - val_loss: 0.1626
Epoch 27/80
102/102 - 0s - 4ms/step - loss: 0.0688 - val_loss: 0.1644
Epoch 28/80
102/102 - 0s - 4ms/step - loss: 0.0683 - val_loss: 0.1610
Epoch 29/80
102/102 - 0s - 4ms/step - loss: 0.0674 - val_loss: 0.1644
Epoch 30/80
102/102 - 0s - 4ms/step - loss: 0.0674 - val_loss: 0.1635
Epoch 31/80
102/102 - 0s - 4ms/step - loss: 0.0658 - val_loss: 0.1628
Epoch 32/80
102/102 - 0s - 4ms/step - loss: 0.0654 - val_loss: 0.1636
Epoch 33/80
102/102 - 0s - 4ms/step - loss: 0.0646 - val_loss: 0.1605
Epoch 34/80
102/102 - 0s - 4ms/step - loss: 0.0644 - val_loss: 0.1636
Epoch 35/80
102/102 - 0s - 4ms/step - loss: 0.0644 - val_loss: 0.1604
Epoch 36/80
102/102 - 0s - 4ms/step - loss: 0.0654 - val_loss: 0.1633
Epoch 37/80
102/102 - 0s - 4ms/step - loss: 0.0630 - val_loss: 0.1640
Epoch 38/80
102/102 - 0s - 4ms/step - loss: 0.0613 - val_loss: 0.1602
Epoch 39/80
102/102 - 0s - 4ms/step - loss: 0.0620 - val_loss: 0.1619
Epoch 40/80
102/102 - 0s - 4ms/step - loss: 0.0617 - val_loss: 0.1584
Epoch 41/80
102/102 - 0s - 4ms/step - loss: 0.0600 - val_loss: 0.1593
Epoch 42/80
102/102 - 0s - 4ms/step - loss: 0.0596 - val_loss: 0.1604
Epoch 43/80
102/102 - 0s - 4ms/step - loss: 0.0603 - val_loss: 0.1582
Epoch 44/80
102/102 - 0s - 4ms/step - loss: 0.0594 - val_loss: 0.1585
Epoch 45/80
102/102 - 0s - 4ms/step - loss: 0.0582 - val_loss: 0.1602
Epoch 46/80
102/102 - 0s - 4ms/step - loss: 0.0581 - val_loss: 0.1576
Epoch 47/80
102/102 - 0s - 4ms/step - loss: 0.0579 - val_loss: 0.1587
Epoch 48/80
102/102 - 0s - 4ms/step - loss: 0.0574 - val_loss: 0.1576
Epoch 49/80
102/102 - 0s - 4ms/step - loss: 0.0566 - val_loss: 0.1580
Epoch 50/80
102/102 - 0s - 4ms/step - loss: 0.0572 - val_loss: 0.1603
Epoch 51/80
102/102 - 0s - 4ms/step - loss: 0.0586 - val_loss: 0.1604
Epoch 52/80
102/102 - 0s - 4ms/step - loss: 0.0577 - val_loss: 0.1592
Epoch 53/80
102/102 - 0s - 4ms/step - loss: 0.0560 - val_loss: 0.1646
Epoch 54/80
102/102 - 0s - 4ms/step - loss: 0.0577 - val_loss: 0.1612
Epoch 55/80
102/102 - 0s - 4ms/step - loss: 0.0555 - val_loss: 0.1613
Epoch 56/80
102/102 - 0s - 4ms/step - loss: 0.0569 - val_loss: 0.1640
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5783
Per-joint RMSE: 0.6430 0.9705 0.6002 0.3125 0.3110 0.3104
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:37:01.801054: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:37:01.824995: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:37:02.693451: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:37:02.698517: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:37:02.699453: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:37:02.701280: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:37:02.702147: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:37:02.702939: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:37:02.784128: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:37:02.785113: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:37:02.785922: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:37:02.786714: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:37:03.097456: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.661615e-01  RMSE=6.827602e-01
  per-joint RMSE: 0.8721 1.0299 0.7204 0.3978 0.3900 0.3825
Residual LSTM:  MSE=3.343812e-01      RMSE=5.782571e-01
  per-joint RMSE: 0.6430 0.9705 0.6002 0.3125 0.3110 0.3104
Combined torque MSE=3.343812e-01     RMSE=5.782571e-01
  per-joint RMSE: 0.6430 0.9705 0.6002 0.3125 0.3110 0.3104
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=2                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz                                ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed0_dataset.npz -t structured -s 2 -r 0 --hp_preset fast_debug --epochs 300 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300.jax' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 300, 'lagrangian_type': <function structured_lagrangian_fn at 0x753311c641f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed0_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed0_dataset.npz
   dt ≈ 0.022972524931080995
  dof = 6
  Train trajectories = 70
  Test trajectories  = 30
  Train samples = 34106
  Test samples  = 20043
################################################

2026-01-22 07:37:07.708618: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300 | type=structured | dof=6
################################################
2026-01-22 07:37:10.862595: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:37:10.862630: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:37:10.862636: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:37:10.862666: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:37:10.862671: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:37:10.862686: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:37:10.862722: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:37:10.862728: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:37:10.862745: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:37:10.862752: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.1s, Loss=9.81e+00, Inv=9.81e+00, For=1.30e+02, Power=2.39e+00
  [eval] test_mse=2.084e+00  (n=20043)
Epoch 00050: Time=  11.4s, Loss=2.71e+00, Inv=2.71e+00, For=1.13e+02, Power=1.35e+00
Epoch 00100: Time=  15.7s, Loss=2.45e+00, Inv=2.45e+00, For=1.29e+02, Power=1.20e+00
Epoch 00150: Time=  20.2s, Loss=2.32e+00, Inv=2.32e+00, For=1.48e+02, Power=1.14e+00
Epoch 00200: Time=  25.3s, Loss=2.24e+00, Inv=2.24e+00, For=1.80e+02, Power=1.10e+00
  [eval] test_mse=2.614e+00  (n=20043)
Epoch 00250: Time=  29.9s, Loss=2.19e+00, Inv=2.19e+00, For=2.12e+02, Power=1.08e+00
Epoch 00300: Time=  34.2s, Loss=2.16e+00, Inv=2.16e+00, For=2.48e+02, Power=1.06e+00
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300
Torque MSE  = 4.990e-01
Torque RMSE = 7.064e-01
Per-joint MSE : 9.183e-01 1.112e+00 5.998e-01 1.427e-01 1.079e-01 1.133e-01
Per-joint RMSE: 9.583e-01 1.054e+00 7.745e-01 3.778e-01 3.286e-01 3.366e-01
Comp Time per Sample = 1.609e-08s / 62166571.7Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed0_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed0_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300.jax
Detected n_dof=6 (seed=2)
2026-01-22 07:37:47.197652: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 70 trajectories
2026-01-22 07:37:48.505385: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:37:48.505399: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:37:50.008880: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:37:50.008893: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:37:51.595946: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/70
  done 50/70
2026-01-22 07:37:54.005196: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:37:55.200304: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 70/70

Exporting split=test: 30 trajectories
  done 25/30
  done 30/30

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300.npz --H 25 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300.json
H=25, n_dof=6, feature_dim=24
X_train: (33182, 25, 24)  Y_train: (33182, 6)
X_test : (19638, 25, 24)  Y_test : (19638, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:37:57.343116: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:37:57.367233: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (33182, 25, 24), Y_train = (33182, 6)
  X_test  = (19638, 25, 24),  Y_test  = (19638, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:37:58.497760: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:37:58.502766: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:37:58.503781: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:37:58.505689: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:37:58.506506: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:37:58.507394: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:37:58.590989: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:37:58.591884: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:37:58.592687: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:37:58.593564: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:37:59.521391: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
104/104 - 2s - 16ms/step - loss: 0.2901 - val_loss: 0.2595
Epoch 2/80
104/104 - 0s - 3ms/step - loss: 0.1597 - val_loss: 0.2181
Epoch 3/80
104/104 - 0s - 3ms/step - loss: 0.1320 - val_loss: 0.1947
Epoch 4/80
104/104 - 0s - 3ms/step - loss: 0.1180 - val_loss: 0.1874
Epoch 5/80
104/104 - 0s - 3ms/step - loss: 0.1097 - val_loss: 0.1824
Epoch 6/80
104/104 - 0s - 3ms/step - loss: 0.1032 - val_loss: 0.1796
Epoch 7/80
104/104 - 0s - 3ms/step - loss: 0.0989 - val_loss: 0.1763
Epoch 8/80
104/104 - 0s - 3ms/step - loss: 0.0965 - val_loss: 0.1754
Epoch 9/80
104/104 - 0s - 3ms/step - loss: 0.0909 - val_loss: 0.1717
Epoch 10/80
104/104 - 0s - 3ms/step - loss: 0.0892 - val_loss: 0.1736
Epoch 11/80
104/104 - 0s - 3ms/step - loss: 0.0876 - val_loss: 0.1705
Epoch 12/80
104/104 - 0s - 3ms/step - loss: 0.0843 - val_loss: 0.1688
Epoch 13/80
104/104 - 0s - 3ms/step - loss: 0.0825 - val_loss: 0.1717
Epoch 14/80
104/104 - 0s - 3ms/step - loss: 0.0809 - val_loss: 0.1683
Epoch 15/80
104/104 - 0s - 3ms/step - loss: 0.0799 - val_loss: 0.1698
Epoch 16/80
104/104 - 0s - 3ms/step - loss: 0.0788 - val_loss: 0.1674
Epoch 17/80
104/104 - 0s - 3ms/step - loss: 0.0771 - val_loss: 0.1700
Epoch 18/80
104/104 - 0s - 3ms/step - loss: 0.0757 - val_loss: 0.1686
Epoch 19/80
104/104 - 0s - 3ms/step - loss: 0.0755 - val_loss: 0.1682
Epoch 20/80
104/104 - 0s - 3ms/step - loss: 0.0739 - val_loss: 0.1687
Epoch 21/80
104/104 - 0s - 3ms/step - loss: 0.0728 - val_loss: 0.1676
Epoch 22/80
104/104 - 0s - 3ms/step - loss: 0.0716 - val_loss: 0.1647
Epoch 23/80
104/104 - 0s - 3ms/step - loss: 0.0716 - val_loss: 0.1655
Epoch 24/80
104/104 - 0s - 3ms/step - loss: 0.0700 - val_loss: 0.1627
Epoch 25/80
104/104 - 0s - 3ms/step - loss: 0.0694 - val_loss: 0.1643
Epoch 26/80
104/104 - 0s - 3ms/step - loss: 0.0695 - val_loss: 0.1618
Epoch 27/80
104/104 - 0s - 3ms/step - loss: 0.0674 - val_loss: 0.1617
Epoch 28/80
104/104 - 0s - 3ms/step - loss: 0.0663 - val_loss: 0.1597
Epoch 29/80
104/104 - 0s - 3ms/step - loss: 0.0656 - val_loss: 0.1580
Epoch 30/80
104/104 - 0s - 3ms/step - loss: 0.0652 - val_loss: 0.1581
Epoch 31/80
104/104 - 0s - 3ms/step - loss: 0.0644 - val_loss: 0.1569
Epoch 32/80
104/104 - 0s - 3ms/step - loss: 0.0633 - val_loss: 0.1583
Epoch 33/80
104/104 - 0s - 3ms/step - loss: 0.0634 - val_loss: 0.1575
Epoch 34/80
104/104 - 0s - 3ms/step - loss: 0.0631 - val_loss: 0.1552
Epoch 35/80
104/104 - 0s - 3ms/step - loss: 0.0619 - val_loss: 0.1571
Epoch 36/80
104/104 - 0s - 3ms/step - loss: 0.0609 - val_loss: 0.1574
Epoch 37/80
104/104 - 0s - 3ms/step - loss: 0.0610 - val_loss: 0.1569
Epoch 38/80
104/104 - 0s - 3ms/step - loss: 0.0596 - val_loss: 0.1567
Epoch 39/80
104/104 - 0s - 3ms/step - loss: 0.0601 - val_loss: 0.1535
Epoch 40/80
104/104 - 0s - 3ms/step - loss: 0.0591 - val_loss: 0.1555
Epoch 41/80
104/104 - 0s - 3ms/step - loss: 0.0591 - val_loss: 0.1571
Epoch 42/80
104/104 - 0s - 3ms/step - loss: 0.0585 - val_loss: 0.1565
Epoch 43/80
104/104 - 0s - 3ms/step - loss: 0.0582 - val_loss: 0.1561
Epoch 44/80
104/104 - 0s - 3ms/step - loss: 0.0580 - val_loss: 0.1558
Epoch 45/80
104/104 - 0s - 3ms/step - loss: 0.0575 - val_loss: 0.1538
Epoch 46/80
104/104 - 0s - 3ms/step - loss: 0.0568 - val_loss: 0.1542
Epoch 47/80
104/104 - 0s - 3ms/step - loss: 0.0564 - val_loss: 0.1561
Epoch 48/80
104/104 - 0s - 3ms/step - loss: 0.0565 - val_loss: 0.1548
Epoch 49/80
104/104 - 0s - 3ms/step - loss: 0.0558 - val_loss: 0.1559
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5931
Per-joint RMSE: 0.7842 0.8953 0.6671 0.3141 0.2760 0.2726
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:38:14.974750: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:38:15.000105: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 07:38:15.854874: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:15.859862: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:15.860905: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:15.862618: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:15.863500: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:15.864298: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:15.945188: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:15.946102: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:15.946897: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:15.947740: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:38:16.246359: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.054680e-01  RMSE=7.109627e-01
  per-joint RMSE: 0.9663 1.0605 0.7794 0.3785 0.3302 0.3384
Residual LSTM:  MSE=3.517904e-01      RMSE=5.931192e-01
  per-joint RMSE: 0.7842 0.8953 0.6671 0.3141 0.2760 0.2726
Combined torque MSE=3.517904e-01     RMSE=5.931192e-01
  per-joint RMSE: 0.7842 0.8953 0.6671 0.3141 0.2760 0.2726
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300.npz --H 25 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300.json
H=25, n_dof=6, feature_dim=6
X_train: (33182, 25, 6)  Y_train: (33182, 6)
X_test : (19638, 25, 6)  Y_test : (19638, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:38:18.420593: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:38:18.444884: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (33182, 25, 6), Y_train = (33182, 6)
  X_test  = (19638, 25, 6),  Y_test  = (19638, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:38:19.447926: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:19.452399: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:19.453272: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:19.454848: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:19.455634: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:19.456381: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:19.528026: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:19.528878: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:19.529769: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:19.530499: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:38:20.435483: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
104/104 - 2s - 16ms/step - loss: 0.8008 - val_loss: 0.7390
Epoch 2/80
104/104 - 0s - 3ms/step - loss: 0.6300 - val_loss: 0.6165
Epoch 3/80
104/104 - 0s - 3ms/step - loss: 0.5113 - val_loss: 0.5774
Epoch 4/80
104/104 - 0s - 3ms/step - loss: 0.4453 - val_loss: 0.5653
Epoch 5/80
104/104 - 0s - 3ms/step - loss: 0.3954 - val_loss: 0.5499
Epoch 6/80
104/104 - 0s - 3ms/step - loss: 0.3489 - val_loss: 0.4971
Epoch 7/80
104/104 - 0s - 3ms/step - loss: 0.3126 - val_loss: 0.4825
Epoch 8/80
104/104 - 0s - 3ms/step - loss: 0.2822 - val_loss: 0.4366
Epoch 9/80
104/104 - 0s - 3ms/step - loss: 0.2772 - val_loss: 0.3788
Epoch 10/80
104/104 - 0s - 3ms/step - loss: 0.2450 - val_loss: 0.3528
Epoch 11/80
104/104 - 0s - 3ms/step - loss: 0.2373 - val_loss: 0.3632
Epoch 12/80
104/104 - 0s - 3ms/step - loss: 0.2200 - val_loss: 0.3359
Epoch 13/80
104/104 - 0s - 3ms/step - loss: 0.2063 - val_loss: 0.3077
Epoch 14/80
104/104 - 0s - 3ms/step - loss: 0.1994 - val_loss: 0.3013
Epoch 15/80
104/104 - 0s - 3ms/step - loss: 0.2085 - val_loss: 0.3162
Epoch 16/80
104/104 - 0s - 3ms/step - loss: 0.1836 - val_loss: 0.3057
Epoch 17/80
104/104 - 0s - 3ms/step - loss: 0.1715 - val_loss: 0.3016
Epoch 18/80
104/104 - 0s - 3ms/step - loss: 0.1681 - val_loss: 0.2921
Epoch 19/80
104/104 - 0s - 3ms/step - loss: 0.1675 - val_loss: 0.4066
Epoch 20/80
104/104 - 0s - 3ms/step - loss: 0.1844 - val_loss: 0.3179
Epoch 21/80
104/104 - 0s - 3ms/step - loss: 0.1578 - val_loss: 0.2874
Epoch 22/80
104/104 - 0s - 3ms/step - loss: 0.1505 - val_loss: 0.2871
Epoch 23/80
104/104 - 0s - 3ms/step - loss: 0.1509 - val_loss: 0.2834
Epoch 24/80
104/104 - 0s - 3ms/step - loss: 0.1433 - val_loss: 0.3049
Epoch 25/80
104/104 - 0s - 3ms/step - loss: 0.1524 - val_loss: 0.2832
Epoch 26/80
104/104 - 0s - 3ms/step - loss: 0.1412 - val_loss: 0.2832
Epoch 27/80
104/104 - 0s - 3ms/step - loss: 0.1346 - val_loss: 0.2799
Epoch 28/80
104/104 - 0s - 3ms/step - loss: 0.1374 - val_loss: 0.2766
Epoch 29/80
104/104 - 0s - 3ms/step - loss: 0.1384 - val_loss: 0.3199
Epoch 30/80
104/104 - 0s - 3ms/step - loss: 0.1935 - val_loss: 0.2769
Epoch 31/80
104/104 - 0s - 3ms/step - loss: 0.1660 - val_loss: 0.3177
Epoch 32/80
104/104 - 0s - 3ms/step - loss: 0.1597 - val_loss: 0.2890
Epoch 33/80
104/104 - 0s - 3ms/step - loss: 0.1349 - val_loss: 0.2912
Epoch 34/80
104/104 - 0s - 3ms/step - loss: 0.1227 - val_loss: 0.2762
Epoch 35/80
104/104 - 0s - 3ms/step - loss: 0.1209 - val_loss: 0.4084
Epoch 36/80
104/104 - 0s - 3ms/step - loss: 0.1437 - val_loss: 0.2951
Epoch 37/80
104/104 - 0s - 3ms/step - loss: 0.1313 - val_loss: 0.2847
Epoch 38/80
104/104 - 0s - 3ms/step - loss: 0.1236 - val_loss: 0.2763
Epoch 39/80
104/104 - 0s - 3ms/step - loss: 0.1188 - val_loss: 0.2717
Epoch 40/80
104/104 - 0s - 3ms/step - loss: 0.1165 - val_loss: 0.2849
Epoch 41/80
104/104 - 0s - 3ms/step - loss: 0.1160 - val_loss: 0.2765
Epoch 42/80
104/104 - 0s - 3ms/step - loss: 0.1111 - val_loss: 0.2904
Epoch 43/80
104/104 - 0s - 3ms/step - loss: 0.1146 - val_loss: 0.2775
Epoch 44/80
104/104 - 0s - 3ms/step - loss: 0.1110 - val_loss: 0.2681
Epoch 45/80
104/104 - 0s - 3ms/step - loss: 0.1114 - val_loss: 0.2622
Epoch 46/80
104/104 - 0s - 3ms/step - loss: 0.1054 - val_loss: 0.2706
Epoch 47/80
104/104 - 0s - 3ms/step - loss: 0.1050 - val_loss: 0.2875
Epoch 48/80
104/104 - 0s - 3ms/step - loss: 0.1121 - val_loss: 0.2661
Epoch 49/80
104/104 - 0s - 3ms/step - loss: 0.1284 - val_loss: 0.2664
Epoch 50/80
104/104 - 0s - 3ms/step - loss: 0.1091 - val_loss: 0.2807
Epoch 51/80
104/104 - 0s - 3ms/step - loss: 0.1009 - val_loss: 0.2673
Epoch 52/80
104/104 - 0s - 3ms/step - loss: 0.0985 - val_loss: 0.2723
Epoch 53/80
104/104 - 0s - 3ms/step - loss: 0.1018 - val_loss: 0.2772
Epoch 54/80
104/104 - 0s - 3ms/step - loss: 0.0957 - val_loss: 0.2695
Epoch 55/80
104/104 - 0s - 3ms/step - loss: 0.0935 - val_loss: 0.2765
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6774
Per-joint RMSE: 0.8954 0.9861 0.7806 0.3863 0.3291 0.3342
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:38:37.366097: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:38:37.391469: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 07:38:38.247660: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:38.252336: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:38.253214: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:38.254922: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:38.255711: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:38.256449: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:38.338493: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:38.339336: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:38.340158: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:38.340893: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:38:38.635970: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.054680e-01  RMSE=7.109627e-01
  per-joint RMSE: 0.9663 1.0605 0.7794 0.3785 0.3302 0.3384
Residual LSTM:  MSE=4.588206e-01      RMSE=6.773629e-01
  per-joint RMSE: 0.8954 0.9861 0.7806 0.3863 0.3291 0.3342
Combined torque MSE=4.588206e-01     RMSE=6.773629e-01
  per-joint RMSE: 0.8954 0.9861 0.7806 0.3863 0.3291 0.3342
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300.npz --H 25 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300.json
H=25, n_dof=6, feature_dim=18
X_train: (33182, 25, 18)  Y_train: (33182, 6)
X_test : (19638, 25, 18)  Y_test : (19638, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:38:40.893715: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:38:40.918243: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (33182, 25, 18), Y_train = (33182, 6)
  X_test  = (19638, 25, 18),  Y_test  = (19638, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:38:41.987242: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:41.992007: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:41.992811: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:41.994473: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:41.995326: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:41.996080: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:42.076555: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:42.077597: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:42.078462: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:42.079220: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:38:43.055105: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
104/104 - 2s - 16ms/step - loss: 0.3294 - val_loss: 0.3156
Epoch 2/80
104/104 - 0s - 3ms/step - loss: 0.1928 - val_loss: 0.2785
Epoch 3/80
104/104 - 0s - 3ms/step - loss: 0.1634 - val_loss: 0.2722
Epoch 4/80
104/104 - 0s - 3ms/step - loss: 0.1466 - val_loss: 0.2729
Epoch 5/80
104/104 - 0s - 3ms/step - loss: 0.1381 - val_loss: 0.2719
Epoch 6/80
104/104 - 0s - 3ms/step - loss: 0.1276 - val_loss: 0.2579
Epoch 7/80
104/104 - 0s - 3ms/step - loss: 0.1220 - val_loss: 0.2626
Epoch 8/80
104/104 - 0s - 3ms/step - loss: 0.1170 - val_loss: 0.2602
Epoch 9/80
104/104 - 0s - 3ms/step - loss: 0.1122 - val_loss: 0.2436
Epoch 10/80
104/104 - 0s - 3ms/step - loss: 0.1083 - val_loss: 0.2464
Epoch 11/80
104/104 - 0s - 3ms/step - loss: 0.1067 - val_loss: 0.2418
Epoch 12/80
104/104 - 0s - 3ms/step - loss: 0.1038 - val_loss: 0.2294
Epoch 13/80
104/104 - 0s - 3ms/step - loss: 0.1005 - val_loss: 0.2411
Epoch 14/80
104/104 - 0s - 3ms/step - loss: 0.0985 - val_loss: 0.2370
Epoch 15/80
104/104 - 0s - 3ms/step - loss: 0.0936 - val_loss: 0.2262
Epoch 16/80
104/104 - 0s - 3ms/step - loss: 0.0945 - val_loss: 0.2346
Epoch 17/80
104/104 - 0s - 3ms/step - loss: 0.0953 - val_loss: 0.2438
Epoch 18/80
104/104 - 0s - 3ms/step - loss: 0.0907 - val_loss: 0.2464
Epoch 19/80
104/104 - 0s - 3ms/step - loss: 0.0879 - val_loss: 0.2314
Epoch 20/80
104/104 - 0s - 3ms/step - loss: 0.0881 - val_loss: 0.2390
Epoch 21/80
104/104 - 0s - 3ms/step - loss: 0.0837 - val_loss: 0.2398
Epoch 22/80
104/104 - 0s - 3ms/step - loss: 0.0814 - val_loss: 0.2405
Epoch 23/80
104/104 - 0s - 3ms/step - loss: 0.0820 - val_loss: 0.2361
Epoch 24/80
104/104 - 0s - 3ms/step - loss: 0.0829 - val_loss: 0.2317
Epoch 25/80
104/104 - 0s - 3ms/step - loss: 0.0827 - val_loss: 0.2372
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7020
Per-joint RMSE: 0.9640 1.0500 0.7798 0.3565 0.3116 0.3038
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:38:51.794927: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:38:51.819929: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:38:52.685047: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:52.689691: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:52.690474: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:52.692113: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:52.692903: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:52.693641: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:52.774112: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:52.775027: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:52.775767: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:52.776484: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:38:53.070432: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.054680e-01  RMSE=7.109627e-01
  per-joint RMSE: 0.9663 1.0605 0.7794 0.3785 0.3302 0.3384
Residual LSTM:  MSE=4.927341e-01      RMSE=7.019502e-01
  per-joint RMSE: 0.9640 1.0500 0.7798 0.3565 0.3116 0.3038
Combined torque MSE=4.927341e-01     RMSE=7.019502e-01
  per-joint RMSE: 0.9640 1.0500 0.7798 0.3565 0.3116 0.3038
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300.npz --H 25 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300.json
H=25, n_dof=6, feature_dim=18
X_train: (33182, 25, 18)  Y_train: (33182, 6)
X_test : (19638, 25, 18)  Y_test : (19638, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:38:55.338561: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:38:55.362351: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (33182, 25, 18), Y_train = (33182, 6)
  X_test  = (19638, 25, 18),  Y_test  = (19638, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:38:56.428085: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:56.432697: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:56.433488: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:56.435195: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:56.435988: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:56.436728: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:56.521571: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:56.522560: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:56.523305: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:38:56.524039: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:38:57.470185: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
104/104 - 2s - 16ms/step - loss: 0.2946 - val_loss: 0.2638
Epoch 2/80
104/104 - 0s - 3ms/step - loss: 0.1630 - val_loss: 0.2296
Epoch 3/80
104/104 - 0s - 3ms/step - loss: 0.1367 - val_loss: 0.2037
Epoch 4/80
104/104 - 0s - 3ms/step - loss: 0.1201 - val_loss: 0.1947
Epoch 5/80
104/104 - 0s - 3ms/step - loss: 0.1136 - val_loss: 0.1877
Epoch 6/80
104/104 - 0s - 3ms/step - loss: 0.1048 - val_loss: 0.1840
Epoch 7/80
104/104 - 0s - 3ms/step - loss: 0.1023 - val_loss: 0.1835
Epoch 8/80
104/104 - 0s - 3ms/step - loss: 0.0965 - val_loss: 0.1799
Epoch 9/80
104/104 - 0s - 3ms/step - loss: 0.0925 - val_loss: 0.1780
Epoch 10/80
104/104 - 0s - 3ms/step - loss: 0.0904 - val_loss: 0.1750
Epoch 11/80
104/104 - 0s - 3ms/step - loss: 0.0880 - val_loss: 0.1748
Epoch 12/80
104/104 - 0s - 3ms/step - loss: 0.0853 - val_loss: 0.1728
Epoch 13/80
104/104 - 0s - 3ms/step - loss: 0.0829 - val_loss: 0.1718
Epoch 14/80
104/104 - 0s - 3ms/step - loss: 0.0813 - val_loss: 0.1663
Epoch 15/80
104/104 - 0s - 3ms/step - loss: 0.0802 - val_loss: 0.1683
Epoch 16/80
104/104 - 0s - 3ms/step - loss: 0.0781 - val_loss: 0.1703
Epoch 17/80
104/104 - 0s - 3ms/step - loss: 0.0771 - val_loss: 0.1695
Epoch 18/80
104/104 - 0s - 3ms/step - loss: 0.0759 - val_loss: 0.1657
Epoch 19/80
104/104 - 0s - 3ms/step - loss: 0.0756 - val_loss: 0.1673
Epoch 20/80
104/104 - 0s - 3ms/step - loss: 0.0741 - val_loss: 0.1645
Epoch 21/80
104/104 - 0s - 3ms/step - loss: 0.0730 - val_loss: 0.1681
Epoch 22/80
104/104 - 0s - 3ms/step - loss: 0.0730 - val_loss: 0.1668
Epoch 23/80
104/104 - 0s - 3ms/step - loss: 0.0718 - val_loss: 0.1633
Epoch 24/80
104/104 - 0s - 3ms/step - loss: 0.0697 - val_loss: 0.1618
Epoch 25/80
104/104 - 0s - 3ms/step - loss: 0.0699 - val_loss: 0.1619
Epoch 26/80
104/104 - 0s - 3ms/step - loss: 0.0695 - val_loss: 0.1645
Epoch 27/80
104/104 - 0s - 3ms/step - loss: 0.0680 - val_loss: 0.1627
Epoch 28/80
104/104 - 0s - 3ms/step - loss: 0.0670 - val_loss: 0.1634
Epoch 29/80
104/104 - 0s - 3ms/step - loss: 0.0667 - val_loss: 0.1642
Epoch 30/80
104/104 - 0s - 3ms/step - loss: 0.0659 - val_loss: 0.1618
Epoch 31/80
104/104 - 0s - 3ms/step - loss: 0.0662 - val_loss: 0.1628
Epoch 32/80
104/104 - 0s - 3ms/step - loss: 0.0655 - val_loss: 0.1639
Epoch 33/80
104/104 - 0s - 3ms/step - loss: 0.0649 - val_loss: 0.1615
Epoch 34/80
104/104 - 0s - 3ms/step - loss: 0.0641 - val_loss: 0.1641
Epoch 35/80
104/104 - 0s - 3ms/step - loss: 0.0636 - val_loss: 0.1623
Epoch 36/80
104/104 - 0s - 3ms/step - loss: 0.0630 - val_loss: 0.1629
Epoch 37/80
104/104 - 0s - 3ms/step - loss: 0.0624 - val_loss: 0.1608
Epoch 38/80
104/104 - 0s - 3ms/step - loss: 0.0619 - val_loss: 0.1618
Epoch 39/80
104/104 - 0s - 3ms/step - loss: 0.0618 - val_loss: 0.1634
Epoch 40/80
104/104 - 0s - 3ms/step - loss: 0.0614 - val_loss: 0.1607
Epoch 41/80
104/104 - 0s - 3ms/step - loss: 0.0604 - val_loss: 0.1637
Epoch 42/80
104/104 - 0s - 3ms/step - loss: 0.0602 - val_loss: 0.1615
Epoch 43/80
104/104 - 0s - 3ms/step - loss: 0.0596 - val_loss: 0.1616
Epoch 44/80
104/104 - 0s - 3ms/step - loss: 0.0589 - val_loss: 0.1628
Epoch 45/80
104/104 - 0s - 3ms/step - loss: 0.0584 - val_loss: 0.1601
Epoch 46/80
104/104 - 0s - 3ms/step - loss: 0.0579 - val_loss: 0.1597
Epoch 47/80
104/104 - 0s - 3ms/step - loss: 0.0575 - val_loss: 0.1608
Epoch 48/80
104/104 - 0s - 3ms/step - loss: 0.0573 - val_loss: 0.1614
Epoch 49/80
104/104 - 0s - 3ms/step - loss: 0.0566 - val_loss: 0.1630
Epoch 50/80
104/104 - 0s - 3ms/step - loss: 0.0566 - val_loss: 0.1631
Epoch 51/80
104/104 - 0s - 3ms/step - loss: 0.0563 - val_loss: 0.1612
Epoch 52/80
104/104 - 0s - 3ms/step - loss: 0.0562 - val_loss: 0.1617
Epoch 53/80
104/104 - 0s - 3ms/step - loss: 0.0568 - val_loss: 0.1613
Epoch 54/80
104/104 - 0s - 3ms/step - loss: 0.0555 - val_loss: 0.1620
Epoch 55/80
104/104 - 0s - 3ms/step - loss: 0.0552 - val_loss: 0.1648
Epoch 56/80
104/104 - 0s - 3ms/step - loss: 0.0541 - val_loss: 0.1645
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6131
Per-joint RMSE: 0.7584 0.9785 0.6842 0.3281 0.2771 0.2643
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:39:14.757912: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:39:14.782548: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:39:15.649111: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:15.653914: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:15.654753: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:15.656437: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:15.657274: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:15.658071: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:15.736166: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:15.737054: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:15.737853: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:15.738638: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8959 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:39:16.039816: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.054680e-01  RMSE=7.109627e-01
  per-joint RMSE: 0.9663 1.0605 0.7794 0.3785 0.3302 0.3384
Residual LSTM:  MSE=3.758374e-01      RMSE=6.130558e-01
  per-joint RMSE: 0.7584 0.9785 0.6842 0.3281 0.2771 0.2643
Combined torque MSE=3.758374e-01     RMSE=6.130558e-01
  per-joint RMSE: 0.7584 0.9785 0.6842 0.3281 0.2771 0.2643
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300.npz --H 50 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300.json
H=50, n_dof=6, feature_dim=24
X_train: (32332, 50, 24)  Y_train: (32332, 6)
X_test : (19263, 50, 24)  Y_test : (19263, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:39:18.387367: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:39:18.411471: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (32332, 50, 24), Y_train = (32332, 6)
  X_test  = (19263, 50, 24),  Y_test  = (19263, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:39:19.778232: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:19.783221: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:19.784221: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:19.786141: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:19.787053: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:19.787802: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:19.875192: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:19.876097: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:19.876895: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:19.877747: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:39:20.955014: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
102/102 - 2s - 18ms/step - loss: 0.2965 - val_loss: 0.2899
Epoch 2/80
102/102 - 0s - 4ms/step - loss: 0.1712 - val_loss: 0.2295
Epoch 3/80
102/102 - 0s - 4ms/step - loss: 0.1399 - val_loss: 0.2091
Epoch 4/80
102/102 - 0s - 4ms/step - loss: 0.1276 - val_loss: 0.1919
Epoch 5/80
102/102 - 0s - 4ms/step - loss: 0.1147 - val_loss: 0.1833
Epoch 6/80
102/102 - 0s - 4ms/step - loss: 0.1104 - val_loss: 0.1790
Epoch 7/80
102/102 - 0s - 4ms/step - loss: 0.1043 - val_loss: 0.1761
Epoch 8/80
102/102 - 0s - 4ms/step - loss: 0.0997 - val_loss: 0.1715
Epoch 9/80
102/102 - 0s - 4ms/step - loss: 0.0985 - val_loss: 0.1726
Epoch 10/80
102/102 - 0s - 4ms/step - loss: 0.0970 - val_loss: 0.1718
Epoch 11/80
102/102 - 0s - 5ms/step - loss: 0.0898 - val_loss: 0.1696
Epoch 12/80
102/102 - 0s - 4ms/step - loss: 0.0888 - val_loss: 0.1694
Epoch 13/80
102/102 - 0s - 4ms/step - loss: 0.0860 - val_loss: 0.1660
Epoch 14/80
102/102 - 0s - 4ms/step - loss: 0.0834 - val_loss: 0.1662
Epoch 15/80
102/102 - 0s - 4ms/step - loss: 0.0816 - val_loss: 0.1672
Epoch 16/80
102/102 - 0s - 4ms/step - loss: 0.0794 - val_loss: 0.1659
Epoch 17/80
102/102 - 0s - 4ms/step - loss: 0.0784 - val_loss: 0.1666
Epoch 18/80
102/102 - 0s - 4ms/step - loss: 0.0773 - val_loss: 0.1668
Epoch 19/80
102/102 - 0s - 4ms/step - loss: 0.0761 - val_loss: 0.1647
Epoch 20/80
102/102 - 0s - 4ms/step - loss: 0.0748 - val_loss: 0.1637
Epoch 21/80
102/102 - 0s - 4ms/step - loss: 0.0737 - val_loss: 0.1665
Epoch 22/80
102/102 - 0s - 4ms/step - loss: 0.0736 - val_loss: 0.1619
Epoch 23/80
102/102 - 0s - 4ms/step - loss: 0.0719 - val_loss: 0.1611
Epoch 24/80
102/102 - 0s - 4ms/step - loss: 0.0710 - val_loss: 0.1648
Epoch 25/80
102/102 - 0s - 4ms/step - loss: 0.0710 - val_loss: 0.1630
Epoch 26/80
102/102 - 0s - 4ms/step - loss: 0.0702 - val_loss: 0.1643
Epoch 27/80
102/102 - 0s - 4ms/step - loss: 0.0710 - val_loss: 0.1646
Epoch 28/80
102/102 - 0s - 4ms/step - loss: 0.0713 - val_loss: 0.1620
Epoch 29/80
102/102 - 0s - 4ms/step - loss: 0.0681 - val_loss: 0.1631
Epoch 30/80
102/102 - 0s - 4ms/step - loss: 0.0672 - val_loss: 0.1655
Epoch 31/80
102/102 - 0s - 4ms/step - loss: 0.0666 - val_loss: 0.1623
Epoch 32/80
102/102 - 0s - 4ms/step - loss: 0.0650 - val_loss: 0.1608
Epoch 33/80
102/102 - 0s - 4ms/step - loss: 0.0641 - val_loss: 0.1606
Epoch 34/80
102/102 - 0s - 4ms/step - loss: 0.0645 - val_loss: 0.1597
Epoch 35/80
102/102 - 0s - 4ms/step - loss: 0.0636 - val_loss: 0.1594
Epoch 36/80
102/102 - 0s - 4ms/step - loss: 0.0632 - val_loss: 0.1603
Epoch 37/80
102/102 - 0s - 4ms/step - loss: 0.0622 - val_loss: 0.1596
Epoch 38/80
102/102 - 0s - 4ms/step - loss: 0.0618 - val_loss: 0.1571
Epoch 39/80
102/102 - 0s - 4ms/step - loss: 0.0615 - val_loss: 0.1579
Epoch 40/80
102/102 - 0s - 4ms/step - loss: 0.0603 - val_loss: 0.1572
Epoch 41/80
102/102 - 0s - 4ms/step - loss: 0.0605 - val_loss: 0.1605
Epoch 42/80
102/102 - 0s - 4ms/step - loss: 0.0602 - val_loss: 0.1582
Epoch 43/80
102/102 - 0s - 4ms/step - loss: 0.0589 - val_loss: 0.1580
Epoch 44/80
102/102 - 0s - 4ms/step - loss: 0.0587 - val_loss: 0.1612
Epoch 45/80
102/102 - 0s - 4ms/step - loss: 0.0580 - val_loss: 0.1565
Epoch 46/80
102/102 - 0s - 4ms/step - loss: 0.0578 - val_loss: 0.1591
Epoch 47/80
102/102 - 0s - 4ms/step - loss: 0.0567 - val_loss: 0.1579
Epoch 48/80
102/102 - 0s - 4ms/step - loss: 0.0575 - val_loss: 0.1577
Epoch 49/80
102/102 - 0s - 4ms/step - loss: 0.0566 - val_loss: 0.1587
Epoch 50/80
102/102 - 0s - 4ms/step - loss: 0.0566 - val_loss: 0.1594
Epoch 51/80
102/102 - 0s - 4ms/step - loss: 0.0564 - val_loss: 0.1587
Epoch 52/80
102/102 - 0s - 4ms/step - loss: 0.0556 - val_loss: 0.1598
Epoch 53/80
102/102 - 0s - 4ms/step - loss: 0.0558 - val_loss: 0.1618
Epoch 54/80
102/102 - 0s - 4ms/step - loss: 0.0556 - val_loss: 0.1604
Epoch 55/80
102/102 - 0s - 4ms/step - loss: 0.0551 - val_loss: 0.1600
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5968
Per-joint RMSE: 0.7979 0.9028 0.6648 0.3109 0.2676 0.2744
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:39:45.394619: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:39:45.419472: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 07:39:46.276252: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:46.281004: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:46.281874: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:46.283553: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:46.284352: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:46.285086: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:46.363360: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:46.364199: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:46.365034: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:46.365760: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8959 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:39:46.664926: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.115545e-01  RMSE=7.152304e-01
  per-joint RMSE: 0.9738 1.0660 0.7841 0.3791 0.3323 0.3399
Residual LSTM:  MSE=3.562032e-01      RMSE=5.968276e-01
  per-joint RMSE: 0.7979 0.9028 0.6648 0.3109 0.2676 0.2744
Combined torque MSE=3.562032e-01     RMSE=5.968276e-01
  per-joint RMSE: 0.7979 0.9028 0.6648 0.3109 0.2676 0.2744
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s0_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300.npz --H 50 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300.json
H=50, n_dof=6, feature_dim=6
X_train: (32332, 50, 6)  Y_train: (32332, 6)
X_test : (19263, 50, 6)  Y_test : (19263, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:39:48.920083: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:39:48.944541: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (32332, 50, 6), Y_train = (32332, 6)
  X_test  = (19263, 50, 6),  Y_test  = (19263, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:39:50.014441: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:50.019014: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:50.019809: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:50.021406: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:50.022200: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:50.022934: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:50.102575: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:50.103580: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:50.104378: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:39:50.105109: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:39:51.069990: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
102/102 - 2s - 17ms/step - loss: 0.7684 - val_loss: 0.6894
Epoch 2/80
102/102 - 0s - 4ms/step - loss: 0.5644 - val_loss: 0.6943
Epoch 3/80
102/102 - 0s - 4ms/step - loss: 0.4522 - val_loss: 0.6185
Epoch 4/80
102/102 - 0s - 4ms/step - loss: 0.3474 - val_loss: 0.4720
Epoch 5/80
102/102 - 0s - 4ms/step - loss: 0.2910 - val_loss: 0.4210
Epoch 6/80
102/102 - 0s - 4ms/step - loss: 0.2494 - val_loss: 0.4039
Epoch 7/80
102/102 - 0s - 4ms/step - loss: 0.2460 - val_loss: 0.3769
Epoch 8/80
102/102 - 0s - 4ms/step - loss: 0.2230 - val_loss: 0.3825
Epoch 9/80
102/102 - 0s - 4ms/step - loss: 0.1969 - val_loss: 0.3217
Epoch 10/80
102/102 - 0s - 4ms/step - loss: 0.1833 - val_loss: 0.3323
Epoch 11/80
102/102 - 0s - 5ms/step - loss: 0.1796 - val_loss: 0.3408
Epoch 12/80
102/102 - 0s - 4ms/step - loss: 0.1679 - val_loss: 0.3067
Epoch 13/80
102/102 - 0s - 4ms/step - loss: 0.1586 - val_loss: 0.3329
Epoch 14/80
102/102 - 0s - 4ms/step - loss: 0.1520 - val_loss: 0.3331
Epoch 15/80
102/102 - 0s - 4ms/step - loss: 0.2458 - val_loss: 0.4897
Epoch 16/80
102/102 - 0s - 4ms/step - loss: 0.1974 - val_loss: 0.3190
Epoch 17/80
102/102 - 0s - 4ms/step - loss: 0.1503 - val_loss: 0.2782
Epoch 18/80
102/102 - 0s - 4ms/step - loss: 0.1411 - val_loss: 0.2879
Epoch 19/80
102/102 - 0s - 4ms/step - loss: 0.1345 - val_loss: 0.2761
Epoch 20/80
102/102 - 0s - 4ms/step - loss: 0.1285 - val_loss: 0.2866
Epoch 21/80
102/102 - 0s - 4ms/step - loss: 0.1258 - val_loss: 0.2789
Epoch 22/80
102/102 - 0s - 4ms/step - loss: 0.1226 - val_loss: 0.2770
Epoch 23/80
102/102 - 0s - 4ms/step - loss: 0.1221 - val_loss: 0.2693
Epoch 24/80
102/102 - 0s - 4ms/step - loss: 0.1196 - val_loss: 0.2697
Epoch 25/80
102/102 - 0s - 4ms/step - loss: 0.1239 - val_loss: 0.2906
Epoch 26/80
102/102 - 0s - 4ms/step - loss: 0.1724 - val_loss: 0.2947
Epoch 27/80
102/102 - 0s - 4ms/step - loss: 0.1243 - val_loss: 0.2802
Epoch 28/80
102/102 - 0s - 4ms/step - loss: 0.1126 - val_loss: 0.2868
Epoch 29/80
102/102 - 0s - 4ms/step - loss: 0.1074 - val_loss: 0.2799
Epoch 30/80
102/102 - 0s - 4ms/step - loss: 0.1140 - val_loss: 0.2841
Epoch 31/80
102/102 - 0s - 4ms/step - loss: 0.1046 - val_loss: 0.2785
Epoch 32/80
102/102 - 0s - 4ms/step - loss: 0.1029 - val_loss: 0.2834
Epoch 33/80
102/102 - 0s - 4ms/step - loss: 0.0997 - val_loss: 0.2886
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6953
Per-joint RMSE: 0.9647 0.9646 0.8150 0.3859 0.3355 0.3377
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:40:06.294857: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:40:06.320124: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 07:40:07.190888: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:07.195509: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:07.196384: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:07.198225: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:07.199020: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:07.199767: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:07.280524: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:07.281525: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:07.282270: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:07.282999: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:40:07.586128: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.115545e-01  RMSE=7.152304e-01
  per-joint RMSE: 0.9738 1.0660 0.7841 0.3791 0.3323 0.3399
Residual LSTM:  MSE=4.834746e-01      RMSE=6.953234e-01
  per-joint RMSE: 0.9647 0.9646 0.8150 0.3859 0.3355 0.3377
Combined torque MSE=4.834746e-01     RMSE=6.953234e-01
  per-joint RMSE: 0.9647 0.9646 0.8150 0.3859 0.3355 0.3377
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s0_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300.npz --H 50 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300.json
H=50, n_dof=6, feature_dim=18
X_train: (32332, 50, 18)  Y_train: (32332, 6)
X_test : (19263, 50, 18)  Y_test : (19263, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:40:09.980959: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:40:10.004870: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (32332, 50, 18), Y_train = (32332, 6)
  X_test  = (19263, 50, 18),  Y_test  = (19263, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:40:11.200851: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:11.206082: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:11.207063: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:11.208972: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:11.209958: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:11.210823: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:11.298985: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:11.299874: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:11.300853: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:11.301632: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:40:12.313465: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
102/102 - 2s - 17ms/step - loss: 0.3261 - val_loss: 0.3022
Epoch 2/80
102/102 - 0s - 4ms/step - loss: 0.1984 - val_loss: 0.2728
Epoch 3/80
102/102 - 0s - 4ms/step - loss: 0.1683 - val_loss: 0.2662
Epoch 4/80
102/102 - 0s - 4ms/step - loss: 0.1527 - val_loss: 0.2542
Epoch 5/80
102/102 - 0s - 4ms/step - loss: 0.1417 - val_loss: 0.2501
Epoch 6/80
102/102 - 0s - 4ms/step - loss: 0.1333 - val_loss: 0.2470
Epoch 7/80
102/102 - 0s - 4ms/step - loss: 0.1298 - val_loss: 0.2365
Epoch 8/80
102/102 - 0s - 4ms/step - loss: 0.1227 - val_loss: 0.2329
Epoch 9/80
102/102 - 0s - 4ms/step - loss: 0.1194 - val_loss: 0.2597
Epoch 10/80
102/102 - 0s - 4ms/step - loss: 0.1180 - val_loss: 0.2380
Epoch 11/80
102/102 - 0s - 5ms/step - loss: 0.1183 - val_loss: 0.2277
Epoch 12/80
102/102 - 0s - 4ms/step - loss: 0.1050 - val_loss: 0.2247
Epoch 13/80
102/102 - 0s - 4ms/step - loss: 0.1032 - val_loss: 0.2396
Epoch 14/80
102/102 - 0s - 4ms/step - loss: 0.1023 - val_loss: 0.2283
Epoch 15/80
102/102 - 0s - 4ms/step - loss: 0.0990 - val_loss: 0.2499
Epoch 16/80
102/102 - 0s - 4ms/step - loss: 0.1017 - val_loss: 0.2244
Epoch 17/80
102/102 - 0s - 4ms/step - loss: 0.1020 - val_loss: 0.2227
Epoch 18/80
102/102 - 0s - 4ms/step - loss: 0.0956 - val_loss: 0.2225
Epoch 19/80
102/102 - 0s - 4ms/step - loss: 0.0941 - val_loss: 0.2163
Epoch 20/80
102/102 - 0s - 4ms/step - loss: 0.0891 - val_loss: 0.2235
Epoch 21/80
102/102 - 0s - 4ms/step - loss: 0.0857 - val_loss: 0.2186
Epoch 22/80
102/102 - 0s - 4ms/step - loss: 0.0854 - val_loss: 0.2250
Epoch 23/80
102/102 - 0s - 4ms/step - loss: 0.0841 - val_loss: 0.2307
Epoch 24/80
102/102 - 0s - 4ms/step - loss: 0.0847 - val_loss: 0.2293
Epoch 25/80
102/102 - 0s - 4ms/step - loss: 0.0812 - val_loss: 0.2342
Epoch 26/80
102/102 - 0s - 4ms/step - loss: 0.0824 - val_loss: 0.2250
Epoch 27/80
102/102 - 0s - 4ms/step - loss: 0.0810 - val_loss: 0.2174
Epoch 28/80
102/102 - 0s - 4ms/step - loss: 0.0788 - val_loss: 0.2185
Epoch 29/80
102/102 - 0s - 4ms/step - loss: 0.0784 - val_loss: 0.2334
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6914
Per-joint RMSE: 0.9559 1.0041 0.7818 0.3609 0.3198 0.3195
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:40:26.178095: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:40:26.203137: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:40:27.051845: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:27.056541: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:27.057421: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:27.059080: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:27.059893: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:27.060718: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:27.146142: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:27.146986: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:27.147737: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:27.148548: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:40:27.458863: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.115545e-01  RMSE=7.152304e-01
  per-joint RMSE: 0.9738 1.0660 0.7841 0.3791 0.3323 0.3399
Residual LSTM:  MSE=4.779672e-01      RMSE=6.913517e-01
  per-joint RMSE: 0.9559 1.0041 0.7818 0.3609 0.3198 0.3195
Combined torque MSE=4.779672e-01     RMSE=6.913517e-01
  per-joint RMSE: 0.9559 1.0041 0.7818 0.3609 0.3198 0.3195
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s0_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300.npz --H 50 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300.json
H=50, n_dof=6, feature_dim=18
X_train: (32332, 50, 18)  Y_train: (32332, 6)
X_test : (19263, 50, 18)  Y_test : (19263, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:40:29.828089: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:40:29.851647: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (32332, 50, 18), Y_train = (32332, 6)
  X_test  = (19263, 50, 18),  Y_test  = (19263, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:40:31.062673: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:31.067885: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:31.068688: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:31.070427: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:31.071352: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:31.072211: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:31.162394: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:31.163376: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:31.164262: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:31.165043: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:40:32.179884: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
102/102 - 2s - 17ms/step - loss: 0.2931 - val_loss: 0.2836
Epoch 2/80
102/102 - 0s - 4ms/step - loss: 0.1742 - val_loss: 0.2270
Epoch 3/80
102/102 - 0s - 4ms/step - loss: 0.1461 - val_loss: 0.2035
Epoch 4/80
102/102 - 0s - 4ms/step - loss: 0.1276 - val_loss: 0.1951
Epoch 5/80
102/102 - 0s - 4ms/step - loss: 0.1163 - val_loss: 0.1843
Epoch 6/80
102/102 - 0s - 4ms/step - loss: 0.1090 - val_loss: 0.1790
Epoch 7/80
102/102 - 0s - 4ms/step - loss: 0.1060 - val_loss: 0.1781
Epoch 8/80
102/102 - 0s - 4ms/step - loss: 0.1030 - val_loss: 0.1741
Epoch 9/80
102/102 - 0s - 4ms/step - loss: 0.0963 - val_loss: 0.1688
Epoch 10/80
102/102 - 0s - 4ms/step - loss: 0.0942 - val_loss: 0.1684
Epoch 11/80
102/102 - 0s - 5ms/step - loss: 0.0910 - val_loss: 0.1704
Epoch 12/80
102/102 - 0s - 4ms/step - loss: 0.0897 - val_loss: 0.1646
Epoch 13/80
102/102 - 0s - 4ms/step - loss: 0.0867 - val_loss: 0.1673
Epoch 14/80
102/102 - 0s - 4ms/step - loss: 0.0848 - val_loss: 0.1669
Epoch 15/80
102/102 - 0s - 4ms/step - loss: 0.0822 - val_loss: 0.1637
Epoch 16/80
102/102 - 0s - 4ms/step - loss: 0.0802 - val_loss: 0.1636
Epoch 17/80
102/102 - 0s - 4ms/step - loss: 0.0790 - val_loss: 0.1649
Epoch 18/80
102/102 - 0s - 4ms/step - loss: 0.0783 - val_loss: 0.1639
Epoch 19/80
102/102 - 0s - 4ms/step - loss: 0.0759 - val_loss: 0.1655
Epoch 20/80
102/102 - 0s - 4ms/step - loss: 0.0753 - val_loss: 0.1613
Epoch 21/80
102/102 - 0s - 4ms/step - loss: 0.0763 - val_loss: 0.1669
Epoch 22/80
102/102 - 0s - 4ms/step - loss: 0.0777 - val_loss: 0.1699
Epoch 23/80
102/102 - 0s - 4ms/step - loss: 0.0733 - val_loss: 0.1640
Epoch 24/80
102/102 - 0s - 4ms/step - loss: 0.0714 - val_loss: 0.1650
Epoch 25/80
102/102 - 0s - 4ms/step - loss: 0.0703 - val_loss: 0.1652
Epoch 26/80
102/102 - 0s - 4ms/step - loss: 0.0701 - val_loss: 0.1647
Epoch 27/80
102/102 - 0s - 4ms/step - loss: 0.0694 - val_loss: 0.1675
Epoch 28/80
102/102 - 0s - 4ms/step - loss: 0.0682 - val_loss: 0.1669
Epoch 29/80
102/102 - 0s - 4ms/step - loss: 0.0681 - val_loss: 0.1646
Epoch 30/80
102/102 - 0s - 4ms/step - loss: 0.0676 - val_loss: 0.1675
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6296
Per-joint RMSE: 0.7847 0.9904 0.7174 0.3381 0.2843 0.2690
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:40:46.534647: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:40:46.560017: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:40:47.407970: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:47.412517: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:47.413391: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:47.414990: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:47.415774: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:47.416501: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:47.498882: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:47.499801: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:47.500541: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:40:47.501274: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8959 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:40:47.812308: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=5.115545e-01  RMSE=7.152304e-01
  per-joint RMSE: 0.9738 1.0660 0.7841 0.3791 0.3323 0.3399
Residual LSTM:  MSE=3.964495e-01      RMSE=6.296424e-01
  per-joint RMSE: 0.7847 0.9904 0.7174 0.3381 0.2843 0.2690
Combined torque MSE=3.964495e-01     RMSE=6.296424e-01
  per-joint RMSE: 0.7847 0.9904 0.7174 0.3381 0.2843 0.2690
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s0_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

