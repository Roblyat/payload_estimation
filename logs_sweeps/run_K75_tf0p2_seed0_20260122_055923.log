################################################################################################################
### RUN: K=75 test_fraction=0.2 seed=0                                                                       ###
### npz_in=/workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed0_dataset.npz ###
################################################################################################################

#####################
### 1) PREPROCESS ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_delan_dataset.py --qdd True --col_format wide --trajectory_amount 75 --test_fraction 0.2 --seed 0 --raw_csv /workspace/shared/data/raw/delan_UR3_Load0_combined_26.csv --out_npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed0_dataset.npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Saved: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed0_dataset.npz
Trajectories: train=60 test=15
Exists: True

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=0                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz                                 ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed0_dataset.npz -t structured -s 0 -r 0 --hp_preset fast_debug --epochs 250 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 250, 'lagrangian_type': <function structured_lagrangian_fn at 0x70e2a01641f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed0_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed0_dataset.npz
   dt ≈ 0.022064047964597475
  dof = 6
  Train trajectories = 60
  Test trajectories  = 15
  Train samples = 31587
  Test samples  = 10519
################################################

2026-01-22 06:04:09.811618: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250 | type=structured | dof=6
################################################
2026-01-22 06:04:12.963513: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:04:12.963549: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:04:12.963555: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:04:12.963585: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:04:12.963590: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:04:12.963605: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:04:12.963641: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:04:12.963646: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:04:12.963664: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:04:12.963670: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.0s, Loss=1.64e+01, Inv=1.64e+01, For=2.12e+02, Power=2.28e+00
  [eval] test_mse=1.582e+00  (n=10519)
Epoch 00050: Time=  10.2s, Loss=2.49e+00, Inv=2.49e+00, For=8.63e+01, Power=6.78e-01
Epoch 00100: Time=  14.1s, Loss=2.29e+00, Inv=2.29e+00, For=9.83e+01, Power=5.72e-01
Epoch 00150: Time=  18.1s, Loss=2.19e+00, Inv=2.19e+00, For=1.15e+02, Power=5.22e-01
Epoch 00200: Time=  22.1s, Loss=2.13e+00, Inv=2.13e+00, For=1.35e+02, Power=4.97e-01
  [eval] test_mse=2.007e+00  (n=10519)
Epoch 00250: Time=  26.3s, Loss=2.10e+00, Inv=2.10e+00, For=1.52e+02, Power=4.87e-01
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250
Torque MSE  = 4.052e-01
Torque RMSE = 6.366e-01
Per-joint MSE : 7.188e-01 9.291e-01 3.868e-01 1.525e-01 1.210e-01 1.231e-01
Per-joint RMSE: 8.478e-01 9.639e-01 6.219e-01 3.906e-01 3.478e-01 3.508e-01
Comp Time per Sample = 3.061e-08s / 32664962.8Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed0_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed0_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax
Detected n_dof=6 (seed=0)
2026-01-22 06:04:41.334083: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 60 trajectories
2026-01-22 06:04:42.675022: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:04:42.675036: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:04:44.218990: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:04:45.448120: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:04:45.448132: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/60
  done 50/60
  done 60/60

Exporting split=test: 15 trajectories
2026-01-22 06:04:48.220257: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 15/15

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz --H 25 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.json
H=25, n_dof=6, feature_dim=24
X_train: (30756, 25, 24)  Y_train: (30756, 6)
X_test : (10306, 25, 24)  Y_test : (10306, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:04:50.386008: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:04:50.409560: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (30756, 25, 24), Y_train = (30756, 6)
  X_test  = (10306, 25, 24),  Y_test  = (10306, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:04:51.482427: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:04:51.487170: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:04:51.488090: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:04:51.489789: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:04:51.490610: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:04:51.491491: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:04:51.575249: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:04:51.576142: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:04:51.576932: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:04:51.577716: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:04:52.572771: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
97/97 - 2s - 17ms/step - loss: 0.2677 - val_loss: 1.1741
Epoch 2/60
97/97 - 0s - 3ms/step - loss: 0.1333 - val_loss: 1.1331
Epoch 3/60
97/97 - 0s - 3ms/step - loss: 0.1160 - val_loss: 1.1287
Epoch 4/60
97/97 - 0s - 3ms/step - loss: 0.1076 - val_loss: 1.1016
Epoch 5/60
97/97 - 0s - 3ms/step - loss: 0.1011 - val_loss: 1.0783
Epoch 6/60
97/97 - 0s - 3ms/step - loss: 0.0965 - val_loss: 1.0688
Epoch 7/60
97/97 - 0s - 3ms/step - loss: 0.0936 - val_loss: 1.0501
Epoch 8/60
97/97 - 0s - 3ms/step - loss: 0.0914 - val_loss: 1.0296
Epoch 9/60
97/97 - 0s - 3ms/step - loss: 0.0887 - val_loss: 1.0160
Epoch 10/60
97/97 - 0s - 3ms/step - loss: 0.0873 - val_loss: 0.9985
Epoch 11/60
97/97 - 0s - 3ms/step - loss: 0.0841 - val_loss: 0.9922
Epoch 12/60
97/97 - 0s - 3ms/step - loss: 0.0837 - val_loss: 0.9833
Epoch 13/60
97/97 - 0s - 3ms/step - loss: 0.0825 - val_loss: 0.9802
Epoch 14/60
97/97 - 0s - 3ms/step - loss: 0.0806 - val_loss: 0.9639
Epoch 15/60
97/97 - 0s - 3ms/step - loss: 0.0801 - val_loss: 0.9627
Epoch 16/60
97/97 - 0s - 3ms/step - loss: 0.0790 - val_loss: 0.9443
Epoch 17/60
97/97 - 0s - 3ms/step - loss: 0.0788 - val_loss: 0.9395
Epoch 18/60
97/97 - 0s - 3ms/step - loss: 0.0770 - val_loss: 0.9306
Epoch 19/60
97/97 - 0s - 3ms/step - loss: 0.0769 - val_loss: 0.9273
Epoch 20/60
97/97 - 0s - 3ms/step - loss: 0.0757 - val_loss: 0.9136
Epoch 21/60
97/97 - 0s - 3ms/step - loss: 0.0760 - val_loss: 0.9065
Epoch 22/60
97/97 - 0s - 3ms/step - loss: 0.0749 - val_loss: 0.9096
Epoch 23/60
97/97 - 0s - 3ms/step - loss: 0.0739 - val_loss: 0.9131
Epoch 24/60
97/97 - 0s - 3ms/step - loss: 0.0734 - val_loss: 0.8881
Epoch 25/60
97/97 - 0s - 3ms/step - loss: 0.0728 - val_loss: 0.9011
Epoch 26/60
97/97 - 0s - 3ms/step - loss: 0.0723 - val_loss: 0.8732
Epoch 27/60
97/97 - 0s - 3ms/step - loss: 0.0722 - val_loss: 0.8719
Epoch 28/60
97/97 - 0s - 3ms/step - loss: 0.0716 - val_loss: 0.8689
Epoch 29/60
97/97 - 0s - 3ms/step - loss: 0.0709 - val_loss: 0.8815
Epoch 30/60
97/97 - 0s - 3ms/step - loss: 0.0702 - val_loss: 0.8756
Epoch 31/60
97/97 - 0s - 3ms/step - loss: 0.0702 - val_loss: 0.8487
Epoch 32/60
97/97 - 0s - 3ms/step - loss: 0.0695 - val_loss: 0.8575
Epoch 33/60
97/97 - 0s - 3ms/step - loss: 0.0697 - val_loss: 0.8450
Epoch 34/60
97/97 - 0s - 3ms/step - loss: 0.0694 - val_loss: 0.8483
Epoch 35/60
97/97 - 0s - 3ms/step - loss: 0.0684 - val_loss: 0.8600
Epoch 36/60
97/97 - 0s - 3ms/step - loss: 0.0680 - val_loss: 0.8532
Epoch 37/60
97/97 - 0s - 3ms/step - loss: 0.0678 - val_loss: 0.8428
Epoch 38/60
97/97 - 0s - 3ms/step - loss: 0.0676 - val_loss: 0.8485
Epoch 39/60
97/97 - 0s - 3ms/step - loss: 0.0673 - val_loss: 0.8539
Epoch 40/60
97/97 - 0s - 3ms/step - loss: 0.0671 - val_loss: 0.8589
Epoch 41/60
97/97 - 0s - 3ms/step - loss: 0.0660 - val_loss: 0.8534
Epoch 42/60
97/97 - 0s - 3ms/step - loss: 0.0661 - val_loss: 0.8473
Epoch 43/60
97/97 - 0s - 3ms/step - loss: 0.0659 - val_loss: 0.8508
Epoch 44/60
97/97 - 0s - 3ms/step - loss: 0.0655 - val_loss: 0.8660
Epoch 45/60
97/97 - 0s - 3ms/step - loss: 0.0650 - val_loss: 0.8480
Epoch 46/60
97/97 - 0s - 3ms/step - loss: 0.0655 - val_loss: 0.8463
Epoch 47/60
97/97 - 0s - 3ms/step - loss: 0.0644 - val_loss: 0.8499
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5381
Per-joint RMSE: 0.7054 0.8185 0.5394 0.3445 0.2686 0.2969
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:05:06.929034: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:05:06.953298: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:05:07.813555: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:07.818184: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:07.819143: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:07.820774: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:07.821582: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:07.822322: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:07.907432: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:07.908272: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:07.909027: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:07.909755: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:05:08.217295: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.096648e-01  RMSE=6.400506e-01
  per-joint RMSE: 0.8530 0.9697 0.6231 0.3932 0.3502 0.3527
Residual LSTM:  MSE=2.895858e-01      RMSE=5.381317e-01
  per-joint RMSE: 0.7054 0.8185 0.5394 0.3445 0.2686 0.2969
Combined torque MSE=2.895858e-01     RMSE=5.381317e-01
  per-joint RMSE: 0.7054 0.8185 0.5394 0.3445 0.2686 0.2969
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz --H 25 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.json
H=25, n_dof=6, feature_dim=6
X_train: (30756, 25, 6)  Y_train: (30756, 6)
X_test : (10306, 25, 6)  Y_test : (10306, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:05:10.230334: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:05:10.253817: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (30756, 25, 6), Y_train = (30756, 6)
  X_test  = (10306, 25, 6),  Y_test  = (10306, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:05:11.222916: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:11.227769: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:11.228557: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:11.230108: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:11.230896: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:11.231638: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:11.307802: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:11.308636: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:11.309474: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:11.310208: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:05:12.213278: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
97/97 - 2s - 17ms/step - loss: 0.7267 - val_loss: 1.9038
Epoch 2/60
97/97 - 0s - 3ms/step - loss: 0.5261 - val_loss: 1.7518
Epoch 3/60
97/97 - 0s - 3ms/step - loss: 0.4380 - val_loss: 1.7551
Epoch 4/60
97/97 - 0s - 3ms/step - loss: 0.3949 - val_loss: 1.7758
Epoch 5/60
97/97 - 0s - 3ms/step - loss: 0.3548 - val_loss: 1.7947
Epoch 6/60
97/97 - 0s - 3ms/step - loss: 0.3163 - val_loss: 1.8010
Epoch 7/60
97/97 - 0s - 3ms/step - loss: 0.2889 - val_loss: 1.8436
Epoch 8/60
97/97 - 0s - 3ms/step - loss: 0.2616 - val_loss: 1.7845
Epoch 9/60
97/97 - 0s - 3ms/step - loss: 0.2379 - val_loss: 1.7282
Epoch 10/60
97/97 - 0s - 3ms/step - loss: 0.2245 - val_loss: 1.7168
Epoch 11/60
97/97 - 0s - 3ms/step - loss: 0.2146 - val_loss: 1.7008
Epoch 12/60
97/97 - 0s - 3ms/step - loss: 0.2048 - val_loss: 1.6905
Epoch 13/60
97/97 - 0s - 3ms/step - loss: 0.2012 - val_loss: 1.6987
Epoch 14/60
97/97 - 0s - 3ms/step - loss: 0.1969 - val_loss: 1.6767
Epoch 15/60
97/97 - 0s - 3ms/step - loss: 0.1778 - val_loss: 1.6660
Epoch 16/60
97/97 - 0s - 3ms/step - loss: 0.1654 - val_loss: 1.6815
Epoch 17/60
97/97 - 0s - 3ms/step - loss: 0.1666 - val_loss: 1.6883
Epoch 18/60
97/97 - 0s - 3ms/step - loss: 0.1520 - val_loss: 1.7009
Epoch 19/60
97/97 - 0s - 3ms/step - loss: 0.1460 - val_loss: 1.7149
Epoch 20/60
97/97 - 0s - 3ms/step - loss: 0.1602 - val_loss: 1.6519
Epoch 21/60
97/97 - 0s - 3ms/step - loss: 0.1389 - val_loss: 1.6892
Epoch 22/60
97/97 - 0s - 3ms/step - loss: 0.1404 - val_loss: 1.6711
Epoch 23/60
97/97 - 0s - 3ms/step - loss: 0.1408 - val_loss: 1.6788
Epoch 24/60
97/97 - 0s - 3ms/step - loss: 0.1353 - val_loss: 1.6923
Epoch 25/60
97/97 - 0s - 3ms/step - loss: 0.1238 - val_loss: 1.6746
Epoch 26/60
97/97 - 0s - 3ms/step - loss: 0.1292 - val_loss: 1.7049
Epoch 27/60
97/97 - 0s - 3ms/step - loss: 0.1309 - val_loss: 1.6277
Epoch 28/60
97/97 - 0s - 3ms/step - loss: 0.1291 - val_loss: 1.6542
Epoch 29/60
97/97 - 0s - 3ms/step - loss: 0.1193 - val_loss: 1.6310
Epoch 30/60
97/97 - 0s - 3ms/step - loss: 0.1133 - val_loss: 1.6321
Epoch 31/60
97/97 - 0s - 3ms/step - loss: 0.1074 - val_loss: 1.6342
Epoch 32/60
97/97 - 0s - 3ms/step - loss: 0.1082 - val_loss: 1.6184
Epoch 33/60
97/97 - 0s - 3ms/step - loss: 0.1053 - val_loss: 1.6463
Epoch 34/60
97/97 - 0s - 3ms/step - loss: 0.1208 - val_loss: 1.6248
Epoch 35/60
97/97 - 0s - 3ms/step - loss: 0.1044 - val_loss: 1.6402
Epoch 36/60
97/97 - 0s - 3ms/step - loss: 0.1001 - val_loss: 1.6352
Epoch 37/60
97/97 - 0s - 3ms/step - loss: 0.0936 - val_loss: 1.6235
Epoch 38/60
97/97 - 0s - 3ms/step - loss: 0.1059 - val_loss: 1.6564
Epoch 39/60
97/97 - 0s - 3ms/step - loss: 0.1047 - val_loss: 1.6855
Epoch 40/60
97/97 - 0s - 3ms/step - loss: 0.0964 - val_loss: 1.6452
Epoch 41/60
97/97 - 0s - 3ms/step - loss: 0.0915 - val_loss: 1.6402
Epoch 42/60
97/97 - 0s - 3ms/step - loss: 0.0969 - val_loss: 1.6290
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6185
Per-joint RMSE: 0.8376 0.9153 0.5817 0.4046 0.3544 0.3585
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:05:24.761796: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:05:24.785974: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:05:25.639101: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:25.643608: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:25.644403: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:25.646079: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:25.646864: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:25.647605: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:25.727914: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:25.728844: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:25.729846: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:25.730817: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:05:26.032266: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.096648e-01  RMSE=6.400506e-01
  per-joint RMSE: 0.8530 0.9697 0.6231 0.3932 0.3502 0.3527
Residual LSTM:  MSE=3.825858e-01      RMSE=6.185352e-01
  per-joint RMSE: 0.8376 0.9153 0.5817 0.4046 0.3544 0.3585
Combined torque MSE=3.825858e-01     RMSE=6.185352e-01
  per-joint RMSE: 0.8376 0.9153 0.5817 0.4046 0.3544 0.3585
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz --H 25 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (30756, 25, 18)  Y_train: (30756, 6)
X_test : (10306, 25, 18)  Y_test : (10306, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:05:28.083194: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:05:28.107377: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (30756, 25, 18), Y_train = (30756, 6)
  X_test  = (10306, 25, 18),  Y_test  = (10306, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:05:29.143468: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:29.148269: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:29.149212: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:29.150796: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:29.151587: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:29.152396: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:29.227753: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:29.228596: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:29.229324: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:29.230048: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:05:30.161915: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
97/97 - 2s - 17ms/step - loss: 0.2938 - val_loss: 1.1874
Epoch 2/60
97/97 - 0s - 3ms/step - loss: 0.1504 - val_loss: 1.1400
Epoch 3/60
97/97 - 0s - 3ms/step - loss: 0.1276 - val_loss: 1.1279
Epoch 4/60
97/97 - 0s - 3ms/step - loss: 0.1158 - val_loss: 1.1128
Epoch 5/60
97/97 - 0s - 3ms/step - loss: 0.1090 - val_loss: 1.0961
Epoch 6/60
97/97 - 0s - 3ms/step - loss: 0.1024 - val_loss: 1.0717
Epoch 7/60
97/97 - 0s - 3ms/step - loss: 0.0996 - val_loss: 1.0632
Epoch 8/60
97/97 - 0s - 3ms/step - loss: 0.0973 - val_loss: 1.0510
Epoch 9/60
97/97 - 0s - 3ms/step - loss: 0.0934 - val_loss: 1.0460
Epoch 10/60
97/97 - 0s - 3ms/step - loss: 0.0916 - val_loss: 1.0349
Epoch 11/60
97/97 - 0s - 3ms/step - loss: 0.0892 - val_loss: 1.0198
Epoch 12/60
97/97 - 0s - 3ms/step - loss: 0.0862 - val_loss: 1.0115
Epoch 13/60
97/97 - 0s - 3ms/step - loss: 0.0862 - val_loss: 1.0190
Epoch 14/60
97/97 - 0s - 3ms/step - loss: 0.0845 - val_loss: 0.9990
Epoch 15/60
97/97 - 0s - 3ms/step - loss: 0.0849 - val_loss: 0.9881
Epoch 16/60
97/97 - 0s - 3ms/step - loss: 0.0821 - val_loss: 0.9869
Epoch 17/60
97/97 - 0s - 3ms/step - loss: 0.0813 - val_loss: 0.9879
Epoch 18/60
97/97 - 0s - 3ms/step - loss: 0.0803 - val_loss: 0.9816
Epoch 19/60
97/97 - 0s - 3ms/step - loss: 0.0795 - val_loss: 0.9770
Epoch 20/60
97/97 - 0s - 3ms/step - loss: 0.0797 - val_loss: 0.9662
Epoch 21/60
97/97 - 0s - 3ms/step - loss: 0.0788 - val_loss: 0.9644
Epoch 22/60
97/97 - 0s - 3ms/step - loss: 0.0776 - val_loss: 0.9768
Epoch 23/60
97/97 - 0s - 3ms/step - loss: 0.0767 - val_loss: 0.9561
Epoch 24/60
97/97 - 0s - 3ms/step - loss: 0.0762 - val_loss: 0.9516
Epoch 25/60
97/97 - 0s - 3ms/step - loss: 0.0760 - val_loss: 0.9517
Epoch 26/60
97/97 - 0s - 3ms/step - loss: 0.0752 - val_loss: 0.9477
Epoch 27/60
97/97 - 0s - 3ms/step - loss: 0.0741 - val_loss: 0.9540
Epoch 28/60
97/97 - 0s - 3ms/step - loss: 0.0746 - val_loss: 0.9429
Epoch 29/60
97/97 - 0s - 3ms/step - loss: 0.0733 - val_loss: 0.9517
Epoch 30/60
97/97 - 0s - 3ms/step - loss: 0.0735 - val_loss: 0.9506
Epoch 31/60
97/97 - 0s - 3ms/step - loss: 0.0731 - val_loss: 0.9466
Epoch 32/60
97/97 - 0s - 3ms/step - loss: 0.0726 - val_loss: 0.9452
Epoch 33/60
97/97 - 0s - 3ms/step - loss: 0.0731 - val_loss: 0.9468
Epoch 34/60
97/97 - 0s - 3ms/step - loss: 0.0721 - val_loss: 0.9416
Epoch 35/60
97/97 - 0s - 3ms/step - loss: 0.0712 - val_loss: 0.9530
Epoch 36/60
97/97 - 0s - 3ms/step - loss: 0.0710 - val_loss: 0.9408
Epoch 37/60
97/97 - 0s - 3ms/step - loss: 0.0706 - val_loss: 0.9303
Epoch 38/60
97/97 - 0s - 3ms/step - loss: 0.0704 - val_loss: 0.9260
Epoch 39/60
97/97 - 0s - 3ms/step - loss: 0.0696 - val_loss: 0.9399
Epoch 40/60
97/97 - 0s - 3ms/step - loss: 0.0700 - val_loss: 0.9467
Epoch 41/60
97/97 - 0s - 3ms/step - loss: 0.0687 - val_loss: 0.9390
Epoch 42/60
97/97 - 0s - 3ms/step - loss: 0.0688 - val_loss: 0.9485
Epoch 43/60
97/97 - 0s - 3ms/step - loss: 0.0682 - val_loss: 0.9384
Epoch 44/60
97/97 - 0s - 3ms/step - loss: 0.0687 - val_loss: 0.9339
Epoch 45/60
97/97 - 0s - 3ms/step - loss: 0.0683 - val_loss: 0.9357
Epoch 46/60
97/97 - 0s - 3ms/step - loss: 0.0682 - val_loss: 0.9323
Epoch 47/60
97/97 - 0s - 3ms/step - loss: 0.0676 - val_loss: 0.9256
Epoch 48/60
97/97 - 0s - 3ms/step - loss: 0.0671 - val_loss: 0.9178
Epoch 49/60
97/97 - 0s - 3ms/step - loss: 0.0675 - val_loss: 0.9217
Epoch 50/60
97/97 - 0s - 3ms/step - loss: 0.0670 - val_loss: 0.9099
Epoch 51/60
97/97 - 0s - 3ms/step - loss: 0.0670 - val_loss: 0.9089
Epoch 52/60
97/97 - 0s - 3ms/step - loss: 0.0664 - val_loss: 0.8892
Epoch 53/60
97/97 - 0s - 3ms/step - loss: 0.0663 - val_loss: 0.9066
Epoch 54/60
97/97 - 0s - 3ms/step - loss: 0.0656 - val_loss: 0.9119
Epoch 55/60
97/97 - 0s - 3ms/step - loss: 0.0665 - val_loss: 0.9101
Epoch 56/60
97/97 - 0s - 3ms/step - loss: 0.0658 - val_loss: 0.9150
Epoch 57/60
97/97 - 0s - 3ms/step - loss: 0.0654 - val_loss: 0.8932
Epoch 58/60
97/97 - 0s - 3ms/step - loss: 0.0650 - val_loss: 0.8904
Epoch 59/60
97/97 - 0s - 3ms/step - loss: 0.0652 - val_loss: 0.9115
Epoch 60/60
97/97 - 0s - 3ms/step - loss: 0.0646 - val_loss: 0.9275
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5913
Per-joint RMSE: 0.8264 0.8489 0.5937 0.3647 0.3139 0.3322
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:05:47.652184: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:05:47.676266: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:05:48.527716: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:48.532591: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:48.533388: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:48.535101: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:48.535893: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:48.536641: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:48.613479: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:48.614472: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:48.615221: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:48.615952: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:05:48.924503: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.096648e-01  RMSE=6.400506e-01
  per-joint RMSE: 0.8530 0.9697 0.6231 0.3932 0.3502 0.3527
Residual LSTM:  MSE=3.496751e-01      RMSE=5.913333e-01
  per-joint RMSE: 0.8264 0.8489 0.5937 0.3647 0.3139 0.3322
Combined torque MSE=3.496751e-01     RMSE=5.913333e-01
  per-joint RMSE: 0.8264 0.8489 0.5937 0.3647 0.3139 0.3322
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz --H 25 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (30756, 25, 18)  Y_train: (30756, 6)
X_test : (10306, 25, 18)  Y_test : (10306, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:05:50.985516: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:05:51.009847: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (30756, 25, 18), Y_train = (30756, 6)
  X_test  = (10306, 25, 18),  Y_test  = (10306, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:05:52.059512: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:52.064847: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:52.065640: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:52.067231: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:52.068021: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:52.068762: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:52.147595: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:52.148434: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:52.149184: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:05:52.149916: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:05:53.121752: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
97/97 - 2s - 17ms/step - loss: 0.2670 - val_loss: 1.1657
Epoch 2/60
97/97 - 0s - 3ms/step - loss: 0.1324 - val_loss: 1.1162
Epoch 3/60
97/97 - 0s - 3ms/step - loss: 0.1162 - val_loss: 1.0826
Epoch 4/60
97/97 - 0s - 3ms/step - loss: 0.1071 - val_loss: 1.0606
Epoch 5/60
97/97 - 0s - 3ms/step - loss: 0.1009 - val_loss: 1.0526
Epoch 6/60
97/97 - 0s - 3ms/step - loss: 0.0961 - val_loss: 1.0319
Epoch 7/60
97/97 - 0s - 3ms/step - loss: 0.0934 - val_loss: 1.0197
Epoch 8/60
97/97 - 0s - 3ms/step - loss: 0.0900 - val_loss: 1.0124
Epoch 9/60
97/97 - 0s - 3ms/step - loss: 0.0883 - val_loss: 1.0007
Epoch 10/60
97/97 - 0s - 3ms/step - loss: 0.0859 - val_loss: 0.9924
Epoch 11/60
97/97 - 0s - 3ms/step - loss: 0.0841 - val_loss: 0.9801
Epoch 12/60
97/97 - 0s - 3ms/step - loss: 0.0832 - val_loss: 0.9748
Epoch 13/60
97/97 - 0s - 3ms/step - loss: 0.0813 - val_loss: 0.9538
Epoch 14/60
97/97 - 0s - 3ms/step - loss: 0.0806 - val_loss: 0.9475
Epoch 15/60
97/97 - 0s - 3ms/step - loss: 0.0789 - val_loss: 0.9466
Epoch 16/60
97/97 - 0s - 3ms/step - loss: 0.0787 - val_loss: 0.9349
Epoch 17/60
97/97 - 0s - 3ms/step - loss: 0.0775 - val_loss: 0.9282
Epoch 18/60
97/97 - 0s - 3ms/step - loss: 0.0767 - val_loss: 0.9136
Epoch 19/60
97/97 - 0s - 3ms/step - loss: 0.0756 - val_loss: 0.9072
Epoch 20/60
97/97 - 0s - 3ms/step - loss: 0.0750 - val_loss: 0.9045
Epoch 21/60
97/97 - 0s - 3ms/step - loss: 0.0746 - val_loss: 0.8993
Epoch 22/60
97/97 - 0s - 3ms/step - loss: 0.0737 - val_loss: 0.8893
Epoch 23/60
97/97 - 0s - 3ms/step - loss: 0.0731 - val_loss: 0.8894
Epoch 24/60
97/97 - 0s - 3ms/step - loss: 0.0727 - val_loss: 0.8894
Epoch 25/60
97/97 - 0s - 3ms/step - loss: 0.0726 - val_loss: 0.8845
Epoch 26/60
97/97 - 0s - 3ms/step - loss: 0.0721 - val_loss: 0.8711
Epoch 27/60
97/97 - 0s - 3ms/step - loss: 0.0720 - val_loss: 0.8727
Epoch 28/60
97/97 - 0s - 3ms/step - loss: 0.0711 - val_loss: 0.8647
Epoch 29/60
97/97 - 0s - 3ms/step - loss: 0.0709 - val_loss: 0.8721
Epoch 30/60
97/97 - 0s - 3ms/step - loss: 0.0701 - val_loss: 0.8620
Epoch 31/60
97/97 - 0s - 3ms/step - loss: 0.0697 - val_loss: 0.8573
Epoch 32/60
97/97 - 0s - 3ms/step - loss: 0.0687 - val_loss: 0.8511
Epoch 33/60
97/97 - 0s - 3ms/step - loss: 0.0692 - val_loss: 0.8445
Epoch 34/60
97/97 - 0s - 3ms/step - loss: 0.0690 - val_loss: 0.8433
Epoch 35/60
97/97 - 0s - 3ms/step - loss: 0.0680 - val_loss: 0.8455
Epoch 36/60
97/97 - 0s - 3ms/step - loss: 0.0681 - val_loss: 0.8395
Epoch 37/60
97/97 - 0s - 3ms/step - loss: 0.0672 - val_loss: 0.8502
Epoch 38/60
97/97 - 0s - 3ms/step - loss: 0.0667 - val_loss: 0.8339
Epoch 39/60
97/97 - 0s - 3ms/step - loss: 0.0663 - val_loss: 0.8385
Epoch 40/60
97/97 - 0s - 3ms/step - loss: 0.0672 - val_loss: 0.8258
Epoch 41/60
97/97 - 0s - 3ms/step - loss: 0.0663 - val_loss: 0.8318
Epoch 42/60
97/97 - 0s - 3ms/step - loss: 0.0661 - val_loss: 0.8344
Epoch 43/60
97/97 - 0s - 3ms/step - loss: 0.0660 - val_loss: 0.8119
Epoch 44/60
97/97 - 0s - 3ms/step - loss: 0.0654 - val_loss: 0.8156
Epoch 45/60
97/97 - 0s - 3ms/step - loss: 0.0648 - val_loss: 0.8206
Epoch 46/60
97/97 - 0s - 3ms/step - loss: 0.0645 - val_loss: 0.8302
Epoch 47/60
97/97 - 0s - 3ms/step - loss: 0.0659 - val_loss: 0.8180
Epoch 48/60
97/97 - 0s - 3ms/step - loss: 0.0648 - val_loss: 0.8186
Epoch 49/60
97/97 - 0s - 3ms/step - loss: 0.0639 - val_loss: 0.8104
Epoch 50/60
97/97 - 0s - 3ms/step - loss: 0.0637 - val_loss: 0.8055
Epoch 51/60
97/97 - 0s - 3ms/step - loss: 0.0633 - val_loss: 0.8106
Epoch 52/60
97/97 - 0s - 3ms/step - loss: 0.0631 - val_loss: 0.8111
Epoch 53/60
97/97 - 0s - 3ms/step - loss: 0.0632 - val_loss: 0.8084
Epoch 54/60
97/97 - 0s - 3ms/step - loss: 0.0626 - val_loss: 0.8010
Epoch 55/60
97/97 - 0s - 3ms/step - loss: 0.0626 - val_loss: 0.7981
Epoch 56/60
97/97 - 0s - 3ms/step - loss: 0.0620 - val_loss: 0.8107
Epoch 57/60
97/97 - 0s - 3ms/step - loss: 0.0615 - val_loss: 0.7968
Epoch 58/60
97/97 - 0s - 3ms/step - loss: 0.0616 - val_loss: 0.8006
Epoch 59/60
97/97 - 0s - 3ms/step - loss: 0.0617 - val_loss: 0.8062
Epoch 60/60
97/97 - 0s - 3ms/step - loss: 0.0615 - val_loss: 0.8098
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5456
Per-joint RMSE: 0.7144 0.8450 0.5289 0.3439 0.2789 0.2927
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:06:11.042754: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:06:11.067311: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:06:11.918642: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:11.923503: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:11.924293: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:11.925967: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:11.926838: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:11.927580: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:12.010000: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:12.010909: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:12.011650: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:12.012372: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:06:12.316345: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.096648e-01  RMSE=6.400506e-01
  per-joint RMSE: 0.8530 0.9697 0.6231 0.3932 0.3502 0.3527
Residual LSTM:  MSE=2.976446e-01      RMSE=5.455682e-01
  per-joint RMSE: 0.7144 0.8450 0.5289 0.3439 0.2789 0.2927
Combined torque MSE=2.976446e-01     RMSE=5.455682e-01
  per-joint RMSE: 0.7144 0.8450 0.5289 0.3439 0.2789 0.2927
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz --H 50 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.json
H=50, n_dof=6, feature_dim=24
X_train: (29981, 50, 24)  Y_train: (29981, 6)
X_test : (10106, 50, 24)  Y_test : (10106, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:06:14.432028: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:06:14.456601: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (29981, 50, 24), Y_train = (29981, 6)
  X_test  = (10106, 50, 24),  Y_test  = (10106, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:06:15.687647: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:15.692657: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:15.693568: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:15.695533: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:15.696553: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:15.697468: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:15.791291: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:15.792191: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:15.793083: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:15.793954: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:06:16.807951: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
94/94 - 2s - 19ms/step - loss: 0.2634 - val_loss: 0.6095
Epoch 2/60
94/94 - 0s - 4ms/step - loss: 0.1361 - val_loss: 0.5898
Epoch 3/60
94/94 - 0s - 4ms/step - loss: 0.1197 - val_loss: 0.5817
Epoch 4/60
94/94 - 0s - 4ms/step - loss: 0.1097 - val_loss: 0.5780
Epoch 5/60
94/94 - 0s - 4ms/step - loss: 0.1026 - val_loss: 0.5658
Epoch 6/60
94/94 - 0s - 4ms/step - loss: 0.0979 - val_loss: 0.5602
Epoch 7/60
94/94 - 0s - 4ms/step - loss: 0.0953 - val_loss: 0.5587
Epoch 8/60
94/94 - 0s - 4ms/step - loss: 0.0927 - val_loss: 0.5562
Epoch 9/60
94/94 - 0s - 4ms/step - loss: 0.0896 - val_loss: 0.5618
Epoch 10/60
94/94 - 0s - 4ms/step - loss: 0.0878 - val_loss: 0.5585
Epoch 11/60
94/94 - 0s - 4ms/step - loss: 0.0858 - val_loss: 0.5622
Epoch 12/60
94/94 - 0s - 5ms/step - loss: 0.0848 - val_loss: 0.5700
Epoch 13/60
94/94 - 0s - 4ms/step - loss: 0.0834 - val_loss: 0.5602
Epoch 14/60
94/94 - 0s - 4ms/step - loss: 0.0823 - val_loss: 0.5633
Epoch 15/60
94/94 - 0s - 4ms/step - loss: 0.0810 - val_loss: 0.5711
Epoch 16/60
94/94 - 0s - 4ms/step - loss: 0.0799 - val_loss: 0.5667
Epoch 17/60
94/94 - 0s - 4ms/step - loss: 0.0790 - val_loss: 0.5651
Epoch 18/60
94/94 - 0s - 4ms/step - loss: 0.0793 - val_loss: 0.5695
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5441
Per-joint RMSE: 0.7123 0.8316 0.5477 0.3278 0.2827 0.3007
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:06:25.424937: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:06:25.449602: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:06:26.303005: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:26.308217: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:26.309006: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:26.310777: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:26.311569: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:26.312298: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:26.388106: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:26.388944: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:26.389696: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:26.390432: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:06:26.705425: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.143291e-01  RMSE=6.436840e-01
  per-joint RMSE: 0.8578 0.9763 0.6263 0.3954 0.3517 0.3533
Residual LSTM:  MSE=2.960992e-01      RMSE=5.441499e-01
  per-joint RMSE: 0.7123 0.8316 0.5477 0.3278 0.2827 0.3007
Combined torque MSE=2.960992e-01     RMSE=5.441499e-01
  per-joint RMSE: 0.7123 0.8316 0.5477 0.3278 0.2827 0.3007
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz --H 50 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.json
H=50, n_dof=6, feature_dim=6
X_train: (29981, 50, 6)  Y_train: (29981, 6)
X_test : (10106, 50, 6)  Y_test : (10106, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:06:28.781450: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:06:28.806713: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (29981, 50, 6), Y_train = (29981, 6)
  X_test  = (10106, 50, 6),  Y_test  = (10106, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:06:29.846681: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:29.851357: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:29.852149: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:29.853756: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:29.854549: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:29.855293: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:29.935585: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:29.936505: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:29.937247: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:29.937970: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:06:30.872748: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
94/94 - 2s - 19ms/step - loss: 0.6969 - val_loss: 1.0340
Epoch 2/60
94/94 - 0s - 4ms/step - loss: 0.4462 - val_loss: 1.0807
Epoch 3/60
94/94 - 0s - 4ms/step - loss: 0.3357 - val_loss: 1.1971
Epoch 4/60
94/94 - 0s - 4ms/step - loss: 0.2578 - val_loss: 1.2475
Epoch 5/60
94/94 - 0s - 4ms/step - loss: 0.2084 - val_loss: 1.2175
Epoch 6/60
94/94 - 0s - 4ms/step - loss: 0.1859 - val_loss: 1.2491
Epoch 7/60
94/94 - 0s - 4ms/step - loss: 0.1782 - val_loss: 1.2836
Epoch 8/60
94/94 - 0s - 4ms/step - loss: 0.1682 - val_loss: 1.3124
Epoch 9/60
94/94 - 0s - 4ms/step - loss: 0.1622 - val_loss: 1.1917
Epoch 10/60
94/94 - 0s - 4ms/step - loss: 0.1445 - val_loss: 1.2014
Epoch 11/60
94/94 - 0s - 4ms/step - loss: 0.1314 - val_loss: 1.2250
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6494
Per-joint RMSE: 0.8874 0.9767 0.5911 0.3974 0.3774 0.3736
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:06:36.649271: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:06:36.673900: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:06:37.520857: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:37.525706: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:37.526547: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:37.528248: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:37.529030: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:37.529765: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:37.606049: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:37.606881: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:37.607623: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:37.608351: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:06:37.915599: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.143291e-01  RMSE=6.436840e-01
  per-joint RMSE: 0.8578 0.9763 0.6263 0.3954 0.3517 0.3533
Residual LSTM:  MSE=4.217787e-01      RMSE=6.494449e-01
  per-joint RMSE: 0.8874 0.9767 0.5911 0.3974 0.3774 0.3736
Combined torque MSE=4.217787e-01     RMSE=6.494449e-01
  per-joint RMSE: 0.8874 0.9767 0.5911 0.3974 0.3774 0.3736
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz --H 50 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (29981, 50, 18)  Y_train: (29981, 6)
X_test : (10106, 50, 18)  Y_test : (10106, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:06:40.048522: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:06:40.073898: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (29981, 50, 18), Y_train = (29981, 6)
  X_test  = (10106, 50, 18),  Y_test  = (10106, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:06:41.235109: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:41.240042: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:41.240823: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:41.242513: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:41.243288: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:41.244024: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:41.325432: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:41.326260: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:41.326997: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:41.327727: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:06:42.310319: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
94/94 - 2s - 18ms/step - loss: 0.2863 - val_loss: 0.6017
Epoch 2/60
94/94 - 0s - 4ms/step - loss: 0.1510 - val_loss: 0.6205
Epoch 3/60
94/94 - 0s - 4ms/step - loss: 0.1313 - val_loss: 0.6032
Epoch 4/60
94/94 - 0s - 4ms/step - loss: 0.1204 - val_loss: 0.6063
Epoch 5/60
94/94 - 0s - 4ms/step - loss: 0.1126 - val_loss: 0.5999
Epoch 6/60
94/94 - 0s - 4ms/step - loss: 0.1077 - val_loss: 0.5987
Epoch 7/60
94/94 - 0s - 4ms/step - loss: 0.1028 - val_loss: 0.5899
Epoch 8/60
94/94 - 0s - 4ms/step - loss: 0.0990 - val_loss: 0.5948
Epoch 9/60
94/94 - 0s - 4ms/step - loss: 0.0965 - val_loss: 0.5999
Epoch 10/60
94/94 - 0s - 4ms/step - loss: 0.0937 - val_loss: 0.6047
Epoch 11/60
94/94 - 0s - 4ms/step - loss: 0.0916 - val_loss: 0.6048
Epoch 12/60
94/94 - 0s - 5ms/step - loss: 0.0901 - val_loss: 0.6103
Epoch 13/60
94/94 - 0s - 4ms/step - loss: 0.0886 - val_loss: 0.6154
Epoch 14/60
94/94 - 0s - 4ms/step - loss: 0.0866 - val_loss: 0.6248
Epoch 15/60
94/94 - 0s - 4ms/step - loss: 0.0857 - val_loss: 0.6198
Epoch 16/60
94/94 - 0s - 4ms/step - loss: 0.0840 - val_loss: 0.6252
Epoch 17/60
94/94 - 0s - 4ms/step - loss: 0.0828 - val_loss: 0.6296
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5937
Per-joint RMSE: 0.8285 0.8528 0.5911 0.3713 0.3293 0.3248
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:06:50.513799: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:06:50.538981: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:06:51.408370: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:51.413723: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:51.414525: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:51.416224: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:51.417016: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:51.417751: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:51.497762: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:51.498996: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:51.499788: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:51.500516: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:06:51.814737: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.143291e-01  RMSE=6.436840e-01
  per-joint RMSE: 0.8578 0.9763 0.6263 0.3954 0.3517 0.3533
Residual LSTM:  MSE=3.524625e-01      RMSE=5.936855e-01
  per-joint RMSE: 0.8285 0.8528 0.5911 0.3713 0.3293 0.3248
Combined torque MSE=3.524625e-01     RMSE=5.936855e-01
  per-joint RMSE: 0.8285 0.8528 0.5911 0.3713 0.3293 0.3248
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz --H 50 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (29981, 50, 18)  Y_train: (29981, 6)
X_test : (10106, 50, 18)  Y_test : (10106, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:06:53.951606: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:06:53.976574: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (29981, 50, 18), Y_train = (29981, 6)
  X_test  = (10106, 50, 18),  Y_test  = (10106, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:06:55.136351: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:55.141206: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:55.141991: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:55.143673: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:55.144456: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:55.145191: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:55.229501: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:55.230405: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:55.231206: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:06:55.231997: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:06:56.187630: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
94/94 - 2s - 18ms/step - loss: 0.2685 - val_loss: 0.6354
Epoch 2/60
94/94 - 0s - 4ms/step - loss: 0.1379 - val_loss: 0.6014
Epoch 3/60
94/94 - 0s - 4ms/step - loss: 0.1185 - val_loss: 0.5823
Epoch 4/60
94/94 - 0s - 4ms/step - loss: 0.1089 - val_loss: 0.5820
Epoch 5/60
94/94 - 0s - 4ms/step - loss: 0.1026 - val_loss: 0.5857
Epoch 6/60
94/94 - 0s - 4ms/step - loss: 0.0986 - val_loss: 0.5753
Epoch 7/60
94/94 - 0s - 4ms/step - loss: 0.0955 - val_loss: 0.5871
Epoch 8/60
94/94 - 0s - 4ms/step - loss: 0.0924 - val_loss: 0.5952
Epoch 9/60
94/94 - 0s - 4ms/step - loss: 0.0899 - val_loss: 0.5944
Epoch 10/60
94/94 - 0s - 4ms/step - loss: 0.0876 - val_loss: 0.6006
Epoch 11/60
94/94 - 0s - 4ms/step - loss: 0.0856 - val_loss: 0.6030
Epoch 12/60
94/94 - 0s - 5ms/step - loss: 0.0848 - val_loss: 0.6098
Epoch 13/60
94/94 - 0s - 4ms/step - loss: 0.0830 - val_loss: 0.6063
Epoch 14/60
94/94 - 0s - 4ms/step - loss: 0.0821 - val_loss: 0.6037
Epoch 15/60
94/94 - 0s - 4ms/step - loss: 0.0811 - val_loss: 0.6065
Epoch 16/60
94/94 - 0s - 4ms/step - loss: 0.0800 - val_loss: 0.5989
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5413
Per-joint RMSE: 0.6953 0.8509 0.5341 0.3283 0.2715 0.2892
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:07:04.018817: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:07:04.043136: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:07:04.895507: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:07:04.900497: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:07:04.901300: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:07:04.902958: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:07:04.903746: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:07:04.904485: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:07:04.988356: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:07:04.989348: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:07:04.990095: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:07:04.990819: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:07:05.302384: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.143291e-01  RMSE=6.436840e-01
  per-joint RMSE: 0.8578 0.9763 0.6263 0.3954 0.3517 0.3533
Residual LSTM:  MSE=2.929800e-01      RMSE=5.412762e-01
  per-joint RMSE: 0.6953 0.8509 0.5341 0.3283 0.2715 0.2892
Combined torque MSE=2.929800e-01     RMSE=5.412762e-01
  per-joint RMSE: 0.6953 0.8509 0.5341 0.3283 0.2715 0.2892
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=1                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz                                 ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed0_dataset.npz -t structured -s 1 -r 0 --hp_preset fast_debug --epochs 250 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 250, 'lagrangian_type': <function structured_lagrangian_fn at 0x7e34cfebc1f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed0_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed0_dataset.npz
   dt ≈ 0.022064047964597475
  dof = 6
  Train trajectories = 60
  Test trajectories  = 15
  Train samples = 31587
  Test samples  = 10519
################################################

2026-01-22 06:07:09.760755: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250 | type=structured | dof=6
################################################
2026-01-22 06:07:12.918989: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:07:12.919024: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:07:12.919030: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:07:12.919056: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:07:12.919062: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:07:12.919076: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:07:12.919113: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:07:12.919119: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:07:12.919135: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:07:12.919139: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   4.9s, Loss=1.57e+01, Inv=1.57e+01, For=1.79e+02, Power=1.94e+00
  [eval] test_mse=1.618e+00  (n=10519)
Epoch 00050: Time=  10.6s, Loss=2.50e+00, Inv=2.50e+00, For=9.77e+01, Power=7.09e-01
Epoch 00100: Time=  15.2s, Loss=2.30e+00, Inv=2.30e+00, For=1.32e+02, Power=5.76e-01
Epoch 00150: Time=  19.2s, Loss=2.19e+00, Inv=2.19e+00, For=1.59e+02, Power=5.12e-01
Epoch 00200: Time=  23.8s, Loss=2.14e+00, Inv=2.14e+00, For=1.86e+02, Power=4.88e-01
  [eval] test_mse=2.143e+00  (n=10519)
Epoch 00250: Time=  28.0s, Loss=2.09e+00, Inv=2.09e+00, For=2.04e+02, Power=4.77e-01
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250
Torque MSE  = 4.071e-01
Torque RMSE = 6.380e-01
Per-joint MSE : 8.137e-01 8.193e-01 4.433e-01 1.581e-01 1.041e-01 1.041e-01
Per-joint RMSE: 9.020e-01 9.052e-01 6.658e-01 3.976e-01 3.227e-01 3.227e-01
Comp Time per Sample = 2.482e-08s / 40287554.7Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed0_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed0_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax
Detected n_dof=6 (seed=1)
2026-01-22 06:07:43.051540: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 60 trajectories
2026-01-22 06:07:44.376062: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:07:44.376076: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:07:45.868486: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:07:47.034929: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:07:47.034941: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/60
  done 50/60
  done 60/60

Exporting split=test: 15 trajectories
2026-01-22 06:07:49.882325: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 15/15

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz --H 25 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.json
H=25, n_dof=6, feature_dim=24
X_train: (30756, 25, 24)  Y_train: (30756, 6)
X_test : (10306, 25, 24)  Y_test : (10306, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:07:52.049522: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:07:52.074341: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (30756, 25, 24), Y_train = (30756, 6)
  X_test  = (10306, 25, 24),  Y_test  = (10306, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:07:53.144458: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:07:53.149204: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:07:53.150138: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:07:53.152028: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:07:53.153116: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:07:53.153900: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:07:53.236928: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:07:53.237805: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:07:53.238605: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:07:53.239395: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:07:54.206613: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
97/97 - 2s - 17ms/step - loss: 0.2721 - val_loss: 1.2218
Epoch 2/60
97/97 - 0s - 3ms/step - loss: 0.1326 - val_loss: 1.1750
Epoch 3/60
97/97 - 0s - 3ms/step - loss: 0.1154 - val_loss: 1.1389
Epoch 4/60
97/97 - 0s - 3ms/step - loss: 0.1063 - val_loss: 1.1395
Epoch 5/60
97/97 - 0s - 3ms/step - loss: 0.1007 - val_loss: 1.1172
Epoch 6/60
97/97 - 0s - 3ms/step - loss: 0.0971 - val_loss: 1.0904
Epoch 7/60
97/97 - 0s - 3ms/step - loss: 0.0932 - val_loss: 1.0733
Epoch 8/60
97/97 - 0s - 3ms/step - loss: 0.0908 - val_loss: 1.0578
Epoch 9/60
97/97 - 0s - 3ms/step - loss: 0.0882 - val_loss: 1.0524
Epoch 10/60
97/97 - 0s - 3ms/step - loss: 0.0859 - val_loss: 1.0401
Epoch 11/60
97/97 - 0s - 4ms/step - loss: 0.0848 - val_loss: 1.0186
Epoch 12/60
97/97 - 0s - 3ms/step - loss: 0.0830 - val_loss: 1.0240
Epoch 13/60
97/97 - 0s - 3ms/step - loss: 0.0823 - val_loss: 1.0088
Epoch 14/60
97/97 - 0s - 3ms/step - loss: 0.0811 - val_loss: 1.0034
Epoch 15/60
97/97 - 0s - 3ms/step - loss: 0.0793 - val_loss: 1.0032
Epoch 16/60
97/97 - 0s - 3ms/step - loss: 0.0795 - val_loss: 0.9932
Epoch 17/60
97/97 - 0s - 3ms/step - loss: 0.0776 - val_loss: 0.9832
Epoch 18/60
97/97 - 0s - 3ms/step - loss: 0.0774 - val_loss: 0.9859
Epoch 19/60
97/97 - 0s - 3ms/step - loss: 0.0765 - val_loss: 0.9662
Epoch 20/60
97/97 - 0s - 3ms/step - loss: 0.0748 - val_loss: 0.9720
Epoch 21/60
97/97 - 0s - 3ms/step - loss: 0.0746 - val_loss: 0.9735
Epoch 22/60
97/97 - 0s - 3ms/step - loss: 0.0749 - val_loss: 0.9732
Epoch 23/60
97/97 - 0s - 3ms/step - loss: 0.0740 - val_loss: 0.9594
Epoch 24/60
97/97 - 0s - 3ms/step - loss: 0.0729 - val_loss: 0.9552
Epoch 25/60
97/97 - 0s - 3ms/step - loss: 0.0727 - val_loss: 0.9578
Epoch 26/60
97/97 - 0s - 3ms/step - loss: 0.0722 - val_loss: 0.9425
Epoch 27/60
97/97 - 0s - 3ms/step - loss: 0.0720 - val_loss: 0.9398
Epoch 28/60
97/97 - 0s - 3ms/step - loss: 0.0716 - val_loss: 0.9279
Epoch 29/60
97/97 - 0s - 3ms/step - loss: 0.0706 - val_loss: 0.9422
Epoch 30/60
97/97 - 0s - 3ms/step - loss: 0.0700 - val_loss: 0.9307
Epoch 31/60
97/97 - 0s - 3ms/step - loss: 0.0696 - val_loss: 0.9416
Epoch 32/60
97/97 - 0s - 3ms/step - loss: 0.0693 - val_loss: 0.9417
Epoch 33/60
97/97 - 0s - 3ms/step - loss: 0.0694 - val_loss: 0.9377
Epoch 34/60
97/97 - 0s - 3ms/step - loss: 0.0697 - val_loss: 0.9566
Epoch 35/60
97/97 - 0s - 3ms/step - loss: 0.0680 - val_loss: 0.9436
Epoch 36/60
97/97 - 0s - 3ms/step - loss: 0.0684 - val_loss: 0.9397
Epoch 37/60
97/97 - 0s - 3ms/step - loss: 0.0677 - val_loss: 0.9465
Epoch 38/60
97/97 - 0s - 3ms/step - loss: 0.0674 - val_loss: 0.9196
Epoch 39/60
97/97 - 0s - 3ms/step - loss: 0.0669 - val_loss: 0.9240
Epoch 40/60
97/97 - 0s - 3ms/step - loss: 0.0668 - val_loss: 0.9273
Epoch 41/60
97/97 - 0s - 3ms/step - loss: 0.0666 - val_loss: 0.9198
Epoch 42/60
97/97 - 0s - 3ms/step - loss: 0.0664 - val_loss: 0.9315
Epoch 43/60
97/97 - 0s - 3ms/step - loss: 0.0660 - val_loss: 0.9152
Epoch 44/60
97/97 - 0s - 3ms/step - loss: 0.0658 - val_loss: 0.9085
Epoch 45/60
97/97 - 0s - 3ms/step - loss: 0.0654 - val_loss: 0.9156
Epoch 46/60
97/97 - 0s - 3ms/step - loss: 0.0656 - val_loss: 0.9358
Epoch 47/60
97/97 - 0s - 3ms/step - loss: 0.0647 - val_loss: 0.9262
Epoch 48/60
97/97 - 0s - 3ms/step - loss: 0.0647 - val_loss: 0.9149
Epoch 49/60
97/97 - 0s - 3ms/step - loss: 0.0645 - val_loss: 0.9161
Epoch 50/60
97/97 - 0s - 3ms/step - loss: 0.0643 - val_loss: 0.9191
Epoch 51/60
97/97 - 0s - 3ms/step - loss: 0.0644 - val_loss: 0.9173
Epoch 52/60
97/97 - 0s - 3ms/step - loss: 0.0634 - val_loss: 0.9210
Epoch 53/60
97/97 - 0s - 3ms/step - loss: 0.0633 - val_loss: 0.9222
Epoch 54/60
97/97 - 0s - 3ms/step - loss: 0.0630 - val_loss: 0.9183
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5387
Per-joint RMSE: 0.7897 0.7475 0.5589 0.3347 0.2586 0.2604
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:08:10.379324: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:08:10.404295: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:08:11.270154: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:11.274849: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:11.275640: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:11.277237: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:11.278027: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:11.278763: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:11.356094: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:11.356922: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:11.357660: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:11.358390: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:08:11.661102: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.112618e-01  RMSE=6.412969e-01
  per-joint RMSE: 0.9085 0.9100 0.6658 0.4005 0.3241 0.3246
Residual LSTM:  MSE=2.902304e-01      RMSE=5.387303e-01
  per-joint RMSE: 0.7897 0.7475 0.5589 0.3347 0.2586 0.2604
Combined torque MSE=2.902304e-01     RMSE=5.387303e-01
  per-joint RMSE: 0.7897 0.7475 0.5589 0.3347 0.2586 0.2604
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz --H 25 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.json
H=25, n_dof=6, feature_dim=6
X_train: (30756, 25, 6)  Y_train: (30756, 6)
X_test : (10306, 25, 6)  Y_test : (10306, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:08:13.658084: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:08:13.682774: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (30756, 25, 6), Y_train = (30756, 6)
  X_test  = (10306, 25, 6),  Y_test  = (10306, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:08:14.655888: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:14.660456: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:14.661245: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:14.662841: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:14.663635: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:14.664366: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:14.747859: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:14.748700: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:14.749450: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:14.750271: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:08:15.667756: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
97/97 - 2s - 17ms/step - loss: 0.7375 - val_loss: 2.3334
Epoch 2/60
97/97 - 0s - 3ms/step - loss: 0.5415 - val_loss: 2.0972
Epoch 3/60
97/97 - 0s - 3ms/step - loss: 0.4570 - val_loss: 2.2679
Epoch 4/60
97/97 - 0s - 3ms/step - loss: 0.4031 - val_loss: 2.0569
Epoch 5/60
97/97 - 0s - 3ms/step - loss: 0.3576 - val_loss: 2.3113
Epoch 6/60
97/97 - 0s - 3ms/step - loss: 0.3172 - val_loss: 1.9675
Epoch 7/60
97/97 - 0s - 3ms/step - loss: 0.2650 - val_loss: 2.2929
Epoch 8/60
97/97 - 0s - 3ms/step - loss: 0.2449 - val_loss: 2.2255
Epoch 9/60
97/97 - 0s - 3ms/step - loss: 0.2235 - val_loss: 2.1625
Epoch 10/60
97/97 - 0s - 3ms/step - loss: 0.2351 - val_loss: 1.8689
Epoch 11/60
97/97 - 0s - 3ms/step - loss: 0.2016 - val_loss: 1.9636
Epoch 12/60
97/97 - 0s - 3ms/step - loss: 0.2184 - val_loss: 1.8309
Epoch 13/60
97/97 - 0s - 3ms/step - loss: 0.1860 - val_loss: 1.7403
Epoch 14/60
97/97 - 0s - 3ms/step - loss: 0.1731 - val_loss: 1.7150
Epoch 15/60
97/97 - 0s - 3ms/step - loss: 0.1705 - val_loss: 1.7048
Epoch 16/60
97/97 - 0s - 3ms/step - loss: 0.1656 - val_loss: 1.6288
Epoch 17/60
97/97 - 0s - 3ms/step - loss: 0.1531 - val_loss: 1.6633
Epoch 18/60
97/97 - 0s - 3ms/step - loss: 0.1470 - val_loss: 1.6654
Epoch 19/60
97/97 - 0s - 3ms/step - loss: 0.1450 - val_loss: 1.6796
Epoch 20/60
97/97 - 0s - 3ms/step - loss: 0.1411 - val_loss: 1.6293
Epoch 21/60
97/97 - 0s - 3ms/step - loss: 0.1610 - val_loss: 1.7367
Epoch 22/60
97/97 - 0s - 3ms/step - loss: 0.1506 - val_loss: 1.7165
Epoch 23/60
97/97 - 0s - 3ms/step - loss: 0.1398 - val_loss: 1.6750
Epoch 24/60
97/97 - 0s - 3ms/step - loss: 0.1331 - val_loss: 1.6275
Epoch 25/60
97/97 - 0s - 3ms/step - loss: 0.1404 - val_loss: 1.6766
Epoch 26/60
97/97 - 0s - 3ms/step - loss: 0.1307 - val_loss: 1.6582
Epoch 27/60
97/97 - 0s - 3ms/step - loss: 0.1384 - val_loss: 1.6419
Epoch 28/60
97/97 - 0s - 3ms/step - loss: 0.1220 - val_loss: 1.7113
Epoch 29/60
97/97 - 0s - 3ms/step - loss: 0.1230 - val_loss: 1.6488
Epoch 30/60
97/97 - 0s - 3ms/step - loss: 0.1214 - val_loss: 1.7060
Epoch 31/60
97/97 - 0s - 3ms/step - loss: 0.1185 - val_loss: 1.6702
Epoch 32/60
97/97 - 0s - 3ms/step - loss: 0.1116 - val_loss: 1.6442
Epoch 33/60
97/97 - 0s - 3ms/step - loss: 0.1102 - val_loss: 1.6775
Epoch 34/60
97/97 - 0s - 3ms/step - loss: 0.1126 - val_loss: 1.6538
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6260
Per-joint RMSE: 0.9124 0.8577 0.6466 0.3988 0.3182 0.3233
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:08:26.288838: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:08:26.313676: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:08:27.151971: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:27.156537: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:27.157412: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:27.159063: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:27.159934: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:27.160675: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:27.242033: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:27.242956: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:27.243690: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:27.244418: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:08:27.541844: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.112618e-01  RMSE=6.412969e-01
  per-joint RMSE: 0.9085 0.9100 0.6658 0.4005 0.3241 0.3246
Residual LSTM:  MSE=3.918368e-01      RMSE=6.259686e-01
  per-joint RMSE: 0.9124 0.8577 0.6466 0.3988 0.3182 0.3233
Combined torque MSE=3.918368e-01     RMSE=6.259686e-01
  per-joint RMSE: 0.9124 0.8577 0.6466 0.3988 0.3182 0.3233
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz --H 25 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (30756, 25, 18)  Y_train: (30756, 6)
X_test : (10306, 25, 18)  Y_test : (10306, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:08:29.628646: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:08:29.652829: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (30756, 25, 18), Y_train = (30756, 6)
  X_test  = (10306, 25, 18),  Y_test  = (10306, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:08:30.697415: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:30.702008: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:30.702796: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:30.704339: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:30.705210: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:30.705942: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:30.782811: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:30.783643: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:30.784381: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:30.785203: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:08:31.760021: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
97/97 - 2s - 17ms/step - loss: 0.2906 - val_loss: 1.2770
Epoch 2/60
97/97 - 0s - 3ms/step - loss: 0.1517 - val_loss: 1.1948
Epoch 3/60
97/97 - 0s - 3ms/step - loss: 0.1303 - val_loss: 1.1759
Epoch 4/60
97/97 - 0s - 3ms/step - loss: 0.1202 - val_loss: 1.1270
Epoch 5/60
97/97 - 0s - 3ms/step - loss: 0.1122 - val_loss: 1.1208
Epoch 6/60
97/97 - 0s - 3ms/step - loss: 0.1044 - val_loss: 1.1028
Epoch 7/60
97/97 - 0s - 3ms/step - loss: 0.0989 - val_loss: 1.0920
Epoch 8/60
97/97 - 0s - 3ms/step - loss: 0.0970 - val_loss: 1.0800
Epoch 9/60
97/97 - 0s - 3ms/step - loss: 0.0944 - val_loss: 1.0797
Epoch 10/60
97/97 - 0s - 3ms/step - loss: 0.0902 - val_loss: 1.0780
Epoch 11/60
97/97 - 0s - 3ms/step - loss: 0.0894 - val_loss: 1.0721
Epoch 12/60
97/97 - 0s - 3ms/step - loss: 0.0882 - val_loss: 1.0684
Epoch 13/60
97/97 - 0s - 3ms/step - loss: 0.0871 - val_loss: 1.0724
Epoch 14/60
97/97 - 0s - 3ms/step - loss: 0.0844 - val_loss: 1.0636
Epoch 15/60
97/97 - 0s - 3ms/step - loss: 0.0842 - val_loss: 1.0509
Epoch 16/60
97/97 - 0s - 3ms/step - loss: 0.0822 - val_loss: 1.0507
Epoch 17/60
97/97 - 0s - 3ms/step - loss: 0.0814 - val_loss: 1.0425
Epoch 18/60
97/97 - 0s - 3ms/step - loss: 0.0817 - val_loss: 1.0375
Epoch 19/60
97/97 - 0s - 3ms/step - loss: 0.0798 - val_loss: 1.0302
Epoch 20/60
97/97 - 0s - 3ms/step - loss: 0.0794 - val_loss: 1.0324
Epoch 21/60
97/97 - 0s - 3ms/step - loss: 0.0783 - val_loss: 1.0135
Epoch 22/60
97/97 - 0s - 3ms/step - loss: 0.0778 - val_loss: 1.0164
Epoch 23/60
97/97 - 0s - 3ms/step - loss: 0.0775 - val_loss: 1.0071
Epoch 24/60
97/97 - 0s - 3ms/step - loss: 0.0773 - val_loss: 1.0027
Epoch 25/60
97/97 - 0s - 3ms/step - loss: 0.0761 - val_loss: 1.0011
Epoch 26/60
97/97 - 0s - 3ms/step - loss: 0.0754 - val_loss: 1.0114
Epoch 27/60
97/97 - 0s - 3ms/step - loss: 0.0752 - val_loss: 0.9917
Epoch 28/60
97/97 - 0s - 3ms/step - loss: 0.0751 - val_loss: 0.9939
Epoch 29/60
97/97 - 0s - 3ms/step - loss: 0.0743 - val_loss: 0.9889
Epoch 30/60
97/97 - 0s - 3ms/step - loss: 0.0735 - val_loss: 0.9778
Epoch 31/60
97/97 - 0s - 3ms/step - loss: 0.0728 - val_loss: 0.9952
Epoch 32/60
97/97 - 0s - 3ms/step - loss: 0.0722 - val_loss: 0.9964
Epoch 33/60
97/97 - 0s - 3ms/step - loss: 0.0728 - val_loss: 0.9916
Epoch 34/60
97/97 - 0s - 3ms/step - loss: 0.0715 - val_loss: 0.9765
Epoch 35/60
97/97 - 0s - 3ms/step - loss: 0.0715 - val_loss: 0.9816
Epoch 36/60
97/97 - 0s - 3ms/step - loss: 0.0722 - val_loss: 0.9671
Epoch 37/60
97/97 - 0s - 3ms/step - loss: 0.0707 - val_loss: 0.9843
Epoch 38/60
97/97 - 0s - 3ms/step - loss: 0.0704 - val_loss: 0.9785
Epoch 39/60
97/97 - 0s - 3ms/step - loss: 0.0697 - val_loss: 0.9768
Epoch 40/60
97/97 - 0s - 3ms/step - loss: 0.0708 - val_loss: 0.9572
Epoch 41/60
97/97 - 0s - 3ms/step - loss: 0.0698 - val_loss: 0.9600
Epoch 42/60
97/97 - 0s - 3ms/step - loss: 0.0695 - val_loss: 0.9645
Epoch 43/60
97/97 - 0s - 3ms/step - loss: 0.0689 - val_loss: 0.9532
Epoch 44/60
97/97 - 0s - 3ms/step - loss: 0.0688 - val_loss: 0.9523
Epoch 45/60
97/97 - 0s - 3ms/step - loss: 0.0679 - val_loss: 0.9424
Epoch 46/60
97/97 - 0s - 3ms/step - loss: 0.0676 - val_loss: 0.9627
Epoch 47/60
97/97 - 0s - 3ms/step - loss: 0.0678 - val_loss: 0.9517
Epoch 48/60
97/97 - 0s - 3ms/step - loss: 0.0675 - val_loss: 0.9493
Epoch 49/60
97/97 - 0s - 3ms/step - loss: 0.0677 - val_loss: 0.9505
Epoch 50/60
97/97 - 0s - 3ms/step - loss: 0.0665 - val_loss: 0.9398
Epoch 51/60
97/97 - 0s - 3ms/step - loss: 0.0667 - val_loss: 0.9427
Epoch 52/60
97/97 - 0s - 3ms/step - loss: 0.0663 - val_loss: 0.9514
Epoch 53/60
97/97 - 0s - 3ms/step - loss: 0.0659 - val_loss: 0.9482
Epoch 54/60
97/97 - 0s - 3ms/step - loss: 0.0663 - val_loss: 0.9357
Epoch 55/60
97/97 - 0s - 3ms/step - loss: 0.0666 - val_loss: 0.9277
Epoch 56/60
97/97 - 0s - 3ms/step - loss: 0.0660 - val_loss: 0.9466
Epoch 57/60
97/97 - 0s - 3ms/step - loss: 0.0650 - val_loss: 0.9319
Epoch 58/60
97/97 - 0s - 3ms/step - loss: 0.0652 - val_loss: 0.9586
Epoch 59/60
97/97 - 0s - 3ms/step - loss: 0.0651 - val_loss: 0.9535
Epoch 60/60
97/97 - 0s - 3ms/step - loss: 0.0651 - val_loss: 0.9638
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5861
Per-joint RMSE: 0.8647 0.7796 0.6239 0.3796 0.2902 0.2970
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:08:49.444431: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:08:49.469108: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:08:50.315121: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:50.319745: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:50.320541: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:50.322266: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:50.323058: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:50.323808: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:50.402372: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:50.403217: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:50.403959: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:50.404689: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:08:50.706148: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.112618e-01  RMSE=6.412969e-01
  per-joint RMSE: 0.9085 0.9100 0.6658 0.4005 0.3241 0.3246
Residual LSTM:  MSE=3.435505e-01      RMSE=5.861318e-01
  per-joint RMSE: 0.8647 0.7796 0.6239 0.3796 0.2902 0.2970
Combined torque MSE=3.435505e-01     RMSE=5.861318e-01
  per-joint RMSE: 0.8647 0.7796 0.6239 0.3796 0.2902 0.2970
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz --H 25 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (30756, 25, 18)  Y_train: (30756, 6)
X_test : (10306, 25, 18)  Y_test : (10306, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:08:52.786655: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:08:52.810603: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (30756, 25, 18), Y_train = (30756, 6)
  X_test  = (10306, 25, 18),  Y_test  = (10306, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:08:53.848440: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:53.853497: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:53.854368: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:53.855947: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:53.856731: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:53.857467: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:53.941609: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:53.942444: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:53.943185: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:08:53.944081: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:08:54.909039: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
97/97 - 2s - 17ms/step - loss: 0.2729 - val_loss: 1.2379
Epoch 2/60
97/97 - 0s - 3ms/step - loss: 0.1346 - val_loss: 1.1607
Epoch 3/60
97/97 - 0s - 3ms/step - loss: 0.1156 - val_loss: 1.1291
Epoch 4/60
97/97 - 0s - 3ms/step - loss: 0.1057 - val_loss: 1.1229
Epoch 5/60
97/97 - 0s - 3ms/step - loss: 0.1005 - val_loss: 1.1048
Epoch 6/60
97/97 - 0s - 3ms/step - loss: 0.0960 - val_loss: 1.1037
Epoch 7/60
97/97 - 0s - 3ms/step - loss: 0.0933 - val_loss: 1.0954
Epoch 8/60
97/97 - 0s - 3ms/step - loss: 0.0901 - val_loss: 1.1010
Epoch 9/60
97/97 - 0s - 3ms/step - loss: 0.0880 - val_loss: 1.0936
Epoch 10/60
97/97 - 0s - 3ms/step - loss: 0.0862 - val_loss: 1.0822
Epoch 11/60
97/97 - 0s - 3ms/step - loss: 0.0846 - val_loss: 1.0705
Epoch 12/60
97/97 - 0s - 3ms/step - loss: 0.0835 - val_loss: 1.0636
Epoch 13/60
97/97 - 0s - 3ms/step - loss: 0.0821 - val_loss: 1.0537
Epoch 14/60
97/97 - 0s - 3ms/step - loss: 0.0809 - val_loss: 1.0335
Epoch 15/60
97/97 - 0s - 3ms/step - loss: 0.0798 - val_loss: 1.0377
Epoch 16/60
97/97 - 0s - 3ms/step - loss: 0.0787 - val_loss: 1.0301
Epoch 17/60
97/97 - 0s - 3ms/step - loss: 0.0777 - val_loss: 1.0178
Epoch 18/60
97/97 - 0s - 3ms/step - loss: 0.0764 - val_loss: 1.0246
Epoch 19/60
97/97 - 0s - 3ms/step - loss: 0.0764 - val_loss: 1.0052
Epoch 20/60
97/97 - 0s - 3ms/step - loss: 0.0756 - val_loss: 0.9999
Epoch 21/60
97/97 - 0s - 3ms/step - loss: 0.0751 - val_loss: 0.9656
Epoch 22/60
97/97 - 0s - 3ms/step - loss: 0.0739 - val_loss: 0.9682
Epoch 23/60
97/97 - 0s - 3ms/step - loss: 0.0735 - val_loss: 0.9590
Epoch 24/60
97/97 - 0s - 3ms/step - loss: 0.0728 - val_loss: 0.9500
Epoch 25/60
97/97 - 0s - 3ms/step - loss: 0.0721 - val_loss: 0.9384
Epoch 26/60
97/97 - 0s - 3ms/step - loss: 0.0720 - val_loss: 0.9498
Epoch 27/60
97/97 - 0s - 3ms/step - loss: 0.0706 - val_loss: 0.9385
Epoch 28/60
97/97 - 0s - 3ms/step - loss: 0.0715 - val_loss: 0.9345
Epoch 29/60
97/97 - 0s - 3ms/step - loss: 0.0709 - val_loss: 0.9328
Epoch 30/60
97/97 - 0s - 3ms/step - loss: 0.0708 - val_loss: 0.9018
Epoch 31/60
97/97 - 0s - 3ms/step - loss: 0.0691 - val_loss: 0.9067
Epoch 32/60
97/97 - 0s - 3ms/step - loss: 0.0690 - val_loss: 0.9145
Epoch 33/60
97/97 - 0s - 3ms/step - loss: 0.0690 - val_loss: 0.8825
Epoch 34/60
97/97 - 0s - 3ms/step - loss: 0.0679 - val_loss: 0.9023
Epoch 35/60
97/97 - 0s - 3ms/step - loss: 0.0674 - val_loss: 0.8859
Epoch 36/60
97/97 - 0s - 3ms/step - loss: 0.0667 - val_loss: 0.8839
Epoch 37/60
97/97 - 0s - 3ms/step - loss: 0.0675 - val_loss: 0.8859
Epoch 38/60
97/97 - 0s - 3ms/step - loss: 0.0673 - val_loss: 0.8857
Epoch 39/60
97/97 - 0s - 3ms/step - loss: 0.0663 - val_loss: 0.8842
Epoch 40/60
97/97 - 0s - 3ms/step - loss: 0.0661 - val_loss: 0.8894
Epoch 41/60
97/97 - 0s - 3ms/step - loss: 0.0660 - val_loss: 0.8797
Epoch 42/60
97/97 - 0s - 3ms/step - loss: 0.0652 - val_loss: 0.8964
Epoch 43/60
97/97 - 0s - 3ms/step - loss: 0.0651 - val_loss: 0.8783
Epoch 44/60
97/97 - 0s - 3ms/step - loss: 0.0647 - val_loss: 0.8979
Epoch 45/60
97/97 - 0s - 3ms/step - loss: 0.0647 - val_loss: 0.9020
Epoch 46/60
97/97 - 0s - 3ms/step - loss: 0.0642 - val_loss: 0.8369
Epoch 47/60
97/97 - 0s - 3ms/step - loss: 0.0642 - val_loss: 0.8709
Epoch 48/60
97/97 - 0s - 3ms/step - loss: 0.0641 - val_loss: 0.8591
Epoch 49/60
97/97 - 0s - 3ms/step - loss: 0.0647 - val_loss: 0.8456
Epoch 50/60
97/97 - 0s - 3ms/step - loss: 0.0640 - val_loss: 0.8453
Epoch 51/60
97/97 - 0s - 3ms/step - loss: 0.0630 - val_loss: 0.8418
Epoch 52/60
97/97 - 0s - 3ms/step - loss: 0.0626 - val_loss: 0.8486
Epoch 53/60
97/97 - 0s - 3ms/step - loss: 0.0620 - val_loss: 0.8641
Epoch 54/60
97/97 - 0s - 3ms/step - loss: 0.0621 - val_loss: 0.8380
Epoch 55/60
97/97 - 0s - 3ms/step - loss: 0.0614 - val_loss: 0.8719
Epoch 56/60
97/97 - 0s - 3ms/step - loss: 0.0615 - val_loss: 0.9008
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5376
Per-joint RMSE: 0.7740 0.7414 0.5821 0.3338 0.2420 0.2760
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:09:11.553660: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:09:11.578418: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:09:12.435765: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:12.440316: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:12.441197: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:12.442920: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:12.443708: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:12.444439: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:12.530042: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:12.530956: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:12.531694: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:12.532422: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:09:12.835335: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.112618e-01  RMSE=6.412969e-01
  per-joint RMSE: 0.9085 0.9100 0.6658 0.4005 0.3241 0.3246
Residual LSTM:  MSE=2.889709e-01      RMSE=5.375601e-01
  per-joint RMSE: 0.7740 0.7414 0.5821 0.3338 0.2420 0.2760
Combined torque MSE=2.889709e-01     RMSE=5.375601e-01
  per-joint RMSE: 0.7740 0.7414 0.5821 0.3338 0.2420 0.2760
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz --H 50 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.json
H=50, n_dof=6, feature_dim=24
X_train: (29981, 50, 24)  Y_train: (29981, 6)
X_test : (10106, 50, 24)  Y_test : (10106, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:09:15.001172: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:09:15.024919: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (29981, 50, 24), Y_train = (29981, 6)
  X_test  = (10106, 50, 24),  Y_test  = (10106, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:09:16.238022: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:16.243065: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:16.243974: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:16.245720: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:16.246624: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:16.247480: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:16.345150: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:16.346044: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:16.346839: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:16.347622: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:09:17.352135: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
94/94 - 2s - 19ms/step - loss: 0.2671 - val_loss: 0.6245
Epoch 2/60
94/94 - 0s - 4ms/step - loss: 0.1366 - val_loss: 0.6261
Epoch 3/60
94/94 - 0s - 4ms/step - loss: 0.1177 - val_loss: 0.6174
Epoch 4/60
94/94 - 0s - 4ms/step - loss: 0.1089 - val_loss: 0.6258
Epoch 5/60
94/94 - 0s - 4ms/step - loss: 0.1029 - val_loss: 0.6088
Epoch 6/60
94/94 - 0s - 4ms/step - loss: 0.0981 - val_loss: 0.6096
Epoch 7/60
94/94 - 0s - 4ms/step - loss: 0.0943 - val_loss: 0.6091
Epoch 8/60
94/94 - 0s - 4ms/step - loss: 0.0919 - val_loss: 0.6062
Epoch 9/60
94/94 - 0s - 4ms/step - loss: 0.0896 - val_loss: 0.6083
Epoch 10/60
94/94 - 0s - 4ms/step - loss: 0.0879 - val_loss: 0.6108
Epoch 11/60
94/94 - 0s - 4ms/step - loss: 0.0859 - val_loss: 0.6007
Epoch 12/60
94/94 - 0s - 5ms/step - loss: 0.0847 - val_loss: 0.5946
Epoch 13/60
94/94 - 0s - 4ms/step - loss: 0.0837 - val_loss: 0.6318
Epoch 14/60
94/94 - 0s - 4ms/step - loss: 0.0821 - val_loss: 0.6211
Epoch 15/60
94/94 - 0s - 4ms/step - loss: 0.0811 - val_loss: 0.6224
Epoch 16/60
94/94 - 0s - 4ms/step - loss: 0.0795 - val_loss: 0.6275
Epoch 17/60
94/94 - 0s - 4ms/step - loss: 0.0794 - val_loss: 0.6361
Epoch 18/60
94/94 - 0s - 4ms/step - loss: 0.0783 - val_loss: 0.6317
Epoch 19/60
94/94 - 0s - 4ms/step - loss: 0.0781 - val_loss: 0.6409
Epoch 20/60
94/94 - 0s - 4ms/step - loss: 0.0771 - val_loss: 0.6462
Epoch 21/60
94/94 - 0s - 4ms/step - loss: 0.0764 - val_loss: 0.6294
Epoch 22/60
94/94 - 0s - 4ms/step - loss: 0.0756 - val_loss: 0.6416
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5385
Per-joint RMSE: 0.7781 0.7380 0.5873 0.3356 0.2489 0.2652
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:09:27.364502: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:09:27.388986: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:09:28.240017: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:28.244707: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:28.245502: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:28.247351: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:28.248156: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:28.248966: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:28.330437: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:28.331274: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:28.332023: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:28.332753: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:09:28.646762: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.158559e-01  RMSE=6.448689e-01
  per-joint RMSE: 0.9152 0.9152 0.6682 0.4025 0.3246 0.3257
Residual LSTM:  MSE=2.899902e-01      RMSE=5.385074e-01
  per-joint RMSE: 0.7781 0.7380 0.5873 0.3356 0.2489 0.2652
Combined torque MSE=2.899902e-01     RMSE=5.385074e-01
  per-joint RMSE: 0.7781 0.7380 0.5873 0.3356 0.2489 0.2652
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz --H 50 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.json
H=50, n_dof=6, feature_dim=6
X_train: (29981, 50, 6)  Y_train: (29981, 6)
X_test : (10106, 50, 6)  Y_test : (10106, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:09:30.736049: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:09:30.759728: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (29981, 50, 6), Y_train = (29981, 6)
  X_test  = (10106, 50, 6),  Y_test  = (10106, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:09:31.794798: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:31.799655: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:31.800443: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:31.802129: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:31.803002: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:31.803731: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:31.891457: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:31.892297: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:31.893091: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:31.893813: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:09:32.834577: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
94/94 - 2s - 18ms/step - loss: 0.6841 - val_loss: 1.1967
Epoch 2/60
94/94 - 0s - 4ms/step - loss: 0.4461 - val_loss: 1.5144
Epoch 3/60
94/94 - 0s - 4ms/step - loss: 0.3912 - val_loss: 1.5856
Epoch 4/60
94/94 - 0s - 4ms/step - loss: 0.2955 - val_loss: 1.6421
Epoch 5/60
94/94 - 0s - 4ms/step - loss: 0.2286 - val_loss: 1.4943
Epoch 6/60
94/94 - 0s - 4ms/step - loss: 0.2319 - val_loss: 1.3234
Epoch 7/60
94/94 - 0s - 4ms/step - loss: 0.1961 - val_loss: 1.3136
Epoch 8/60
94/94 - 0s - 4ms/step - loss: 0.1813 - val_loss: 1.3271
Epoch 9/60
94/94 - 0s - 4ms/step - loss: 0.1726 - val_loss: 1.2537
Epoch 10/60
94/94 - 0s - 4ms/step - loss: 0.1648 - val_loss: 1.2537
Epoch 11/60
94/94 - 0s - 4ms/step - loss: 0.1551 - val_loss: 1.1993
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6573
Per-joint RMSE: 0.9628 0.8982 0.6784 0.4108 0.3357 0.3411
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:09:38.601761: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:09:38.626285: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:09:39.488395: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:39.492932: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:39.493719: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:39.495376: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:39.496166: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:39.496904: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:39.580387: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:39.581298: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:39.582040: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:39.582772: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:09:39.892777: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.158559e-01  RMSE=6.448689e-01
  per-joint RMSE: 0.9152 0.9152 0.6682 0.4025 0.3246 0.3257
Residual LSTM:  MSE=4.319781e-01      RMSE=6.572504e-01
  per-joint RMSE: 0.9628 0.8982 0.6784 0.4108 0.3357 0.3411
Combined torque MSE=4.319781e-01     RMSE=6.572504e-01
  per-joint RMSE: 0.9628 0.8982 0.6784 0.4108 0.3357 0.3411
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz --H 50 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (29981, 50, 18)  Y_train: (29981, 6)
X_test : (10106, 50, 18)  Y_test : (10106, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:09:42.004513: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:09:42.028656: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (29981, 50, 18), Y_train = (29981, 6)
  X_test  = (10106, 50, 18),  Y_test  = (10106, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:09:43.195954: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:43.200999: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:43.201790: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:43.203620: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:43.204404: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:43.205143: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:43.289436: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:43.290265: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:43.291004: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:43.291733: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:09:44.281595: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
94/94 - 2s - 19ms/step - loss: 0.2880 - val_loss: 0.6038
Epoch 2/60
94/94 - 0s - 4ms/step - loss: 0.1523 - val_loss: 0.5962
Epoch 3/60
94/94 - 0s - 4ms/step - loss: 0.1337 - val_loss: 0.5997
Epoch 4/60
94/94 - 0s - 4ms/step - loss: 0.1211 - val_loss: 0.6020
Epoch 5/60
94/94 - 0s - 4ms/step - loss: 0.1135 - val_loss: 0.5964
Epoch 6/60
94/94 - 0s - 4ms/step - loss: 0.1066 - val_loss: 0.6183
Epoch 7/60
94/94 - 0s - 4ms/step - loss: 0.1025 - val_loss: 0.6100
Epoch 8/60
94/94 - 0s - 4ms/step - loss: 0.0993 - val_loss: 0.6088
Epoch 9/60
94/94 - 0s - 4ms/step - loss: 0.0959 - val_loss: 0.6207
Epoch 10/60
94/94 - 0s - 4ms/step - loss: 0.0931 - val_loss: 0.6307
Epoch 11/60
94/94 - 0s - 4ms/step - loss: 0.0909 - val_loss: 0.6329
Epoch 12/60
94/94 - 0s - 5ms/step - loss: 0.0896 - val_loss: 0.6462
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6108
Per-joint RMSE: 0.8790 0.8591 0.6270 0.3931 0.2970 0.3034
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:09:50.567933: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:09:50.592932: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:09:51.441228: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:51.445814: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:51.446636: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:51.448652: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:51.449458: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:51.450201: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:51.527141: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:51.527987: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:51.529245: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:51.529997: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:09:51.838343: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.158559e-01  RMSE=6.448689e-01
  per-joint RMSE: 0.9152 0.9152 0.6682 0.4025 0.3246 0.3257
Residual LSTM:  MSE=3.730793e-01      RMSE=6.108022e-01
  per-joint RMSE: 0.8790 0.8591 0.6270 0.3931 0.2970 0.3034
Combined torque MSE=3.730794e-01     RMSE=6.108023e-01
  per-joint RMSE: 0.8790 0.8591 0.6270 0.3931 0.2970 0.3034
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz --H 50 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (29981, 50, 18)  Y_train: (29981, 6)
X_test : (10106, 50, 18)  Y_test : (10106, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:09:53.956845: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:09:53.982057: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (29981, 50, 18), Y_train = (29981, 6)
  X_test  = (10106, 50, 18),  Y_test  = (10106, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:09:55.136056: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:55.140915: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:55.141712: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:55.143319: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:55.144105: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:55.144840: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:55.223391: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:55.224222: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:55.224968: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:09:55.225697: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:09:56.212537: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
94/94 - 2s - 19ms/step - loss: 0.2705 - val_loss: 0.5892
Epoch 2/60
94/94 - 0s - 4ms/step - loss: 0.1366 - val_loss: 0.5536
Epoch 3/60
94/94 - 0s - 4ms/step - loss: 0.1174 - val_loss: 0.5389
Epoch 4/60
94/94 - 0s - 4ms/step - loss: 0.1080 - val_loss: 0.5391
Epoch 5/60
94/94 - 0s - 4ms/step - loss: 0.1025 - val_loss: 0.5331
Epoch 6/60
94/94 - 0s - 4ms/step - loss: 0.0980 - val_loss: 0.5328
Epoch 7/60
94/94 - 0s - 4ms/step - loss: 0.0948 - val_loss: 0.5238
Epoch 8/60
94/94 - 0s - 4ms/step - loss: 0.0917 - val_loss: 0.5254
Epoch 9/60
94/94 - 0s - 4ms/step - loss: 0.0897 - val_loss: 0.5242
Epoch 10/60
94/94 - 0s - 4ms/step - loss: 0.0876 - val_loss: 0.5254
Epoch 11/60
94/94 - 0s - 4ms/step - loss: 0.0857 - val_loss: 0.5247
Epoch 12/60
94/94 - 0s - 5ms/step - loss: 0.0841 - val_loss: 0.5328
Epoch 13/60
94/94 - 0s - 4ms/step - loss: 0.0834 - val_loss: 0.5267
Epoch 14/60
94/94 - 0s - 4ms/step - loss: 0.0824 - val_loss: 0.5397
Epoch 15/60
94/94 - 0s - 4ms/step - loss: 0.0804 - val_loss: 0.5304
Epoch 16/60
94/94 - 0s - 4ms/step - loss: 0.0800 - val_loss: 0.5256
Epoch 17/60
94/94 - 0s - 4ms/step - loss: 0.0788 - val_loss: 0.5274
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5525
Per-joint RMSE: 0.7866 0.7800 0.5985 0.3493 0.2338 0.2633
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:10:04.393209: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:10:04.418946: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:10:05.267868: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:10:05.272584: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:10:05.274331: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:10:05.276184: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:10:05.276998: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:10:05.277727: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:10:05.359285: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:10:05.360135: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:10:05.360939: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:10:05.361729: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:10:05.672708: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.158559e-01  RMSE=6.448689e-01
  per-joint RMSE: 0.9152 0.9152 0.6682 0.4025 0.3246 0.3257
Residual LSTM:  MSE=3.052488e-01      RMSE=5.524932e-01
  per-joint RMSE: 0.7866 0.7800 0.5985 0.3493 0.2338 0.2633
Combined torque MSE=3.052488e-01     RMSE=5.524932e-01
  per-joint RMSE: 0.7866 0.7800 0.5985 0.3493 0.2338 0.2633
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=2                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz                                 ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed0_dataset.npz -t structured -s 2 -r 0 --hp_preset fast_debug --epochs 250 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 250, 'lagrangian_type': <function structured_lagrangian_fn at 0x7c288d2981f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed0_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed0_dataset.npz
   dt ≈ 0.022064047964597475
  dof = 6
  Train trajectories = 60
  Test trajectories  = 15
  Train samples = 31587
  Test samples  = 10519
################################################

2026-01-22 06:10:10.090822: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250 | type=structured | dof=6
################################################
2026-01-22 06:10:13.237087: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:10:13.237123: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:10:13.237129: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:10:13.237156: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:10:13.237163: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:10:13.237183: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:10:13.237227: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:10:13.237233: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:10:13.237249: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:10:13.237254: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.0s, Loss=1.19e+01, Inv=1.19e+01, For=1.27e+02, Power=2.29e+00
  [eval] test_mse=1.368e+00  (n=10519)
Epoch 00050: Time=  10.8s, Loss=2.48e+00, Inv=2.48e+00, For=8.62e+01, Power=7.05e-01
Epoch 00100: Time=  14.9s, Loss=2.29e+00, Inv=2.29e+00, For=1.21e+02, Power=5.82e-01
Epoch 00150: Time=  19.3s, Loss=2.19e+00, Inv=2.19e+00, For=1.47e+02, Power=5.24e-01
Epoch 00200: Time=  23.4s, Loss=2.13e+00, Inv=2.13e+00, For=1.84e+02, Power=4.91e-01
  [eval] test_mse=2.217e+00  (n=10519)
Epoch 00250: Time=  27.6s, Loss=2.08e+00, Inv=2.08e+00, For=2.18e+02, Power=4.76e-01
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250
Torque MSE  = 4.172e-01
Torque RMSE = 6.459e-01
Per-joint MSE : 8.453e-01 8.290e-01 3.856e-01 1.765e-01 1.584e-01 1.084e-01
Per-joint RMSE: 9.194e-01 9.105e-01 6.209e-01 4.201e-01 3.980e-01 3.292e-01
Comp Time per Sample = 3.529e-08s / 28338052.4Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed0_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed0_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax
Detected n_dof=6 (seed=2)
2026-01-22 06:10:42.982634: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 60 trajectories
2026-01-22 06:10:44.310309: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:10:44.310324: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:10:45.813434: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:10:47.024254: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:10:47.024266: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/60
  done 50/60
  done 60/60

Exporting split=test: 15 trajectories
2026-01-22 06:10:49.935445: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 15/15

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz --H 25 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.json
H=25, n_dof=6, feature_dim=24
X_train: (30756, 25, 24)  Y_train: (30756, 6)
X_test : (10306, 25, 24)  Y_test : (10306, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:10:52.276365: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:10:52.300854: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (30756, 25, 24), Y_train = (30756, 6)
  X_test  = (10306, 25, 24),  Y_test  = (10306, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:10:53.401291: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:10:53.406270: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:10:53.407199: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:10:53.409010: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:10:53.409934: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:10:53.410771: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:10:53.501928: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:10:53.502832: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:10:53.503634: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:10:53.504421: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:10:54.499140: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
97/97 - 2s - 17ms/step - loss: 0.2659 - val_loss: 1.0972
Epoch 2/60
97/97 - 0s - 3ms/step - loss: 0.1339 - val_loss: 1.0587
Epoch 3/60
97/97 - 0s - 3ms/step - loss: 0.1168 - val_loss: 1.0389
Epoch 4/60
97/97 - 0s - 3ms/step - loss: 0.1070 - val_loss: 1.0204
Epoch 5/60
97/97 - 0s - 3ms/step - loss: 0.1014 - val_loss: 1.0037
Epoch 6/60
97/97 - 0s - 3ms/step - loss: 0.0971 - val_loss: 0.9896
Epoch 7/60
97/97 - 0s - 3ms/step - loss: 0.0933 - val_loss: 0.9721
Epoch 8/60
97/97 - 0s - 3ms/step - loss: 0.0909 - val_loss: 0.9673
Epoch 9/60
97/97 - 0s - 3ms/step - loss: 0.0890 - val_loss: 0.9539
Epoch 10/60
97/97 - 0s - 3ms/step - loss: 0.0875 - val_loss: 0.9454
Epoch 11/60
97/97 - 0s - 3ms/step - loss: 0.0862 - val_loss: 0.9341
Epoch 12/60
97/97 - 0s - 3ms/step - loss: 0.0833 - val_loss: 0.9201
Epoch 13/60
97/97 - 0s - 3ms/step - loss: 0.0822 - val_loss: 0.9166
Epoch 14/60
97/97 - 0s - 3ms/step - loss: 0.0818 - val_loss: 0.9023
Epoch 15/60
97/97 - 0s - 3ms/step - loss: 0.0813 - val_loss: 0.9080
Epoch 16/60
97/97 - 0s - 3ms/step - loss: 0.0795 - val_loss: 0.8878
Epoch 17/60
97/97 - 0s - 3ms/step - loss: 0.0784 - val_loss: 0.8826
Epoch 18/60
97/97 - 0s - 3ms/step - loss: 0.0785 - val_loss: 0.8839
Epoch 19/60
97/97 - 0s - 3ms/step - loss: 0.0776 - val_loss: 0.8694
Epoch 20/60
97/97 - 0s - 3ms/step - loss: 0.0764 - val_loss: 0.8658
Epoch 21/60
97/97 - 0s - 3ms/step - loss: 0.0764 - val_loss: 0.8766
Epoch 22/60
97/97 - 0s - 3ms/step - loss: 0.0748 - val_loss: 0.8610
Epoch 23/60
97/97 - 0s - 3ms/step - loss: 0.0749 - val_loss: 0.8550
Epoch 24/60
97/97 - 0s - 3ms/step - loss: 0.0741 - val_loss: 0.8566
Epoch 25/60
97/97 - 0s - 3ms/step - loss: 0.0733 - val_loss: 0.8511
Epoch 26/60
97/97 - 0s - 3ms/step - loss: 0.0731 - val_loss: 0.8525
Epoch 27/60
97/97 - 0s - 3ms/step - loss: 0.0726 - val_loss: 0.8403
Epoch 28/60
97/97 - 0s - 3ms/step - loss: 0.0722 - val_loss: 0.8499
Epoch 29/60
97/97 - 0s - 3ms/step - loss: 0.0715 - val_loss: 0.8452
Epoch 30/60
97/97 - 0s - 3ms/step - loss: 0.0705 - val_loss: 0.8436
Epoch 31/60
97/97 - 0s - 3ms/step - loss: 0.0708 - val_loss: 0.8294
Epoch 32/60
97/97 - 0s - 3ms/step - loss: 0.0701 - val_loss: 0.8482
Epoch 33/60
97/97 - 0s - 3ms/step - loss: 0.0701 - val_loss: 0.8433
Epoch 34/60
97/97 - 0s - 3ms/step - loss: 0.0691 - val_loss: 0.8431
Epoch 35/60
97/97 - 0s - 3ms/step - loss: 0.0687 - val_loss: 0.8464
Epoch 36/60
97/97 - 0s - 3ms/step - loss: 0.0687 - val_loss: 0.8518
Epoch 37/60
97/97 - 0s - 3ms/step - loss: 0.0679 - val_loss: 0.8608
Epoch 38/60
97/97 - 0s - 3ms/step - loss: 0.0682 - val_loss: 0.8657
Epoch 39/60
97/97 - 0s - 3ms/step - loss: 0.0675 - val_loss: 0.8473
Epoch 40/60
97/97 - 0s - 3ms/step - loss: 0.0675 - val_loss: 0.8483
Epoch 41/60
97/97 - 0s - 3ms/step - loss: 0.0669 - val_loss: 0.8430
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5507
Per-joint RMSE: 0.7562 0.7896 0.5393 0.3778 0.3415 0.2722
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:11:07.181206: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:11:07.206268: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:11:08.049901: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:08.054441: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:08.055298: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:08.057004: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:08.057788: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:08.058522: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:08.147689: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:08.148615: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:08.149435: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:08.150167: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:11:08.454714: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.216000e-01  RMSE=6.493073e-01
  per-joint RMSE: 0.9256 0.9150 0.6216 0.4232 0.4005 0.3312
Residual LSTM:  MSE=3.032361e-01      RMSE=5.506688e-01
  per-joint RMSE: 0.7562 0.7896 0.5393 0.3778 0.3415 0.2722
Combined torque MSE=3.032361e-01     RMSE=5.506688e-01
  per-joint RMSE: 0.7562 0.7896 0.5393 0.3778 0.3415 0.2722
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz --H 25 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.json
H=25, n_dof=6, feature_dim=6
X_train: (30756, 25, 6)  Y_train: (30756, 6)
X_test : (10306, 25, 6)  Y_test : (10306, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:11:10.473911: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:11:10.498181: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (30756, 25, 6), Y_train = (30756, 6)
  X_test  = (10306, 25, 6),  Y_test  = (10306, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:11:11.475184: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:11.479648: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:11.480524: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:11.482225: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:11.483095: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:11.483829: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:11.556725: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:11.557556: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:11.558299: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:11.559031: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:11:12.470918: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
97/97 - 2s - 17ms/step - loss: 0.7226 - val_loss: 1.9787
Epoch 2/60
97/97 - 0s - 3ms/step - loss: 0.5227 - val_loss: 1.9681
Epoch 3/60
97/97 - 0s - 3ms/step - loss: 0.4497 - val_loss: 2.0888
Epoch 4/60
97/97 - 0s - 3ms/step - loss: 0.4049 - val_loss: 2.0935
Epoch 5/60
97/97 - 0s - 3ms/step - loss: 0.3660 - val_loss: 2.1152
Epoch 6/60
97/97 - 0s - 3ms/step - loss: 0.3304 - val_loss: 2.2034
Epoch 7/60
97/97 - 0s - 3ms/step - loss: 0.2974 - val_loss: 2.2405
Epoch 8/60
97/97 - 0s - 3ms/step - loss: 0.2630 - val_loss: 2.4243
Epoch 9/60
97/97 - 0s - 3ms/step - loss: 0.2338 - val_loss: 2.1738
Epoch 10/60
97/97 - 0s - 3ms/step - loss: 0.2380 - val_loss: 2.4889
Epoch 11/60
97/97 - 0s - 3ms/step - loss: 0.2087 - val_loss: 2.4282
Epoch 12/60
97/97 - 0s - 3ms/step - loss: 0.2072 - val_loss: 2.3341
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6341
Per-joint RMSE: 0.8979 0.8848 0.6092 0.4277 0.4016 0.3290
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:11:17.244416: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:11:17.269267: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:11:18.123994: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:18.128605: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:18.129400: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:18.131295: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:18.132203: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:18.132942: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:18.215113: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:18.215950: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:18.216778: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:18.217505: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:11:18.522735: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.216000e-01  RMSE=6.493073e-01
  per-joint RMSE: 0.9256 0.9150 0.6216 0.4232 0.4005 0.3312
Residual LSTM:  MSE=4.021084e-01      RMSE=6.341202e-01
  per-joint RMSE: 0.8979 0.8848 0.6092 0.4277 0.4016 0.3290
Combined torque MSE=4.021084e-01     RMSE=6.341202e-01
  per-joint RMSE: 0.8979 0.8848 0.6092 0.4277 0.4016 0.3290
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz --H 25 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (30756, 25, 18)  Y_train: (30756, 6)
X_test : (10306, 25, 18)  Y_test : (10306, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:11:20.534850: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:11:20.558794: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (30756, 25, 18), Y_train = (30756, 6)
  X_test  = (10306, 25, 18),  Y_test  = (10306, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:11:21.618446: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:21.623039: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:21.623827: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:21.625367: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:21.626147: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:21.626884: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:21.704579: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:21.705495: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:21.706389: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:21.707402: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:11:22.674368: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
97/97 - 2s - 17ms/step - loss: 0.2891 - val_loss: 1.1635
Epoch 2/60
97/97 - 0s - 3ms/step - loss: 0.1523 - val_loss: 1.1530
Epoch 3/60
97/97 - 0s - 3ms/step - loss: 0.1317 - val_loss: 1.1532
Epoch 4/60
97/97 - 0s - 3ms/step - loss: 0.1217 - val_loss: 1.1160
Epoch 5/60
97/97 - 0s - 3ms/step - loss: 0.1126 - val_loss: 1.0905
Epoch 6/60
97/97 - 0s - 3ms/step - loss: 0.1055 - val_loss: 1.0853
Epoch 7/60
97/97 - 0s - 3ms/step - loss: 0.1017 - val_loss: 1.0745
Epoch 8/60
97/97 - 0s - 3ms/step - loss: 0.0978 - val_loss: 1.0615
Epoch 9/60
97/97 - 0s - 3ms/step - loss: 0.0952 - val_loss: 1.0495
Epoch 10/60
97/97 - 0s - 3ms/step - loss: 0.0932 - val_loss: 1.0569
Epoch 11/60
97/97 - 0s - 3ms/step - loss: 0.0910 - val_loss: 1.0353
Epoch 12/60
97/97 - 0s - 3ms/step - loss: 0.0889 - val_loss: 1.0342
Epoch 13/60
97/97 - 0s - 3ms/step - loss: 0.0876 - val_loss: 1.0285
Epoch 14/60
97/97 - 0s - 3ms/step - loss: 0.0853 - val_loss: 1.0269
Epoch 15/60
97/97 - 0s - 3ms/step - loss: 0.0838 - val_loss: 1.0371
Epoch 16/60
97/97 - 0s - 3ms/step - loss: 0.0842 - val_loss: 1.0154
Epoch 17/60
97/97 - 0s - 3ms/step - loss: 0.0825 - val_loss: 1.0250
Epoch 18/60
97/97 - 0s - 3ms/step - loss: 0.0817 - val_loss: 1.0293
Epoch 19/60
97/97 - 0s - 3ms/step - loss: 0.0802 - val_loss: 1.0151
Epoch 20/60
97/97 - 0s - 3ms/step - loss: 0.0796 - val_loss: 1.0213
Epoch 21/60
97/97 - 0s - 3ms/step - loss: 0.0783 - val_loss: 1.0375
Epoch 22/60
97/97 - 0s - 3ms/step - loss: 0.0785 - val_loss: 1.0188
Epoch 23/60
97/97 - 0s - 3ms/step - loss: 0.0778 - val_loss: 1.0169
Epoch 24/60
97/97 - 0s - 3ms/step - loss: 0.0773 - val_loss: 1.0059
Epoch 25/60
97/97 - 0s - 3ms/step - loss: 0.0769 - val_loss: 1.0130
Epoch 26/60
97/97 - 0s - 3ms/step - loss: 0.0760 - val_loss: 1.0020
Epoch 27/60
97/97 - 0s - 3ms/step - loss: 0.0755 - val_loss: 0.9937
Epoch 28/60
97/97 - 0s - 3ms/step - loss: 0.0753 - val_loss: 0.9913
Epoch 29/60
97/97 - 0s - 3ms/step - loss: 0.0742 - val_loss: 1.0127
Epoch 30/60
97/97 - 0s - 3ms/step - loss: 0.0737 - val_loss: 1.0123
Epoch 31/60
97/97 - 0s - 3ms/step - loss: 0.0743 - val_loss: 1.0017
Epoch 32/60
97/97 - 0s - 3ms/step - loss: 0.0731 - val_loss: 0.9860
Epoch 33/60
97/97 - 0s - 3ms/step - loss: 0.0731 - val_loss: 0.9687
Epoch 34/60
97/97 - 0s - 3ms/step - loss: 0.0722 - val_loss: 0.9765
Epoch 35/60
97/97 - 0s - 3ms/step - loss: 0.0729 - val_loss: 0.9722
Epoch 36/60
97/97 - 0s - 3ms/step - loss: 0.0719 - val_loss: 0.9636
Epoch 37/60
97/97 - 0s - 3ms/step - loss: 0.0712 - val_loss: 0.9593
Epoch 38/60
97/97 - 0s - 3ms/step - loss: 0.0704 - val_loss: 0.9547
Epoch 39/60
97/97 - 0s - 3ms/step - loss: 0.0704 - val_loss: 0.9435
Epoch 40/60
97/97 - 0s - 3ms/step - loss: 0.0702 - val_loss: 0.9433
Epoch 41/60
97/97 - 0s - 3ms/step - loss: 0.0698 - val_loss: 0.9479
Epoch 42/60
97/97 - 0s - 3ms/step - loss: 0.0697 - val_loss: 0.9368
Epoch 43/60
97/97 - 0s - 3ms/step - loss: 0.0690 - val_loss: 0.9299
Epoch 44/60
97/97 - 0s - 3ms/step - loss: 0.0690 - val_loss: 0.9345
Epoch 45/60
97/97 - 0s - 3ms/step - loss: 0.0688 - val_loss: 0.9290
Epoch 46/60
97/97 - 0s - 3ms/step - loss: 0.0682 - val_loss: 0.9288
Epoch 47/60
97/97 - 0s - 3ms/step - loss: 0.0688 - val_loss: 0.9307
Epoch 48/60
97/97 - 0s - 3ms/step - loss: 0.0679 - val_loss: 0.9551
Epoch 49/60
97/97 - 0s - 3ms/step - loss: 0.0681 - val_loss: 0.9380
Epoch 50/60
97/97 - 0s - 3ms/step - loss: 0.0683 - val_loss: 0.9528
Epoch 51/60
97/97 - 0s - 3ms/step - loss: 0.0670 - val_loss: 0.9333
Epoch 52/60
97/97 - 0s - 3ms/step - loss: 0.0665 - val_loss: 0.9284
Epoch 53/60
97/97 - 0s - 3ms/step - loss: 0.0671 - val_loss: 0.9271
Epoch 54/60
97/97 - 0s - 3ms/step - loss: 0.0668 - val_loss: 0.9305
Epoch 55/60
97/97 - 0s - 3ms/step - loss: 0.0670 - val_loss: 0.9256
Epoch 56/60
97/97 - 0s - 3ms/step - loss: 0.0661 - val_loss: 0.9341
Epoch 57/60
97/97 - 0s - 3ms/step - loss: 0.0656 - val_loss: 0.9349
Epoch 58/60
97/97 - 0s - 3ms/step - loss: 0.0658 - val_loss: 0.9274
Epoch 59/60
97/97 - 0s - 3ms/step - loss: 0.0656 - val_loss: 0.9254
Epoch 60/60
97/97 - 0s - 3ms/step - loss: 0.0650 - val_loss: 0.9188
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5981
Per-joint RMSE: 0.8781 0.8041 0.5776 0.3988 0.3709 0.3132
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:11:40.445545: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:11:40.470227: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:11:41.337210: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:41.341741: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:41.342533: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:41.344197: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:41.344989: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:41.345721: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:41.422647: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:41.423563: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:41.424376: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:41.425104: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:11:41.735066: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.216000e-01  RMSE=6.493073e-01
  per-joint RMSE: 0.9256 0.9150 0.6216 0.4232 0.4005 0.3312
Residual LSTM:  MSE=3.576694e-01      RMSE=5.980547e-01
  per-joint RMSE: 0.8781 0.8041 0.5776 0.3988 0.3709 0.3132
Combined torque MSE=3.576694e-01     RMSE=5.980547e-01
  per-joint RMSE: 0.8781 0.8041 0.5776 0.3988 0.3709 0.3132
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz --H 25 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (30756, 25, 18)  Y_train: (30756, 6)
X_test : (10306, 25, 18)  Y_test : (10306, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:11:43.831511: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:11:43.855269: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (30756, 25, 18), Y_train = (30756, 6)
  X_test  = (10306, 25, 18),  Y_test  = (10306, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:11:44.898986: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:44.904096: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:44.904893: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:44.906515: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:44.907300: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:44.908031: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:44.986846: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:44.987764: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:44.988573: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:11:44.989297: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:11:45.949765: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
97/97 - 2s - 17ms/step - loss: 0.2672 - val_loss: 1.1443
Epoch 2/60
97/97 - 0s - 3ms/step - loss: 0.1343 - val_loss: 1.0587
Epoch 3/60
97/97 - 0s - 3ms/step - loss: 0.1167 - val_loss: 1.0489
Epoch 4/60
97/97 - 0s - 3ms/step - loss: 0.1075 - val_loss: 1.0307
Epoch 5/60
97/97 - 0s - 3ms/step - loss: 0.1021 - val_loss: 1.0081
Epoch 6/60
97/97 - 0s - 3ms/step - loss: 0.0974 - val_loss: 0.9842
Epoch 7/60
97/97 - 0s - 3ms/step - loss: 0.0946 - val_loss: 0.9664
Epoch 8/60
97/97 - 0s - 3ms/step - loss: 0.0921 - val_loss: 0.9511
Epoch 9/60
97/97 - 0s - 3ms/step - loss: 0.0896 - val_loss: 0.9415
Epoch 10/60
97/97 - 0s - 3ms/step - loss: 0.0877 - val_loss: 0.9288
Epoch 11/60
97/97 - 0s - 3ms/step - loss: 0.0863 - val_loss: 0.9109
Epoch 12/60
97/97 - 0s - 3ms/step - loss: 0.0841 - val_loss: 0.9102
Epoch 13/60
97/97 - 0s - 3ms/step - loss: 0.0831 - val_loss: 0.9059
Epoch 14/60
97/97 - 0s - 3ms/step - loss: 0.0813 - val_loss: 0.8922
Epoch 15/60
97/97 - 0s - 3ms/step - loss: 0.0805 - val_loss: 0.8714
Epoch 16/60
97/97 - 0s - 3ms/step - loss: 0.0802 - val_loss: 0.8715
Epoch 17/60
97/97 - 0s - 3ms/step - loss: 0.0788 - val_loss: 0.8730
Epoch 18/60
97/97 - 0s - 3ms/step - loss: 0.0775 - val_loss: 0.8570
Epoch 19/60
97/97 - 0s - 3ms/step - loss: 0.0770 - val_loss: 0.8419
Epoch 20/60
97/97 - 0s - 3ms/step - loss: 0.0764 - val_loss: 0.8365
Epoch 21/60
97/97 - 0s - 3ms/step - loss: 0.0756 - val_loss: 0.8323
Epoch 22/60
97/97 - 0s - 3ms/step - loss: 0.0760 - val_loss: 0.8264
Epoch 23/60
97/97 - 0s - 3ms/step - loss: 0.0745 - val_loss: 0.8209
Epoch 24/60
97/97 - 0s - 3ms/step - loss: 0.0735 - val_loss: 0.8103
Epoch 25/60
97/97 - 0s - 3ms/step - loss: 0.0734 - val_loss: 0.8017
Epoch 26/60
97/97 - 0s - 3ms/step - loss: 0.0733 - val_loss: 0.7980
Epoch 27/60
97/97 - 0s - 3ms/step - loss: 0.0727 - val_loss: 0.7946
Epoch 28/60
97/97 - 0s - 3ms/step - loss: 0.0720 - val_loss: 0.7947
Epoch 29/60
97/97 - 0s - 3ms/step - loss: 0.0718 - val_loss: 0.7875
Epoch 30/60
97/97 - 0s - 3ms/step - loss: 0.0713 - val_loss: 0.7845
Epoch 31/60
97/97 - 0s - 3ms/step - loss: 0.0707 - val_loss: 0.7810
Epoch 32/60
97/97 - 0s - 3ms/step - loss: 0.0700 - val_loss: 0.7774
Epoch 33/60
97/97 - 0s - 3ms/step - loss: 0.0702 - val_loss: 0.7675
Epoch 34/60
97/97 - 0s - 3ms/step - loss: 0.0692 - val_loss: 0.7727
Epoch 35/60
97/97 - 0s - 3ms/step - loss: 0.0690 - val_loss: 0.7705
Epoch 36/60
97/97 - 0s - 3ms/step - loss: 0.0687 - val_loss: 0.7623
Epoch 37/60
97/97 - 0s - 3ms/step - loss: 0.0687 - val_loss: 0.7683
Epoch 38/60
97/97 - 0s - 3ms/step - loss: 0.0688 - val_loss: 0.7726
Epoch 39/60
97/97 - 0s - 3ms/step - loss: 0.0685 - val_loss: 0.7552
Epoch 40/60
97/97 - 0s - 3ms/step - loss: 0.0677 - val_loss: 0.7678
Epoch 41/60
97/97 - 0s - 3ms/step - loss: 0.0680 - val_loss: 0.7466
Epoch 42/60
97/97 - 0s - 3ms/step - loss: 0.0676 - val_loss: 0.7509
Epoch 43/60
97/97 - 0s - 3ms/step - loss: 0.0667 - val_loss: 0.7490
Epoch 44/60
97/97 - 0s - 3ms/step - loss: 0.0665 - val_loss: 0.7454
Epoch 45/60
97/97 - 0s - 3ms/step - loss: 0.0664 - val_loss: 0.7449
Epoch 46/60
97/97 - 0s - 3ms/step - loss: 0.0659 - val_loss: 0.7454
Epoch 47/60
97/97 - 0s - 3ms/step - loss: 0.0657 - val_loss: 0.7566
Epoch 48/60
97/97 - 0s - 3ms/step - loss: 0.0658 - val_loss: 0.7615
Epoch 49/60
97/97 - 0s - 3ms/step - loss: 0.0657 - val_loss: 0.7516
Epoch 50/60
97/97 - 0s - 3ms/step - loss: 0.0650 - val_loss: 0.7377
Epoch 51/60
97/97 - 0s - 3ms/step - loss: 0.0649 - val_loss: 0.7406
Epoch 52/60
97/97 - 0s - 3ms/step - loss: 0.0645 - val_loss: 0.7423
Epoch 53/60
97/97 - 0s - 3ms/step - loss: 0.0641 - val_loss: 0.7461
Epoch 54/60
97/97 - 0s - 3ms/step - loss: 0.0641 - val_loss: 0.7405
Epoch 55/60
97/97 - 0s - 3ms/step - loss: 0.0639 - val_loss: 0.7292
Epoch 56/60
97/97 - 0s - 3ms/step - loss: 0.0643 - val_loss: 0.7389
Epoch 57/60
97/97 - 0s - 3ms/step - loss: 0.0632 - val_loss: 0.7376
Epoch 58/60
97/97 - 0s - 3ms/step - loss: 0.0631 - val_loss: 0.7334
Epoch 59/60
97/97 - 0s - 3ms/step - loss: 0.0625 - val_loss: 0.7479
Epoch 60/60
97/97 - 0s - 3ms/step - loss: 0.0631 - val_loss: 0.7563
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5630
Per-joint RMSE: 0.7740 0.8315 0.5435 0.3572 0.3363 0.2749
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:12:03.518042: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:12:03.542386: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:12:04.405324: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:04.410103: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:04.410972: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:04.412595: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:04.413377: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:04.414108: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:04.495952: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:04.496780: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:04.497519: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:04.498250: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:12:04.806438: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.216000e-01  RMSE=6.493073e-01
  per-joint RMSE: 0.9256 0.9150 0.6216 0.4232 0.4005 0.3312
Residual LSTM:  MSE=3.170092e-01      RMSE=5.630357e-01
  per-joint RMSE: 0.7740 0.8315 0.5435 0.3572 0.3363 0.2749
Combined torque MSE=3.170092e-01     RMSE=5.630357e-01
  per-joint RMSE: 0.7740 0.8315 0.5435 0.3572 0.3363 0.2749
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz --H 50 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.json
H=50, n_dof=6, feature_dim=24
X_train: (29981, 50, 24)  Y_train: (29981, 6)
X_test : (10106, 50, 24)  Y_test : (10106, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:12:06.931221: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:12:06.956229: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (29981, 50, 24), Y_train = (29981, 6)
  X_test  = (10106, 50, 24),  Y_test  = (10106, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:12:08.259749: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:08.264642: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:08.265550: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:08.267329: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:08.268229: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:08.269088: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:08.353178: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:08.354147: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:08.354937: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:08.355724: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:12:09.391441: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
94/94 - 2s - 18ms/step - loss: 0.2717 - val_loss: 0.5320
Epoch 2/60
94/94 - 0s - 4ms/step - loss: 0.1375 - val_loss: 0.5433
Epoch 3/60
94/94 - 0s - 4ms/step - loss: 0.1195 - val_loss: 0.5653
Epoch 4/60
94/94 - 0s - 4ms/step - loss: 0.1105 - val_loss: 0.5530
Epoch 5/60
94/94 - 0s - 4ms/step - loss: 0.1048 - val_loss: 0.5674
Epoch 6/60
94/94 - 0s - 4ms/step - loss: 0.1002 - val_loss: 0.5568
Epoch 7/60
94/94 - 0s - 4ms/step - loss: 0.0968 - val_loss: 0.5478
Epoch 8/60
94/94 - 0s - 4ms/step - loss: 0.0930 - val_loss: 0.5370
Epoch 9/60
94/94 - 0s - 4ms/step - loss: 0.0914 - val_loss: 0.5431
Epoch 10/60
94/94 - 0s - 4ms/step - loss: 0.0895 - val_loss: 0.5458
Epoch 11/60
94/94 - 0s - 4ms/step - loss: 0.0879 - val_loss: 0.5482
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5648
Per-joint RMSE: 0.7909 0.7886 0.5624 0.3710 0.3660 0.2798
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:12:15.267603: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:12:15.293416: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:12:16.143718: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:16.148248: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:16.149033: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:16.150723: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:16.151507: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:16.152242: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:16.232055: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:16.232965: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:16.233715: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:16.234445: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:12:16.544940: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.258488e-01  RMSE=6.525709e-01
  per-joint RMSE: 0.9322 0.9193 0.6223 0.4254 0.4027 0.3323
Residual LSTM:  MSE=3.189484e-01      RMSE=5.647552e-01
  per-joint RMSE: 0.7909 0.7886 0.5624 0.3710 0.3660 0.2798
Combined torque MSE=3.189484e-01     RMSE=5.647552e-01
  per-joint RMSE: 0.7909 0.7886 0.5624 0.3710 0.3660 0.2798
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s0_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz --H 50 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.json
H=50, n_dof=6, feature_dim=6
X_train: (29981, 50, 6)  Y_train: (29981, 6)
X_test : (10106, 50, 6)  Y_test : (10106, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:12:18.623896: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:12:18.647534: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (29981, 50, 6), Y_train = (29981, 6)
  X_test  = (10106, 50, 6),  Y_test  = (10106, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:12:19.702310: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:19.707578: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:19.708449: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:19.710120: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:19.710905: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:19.711647: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:19.790740: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:19.791657: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:19.792395: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:19.793212: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:12:20.722306: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
94/94 - 2s - 18ms/step - loss: 0.6966 - val_loss: 1.1438
Epoch 2/60
94/94 - 0s - 4ms/step - loss: 0.4401 - val_loss: 1.1281
Epoch 3/60
94/94 - 0s - 4ms/step - loss: 0.3456 - val_loss: 1.1852
Epoch 4/60
94/94 - 0s - 4ms/step - loss: 0.3206 - val_loss: 1.1455
Epoch 5/60
94/94 - 0s - 4ms/step - loss: 0.2619 - val_loss: 1.1156
Epoch 6/60
94/94 - 0s - 4ms/step - loss: 0.2106 - val_loss: 1.1149
Epoch 7/60
94/94 - 0s - 4ms/step - loss: 0.1928 - val_loss: 1.1059
Epoch 8/60
94/94 - 0s - 4ms/step - loss: 0.1798 - val_loss: 1.0977
Epoch 9/60
94/94 - 0s - 4ms/step - loss: 0.1712 - val_loss: 1.1156
Epoch 10/60
94/94 - 0s - 4ms/step - loss: 0.1572 - val_loss: 1.0938
Epoch 11/60
94/94 - 0s - 4ms/step - loss: 0.1579 - val_loss: 1.1190
Epoch 12/60
94/94 - 0s - 5ms/step - loss: 0.1490 - val_loss: 1.1561
Epoch 13/60
94/94 - 0s - 4ms/step - loss: 0.1358 - val_loss: 1.1414
Epoch 14/60
94/94 - 0s - 4ms/step - loss: 0.1961 - val_loss: 1.0628
Epoch 15/60
94/94 - 0s - 4ms/step - loss: 0.1653 - val_loss: 1.0748
Epoch 16/60
94/94 - 0s - 4ms/step - loss: 0.1293 - val_loss: 1.1116
Epoch 17/60
94/94 - 0s - 4ms/step - loss: 0.1266 - val_loss: 1.1714
Epoch 18/60
94/94 - 0s - 4ms/step - loss: 0.1206 - val_loss: 1.1544
Epoch 19/60
94/94 - 0s - 4ms/step - loss: 0.1137 - val_loss: 1.1577
Epoch 20/60
94/94 - 0s - 4ms/step - loss: 0.1094 - val_loss: 1.1457
Epoch 21/60
94/94 - 0s - 4ms/step - loss: 0.1110 - val_loss: 1.1328
Epoch 22/60
94/94 - 0s - 4ms/step - loss: 0.1111 - val_loss: 1.1447
Epoch 23/60
94/94 - 0s - 4ms/step - loss: 0.1067 - val_loss: 1.1206
Epoch 24/60
94/94 - 0s - 4ms/step - loss: 0.1075 - val_loss: 1.1160
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6339
Per-joint RMSE: 0.8797 0.8993 0.5977 0.4262 0.4078 0.3508
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:12:31.385621: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:12:31.410212: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:12:32.272772: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:32.277631: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:32.278504: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:32.280259: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:32.281048: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:32.281790: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:32.363913: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:32.364833: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:32.365585: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:32.366382: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:12:32.675161: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.258488e-01  RMSE=6.525709e-01
  per-joint RMSE: 0.9322 0.9193 0.6223 0.4254 0.4027 0.3323
Residual LSTM:  MSE=4.018112e-01      RMSE=6.338858e-01
  per-joint RMSE: 0.8797 0.8993 0.5977 0.4262 0.4078 0.3508
Combined torque MSE=4.018112e-01     RMSE=6.338858e-01
  per-joint RMSE: 0.8797 0.8993 0.5977 0.4262 0.4078 0.3508
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s0_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz --H 50 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (29981, 50, 18)  Y_train: (29981, 6)
X_test : (10106, 50, 18)  Y_test : (10106, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:12:34.831053: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:12:34.855489: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (29981, 50, 18), Y_train = (29981, 6)
  X_test  = (10106, 50, 18),  Y_test  = (10106, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:12:36.008445: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:36.013256: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:36.014052: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:36.015749: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:36.016545: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:36.017290: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:36.101654: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:36.102530: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:36.103425: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:36.104311: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:12:37.061512: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
94/94 - 2s - 18ms/step - loss: 0.2943 - val_loss: 0.6642
Epoch 2/60
94/94 - 0s - 4ms/step - loss: 0.1537 - val_loss: 0.6698
Epoch 3/60
94/94 - 0s - 4ms/step - loss: 0.1332 - val_loss: 0.6675
Epoch 4/60
94/94 - 0s - 4ms/step - loss: 0.1222 - val_loss: 0.6470
Epoch 5/60
94/94 - 0s - 4ms/step - loss: 0.1145 - val_loss: 0.6638
Epoch 6/60
94/94 - 0s - 4ms/step - loss: 0.1097 - val_loss: 0.6672
Epoch 7/60
94/94 - 0s - 4ms/step - loss: 0.1044 - val_loss: 0.6662
Epoch 8/60
94/94 - 0s - 4ms/step - loss: 0.1001 - val_loss: 0.6678
Epoch 9/60
94/94 - 0s - 4ms/step - loss: 0.0974 - val_loss: 0.6530
Epoch 10/60
94/94 - 0s - 4ms/step - loss: 0.0955 - val_loss: 0.6509
Epoch 11/60
94/94 - 0s - 4ms/step - loss: 0.0923 - val_loss: 0.6411
Epoch 12/60
94/94 - 0s - 5ms/step - loss: 0.0910 - val_loss: 0.6422
Epoch 13/60
94/94 - 0s - 4ms/step - loss: 0.0901 - val_loss: 0.6375
Epoch 14/60
94/94 - 0s - 4ms/step - loss: 0.0875 - val_loss: 0.6472
Epoch 15/60
94/94 - 0s - 4ms/step - loss: 0.0868 - val_loss: 0.6394
Epoch 16/60
94/94 - 0s - 4ms/step - loss: 0.0860 - val_loss: 0.6560
Epoch 17/60
94/94 - 0s - 4ms/step - loss: 0.0847 - val_loss: 0.6515
Epoch 18/60
94/94 - 0s - 4ms/step - loss: 0.0842 - val_loss: 0.6528
Epoch 19/60
94/94 - 0s - 4ms/step - loss: 0.0826 - val_loss: 0.6565
Epoch 20/60
94/94 - 0s - 4ms/step - loss: 0.0819 - val_loss: 0.6620
Epoch 21/60
94/94 - 0s - 4ms/step - loss: 0.0806 - val_loss: 0.6698
Epoch 22/60
94/94 - 0s - 4ms/step - loss: 0.0797 - val_loss: 0.6663
Epoch 23/60
94/94 - 0s - 4ms/step - loss: 0.0788 - val_loss: 0.6676
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6042
Per-joint RMSE: 0.8845 0.8192 0.5769 0.4054 0.3762 0.3134
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:12:47.462679: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:12:47.486815: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:12:48.315393: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:48.320242: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:48.321115: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:48.322824: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:48.323617: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:48.324360: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:48.401563: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:48.402410: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:48.403165: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:48.403913: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:12:48.712532: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.258488e-01  RMSE=6.525709e-01
  per-joint RMSE: 0.9322 0.9193 0.6223 0.4254 0.4027 0.3323
Residual LSTM:  MSE=3.650766e-01      RMSE=6.042157e-01
  per-joint RMSE: 0.8845 0.8192 0.5769 0.4054 0.3762 0.3134
Combined torque MSE=3.650766e-01     RMSE=6.042157e-01
  per-joint RMSE: 0.8845 0.8192 0.5769 0.4054 0.3762 0.3134
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s0_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz --H 50 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (29981, 50, 18)  Y_train: (29981, 6)
X_test : (10106, 50, 18)  Y_test : (10106, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:12:50.847770: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:12:50.872811: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (29981, 50, 18), Y_train = (29981, 6)
  X_test  = (10106, 50, 18),  Y_test  = (10106, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:12:52.038242: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:52.042825: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:52.046116: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:52.047780: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:52.048583: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:52.049306: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:52.143021: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:52.144007: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:52.144809: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:12:52.145599: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:12:53.103990: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
94/94 - 2s - 18ms/step - loss: 0.2702 - val_loss: 0.5311
Epoch 2/60
94/94 - 0s - 4ms/step - loss: 0.1356 - val_loss: 0.5115
Epoch 3/60
94/94 - 0s - 4ms/step - loss: 0.1181 - val_loss: 0.4884
Epoch 4/60
94/94 - 0s - 4ms/step - loss: 0.1091 - val_loss: 0.4766
Epoch 5/60
94/94 - 0s - 4ms/step - loss: 0.1042 - val_loss: 0.4703
Epoch 6/60
94/94 - 0s - 4ms/step - loss: 0.0998 - val_loss: 0.4706
Epoch 7/60
94/94 - 0s - 4ms/step - loss: 0.0960 - val_loss: 0.4771
Epoch 8/60
94/94 - 0s - 4ms/step - loss: 0.0933 - val_loss: 0.4718
Epoch 9/60
94/94 - 0s - 4ms/step - loss: 0.0914 - val_loss: 0.4738
Epoch 10/60
94/94 - 0s - 4ms/step - loss: 0.0900 - val_loss: 0.4670
Epoch 11/60
94/94 - 0s - 4ms/step - loss: 0.0875 - val_loss: 0.4779
Epoch 12/60
94/94 - 0s - 5ms/step - loss: 0.0856 - val_loss: 0.4737
Epoch 13/60
94/94 - 0s - 4ms/step - loss: 0.0846 - val_loss: 0.4709
Epoch 14/60
94/94 - 0s - 4ms/step - loss: 0.0830 - val_loss: 0.4755
Epoch 15/60
94/94 - 0s - 4ms/step - loss: 0.0820 - val_loss: 0.4728
Epoch 16/60
94/94 - 0s - 4ms/step - loss: 0.0810 - val_loss: 0.4711
Epoch 17/60
94/94 - 0s - 4ms/step - loss: 0.0798 - val_loss: 0.4727
Epoch 18/60
94/94 - 0s - 4ms/step - loss: 0.0789 - val_loss: 0.4791
Epoch 19/60
94/94 - 0s - 4ms/step - loss: 0.0778 - val_loss: 0.4798
Epoch 20/60
94/94 - 0s - 4ms/step - loss: 0.0776 - val_loss: 0.4791
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5504
Per-joint RMSE: 0.7517 0.8046 0.5516 0.3554 0.3231 0.2647
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:13:02.351968: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:13:02.376672: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:13:03.210363: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:13:03.214845: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:13:03.215721: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:13:03.217480: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:13:03.218269: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:13:03.219018: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:13:03.295694: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:13:03.296623: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:13:03.297365: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:13:03.298104: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:13:03.609978: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.258488e-01  RMSE=6.525709e-01
  per-joint RMSE: 0.9322 0.9193 0.6223 0.4254 0.4027 0.3323
Residual LSTM:  MSE=3.029068e-01      RMSE=5.503697e-01
  per-joint RMSE: 0.7517 0.8046 0.5516 0.3554 0.3231 0.2647
Combined torque MSE=3.029068e-01     RMSE=5.503697e-01
  per-joint RMSE: 0.7517 0.8046 0.5516 0.3554 0.3231 0.2647
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s0_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

