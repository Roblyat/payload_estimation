################################################################################################################################
### RUN: dataset_seed=0 K=84 test_fraction=0.2 val_fraction=0.1                                                              ###
### npz_in=/workspace/shared/data/preprocessed/delan_UR3_Load0_cc_K84_seed0_dataset/delan_UR3_Load0_cc_K84_seed0_dataset.npz ###
################################################################################################################################

#####################
### 1) PREPROCESS ###
#####################

==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_delan_dataset.py --derive_qdd_from_qd True --col_format wide --trajectory_amount 84 --test_fraction 0.2 --val_fraction 0.1 --seed 0 --lowpass_signals True --lowpass_cutoff_hz 10.0 --lowpass_order 4 --lowpass_qdd False --raw_csv /workspace/shared/data/raw/UR3_Load0_cc.csv --out_npz /workspace/shared/data/preprocessed/delan_UR3_Load0_cc_K84_seed0_dataset/delan_UR3_Load0_cc_K84_seed0_dataset.npz' ===
==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Saved: /workspace/shared/data/preprocessed/delan_UR3_Load0_cc_K84_seed0_dataset/delan_UR3_Load0_cc_K84_seed0_dataset.npz
Saved: /workspace/shared/data/preprocessed/delan_UR3_Load0_cc_K84_seed0_dataset/delan_UR3_Load0_cc_K84_seed0_dataset.json
Trajectories: train=59 val=8 test=17
Exists: True


#####################################
### EXPORT RESIDUALS (best DeLaN) ###
#####################################

==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_UR3_Load0_cc_K84_seed0_dataset/delan_UR3_Load0_cc_K84_seed0_dataset.npz --ckpt /workspace/shared/models/delan/UR3_Load0_cc__delanModelStory__K84__seed0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__seed0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.jax --out /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz' ===
==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_UR3_Load0_cc_K84_seed0_dataset/delan_UR3_Load0_cc_K84_seed0_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/UR3_Load0_cc__delanModelStory__K84__seed0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__seed0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.jax
Detected n_dof=6 (seed=3)
2026-01-29 17:48:55.064383: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 59 trajectories
  done 25/59
  done 50/59
  done 59/59

Exporting split=test: 17 trajectories
  done 17/17

Saved residual trajectory dataset: /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.json


##############################
### CONFIG: feat=full H=50 ###
##############################

#########################################
### BUILD LSTM WINDOWS H=50 feat=full ###
#########################################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_npz /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --H 50 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  out_npz     = /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
Saved: /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.json
H=50, n_dof=6, feature_dim=24
X_train: (73101, 50, 24)  Y_train: (73101, 6)
X_test : (12167, 50, 24)  Y_test : (12167, 6)
feature_mode=full


##############################
### TRAIN LSTM seed=0 H=50 ###
##############################

==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 0 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-29 17:49:06.913562: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-29 17:49:06.939484: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-6bdys2tr because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (73101, 50, 24), Y_train = (73101, 6)
  X_test  = (12167, 50, 24),  Y_test  = (12167, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-29 17:49:08.642760: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:49:08.647860: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:49:08.648771: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:49:08.650345: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:49:08.651245: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:49:08.651976: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:49:08.745397: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:49:08.746416: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:49:08.747280: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:49:08.748059: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8431 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-29 17:49:09.907465: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
1028/1028 - 4s - 4ms/step - loss: 0.0878 - val_loss: 0.0453
Epoch 2/120
1028/1028 - 3s - 3ms/step - loss: 0.0468 - val_loss: 0.0389
Epoch 3/120
1028/1028 - 3s - 3ms/step - loss: 0.0403 - val_loss: 0.0377
Epoch 4/120
1028/1028 - 3s - 3ms/step - loss: 0.0356 - val_loss: 0.0357
Epoch 5/120
1028/1028 - 3s - 3ms/step - loss: 0.0332 - val_loss: 0.0390
Epoch 6/120
1028/1028 - 3s - 3ms/step - loss: 0.0315 - val_loss: 0.0395
Epoch 7/120
1028/1028 - 3s - 3ms/step - loss: 0.0302 - val_loss: 0.0358
Epoch 8/120
1028/1028 - 3s - 3ms/step - loss: 0.0291 - val_loss: 0.0350
Epoch 9/120
1028/1028 - 3s - 3ms/step - loss: 0.0286 - val_loss: 0.0383
Epoch 10/120
1028/1028 - 3s - 3ms/step - loss: 0.0279 - val_loss: 0.0331
Epoch 11/120
1028/1028 - 3s - 3ms/step - loss: 0.0271 - val_loss: 0.0341
Epoch 12/120
1028/1028 - 3s - 3ms/step - loss: 0.0264 - val_loss: 0.0327
Epoch 13/120
1028/1028 - 3s - 3ms/step - loss: 0.0261 - val_loss: 0.0345
Epoch 14/120
1028/1028 - 3s - 3ms/step - loss: 0.0256 - val_loss: 0.0322
Epoch 15/120
1028/1028 - 3s - 3ms/step - loss: 0.0254 - val_loss: 0.0326
Epoch 16/120
1028/1028 - 3s - 3ms/step - loss: 0.0249 - val_loss: 0.0350
Epoch 17/120
1028/1028 - 3s - 3ms/step - loss: 0.0248 - val_loss: 0.0335
Epoch 18/120
1028/1028 - 3s - 3ms/step - loss: 0.0242 - val_loss: 0.0328
Epoch 19/120
1028/1028 - 3s - 3ms/step - loss: 0.0239 - val_loss: 0.0343
Epoch 20/120
1028/1028 - 3s - 3ms/step - loss: 0.0237 - val_loss: 0.0337
Epoch 21/120
1028/1028 - 3s - 3ms/step - loss: 0.0234 - val_loss: 0.0323
Epoch 22/120
1028/1028 - 3s - 3ms/step - loss: 0.0232 - val_loss: 0.0336
Epoch 23/120
1028/1028 - 3s - 3ms/step - loss: 0.0230 - val_loss: 0.0333
Epoch 24/120
1028/1028 - 3s - 3ms/step - loss: 0.0228 - val_loss: 0.0336
Epoch 25/120
1028/1028 - 3s - 3ms/step - loss: 0.0226 - val_loss: 0.0373
Epoch 26/120
1028/1028 - 3s - 3ms/step - loss: 0.0223 - val_loss: 0.0338
Epoch 27/120
1028/1028 - 3s - 3ms/step - loss: 0.0221 - val_loss: 0.0334
Epoch 28/120
1028/1028 - 3s - 3ms/step - loss: 0.0219 - val_loss: 0.0345
Epoch 29/120
1028/1028 - 3s - 3ms/step - loss: 0.0218 - val_loss: 0.0337
Epoch 30/120
1028/1028 - 3s - 3ms/step - loss: 0.0215 - val_loss: 0.0336
Epoch 31/120
1028/1028 - 3s - 3ms/step - loss: 0.0215 - val_loss: 0.0364
Epoch 32/120
1028/1028 - 3s - 3ms/step - loss: 0.0213 - val_loss: 0.0335
Epoch 33/120
1028/1028 - 3s - 3ms/step - loss: 0.0213 - val_loss: 0.0345
Epoch 34/120
1028/1028 - 3s - 3ms/step - loss: 0.0210 - val_loss: 0.0351
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1016
Per-joint RMSE: 0.0988 0.1179 0.1363 0.0729 0.0766 0.0922
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_rmse_time.png


#################################
### COMBINED EVAL seed=0 H=50 ###
#################################

==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/scalers_H50.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2 --H 50 --split test --features full --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.jsonl --K 84 --test_fraction 0.2 --seed 0 --dataset_seed 0 --delan_seed 3 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.2834457541991424 --delan_rmse_test 0.31903010197321835' ===
==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-29 17:50:56.305727: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-29 17:50:56.332006: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-zzn50dw3 because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 17
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-29 17:50:57.347257: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:50:57.352476: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:50:57.353365: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:50:57.355191: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:50:57.355974: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:50:57.356714: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:50:57.435190: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:50:57.436053: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:50:57.436802: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:50:57.437554: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8196 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-29 17:50:57.746979: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 17/17

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.028147e-01  RMSE=3.206473e-01
  per-joint RMSE: 0.4275 0.4063 0.2745 0.2495 0.2913 0.2159
Residual LSTM:  MSE=1.031765e-02      RMSE=1.015759e-01
  per-joint RMSE: 0.0988 0.1179 0.1363 0.0729 0.0766 0.0922
Combined torque MSE=1.031765e-02     RMSE=1.015759e-01
  per-joint RMSE: 0.0988 0.1179 0.1363 0.0729 0.0766 0.0922
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_test_H50.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_rmse_time_test_H50.png


##############################
### TRAIN LSTM seed=1 H=50 ###
##############################

==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 1 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-29 17:51:00.001931: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-29 17:51:00.027729: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-j_3r_11p because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (73101, 50, 24), Y_train = (73101, 6)
  X_test  = (12167, 50, 24),  Y_test  = (12167, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-29 17:51:01.753795: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:51:01.758814: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:51:01.759833: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:51:01.762236: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:51:01.763173: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:51:01.764061: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:51:01.849429: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:51:01.850328: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:51:01.851125: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:51:01.851896: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8233 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-29 17:51:03.057336: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
1028/1028 - 4s - 4ms/step - loss: 0.0864 - val_loss: 0.0425
Epoch 2/120
1028/1028 - 3s - 3ms/step - loss: 0.0466 - val_loss: 0.0378
Epoch 3/120
1028/1028 - 3s - 3ms/step - loss: 0.0399 - val_loss: 0.0367
Epoch 4/120
1028/1028 - 3s - 3ms/step - loss: 0.0353 - val_loss: 0.0371
Epoch 5/120
1028/1028 - 3s - 3ms/step - loss: 0.0328 - val_loss: 0.0360
Epoch 6/120
1028/1028 - 3s - 3ms/step - loss: 0.0317 - val_loss: 0.0353
Epoch 7/120
1028/1028 - 3s - 3ms/step - loss: 0.0302 - val_loss: 0.0347
Epoch 8/120
1028/1028 - 3s - 3ms/step - loss: 0.0305 - val_loss: 0.0345
Epoch 9/120
1028/1028 - 3s - 3ms/step - loss: 0.0285 - val_loss: 0.0347
Epoch 10/120
1028/1028 - 3s - 3ms/step - loss: 0.0276 - val_loss: 0.0335
Epoch 11/120
1028/1028 - 3s - 3ms/step - loss: 0.0271 - val_loss: 0.0352
Epoch 12/120
1028/1028 - 3s - 3ms/step - loss: 0.0263 - val_loss: 0.0350
Epoch 13/120
1028/1028 - 3s - 3ms/step - loss: 0.0260 - val_loss: 0.0344
Epoch 14/120
1028/1028 - 3s - 3ms/step - loss: 0.0255 - val_loss: 0.0365
Epoch 15/120
1028/1028 - 3s - 3ms/step - loss: 0.0254 - val_loss: 0.0351
Epoch 16/120
1028/1028 - 3s - 3ms/step - loss: 0.0252 - val_loss: 0.0338
Epoch 17/120
1028/1028 - 3s - 3ms/step - loss: 0.0244 - val_loss: 0.0359
Epoch 18/120
1028/1028 - 3s - 3ms/step - loss: 0.0244 - val_loss: 0.0355
Epoch 19/120
1028/1028 - 3s - 3ms/step - loss: 0.0238 - val_loss: 0.0359
Epoch 20/120
1028/1028 - 3s - 3ms/step - loss: 0.0239 - val_loss: 0.0348
Epoch 21/120
1028/1028 - 3s - 3ms/step - loss: 0.0236 - val_loss: 0.0368
Epoch 22/120
1028/1028 - 3s - 3ms/step - loss: 0.0234 - val_loss: 0.0342
Epoch 23/120
1028/1028 - 3s - 3ms/step - loss: 0.0231 - val_loss: 0.0367
Epoch 24/120
1028/1028 - 3s - 3ms/step - loss: 0.0230 - val_loss: 0.0347
Epoch 25/120
1028/1028 - 3s - 3ms/step - loss: 0.0226 - val_loss: 0.0356
Epoch 26/120
1028/1028 - 3s - 3ms/step - loss: 0.0225 - val_loss: 0.0357
Epoch 27/120
1028/1028 - 3s - 3ms/step - loss: 0.0222 - val_loss: 0.0349
Epoch 28/120
1028/1028 - 3s - 3ms/step - loss: 0.0219 - val_loss: 0.0362
Epoch 29/120
1028/1028 - 3s - 3ms/step - loss: 0.0221 - val_loss: 0.0368
Epoch 30/120
1028/1028 - 3s - 3ms/step - loss: 0.0216 - val_loss: 0.0391
Epoch 31/120
1028/1028 - 3s - 3ms/step - loss: 0.0216 - val_loss: 0.0367
Epoch 32/120
1028/1028 - 3s - 3ms/step - loss: 0.0215 - val_loss: 0.0366
Epoch 33/120
1028/1028 - 3s - 3ms/step - loss: 0.0213 - val_loss: 0.0373
Epoch 34/120
1028/1028 - 3s - 3ms/step - loss: 0.0213 - val_loss: 0.0368
Epoch 35/120
1028/1028 - 3s - 3ms/step - loss: 0.0210 - val_loss: 0.0363
Epoch 36/120
1028/1028 - 3s - 3ms/step - loss: 0.0207 - val_loss: 0.0370
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.0978
Per-joint RMSE: 0.1058 0.1033 0.1253 0.0737 0.0685 0.0985
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_rmse_time.png


#################################
### COMBINED EVAL seed=1 H=50 ###
#################################

==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/scalers_H50.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2 --H 50 --split test --features full --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.jsonl --K 84 --test_fraction 0.2 --seed 1 --dataset_seed 0 --delan_seed 3 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.2834457541991424 --delan_rmse_test 0.31903010197321835' ===
==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-29 17:52:53.790297: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-29 17:52:53.816671: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-owi7dnid because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 17
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-29 17:52:54.849260: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:52:54.854804: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:52:54.855688: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:52:54.857728: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:52:54.858794: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:52:54.859535: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:52:54.940891: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:52:54.941744: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:52:54.942506: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:52:54.943248: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8464 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-29 17:52:55.253528: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 17/17

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.028147e-01  RMSE=3.206473e-01
  per-joint RMSE: 0.4275 0.4063 0.2745 0.2495 0.2913 0.2159
Residual LSTM:  MSE=1.034515e-02      RMSE=1.017111e-01
  per-joint RMSE: 0.1095 0.1096 0.1298 0.0726 0.0736 0.1027
Combined torque MSE=1.034515e-02     RMSE=1.017111e-01
  per-joint RMSE: 0.1095 0.1096 0.1298 0.0726 0.0736 0.1027
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_test_H50.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_rmse_time_test_H50.png


###############################
### CONFIG: feat=full H=100 ###
###############################

##########################################
### BUILD LSTM WINDOWS H=100 feat=full ###
##########################################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_npz /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --H 100 --features full' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  out_npz     = /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  H           = 100
  feature_mode= full
Saved: /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
Saved: /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.json
H=100, n_dof=6, feature_dim=24
X_train: (70151, 100, 24)  Y_train: (70151, 6)
X_test : (11317, 100, 24)  Y_test : (11317, 6)
feature_mode=full


###############################
### TRAIN LSTM seed=0 H=100 ###
###############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 0 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-29 17:52:58.447554: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-29 17:52:58.473987: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-lwu9tuqt because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 100
  din = 24
 dout = 6
  X_train = (70151, 100, 24), Y_train = (70151, 6)
  X_test  = (11317, 100, 24),  Y_test  = (11317, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/scalers_H100.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-29 17:53:00.735995: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:53:00.741314: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:53:00.742299: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:53:00.744061: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:53:00.745056: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:53:00.745853: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:53:00.834736: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:53:00.835662: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:53:00.836706: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:53:00.837552: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8469 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 100, 128)       │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 100, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-29 17:53:02.219614: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
987/987 - 6s - 6ms/step - loss: 0.0869 - val_loss: 0.0473
Epoch 2/120
987/987 - 4s - 4ms/step - loss: 0.0516 - val_loss: 0.0433
Epoch 3/120
987/987 - 4s - 4ms/step - loss: 0.0391 - val_loss: 0.0402
Epoch 4/120
987/987 - 4s - 4ms/step - loss: 0.0362 - val_loss: 0.0424
Epoch 5/120
987/987 - 4s - 4ms/step - loss: 0.0338 - val_loss: 0.0429
Epoch 6/120
987/987 - 4s - 4ms/step - loss: 0.0322 - val_loss: 0.0394
Epoch 7/120
987/987 - 4s - 4ms/step - loss: 0.0312 - val_loss: 0.0395
Epoch 8/120
987/987 - 4s - 4ms/step - loss: 0.0299 - val_loss: 0.0370
Epoch 9/120
987/987 - 4s - 4ms/step - loss: 0.0289 - val_loss: 0.0393
Epoch 10/120
987/987 - 4s - 4ms/step - loss: 0.0284 - val_loss: 0.0382
Epoch 11/120
987/987 - 4s - 4ms/step - loss: 0.0276 - val_loss: 0.0358
Epoch 12/120
987/987 - 5s - 5ms/step - loss: 0.0268 - val_loss: 0.0374
Epoch 13/120
987/987 - 4s - 4ms/step - loss: 0.0268 - val_loss: 0.0373
Epoch 14/120
987/987 - 5s - 5ms/step - loss: 0.0259 - val_loss: 0.0365
Epoch 15/120
987/987 - 4s - 4ms/step - loss: 0.0258 - val_loss: 0.0361
Epoch 16/120
987/987 - 4s - 4ms/step - loss: 0.0255 - val_loss: 0.0333
Epoch 17/120
987/987 - 5s - 5ms/step - loss: 0.0249 - val_loss: 0.0345
Epoch 18/120
987/987 - 4s - 4ms/step - loss: 0.0244 - val_loss: 0.0344
Epoch 19/120
987/987 - 4s - 4ms/step - loss: 0.0240 - val_loss: 0.0353
Epoch 20/120
987/987 - 4s - 4ms/step - loss: 0.0237 - val_loss: 0.0345
Epoch 21/120
987/987 - 4s - 4ms/step - loss: 0.0236 - val_loss: 0.0357
Epoch 22/120
987/987 - 4s - 4ms/step - loss: 0.0233 - val_loss: 0.0349
Epoch 23/120
987/987 - 4s - 4ms/step - loss: 0.0232 - val_loss: 0.0337
Epoch 24/120
987/987 - 4s - 4ms/step - loss: 0.0230 - val_loss: 0.0352
Epoch 25/120
987/987 - 4s - 4ms/step - loss: 0.0227 - val_loss: 0.0348
Epoch 26/120
987/987 - 4s - 4ms/step - loss: 0.0226 - val_loss: 0.0345
Epoch 27/120
987/987 - 4s - 4ms/step - loss: 0.0223 - val_loss: 0.0338
Epoch 28/120
987/987 - 4s - 4ms/step - loss: 0.0226 - val_loss: 0.0324
Epoch 29/120
987/987 - 4s - 4ms/step - loss: 0.0217 - val_loss: 0.0336
Epoch 30/120
987/987 - 4s - 4ms/step - loss: 0.0218 - val_loss: 0.0316
Epoch 31/120
987/987 - 4s - 4ms/step - loss: 0.0217 - val_loss: 0.0335
Epoch 32/120
987/987 - 4s - 4ms/step - loss: 0.0215 - val_loss: 0.0339
Epoch 33/120
987/987 - 4s - 4ms/step - loss: 0.0215 - val_loss: 0.0318
Epoch 34/120
987/987 - 4s - 4ms/step - loss: 0.0212 - val_loss: 0.0325
Epoch 35/120
987/987 - 4s - 4ms/step - loss: 0.0211 - val_loss: 0.0332
Epoch 36/120
987/987 - 4s - 4ms/step - loss: 0.0210 - val_loss: 0.0348
Epoch 37/120
987/987 - 4s - 4ms/step - loss: 0.0208 - val_loss: 0.0334
Epoch 38/120
987/987 - 4s - 4ms/step - loss: 0.0207 - val_loss: 0.0338
Epoch 39/120
987/987 - 4s - 4ms/step - loss: 0.0206 - val_loss: 0.0337
Epoch 40/120
987/987 - 4s - 4ms/step - loss: 0.0205 - val_loss: 0.0316
Epoch 41/120
987/987 - 4s - 4ms/step - loss: 0.0204 - val_loss: 0.0326
Epoch 42/120
987/987 - 4s - 4ms/step - loss: 0.0204 - val_loss: 0.0316
Epoch 43/120
987/987 - 4s - 4ms/step - loss: 0.0201 - val_loss: 0.0317
Epoch 44/120
987/987 - 4s - 4ms/step - loss: 0.0202 - val_loss: 0.0316
Epoch 45/120
987/987 - 4s - 4ms/step - loss: 0.0201 - val_loss: 0.0321
Epoch 46/120
987/987 - 4s - 4ms/step - loss: 0.0200 - val_loss: 0.0329
Epoch 47/120
987/987 - 4s - 4ms/step - loss: 0.0198 - val_loss: 0.0327
Epoch 48/120
987/987 - 4s - 4ms/step - loss: 0.0202 - val_loss: 0.0327
Epoch 49/120
987/987 - 4s - 4ms/step - loss: 0.0199 - val_loss: 0.0344
Epoch 50/120
987/987 - 4s - 4ms/step - loss: 0.0196 - val_loss: 0.0330
Epoch 51/120
987/987 - 4s - 4ms/step - loss: 0.0196 - val_loss: 0.0323
Epoch 52/120
987/987 - 4s - 4ms/step - loss: 0.0195 - val_loss: 0.0327
Epoch 53/120
987/987 - 4s - 4ms/step - loss: 0.0199 - val_loss: 0.0328
Epoch 54/120
987/987 - 4s - 4ms/step - loss: 0.0196 - val_loss: 0.0325
Epoch 55/120
987/987 - 4s - 4ms/step - loss: 0.0195 - val_loss: 0.0332
Epoch 56/120
987/987 - 4s - 4ms/step - loss: 0.0193 - val_loss: 0.0328
Epoch 57/120
987/987 - 4s - 4ms/step - loss: 0.0190 - val_loss: 0.0327
Epoch 58/120
987/987 - 4s - 4ms/step - loss: 0.0193 - val_loss: 0.0339
Epoch 59/120
987/987 - 4s - 4ms/step - loss: 0.0191 - val_loss: 0.0322
Epoch 60/120
987/987 - 4s - 4ms/step - loss: 0.0193 - val_loss: 0.0321
Epoch 61/120
987/987 - 4s - 4ms/step - loss: 0.0189 - val_loss: 0.0322
Epoch 62/120
987/987 - 4s - 4ms/step - loss: 0.0188 - val_loss: 0.0316
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_train_test_H100.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1040
Per-joint RMSE: 0.1037 0.1191 0.1377 0.0723 0.0764 0.0997
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=0 H=100 ###
##################################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/scalers_H100.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2 --H 100 --split test --features full --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.jsonl --K 84 --test_fraction 0.2 --seed 0 --dataset_seed 0 --delan_seed 3 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.2834457541991424 --delan_rmse_test 0.31903010197321835' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-29 17:57:34.012548: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-29 17:57:34.039139: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-ekj30e5b because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 100
 n_traj       = 17
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-29 17:57:35.055807: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:57:35.060843: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:57:35.061630: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:57:35.063294: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:57:35.064080: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:57:35.065511: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:57:35.146705: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:57:35.147537: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:57:35.148341: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:57:35.149120: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8311 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-29 17:57:35.453249: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 17/17

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.021842e-01  RMSE=3.196626e-01
  per-joint RMSE: 0.4287 0.4048 0.2689 0.2471 0.2928 0.2152
Residual LSTM:  MSE=1.082067e-02      RMSE=1.040224e-01
  per-joint RMSE: 0.1037 0.1191 0.1377 0.0723 0.0764 0.0997
Combined torque MSE=1.082067e-02     RMSE=1.040224e-01
  per-joint RMSE: 0.1037 0.1191 0.1377 0.0723 0.0764 0.0997
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_test_H100.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_test_H100.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/combined_predictions_test_H100.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_rmse_time_test_H100.png


###############################
### TRAIN LSTM seed=1 H=100 ###
###############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 1 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-29 17:57:37.736963: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-29 17:57:37.762990: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-07qb7meq because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 100
  din = 24
 dout = 6
  X_train = (70151, 100, 24), Y_train = (70151, 6)
  X_test  = (11317, 100, 24),  Y_test  = (11317, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/scalers_H100.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-29 17:57:40.039728: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:57:40.045303: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:57:40.046113: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:57:40.047780: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:57:40.048697: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:57:40.049456: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:57:40.146996: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:57:40.147897: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:57:40.148783: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 17:57:40.149579: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8306 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 100, 128)       │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 100, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-29 17:57:41.540595: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
987/987 - 6s - 6ms/step - loss: 0.0882 - val_loss: 0.0490
Epoch 2/120
987/987 - 4s - 4ms/step - loss: 0.0501 - val_loss: 0.0470
Epoch 3/120
987/987 - 4s - 4ms/step - loss: 0.0393 - val_loss: 0.0474
Epoch 4/120
987/987 - 4s - 4ms/step - loss: 0.0357 - val_loss: 0.0453
Epoch 5/120
987/987 - 4s - 4ms/step - loss: 0.0339 - val_loss: 0.0436
Epoch 6/120
987/987 - 4s - 4ms/step - loss: 0.0316 - val_loss: 0.0423
Epoch 7/120
987/987 - 4s - 4ms/step - loss: 0.0304 - val_loss: 0.0399
Epoch 8/120
987/987 - 4s - 4ms/step - loss: 0.0295 - val_loss: 0.0390
Epoch 9/120
987/987 - 4s - 4ms/step - loss: 0.0299 - val_loss: 0.0364
Epoch 10/120
987/987 - 4s - 4ms/step - loss: 0.0278 - val_loss: 0.0369
Epoch 11/120
987/987 - 4s - 4ms/step - loss: 0.0275 - val_loss: 0.0373
Epoch 12/120
987/987 - 4s - 4ms/step - loss: 0.0266 - val_loss: 0.0349
Epoch 13/120
987/987 - 4s - 4ms/step - loss: 0.0258 - val_loss: 0.0353
Epoch 14/120
987/987 - 4s - 4ms/step - loss: 0.0255 - val_loss: 0.0334
Epoch 15/120
987/987 - 4s - 4ms/step - loss: 0.0252 - val_loss: 0.0338
Epoch 16/120
987/987 - 4s - 4ms/step - loss: 0.0251 - val_loss: 0.0342
Epoch 17/120
987/987 - 4s - 4ms/step - loss: 0.0247 - val_loss: 0.0341
Epoch 18/120
987/987 - 4s - 4ms/step - loss: 0.0245 - val_loss: 0.0328
Epoch 19/120
987/987 - 4s - 4ms/step - loss: 0.0237 - val_loss: 0.0333
Epoch 20/120
987/987 - 4s - 4ms/step - loss: 0.0238 - val_loss: 0.0334
Epoch 21/120
987/987 - 4s - 4ms/step - loss: 0.0234 - val_loss: 0.0329
Epoch 22/120
987/987 - 4s - 4ms/step - loss: 0.0233 - val_loss: 0.0311
Epoch 23/120
987/987 - 4s - 4ms/step - loss: 0.0230 - val_loss: 0.0325
Epoch 24/120
987/987 - 4s - 4ms/step - loss: 0.0229 - val_loss: 0.0346
Epoch 25/120
987/987 - 4s - 4ms/step - loss: 0.0231 - val_loss: 0.0335
Epoch 26/120
987/987 - 4s - 4ms/step - loss: 0.0222 - val_loss: 0.0317
Epoch 27/120
987/987 - 4s - 4ms/step - loss: 0.0221 - val_loss: 0.0320
Epoch 28/120
987/987 - 4s - 4ms/step - loss: 0.0219 - val_loss: 0.0314
Epoch 29/120
987/987 - 4s - 4ms/step - loss: 0.0218 - val_loss: 0.0316
Epoch 30/120
987/987 - 4s - 4ms/step - loss: 0.0219 - val_loss: 0.0313
Epoch 31/120
987/987 - 4s - 4ms/step - loss: 0.0216 - val_loss: 0.0308
Epoch 32/120
987/987 - 4s - 4ms/step - loss: 0.0215 - val_loss: 0.0303
Epoch 33/120
987/987 - 4s - 4ms/step - loss: 0.0213 - val_loss: 0.0313
Epoch 34/120
987/987 - 4s - 4ms/step - loss: 0.0212 - val_loss: 0.0320
Epoch 35/120
987/987 - 4s - 4ms/step - loss: 0.0211 - val_loss: 0.0312
Epoch 36/120
987/987 - 4s - 4ms/step - loss: 0.0210 - val_loss: 0.0320
Epoch 37/120
987/987 - 4s - 4ms/step - loss: 0.0208 - val_loss: 0.0308
Epoch 38/120
987/987 - 4s - 4ms/step - loss: 0.0207 - val_loss: 0.0307
Epoch 39/120
987/987 - 4s - 4ms/step - loss: 0.0208 - val_loss: 0.0329
Epoch 40/120
987/987 - 4s - 4ms/step - loss: 0.0204 - val_loss: 0.0319
Epoch 41/120
987/987 - 4s - 4ms/step - loss: 0.0205 - val_loss: 0.0329
Epoch 42/120
987/987 - 4s - 4ms/step - loss: 0.0203 - val_loss: 0.0330
Epoch 43/120
987/987 - 4s - 4ms/step - loss: 0.0203 - val_loss: 0.0320
Epoch 44/120
987/987 - 4s - 4ms/step - loss: 0.0201 - val_loss: 0.0318
Epoch 45/120
987/987 - 4s - 4ms/step - loss: 0.0200 - val_loss: 0.0328
Epoch 46/120
987/987 - 4s - 4ms/step - loss: 0.0199 - val_loss: 0.0325
Epoch 47/120
987/987 - 4s - 4ms/step - loss: 0.0197 - val_loss: 0.0329
Epoch 48/120
987/987 - 4s - 4ms/step - loss: 0.0197 - val_loss: 0.0327
Epoch 49/120
987/987 - 4s - 4ms/step - loss: 0.0198 - val_loss: 0.0315
Epoch 50/120
987/987 - 4s - 4ms/step - loss: 0.0196 - val_loss: 0.0318
Epoch 51/120
987/987 - 4s - 4ms/step - loss: 0.0194 - val_loss: 0.0341
Epoch 52/120
987/987 - 4s - 4ms/step - loss: 0.0194 - val_loss: 0.0313
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_train_test_H100.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1005
Per-joint RMSE: 0.1043 0.1129 0.1285 0.0749 0.0693 0.1000
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=1 H=100 ###
##################################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/scalers_H100.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2 --H 100 --split test --features full --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.jsonl --K 84 --test_fraction 0.2 --seed 1 --dataset_seed 0 --delan_seed 3 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.2834457541991424 --delan_rmse_test 0.31903010197321835' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-29 18:01:30.450249: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-29 18:01:30.476667: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-gn_cssm5 because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 100
 n_traj       = 17
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-29 18:01:31.523456: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:01:31.529165: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:01:31.530137: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:01:31.532128: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:01:31.533069: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:01:31.533864: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:01:31.615159: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:01:31.615983: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:01:31.616731: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:01:31.617457: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8568 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-29 18:01:31.926903: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 17/17

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.021842e-01  RMSE=3.196626e-01
  per-joint RMSE: 0.4287 0.4048 0.2689 0.2471 0.2928 0.2152
Residual LSTM:  MSE=1.009311e-02      RMSE=1.004645e-01
  per-joint RMSE: 0.1043 0.1129 0.1285 0.0749 0.0693 0.1000
Combined torque MSE=1.009311e-02     RMSE=1.004645e-01
  per-joint RMSE: 0.1043 0.1129 0.1285 0.0749 0.0693 0.1000
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_test_H100.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_test_H100.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/combined_predictions_test_H100.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_rmse_time_test_H100.png


###############################
### CONFIG: feat=state H=50 ###
###############################

##########################################
### BUILD LSTM WINDOWS H=50 feat=state ###
##########################################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_npz /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --H 50 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  out_npz     = /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
Saved: /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.json
H=50, n_dof=6, feature_dim=18
X_train: (73101, 50, 18)  Y_train: (73101, 6)
X_test : (12167, 50, 18)  Y_test : (12167, 6)
feature_mode=state


##############################
### TRAIN LSTM seed=0 H=50 ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 0 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-29 18:01:34.783069: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-29 18:01:34.808737: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-b69ox98k because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (73101, 50, 18), Y_train = (73101, 6)
  X_test  = (12167, 50, 18),  Y_test  = (12167, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-29 18:01:36.410502: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:01:36.415794: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:01:36.416712: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:01:36.418434: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:01:36.419345: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:01:36.420297: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:01:36.507303: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:01:36.508195: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:01:36.508995: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:01:36.509785: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8559 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-29 18:01:37.644996: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
1028/1028 - 4s - 4ms/step - loss: 0.0931 - val_loss: 0.0488
Epoch 2/120
1028/1028 - 3s - 3ms/step - loss: 0.0502 - val_loss: 0.0425
Epoch 3/120
1028/1028 - 3s - 3ms/step - loss: 0.0410 - val_loss: 0.0402
Epoch 4/120
1028/1028 - 3s - 3ms/step - loss: 0.0362 - val_loss: 0.0408
Epoch 5/120
1028/1028 - 3s - 3ms/step - loss: 0.0337 - val_loss: 0.0394
Epoch 6/120
1028/1028 - 3s - 3ms/step - loss: 0.0332 - val_loss: 0.0398
Epoch 7/120
1028/1028 - 3s - 3ms/step - loss: 0.0307 - val_loss: 0.0389
Epoch 8/120
1028/1028 - 3s - 3ms/step - loss: 0.0303 - val_loss: 0.0376
Epoch 9/120
1028/1028 - 3s - 3ms/step - loss: 0.0286 - val_loss: 0.0398
Epoch 10/120
1028/1028 - 3s - 3ms/step - loss: 0.0281 - val_loss: 0.0397
Epoch 11/120
1028/1028 - 3s - 3ms/step - loss: 0.0274 - val_loss: 0.0392
Epoch 12/120
1028/1028 - 3s - 3ms/step - loss: 0.0273 - val_loss: 0.0364
Epoch 13/120
1028/1028 - 3s - 3ms/step - loss: 0.0266 - val_loss: 0.0371
Epoch 14/120
1028/1028 - 3s - 3ms/step - loss: 0.0264 - val_loss: 0.0391
Epoch 15/120
1028/1028 - 3s - 3ms/step - loss: 0.0258 - val_loss: 0.0351
Epoch 16/120
1028/1028 - 3s - 3ms/step - loss: 0.0255 - val_loss: 0.0371
Epoch 17/120
1028/1028 - 3s - 3ms/step - loss: 0.0252 - val_loss: 0.0378
Epoch 18/120
1028/1028 - 3s - 3ms/step - loss: 0.0252 - val_loss: 0.0364
Epoch 19/120
1028/1028 - 3s - 3ms/step - loss: 0.0247 - val_loss: 0.0355
Epoch 20/120
1028/1028 - 3s - 3ms/step - loss: 0.0244 - val_loss: 0.0355
Epoch 21/120
1028/1028 - 3s - 3ms/step - loss: 0.0242 - val_loss: 0.0346
Epoch 22/120
1028/1028 - 3s - 3ms/step - loss: 0.0236 - val_loss: 0.0347
Epoch 23/120
1028/1028 - 3s - 3ms/step - loss: 0.0236 - val_loss: 0.0346
Epoch 24/120
1028/1028 - 3s - 3ms/step - loss: 0.0234 - val_loss: 0.0352
Epoch 25/120
1028/1028 - 3s - 3ms/step - loss: 0.0231 - val_loss: 0.0357
Epoch 26/120
1028/1028 - 3s - 3ms/step - loss: 0.0231 - val_loss: 0.0360
Epoch 27/120
1028/1028 - 3s - 3ms/step - loss: 0.0229 - val_loss: 0.0367
Epoch 28/120
1028/1028 - 3s - 3ms/step - loss: 0.0226 - val_loss: 0.0340
Epoch 29/120
1028/1028 - 3s - 3ms/step - loss: 0.0227 - val_loss: 0.0353
Epoch 30/120
1028/1028 - 3s - 3ms/step - loss: 0.0228 - val_loss: 0.0360
Epoch 31/120
1028/1028 - 3s - 3ms/step - loss: 0.0221 - val_loss: 0.0333
Epoch 32/120
1028/1028 - 3s - 3ms/step - loss: 0.0220 - val_loss: 0.0358
Epoch 33/120
1028/1028 - 3s - 3ms/step - loss: 0.0219 - val_loss: 0.0341
Epoch 34/120
1028/1028 - 3s - 3ms/step - loss: 0.0216 - val_loss: 0.0363
Epoch 35/120
1028/1028 - 3s - 3ms/step - loss: 0.0216 - val_loss: 0.0354
Epoch 36/120
1028/1028 - 3s - 3ms/step - loss: 0.0216 - val_loss: 0.0361
Epoch 37/120
1028/1028 - 3s - 3ms/step - loss: 0.0213 - val_loss: 0.0381
Epoch 38/120
1028/1028 - 3s - 3ms/step - loss: 0.0212 - val_loss: 0.0363
Epoch 39/120
1028/1028 - 3s - 3ms/step - loss: 0.0212 - val_loss: 0.0372
Epoch 40/120
1028/1028 - 3s - 3ms/step - loss: 0.0212 - val_loss: 0.0338
Epoch 41/120
1028/1028 - 3s - 3ms/step - loss: 0.0211 - val_loss: 0.0350
Epoch 42/120
1028/1028 - 3s - 3ms/step - loss: 0.0208 - val_loss: 0.0336
Epoch 43/120
1028/1028 - 3s - 3ms/step - loss: 0.0207 - val_loss: 0.0347
Epoch 44/120
1028/1028 - 3s - 3ms/step - loss: 0.0206 - val_loss: 0.0360
Epoch 45/120
1028/1028 - 3s - 3ms/step - loss: 0.0207 - val_loss: 0.0346
Epoch 46/120
1028/1028 - 3s - 3ms/step - loss: 0.0205 - val_loss: 0.0358
Epoch 47/120
1028/1028 - 3s - 3ms/step - loss: 0.0204 - val_loss: 0.0367
Epoch 48/120
1028/1028 - 3s - 3ms/step - loss: 0.0203 - val_loss: 0.0370
Epoch 49/120
1028/1028 - 3s - 3ms/step - loss: 0.0204 - val_loss: 0.0372
Epoch 50/120
1028/1028 - 3s - 3ms/step - loss: 0.0201 - val_loss: 0.0367
Epoch 51/120
1028/1028 - 3s - 3ms/step - loss: 0.0199 - val_loss: 0.0355
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.0992
Per-joint RMSE: 0.0950 0.1122 0.1256 0.0770 0.0818 0.0950
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_rmse_time.png


#################################
### COMBINED EVAL seed=0 H=50 ###
#################################

==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/scalers_H50.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2 --H 50 --split test --features state --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.jsonl --K 84 --test_fraction 0.2 --seed 0 --dataset_seed 0 --delan_seed 3 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.2834457541991424 --delan_rmse_test 0.31903010197321835' ===
==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-29 18:04:13.636129: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-29 18:04:13.662758: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-uwnpvpp3 because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 17
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-29 18:04:14.693962: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:04:14.698982: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:04:14.699777: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:04:14.701566: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:04:14.702361: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:04:14.703098: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:04:14.783644: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:04:14.784600: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:04:14.785443: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:04:14.786175: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8573 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-29 18:04:15.088742: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 17/17

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.028147e-01  RMSE=3.206473e-01
  per-joint RMSE: 0.4275 0.4063 0.2745 0.2495 0.2913 0.2159
Residual LSTM:  MSE=9.837807e-03      RMSE=9.918572e-02
  per-joint RMSE: 0.0950 0.1122 0.1256 0.0770 0.0818 0.0950
Combined torque MSE=9.837807e-03     RMSE=9.918572e-02
  per-joint RMSE: 0.0950 0.1122 0.1256 0.0770 0.0818 0.0950
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_test_H50.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_rmse_time_test_H50.png


##############################
### TRAIN LSTM seed=1 H=50 ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 1 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-29 18:04:17.313232: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-29 18:04:17.338974: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-0kmcdmou because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (73101, 50, 18), Y_train = (73101, 6)
  X_test  = (12167, 50, 18),  Y_test  = (12167, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-29 18:04:18.913192: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:04:18.918163: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:04:18.918961: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:04:18.920664: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:04:18.921532: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:04:18.922328: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:04:19.007593: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:04:19.008567: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:04:19.009533: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:04:19.010386: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8573 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-29 18:04:20.095533: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
1028/1028 - 4s - 4ms/step - loss: 0.0907 - val_loss: 0.0473
Epoch 2/120
1028/1028 - 3s - 3ms/step - loss: 0.0501 - val_loss: 0.0417
Epoch 3/120
1028/1028 - 3s - 3ms/step - loss: 0.0416 - val_loss: 0.0407
Epoch 4/120
1028/1028 - 3s - 3ms/step - loss: 0.0366 - val_loss: 0.0396
Epoch 5/120
1028/1028 - 3s - 3ms/step - loss: 0.0341 - val_loss: 0.0408
Epoch 6/120
1028/1028 - 3s - 3ms/step - loss: 0.0324 - val_loss: 0.0390
Epoch 7/120
1028/1028 - 3s - 3ms/step - loss: 0.0308 - val_loss: 0.0383
Epoch 8/120
1028/1028 - 3s - 3ms/step - loss: 0.0296 - val_loss: 0.0378
Epoch 9/120
1028/1028 - 3s - 3ms/step - loss: 0.0289 - val_loss: 0.0369
Epoch 10/120
1028/1028 - 3s - 3ms/step - loss: 0.0282 - val_loss: 0.0366
Epoch 11/120
1028/1028 - 3s - 3ms/step - loss: 0.0278 - val_loss: 0.0365
Epoch 12/120
1028/1028 - 3s - 3ms/step - loss: 0.0271 - val_loss: 0.0370
Epoch 13/120
1028/1028 - 3s - 3ms/step - loss: 0.0267 - val_loss: 0.0375
Epoch 14/120
1028/1028 - 3s - 3ms/step - loss: 0.0271 - val_loss: 0.0362
Epoch 15/120
1028/1028 - 3s - 3ms/step - loss: 0.0259 - val_loss: 0.0338
Epoch 16/120
1028/1028 - 3s - 3ms/step - loss: 0.0254 - val_loss: 0.0349
Epoch 17/120
1028/1028 - 3s - 3ms/step - loss: 0.0253 - val_loss: 0.0331
Epoch 18/120
1028/1028 - 3s - 3ms/step - loss: 0.0250 - val_loss: 0.0337
Epoch 19/120
1028/1028 - 3s - 3ms/step - loss: 0.0247 - val_loss: 0.0349
Epoch 20/120
1028/1028 - 3s - 3ms/step - loss: 0.0247 - val_loss: 0.0336
Epoch 21/120
1028/1028 - 3s - 3ms/step - loss: 0.0241 - val_loss: 0.0345
Epoch 22/120
1028/1028 - 3s - 3ms/step - loss: 0.0240 - val_loss: 0.0345
Epoch 23/120
1028/1028 - 3s - 3ms/step - loss: 0.0236 - val_loss: 0.0348
Epoch 24/120
1028/1028 - 3s - 3ms/step - loss: 0.0233 - val_loss: 0.0349
Epoch 25/120
1028/1028 - 3s - 3ms/step - loss: 0.0233 - val_loss: 0.0341
Epoch 26/120
1028/1028 - 3s - 3ms/step - loss: 0.0231 - val_loss: 0.0338
Epoch 27/120
1028/1028 - 3s - 3ms/step - loss: 0.0229 - val_loss: 0.0340
Epoch 28/120
1028/1028 - 3s - 3ms/step - loss: 0.0227 - val_loss: 0.0336
Epoch 29/120
1028/1028 - 3s - 3ms/step - loss: 0.0225 - val_loss: 0.0335
Epoch 30/120
1028/1028 - 3s - 3ms/step - loss: 0.0221 - val_loss: 0.0339
Epoch 31/120
1028/1028 - 3s - 3ms/step - loss: 0.0223 - val_loss: 0.0333
Epoch 32/120
1028/1028 - 3s - 3ms/step - loss: 0.0221 - val_loss: 0.0351
Epoch 33/120
1028/1028 - 3s - 3ms/step - loss: 0.0218 - val_loss: 0.0315
Epoch 34/120
1028/1028 - 3s - 3ms/step - loss: 0.0217 - val_loss: 0.0316
Epoch 35/120
1028/1028 - 3s - 3ms/step - loss: 0.0215 - val_loss: 0.0330
Epoch 36/120
1028/1028 - 3s - 3ms/step - loss: 0.0215 - val_loss: 0.0326
Epoch 37/120
1028/1028 - 3s - 3ms/step - loss: 0.0214 - val_loss: 0.0327
Epoch 38/120
1028/1028 - 3s - 3ms/step - loss: 0.0213 - val_loss: 0.0326
Epoch 39/120
1028/1028 - 3s - 3ms/step - loss: 0.0212 - val_loss: 0.0312
Epoch 40/120
1028/1028 - 3s - 3ms/step - loss: 0.0210 - val_loss: 0.0323
Epoch 41/120
1028/1028 - 3s - 3ms/step - loss: 0.0208 - val_loss: 0.0324
Epoch 42/120
1028/1028 - 3s - 3ms/step - loss: 0.0207 - val_loss: 0.0314
Epoch 43/120
1028/1028 - 3s - 3ms/step - loss: 0.0208 - val_loss: 0.0328
Epoch 44/120
1028/1028 - 3s - 3ms/step - loss: 0.0206 - val_loss: 0.0321
Epoch 45/120
1028/1028 - 3s - 3ms/step - loss: 0.0205 - val_loss: 0.0331
Epoch 46/120
1028/1028 - 3s - 3ms/step - loss: 0.0205 - val_loss: 0.0328
Epoch 47/120
1028/1028 - 3s - 3ms/step - loss: 0.0204 - val_loss: 0.0315
Epoch 48/120
1028/1028 - 3s - 3ms/step - loss: 0.0202 - val_loss: 0.0318
Epoch 49/120
1028/1028 - 3s - 3ms/step - loss: 0.0201 - val_loss: 0.0329
Epoch 50/120
1028/1028 - 3s - 3ms/step - loss: 0.0201 - val_loss: 0.0329
Epoch 51/120
1028/1028 - 3s - 3ms/step - loss: 0.0202 - val_loss: 0.0319
Epoch 52/120
1028/1028 - 3s - 3ms/step - loss: 0.0199 - val_loss: 0.0323
Epoch 53/120
1028/1028 - 3s - 3ms/step - loss: 0.0198 - val_loss: 0.0326
Epoch 54/120
1028/1028 - 3s - 3ms/step - loss: 0.0197 - val_loss: 0.0324
Epoch 55/120
1028/1028 - 3s - 3ms/step - loss: 0.0197 - val_loss: 0.0338
Epoch 56/120
1028/1028 - 3s - 3ms/step - loss: 0.0197 - val_loss: 0.0325
Epoch 57/120
1028/1028 - 3s - 3ms/step - loss: 0.0195 - val_loss: 0.0345
Epoch 58/120
1028/1028 - 3s - 3ms/step - loss: 0.0194 - val_loss: 0.0349
Epoch 59/120
1028/1028 - 3s - 3ms/step - loss: 0.0195 - val_loss: 0.0329
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1023
Per-joint RMSE: 0.1036 0.1083 0.1322 0.0800 0.0818 0.0987
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_rmse_time.png


#################################
### COMBINED EVAL seed=1 H=50 ###
#################################

==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/scalers_H50.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2 --H 50 --split test --features state --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.jsonl --K 84 --test_fraction 0.2 --seed 1 --dataset_seed 0 --delan_seed 3 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.2834457541991424 --delan_rmse_test 0.31903010197321835' ===
==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-29 18:07:19.712455: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-29 18:07:19.739026: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-qjl6tgl5 because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 17
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-29 18:07:20.779300: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:07:20.784391: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:07:20.785348: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:07:20.786985: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:07:20.787779: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:07:20.788606: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:07:20.869267: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:07:20.870115: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:07:20.870868: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:07:20.871599: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8684 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-29 18:07:21.179654: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 17/17

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.028147e-01  RMSE=3.206473e-01
  per-joint RMSE: 0.4275 0.4063 0.2745 0.2495 0.2913 0.2159
Residual LSTM:  MSE=1.045690e-02      RMSE=1.022590e-01
  per-joint RMSE: 0.1036 0.1083 0.1322 0.0800 0.0818 0.0987
Combined torque MSE=1.045690e-02     RMSE=1.022590e-01
  per-joint RMSE: 0.1036 0.1083 0.1322 0.0800 0.0818 0.0987
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_test_H50.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_rmse_time_test_H50.png


################################
### CONFIG: feat=state H=100 ###
################################

###########################################
### BUILD LSTM WINDOWS H=100 feat=state ###
###########################################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_npz /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --H 100 --features state' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  out_npz     = /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  H           = 100
  feature_mode= state
Saved: /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
Saved: /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.json
H=100, n_dof=6, feature_dim=18
X_train: (70151, 100, 18)  Y_train: (70151, 6)
X_test : (11317, 100, 18)  Y_test : (11317, 6)
feature_mode=state


###############################
### TRAIN LSTM seed=0 H=100 ###
###############################

==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 0 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-29 18:07:24.152420: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-29 18:07:24.178531: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-z0yyfrmg because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 100
  din = 18
 dout = 6
  X_train = (70151, 100, 18), Y_train = (70151, 6)
  X_test  = (11317, 100, 18),  Y_test  = (11317, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/scalers_H100.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-29 18:07:26.269239: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:07:26.274701: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:07:26.275698: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:07:26.277486: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:07:26.278556: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:07:26.280032: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:07:26.368654: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:07:26.369703: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:07:26.370555: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:07:26.371342: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8675 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 100, 128)       │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 100, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-29 18:07:27.638598: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
987/987 - 6s - 6ms/step - loss: 0.0937 - val_loss: 0.0512
Epoch 2/120
987/987 - 4s - 4ms/step - loss: 0.0498 - val_loss: 0.0452
Epoch 3/120
987/987 - 4s - 4ms/step - loss: 0.0407 - val_loss: 0.0402
Epoch 4/120
987/987 - 4s - 4ms/step - loss: 0.0365 - val_loss: 0.0470
Epoch 5/120
987/987 - 4s - 4ms/step - loss: 0.0346 - val_loss: 0.0403
Epoch 6/120
987/987 - 4s - 4ms/step - loss: 0.0336 - val_loss: 0.0382
Epoch 7/120
987/987 - 4s - 4ms/step - loss: 0.0307 - val_loss: 0.0370
Epoch 8/120
987/987 - 4s - 4ms/step - loss: 0.0299 - val_loss: 0.0362
Epoch 9/120
987/987 - 4s - 4ms/step - loss: 0.0292 - val_loss: 0.0362
Epoch 10/120
987/987 - 4s - 4ms/step - loss: 0.0284 - val_loss: 0.0342
Epoch 11/120
987/987 - 4s - 4ms/step - loss: 0.0277 - val_loss: 0.0363
Epoch 12/120
987/987 - 4s - 4ms/step - loss: 0.0273 - val_loss: 0.0330
Epoch 13/120
987/987 - 4s - 4ms/step - loss: 0.0267 - val_loss: 0.0314
Epoch 14/120
987/987 - 4s - 4ms/step - loss: 0.0262 - val_loss: 0.0350
Epoch 15/120
987/987 - 4s - 4ms/step - loss: 0.0260 - val_loss: 0.0321
Epoch 16/120
987/987 - 4s - 4ms/step - loss: 0.0256 - val_loss: 0.0360
Epoch 17/120
987/987 - 4s - 4ms/step - loss: 0.0252 - val_loss: 0.0337
Epoch 18/120
987/987 - 4s - 4ms/step - loss: 0.0250 - val_loss: 0.0328
Epoch 19/120
987/987 - 4s - 4ms/step - loss: 0.0248 - val_loss: 0.0321
Epoch 20/120
987/987 - 4s - 4ms/step - loss: 0.0243 - val_loss: 0.0333
Epoch 21/120
987/987 - 4s - 4ms/step - loss: 0.0244 - val_loss: 0.0336
Epoch 22/120
987/987 - 4s - 4ms/step - loss: 0.0243 - val_loss: 0.0330
Epoch 23/120
987/987 - 4s - 4ms/step - loss: 0.0236 - val_loss: 0.0318
Epoch 24/120
987/987 - 4s - 4ms/step - loss: 0.0235 - val_loss: 0.0344
Epoch 25/120
987/987 - 4s - 4ms/step - loss: 0.0235 - val_loss: 0.0334
Epoch 26/120
987/987 - 4s - 4ms/step - loss: 0.0232 - val_loss: 0.0317
Epoch 27/120
987/987 - 4s - 4ms/step - loss: 0.0229 - val_loss: 0.0316
Epoch 28/120
987/987 - 4s - 4ms/step - loss: 0.0228 - val_loss: 0.0323
Epoch 29/120
987/987 - 4s - 4ms/step - loss: 0.0226 - val_loss: 0.0323
Epoch 30/120
987/987 - 4s - 4ms/step - loss: 0.0225 - val_loss: 0.0317
Epoch 31/120
987/987 - 4s - 4ms/step - loss: 0.0224 - val_loss: 0.0304
Epoch 32/120
987/987 - 4s - 4ms/step - loss: 0.0222 - val_loss: 0.0306
Epoch 33/120
987/987 - 4s - 4ms/step - loss: 0.0221 - val_loss: 0.0318
Epoch 34/120
987/987 - 4s - 5ms/step - loss: 0.0218 - val_loss: 0.0319
Epoch 35/120
987/987 - 4s - 4ms/step - loss: 0.0218 - val_loss: 0.0315
Epoch 36/120
987/987 - 4s - 4ms/step - loss: 0.0218 - val_loss: 0.0315
Epoch 37/120
987/987 - 4s - 4ms/step - loss: 0.0216 - val_loss: 0.0310
Epoch 38/120
987/987 - 4s - 4ms/step - loss: 0.0214 - val_loss: 0.0308
Epoch 39/120
987/987 - 4s - 4ms/step - loss: 0.0213 - val_loss: 0.0309
Epoch 40/120
987/987 - 4s - 4ms/step - loss: 0.0213 - val_loss: 0.0322
Epoch 41/120
987/987 - 4s - 4ms/step - loss: 0.0211 - val_loss: 0.0315
Epoch 42/120
987/987 - 4s - 4ms/step - loss: 0.0209 - val_loss: 0.0317
Epoch 43/120
987/987 - 4s - 4ms/step - loss: 0.0208 - val_loss: 0.0320
Epoch 44/120
987/987 - 4s - 4ms/step - loss: 0.0209 - val_loss: 0.0329
Epoch 45/120
987/987 - 4s - 4ms/step - loss: 0.0207 - val_loss: 0.0320
Epoch 46/120
987/987 - 4s - 4ms/step - loss: 0.0210 - val_loss: 0.0335
Epoch 47/120
987/987 - 4s - 4ms/step - loss: 0.0204 - val_loss: 0.0332
Epoch 48/120
987/987 - 4s - 4ms/step - loss: 0.0207 - val_loss: 0.0328
Epoch 49/120
987/987 - 4s - 4ms/step - loss: 0.0205 - val_loss: 0.0323
Epoch 50/120
987/987 - 4s - 4ms/step - loss: 0.0203 - val_loss: 0.0332
Epoch 51/120
987/987 - 4s - 4ms/step - loss: 0.0202 - val_loss: 0.0334
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_train_test_H100.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1000
Per-joint RMSE: 0.0998 0.1120 0.1237 0.0754 0.0872 0.0941
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=0 H=100 ###
##################################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/scalers_H100.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2 --H 100 --split test --features state --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.jsonl --K 84 --test_fraction 0.2 --seed 0 --dataset_seed 0 --delan_seed 3 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.2834457541991424 --delan_rmse_test 0.31903010197321835' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-29 18:11:09.403032: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-29 18:11:09.429222: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-ddw7rpjx because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 100
 n_traj       = 17
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-29 18:11:10.451721: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:11:10.456739: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:11:10.457527: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:11:10.459309: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:11:10.460175: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:11:10.460910: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:11:10.537799: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:11:10.538639: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:11:10.539463: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:11:10.540191: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8376 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-29 18:11:10.843928: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 17/17

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.021842e-01  RMSE=3.196626e-01
  per-joint RMSE: 0.4287 0.4048 0.2689 0.2471 0.2928 0.2152
Residual LSTM:  MSE=9.990625e-03      RMSE=9.995311e-02
  per-joint RMSE: 0.0998 0.1120 0.1237 0.0754 0.0872 0.0941
Combined torque MSE=9.990625e-03     RMSE=9.995311e-02
  per-joint RMSE: 0.0998 0.1120 0.1237 0.0754 0.0872 0.0941
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_test_H100.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_test_H100.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/combined_predictions_test_H100.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_rmse_time_test_H100.png


###############################
### TRAIN LSTM seed=1 H=100 ###
###############################

==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 1 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-29 18:11:13.040291: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-29 18:11:13.066169: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-c_fetpxy because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 100
  din = 18
 dout = 6
  X_train = (70151, 100, 18), Y_train = (70151, 6)
  X_test  = (11317, 100, 18),  Y_test  = (11317, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/scalers_H100.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-29 18:11:15.103757: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:11:15.108921: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:11:15.109872: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:11:15.111470: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:11:15.112403: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:11:15.113279: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:11:15.198298: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:11:15.199281: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:11:15.200078: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:11:15.200866: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8384 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 100, 128)       │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 100, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-29 18:11:16.475552: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
987/987 - 6s - 6ms/step - loss: 0.0935 - val_loss: 0.0504
Epoch 2/120
987/987 - 4s - 4ms/step - loss: 0.0536 - val_loss: 0.0411
Epoch 3/120
987/987 - 4s - 4ms/step - loss: 0.0412 - val_loss: 0.0385
Epoch 4/120
987/987 - 4s - 4ms/step - loss: 0.0371 - val_loss: 0.0382
Epoch 5/120
987/987 - 4s - 4ms/step - loss: 0.0348 - val_loss: 0.0362
Epoch 6/120
987/987 - 4s - 4ms/step - loss: 0.0328 - val_loss: 0.0343
Epoch 7/120
987/987 - 4s - 4ms/step - loss: 0.0327 - val_loss: 0.0360
Epoch 8/120
987/987 - 4s - 4ms/step - loss: 0.0307 - val_loss: 0.0361
Epoch 9/120
987/987 - 4s - 4ms/step - loss: 0.0295 - val_loss: 0.0325
Epoch 10/120
987/987 - 4s - 4ms/step - loss: 0.0289 - val_loss: 0.0331
Epoch 11/120
987/987 - 4s - 4ms/step - loss: 0.0281 - val_loss: 0.0335
Epoch 12/120
987/987 - 4s - 4ms/step - loss: 0.0274 - val_loss: 0.0323
Epoch 13/120
987/987 - 4s - 4ms/step - loss: 0.0272 - val_loss: 0.0327
Epoch 14/120
987/987 - 4s - 4ms/step - loss: 0.0265 - val_loss: 0.0329
Epoch 15/120
987/987 - 4s - 4ms/step - loss: 0.0262 - val_loss: 0.0321
Epoch 16/120
987/987 - 4s - 4ms/step - loss: 0.0259 - val_loss: 0.0306
Epoch 17/120
987/987 - 4s - 4ms/step - loss: 0.0254 - val_loss: 0.0317
Epoch 18/120
987/987 - 4s - 4ms/step - loss: 0.0250 - val_loss: 0.0326
Epoch 19/120
987/987 - 4s - 4ms/step - loss: 0.0248 - val_loss: 0.0323
Epoch 20/120
987/987 - 4s - 4ms/step - loss: 0.0245 - val_loss: 0.0309
Epoch 21/120
987/987 - 4s - 4ms/step - loss: 0.0242 - val_loss: 0.0315
Epoch 22/120
987/987 - 4s - 4ms/step - loss: 0.0243 - val_loss: 0.0304
Epoch 23/120
987/987 - 4s - 4ms/step - loss: 0.0240 - val_loss: 0.0308
Epoch 24/120
987/987 - 4s - 4ms/step - loss: 0.0238 - val_loss: 0.0312
Epoch 25/120
987/987 - 4s - 4ms/step - loss: 0.0237 - val_loss: 0.0297
Epoch 26/120
987/987 - 4s - 4ms/step - loss: 0.0234 - val_loss: 0.0313
Epoch 27/120
987/987 - 4s - 4ms/step - loss: 0.0230 - val_loss: 0.0316
Epoch 28/120
987/987 - 4s - 4ms/step - loss: 0.0229 - val_loss: 0.0325
Epoch 29/120
987/987 - 4s - 4ms/step - loss: 0.0228 - val_loss: 0.0306
Epoch 30/120
987/987 - 4s - 4ms/step - loss: 0.0226 - val_loss: 0.0293
Epoch 31/120
987/987 - 4s - 4ms/step - loss: 0.0225 - val_loss: 0.0318
Epoch 32/120
987/987 - 4s - 4ms/step - loss: 0.0226 - val_loss: 0.0328
Epoch 33/120
987/987 - 4s - 4ms/step - loss: 0.0221 - val_loss: 0.0315
Epoch 34/120
987/987 - 4s - 4ms/step - loss: 0.0222 - val_loss: 0.0329
Epoch 35/120
987/987 - 4s - 4ms/step - loss: 0.0219 - val_loss: 0.0303
Epoch 36/120
987/987 - 4s - 4ms/step - loss: 0.0233 - val_loss: 0.0338
Epoch 37/120
987/987 - 4s - 4ms/step - loss: 0.0221 - val_loss: 0.0316
Epoch 38/120
987/987 - 4s - 4ms/step - loss: 0.0217 - val_loss: 0.0324
Epoch 39/120
987/987 - 4s - 4ms/step - loss: 0.0215 - val_loss: 0.0307
Epoch 40/120
987/987 - 4s - 4ms/step - loss: 0.0213 - val_loss: 0.0329
Epoch 41/120
987/987 - 4s - 4ms/step - loss: 0.0212 - val_loss: 0.0309
Epoch 42/120
987/987 - 4s - 4ms/step - loss: 0.0213 - val_loss: 0.0307
Epoch 43/120
987/987 - 4s - 4ms/step - loss: 0.0213 - val_loss: 0.0310
Epoch 44/120
987/987 - 4s - 4ms/step - loss: 0.0215 - val_loss: 0.0305
Epoch 45/120
987/987 - 4s - 4ms/step - loss: 0.0209 - val_loss: 0.0303
Epoch 46/120
987/987 - 4s - 4ms/step - loss: 0.0210 - val_loss: 0.0312
Epoch 47/120
987/987 - 4s - 4ms/step - loss: 0.0209 - val_loss: 0.0306
Epoch 48/120
987/987 - 4s - 4ms/step - loss: 0.0206 - val_loss: 0.0322
Epoch 49/120
987/987 - 4s - 4ms/step - loss: 0.0207 - val_loss: 0.0322
Epoch 50/120
987/987 - 4s - 4ms/step - loss: 0.0206 - val_loss: 0.0312
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_train_test_H100.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.0996
Per-joint RMSE: 0.1038 0.1073 0.1261 0.0751 0.0800 0.0965
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=1 H=100 ###
##################################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/scalers_H100.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2 --H 100 --split test --features state --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.jsonl --K 84 --test_fraction 0.2 --seed 1 --dataset_seed 0 --delan_seed 3 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.2834457541991424 --delan_rmse_test 0.31903010197321835' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-29 18:14:54.248829: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-29 18:14:54.275473: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-5iidbse9 because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_cc__delanModelStory__K84__residual__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 100
 n_traj       = 17
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-29 18:14:55.306364: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:14:55.311360: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:14:55.312226: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:14:55.313933: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:14:55.314716: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:14:55.315446: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:14:55.390324: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:14:55.391259: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:14:55.392000: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-29 18:14:55.392722: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8391 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-29 18:14:55.695360: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 17/17

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.021842e-01  RMSE=3.196626e-01
  per-joint RMSE: 0.4287 0.4048 0.2689 0.2471 0.2928 0.2152
Residual LSTM:  MSE=9.927486e-03      RMSE=9.963677e-02
  per-joint RMSE: 0.1038 0.1073 0.1261 0.0751 0.0800 0.0965
Combined torque MSE=9.927486e-03     RMSE=9.963677e-02
  per-joint RMSE: 0.1038 0.1073 0.1261 0.0751 0.0800 0.0965
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_test_H100.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_test_H100.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260129_184850.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/combined_predictions_test_H100.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_cc__delanModelStory__20260129_184850/UR3_Load0_cc__delanModelStory__K84__d0__delan_jax_struct_s3_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_rmse_time_test_H100.png

