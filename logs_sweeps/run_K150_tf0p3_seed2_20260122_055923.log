#################################################################################################################
### RUN: K=150 test_fraction=0.3 seed=2                                                                       ###
### npz_in=/workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed2_dataset.npz ###
#################################################################################################################

#####################
### 1) PREPROCESS ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_delan_dataset.py --qdd True --col_format wide --trajectory_amount 150 --test_fraction 0.3 --seed 2 --raw_csv /workspace/shared/data/raw/delan_UR3_Load0_combined_26.csv --out_npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed2_dataset.npz' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Saved: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed2_dataset.npz
Trajectories: train=105 test=45
Exists: True

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=0                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz                                ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed2_dataset.npz -t structured -s 0 -r 0 --hp_preset fast_debug --epochs 400 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400.jax' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 400, 'lagrangian_type': <function structured_lagrangian_fn at 0x7b50f55101f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed2_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed2_dataset.npz
   dt ≈ 0.02208891656001752
  dof = 6
  Train trajectories = 105
  Test trajectories  = 45
  Train samples = 62323
  Test samples  = 24560
################################################

2026-01-22 09:26:07.010910: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400 | type=structured | dof=6
################################################
2026-01-22 09:26:10.143296: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:26:10.143332: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:26:10.143338: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:26:10.143366: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:26:10.143371: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:26:10.143386: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:26:10.143428: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:26:10.143434: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:26:10.143450: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:26:10.143457: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.1s, Loss=9.60e+00, Inv=9.60e+00, For=1.46e+02, Power=2.44e+00
  [eval] test_mse=1.704e+00  (n=24560)
Epoch 00050: Time=  15.6s, Loss=2.86e+00, Inv=2.86e+00, For=1.34e+02, Power=1.36e+00
Epoch 00100: Time=  24.3s, Loss=2.60e+00, Inv=2.60e+00, For=1.32e+02, Power=1.28e+00
Epoch 00150: Time=  32.7s, Loss=2.48e+00, Inv=2.48e+00, For=1.70e+02, Power=1.25e+00
Epoch 00200: Time=  41.7s, Loss=2.42e+00, Inv=2.42e+00, For=1.91e+02, Power=1.23e+00
  [eval] test_mse=1.332e+00  (n=24560)
Epoch 00250: Time=  51.0s, Loss=2.38e+00, Inv=2.38e+00, For=2.11e+02, Power=1.22e+00
Epoch 00300: Time=  59.0s, Loss=2.35e+00, Inv=2.35e+00, For=2.36e+02, Power=1.21e+00
Epoch 00350: Time=  67.1s, Loss=2.33e+00, Inv=2.33e+00, For=2.70e+02, Power=1.20e+00
Epoch 00400: Time=  74.9s, Loss=2.32e+00, Inv=2.32e+00, For=3.03e+02, Power=1.20e+00
  [eval] test_mse=1.378e+00  (n=24560)
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400
Torque MSE  = 2.297e-01
Torque RMSE = 4.792e-01
Per-joint MSE : 3.096e-01 6.867e-01 1.740e-01 7.943e-02 7.483e-02 5.352e-02
Per-joint RMSE: 5.564e-01 8.287e-01 4.171e-01 2.818e-01 2.736e-01 2.313e-01
Comp Time per Sample = 1.510e-08s / 66221059.4Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed2_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed2_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep400.jax
Detected n_dof=6 (seed=0)
2026-01-22 09:27:27.263631: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 105 trajectories
2026-01-22 09:27:28.560647: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:27:28.560659: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:27:30.146789: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:27:30.146804: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:27:31.619734: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:27:32.784285: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/105
2026-01-22 09:27:34.006255: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:27:34.006291: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:27:34.006296: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 50/105
2026-01-22 09:27:35.531028: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:27:36.767155: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 75/105
2026-01-22 09:27:38.167017: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 100/105
  done 105/105

Exporting split=test: 45 trajectories
  done 25/45
  done 45/45

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400.npz --H 25 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400.json
H=25, n_dof=6, feature_dim=24
X_train: (60727, 25, 24)  Y_train: (60727, 6)
X_test : (23900, 25, 24)  Y_test : (23900, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:27:41.786906: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:27:41.811231: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep400.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (60727, 25, 24), Y_train = (60727, 6)
  X_test  = (23900, 25, 24),  Y_test  = (23900, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:27:43.037895: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:27:43.042655: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:27:43.043574: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:27:43.045363: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:27:43.046287: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:27:43.047170: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:27:43.133094: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:27:43.134066: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:27:43.134860: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:27:43.135637: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8975 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:27:44.116132: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
190/190 - 2s - 10ms/step - loss: 0.2246 - val_loss: 0.2895
Epoch 2/100
190/190 - 0s - 3ms/step - loss: 0.1291 - val_loss: 0.2471
Epoch 3/100
190/190 - 0s - 3ms/step - loss: 0.1114 - val_loss: 0.2313
Epoch 4/100
190/190 - 0s - 3ms/step - loss: 0.1017 - val_loss: 0.2206
Epoch 5/100
190/190 - 0s - 3ms/step - loss: 0.0955 - val_loss: 0.2090
Epoch 6/100
190/190 - 1s - 3ms/step - loss: 0.0911 - val_loss: 0.1993
Epoch 7/100
190/190 - 0s - 3ms/step - loss: 0.0866 - val_loss: 0.1956
Epoch 8/100
190/190 - 0s - 3ms/step - loss: 0.0842 - val_loss: 0.1936
Epoch 9/100
190/190 - 0s - 3ms/step - loss: 0.0806 - val_loss: 0.1869
Epoch 10/100
190/190 - 0s - 3ms/step - loss: 0.0788 - val_loss: 0.1852
Epoch 11/100
190/190 - 0s - 3ms/step - loss: 0.0786 - val_loss: 0.1824
Epoch 12/100
190/190 - 0s - 3ms/step - loss: 0.0766 - val_loss: 0.1788
Epoch 13/100
190/190 - 0s - 3ms/step - loss: 0.0744 - val_loss: 0.1740
Epoch 14/100
190/190 - 0s - 3ms/step - loss: 0.0731 - val_loss: 0.1693
Epoch 15/100
190/190 - 0s - 3ms/step - loss: 0.0714 - val_loss: 0.1688
Epoch 16/100
190/190 - 0s - 3ms/step - loss: 0.0703 - val_loss: 0.1668
Epoch 17/100
190/190 - 0s - 3ms/step - loss: 0.0693 - val_loss: 0.1652
Epoch 18/100
190/190 - 0s - 3ms/step - loss: 0.0686 - val_loss: 0.1633
Epoch 19/100
190/190 - 0s - 3ms/step - loss: 0.0671 - val_loss: 0.1633
Epoch 20/100
190/190 - 0s - 3ms/step - loss: 0.0669 - val_loss: 0.1608
Epoch 21/100
190/190 - 0s - 3ms/step - loss: 0.0647 - val_loss: 0.1579
Epoch 22/100
190/190 - 0s - 3ms/step - loss: 0.0637 - val_loss: 0.1597
Epoch 23/100
190/190 - 0s - 3ms/step - loss: 0.0635 - val_loss: 0.1613
Epoch 24/100
190/190 - 0s - 3ms/step - loss: 0.0623 - val_loss: 0.1583
Epoch 25/100
190/190 - 0s - 3ms/step - loss: 0.0619 - val_loss: 0.1593
Epoch 26/100
190/190 - 0s - 3ms/step - loss: 0.0609 - val_loss: 0.1512
Epoch 27/100
190/190 - 0s - 2ms/step - loss: 0.0606 - val_loss: 0.1543
Epoch 28/100
190/190 - 0s - 3ms/step - loss: 0.0603 - val_loss: 0.1528
Epoch 29/100
190/190 - 0s - 3ms/step - loss: 0.0589 - val_loss: 0.1560
Epoch 30/100
190/190 - 0s - 3ms/step - loss: 0.0583 - val_loss: 0.1566
Epoch 31/100
190/190 - 0s - 2ms/step - loss: 0.0576 - val_loss: 0.1557
Epoch 32/100
190/190 - 0s - 2ms/step - loss: 0.0575 - val_loss: 0.1540
Epoch 33/100
190/190 - 0s - 2ms/step - loss: 0.0564 - val_loss: 0.1567
Epoch 34/100
190/190 - 0s - 2ms/step - loss: 0.0559 - val_loss: 0.1529
Epoch 35/100
190/190 - 0s - 3ms/step - loss: 0.0548 - val_loss: 0.1550
Epoch 36/100
190/190 - 0s - 3ms/step - loss: 0.0544 - val_loss: 0.1559
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3571
Per-joint RMSE: 0.4373 0.5907 0.3114 0.2077 0.2211 0.1896
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:28:03.286046: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:28:03.310894: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 09:28:04.158746: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:04.163261: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:04.164138: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:04.165753: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:04.166543: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:04.167278: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:04.248670: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:04.249501: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:04.250246: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:04.250979: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:28:04.544919: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/45
  done 45/45

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.320830e-01  RMSE=4.817499e-01
  per-joint RMSE: 0.5596 0.8338 0.4168 0.2836 0.2752 0.2330
Residual LSTM:  MSE=1.275225e-01      RMSE=3.571030e-01
  per-joint RMSE: 0.4373 0.5907 0.3114 0.2077 0.2211 0.1896
Combined torque MSE=1.275225e-01     RMSE=3.571030e-01
  per-joint RMSE: 0.4373 0.5907 0.3114 0.2077 0.2211 0.1896
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400.npz --H 25 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400.json
H=25, n_dof=6, feature_dim=6
X_train: (60727, 25, 6)  Y_train: (60727, 6)
X_test : (23900, 25, 6)  Y_test : (23900, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:28:07.064627: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:28:07.089847: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep400.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (60727, 25, 6), Y_train = (60727, 6)
  X_test  = (23900, 25, 6),  Y_test  = (23900, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:28:08.139100: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:08.143597: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:08.144471: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:08.146099: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:08.146885: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:08.147632: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:08.224177: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:08.225016: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:08.225927: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:08.226662: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:28:09.140540: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
190/190 - 2s - 10ms/step - loss: 0.7595 - val_loss: 0.7039
Epoch 2/100
190/190 - 0s - 3ms/step - loss: 0.5242 - val_loss: 0.6525
Epoch 3/100
190/190 - 0s - 3ms/step - loss: 0.4283 - val_loss: 0.6316
Epoch 4/100
190/190 - 0s - 3ms/step - loss: 0.3819 - val_loss: 0.5752
Epoch 5/100
190/190 - 0s - 2ms/step - loss: 0.3398 - val_loss: 0.5971
Epoch 6/100
190/190 - 1s - 3ms/step - loss: 0.2880 - val_loss: 0.7346
Epoch 7/100
190/190 - 0s - 3ms/step - loss: 0.2676 - val_loss: 0.6869
Epoch 8/100
190/190 - 0s - 3ms/step - loss: 0.2589 - val_loss: 0.6335
Epoch 9/100
190/190 - 0s - 3ms/step - loss: 0.2277 - val_loss: 0.6721
Epoch 10/100
190/190 - 0s - 3ms/step - loss: 0.2045 - val_loss: 0.7140
Epoch 11/100
190/190 - 0s - 2ms/step - loss: 0.2099 - val_loss: 0.6393
Epoch 12/100
190/190 - 0s - 3ms/step - loss: 0.1819 - val_loss: 0.6596
Epoch 13/100
190/190 - 0s - 3ms/step - loss: 0.1557 - val_loss: 0.6484
Epoch 14/100
190/190 - 0s - 2ms/step - loss: 0.1555 - val_loss: 0.6568
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4073
Per-joint RMSE: 0.5235 0.6433 0.3506 0.2479 0.2492 0.2472
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:28:17.604246: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:28:17.629242: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 09:28:18.479828: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:18.484398: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:18.485196: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:18.487119: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:18.488004: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:18.488745: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:18.579672: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:18.580513: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:18.581242: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:18.581978: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:28:18.873325: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/45
  done 45/45

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.320830e-01  RMSE=4.817499e-01
  per-joint RMSE: 0.5596 0.8338 0.4168 0.2836 0.2752 0.2330
Residual LSTM:  MSE=1.659146e-01      RMSE=4.073261e-01
  per-joint RMSE: 0.5235 0.6433 0.3506 0.2479 0.2492 0.2472
Combined torque MSE=1.659146e-01     RMSE=4.073261e-01
  per-joint RMSE: 0.5235 0.6433 0.3506 0.2479 0.2492 0.2472
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400.npz --H 25 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400.json
H=25, n_dof=6, feature_dim=18
X_train: (60727, 25, 18)  Y_train: (60727, 6)
X_test : (23900, 25, 18)  Y_test : (23900, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:28:21.487232: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:28:21.510897: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep400.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (60727, 25, 18), Y_train = (60727, 6)
  X_test  = (23900, 25, 18),  Y_test  = (23900, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:28:22.680900: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:22.686302: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:22.687232: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:22.689019: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:22.689925: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:22.690865: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:22.782426: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:22.783324: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:22.784201: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:22.784989: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:28:23.735305: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
190/190 - 2s - 10ms/step - loss: 0.2448 - val_loss: 0.3489
Epoch 2/100
190/190 - 0s - 3ms/step - loss: 0.1547 - val_loss: 0.3216
Epoch 3/100
190/190 - 1s - 3ms/step - loss: 0.1351 - val_loss: 0.3094
Epoch 4/100
190/190 - 0s - 3ms/step - loss: 0.1235 - val_loss: 0.3055
Epoch 5/100
190/190 - 0s - 3ms/step - loss: 0.1161 - val_loss: 0.2902
Epoch 6/100
190/190 - 1s - 3ms/step - loss: 0.1102 - val_loss: 0.2777
Epoch 7/100
190/190 - 0s - 3ms/step - loss: 0.1057 - val_loss: 0.2807
Epoch 8/100
190/190 - 0s - 3ms/step - loss: 0.1031 - val_loss: 0.2768
Epoch 9/100
190/190 - 0s - 3ms/step - loss: 0.1004 - val_loss: 0.2686
Epoch 10/100
190/190 - 0s - 3ms/step - loss: 0.0972 - val_loss: 0.2659
Epoch 11/100
190/190 - 0s - 3ms/step - loss: 0.0953 - val_loss: 0.2649
Epoch 12/100
190/190 - 0s - 3ms/step - loss: 0.0932 - val_loss: 0.2638
Epoch 13/100
190/190 - 0s - 3ms/step - loss: 0.0910 - val_loss: 0.2685
Epoch 14/100
190/190 - 0s - 3ms/step - loss: 0.0911 - val_loss: 0.2583
Epoch 15/100
190/190 - 0s - 3ms/step - loss: 0.0892 - val_loss: 0.2636
Epoch 16/100
190/190 - 0s - 2ms/step - loss: 0.0867 - val_loss: 0.2620
Epoch 17/100
190/190 - 0s - 2ms/step - loss: 0.0860 - val_loss: 0.2587
Epoch 18/100
190/190 - 0s - 2ms/step - loss: 0.0840 - val_loss: 0.2598
Epoch 19/100
190/190 - 0s - 2ms/step - loss: 0.0825 - val_loss: 0.2619
Epoch 20/100
190/190 - 0s - 3ms/step - loss: 0.0827 - val_loss: 0.2649
Epoch 21/100
190/190 - 0s - 2ms/step - loss: 0.0802 - val_loss: 0.2642
Epoch 22/100
190/190 - 0s - 3ms/step - loss: 0.0798 - val_loss: 0.2645
Epoch 23/100
190/190 - 0s - 3ms/step - loss: 0.0801 - val_loss: 0.2657
Epoch 24/100
190/190 - 0s - 2ms/step - loss: 0.0780 - val_loss: 0.2674
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3957
Per-joint RMSE: 0.5019 0.6364 0.3454 0.2320 0.2482 0.2190
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:28:37.094607: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:28:37.119481: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 09:28:37.975838: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:37.980435: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:37.981327: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:37.983254: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:37.984056: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:37.984799: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:38.060930: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:38.061780: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:38.062527: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:38.063260: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:28:38.357683: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/45
  done 45/45

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.320830e-01  RMSE=4.817499e-01
  per-joint RMSE: 0.5596 0.8338 0.4168 0.2836 0.2752 0.2330
Residual LSTM:  MSE=1.565989e-01      RMSE=3.957258e-01
  per-joint RMSE: 0.5019 0.6364 0.3454 0.2320 0.2482 0.2190
Combined torque MSE=1.565989e-01     RMSE=3.957258e-01
  per-joint RMSE: 0.5019 0.6364 0.3454 0.2320 0.2482 0.2190
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400.npz --H 25 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400.json
H=25, n_dof=6, feature_dim=18
X_train: (60727, 25, 18)  Y_train: (60727, 6)
X_test : (23900, 25, 18)  Y_test : (23900, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:28:41.012365: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:28:41.036871: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep400.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (60727, 25, 18), Y_train = (60727, 6)
  X_test  = (23900, 25, 18),  Y_test  = (23900, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:28:42.200980: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:42.205659: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:42.206571: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:42.208453: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:42.209431: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:42.210292: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:42.297083: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:42.297974: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:42.298959: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:28:42.299747: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:28:43.269350: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
190/190 - 2s - 10ms/step - loss: 0.2262 - val_loss: 0.3017
Epoch 2/100
190/190 - 0s - 3ms/step - loss: 0.1322 - val_loss: 0.2720
Epoch 3/100
190/190 - 1s - 3ms/step - loss: 0.1115 - val_loss: 0.2619
Epoch 4/100
190/190 - 1s - 3ms/step - loss: 0.1017 - val_loss: 0.2564
Epoch 5/100
190/190 - 1s - 3ms/step - loss: 0.0957 - val_loss: 0.2526
Epoch 6/100
190/190 - 1s - 3ms/step - loss: 0.0906 - val_loss: 0.2483
Epoch 7/100
190/190 - 0s - 3ms/step - loss: 0.0866 - val_loss: 0.2476
Epoch 8/100
190/190 - 0s - 3ms/step - loss: 0.0826 - val_loss: 0.2436
Epoch 9/100
190/190 - 0s - 3ms/step - loss: 0.0811 - val_loss: 0.2397
Epoch 10/100
190/190 - 0s - 3ms/step - loss: 0.0791 - val_loss: 0.2383
Epoch 11/100
190/190 - 1s - 3ms/step - loss: 0.0770 - val_loss: 0.2325
Epoch 12/100
190/190 - 0s - 3ms/step - loss: 0.0759 - val_loss: 0.2266
Epoch 13/100
190/190 - 0s - 3ms/step - loss: 0.0736 - val_loss: 0.2247
Epoch 14/100
190/190 - 0s - 3ms/step - loss: 0.0724 - val_loss: 0.2188
Epoch 15/100
190/190 - 1s - 3ms/step - loss: 0.0704 - val_loss: 0.2157
Epoch 16/100
190/190 - 0s - 3ms/step - loss: 0.0699 - val_loss: 0.2146
Epoch 17/100
190/190 - 1s - 3ms/step - loss: 0.0694 - val_loss: 0.2122
Epoch 18/100
190/190 - 0s - 3ms/step - loss: 0.0689 - val_loss: 0.2095
Epoch 19/100
190/190 - 0s - 3ms/step - loss: 0.0664 - val_loss: 0.2063
Epoch 20/100
190/190 - 0s - 3ms/step - loss: 0.0660 - val_loss: 0.2086
Epoch 21/100
190/190 - 0s - 3ms/step - loss: 0.0642 - val_loss: 0.2009
Epoch 22/100
190/190 - 0s - 3ms/step - loss: 0.0634 - val_loss: 0.2041
Epoch 23/100
190/190 - 0s - 3ms/step - loss: 0.0623 - val_loss: 0.1962
Epoch 24/100
190/190 - 0s - 3ms/step - loss: 0.0618 - val_loss: 0.1968
Epoch 25/100
190/190 - 0s - 3ms/step - loss: 0.0606 - val_loss: 0.1923
Epoch 26/100
190/190 - 0s - 3ms/step - loss: 0.0606 - val_loss: 0.1938
Epoch 27/100
190/190 - 0s - 3ms/step - loss: 0.0610 - val_loss: 0.1881
Epoch 28/100
190/190 - 0s - 3ms/step - loss: 0.0592 - val_loss: 0.1873
Epoch 29/100
190/190 - 1s - 3ms/step - loss: 0.0583 - val_loss: 0.1857
Epoch 30/100
190/190 - 0s - 3ms/step - loss: 0.0581 - val_loss: 0.1855
Epoch 31/100
190/190 - 0s - 3ms/step - loss: 0.0572 - val_loss: 0.1866
Epoch 32/100
190/190 - 0s - 3ms/step - loss: 0.0567 - val_loss: 0.1873
Epoch 33/100
190/190 - 0s - 3ms/step - loss: 0.0558 - val_loss: 0.1858
Epoch 34/100
190/190 - 0s - 3ms/step - loss: 0.0559 - val_loss: 0.1844
Epoch 35/100
190/190 - 1s - 3ms/step - loss: 0.0553 - val_loss: 0.1804
Epoch 36/100
190/190 - 0s - 3ms/step - loss: 0.0544 - val_loss: 0.1858
Epoch 37/100
190/190 - 0s - 3ms/step - loss: 0.0542 - val_loss: 0.1863
Epoch 38/100
190/190 - 0s - 3ms/step - loss: 0.0538 - val_loss: 0.1829
Epoch 39/100
190/190 - 0s - 3ms/step - loss: 0.0532 - val_loss: 0.1862
Epoch 40/100
190/190 - 0s - 3ms/step - loss: 0.0522 - val_loss: 0.1839
Epoch 41/100
190/190 - 0s - 3ms/step - loss: 0.0531 - val_loss: 0.1836
Epoch 42/100
190/190 - 0s - 3ms/step - loss: 0.0518 - val_loss: 0.1882
Epoch 43/100
190/190 - 0s - 3ms/step - loss: 0.0515 - val_loss: 0.1864
Epoch 44/100
190/190 - 0s - 3ms/step - loss: 0.0508 - val_loss: 0.1833
Epoch 45/100
190/190 - 0s - 3ms/step - loss: 0.0509 - val_loss: 0.1847
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3579
Per-joint RMSE: 0.4324 0.5833 0.3294 0.2141 0.2211 0.1950
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:29:07.295036: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:29:07.319823: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 09:29:08.191007: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:08.195750: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:08.196600: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:08.198296: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:08.199136: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:08.199926: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:08.282578: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:08.283472: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:08.284269: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:08.285141: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:29:08.584122: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/45
  done 45/45

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.320830e-01  RMSE=4.817499e-01
  per-joint RMSE: 0.5596 0.8338 0.4168 0.2836 0.2752 0.2330
Residual LSTM:  MSE=1.280766e-01      RMSE=3.578779e-01
  per-joint RMSE: 0.4324 0.5833 0.3294 0.2141 0.2211 0.1950
Combined torque MSE=1.280766e-01     RMSE=3.578779e-01
  per-joint RMSE: 0.4324 0.5833 0.3294 0.2141 0.2211 0.1950
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400.npz --H 50 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400.json
H=50, n_dof=6, feature_dim=24
X_train: (59202, 50, 24)  Y_train: (59202, 6)
X_test : (23275, 50, 24)  Y_test : (23275, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:29:11.461212: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:29:11.485323: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep400.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (59202, 50, 24), Y_train = (59202, 6)
  X_test  = (23275, 50, 24),  Y_test  = (23275, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:29:12.970255: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:12.975075: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:12.976165: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:12.977933: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:12.978838: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:12.979709: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:13.067041: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:13.067948: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:13.068756: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:13.069551: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:29:14.133920: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
186/186 - 2s - 11ms/step - loss: 0.2226 - val_loss: 0.2919
Epoch 2/100
186/186 - 1s - 4ms/step - loss: 0.1283 - val_loss: 0.2427
Epoch 3/100
186/186 - 1s - 4ms/step - loss: 0.1115 - val_loss: 0.2245
Epoch 4/100
186/186 - 1s - 4ms/step - loss: 0.1021 - val_loss: 0.2135
Epoch 5/100
186/186 - 1s - 4ms/step - loss: 0.0960 - val_loss: 0.2077
Epoch 6/100
186/186 - 1s - 4ms/step - loss: 0.0913 - val_loss: 0.2034
Epoch 7/100
186/186 - 1s - 4ms/step - loss: 0.0886 - val_loss: 0.2034
Epoch 8/100
186/186 - 1s - 4ms/step - loss: 0.0857 - val_loss: 0.1951
Epoch 9/100
186/186 - 1s - 4ms/step - loss: 0.0837 - val_loss: 0.1921
Epoch 10/100
186/186 - 1s - 4ms/step - loss: 0.0807 - val_loss: 0.1864
Epoch 11/100
186/186 - 1s - 4ms/step - loss: 0.0779 - val_loss: 0.1802
Epoch 12/100
186/186 - 1s - 4ms/step - loss: 0.0765 - val_loss: 0.1781
Epoch 13/100
186/186 - 1s - 4ms/step - loss: 0.0754 - val_loss: 0.1788
Epoch 14/100
186/186 - 1s - 4ms/step - loss: 0.0735 - val_loss: 0.1749
Epoch 15/100
186/186 - 1s - 4ms/step - loss: 0.0724 - val_loss: 0.1749
Epoch 16/100
186/186 - 1s - 4ms/step - loss: 0.0709 - val_loss: 0.1759
Epoch 17/100
186/186 - 1s - 4ms/step - loss: 0.0699 - val_loss: 0.1733
Epoch 18/100
186/186 - 1s - 4ms/step - loss: 0.0681 - val_loss: 0.1702
Epoch 19/100
186/186 - 1s - 4ms/step - loss: 0.0668 - val_loss: 0.1699
Epoch 20/100
186/186 - 1s - 4ms/step - loss: 0.0659 - val_loss: 0.1698
Epoch 21/100
186/186 - 1s - 4ms/step - loss: 0.0648 - val_loss: 0.1715
Epoch 22/100
186/186 - 1s - 4ms/step - loss: 0.0639 - val_loss: 0.1675
Epoch 23/100
186/186 - 1s - 4ms/step - loss: 0.0642 - val_loss: 0.1691
Epoch 24/100
186/186 - 1s - 4ms/step - loss: 0.0631 - val_loss: 0.1669
Epoch 25/100
186/186 - 1s - 4ms/step - loss: 0.0620 - val_loss: 0.1651
Epoch 26/100
186/186 - 1s - 4ms/step - loss: 0.0606 - val_loss: 0.1673
Epoch 27/100
186/186 - 1s - 4ms/step - loss: 0.0591 - val_loss: 0.1691
Epoch 28/100
186/186 - 1s - 4ms/step - loss: 0.0586 - val_loss: 0.1715
Epoch 29/100
186/186 - 1s - 4ms/step - loss: 0.0589 - val_loss: 0.1667
Epoch 30/100
186/186 - 1s - 4ms/step - loss: 0.0581 - val_loss: 0.1657
Epoch 31/100
186/186 - 1s - 4ms/step - loss: 0.0567 - val_loss: 0.1673
Epoch 32/100
186/186 - 1s - 4ms/step - loss: 0.0561 - val_loss: 0.1659
Epoch 33/100
186/186 - 1s - 4ms/step - loss: 0.0558 - val_loss: 0.1672
Epoch 34/100
186/186 - 1s - 4ms/step - loss: 0.0554 - val_loss: 0.1701
Epoch 35/100
186/186 - 1s - 4ms/step - loss: 0.0554 - val_loss: 0.1694
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3674
Per-joint RMSE: 0.4518 0.6081 0.3195 0.2112 0.2319 0.1883
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:29:41.293105: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:29:41.317920: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 09:29:42.171147: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:42.175701: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:42.176497: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:42.178288: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:42.179076: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:42.179815: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:42.257386: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:42.258308: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:42.259177: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:42.259960: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:29:42.557765: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/45
  done 45/45

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.344147e-01  RMSE=4.841639e-01
  per-joint RMSE: 0.5626 0.8383 0.4186 0.2850 0.2764 0.2331
Residual LSTM:  MSE=1.349807e-01      RMSE=3.673972e-01
  per-joint RMSE: 0.4518 0.6081 0.3195 0.2112 0.2319 0.1883
Combined torque MSE=1.349808e-01     RMSE=3.673973e-01
  per-joint RMSE: 0.4518 0.6081 0.3195 0.2112 0.2319 0.1883
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400.npz --H 50 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400.json
H=50, n_dof=6, feature_dim=6
X_train: (59202, 50, 6)  Y_train: (59202, 6)
X_test : (23275, 50, 6)  Y_test : (23275, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:29:45.178446: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:29:45.202744: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep400.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (59202, 50, 6), Y_train = (59202, 6)
  X_test  = (23275, 50, 6),  Y_test  = (23275, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:29:46.351329: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:46.356004: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:46.356912: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:46.358466: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:46.359470: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:46.360327: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:46.439146: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:46.440036: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:46.440827: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:46.441605: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:29:47.377442: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
186/186 - 2s - 11ms/step - loss: 0.7142 - val_loss: 0.6775
Epoch 2/100
186/186 - 1s - 4ms/step - loss: 0.4780 - val_loss: 0.6071
Epoch 3/100
186/186 - 1s - 4ms/step - loss: 0.3543 - val_loss: 0.6887
Epoch 4/100
186/186 - 1s - 4ms/step - loss: 0.2779 - val_loss: 0.7081
Epoch 5/100
186/186 - 1s - 4ms/step - loss: 0.2533 - val_loss: 0.7299
Epoch 6/100
186/186 - 1s - 4ms/step - loss: 0.2245 - val_loss: 0.7546
Epoch 7/100
186/186 - 1s - 4ms/step - loss: 0.2116 - val_loss: 0.7250
Epoch 8/100
186/186 - 1s - 4ms/step - loss: 0.2076 - val_loss: 0.7971
Epoch 9/100
186/186 - 1s - 4ms/step - loss: 0.1979 - val_loss: 0.7795
Epoch 10/100
186/186 - 1s - 4ms/step - loss: 0.1973 - val_loss: 0.6859
Epoch 11/100
186/186 - 1s - 4ms/step - loss: 0.2034 - val_loss: 0.7812
Epoch 12/100
186/186 - 1s - 4ms/step - loss: 0.1912 - val_loss: 0.8165
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4244
Per-joint RMSE: 0.5357 0.6769 0.3706 0.2453 0.2476 0.2768
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:29:57.673268: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:29:57.698025: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 09:29:58.544715: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:58.549292: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:58.550169: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:58.551851: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:58.552639: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:58.553368: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:58.631603: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:58.632441: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:58.633175: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:29:58.633908: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:29:58.927475: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/45
  done 45/45

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.344147e-01  RMSE=4.841639e-01
  per-joint RMSE: 0.5626 0.8383 0.4186 0.2850 0.2764 0.2331
Residual LSTM:  MSE=1.800977e-01      RMSE=4.243793e-01
  per-joint RMSE: 0.5357 0.6769 0.3706 0.2453 0.2476 0.2768
Combined torque MSE=1.800977e-01     RMSE=4.243793e-01
  per-joint RMSE: 0.5357 0.6769 0.3706 0.2453 0.2476 0.2768
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400.npz --H 50 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400.json
H=50, n_dof=6, feature_dim=18
X_train: (59202, 50, 18)  Y_train: (59202, 6)
X_test : (23275, 50, 18)  Y_test : (23275, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:30:01.804149: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:30:01.827797: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep400.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (59202, 50, 18), Y_train = (59202, 6)
  X_test  = (23275, 50, 18),  Y_test  = (23275, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:30:03.212072: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:30:03.216813: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:30:03.217718: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:30:03.219489: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:30:03.220393: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:30:03.221249: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:30:03.304226: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:30:03.305206: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:30:03.305995: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:30:03.306773: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:30:04.320640: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
186/186 - 2s - 11ms/step - loss: 0.2521 - val_loss: 0.3364
Epoch 2/100
186/186 - 1s - 4ms/step - loss: 0.1551 - val_loss: 0.3125
Epoch 3/100
186/186 - 1s - 4ms/step - loss: 0.1359 - val_loss: 0.2994
Epoch 4/100
186/186 - 1s - 4ms/step - loss: 0.1241 - val_loss: 0.2889
Epoch 5/100
186/186 - 1s - 4ms/step - loss: 0.1176 - val_loss: 0.2834
Epoch 6/100
186/186 - 1s - 4ms/step - loss: 0.1150 - val_loss: 0.2735
Epoch 7/100
186/186 - 1s - 4ms/step - loss: 0.1100 - val_loss: 0.2737
Epoch 8/100
186/186 - 1s - 4ms/step - loss: 0.1063 - val_loss: 0.2662
Epoch 9/100
186/186 - 1s - 4ms/step - loss: 0.1032 - val_loss: 0.2622
Epoch 10/100
186/186 - 1s - 4ms/step - loss: 0.1000 - val_loss: 0.2607
Epoch 11/100
186/186 - 1s - 4ms/step - loss: 0.0959 - val_loss: 0.2586
Epoch 12/100
186/186 - 1s - 4ms/step - loss: 0.0939 - val_loss: 0.2551
Epoch 13/100
186/186 - 1s - 4ms/step - loss: 0.0938 - val_loss: 0.2577
Epoch 14/100
186/186 - 1s - 4ms/step - loss: 0.0903 - val_loss: 0.2551
Epoch 15/100
186/186 - 1s - 4ms/step - loss: 0.0892 - val_loss: 0.2571
Epoch 16/100
186/186 - 1s - 4ms/step - loss: 0.0871 - val_loss: 0.2543
Epoch 17/100
186/186 - 1s - 4ms/step - loss: 0.0858 - val_loss: 0.2494
Epoch 18/100
186/186 - 1s - 4ms/step - loss: 0.0847 - val_loss: 0.2493
Epoch 19/100
186/186 - 1s - 4ms/step - loss: 0.0817 - val_loss: 0.2478
Epoch 20/100
186/186 - 1s - 4ms/step - loss: 0.0801 - val_loss: 0.2502
Epoch 21/100
186/186 - 1s - 4ms/step - loss: 0.0793 - val_loss: 0.2490
Epoch 22/100
186/186 - 1s - 4ms/step - loss: 0.0776 - val_loss: 0.2472
Epoch 23/100
186/186 - 1s - 4ms/step - loss: 0.0791 - val_loss: 0.2487
Epoch 24/100
186/186 - 1s - 4ms/step - loss: 0.0758 - val_loss: 0.2492
Epoch 25/100
186/186 - 1s - 4ms/step - loss: 0.0740 - val_loss: 0.2424
Epoch 26/100
186/186 - 1s - 4ms/step - loss: 0.0733 - val_loss: 0.2458
Epoch 27/100
186/186 - 1s - 4ms/step - loss: 0.0726 - val_loss: 0.2436
Epoch 28/100
186/186 - 1s - 4ms/step - loss: 0.0713 - val_loss: 0.2426
Epoch 29/100
186/186 - 1s - 4ms/step - loss: 0.0702 - val_loss: 0.2408
Epoch 30/100
186/186 - 1s - 4ms/step - loss: 0.0708 - val_loss: 0.2441
Epoch 31/100
186/186 - 1s - 4ms/step - loss: 0.0694 - val_loss: 0.2418
Epoch 32/100
186/186 - 1s - 4ms/step - loss: 0.0709 - val_loss: 0.2411
Epoch 33/100
186/186 - 1s - 4ms/step - loss: 0.0685 - val_loss: 0.2426
Epoch 34/100
186/186 - 1s - 4ms/step - loss: 0.0675 - val_loss: 0.2384
Epoch 35/100
186/186 - 1s - 4ms/step - loss: 0.0673 - val_loss: 0.2404
Epoch 36/100
186/186 - 1s - 4ms/step - loss: 0.0673 - val_loss: 0.2383
Epoch 37/100
186/186 - 1s - 4ms/step - loss: 0.0682 - val_loss: 0.2398
Epoch 38/100
186/186 - 1s - 4ms/step - loss: 0.0662 - val_loss: 0.2379
Epoch 39/100
186/186 - 1s - 4ms/step - loss: 0.0643 - val_loss: 0.2406
Epoch 40/100
186/186 - 1s - 4ms/step - loss: 0.0642 - val_loss: 0.2412
Epoch 41/100
186/186 - 1s - 4ms/step - loss: 0.0655 - val_loss: 0.2402
Epoch 42/100
186/186 - 1s - 4ms/step - loss: 0.0647 - val_loss: 0.2378
Epoch 43/100
186/186 - 1s - 4ms/step - loss: 0.0629 - val_loss: 0.2353
Epoch 44/100
186/186 - 1s - 4ms/step - loss: 0.0624 - val_loss: 0.2394
Epoch 45/100
186/186 - 1s - 4ms/step - loss: 0.0626 - val_loss: 0.2368
Epoch 46/100
186/186 - 1s - 4ms/step - loss: 0.0620 - val_loss: 0.2397
Epoch 47/100
186/186 - 1s - 4ms/step - loss: 0.0624 - val_loss: 0.2336
Epoch 48/100
186/186 - 1s - 4ms/step - loss: 0.0606 - val_loss: 0.2357
Epoch 49/100
186/186 - 1s - 4ms/step - loss: 0.0607 - val_loss: 0.2366
Epoch 50/100
186/186 - 1s - 4ms/step - loss: 0.0636 - val_loss: 0.2350
Epoch 51/100
186/186 - 1s - 4ms/step - loss: 0.0632 - val_loss: 0.2349
Epoch 52/100
186/186 - 1s - 4ms/step - loss: 0.0616 - val_loss: 0.2380
Epoch 53/100
186/186 - 1s - 4ms/step - loss: 0.0625 - val_loss: 0.2332
Epoch 54/100
186/186 - 1s - 4ms/step - loss: 0.0606 - val_loss: 0.2351
Epoch 55/100
186/186 - 1s - 4ms/step - loss: 0.0608 - val_loss: 0.2333
Epoch 56/100
186/186 - 1s - 4ms/step - loss: 0.0592 - val_loss: 0.2295
Epoch 57/100
186/186 - 1s - 4ms/step - loss: 0.0596 - val_loss: 0.2315
Epoch 58/100
186/186 - 1s - 4ms/step - loss: 0.0586 - val_loss: 0.2298
Epoch 59/100
186/186 - 1s - 4ms/step - loss: 0.0581 - val_loss: 0.2328
Epoch 60/100
186/186 - 1s - 4ms/step - loss: 0.0592 - val_loss: 0.2320
Epoch 61/100
186/186 - 1s - 4ms/step - loss: 0.0567 - val_loss: 0.2286
Epoch 62/100
186/186 - 1s - 4ms/step - loss: 0.0587 - val_loss: 0.2332
Epoch 63/100
186/186 - 1s - 4ms/step - loss: 0.0565 - val_loss: 0.2313
Epoch 64/100
186/186 - 1s - 4ms/step - loss: 0.0571 - val_loss: 0.2298
Epoch 65/100
186/186 - 1s - 4ms/step - loss: 0.0578 - val_loss: 0.2309
Epoch 66/100
186/186 - 1s - 4ms/step - loss: 0.0553 - val_loss: 0.2321
Epoch 67/100
186/186 - 1s - 4ms/step - loss: 0.0541 - val_loss: 0.2300
Epoch 68/100
186/186 - 1s - 4ms/step - loss: 0.0534 - val_loss: 0.2317
Epoch 69/100
186/186 - 1s - 4ms/step - loss: 0.0553 - val_loss: 0.2358
Epoch 70/100
186/186 - 1s - 4ms/step - loss: 0.0538 - val_loss: 0.2336
Epoch 71/100
186/186 - 1s - 4ms/step - loss: 0.0525 - val_loss: 0.2346
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4049
Per-joint RMSE: 0.5092 0.6517 0.3604 0.2373 0.2561 0.2191
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:30:57.834518: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:30:57.858793: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 09:30:58.701728: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:30:58.706325: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:30:58.707198: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:30:58.708854: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:30:58.709639: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:30:58.710377: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:30:58.791473: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:30:58.792310: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:30:58.793085: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:30:58.793870: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:30:59.095019: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/45
  done 45/45

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.344147e-01  RMSE=4.841639e-01
  per-joint RMSE: 0.5626 0.8383 0.4186 0.2850 0.2764 0.2331
Residual LSTM:  MSE=1.639772e-01      RMSE=4.049410e-01
  per-joint RMSE: 0.5092 0.6517 0.3604 0.2373 0.2561 0.2191
Combined torque MSE=1.639772e-01     RMSE=4.049410e-01
  per-joint RMSE: 0.5092 0.6517 0.3604 0.2373 0.2561 0.2191
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400.npz --H 50 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400.json
H=50, n_dof=6, feature_dim=18
X_train: (59202, 50, 18)  Y_train: (59202, 6)
X_test : (23275, 50, 18)  Y_test : (23275, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:31:01.923967: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:31:01.947557: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep400.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (59202, 50, 18), Y_train = (59202, 6)
  X_test  = (23275, 50, 18),  Y_test  = (23275, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:31:03.338253: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:31:03.342860: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:31:03.343879: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:31:03.345625: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:31:03.346548: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:31:03.347406: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:31:03.444300: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:31:03.445220: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:31:03.446043: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:31:03.446908: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:31:04.473817: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
186/186 - 2s - 11ms/step - loss: 0.2296 - val_loss: 0.3186
Epoch 2/100
186/186 - 1s - 4ms/step - loss: 0.1356 - val_loss: 0.2666
Epoch 3/100
186/186 - 1s - 4ms/step - loss: 0.1132 - val_loss: 0.2425
Epoch 4/100
186/186 - 1s - 4ms/step - loss: 0.1041 - val_loss: 0.2401
Epoch 5/100
186/186 - 1s - 4ms/step - loss: 0.0979 - val_loss: 0.2324
Epoch 6/100
186/186 - 1s - 4ms/step - loss: 0.0917 - val_loss: 0.2264
Epoch 7/100
186/186 - 1s - 4ms/step - loss: 0.0884 - val_loss: 0.2241
Epoch 8/100
186/186 - 1s - 4ms/step - loss: 0.0855 - val_loss: 0.2204
Epoch 9/100
186/186 - 1s - 4ms/step - loss: 0.0833 - val_loss: 0.2135
Epoch 10/100
186/186 - 1s - 4ms/step - loss: 0.0801 - val_loss: 0.2055
Epoch 11/100
186/186 - 1s - 4ms/step - loss: 0.0779 - val_loss: 0.2041
Epoch 12/100
186/186 - 1s - 4ms/step - loss: 0.0767 - val_loss: 0.1984
Epoch 13/100
186/186 - 1s - 4ms/step - loss: 0.0749 - val_loss: 0.1982
Epoch 14/100
186/186 - 1s - 4ms/step - loss: 0.0733 - val_loss: 0.1980
Epoch 15/100
186/186 - 1s - 4ms/step - loss: 0.0724 - val_loss: 0.1952
Epoch 16/100
186/186 - 1s - 4ms/step - loss: 0.0705 - val_loss: 0.1937
Epoch 17/100
186/186 - 1s - 4ms/step - loss: 0.0685 - val_loss: 0.1929
Epoch 18/100
186/186 - 1s - 4ms/step - loss: 0.0683 - val_loss: 0.1942
Epoch 19/100
186/186 - 1s - 4ms/step - loss: 0.0665 - val_loss: 0.1914
Epoch 20/100
186/186 - 1s - 4ms/step - loss: 0.0651 - val_loss: 0.1895
Epoch 21/100
186/186 - 1s - 4ms/step - loss: 0.0647 - val_loss: 0.1900
Epoch 22/100
186/186 - 1s - 4ms/step - loss: 0.0642 - val_loss: 0.1845
Epoch 23/100
186/186 - 1s - 4ms/step - loss: 0.0639 - val_loss: 0.1874
Epoch 24/100
186/186 - 1s - 4ms/step - loss: 0.0627 - val_loss: 0.1896
Epoch 25/100
186/186 - 1s - 4ms/step - loss: 0.0615 - val_loss: 0.1860
Epoch 26/100
186/186 - 1s - 4ms/step - loss: 0.0615 - val_loss: 0.1837
Epoch 27/100
186/186 - 1s - 4ms/step - loss: 0.0603 - val_loss: 0.1824
Epoch 28/100
186/186 - 1s - 4ms/step - loss: 0.0601 - val_loss: 0.1827
Epoch 29/100
186/186 - 1s - 4ms/step - loss: 0.0594 - val_loss: 0.1808
Epoch 30/100
186/186 - 1s - 4ms/step - loss: 0.0587 - val_loss: 0.1818
Epoch 31/100
186/186 - 1s - 4ms/step - loss: 0.0576 - val_loss: 0.1844
Epoch 32/100
186/186 - 1s - 4ms/step - loss: 0.0574 - val_loss: 0.1830
Epoch 33/100
186/186 - 1s - 4ms/step - loss: 0.0570 - val_loss: 0.1835
Epoch 34/100
186/186 - 1s - 4ms/step - loss: 0.0574 - val_loss: 0.1823
Epoch 35/100
186/186 - 1s - 4ms/step - loss: 0.0566 - val_loss: 0.1801
Epoch 36/100
186/186 - 1s - 4ms/step - loss: 0.0553 - val_loss: 0.1808
Epoch 37/100
186/186 - 1s - 4ms/step - loss: 0.0552 - val_loss: 0.1842
Epoch 38/100
186/186 - 1s - 4ms/step - loss: 0.0547 - val_loss: 0.1782
Epoch 39/100
186/186 - 1s - 4ms/step - loss: 0.0540 - val_loss: 0.1868
Epoch 40/100
186/186 - 1s - 4ms/step - loss: 0.0538 - val_loss: 0.1850
Epoch 41/100
186/186 - 1s - 4ms/step - loss: 0.0529 - val_loss: 0.1852
Epoch 42/100
186/186 - 1s - 4ms/step - loss: 0.0528 - val_loss: 0.1856
Epoch 43/100
186/186 - 1s - 4ms/step - loss: 0.0527 - val_loss: 0.1853
Epoch 44/100
186/186 - 1s - 4ms/step - loss: 0.0520 - val_loss: 0.1884
Epoch 45/100
186/186 - 1s - 4ms/step - loss: 0.0516 - val_loss: 0.1848
Epoch 46/100
186/186 - 1s - 4ms/step - loss: 0.0512 - val_loss: 0.1851
Epoch 47/100
186/186 - 1s - 4ms/step - loss: 0.0506 - val_loss: 0.1847
Epoch 48/100
186/186 - 1s - 4ms/step - loss: 0.0505 - val_loss: 0.1861
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3696
Per-joint RMSE: 0.4410 0.6068 0.3426 0.2183 0.2320 0.1957
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:31:41.083155: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:31:41.108045: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s0_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 09:31:41.962484: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:31:41.967077: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:31:41.967872: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:31:41.969543: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:31:41.970341: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:31:41.971093: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:31:42.052036: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:31:42.052956: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:31:42.053702: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:31:42.054434: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:31:42.350346: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/45
  done 45/45

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.344147e-01  RMSE=4.841639e-01
  per-joint RMSE: 0.5626 0.8383 0.4186 0.2850 0.2764 0.2331
Residual LSTM:  MSE=1.366309e-01      RMSE=3.696361e-01
  per-joint RMSE: 0.4410 0.6068 0.3426 0.2183 0.2320 0.1957
Combined torque MSE=1.366309e-01     RMSE=3.696361e-01
  per-joint RMSE: 0.4410 0.6068 0.3426 0.2183 0.2320 0.1957
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s0_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=1                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz                                ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed2_dataset.npz -t structured -s 1 -r 0 --hp_preset fast_debug --epochs 400 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400.jax' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 400, 'lagrangian_type': <function structured_lagrangian_fn at 0x7f0d565e41f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed2_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed2_dataset.npz
   dt ≈ 0.02208891656001752
  dof = 6
  Train trajectories = 105
  Test trajectories  = 45
  Train samples = 62323
  Test samples  = 24560
################################################

2026-01-22 09:31:47.254072: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400 | type=structured | dof=6
################################################
2026-01-22 09:31:50.381643: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:31:50.381678: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:31:50.381684: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:31:50.381712: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:31:50.381717: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:31:50.381731: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:31:50.381768: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:31:50.381773: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:31:50.381788: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:31:50.381793: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.1s, Loss=1.02e+01, Inv=1.02e+01, For=1.22e+02, Power=2.25e+00
  [eval] test_mse=2.096e+00  (n=24560)
Epoch 00050: Time=  14.8s, Loss=2.91e+00, Inv=2.91e+00, For=8.63e+01, Power=1.40e+00
Epoch 00100: Time=  22.4s, Loss=2.62e+00, Inv=2.62e+00, For=1.03e+02, Power=1.29e+00
Epoch 00150: Time=  30.7s, Loss=2.51e+00, Inv=2.51e+00, For=1.28e+02, Power=1.27e+00
Epoch 00200: Time=  38.4s, Loss=2.44e+00, Inv=2.44e+00, For=1.70e+02, Power=1.24e+00
  [eval] test_mse=1.301e+00  (n=24560)
Epoch 00250: Time=  46.8s, Loss=2.41e+00, Inv=2.41e+00, For=2.24e+02, Power=1.23e+00
Epoch 00300: Time=  55.1s, Loss=2.38e+00, Inv=2.38e+00, For=2.87e+02, Power=1.22e+00
Epoch 00350: Time=  63.2s, Loss=2.35e+00, Inv=2.35e+00, For=3.57e+02, Power=1.21e+00
Epoch 00400: Time=  71.0s, Loss=2.34e+00, Inv=2.34e+00, For=3.95e+02, Power=1.21e+00
  [eval] test_mse=1.471e+00  (n=24560)
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400
Torque MSE  = 2.452e-01
Torque RMSE = 4.952e-01
Per-joint MSE : 3.062e-01 7.315e-01 1.818e-01 9.628e-02 8.910e-02 6.616e-02
Per-joint RMSE: 5.534e-01 8.553e-01 4.264e-01 3.103e-01 2.985e-01 2.572e-01
Comp Time per Sample = 1.296e-08s / 77152882.0Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed2_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed2_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep400.jax
Detected n_dof=6 (seed=1)
2026-01-22 09:33:03.543507: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 105 trajectories
2026-01-22 09:33:04.851708: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:33:04.851720: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:33:06.400307: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:33:06.400321: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:33:07.902695: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:33:09.143896: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/105
2026-01-22 09:33:10.351290: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:33:10.351325: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:33:10.351331: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 50/105
2026-01-22 09:33:11.975945: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:33:13.217978: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 75/105
2026-01-22 09:33:14.487110: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 100/105
  done 105/105

Exporting split=test: 45 trajectories
  done 25/45
  done 45/45

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400.npz --H 25 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400.json
H=25, n_dof=6, feature_dim=24
X_train: (60727, 25, 24)  Y_train: (60727, 6)
X_test : (23900, 25, 24)  Y_test : (23900, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:33:18.192758: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:33:18.217299: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep400.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (60727, 25, 24), Y_train = (60727, 6)
  X_test  = (23900, 25, 24),  Y_test  = (23900, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:33:19.437433: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:33:19.442315: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:33:19.443244: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:33:19.445129: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:33:19.448532: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:33:19.449602: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:33:19.544713: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:33:19.545598: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:33:19.546394: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:33:19.547183: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8975 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:33:20.510126: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
190/190 - 2s - 10ms/step - loss: 0.2226 - val_loss: 0.2777
Epoch 2/100
190/190 - 0s - 3ms/step - loss: 0.1274 - val_loss: 0.2418
Epoch 3/100
190/190 - 0s - 3ms/step - loss: 0.1113 - val_loss: 0.2263
Epoch 4/100
190/190 - 0s - 3ms/step - loss: 0.1007 - val_loss: 0.2116
Epoch 5/100
190/190 - 0s - 3ms/step - loss: 0.0957 - val_loss: 0.2033
Epoch 6/100
190/190 - 1s - 3ms/step - loss: 0.0899 - val_loss: 0.1988
Epoch 7/100
190/190 - 0s - 3ms/step - loss: 0.0881 - val_loss: 0.1933
Epoch 8/100
190/190 - 0s - 3ms/step - loss: 0.0832 - val_loss: 0.1874
Epoch 9/100
190/190 - 0s - 3ms/step - loss: 0.0811 - val_loss: 0.1865
Epoch 10/100
190/190 - 0s - 3ms/step - loss: 0.0786 - val_loss: 0.1835
Epoch 11/100
190/190 - 0s - 3ms/step - loss: 0.0760 - val_loss: 0.1821
Epoch 12/100
190/190 - 0s - 3ms/step - loss: 0.0735 - val_loss: 0.1784
Epoch 13/100
190/190 - 0s - 3ms/step - loss: 0.0721 - val_loss: 0.1787
Epoch 14/100
190/190 - 0s - 3ms/step - loss: 0.0705 - val_loss: 0.1768
Epoch 15/100
190/190 - 0s - 2ms/step - loss: 0.0692 - val_loss: 0.1776
Epoch 16/100
190/190 - 0s - 3ms/step - loss: 0.0689 - val_loss: 0.1737
Epoch 17/100
190/190 - 0s - 3ms/step - loss: 0.0670 - val_loss: 0.1764
Epoch 18/100
190/190 - 0s - 3ms/step - loss: 0.0662 - val_loss: 0.1768
Epoch 19/100
190/190 - 0s - 3ms/step - loss: 0.0646 - val_loss: 0.1737
Epoch 20/100
190/190 - 0s - 3ms/step - loss: 0.0648 - val_loss: 0.1816
Epoch 21/100
190/190 - 0s - 3ms/step - loss: 0.0632 - val_loss: 0.1781
Epoch 22/100
190/190 - 0s - 3ms/step - loss: 0.0631 - val_loss: 0.1710
Epoch 23/100
190/190 - 0s - 3ms/step - loss: 0.0619 - val_loss: 0.1741
Epoch 24/100
190/190 - 0s - 2ms/step - loss: 0.0606 - val_loss: 0.1740
Epoch 25/100
190/190 - 0s - 2ms/step - loss: 0.0602 - val_loss: 0.1728
Epoch 26/100
190/190 - 0s - 2ms/step - loss: 0.0603 - val_loss: 0.1752
Epoch 27/100
190/190 - 0s - 3ms/step - loss: 0.0594 - val_loss: 0.1726
Epoch 28/100
190/190 - 0s - 3ms/step - loss: 0.0581 - val_loss: 0.1722
Epoch 29/100
190/190 - 0s - 3ms/step - loss: 0.0574 - val_loss: 0.1692
Epoch 30/100
190/190 - 0s - 3ms/step - loss: 0.0572 - val_loss: 0.1696
Epoch 31/100
190/190 - 0s - 3ms/step - loss: 0.0566 - val_loss: 0.1674
Epoch 32/100
190/190 - 0s - 3ms/step - loss: 0.0556 - val_loss: 0.1716
Epoch 33/100
190/190 - 0s - 3ms/step - loss: 0.0552 - val_loss: 0.1677
Epoch 34/100
190/190 - 0s - 3ms/step - loss: 0.0544 - val_loss: 0.1673
Epoch 35/100
190/190 - 0s - 3ms/step - loss: 0.0544 - val_loss: 0.1672
Epoch 36/100
190/190 - 0s - 2ms/step - loss: 0.0539 - val_loss: 0.1723
Epoch 37/100
190/190 - 0s - 2ms/step - loss: 0.0535 - val_loss: 0.1708
Epoch 38/100
190/190 - 0s - 3ms/step - loss: 0.0528 - val_loss: 0.1646
Epoch 39/100
190/190 - 0s - 3ms/step - loss: 0.0519 - val_loss: 0.1664
Epoch 40/100
190/190 - 0s - 3ms/step - loss: 0.0515 - val_loss: 0.1634
Epoch 41/100
190/190 - 0s - 3ms/step - loss: 0.0509 - val_loss: 0.1647
Epoch 42/100
190/190 - 0s - 3ms/step - loss: 0.0503 - val_loss: 0.1657
Epoch 43/100
190/190 - 0s - 3ms/step - loss: 0.0496 - val_loss: 0.1610
Epoch 44/100
190/190 - 0s - 3ms/step - loss: 0.0490 - val_loss: 0.1605
Epoch 45/100
190/190 - 0s - 3ms/step - loss: 0.0488 - val_loss: 0.1581
Epoch 46/100
190/190 - 0s - 2ms/step - loss: 0.0484 - val_loss: 0.1589
Epoch 47/100
190/190 - 0s - 3ms/step - loss: 0.0481 - val_loss: 0.1625
Epoch 48/100
190/190 - 0s - 2ms/step - loss: 0.0475 - val_loss: 0.1595
Epoch 49/100
190/190 - 0s - 2ms/step - loss: 0.0474 - val_loss: 0.1603
Epoch 50/100
190/190 - 0s - 3ms/step - loss: 0.0468 - val_loss: 0.1621
Epoch 51/100
190/190 - 0s - 2ms/step - loss: 0.0466 - val_loss: 0.1598
Epoch 52/100
190/190 - 0s - 3ms/step - loss: 0.0469 - val_loss: 0.1570
Epoch 53/100
190/190 - 1s - 3ms/step - loss: 0.0457 - val_loss: 0.1534
Epoch 54/100
190/190 - 0s - 3ms/step - loss: 0.0454 - val_loss: 0.1532
Epoch 55/100
190/190 - 0s - 3ms/step - loss: 0.0451 - val_loss: 0.1526
Epoch 56/100
190/190 - 0s - 3ms/step - loss: 0.0448 - val_loss: 0.1550
Epoch 57/100
190/190 - 0s - 3ms/step - loss: 0.0441 - val_loss: 0.1541
Epoch 58/100
190/190 - 0s - 3ms/step - loss: 0.0441 - val_loss: 0.1551
Epoch 59/100
190/190 - 0s - 3ms/step - loss: 0.0439 - val_loss: 0.1533
Epoch 60/100
190/190 - 0s - 3ms/step - loss: 0.0437 - val_loss: 0.1543
Epoch 61/100
190/190 - 0s - 3ms/step - loss: 0.0432 - val_loss: 0.1540
Epoch 62/100
190/190 - 0s - 3ms/step - loss: 0.0428 - val_loss: 0.1513
Epoch 63/100
190/190 - 0s - 3ms/step - loss: 0.0428 - val_loss: 0.1552
Epoch 64/100
190/190 - 0s - 3ms/step - loss: 0.0428 - val_loss: 0.1548
Epoch 65/100
190/190 - 0s - 3ms/step - loss: 0.0422 - val_loss: 0.1516
Epoch 66/100
190/190 - 0s - 2ms/step - loss: 0.0423 - val_loss: 0.1536
Epoch 67/100
190/190 - 0s - 3ms/step - loss: 0.0416 - val_loss: 0.1521
Epoch 68/100
190/190 - 0s - 2ms/step - loss: 0.0413 - val_loss: 0.1531
Epoch 69/100
190/190 - 0s - 2ms/step - loss: 0.0414 - val_loss: 0.1513
Epoch 70/100
190/190 - 0s - 2ms/step - loss: 0.0413 - val_loss: 0.1544
Epoch 71/100
190/190 - 0s - 2ms/step - loss: 0.0409 - val_loss: 0.1523
Epoch 72/100
190/190 - 0s - 2ms/step - loss: 0.0410 - val_loss: 0.1535
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3667
Per-joint RMSE: 0.4144 0.6118 0.3194 0.2269 0.2521 0.2091
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:33:57.016988: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:33:57.041959: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 09:33:57.910215: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:33:57.914906: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:33:57.915713: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:33:57.917636: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:33:57.918432: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:33:57.919175: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:33:57.998278: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:33:57.999128: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:33:57.999866: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:33:58.000602: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:33:58.293139: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/45
  done 45/45

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.480756e-01  RMSE=4.980718e-01
  per-joint RMSE: 0.5570 0.8608 0.4265 0.3126 0.3007 0.2593
Residual LSTM:  MSE=1.344713e-01      RMSE=3.667033e-01
  per-joint RMSE: 0.4144 0.6118 0.3194 0.2269 0.2521 0.2091
Combined torque MSE=1.344713e-01     RMSE=3.667033e-01
  per-joint RMSE: 0.4144 0.6118 0.3194 0.2269 0.2521 0.2091
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400.npz --H 25 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400.json
H=25, n_dof=6, feature_dim=6
X_train: (60727, 25, 6)  Y_train: (60727, 6)
X_test : (23900, 25, 6)  Y_test : (23900, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:34:00.817326: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:34:00.841370: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep400.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (60727, 25, 6), Y_train = (60727, 6)
  X_test  = (23900, 25, 6),  Y_test  = (23900, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:34:01.883488: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:01.888063: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:01.888857: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:01.890430: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:01.891301: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:01.892046: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:01.975568: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:01.976413: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:01.977151: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:01.977962: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:34:02.904628: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
190/190 - 2s - 10ms/step - loss: 0.7385 - val_loss: 0.7343
Epoch 2/100
190/190 - 0s - 3ms/step - loss: 0.4956 - val_loss: 0.6875
Epoch 3/100
190/190 - 0s - 2ms/step - loss: 0.3906 - val_loss: 0.6991
Epoch 4/100
190/190 - 0s - 3ms/step - loss: 0.3304 - val_loss: 0.6800
Epoch 5/100
190/190 - 0s - 3ms/step - loss: 0.2901 - val_loss: 0.6569
Epoch 6/100
190/190 - 1s - 3ms/step - loss: 0.2763 - val_loss: 0.7475
Epoch 7/100
190/190 - 0s - 3ms/step - loss: 0.2312 - val_loss: 0.6958
Epoch 8/100
190/190 - 0s - 3ms/step - loss: 0.1943 - val_loss: 0.7769
Epoch 9/100
190/190 - 0s - 2ms/step - loss: 0.1767 - val_loss: 0.7664
Epoch 10/100
190/190 - 0s - 2ms/step - loss: 0.1685 - val_loss: 0.6695
Epoch 11/100
190/190 - 0s - 2ms/step - loss: 0.1741 - val_loss: 0.6990
Epoch 12/100
190/190 - 0s - 2ms/step - loss: 0.1456 - val_loss: 0.6936
Epoch 13/100
190/190 - 0s - 2ms/step - loss: 0.1327 - val_loss: 0.7026
Epoch 14/100
190/190 - 0s - 3ms/step - loss: 0.1382 - val_loss: 0.6789
Epoch 15/100
190/190 - 0s - 2ms/step - loss: 0.1236 - val_loss: 0.7002
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4253
Per-joint RMSE: 0.5289 0.6725 0.3845 0.2794 0.2655 0.2379
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:34:11.751301: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:34:11.776279: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 09:34:12.633901: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:12.638485: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:12.639354: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:12.641174: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:12.642663: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:12.643491: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:12.725285: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:12.726194: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:12.727027: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:12.727760: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:34:13.019712: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/45
  done 45/45

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.480756e-01  RMSE=4.980718e-01
  per-joint RMSE: 0.5570 0.8608 0.4265 0.3126 0.3007 0.2593
Residual LSTM:  MSE=1.808379e-01      RMSE=4.252504e-01
  per-joint RMSE: 0.5289 0.6725 0.3845 0.2794 0.2655 0.2379
Combined torque MSE=1.808379e-01     RMSE=4.252504e-01
  per-joint RMSE: 0.5289 0.6725 0.3845 0.2794 0.2655 0.2379
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400.npz --H 25 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400.json
H=25, n_dof=6, feature_dim=18
X_train: (60727, 25, 18)  Y_train: (60727, 6)
X_test : (23900, 25, 18)  Y_test : (23900, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:34:15.666233: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:34:15.689735: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep400.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (60727, 25, 18), Y_train = (60727, 6)
  X_test  = (23900, 25, 18),  Y_test  = (23900, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:34:16.841207: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:16.845824: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:16.846615: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:16.848311: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:16.851740: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:16.852473: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:16.948149: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:16.949039: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:16.949839: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:16.950627: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:34:17.927823: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
190/190 - 2s - 10ms/step - loss: 0.2483 - val_loss: 0.3258
Epoch 2/100
190/190 - 0s - 3ms/step - loss: 0.1554 - val_loss: 0.3073
Epoch 3/100
190/190 - 1s - 3ms/step - loss: 0.1352 - val_loss: 0.3023
Epoch 4/100
190/190 - 0s - 3ms/step - loss: 0.1240 - val_loss: 0.2997
Epoch 5/100
190/190 - 0s - 3ms/step - loss: 0.1168 - val_loss: 0.2888
Epoch 6/100
190/190 - 1s - 3ms/step - loss: 0.1127 - val_loss: 0.2785
Epoch 7/100
190/190 - 0s - 3ms/step - loss: 0.1080 - val_loss: 0.2821
Epoch 8/100
190/190 - 0s - 3ms/step - loss: 0.1046 - val_loss: 0.2821
Epoch 9/100
190/190 - 1s - 3ms/step - loss: 0.1012 - val_loss: 0.2675
Epoch 10/100
190/190 - 0s - 3ms/step - loss: 0.0971 - val_loss: 0.2694
Epoch 11/100
190/190 - 0s - 3ms/step - loss: 0.0946 - val_loss: 0.2665
Epoch 12/100
190/190 - 1s - 3ms/step - loss: 0.0924 - val_loss: 0.2591
Epoch 13/100
190/190 - 0s - 3ms/step - loss: 0.0916 - val_loss: 0.2645
Epoch 14/100
190/190 - 1s - 3ms/step - loss: 0.0874 - val_loss: 0.2563
Epoch 15/100
190/190 - 0s - 3ms/step - loss: 0.0871 - val_loss: 0.2588
Epoch 16/100
190/190 - 1s - 3ms/step - loss: 0.0874 - val_loss: 0.2557
Epoch 17/100
190/190 - 0s - 3ms/step - loss: 0.0839 - val_loss: 0.2565
Epoch 18/100
190/190 - 1s - 3ms/step - loss: 0.0818 - val_loss: 0.2527
Epoch 19/100
190/190 - 1s - 3ms/step - loss: 0.0811 - val_loss: 0.2498
Epoch 20/100
190/190 - 0s - 3ms/step - loss: 0.0791 - val_loss: 0.2502
Epoch 21/100
190/190 - 0s - 3ms/step - loss: 0.0787 - val_loss: 0.2476
Epoch 22/100
190/190 - 0s - 3ms/step - loss: 0.0771 - val_loss: 0.2518
Epoch 23/100
190/190 - 0s - 3ms/step - loss: 0.0765 - val_loss: 0.2500
Epoch 24/100
190/190 - 0s - 3ms/step - loss: 0.0748 - val_loss: 0.2490
Epoch 25/100
190/190 - 0s - 3ms/step - loss: 0.0748 - val_loss: 0.2456
Epoch 26/100
190/190 - 0s - 3ms/step - loss: 0.0742 - val_loss: 0.2461
Epoch 27/100
190/190 - 1s - 3ms/step - loss: 0.0712 - val_loss: 0.2403
Epoch 28/100
190/190 - 0s - 3ms/step - loss: 0.0716 - val_loss: 0.2499
Epoch 29/100
190/190 - 0s - 3ms/step - loss: 0.0706 - val_loss: 0.2445
Epoch 30/100
190/190 - 0s - 3ms/step - loss: 0.0710 - val_loss: 0.2472
Epoch 31/100
190/190 - 0s - 3ms/step - loss: 0.0682 - val_loss: 0.2432
Epoch 32/100
190/190 - 0s - 3ms/step - loss: 0.0672 - val_loss: 0.2443
Epoch 33/100
190/190 - 0s - 3ms/step - loss: 0.0671 - val_loss: 0.2427
Epoch 34/100
190/190 - 0s - 3ms/step - loss: 0.0673 - val_loss: 0.2370
Epoch 35/100
190/190 - 0s - 3ms/step - loss: 0.0662 - val_loss: 0.2437
Epoch 36/100
190/190 - 0s - 3ms/step - loss: 0.0650 - val_loss: 0.2422
Epoch 37/100
190/190 - 0s - 3ms/step - loss: 0.0656 - val_loss: 0.2406
Epoch 38/100
190/190 - 0s - 3ms/step - loss: 0.0634 - val_loss: 0.2444
Epoch 39/100
190/190 - 0s - 3ms/step - loss: 0.0630 - val_loss: 0.2404
Epoch 40/100
190/190 - 0s - 3ms/step - loss: 0.0625 - val_loss: 0.2420
Epoch 41/100
190/190 - 0s - 3ms/step - loss: 0.0627 - val_loss: 0.2444
Epoch 42/100
190/190 - 0s - 3ms/step - loss: 0.0620 - val_loss: 0.2462
Epoch 43/100
190/190 - 0s - 3ms/step - loss: 0.0620 - val_loss: 0.2419
Epoch 44/100
190/190 - 0s - 3ms/step - loss: 0.0598 - val_loss: 0.2471
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4119
Per-joint RMSE: 0.4937 0.6764 0.3444 0.2601 0.2674 0.2427
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:34:41.423630: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:34:41.448419: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 09:34:42.308408: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:42.313108: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:42.313899: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:42.315713: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:42.316523: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:42.317407: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:42.398646: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:42.399548: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:42.400294: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:42.401028: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:34:42.693980: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/45
  done 45/45

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.480756e-01  RMSE=4.980718e-01
  per-joint RMSE: 0.5570 0.8608 0.4265 0.3126 0.3007 0.2593
Residual LSTM:  MSE=1.696554e-01      RMSE=4.118924e-01
  per-joint RMSE: 0.4937 0.6764 0.3444 0.2601 0.2674 0.2427
Combined torque MSE=1.696554e-01     RMSE=4.118924e-01
  per-joint RMSE: 0.4937 0.6764 0.3444 0.2601 0.2674 0.2427
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400.npz --H 25 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400.json
H=25, n_dof=6, feature_dim=18
X_train: (60727, 25, 18)  Y_train: (60727, 6)
X_test : (23900, 25, 18)  Y_test : (23900, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:34:45.338124: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:34:45.361702: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep400.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (60727, 25, 18), Y_train = (60727, 6)
  X_test  = (23900, 25, 18),  Y_test  = (23900, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:34:46.547444: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:46.552166: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:46.553076: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:46.554774: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:46.555681: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:46.556542: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:46.659482: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:46.660382: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:46.661183: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:34:46.661972: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:34:47.629538: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
190/190 - 2s - 10ms/step - loss: 0.2258 - val_loss: 0.2785
Epoch 2/100
190/190 - 0s - 3ms/step - loss: 0.1316 - val_loss: 0.2447
Epoch 3/100
190/190 - 0s - 3ms/step - loss: 0.1135 - val_loss: 0.2313
Epoch 4/100
190/190 - 0s - 3ms/step - loss: 0.1036 - val_loss: 0.2256
Epoch 5/100
190/190 - 0s - 2ms/step - loss: 0.0965 - val_loss: 0.2263
Epoch 6/100
190/190 - 1s - 3ms/step - loss: 0.0910 - val_loss: 0.2212
Epoch 7/100
190/190 - 0s - 3ms/step - loss: 0.0871 - val_loss: 0.2145
Epoch 8/100
190/190 - 0s - 3ms/step - loss: 0.0844 - val_loss: 0.2164
Epoch 9/100
190/190 - 0s - 3ms/step - loss: 0.0824 - val_loss: 0.2114
Epoch 10/100
190/190 - 0s - 3ms/step - loss: 0.0789 - val_loss: 0.2123
Epoch 11/100
190/190 - 0s - 3ms/step - loss: 0.0763 - val_loss: 0.2119
Epoch 12/100
190/190 - 0s - 3ms/step - loss: 0.0754 - val_loss: 0.2091
Epoch 13/100
190/190 - 0s - 3ms/step - loss: 0.0725 - val_loss: 0.2082
Epoch 14/100
190/190 - 0s - 3ms/step - loss: 0.0722 - val_loss: 0.2080
Epoch 15/100
190/190 - 0s - 3ms/step - loss: 0.0699 - val_loss: 0.2008
Epoch 16/100
190/190 - 0s - 2ms/step - loss: 0.0697 - val_loss: 0.2035
Epoch 17/100
190/190 - 0s - 3ms/step - loss: 0.0684 - val_loss: 0.2036
Epoch 18/100
190/190 - 0s - 3ms/step - loss: 0.0664 - val_loss: 0.1990
Epoch 19/100
190/190 - 0s - 3ms/step - loss: 0.0659 - val_loss: 0.1995
Epoch 20/100
190/190 - 1s - 3ms/step - loss: 0.0650 - val_loss: 0.1973
Epoch 21/100
190/190 - 0s - 3ms/step - loss: 0.0646 - val_loss: 0.1961
Epoch 22/100
190/190 - 0s - 3ms/step - loss: 0.0634 - val_loss: 0.1974
Epoch 23/100
190/190 - 0s - 3ms/step - loss: 0.0624 - val_loss: 0.1951
Epoch 24/100
190/190 - 0s - 3ms/step - loss: 0.0626 - val_loss: 0.1999
Epoch 25/100
190/190 - 0s - 3ms/step - loss: 0.0610 - val_loss: 0.1969
Epoch 26/100
190/190 - 0s - 3ms/step - loss: 0.0610 - val_loss: 0.2004
Epoch 27/100
190/190 - 0s - 2ms/step - loss: 0.0601 - val_loss: 0.1953
Epoch 28/100
190/190 - 0s - 3ms/step - loss: 0.0590 - val_loss: 0.1934
Epoch 29/100
190/190 - 0s - 3ms/step - loss: 0.0590 - val_loss: 0.1956
Epoch 30/100
190/190 - 0s - 3ms/step - loss: 0.0579 - val_loss: 0.1940
Epoch 31/100
190/190 - 0s - 3ms/step - loss: 0.0576 - val_loss: 0.1954
Epoch 32/100
190/190 - 0s - 3ms/step - loss: 0.0573 - val_loss: 0.1933
Epoch 33/100
190/190 - 0s - 3ms/step - loss: 0.0565 - val_loss: 0.1914
Epoch 34/100
190/190 - 0s - 3ms/step - loss: 0.0555 - val_loss: 0.1953
Epoch 35/100
190/190 - 0s - 2ms/step - loss: 0.0551 - val_loss: 0.1922
Epoch 36/100
190/190 - 0s - 3ms/step - loss: 0.0549 - val_loss: 0.1934
Epoch 37/100
190/190 - 0s - 2ms/step - loss: 0.0550 - val_loss: 0.1922
Epoch 38/100
190/190 - 0s - 2ms/step - loss: 0.0539 - val_loss: 0.1936
Epoch 39/100
190/190 - 0s - 3ms/step - loss: 0.0535 - val_loss: 0.1925
Epoch 40/100
190/190 - 0s - 3ms/step - loss: 0.0533 - val_loss: 0.1944
Epoch 41/100
190/190 - 0s - 2ms/step - loss: 0.0525 - val_loss: 0.1939
Epoch 42/100
190/190 - 0s - 3ms/step - loss: 0.0523 - val_loss: 0.1950
Epoch 43/100
190/190 - 0s - 3ms/step - loss: 0.0522 - val_loss: 0.1927
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3827
Per-joint RMSE: 0.4351 0.6410 0.3359 0.2477 0.2462 0.2092
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:35:10.202918: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:35:10.227562: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 09:35:11.095347: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:35:11.100001: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:35:11.100851: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:35:11.102568: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:35:11.103420: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:35:11.104203: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:35:11.187453: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:35:11.188337: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:35:11.189129: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:35:11.189909: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:35:11.485004: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/45
  done 45/45

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.480756e-01  RMSE=4.980718e-01
  per-joint RMSE: 0.5570 0.8608 0.4265 0.3126 0.3007 0.2593
Residual LSTM:  MSE=1.464539e-01      RMSE=3.826930e-01
  per-joint RMSE: 0.4351 0.6410 0.3359 0.2477 0.2462 0.2092
Combined torque MSE=1.464539e-01     RMSE=3.826930e-01
  per-joint RMSE: 0.4351 0.6410 0.3359 0.2477 0.2462 0.2092
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400.npz --H 50 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400.json
H=50, n_dof=6, feature_dim=24
X_train: (59202, 50, 24)  Y_train: (59202, 6)
X_test : (23275, 50, 24)  Y_test : (23275, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:35:14.377316: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:35:14.400890: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep400.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (59202, 50, 24), Y_train = (59202, 6)
  X_test  = (23275, 50, 24),  Y_test  = (23275, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:35:15.898092: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:35:15.903056: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:35:15.904366: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:35:15.906611: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:35:15.907544: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:35:15.908292: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:35:15.996617: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:35:15.997622: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:35:15.998419: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:35:15.999207: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:35:17.063746: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
186/186 - 2s - 11ms/step - loss: 0.2236 - val_loss: 0.3083
Epoch 2/100
186/186 - 1s - 4ms/step - loss: 0.1284 - val_loss: 0.2649
Epoch 3/100
186/186 - 1s - 4ms/step - loss: 0.1111 - val_loss: 0.2423
Epoch 4/100
186/186 - 1s - 4ms/step - loss: 0.1024 - val_loss: 0.2271
Epoch 5/100
186/186 - 1s - 4ms/step - loss: 0.0951 - val_loss: 0.2133
Epoch 6/100
186/186 - 1s - 4ms/step - loss: 0.0911 - val_loss: 0.2053
Epoch 7/100
186/186 - 1s - 4ms/step - loss: 0.0877 - val_loss: 0.2046
Epoch 8/100
186/186 - 1s - 4ms/step - loss: 0.0845 - val_loss: 0.2012
Epoch 9/100
186/186 - 1s - 4ms/step - loss: 0.0822 - val_loss: 0.1982
Epoch 10/100
186/186 - 1s - 4ms/step - loss: 0.0796 - val_loss: 0.1923
Epoch 11/100
186/186 - 1s - 4ms/step - loss: 0.0771 - val_loss: 0.1872
Epoch 12/100
186/186 - 1s - 4ms/step - loss: 0.0754 - val_loss: 0.1876
Epoch 13/100
186/186 - 1s - 4ms/step - loss: 0.0745 - val_loss: 0.1847
Epoch 14/100
186/186 - 1s - 4ms/step - loss: 0.0726 - val_loss: 0.1818
Epoch 15/100
186/186 - 1s - 4ms/step - loss: 0.0714 - val_loss: 0.1799
Epoch 16/100
186/186 - 1s - 4ms/step - loss: 0.0695 - val_loss: 0.1808
Epoch 17/100
186/186 - 1s - 4ms/step - loss: 0.0682 - val_loss: 0.1766
Epoch 18/100
186/186 - 1s - 4ms/step - loss: 0.0688 - val_loss: 0.1728
Epoch 19/100
186/186 - 1s - 4ms/step - loss: 0.0680 - val_loss: 0.1728
Epoch 20/100
186/186 - 1s - 4ms/step - loss: 0.0659 - val_loss: 0.1745
Epoch 21/100
186/186 - 1s - 4ms/step - loss: 0.0655 - val_loss: 0.1727
Epoch 22/100
186/186 - 1s - 4ms/step - loss: 0.0644 - val_loss: 0.1708
Epoch 23/100
186/186 - 1s - 4ms/step - loss: 0.0650 - val_loss: 0.1715
Epoch 24/100
186/186 - 1s - 4ms/step - loss: 0.0637 - val_loss: 0.1701
Epoch 25/100
186/186 - 1s - 4ms/step - loss: 0.0623 - val_loss: 0.1719
Epoch 26/100
186/186 - 1s - 4ms/step - loss: 0.0608 - val_loss: 0.1675
Epoch 27/100
186/186 - 1s - 4ms/step - loss: 0.0612 - val_loss: 0.1678
Epoch 28/100
186/186 - 1s - 4ms/step - loss: 0.0598 - val_loss: 0.1669
Epoch 29/100
186/186 - 1s - 4ms/step - loss: 0.0593 - val_loss: 0.1679
Epoch 30/100
186/186 - 1s - 4ms/step - loss: 0.0581 - val_loss: 0.1653
Epoch 31/100
186/186 - 1s - 4ms/step - loss: 0.0580 - val_loss: 0.1639
Epoch 32/100
186/186 - 1s - 4ms/step - loss: 0.0573 - val_loss: 0.1647
Epoch 33/100
186/186 - 1s - 4ms/step - loss: 0.0568 - val_loss: 0.1658
Epoch 34/100
186/186 - 1s - 4ms/step - loss: 0.0572 - val_loss: 0.1654
Epoch 35/100
186/186 - 1s - 4ms/step - loss: 0.0563 - val_loss: 0.1669
Epoch 36/100
186/186 - 1s - 4ms/step - loss: 0.0551 - val_loss: 0.1629
Epoch 37/100
186/186 - 1s - 4ms/step - loss: 0.0542 - val_loss: 0.1628
Epoch 38/100
186/186 - 1s - 4ms/step - loss: 0.0542 - val_loss: 0.1655
Epoch 39/100
186/186 - 1s - 4ms/step - loss: 0.0537 - val_loss: 0.1635
Epoch 40/100
186/186 - 1s - 4ms/step - loss: 0.0532 - val_loss: 0.1612
Epoch 41/100
186/186 - 1s - 4ms/step - loss: 0.0521 - val_loss: 0.1604
Epoch 42/100
186/186 - 1s - 4ms/step - loss: 0.0524 - val_loss: 0.1597
Epoch 43/100
186/186 - 1s - 4ms/step - loss: 0.0521 - val_loss: 0.1635
Epoch 44/100
186/186 - 1s - 4ms/step - loss: 0.0512 - val_loss: 0.1578
Epoch 45/100
186/186 - 1s - 4ms/step - loss: 0.0511 - val_loss: 0.1635
Epoch 46/100
186/186 - 1s - 4ms/step - loss: 0.0508 - val_loss: 0.1604
Epoch 47/100
186/186 - 1s - 4ms/step - loss: 0.0497 - val_loss: 0.1599
Epoch 48/100
186/186 - 1s - 4ms/step - loss: 0.0489 - val_loss: 0.1590
Epoch 49/100
186/186 - 1s - 4ms/step - loss: 0.0484 - val_loss: 0.1599
Epoch 50/100
186/186 - 1s - 4ms/step - loss: 0.0488 - val_loss: 0.1621
Epoch 51/100
186/186 - 1s - 4ms/step - loss: 0.0487 - val_loss: 0.1569
Epoch 52/100
186/186 - 1s - 4ms/step - loss: 0.0481 - val_loss: 0.1579
Epoch 53/100
186/186 - 1s - 4ms/step - loss: 0.0480 - val_loss: 0.1537
Epoch 54/100
186/186 - 1s - 4ms/step - loss: 0.0469 - val_loss: 0.1553
Epoch 55/100
186/186 - 1s - 4ms/step - loss: 0.0468 - val_loss: 0.1560
Epoch 56/100
186/186 - 1s - 4ms/step - loss: 0.0458 - val_loss: 0.1518
Epoch 57/100
186/186 - 1s - 4ms/step - loss: 0.0459 - val_loss: 0.1552
Epoch 58/100
186/186 - 1s - 4ms/step - loss: 0.0456 - val_loss: 0.1556
Epoch 59/100
186/186 - 1s - 4ms/step - loss: 0.0452 - val_loss: 0.1552
Epoch 60/100
186/186 - 1s - 4ms/step - loss: 0.0449 - val_loss: 0.1560
Epoch 61/100
186/186 - 1s - 4ms/step - loss: 0.0444 - val_loss: 0.1534
Epoch 62/100
186/186 - 1s - 4ms/step - loss: 0.0442 - val_loss: 0.1549
Epoch 63/100
186/186 - 1s - 4ms/step - loss: 0.0441 - val_loss: 0.1550
Epoch 64/100
186/186 - 1s - 4ms/step - loss: 0.0440 - val_loss: 0.1560
Epoch 65/100
186/186 - 1s - 4ms/step - loss: 0.0442 - val_loss: 0.1535
Epoch 66/100
186/186 - 1s - 4ms/step - loss: 0.0440 - val_loss: 0.1565
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3724
Per-joint RMSE: 0.4320 0.6006 0.3466 0.2493 0.2469 0.2032
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:36:06.551502: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:36:06.576445: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 09:36:07.452279: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:07.456839: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:07.457643: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:07.459339: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:07.463171: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:07.463917: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:07.549665: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:07.550511: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:07.551265: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:07.551991: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:36:07.845196: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/45
  done 45/45

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.512152e-01  RMSE=5.012138e-01
  per-joint RMSE: 0.5605 0.8668 0.4286 0.3151 0.3024 0.2596
Residual LSTM:  MSE=1.386525e-01      RMSE=3.723608e-01
  per-joint RMSE: 0.4320 0.6006 0.3466 0.2493 0.2469 0.2032
Combined torque MSE=1.386525e-01     RMSE=3.723608e-01
  per-joint RMSE: 0.4320 0.6006 0.3466 0.2493 0.2469 0.2032
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400.npz --H 50 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400.json
H=50, n_dof=6, feature_dim=6
X_train: (59202, 50, 6)  Y_train: (59202, 6)
X_test : (23275, 50, 6)  Y_test : (23275, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:36:10.475386: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:36:10.499992: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep400.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (59202, 50, 6), Y_train = (59202, 6)
  X_test  = (23275, 50, 6),  Y_test  = (23275, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:36:11.675564: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:11.680359: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:11.681271: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:11.683002: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:11.683917: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:11.684787: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:11.769525: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:11.770465: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:11.771457: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:11.772304: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:36:12.736859: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
186/186 - 2s - 11ms/step - loss: 0.6978 - val_loss: 0.7990
Epoch 2/100
186/186 - 1s - 4ms/step - loss: 0.4285 - val_loss: 0.6417
Epoch 3/100
186/186 - 1s - 4ms/step - loss: 0.3145 - val_loss: 0.6898
Epoch 4/100
186/186 - 1s - 4ms/step - loss: 0.2588 - val_loss: 0.6944
Epoch 5/100
186/186 - 1s - 4ms/step - loss: 0.2441 - val_loss: 0.5441
Epoch 6/100
186/186 - 1s - 4ms/step - loss: 0.2138 - val_loss: 0.6377
Epoch 7/100
186/186 - 1s - 4ms/step - loss: 0.2200 - val_loss: 0.4863
Epoch 8/100
186/186 - 1s - 4ms/step - loss: 0.2233 - val_loss: 0.6238
Epoch 9/100
186/186 - 1s - 4ms/step - loss: 0.1963 - val_loss: 0.7853
Epoch 10/100
186/186 - 1s - 4ms/step - loss: 0.1965 - val_loss: 0.7566
Epoch 11/100
186/186 - 1s - 4ms/step - loss: 0.2241 - val_loss: 0.5279
Epoch 12/100
186/186 - 1s - 4ms/step - loss: 0.1934 - val_loss: 0.6169
Epoch 13/100
186/186 - 1s - 4ms/step - loss: 0.1751 - val_loss: 0.8459
Epoch 14/100
186/186 - 1s - 4ms/step - loss: 0.1636 - val_loss: 0.7737
Epoch 15/100
186/186 - 1s - 4ms/step - loss: 0.1863 - val_loss: 0.7377
Epoch 16/100
186/186 - 1s - 4ms/step - loss: 0.1528 - val_loss: 0.7718
Epoch 17/100
186/186 - 1s - 4ms/step - loss: 0.1350 - val_loss: 0.7478
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4260
Per-joint RMSE: 0.5242 0.6731 0.3733 0.2806 0.2639 0.2707
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:36:26.777790: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:36:26.802729: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 09:36:27.666063: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:27.670734: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:27.671528: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:27.673340: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:27.674218: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:27.674955: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:27.754230: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:27.755064: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:27.755810: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:27.756540: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:36:28.048083: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/45
  done 45/45

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.512152e-01  RMSE=5.012138e-01
  per-joint RMSE: 0.5605 0.8668 0.4286 0.3151 0.3024 0.2596
Residual LSTM:  MSE=1.814880e-01      RMSE=4.260141e-01
  per-joint RMSE: 0.5242 0.6731 0.3733 0.2806 0.2639 0.2707
Combined torque MSE=1.814880e-01     RMSE=4.260141e-01
  per-joint RMSE: 0.5242 0.6731 0.3733 0.2806 0.2639 0.2707
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400.npz --H 50 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400.json
H=50, n_dof=6, feature_dim=18
X_train: (59202, 50, 18)  Y_train: (59202, 6)
X_test : (23275, 50, 18)  Y_test : (23275, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:36:30.939426: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:36:30.963069: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep400.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (59202, 50, 18), Y_train = (59202, 6)
  X_test  = (23275, 50, 18),  Y_test  = (23275, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:36:32.344381: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:32.349196: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:32.350123: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:32.351991: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:32.353017: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:32.353937: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:32.442809: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:32.443703: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:32.444688: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:32.445466: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:36:33.486286: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
186/186 - 2s - 11ms/step - loss: 0.2527 - val_loss: 0.3381
Epoch 2/100
186/186 - 1s - 4ms/step - loss: 0.1570 - val_loss: 0.3069
Epoch 3/100
186/186 - 1s - 4ms/step - loss: 0.1358 - val_loss: 0.3011
Epoch 4/100
186/186 - 1s - 4ms/step - loss: 0.1276 - val_loss: 0.3011
Epoch 5/100
186/186 - 1s - 4ms/step - loss: 0.1193 - val_loss: 0.2990
Epoch 6/100
186/186 - 1s - 4ms/step - loss: 0.1138 - val_loss: 0.2924
Epoch 7/100
186/186 - 1s - 4ms/step - loss: 0.1082 - val_loss: 0.2908
Epoch 8/100
186/186 - 1s - 4ms/step - loss: 0.1072 - val_loss: 0.2802
Epoch 9/100
186/186 - 1s - 4ms/step - loss: 0.1020 - val_loss: 0.2818
Epoch 10/100
186/186 - 1s - 4ms/step - loss: 0.0993 - val_loss: 0.2815
Epoch 11/100
186/186 - 1s - 4ms/step - loss: 0.0959 - val_loss: 0.2729
Epoch 12/100
186/186 - 1s - 4ms/step - loss: 0.0938 - val_loss: 0.2655
Epoch 13/100
186/186 - 1s - 4ms/step - loss: 0.0916 - val_loss: 0.2625
Epoch 14/100
186/186 - 1s - 4ms/step - loss: 0.0896 - val_loss: 0.2597
Epoch 15/100
186/186 - 1s - 4ms/step - loss: 0.0862 - val_loss: 0.2594
Epoch 16/100
186/186 - 1s - 4ms/step - loss: 0.0860 - val_loss: 0.2524
Epoch 17/100
186/186 - 1s - 4ms/step - loss: 0.0873 - val_loss: 0.2473
Epoch 18/100
186/186 - 1s - 4ms/step - loss: 0.0839 - val_loss: 0.2500
Epoch 19/100
186/186 - 1s - 4ms/step - loss: 0.0825 - val_loss: 0.2538
Epoch 20/100
186/186 - 1s - 4ms/step - loss: 0.0793 - val_loss: 0.2505
Epoch 21/100
186/186 - 1s - 4ms/step - loss: 0.0786 - val_loss: 0.2582
Epoch 22/100
186/186 - 1s - 4ms/step - loss: 0.0803 - val_loss: 0.2568
Epoch 23/100
186/186 - 1s - 4ms/step - loss: 0.0772 - val_loss: 0.2521
Epoch 24/100
186/186 - 1s - 4ms/step - loss: 0.0773 - val_loss: 0.2476
Epoch 25/100
186/186 - 1s - 4ms/step - loss: 0.0755 - val_loss: 0.2487
Epoch 26/100
186/186 - 1s - 4ms/step - loss: 0.0752 - val_loss: 0.2487
Epoch 27/100
186/186 - 1s - 4ms/step - loss: 0.0728 - val_loss: 0.2498
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4183
Per-joint RMSE: 0.5063 0.6643 0.3626 0.2738 0.2864 0.2529
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:36:55.224232: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:36:55.249037: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 09:36:56.114711: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:56.119376: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:56.120165: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:56.121823: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:56.122622: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:56.123358: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:56.200354: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:56.201185: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:56.201925: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:36:56.202647: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:36:56.497374: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/45
  done 45/45

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.512152e-01  RMSE=5.012138e-01
  per-joint RMSE: 0.5605 0.8668 0.4286 0.3151 0.3024 0.2596
Residual LSTM:  MSE=1.750111e-01      RMSE=4.183433e-01
  per-joint RMSE: 0.5063 0.6643 0.3626 0.2738 0.2864 0.2529
Combined torque MSE=1.750111e-01     RMSE=4.183433e-01
  per-joint RMSE: 0.5063 0.6643 0.3626 0.2738 0.2864 0.2529
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400.npz --H 50 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400.json
H=50, n_dof=6, feature_dim=18
X_train: (59202, 50, 18)  Y_train: (59202, 6)
X_test : (23275, 50, 18)  Y_test : (23275, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:36:59.331010: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:36:59.354460: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep400.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (59202, 50, 18), Y_train = (59202, 6)
  X_test  = (23275, 50, 18),  Y_test  = (23275, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:37:00.755277: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:37:00.759965: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:37:00.760871: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:37:00.762670: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:37:00.763571: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:37:00.764419: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:37:00.893656: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:37:00.894551: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:37:00.895349: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:37:00.896173: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:37:01.953091: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
186/186 - 2s - 11ms/step - loss: 0.2245 - val_loss: 0.2821
Epoch 2/100
186/186 - 1s - 4ms/step - loss: 0.1312 - val_loss: 0.2402
Epoch 3/100
186/186 - 1s - 4ms/step - loss: 0.1125 - val_loss: 0.2287
Epoch 4/100
186/186 - 1s - 4ms/step - loss: 0.1037 - val_loss: 0.2228
Epoch 5/100
186/186 - 1s - 4ms/step - loss: 0.0964 - val_loss: 0.2186
Epoch 6/100
186/186 - 1s - 4ms/step - loss: 0.0915 - val_loss: 0.2164
Epoch 7/100
186/186 - 1s - 4ms/step - loss: 0.0874 - val_loss: 0.2165
Epoch 8/100
186/186 - 1s - 4ms/step - loss: 0.0846 - val_loss: 0.2164
Epoch 9/100
186/186 - 1s - 4ms/step - loss: 0.0833 - val_loss: 0.2152
Epoch 10/100
186/186 - 1s - 4ms/step - loss: 0.0790 - val_loss: 0.2151
Epoch 11/100
186/186 - 1s - 4ms/step - loss: 0.0764 - val_loss: 0.2130
Epoch 12/100
186/186 - 1s - 4ms/step - loss: 0.0752 - val_loss: 0.2134
Epoch 13/100
186/186 - 1s - 4ms/step - loss: 0.0732 - val_loss: 0.2102
Epoch 14/100
186/186 - 1s - 4ms/step - loss: 0.0714 - val_loss: 0.2114
Epoch 15/100
186/186 - 1s - 4ms/step - loss: 0.0695 - val_loss: 0.2049
Epoch 16/100
186/186 - 1s - 4ms/step - loss: 0.0686 - val_loss: 0.2062
Epoch 17/100
186/186 - 1s - 4ms/step - loss: 0.0674 - val_loss: 0.2035
Epoch 18/100
186/186 - 1s - 4ms/step - loss: 0.0672 - val_loss: 0.1995
Epoch 19/100
186/186 - 1s - 4ms/step - loss: 0.0652 - val_loss: 0.1962
Epoch 20/100
186/186 - 1s - 4ms/step - loss: 0.0640 - val_loss: 0.1960
Epoch 21/100
186/186 - 1s - 4ms/step - loss: 0.0635 - val_loss: 0.1945
Epoch 22/100
186/186 - 1s - 4ms/step - loss: 0.0636 - val_loss: 0.1921
Epoch 23/100
186/186 - 1s - 4ms/step - loss: 0.0627 - val_loss: 0.1911
Epoch 24/100
186/186 - 1s - 4ms/step - loss: 0.0613 - val_loss: 0.1909
Epoch 25/100
186/186 - 1s - 4ms/step - loss: 0.0608 - val_loss: 0.1893
Epoch 26/100
186/186 - 1s - 4ms/step - loss: 0.0601 - val_loss: 0.1893
Epoch 27/100
186/186 - 1s - 4ms/step - loss: 0.0597 - val_loss: 0.1855
Epoch 28/100
186/186 - 1s - 4ms/step - loss: 0.0594 - val_loss: 0.1862
Epoch 29/100
186/186 - 1s - 4ms/step - loss: 0.0590 - val_loss: 0.1854
Epoch 30/100
186/186 - 1s - 4ms/step - loss: 0.0574 - val_loss: 0.1838
Epoch 31/100
186/186 - 1s - 4ms/step - loss: 0.0572 - val_loss: 0.1839
Epoch 32/100
186/186 - 1s - 4ms/step - loss: 0.0575 - val_loss: 0.1880
Epoch 33/100
186/186 - 1s - 4ms/step - loss: 0.0566 - val_loss: 0.1856
Epoch 34/100
186/186 - 1s - 4ms/step - loss: 0.0560 - val_loss: 0.1862
Epoch 35/100
186/186 - 1s - 4ms/step - loss: 0.0552 - val_loss: 0.1837
Epoch 36/100
186/186 - 1s - 4ms/step - loss: 0.0544 - val_loss: 0.1840
Epoch 37/100
186/186 - 1s - 4ms/step - loss: 0.0542 - val_loss: 0.1849
Epoch 38/100
186/186 - 1s - 4ms/step - loss: 0.0550 - val_loss: 0.1853
Epoch 39/100
186/186 - 1s - 4ms/step - loss: 0.0535 - val_loss: 0.1842
Epoch 40/100
186/186 - 1s - 4ms/step - loss: 0.0530 - val_loss: 0.1846
Epoch 41/100
186/186 - 1s - 4ms/step - loss: 0.0532 - val_loss: 0.1833
Epoch 42/100
186/186 - 1s - 4ms/step - loss: 0.0520 - val_loss: 0.1831
Epoch 43/100
186/186 - 1s - 4ms/step - loss: 0.0518 - val_loss: 0.1823
Epoch 44/100
186/186 - 1s - 4ms/step - loss: 0.0515 - val_loss: 0.1849
Epoch 45/100
186/186 - 1s - 4ms/step - loss: 0.0507 - val_loss: 0.1812
Epoch 46/100
186/186 - 1s - 4ms/step - loss: 0.0503 - val_loss: 0.1812
Epoch 47/100
186/186 - 1s - 4ms/step - loss: 0.0497 - val_loss: 0.1827
Epoch 48/100
186/186 - 1s - 4ms/step - loss: 0.0499 - val_loss: 0.1844
Epoch 49/100
186/186 - 1s - 4ms/step - loss: 0.0490 - val_loss: 0.1845
Epoch 50/100
186/186 - 1s - 4ms/step - loss: 0.0486 - val_loss: 0.1817
Epoch 51/100
186/186 - 1s - 4ms/step - loss: 0.0483 - val_loss: 0.1823
Epoch 52/100
186/186 - 1s - 4ms/step - loss: 0.0481 - val_loss: 0.1801
Epoch 53/100
186/186 - 1s - 4ms/step - loss: 0.0477 - val_loss: 0.1797
Epoch 54/100
186/186 - 1s - 4ms/step - loss: 0.0468 - val_loss: 0.1786
Epoch 55/100
186/186 - 1s - 4ms/step - loss: 0.0465 - val_loss: 0.1762
Epoch 56/100
186/186 - 1s - 4ms/step - loss: 0.0459 - val_loss: 0.1788
Epoch 57/100
186/186 - 1s - 4ms/step - loss: 0.0455 - val_loss: 0.1782
Epoch 58/100
186/186 - 1s - 4ms/step - loss: 0.0453 - val_loss: 0.1776
Epoch 59/100
186/186 - 1s - 4ms/step - loss: 0.0451 - val_loss: 0.1781
Epoch 60/100
186/186 - 1s - 4ms/step - loss: 0.0449 - val_loss: 0.1770
Epoch 61/100
186/186 - 1s - 4ms/step - loss: 0.0447 - val_loss: 0.1790
Epoch 62/100
186/186 - 1s - 4ms/step - loss: 0.0450 - val_loss: 0.1764
Epoch 63/100
186/186 - 1s - 4ms/step - loss: 0.0437 - val_loss: 0.1811
Epoch 64/100
186/186 - 1s - 4ms/step - loss: 0.0439 - val_loss: 0.1779
Epoch 65/100
186/186 - 1s - 4ms/step - loss: 0.0435 - val_loss: 0.1774
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3856
Per-joint RMSE: 0.4270 0.6577 0.3430 0.2426 0.2408 0.2071
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:37:51.898010: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:37:51.925299: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s1_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 09:37:52.777662: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:37:52.782577: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:37:52.783377: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:37:52.785132: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:37:52.785918: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:37:52.786655: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:37:52.860046: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:37:52.860878: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:37:52.861619: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:37:52.862355: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:37:53.154384: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/45
  done 45/45

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.512152e-01  RMSE=5.012138e-01
  per-joint RMSE: 0.5605 0.8668 0.4286 0.3151 0.3024 0.2596
Residual LSTM:  MSE=1.487029e-01      RMSE=3.856201e-01
  per-joint RMSE: 0.4270 0.6577 0.3430 0.2426 0.2408 0.2071
Combined torque MSE=1.487029e-01     RMSE=3.856201e-01
  per-joint RMSE: 0.4270 0.6577 0.3430 0.2426 0.2408 0.2071
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s1_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=2                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz                                ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed2_dataset.npz -t structured -s 2 -r 0 --hp_preset fast_debug --epochs 400 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400.jax' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 400, 'lagrangian_type': <function structured_lagrangian_fn at 0x70e4095601f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed2_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed2_dataset.npz
   dt ≈ 0.02208891656001752
  dof = 6
  Train trajectories = 105
  Test trajectories  = 45
  Train samples = 62323
  Test samples  = 24560
################################################

2026-01-22 09:37:57.987663: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400 | type=structured | dof=6
################################################
2026-01-22 09:38:01.159763: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:38:01.159808: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:38:01.159817: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:38:01.159847: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:38:01.159854: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:38:01.159872: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:38:01.159913: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:38:01.159921: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:38:01.159940: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:38:01.159946: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.2s, Loss=7.97e+00, Inv=7.97e+00, For=9.21e+01, Power=2.45e+00
  [eval] test_mse=1.396e+00  (n=24560)
Epoch 00050: Time=  15.2s, Loss=2.84e+00, Inv=2.84e+00, For=1.06e+02, Power=1.38e+00
Epoch 00100: Time=  23.8s, Loss=2.61e+00, Inv=2.61e+00, For=1.51e+02, Power=1.29e+00
Epoch 00150: Time=  32.0s, Loss=2.50e+00, Inv=2.50e+00, For=1.77e+02, Power=1.26e+00
Epoch 00200: Time=  40.3s, Loss=2.44e+00, Inv=2.44e+00, For=2.27e+02, Power=1.24e+00
  [eval] test_mse=1.232e+00  (n=24560)
Epoch 00250: Time=  48.6s, Loss=2.40e+00, Inv=2.40e+00, For=2.82e+02, Power=1.23e+00
Epoch 00300: Time=  57.3s, Loss=2.37e+00, Inv=2.37e+00, For=3.29e+02, Power=1.22e+00
Epoch 00350: Time=  65.6s, Loss=2.35e+00, Inv=2.35e+00, For=4.23e+02, Power=1.21e+00
Epoch 00400: Time=  74.0s, Loss=2.33e+00, Inv=2.33e+00, For=5.49e+02, Power=1.20e+00
  [eval] test_mse=1.371e+00  (n=24560)
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400
Torque MSE  = 2.285e-01
Torque RMSE = 4.780e-01
Per-joint MSE : 3.013e-01 6.911e-01 1.672e-01 7.855e-02 7.093e-02 6.162e-02
Per-joint RMSE: 5.489e-01 8.313e-01 4.090e-01 2.803e-01 2.663e-01 2.482e-01
Comp Time per Sample = 1.338e-08s / 74725864.8Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed2_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K150_tf0p3_seed2_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep400.jax
Detected n_dof=6 (seed=2)
2026-01-22 09:39:17.343136: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 105 trajectories
2026-01-22 09:39:18.649155: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:39:18.649167: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:39:20.293889: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:39:20.293903: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:39:21.717819: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:39:22.885354: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/105
2026-01-22 09:39:24.074242: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:39:24.074276: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:39:24.074282: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 50/105
2026-01-22 09:39:25.648617: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 09:39:26.904390: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 75/105
2026-01-22 09:39:28.275599: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 100/105
  done 105/105

Exporting split=test: 45 trajectories
  done 25/45
  done 45/45

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400.npz --H 25 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400.json
H=25, n_dof=6, feature_dim=24
X_train: (60727, 25, 24)  Y_train: (60727, 6)
X_test : (23900, 25, 24)  Y_test : (23900, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:39:32.026656: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:39:32.050766: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep400.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (60727, 25, 24), Y_train = (60727, 6)
  X_test  = (23900, 25, 24),  Y_test  = (23900, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:39:33.273372: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:33.278218: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:33.279143: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:33.281087: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:33.282014: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:33.282892: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:33.373652: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:33.374627: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:33.375420: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:33.376200: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8975 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:39:34.379144: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
190/190 - 2s - 10ms/step - loss: 0.2270 - val_loss: 0.2868
Epoch 2/100
190/190 - 0s - 3ms/step - loss: 0.1280 - val_loss: 0.2535
Epoch 3/100
190/190 - 1s - 3ms/step - loss: 0.1115 - val_loss: 0.2313
Epoch 4/100
190/190 - 1s - 3ms/step - loss: 0.1018 - val_loss: 0.2185
Epoch 5/100
190/190 - 0s - 3ms/step - loss: 0.0957 - val_loss: 0.2057
Epoch 6/100
190/190 - 1s - 3ms/step - loss: 0.0914 - val_loss: 0.2005
Epoch 7/100
190/190 - 1s - 3ms/step - loss: 0.0864 - val_loss: 0.1955
Epoch 8/100
190/190 - 1s - 3ms/step - loss: 0.0836 - val_loss: 0.1919
Epoch 9/100
190/190 - 1s - 3ms/step - loss: 0.0814 - val_loss: 0.1900
Epoch 10/100
190/190 - 1s - 3ms/step - loss: 0.0786 - val_loss: 0.1846
Epoch 11/100
190/190 - 0s - 3ms/step - loss: 0.0767 - val_loss: 0.1853
Epoch 12/100
190/190 - 1s - 3ms/step - loss: 0.0747 - val_loss: 0.1800
Epoch 13/100
190/190 - 1s - 3ms/step - loss: 0.0729 - val_loss: 0.1764
Epoch 14/100
190/190 - 1s - 3ms/step - loss: 0.0713 - val_loss: 0.1760
Epoch 15/100
190/190 - 1s - 3ms/step - loss: 0.0702 - val_loss: 0.1732
Epoch 16/100
190/190 - 0s - 3ms/step - loss: 0.0691 - val_loss: 0.1736
Epoch 17/100
190/190 - 0s - 3ms/step - loss: 0.0687 - val_loss: 0.1702
Epoch 18/100
190/190 - 0s - 3ms/step - loss: 0.0681 - val_loss: 0.1704
Epoch 19/100
190/190 - 0s - 3ms/step - loss: 0.0670 - val_loss: 0.1720
Epoch 20/100
190/190 - 0s - 3ms/step - loss: 0.0650 - val_loss: 0.1683
Epoch 21/100
190/190 - 0s - 3ms/step - loss: 0.0637 - val_loss: 0.1663
Epoch 22/100
190/190 - 0s - 3ms/step - loss: 0.0634 - val_loss: 0.1670
Epoch 23/100
190/190 - 0s - 3ms/step - loss: 0.0625 - val_loss: 0.1661
Epoch 24/100
190/190 - 1s - 3ms/step - loss: 0.0613 - val_loss: 0.1658
Epoch 25/100
190/190 - 1s - 3ms/step - loss: 0.0613 - val_loss: 0.1616
Epoch 26/100
190/190 - 1s - 3ms/step - loss: 0.0601 - val_loss: 0.1612
Epoch 27/100
190/190 - 0s - 3ms/step - loss: 0.0593 - val_loss: 0.1599
Epoch 28/100
190/190 - 0s - 3ms/step - loss: 0.0588 - val_loss: 0.1630
Epoch 29/100
190/190 - 0s - 3ms/step - loss: 0.0583 - val_loss: 0.1621
Epoch 30/100
190/190 - 0s - 3ms/step - loss: 0.0579 - val_loss: 0.1615
Epoch 31/100
190/190 - 0s - 3ms/step - loss: 0.0567 - val_loss: 0.1609
Epoch 32/100
190/190 - 0s - 3ms/step - loss: 0.0564 - val_loss: 0.1613
Epoch 33/100
190/190 - 0s - 3ms/step - loss: 0.0566 - val_loss: 0.1618
Epoch 34/100
190/190 - 0s - 3ms/step - loss: 0.0563 - val_loss: 0.1609
Epoch 35/100
190/190 - 0s - 3ms/step - loss: 0.0548 - val_loss: 0.1637
Epoch 36/100
190/190 - 0s - 3ms/step - loss: 0.0548 - val_loss: 0.1608
Epoch 37/100
190/190 - 0s - 3ms/step - loss: 0.0544 - val_loss: 0.1636
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3402
Per-joint RMSE: 0.4107 0.5579 0.3046 0.2024 0.2006 0.2012
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:39:54.419913: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:39:54.444500: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 09:39:55.300511: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:55.305075: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:55.305866: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:55.307463: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:55.308251: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:55.308995: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:55.384521: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:55.385356: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:55.386108: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:55.386842: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:39:55.683582: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/45
  done 45/45

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.308459e-01  RMSE=4.804642e-01
  per-joint RMSE: 0.5521 0.8363 0.4093 0.2818 0.2675 0.2499
Residual LSTM:  MSE=1.157339e-01      RMSE=3.401969e-01
  per-joint RMSE: 0.4107 0.5579 0.3046 0.2024 0.2006 0.2012
Combined torque MSE=1.157339e-01     RMSE=3.401969e-01
  per-joint RMSE: 0.4107 0.5579 0.3046 0.2024 0.2006 0.2012
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400.npz --H 25 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400.json
H=25, n_dof=6, feature_dim=6
X_train: (60727, 25, 6)  Y_train: (60727, 6)
X_test : (23900, 25, 6)  Y_test : (23900, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:39:58.200407: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:39:58.224666: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep400.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (60727, 25, 6), Y_train = (60727, 6)
  X_test  = (23900, 25, 6),  Y_test  = (23900, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:39:59.282847: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:59.287380: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:59.288177: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:59.289832: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:59.290629: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:59.291366: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:59.367100: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:59.367942: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:59.368687: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:39:59.369423: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:40:00.320388: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
190/190 - 2s - 10ms/step - loss: 0.7467 - val_loss: 0.6981
Epoch 2/100
190/190 - 1s - 3ms/step - loss: 0.5165 - val_loss: 0.6352
Epoch 3/100
190/190 - 1s - 3ms/step - loss: 0.4361 - val_loss: 0.6091
Epoch 4/100
190/190 - 0s - 3ms/step - loss: 0.3705 - val_loss: 0.5984
Epoch 5/100
190/190 - 0s - 3ms/step - loss: 0.3022 - val_loss: 0.7488
Epoch 6/100
190/190 - 1s - 3ms/step - loss: 0.2590 - val_loss: 0.7630
Epoch 7/100
190/190 - 0s - 3ms/step - loss: 0.2430 - val_loss: 0.8203
Epoch 8/100
190/190 - 0s - 3ms/step - loss: 0.2171 - val_loss: 0.6259
Epoch 9/100
190/190 - 0s - 3ms/step - loss: 0.1823 - val_loss: 0.6054
Epoch 10/100
190/190 - 0s - 3ms/step - loss: 0.1850 - val_loss: 0.7609
Epoch 11/100
190/190 - 0s - 3ms/step - loss: 0.1945 - val_loss: 0.6370
Epoch 12/100
190/190 - 1s - 3ms/step - loss: 0.1850 - val_loss: 0.5268
Epoch 13/100
190/190 - 0s - 3ms/step - loss: 0.1579 - val_loss: 0.6433
Epoch 14/100
190/190 - 0s - 3ms/step - loss: 0.1446 - val_loss: 0.7000
Epoch 15/100
190/190 - 0s - 3ms/step - loss: 0.1433 - val_loss: 0.5574
Epoch 16/100
190/190 - 0s - 3ms/step - loss: 0.1448 - val_loss: 0.5353
Epoch 17/100
190/190 - 0s - 3ms/step - loss: 0.1582 - val_loss: 0.5683
Epoch 18/100
190/190 - 0s - 3ms/step - loss: 0.1390 - val_loss: 0.6979
Epoch 19/100
190/190 - 0s - 3ms/step - loss: 0.1255 - val_loss: 0.6667
Epoch 20/100
190/190 - 0s - 3ms/step - loss: 0.1405 - val_loss: 0.6999
Epoch 21/100
190/190 - 0s - 3ms/step - loss: 0.1307 - val_loss: 0.6566
Epoch 22/100
190/190 - 0s - 3ms/step - loss: 0.1128 - val_loss: 0.6418
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4067
Per-joint RMSE: 0.4918 0.6691 0.3439 0.2457 0.2396 0.2582
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:40:12.829440: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:40:12.854282: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 09:40:13.700946: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:13.705628: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:13.706420: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:13.708041: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:13.708834: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:13.709578: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:13.791005: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:13.791843: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:13.792584: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:13.793313: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:40:14.084863: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/45
  done 45/45

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.308459e-01  RMSE=4.804642e-01
  per-joint RMSE: 0.5521 0.8363 0.4093 0.2818 0.2675 0.2499
Residual LSTM:  MSE=1.653901e-01      RMSE=4.066818e-01
  per-joint RMSE: 0.4919 0.6691 0.3439 0.2457 0.2396 0.2582
Combined torque MSE=1.653901e-01     RMSE=4.066818e-01
  per-joint RMSE: 0.4919 0.6691 0.3439 0.2457 0.2396 0.2582
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400.npz --H 25 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400.json
H=25, n_dof=6, feature_dim=18
X_train: (60727, 25, 18)  Y_train: (60727, 6)
X_test : (23900, 25, 18)  Y_test : (23900, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:40:16.744402: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:40:16.768519: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep400.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (60727, 25, 18), Y_train = (60727, 6)
  X_test  = (23900, 25, 18),  Y_test  = (23900, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:40:17.947329: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:17.952366: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:17.953307: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:17.955171: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:17.956078: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:17.956823: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:18.051031: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:18.051926: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:18.052728: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:18.053529: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:40:18.997433: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
190/190 - 2s - 10ms/step - loss: 0.2508 - val_loss: 0.3424
Epoch 2/100
190/190 - 0s - 3ms/step - loss: 0.1549 - val_loss: 0.3313
Epoch 3/100
190/190 - 1s - 3ms/step - loss: 0.1352 - val_loss: 0.3225
Epoch 4/100
190/190 - 1s - 3ms/step - loss: 0.1252 - val_loss: 0.3166
Epoch 5/100
190/190 - 0s - 3ms/step - loss: 0.1176 - val_loss: 0.3038
Epoch 6/100
190/190 - 1s - 3ms/step - loss: 0.1126 - val_loss: 0.2978
Epoch 7/100
190/190 - 0s - 3ms/step - loss: 0.1077 - val_loss: 0.2975
Epoch 8/100
190/190 - 1s - 3ms/step - loss: 0.1049 - val_loss: 0.2901
Epoch 9/100
190/190 - 0s - 3ms/step - loss: 0.1023 - val_loss: 0.2896
Epoch 10/100
190/190 - 0s - 3ms/step - loss: 0.0998 - val_loss: 0.2823
Epoch 11/100
190/190 - 1s - 3ms/step - loss: 0.0960 - val_loss: 0.2789
Epoch 12/100
190/190 - 0s - 3ms/step - loss: 0.0950 - val_loss: 0.2751
Epoch 13/100
190/190 - 0s - 3ms/step - loss: 0.0928 - val_loss: 0.2727
Epoch 14/100
190/190 - 0s - 2ms/step - loss: 0.0912 - val_loss: 0.2743
Epoch 15/100
190/190 - 0s - 3ms/step - loss: 0.0889 - val_loss: 0.2709
Epoch 16/100
190/190 - 0s - 3ms/step - loss: 0.0879 - val_loss: 0.2732
Epoch 17/100
190/190 - 0s - 3ms/step - loss: 0.0862 - val_loss: 0.2713
Epoch 18/100
190/190 - 0s - 3ms/step - loss: 0.0844 - val_loss: 0.2641
Epoch 19/100
190/190 - 0s - 3ms/step - loss: 0.0832 - val_loss: 0.2695
Epoch 20/100
190/190 - 0s - 3ms/step - loss: 0.0821 - val_loss: 0.2737
Epoch 21/100
190/190 - 0s - 3ms/step - loss: 0.0797 - val_loss: 0.2667
Epoch 22/100
190/190 - 0s - 3ms/step - loss: 0.0776 - val_loss: 0.2685
Epoch 23/100
190/190 - 0s - 3ms/step - loss: 0.0788 - val_loss: 0.2700
Epoch 24/100
190/190 - 0s - 3ms/step - loss: 0.0758 - val_loss: 0.2673
Epoch 25/100
190/190 - 0s - 2ms/step - loss: 0.0776 - val_loss: 0.2712
Epoch 26/100
190/190 - 1s - 3ms/step - loss: 0.0765 - val_loss: 0.2638
Epoch 27/100
190/190 - 0s - 3ms/step - loss: 0.0743 - val_loss: 0.2732
Epoch 28/100
190/190 - 0s - 3ms/step - loss: 0.0732 - val_loss: 0.2669
Epoch 29/100
190/190 - 0s - 3ms/step - loss: 0.0731 - val_loss: 0.2630
Epoch 30/100
190/190 - 0s - 3ms/step - loss: 0.0715 - val_loss: 0.2640
Epoch 31/100
190/190 - 0s - 3ms/step - loss: 0.0730 - val_loss: 0.2699
Epoch 32/100
190/190 - 0s - 3ms/step - loss: 0.0704 - val_loss: 0.2686
Epoch 33/100
190/190 - 0s - 3ms/step - loss: 0.0698 - val_loss: 0.2579
Epoch 34/100
190/190 - 0s - 3ms/step - loss: 0.0678 - val_loss: 0.2668
Epoch 35/100
190/190 - 0s - 3ms/step - loss: 0.0664 - val_loss: 0.2665
Epoch 36/100
190/190 - 0s - 3ms/step - loss: 0.0682 - val_loss: 0.2664
Epoch 37/100
190/190 - 0s - 3ms/step - loss: 0.0669 - val_loss: 0.2674
Epoch 38/100
190/190 - 0s - 3ms/step - loss: 0.0656 - val_loss: 0.2665
Epoch 39/100
190/190 - 0s - 3ms/step - loss: 0.0660 - val_loss: 0.2657
Epoch 40/100
190/190 - 0s - 3ms/step - loss: 0.0639 - val_loss: 0.2640
Epoch 41/100
190/190 - 0s - 3ms/step - loss: 0.0636 - val_loss: 0.2713
Epoch 42/100
190/190 - 0s - 3ms/step - loss: 0.0635 - val_loss: 0.2657
Epoch 43/100
190/190 - 0s - 3ms/step - loss: 0.0623 - val_loss: 0.2667
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3924
Per-joint RMSE: 0.4959 0.6296 0.3367 0.2299 0.2420 0.2382
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:40:41.759509: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:40:41.783546: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 09:40:42.624817: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:42.629382: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:42.630177: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:42.631817: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:42.632614: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:42.633357: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:42.709537: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:42.710452: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:42.711199: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:42.711931: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:40:43.005020: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/45
  done 45/45

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.308459e-01  RMSE=4.804642e-01
  per-joint RMSE: 0.5521 0.8363 0.4093 0.2818 0.2675 0.2499
Residual LSTM:  MSE=1.539664e-01      RMSE=3.923855e-01
  per-joint RMSE: 0.4959 0.6296 0.3367 0.2299 0.2420 0.2382
Combined torque MSE=1.539664e-01     RMSE=3.923855e-01
  per-joint RMSE: 0.4959 0.6296 0.3367 0.2299 0.2420 0.2382
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400.npz --H 25 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400.json
H=25, n_dof=6, feature_dim=18
X_train: (60727, 25, 18)  Y_train: (60727, 6)
X_test : (23900, 25, 18)  Y_test : (23900, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:40:45.645131: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:40:45.669016: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep400.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (60727, 25, 18), Y_train = (60727, 6)
  X_test  = (23900, 25, 18),  Y_test  = (23900, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:40:46.842196: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:46.846959: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:46.848003: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:46.849912: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:46.850970: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:46.852011: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:46.947027: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:46.947929: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:46.948731: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:40:46.949521: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:40:47.934222: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
190/190 - 2s - 10ms/step - loss: 0.2248 - val_loss: 0.2931
Epoch 2/100
190/190 - 1s - 3ms/step - loss: 0.1315 - val_loss: 0.2469
Epoch 3/100
190/190 - 1s - 3ms/step - loss: 0.1132 - val_loss: 0.2380
Epoch 4/100
190/190 - 1s - 3ms/step - loss: 0.1038 - val_loss: 0.2274
Epoch 5/100
190/190 - 1s - 3ms/step - loss: 0.0966 - val_loss: 0.2207
Epoch 6/100
190/190 - 1s - 3ms/step - loss: 0.0917 - val_loss: 0.2109
Epoch 7/100
190/190 - 1s - 3ms/step - loss: 0.0880 - val_loss: 0.2096
Epoch 8/100
190/190 - 1s - 3ms/step - loss: 0.0840 - val_loss: 0.2033
Epoch 9/100
190/190 - 0s - 3ms/step - loss: 0.0817 - val_loss: 0.1996
Epoch 10/100
190/190 - 0s - 3ms/step - loss: 0.0782 - val_loss: 0.1938
Epoch 11/100
190/190 - 1s - 3ms/step - loss: 0.0769 - val_loss: 0.1880
Epoch 12/100
190/190 - 1s - 3ms/step - loss: 0.0744 - val_loss: 0.1872
Epoch 13/100
190/190 - 0s - 3ms/step - loss: 0.0732 - val_loss: 0.1844
Epoch 14/100
190/190 - 1s - 3ms/step - loss: 0.0720 - val_loss: 0.1809
Epoch 15/100
190/190 - 0s - 3ms/step - loss: 0.0697 - val_loss: 0.1805
Epoch 16/100
190/190 - 1s - 3ms/step - loss: 0.0688 - val_loss: 0.1756
Epoch 17/100
190/190 - 0s - 3ms/step - loss: 0.0681 - val_loss: 0.1758
Epoch 18/100
190/190 - 1s - 3ms/step - loss: 0.0670 - val_loss: 0.1747
Epoch 19/100
190/190 - 0s - 3ms/step - loss: 0.0656 - val_loss: 0.1730
Epoch 20/100
190/190 - 1s - 3ms/step - loss: 0.0648 - val_loss: 0.1727
Epoch 21/100
190/190 - 1s - 3ms/step - loss: 0.0643 - val_loss: 0.1695
Epoch 22/100
190/190 - 0s - 3ms/step - loss: 0.0633 - val_loss: 0.1732
Epoch 23/100
190/190 - 1s - 3ms/step - loss: 0.0626 - val_loss: 0.1678
Epoch 24/100
190/190 - 0s - 3ms/step - loss: 0.0620 - val_loss: 0.1676
Epoch 25/100
190/190 - 1s - 3ms/step - loss: 0.0612 - val_loss: 0.1673
Epoch 26/100
190/190 - 0s - 3ms/step - loss: 0.0604 - val_loss: 0.1684
Epoch 27/100
190/190 - 1s - 3ms/step - loss: 0.0592 - val_loss: 0.1666
Epoch 28/100
190/190 - 0s - 3ms/step - loss: 0.0585 - val_loss: 0.1655
Epoch 29/100
190/190 - 1s - 3ms/step - loss: 0.0578 - val_loss: 0.1652
Epoch 30/100
190/190 - 0s - 3ms/step - loss: 0.0575 - val_loss: 0.1609
Epoch 31/100
190/190 - 0s - 3ms/step - loss: 0.0571 - val_loss: 0.1648
Epoch 32/100
190/190 - 0s - 3ms/step - loss: 0.0566 - val_loss: 0.1634
Epoch 33/100
190/190 - 0s - 3ms/step - loss: 0.0574 - val_loss: 0.1610
Epoch 34/100
190/190 - 0s - 3ms/step - loss: 0.0552 - val_loss: 0.1625
Epoch 35/100
190/190 - 0s - 3ms/step - loss: 0.0566 - val_loss: 0.1634
Epoch 36/100
190/190 - 0s - 3ms/step - loss: 0.0548 - val_loss: 0.1628
Epoch 37/100
190/190 - 0s - 3ms/step - loss: 0.0537 - val_loss: 0.1627
Epoch 38/100
190/190 - 0s - 3ms/step - loss: 0.0534 - val_loss: 0.1611
Epoch 39/100
190/190 - 0s - 3ms/step - loss: 0.0529 - val_loss: 0.1619
Epoch 40/100
190/190 - 1s - 3ms/step - loss: 0.0525 - val_loss: 0.1588
Epoch 41/100
190/190 - 0s - 3ms/step - loss: 0.0518 - val_loss: 0.1614
Epoch 42/100
190/190 - 0s - 3ms/step - loss: 0.0516 - val_loss: 0.1654
Epoch 43/100
190/190 - 0s - 3ms/step - loss: 0.0509 - val_loss: 0.1643
Epoch 44/100
190/190 - 0s - 3ms/step - loss: 0.0501 - val_loss: 0.1648
Epoch 45/100
190/190 - 0s - 3ms/step - loss: 0.0500 - val_loss: 0.1635
Epoch 46/100
190/190 - 0s - 3ms/step - loss: 0.0493 - val_loss: 0.1631
Epoch 47/100
190/190 - 0s - 3ms/step - loss: 0.0490 - val_loss: 0.1649
Epoch 48/100
190/190 - 0s - 3ms/step - loss: 0.0493 - val_loss: 0.1630
Epoch 49/100
190/190 - 0s - 3ms/step - loss: 0.0479 - val_loss: 0.1621
Epoch 50/100
190/190 - 0s - 3ms/step - loss: 0.0477 - val_loss: 0.1652
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3478
Per-joint RMSE: 0.4029 0.5797 0.3173 0.2102 0.2063 0.2005
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:41:14.521292: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:41:14.545813: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 09:41:15.393566: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:15.398671: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:15.399461: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:15.401264: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:15.402155: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:15.402957: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:15.481763: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:15.482603: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:15.483352: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:15.484075: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:41:15.779628: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/45
  done 45/45

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.308459e-01  RMSE=4.804642e-01
  per-joint RMSE: 0.5521 0.8363 0.4093 0.2818 0.2675 0.2499
Residual LSTM:  MSE=1.209925e-01      RMSE=3.478397e-01
  per-joint RMSE: 0.4029 0.5797 0.3173 0.2102 0.2063 0.2005
Combined torque MSE=1.209925e-01     RMSE=3.478397e-01
  per-joint RMSE: 0.4029 0.5797 0.3173 0.2102 0.2063 0.2005
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H25_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400.npz --H 50 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400.json
H=50, n_dof=6, feature_dim=24
X_train: (59202, 50, 24)  Y_train: (59202, 6)
X_test : (23275, 50, 24)  Y_test : (23275, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:41:18.693627: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:41:18.717551: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep400.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (59202, 50, 24), Y_train = (59202, 6)
  X_test  = (23275, 50, 24),  Y_test  = (23275, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:41:20.276647: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:20.281607: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:20.282502: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:20.284301: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:20.285213: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:20.286095: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:20.373688: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:20.374654: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:20.375464: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:20.376262: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:41:21.471104: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
186/186 - 2s - 11ms/step - loss: 0.2216 - val_loss: 0.2780
Epoch 2/100
186/186 - 1s - 4ms/step - loss: 0.1319 - val_loss: 0.2334
Epoch 3/100
186/186 - 1s - 4ms/step - loss: 0.1145 - val_loss: 0.2130
Epoch 4/100
186/186 - 1s - 4ms/step - loss: 0.1032 - val_loss: 0.2049
Epoch 5/100
186/186 - 1s - 4ms/step - loss: 0.0968 - val_loss: 0.1965
Epoch 6/100
186/186 - 1s - 4ms/step - loss: 0.0920 - val_loss: 0.2026
Epoch 7/100
186/186 - 1s - 4ms/step - loss: 0.0891 - val_loss: 0.1879
Epoch 8/100
186/186 - 1s - 4ms/step - loss: 0.0856 - val_loss: 0.1890
Epoch 9/100
186/186 - 1s - 4ms/step - loss: 0.0826 - val_loss: 0.1821
Epoch 10/100
186/186 - 1s - 4ms/step - loss: 0.0791 - val_loss: 0.1774
Epoch 11/100
186/186 - 1s - 4ms/step - loss: 0.0772 - val_loss: 0.1769
Epoch 12/100
186/186 - 1s - 4ms/step - loss: 0.0747 - val_loss: 0.1745
Epoch 13/100
186/186 - 1s - 4ms/step - loss: 0.0730 - val_loss: 0.1750
Epoch 14/100
186/186 - 1s - 4ms/step - loss: 0.0736 - val_loss: 0.1715
Epoch 15/100
186/186 - 1s - 4ms/step - loss: 0.0708 - val_loss: 0.1659
Epoch 16/100
186/186 - 1s - 4ms/step - loss: 0.0697 - val_loss: 0.1621
Epoch 17/100
186/186 - 1s - 4ms/step - loss: 0.0685 - val_loss: 0.1638
Epoch 18/100
186/186 - 1s - 4ms/step - loss: 0.0665 - val_loss: 0.1631
Epoch 19/100
186/186 - 1s - 4ms/step - loss: 0.0662 - val_loss: 0.1607
Epoch 20/100
186/186 - 1s - 4ms/step - loss: 0.0651 - val_loss: 0.1595
Epoch 21/100
186/186 - 1s - 4ms/step - loss: 0.0640 - val_loss: 0.1606
Epoch 22/100
186/186 - 1s - 4ms/step - loss: 0.0629 - val_loss: 0.1589
Epoch 23/100
186/186 - 1s - 4ms/step - loss: 0.0629 - val_loss: 0.1574
Epoch 24/100
186/186 - 1s - 4ms/step - loss: 0.0616 - val_loss: 0.1592
Epoch 25/100
186/186 - 1s - 4ms/step - loss: 0.0607 - val_loss: 0.1596
Epoch 26/100
186/186 - 1s - 4ms/step - loss: 0.0602 - val_loss: 0.1581
Epoch 27/100
186/186 - 1s - 4ms/step - loss: 0.0596 - val_loss: 0.1560
Epoch 28/100
186/186 - 1s - 4ms/step - loss: 0.0585 - val_loss: 0.1560
Epoch 29/100
186/186 - 1s - 4ms/step - loss: 0.0586 - val_loss: 0.1560
Epoch 30/100
186/186 - 1s - 4ms/step - loss: 0.0585 - val_loss: 0.1563
Epoch 31/100
186/186 - 1s - 4ms/step - loss: 0.0578 - val_loss: 0.1546
Epoch 32/100
186/186 - 1s - 4ms/step - loss: 0.0564 - val_loss: 0.1590
Epoch 33/100
186/186 - 1s - 4ms/step - loss: 0.0561 - val_loss: 0.1567
Epoch 34/100
186/186 - 1s - 4ms/step - loss: 0.0557 - val_loss: 0.1535
Epoch 35/100
186/186 - 1s - 4ms/step - loss: 0.0546 - val_loss: 0.1541
Epoch 36/100
186/186 - 1s - 4ms/step - loss: 0.0547 - val_loss: 0.1565
Epoch 37/100
186/186 - 1s - 4ms/step - loss: 0.0540 - val_loss: 0.1549
Epoch 38/100
186/186 - 1s - 4ms/step - loss: 0.0543 - val_loss: 0.1527
Epoch 39/100
186/186 - 1s - 4ms/step - loss: 0.0544 - val_loss: 0.1545
Epoch 40/100
186/186 - 1s - 4ms/step - loss: 0.0532 - val_loss: 0.1567
Epoch 41/100
186/186 - 1s - 4ms/step - loss: 0.0541 - val_loss: 0.1578
Epoch 42/100
186/186 - 1s - 4ms/step - loss: 0.0541 - val_loss: 0.1583
Epoch 43/100
186/186 - 1s - 4ms/step - loss: 0.0530 - val_loss: 0.1586
Epoch 44/100
186/186 - 1s - 4ms/step - loss: 0.0517 - val_loss: 0.1584
Epoch 45/100
186/186 - 1s - 4ms/step - loss: 0.0513 - val_loss: 0.1578
Epoch 46/100
186/186 - 1s - 4ms/step - loss: 0.0510 - val_loss: 0.1605
Epoch 47/100
186/186 - 1s - 4ms/step - loss: 0.0503 - val_loss: 0.1642
Epoch 48/100
186/186 - 1s - 4ms/step - loss: 0.0499 - val_loss: 0.1632
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3444
Per-joint RMSE: 0.4085 0.5706 0.3122 0.2103 0.2031 0.1904
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:41:58.418499: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:41:58.443446: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 09:41:59.316943: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:59.321647: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:59.322437: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:59.324131: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:59.325387: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:59.326303: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:59.409834: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:59.410676: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:59.411418: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:41:59.412153: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:41:59.710459: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/45
  done 45/45

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.331495e-01  RMSE=4.828555e-01
  per-joint RMSE: 0.5549 0.8412 0.4107 0.2836 0.2686 0.2495
Residual LSTM:  MSE=1.186050e-01      RMSE=3.443907e-01
  per-joint RMSE: 0.4085 0.5706 0.3122 0.2103 0.2031 0.1904
Combined torque MSE=1.186050e-01     RMSE=3.443907e-01
  per-joint RMSE: 0.4085 0.5706 0.3122 0.2103 0.2031 0.1904
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_full__lstm_s2_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400.npz --H 50 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400.json
H=50, n_dof=6, feature_dim=6
X_train: (59202, 50, 6)  Y_train: (59202, 6)
X_test : (23275, 50, 6)  Y_test : (23275, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:42:02.350397: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:42:02.375299: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep400.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (59202, 50, 6), Y_train = (59202, 6)
  X_test  = (23275, 50, 6),  Y_test  = (23275, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:42:03.545660: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:03.550389: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:03.551299: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:03.552992: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:03.554163: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:03.555026: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:03.637311: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:03.638275: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:03.639068: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:03.639845: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:42:04.575456: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
186/186 - 2s - 11ms/step - loss: 0.7027 - val_loss: 0.6558
Epoch 2/100
186/186 - 1s - 4ms/step - loss: 0.4434 - val_loss: 0.8872
Epoch 3/100
186/186 - 1s - 4ms/step - loss: 0.3579 - val_loss: 0.7160
Epoch 4/100
186/186 - 1s - 4ms/step - loss: 0.2778 - val_loss: 0.7259
Epoch 5/100
186/186 - 1s - 4ms/step - loss: 0.2537 - val_loss: 0.7077
Epoch 6/100
186/186 - 1s - 4ms/step - loss: 0.2086 - val_loss: 0.6215
Epoch 7/100
186/186 - 1s - 4ms/step - loss: 0.2133 - val_loss: 0.6725
Epoch 8/100
186/186 - 1s - 4ms/step - loss: 0.1990 - val_loss: 0.7862
Epoch 9/100
186/186 - 1s - 4ms/step - loss: 0.1735 - val_loss: 0.6812
Epoch 10/100
186/186 - 1s - 4ms/step - loss: 0.2082 - val_loss: 0.6348
Epoch 11/100
186/186 - 1s - 4ms/step - loss: 0.1832 - val_loss: 0.7272
Epoch 12/100
186/186 - 1s - 4ms/step - loss: 0.1593 - val_loss: 0.7143
Epoch 13/100
186/186 - 1s - 4ms/step - loss: 0.1407 - val_loss: 0.6943
Epoch 14/100
186/186 - 1s - 4ms/step - loss: 0.1318 - val_loss: 0.7294
Epoch 15/100
186/186 - 1s - 4ms/step - loss: 0.1837 - val_loss: 0.7821
Epoch 16/100
186/186 - 1s - 4ms/step - loss: 0.1641 - val_loss: 0.7333
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.4131
Per-joint RMSE: 0.5035 0.6556 0.3701 0.2754 0.2458 0.2594
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:42:17.714078: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:42:17.739532: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 09:42:18.619666: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:18.624382: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:18.625270: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:18.626861: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:18.627658: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:18.628397: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:18.714751: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:18.715676: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:18.716428: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:18.717161: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:42:19.011163: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/45
  done 45/45

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.331495e-01  RMSE=4.828555e-01
  per-joint RMSE: 0.5549 0.8412 0.4107 0.2836 0.2686 0.2495
Residual LSTM:  MSE=1.706471e-01      RMSE=4.130946e-01
  per-joint RMSE: 0.5035 0.6556 0.3701 0.2754 0.2458 0.2594
Combined torque MSE=1.706471e-01     RMSE=4.130946e-01
  per-joint RMSE: 0.5035 0.6556 0.3701 0.2754 0.2458 0.2594
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_tau_hat__lstm_s2_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400.npz --H 50 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400.json
H=50, n_dof=6, feature_dim=18
X_train: (59202, 50, 18)  Y_train: (59202, 6)
X_test : (23275, 50, 18)  Y_test : (23275, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:42:21.865230: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:42:21.889347: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep400.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (59202, 50, 18), Y_train = (59202, 6)
  X_test  = (23275, 50, 18),  Y_test  = (23275, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:42:23.297265: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:23.302198: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:23.303127: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:23.304916: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:23.305829: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:23.306687: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:23.394149: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:23.395263: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:23.396224: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:42:23.397070: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:42:24.459248: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
186/186 - 2s - 11ms/step - loss: 0.2488 - val_loss: 0.3513
Epoch 2/100
186/186 - 1s - 4ms/step - loss: 0.1573 - val_loss: 0.3142
Epoch 3/100
186/186 - 1s - 4ms/step - loss: 0.1370 - val_loss: 0.3008
Epoch 4/100
186/186 - 1s - 4ms/step - loss: 0.1269 - val_loss: 0.2981
Epoch 5/100
186/186 - 1s - 4ms/step - loss: 0.1201 - val_loss: 0.2937
Epoch 6/100
186/186 - 1s - 4ms/step - loss: 0.1159 - val_loss: 0.2916
Epoch 7/100
186/186 - 1s - 4ms/step - loss: 0.1111 - val_loss: 0.2843
Epoch 8/100
186/186 - 1s - 4ms/step - loss: 0.1068 - val_loss: 0.2753
Epoch 9/100
186/186 - 1s - 4ms/step - loss: 0.1046 - val_loss: 0.2723
Epoch 10/100
186/186 - 1s - 4ms/step - loss: 0.1019 - val_loss: 0.2784
Epoch 11/100
186/186 - 1s - 4ms/step - loss: 0.0988 - val_loss: 0.2752
Epoch 12/100
186/186 - 1s - 4ms/step - loss: 0.0968 - val_loss: 0.2669
Epoch 13/100
186/186 - 1s - 4ms/step - loss: 0.0936 - val_loss: 0.2646
Epoch 14/100
186/186 - 1s - 4ms/step - loss: 0.0913 - val_loss: 0.2658
Epoch 15/100
186/186 - 1s - 4ms/step - loss: 0.0894 - val_loss: 0.2622
Epoch 16/100
186/186 - 1s - 4ms/step - loss: 0.0885 - val_loss: 0.2593
Epoch 17/100
186/186 - 1s - 4ms/step - loss: 0.0861 - val_loss: 0.2549
Epoch 18/100
186/186 - 1s - 4ms/step - loss: 0.0844 - val_loss: 0.2604
Epoch 19/100
186/186 - 1s - 4ms/step - loss: 0.0833 - val_loss: 0.2624
Epoch 20/100
186/186 - 1s - 4ms/step - loss: 0.0840 - val_loss: 0.2572
Epoch 21/100
186/186 - 1s - 4ms/step - loss: 0.0816 - val_loss: 0.2577
Epoch 22/100
186/186 - 1s - 4ms/step - loss: 0.0795 - val_loss: 0.2572
Epoch 23/100
186/186 - 1s - 4ms/step - loss: 0.0779 - val_loss: 0.2565
Epoch 24/100
186/186 - 1s - 4ms/step - loss: 0.0777 - val_loss: 0.2578
Epoch 25/100
186/186 - 1s - 4ms/step - loss: 0.0768 - val_loss: 0.2533
Epoch 26/100
186/186 - 1s - 4ms/step - loss: 0.0766 - val_loss: 0.2522
Epoch 27/100
186/186 - 1s - 4ms/step - loss: 0.0751 - val_loss: 0.2482
Epoch 28/100
186/186 - 1s - 4ms/step - loss: 0.0747 - val_loss: 0.2510
Epoch 29/100
186/186 - 1s - 4ms/step - loss: 0.0734 - val_loss: 0.2475
Epoch 30/100
186/186 - 1s - 4ms/step - loss: 0.0727 - val_loss: 0.2534
Epoch 31/100
186/186 - 1s - 4ms/step - loss: 0.0715 - val_loss: 0.2527
Epoch 32/100
186/186 - 1s - 4ms/step - loss: 0.0706 - val_loss: 0.2474
Epoch 33/100
186/186 - 1s - 4ms/step - loss: 0.0705 - val_loss: 0.2437
Epoch 34/100
186/186 - 1s - 4ms/step - loss: 0.0696 - val_loss: 0.2522
Epoch 35/100
186/186 - 1s - 4ms/step - loss: 0.0696 - val_loss: 0.2492
Epoch 36/100
186/186 - 1s - 4ms/step - loss: 0.0681 - val_loss: 0.2484
Epoch 37/100
186/186 - 1s - 4ms/step - loss: 0.0668 - val_loss: 0.2436
Epoch 38/100
186/186 - 1s - 4ms/step - loss: 0.0677 - val_loss: 0.2505
Epoch 39/100
186/186 - 1s - 4ms/step - loss: 0.0674 - val_loss: 0.2462
Epoch 40/100
186/186 - 1s - 4ms/step - loss: 0.0678 - val_loss: 0.2419
Epoch 41/100
186/186 - 1s - 4ms/step - loss: 0.0651 - val_loss: 0.2418
Epoch 42/100
186/186 - 1s - 4ms/step - loss: 0.0648 - val_loss: 0.2445
Epoch 43/100
186/186 - 1s - 4ms/step - loss: 0.0631 - val_loss: 0.2463
Epoch 44/100
186/186 - 1s - 4ms/step - loss: 0.0631 - val_loss: 0.2441
Epoch 45/100
186/186 - 1s - 4ms/step - loss: 0.0612 - val_loss: 0.2414
Epoch 46/100
186/186 - 1s - 4ms/step - loss: 0.0615 - val_loss: 0.2521
Epoch 47/100
186/186 - 1s - 4ms/step - loss: 0.0606 - val_loss: 0.2451
Epoch 48/100
186/186 - 1s - 4ms/step - loss: 0.0608 - val_loss: 0.2480
Epoch 49/100
186/186 - 1s - 4ms/step - loss: 0.0620 - val_loss: 0.2462
Epoch 50/100
186/186 - 1s - 4ms/step - loss: 0.0596 - val_loss: 0.2481
Epoch 51/100
186/186 - 1s - 4ms/step - loss: 0.0598 - val_loss: 0.2489
Epoch 52/100
186/186 - 1s - 4ms/step - loss: 0.0570 - val_loss: 0.2468
Epoch 53/100
186/186 - 1s - 4ms/step - loss: 0.0565 - val_loss: 0.2478
Epoch 54/100
186/186 - 1s - 4ms/step - loss: 0.0568 - val_loss: 0.2465
Epoch 55/100
186/186 - 1s - 4ms/step - loss: 0.0563 - val_loss: 0.2463
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3977
Per-joint RMSE: 0.5057 0.6286 0.3519 0.2379 0.2450 0.2405
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:43:06.855616: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:43:06.880554: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 09:43:07.740633: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:07.745239: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:07.746029: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:07.747677: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:07.748550: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:07.749284: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:07.825046: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:07.825883: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:07.826630: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:07.827367: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:43:08.129791: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/45
  done 45/45

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.331495e-01  RMSE=4.828555e-01
  per-joint RMSE: 0.5549 0.8412 0.4107 0.2836 0.2686 0.2495
Residual LSTM:  MSE=1.582028e-01      RMSE=3.977472e-01
  per-joint RMSE: 0.5057 0.6286 0.3519 0.2379 0.2450 0.2405
Combined torque MSE=1.582028e-01     RMSE=3.977472e-01
  per-joint RMSE: 0.5057 0.6286 0.3519 0.2379 0.2450 0.2405
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state__lstm_s2_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400.npz --H 50 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400.json
H=50, n_dof=6, feature_dim=18
X_train: (59202, 50, 18)  Y_train: (59202, 6)
X_test : (23275, 50, 18)  Y_test : (23275, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 100 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:43:10.980505: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:43:11.005487: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep400.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (59202, 50, 18), Y_train = (59202, 6)
  X_test  = (23275, 50, 18),  Y_test  = (23275, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 09:43:12.396670: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:12.401765: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:12.402672: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:12.404469: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:12.405373: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:12.406110: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:12.502247: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:12.503282: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:12.504143: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:12.505000: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/100
2026-01-22 09:43:13.559927: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
186/186 - 2s - 11ms/step - loss: 0.2273 - val_loss: 0.2895
Epoch 2/100
186/186 - 1s - 4ms/step - loss: 0.1336 - val_loss: 0.2509
Epoch 3/100
186/186 - 1s - 4ms/step - loss: 0.1149 - val_loss: 0.2320
Epoch 4/100
186/186 - 1s - 4ms/step - loss: 0.1075 - val_loss: 0.2249
Epoch 5/100
186/186 - 1s - 4ms/step - loss: 0.0999 - val_loss: 0.2135
Epoch 6/100
186/186 - 1s - 4ms/step - loss: 0.0934 - val_loss: 0.2088
Epoch 7/100
186/186 - 1s - 4ms/step - loss: 0.0899 - val_loss: 0.2027
Epoch 8/100
186/186 - 1s - 4ms/step - loss: 0.0861 - val_loss: 0.1998
Epoch 9/100
186/186 - 1s - 4ms/step - loss: 0.0830 - val_loss: 0.1918
Epoch 10/100
186/186 - 1s - 4ms/step - loss: 0.0819 - val_loss: 0.1895
Epoch 11/100
186/186 - 1s - 4ms/step - loss: 0.0803 - val_loss: 0.1861
Epoch 12/100
186/186 - 1s - 4ms/step - loss: 0.0773 - val_loss: 0.1819
Epoch 13/100
186/186 - 1s - 4ms/step - loss: 0.0750 - val_loss: 0.1816
Epoch 14/100
186/186 - 1s - 4ms/step - loss: 0.0737 - val_loss: 0.1823
Epoch 15/100
186/186 - 1s - 4ms/step - loss: 0.0712 - val_loss: 0.1824
Epoch 16/100
186/186 - 1s - 4ms/step - loss: 0.0706 - val_loss: 0.1786
Epoch 17/100
186/186 - 1s - 4ms/step - loss: 0.0688 - val_loss: 0.1767
Epoch 18/100
186/186 - 1s - 4ms/step - loss: 0.0682 - val_loss: 0.1769
Epoch 19/100
186/186 - 1s - 4ms/step - loss: 0.0678 - val_loss: 0.1782
Epoch 20/100
186/186 - 1s - 4ms/step - loss: 0.0666 - val_loss: 0.1769
Epoch 21/100
186/186 - 1s - 4ms/step - loss: 0.0652 - val_loss: 0.1786
Epoch 22/100
186/186 - 1s - 4ms/step - loss: 0.0644 - val_loss: 0.1729
Epoch 23/100
186/186 - 1s - 4ms/step - loss: 0.0629 - val_loss: 0.1750
Epoch 24/100
186/186 - 1s - 4ms/step - loss: 0.0627 - val_loss: 0.1755
Epoch 25/100
186/186 - 1s - 4ms/step - loss: 0.0630 - val_loss: 0.1756
Epoch 26/100
186/186 - 1s - 4ms/step - loss: 0.0620 - val_loss: 0.1771
Epoch 27/100
186/186 - 1s - 4ms/step - loss: 0.0604 - val_loss: 0.1755
Epoch 28/100
186/186 - 1s - 4ms/step - loss: 0.0598 - val_loss: 0.1761
Epoch 29/100
186/186 - 1s - 4ms/step - loss: 0.0596 - val_loss: 0.1754
Epoch 30/100
186/186 - 1s - 4ms/step - loss: 0.0590 - val_loss: 0.1737
Epoch 31/100
186/186 - 1s - 4ms/step - loss: 0.0583 - val_loss: 0.1711
Epoch 32/100
186/186 - 1s - 4ms/step - loss: 0.0579 - val_loss: 0.1751
Epoch 33/100
186/186 - 1s - 4ms/step - loss: 0.0578 - val_loss: 0.1735
Epoch 34/100
186/186 - 1s - 4ms/step - loss: 0.0567 - val_loss: 0.1720
Epoch 35/100
186/186 - 1s - 4ms/step - loss: 0.0559 - val_loss: 0.1744
Epoch 36/100
186/186 - 1s - 4ms/step - loss: 0.0549 - val_loss: 0.1727
Epoch 37/100
186/186 - 1s - 4ms/step - loss: 0.0549 - val_loss: 0.1766
Epoch 38/100
186/186 - 1s - 4ms/step - loss: 0.0542 - val_loss: 0.1758
Epoch 39/100
186/186 - 1s - 4ms/step - loss: 0.0542 - val_loss: 0.1816
Epoch 40/100
186/186 - 1s - 4ms/step - loss: 0.0534 - val_loss: 0.1786
Epoch 41/100
186/186 - 1s - 4ms/step - loss: 0.0530 - val_loss: 0.1787
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3530
Per-joint RMSE: 0.4130 0.5841 0.3241 0.2181 0.2072 0.2013
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 09:43:45.371649: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 09:43:45.396918: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400/delan_UR3_Load0_combined_26__A__K150_tf0p3__residual__delan_jax_struct_s2_ep400.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 45
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 09:43:46.247802: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:46.252377: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:46.253253: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:46.255124: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:46.255911: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:46.256649: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:46.335387: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:46.336227: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:46.337057: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 09:43:46.337793: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 09:43:46.635785: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/45
  done 45/45

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=2.331495e-01  RMSE=4.828555e-01
  per-joint RMSE: 0.5549 0.8412 0.4107 0.2836 0.2686 0.2495
Residual LSTM:  MSE=1.246330e-01      RMSE=3.530340e-01
  per-joint RMSE: 0.4130 0.5841 0.3241 0.2181 0.2072 0.2013
Combined torque MSE=1.246330e-01     RMSE=3.530340e-01
  per-joint RMSE: 0.4130 0.5841 0.3241 0.2181 0.2072 0.2013
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K150_tf0p3__delan_jax_struct_s2_ep400__feat_state_tauhat__lstm_s2_H50_ep100_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

