####################################################################################################################################################
### RUN: dataset_seed=1 K=84 test_fraction=0.2 val_fraction=0.1                                                                                  ###
### npz_in=/workspace/shared/data/preprocessed/delan_UR3_Load0_5x10^4_under_K84_seed1_dataset/delan_UR3_Load0_5x10^4_under_K84_seed1_dataset.npz ###
####################################################################################################################################################

#####################
### 1) PREPROCESS ###
#####################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_delan_dataset.py --derive_qdd_from_qd True --col_format wide --trajectory_amount 84 --test_fraction 0.2 --val_fraction 0.1 --seed 1 --lowpass_signals True --lowpass_cutoff_hz 10.0 --lowpass_order 4 --lowpass_qdd False --raw_csv /workspace/shared/data/raw/UR3_Load0_5x10^4_under.csv --out_npz /workspace/shared/data/preprocessed/delan_UR3_Load0_5x10^4_under_K84_seed1_dataset/delan_UR3_Load0_5x10^4_under_K84_seed1_dataset.npz' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Saved: /workspace/shared/data/preprocessed/delan_UR3_Load0_5x10^4_under_K84_seed1_dataset/delan_UR3_Load0_5x10^4_under_K84_seed1_dataset.npz
Saved: /workspace/shared/data/preprocessed/delan_UR3_Load0_5x10^4_under_K84_seed1_dataset/delan_UR3_Load0_5x10^4_under_K84_seed1_dataset.json
Trajectories: train=19 val=3 test=5
Exists: True


#####################################
### EXPORT RESIDUALS (best DeLaN) ###
#####################################

======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_UR3_Load0_5x10^4_under_K84_seed1_dataset/delan_UR3_Load0_5x10^4_under_K84_seed1_dataset.npz --ckpt /workspace/shared/models/delan/UR3_Load0_5x10^4_under__best5x10L0__K84__seed1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__seed1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.jax --out /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz' ===
======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_UR3_Load0_5x10^4_under_K84_seed1_dataset/delan_UR3_Load0_5x10^4_under_K84_seed1_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/UR3_Load0_5x10^4_under__best5x10L0__K84__seed1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__seed1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.jax
Detected n_dof=6 (seed=0)
2026-01-30 16:12:51.192641: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 19 trajectories
  done 19/19

Exporting split=test: 5 trajectories
  done 5/5

Saved residual trajectory dataset: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.json


##############################
### CONFIG: feat=full H=50 ###
##############################

#########################################
### BUILD LSTM WINDOWS H=50 feat=full ###
#########################################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --out_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --H 50 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
  out_npz     = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.json
H=50, n_dof=6, feature_dim=24
X_train: (37069, 50, 24)  Y_train: (37069, 6)
X_test : (6755, 50, 24)  Y_test : (6755, 6)
feature_mode=full


##############################
### TRAIN LSTM seed=0 H=50 ###
##############################

==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 0 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:12:58.165581: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:12:58.191130: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-mxqtrsuq because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (37069, 50, 24), Y_train = (37069, 6)
  X_test  = (6755, 50, 24),  Y_test  = (6755, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 16:12:59.547577: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:12:59.553198: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:12:59.554529: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:12:59.556294: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:12:59.557359: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:12:59.558213: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:12:59.639373: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:12:59.640321: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:12:59.641135: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:12:59.641921: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8915 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 16:13:00.708454: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
522/522 - 3s - 6ms/step - loss: 0.1051 - val_loss: 0.1122
Epoch 2/120
522/522 - 2s - 3ms/step - loss: 0.0556 - val_loss: 0.1224
Epoch 3/120
522/522 - 2s - 3ms/step - loss: 0.0466 - val_loss: 0.1259
Epoch 4/120
522/522 - 2s - 3ms/step - loss: 0.0415 - val_loss: 0.1271
Epoch 5/120
522/522 - 2s - 3ms/step - loss: 0.0384 - val_loss: 0.1265
Epoch 6/120
522/522 - 2s - 3ms/step - loss: 0.0361 - val_loss: 0.1275
Epoch 7/120
522/522 - 2s - 3ms/step - loss: 0.0347 - val_loss: 0.1229
Epoch 8/120
522/522 - 2s - 3ms/step - loss: 0.0329 - val_loss: 0.1191
Epoch 9/120
522/522 - 2s - 3ms/step - loss: 0.0320 - val_loss: 0.1109
Epoch 10/120
522/522 - 2s - 3ms/step - loss: 0.0306 - val_loss: 0.1082
Epoch 11/120
522/522 - 2s - 3ms/step - loss: 0.0303 - val_loss: 0.1072
Epoch 12/120
522/522 - 2s - 3ms/step - loss: 0.0293 - val_loss: 0.1068
Epoch 13/120
522/522 - 2s - 3ms/step - loss: 0.0288 - val_loss: 0.1059
Epoch 14/120
522/522 - 2s - 3ms/step - loss: 0.0278 - val_loss: 0.1106
Epoch 15/120
522/522 - 2s - 3ms/step - loss: 0.0273 - val_loss: 0.1101
Epoch 16/120
522/522 - 2s - 3ms/step - loss: 0.0271 - val_loss: 0.1050
Epoch 17/120
522/522 - 2s - 3ms/step - loss: 0.0270 - val_loss: 0.1104
Epoch 18/120
522/522 - 2s - 3ms/step - loss: 0.0267 - val_loss: 0.1136
Epoch 19/120
522/522 - 2s - 3ms/step - loss: 0.0260 - val_loss: 0.1066
Epoch 20/120
522/522 - 2s - 3ms/step - loss: 0.0258 - val_loss: 0.1101
Epoch 21/120
522/522 - 2s - 3ms/step - loss: 0.0256 - val_loss: 0.1119
Epoch 22/120
522/522 - 2s - 3ms/step - loss: 0.0253 - val_loss: 0.1105
Epoch 23/120
522/522 - 2s - 3ms/step - loss: 0.0254 - val_loss: 0.1090
Epoch 24/120
522/522 - 2s - 3ms/step - loss: 0.0248 - val_loss: 0.1146
Epoch 25/120
522/522 - 2s - 3ms/step - loss: 0.0245 - val_loss: 0.1093
Epoch 26/120
522/522 - 2s - 3ms/step - loss: 0.0249 - val_loss: 0.1154
Epoch 27/120
522/522 - 2s - 3ms/step - loss: 0.0244 - val_loss: 0.1058
Epoch 28/120
522/522 - 2s - 3ms/step - loss: 0.0242 - val_loss: 0.1146
Epoch 29/120
522/522 - 2s - 3ms/step - loss: 0.0241 - val_loss: 0.1181
Epoch 30/120
522/522 - 2s - 3ms/step - loss: 0.0239 - val_loss: 0.1096
Epoch 31/120
522/522 - 2s - 3ms/step - loss: 0.0239 - val_loss: 0.1113
Epoch 32/120
522/522 - 2s - 3ms/step - loss: 0.0239 - val_loss: 0.1062
Epoch 33/120
522/522 - 2s - 3ms/step - loss: 0.0237 - val_loss: 0.1090
Epoch 34/120
522/522 - 2s - 3ms/step - loss: 0.0235 - val_loss: 0.1122
Epoch 35/120
522/522 - 2s - 3ms/step - loss: 0.0232 - val_loss: 0.1092
Epoch 36/120
522/522 - 2s - 3ms/step - loss: 0.0232 - val_loss: 0.1083
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.0517
Per-joint RMSE: 0.0505 0.0528 0.0726 0.0419 0.0486 0.0365
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_rmse_time.png


#################################
### COMBINED EVAL seed=0 H=50 ###
#################################

==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/scalers_H50.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2 --H 50 --split test --features full --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl --K 84 --test_fraction 0.2 --seed 0 --dataset_seed 1 --delan_seed -1 --delan_epochs 200 --hp_preset lutter_like_256_wd1e4 --delan_rmse_val 0.5135230657472838 --delan_rmse_test 0.3582080470488492' ===
==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:13:58.396258: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:13:58.422540: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-p4w37sx5 because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-30 16:13:59.422630: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:13:59.427389: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:13:59.428268: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:13:59.429891: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:13:59.430683: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:13:59.431423: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:13:59.518369: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:13:59.519260: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:13:59.520019: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:13:59.520774: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9110 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 16:13:59.820121: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.294841e-01  RMSE=3.598391e-01
  per-joint RMSE: 0.4098 0.5424 0.3822 0.2443 0.2329 0.2341
Residual LSTM:  MSE=2.676729e-03      RMSE=5.173711e-02
  per-joint RMSE: 0.0505 0.0528 0.0726 0.0419 0.0486 0.0365
Combined torque MSE=2.676729e-03     RMSE=5.173712e-02
  per-joint RMSE: 0.0505 0.0528 0.0726 0.0419 0.0486 0.0365
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_test_H50.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_rmse_time_test_H50.png


##############################
### TRAIN LSTM seed=1 H=50 ###
##############################

==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 1 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:14:01.756029: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:14:01.781553: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-y1vu8byf because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (37069, 50, 24), Y_train = (37069, 6)
  X_test  = (6755, 50, 24),  Y_test  = (6755, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 16:14:03.118777: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:14:03.123367: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:14:03.124163: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:14:03.125728: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:14:03.126514: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:14:03.127247: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:14:03.195272: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:14:03.196102: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:14:03.196849: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:14:03.197666: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9117 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 16:14:04.229088: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
522/522 - 3s - 6ms/step - loss: 0.1054 - val_loss: 0.1305
Epoch 2/120
522/522 - 2s - 3ms/step - loss: 0.0554 - val_loss: 0.1184
Epoch 3/120
522/522 - 1s - 3ms/step - loss: 0.0459 - val_loss: 0.1229
Epoch 4/120
522/522 - 2s - 3ms/step - loss: 0.0408 - val_loss: 0.1161
Epoch 5/120
522/522 - 2s - 3ms/step - loss: 0.0381 - val_loss: 0.1227
Epoch 6/120
522/522 - 2s - 3ms/step - loss: 0.0356 - val_loss: 0.1134
Epoch 7/120
522/522 - 2s - 3ms/step - loss: 0.0341 - val_loss: 0.1044
Epoch 8/120
522/522 - 2s - 3ms/step - loss: 0.0329 - val_loss: 0.1144
Epoch 9/120
522/522 - 2s - 3ms/step - loss: 0.0320 - val_loss: 0.1063
Epoch 10/120
522/522 - 2s - 3ms/step - loss: 0.0301 - val_loss: 0.1152
Epoch 11/120
522/522 - 2s - 3ms/step - loss: 0.0299 - val_loss: 0.1082
Epoch 12/120
522/522 - 2s - 3ms/step - loss: 0.0294 - val_loss: 0.1058
Epoch 13/120
522/522 - 2s - 3ms/step - loss: 0.0283 - val_loss: 0.1121
Epoch 14/120
522/522 - 2s - 3ms/step - loss: 0.0282 - val_loss: 0.1031
Epoch 15/120
522/522 - 2s - 3ms/step - loss: 0.0274 - val_loss: 0.1003
Epoch 16/120
522/522 - 2s - 3ms/step - loss: 0.0271 - val_loss: 0.1017
Epoch 17/120
522/522 - 2s - 3ms/step - loss: 0.0276 - val_loss: 0.1036
Epoch 18/120
522/522 - 2s - 3ms/step - loss: 0.0265 - val_loss: 0.1049
Epoch 19/120
522/522 - 2s - 3ms/step - loss: 0.0261 - val_loss: 0.1140
Epoch 20/120
522/522 - 1s - 3ms/step - loss: 0.0258 - val_loss: 0.1076
Epoch 21/120
522/522 - 2s - 3ms/step - loss: 0.0256 - val_loss: 0.1109
Epoch 22/120
522/522 - 2s - 3ms/step - loss: 0.0254 - val_loss: 0.1031
Epoch 23/120
522/522 - 2s - 3ms/step - loss: 0.0250 - val_loss: 0.1050
Epoch 24/120
522/522 - 2s - 3ms/step - loss: 0.0248 - val_loss: 0.1072
Epoch 25/120
522/522 - 2s - 3ms/step - loss: 0.0246 - val_loss: 0.1129
Epoch 26/120
522/522 - 1s - 3ms/step - loss: 0.0245 - val_loss: 0.1070
Epoch 27/120
522/522 - 2s - 3ms/step - loss: 0.0247 - val_loss: 0.1052
Epoch 28/120
522/522 - 2s - 3ms/step - loss: 0.0242 - val_loss: 0.1050
Epoch 29/120
522/522 - 1s - 3ms/step - loss: 0.0242 - val_loss: 0.1058
Epoch 30/120
522/522 - 1s - 3ms/step - loss: 0.0252 - val_loss: 0.1083
Epoch 31/120
522/522 - 2s - 3ms/step - loss: 0.0240 - val_loss: 0.1056
Epoch 32/120
522/522 - 2s - 3ms/step - loss: 0.0236 - val_loss: 0.1026
Epoch 33/120
522/522 - 2s - 3ms/step - loss: 0.0234 - val_loss: 0.1074
Epoch 34/120
522/522 - 2s - 3ms/step - loss: 0.0235 - val_loss: 0.1065
Epoch 35/120
522/522 - 2s - 3ms/step - loss: 0.0235 - val_loss: 0.1087
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.0519
Per-joint RMSE: 0.0510 0.0535 0.0738 0.0398 0.0484 0.0362
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_rmse_time.png


#################################
### COMBINED EVAL seed=1 H=50 ###
#################################

==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/scalers_H50.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2 --H 50 --split test --features full --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl --K 84 --test_fraction 0.2 --seed 1 --dataset_seed 1 --delan_seed -1 --delan_epochs 200 --hp_preset lutter_like_256_wd1e4 --delan_rmse_val 0.5135230657472838 --delan_rmse_test 0.3582080470488492' ===
==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:14:59.717901: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:14:59.745067: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-qou1w8k2 because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-30 16:15:00.762434: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:15:00.767166: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:15:00.768104: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:15:00.769858: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:15:00.770648: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:15:00.771383: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:15:00.850331: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:15:00.851188: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:15:00.851944: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:15:00.852772: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9126 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 16:15:01.153497: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.294841e-01  RMSE=3.598391e-01
  per-joint RMSE: 0.4098 0.5424 0.3822 0.2443 0.2329 0.2341
Residual LSTM:  MSE=2.690446e-03      RMSE=5.186951e-02
  per-joint RMSE: 0.0510 0.0535 0.0738 0.0398 0.0484 0.0362
Combined torque MSE=2.690446e-03     RMSE=5.186951e-02
  per-joint RMSE: 0.0510 0.0535 0.0738 0.0398 0.0484 0.0362
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_test_H50.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_rmse_time_test_H50.png


###############################
### CONFIG: feat=full H=100 ###
###############################

##########################################
### BUILD LSTM WINDOWS H=100 feat=full ###
##########################################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --out_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H100__feat_full__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --H 100 --features full' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
  out_npz     = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H100__feat_full__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
  H           = 100
  feature_mode= full
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H100__feat_full__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H100__feat_full__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H100__feat_full__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H100__feat_full__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.json
H=100, n_dof=6, feature_dim=24
X_train: (36119, 100, 24)  Y_train: (36119, 6)
X_test : (6505, 100, 24)  Y_test : (6505, 6)
feature_mode=full


###############################
### TRAIN LSTM seed=0 H=100 ###
###############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H100__feat_full__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 0 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:15:03.686526: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:15:03.712613: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-9nsc9sm3 because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H100__feat_full__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H100__feat_full__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
   H  = 100
  din = 24
 dout = 6
  X_train = (36119, 100, 24), Y_train = (36119, 6)
  X_test  = (6505, 100, 24),  Y_test  = (6505, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/scalers_H100.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 16:15:05.365179: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:15:05.370459: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:15:05.371371: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:15:05.373044: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:15:05.373943: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:15:05.374796: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:15:05.471228: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:15:05.472231: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:15:05.473116: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:15:05.473901: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9116 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 100, 128)       │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 100, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 16:15:06.581404: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
508/508 - 4s - 7ms/step - loss: 0.1058 - val_loss: 0.1122
Epoch 2/120
508/508 - 2s - 4ms/step - loss: 0.0544 - val_loss: 0.1097
Epoch 3/120
508/508 - 2s - 4ms/step - loss: 0.0461 - val_loss: 0.0960
Epoch 4/120
508/508 - 2s - 4ms/step - loss: 0.0410 - val_loss: 0.0901
Epoch 5/120
508/508 - 2s - 4ms/step - loss: 0.0379 - val_loss: 0.0876
Epoch 6/120
508/508 - 2s - 4ms/step - loss: 0.0354 - val_loss: 0.0918
Epoch 7/120
508/508 - 2s - 4ms/step - loss: 0.0338 - val_loss: 0.0913
Epoch 8/120
508/508 - 2s - 4ms/step - loss: 0.0325 - val_loss: 0.0898
Epoch 9/120
508/508 - 2s - 4ms/step - loss: 0.0313 - val_loss: 0.0911
Epoch 10/120
508/508 - 2s - 4ms/step - loss: 0.0302 - val_loss: 0.0889
Epoch 11/120
508/508 - 2s - 4ms/step - loss: 0.0300 - val_loss: 0.0873
Epoch 12/120
508/508 - 2s - 4ms/step - loss: 0.0292 - val_loss: 0.0817
Epoch 13/120
508/508 - 2s - 4ms/step - loss: 0.0281 - val_loss: 0.0842
Epoch 14/120
508/508 - 2s - 4ms/step - loss: 0.0280 - val_loss: 0.0801
Epoch 15/120
508/508 - 2s - 4ms/step - loss: 0.0275 - val_loss: 0.0843
Epoch 16/120
508/508 - 2s - 4ms/step - loss: 0.0265 - val_loss: 0.0828
Epoch 17/120
508/508 - 2s - 4ms/step - loss: 0.0264 - val_loss: 0.0875
Epoch 18/120
508/508 - 2s - 4ms/step - loss: 0.0262 - val_loss: 0.0862
Epoch 19/120
508/508 - 2s - 4ms/step - loss: 0.0258 - val_loss: 0.0883
Epoch 20/120
508/508 - 2s - 4ms/step - loss: 0.0254 - val_loss: 0.0885
Epoch 21/120
508/508 - 2s - 4ms/step - loss: 0.0257 - val_loss: 0.0865
Epoch 22/120
508/508 - 2s - 4ms/step - loss: 0.0249 - val_loss: 0.0866
Epoch 23/120
508/508 - 2s - 4ms/step - loss: 0.0248 - val_loss: 0.0885
Epoch 24/120
508/508 - 2s - 4ms/step - loss: 0.0246 - val_loss: 0.0876
Epoch 25/120
508/508 - 2s - 4ms/step - loss: 0.0241 - val_loss: 0.0852
Epoch 26/120
508/508 - 2s - 4ms/step - loss: 0.0241 - val_loss: 0.0873
Epoch 27/120
508/508 - 2s - 4ms/step - loss: 0.0239 - val_loss: 0.0874
Epoch 28/120
508/508 - 2s - 4ms/step - loss: 0.0239 - val_loss: 0.0870
Epoch 29/120
508/508 - 2s - 4ms/step - loss: 0.0235 - val_loss: 0.0870
Epoch 30/120
508/508 - 2s - 4ms/step - loss: 0.0237 - val_loss: 0.0863
Epoch 31/120
508/508 - 2s - 4ms/step - loss: 0.0235 - val_loss: 0.0894
Epoch 32/120
508/508 - 2s - 4ms/step - loss: 0.0232 - val_loss: 0.0876
Epoch 33/120
508/508 - 2s - 4ms/step - loss: 0.0232 - val_loss: 0.0886
Epoch 34/120
508/508 - 2s - 4ms/step - loss: 0.0230 - val_loss: 0.0866
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_train_test_H100.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.0501
Per-joint RMSE: 0.0491 0.0511 0.0697 0.0378 0.0482 0.0381
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=0 H=100 ###
##################################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/scalers_H100.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2 --H 100 --split test --features full --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl --K 84 --test_fraction 0.2 --seed 0 --dataset_seed 1 --delan_seed -1 --delan_epochs 200 --hp_preset lutter_like_256_wd1e4 --delan_rmse_val 0.5135230657472838 --delan_rmse_test 0.3582080470488492' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:16:24.449331: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:16:24.475478: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-l6k4qowi because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 100
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-30 16:16:25.473967: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:16:25.478728: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:16:25.479520: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:16:25.481178: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:16:25.481966: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:16:25.482778: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:16:25.564899: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:16:25.565735: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:16:25.566558: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:16:25.567292: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9097 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 16:16:25.872323: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.294100e-01  RMSE=3.597360e-01
  per-joint RMSE: 0.4059 0.5436 0.3843 0.2447 0.2334 0.2326
Residual LSTM:  MSE=2.513944e-03      RMSE=5.013925e-02
  per-joint RMSE: 0.0491 0.0511 0.0697 0.0378 0.0482 0.0381
Combined torque MSE=2.513944e-03     RMSE=5.013925e-02
  per-joint RMSE: 0.0491 0.0511 0.0697 0.0378 0.0482 0.0381
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_test_H100.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_test_H100.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/combined_predictions_test_H100.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_rmse_time_test_H100.png


###############################
### TRAIN LSTM seed=1 H=100 ###
###############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H100__feat_full__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 1 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:16:27.792728: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:16:27.817822: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-0ptknoo8 because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H100__feat_full__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H100__feat_full__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
   H  = 100
  din = 24
 dout = 6
  X_train = (36119, 100, 24), Y_train = (36119, 6)
  X_test  = (6505, 100, 24),  Y_test  = (6505, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/scalers_H100.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 16:16:29.455233: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:16:29.459991: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:16:29.461111: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:16:29.463009: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:16:29.463909: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:16:29.464903: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:16:29.550501: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:16:29.551528: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:16:29.552336: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:16:29.553123: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9110 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 100, 128)       │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 100, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 16:16:30.695923: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
508/508 - 4s - 7ms/step - loss: 0.1089 - val_loss: 0.1142
Epoch 2/120
508/508 - 2s - 4ms/step - loss: 0.0561 - val_loss: 0.1144
Epoch 3/120
508/508 - 2s - 4ms/step - loss: 0.0472 - val_loss: 0.0998
Epoch 4/120
508/508 - 2s - 4ms/step - loss: 0.0418 - val_loss: 0.0917
Epoch 5/120
508/508 - 2s - 4ms/step - loss: 0.0386 - val_loss: 0.0976
Epoch 6/120
508/508 - 2s - 4ms/step - loss: 0.0360 - val_loss: 0.0963
Epoch 7/120
508/508 - 2s - 4ms/step - loss: 0.0350 - val_loss: 0.0932
Epoch 8/120
508/508 - 2s - 4ms/step - loss: 0.0329 - val_loss: 0.0921
Epoch 9/120
508/508 - 2s - 4ms/step - loss: 0.0317 - val_loss: 0.0944
Epoch 10/120
508/508 - 2s - 4ms/step - loss: 0.0311 - val_loss: 0.0929
Epoch 11/120
508/508 - 2s - 4ms/step - loss: 0.0297 - val_loss: 0.0909
Epoch 12/120
508/508 - 2s - 4ms/step - loss: 0.0290 - val_loss: 0.1020
Epoch 13/120
508/508 - 2s - 4ms/step - loss: 0.0285 - val_loss: 0.0969
Epoch 14/120
508/508 - 2s - 4ms/step - loss: 0.0278 - val_loss: 0.0927
Epoch 15/120
508/508 - 2s - 4ms/step - loss: 0.0275 - val_loss: 0.0901
Epoch 16/120
508/508 - 2s - 4ms/step - loss: 0.0272 - val_loss: 0.0945
Epoch 17/120
508/508 - 2s - 4ms/step - loss: 0.0264 - val_loss: 0.0921
Epoch 18/120
508/508 - 2s - 4ms/step - loss: 0.0261 - val_loss: 0.0957
Epoch 19/120
508/508 - 2s - 4ms/step - loss: 0.0259 - val_loss: 0.0997
Epoch 20/120
508/508 - 2s - 4ms/step - loss: 0.0257 - val_loss: 0.0969
Epoch 21/120
508/508 - 2s - 4ms/step - loss: 0.0251 - val_loss: 0.0985
Epoch 22/120
508/508 - 2s - 4ms/step - loss: 0.0252 - val_loss: 0.0987
Epoch 23/120
508/508 - 2s - 4ms/step - loss: 0.0245 - val_loss: 0.0922
Epoch 24/120
508/508 - 2s - 4ms/step - loss: 0.0249 - val_loss: 0.0956
Epoch 25/120
508/508 - 2s - 4ms/step - loss: 0.0244 - val_loss: 0.0954
Epoch 26/120
508/508 - 2s - 4ms/step - loss: 0.0242 - val_loss: 0.0888
Epoch 27/120
508/508 - 2s - 4ms/step - loss: 0.0238 - val_loss: 0.0921
Epoch 28/120
508/508 - 2s - 4ms/step - loss: 0.0242 - val_loss: 0.0933
Epoch 29/120
508/508 - 2s - 4ms/step - loss: 0.0238 - val_loss: 0.0893
Epoch 30/120
508/508 - 2s - 4ms/step - loss: 0.0234 - val_loss: 0.0865
Epoch 31/120
508/508 - 2s - 4ms/step - loss: 0.0233 - val_loss: 0.0843
Epoch 32/120
508/508 - 2s - 4ms/step - loss: 0.0235 - val_loss: 0.0850
Epoch 33/120
508/508 - 2s - 4ms/step - loss: 0.0231 - val_loss: 0.0872
Epoch 34/120
508/508 - 2s - 4ms/step - loss: 0.0230 - val_loss: 0.0862
Epoch 35/120
508/508 - 2s - 4ms/step - loss: 0.0230 - val_loss: 0.0890
Epoch 36/120
508/508 - 2s - 4ms/step - loss: 0.0229 - val_loss: 0.0875
Epoch 37/120
508/508 - 2s - 4ms/step - loss: 0.0229 - val_loss: 0.0864
Epoch 38/120
508/508 - 2s - 4ms/step - loss: 0.0226 - val_loss: 0.0908
Epoch 39/120
508/508 - 2s - 4ms/step - loss: 0.0226 - val_loss: 0.0875
Epoch 40/120
508/508 - 2s - 4ms/step - loss: 0.0224 - val_loss: 0.0867
Epoch 41/120
508/508 - 2s - 4ms/step - loss: 0.0224 - val_loss: 0.0865
Epoch 42/120
508/508 - 2s - 4ms/step - loss: 0.0221 - val_loss: 0.0873
Epoch 43/120
508/508 - 2s - 4ms/step - loss: 0.0222 - val_loss: 0.0874
Epoch 44/120
508/508 - 2s - 4ms/step - loss: 0.0224 - val_loss: 0.0821
Epoch 45/120
508/508 - 2s - 4ms/step - loss: 0.0221 - val_loss: 0.0890
Epoch 46/120
508/508 - 2s - 4ms/step - loss: 0.0220 - val_loss: 0.0872
Epoch 47/120
508/508 - 2s - 4ms/step - loss: 0.0220 - val_loss: 0.0869
Epoch 48/120
508/508 - 2s - 4ms/step - loss: 0.0218 - val_loss: 0.0852
Epoch 49/120
508/508 - 2s - 4ms/step - loss: 0.0218 - val_loss: 0.0876
Epoch 50/120
508/508 - 2s - 4ms/step - loss: 0.0218 - val_loss: 0.0892
Epoch 51/120
508/508 - 2s - 4ms/step - loss: 0.0215 - val_loss: 0.0861
Epoch 52/120
508/508 - 2s - 4ms/step - loss: 0.0214 - val_loss: 0.0863
Epoch 53/120
508/508 - 2s - 4ms/step - loss: 0.0214 - val_loss: 0.0857
Epoch 54/120
508/508 - 2s - 4ms/step - loss: 0.0214 - val_loss: 0.0918
Epoch 55/120
508/508 - 2s - 4ms/step - loss: 0.0213 - val_loss: 0.0855
Epoch 56/120
508/508 - 2s - 4ms/step - loss: 0.0214 - val_loss: 0.0886
Epoch 57/120
508/508 - 2s - 4ms/step - loss: 0.0212 - val_loss: 0.0891
Epoch 58/120
508/508 - 2s - 4ms/step - loss: 0.0212 - val_loss: 0.0866
Epoch 59/120
508/508 - 2s - 4ms/step - loss: 0.0212 - val_loss: 0.0865
Epoch 60/120
508/508 - 2s - 4ms/step - loss: 0.0211 - val_loss: 0.0912
Epoch 61/120
508/508 - 2s - 4ms/step - loss: 0.0211 - val_loss: 0.0899
Epoch 62/120
508/508 - 2s - 4ms/step - loss: 0.0211 - val_loss: 0.0924
Epoch 63/120
508/508 - 2s - 4ms/step - loss: 0.0208 - val_loss: 0.0941
Epoch 64/120
508/508 - 2s - 4ms/step - loss: 0.0207 - val_loss: 0.0957
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_train_test_H100.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.0494
Per-joint RMSE: 0.0506 0.0470 0.0733 0.0377 0.0438 0.0337
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=1 H=100 ###
##################################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/scalers_H100.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2 --H 100 --split test --features full --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl --K 84 --test_fraction 0.2 --seed 1 --dataset_seed 1 --delan_seed -1 --delan_epochs 200 --hp_preset lutter_like_256_wd1e4 --delan_rmse_val 0.5135230657472838 --delan_rmse_test 0.3582080470488492' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:18:54.700258: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:18:54.726788: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-tx34yato because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 100
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-30 16:18:55.750913: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:18:55.755719: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:18:55.756514: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:18:55.758132: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:18:55.759012: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:18:55.759835: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:18:55.838208: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:18:55.839101: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:18:55.839854: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:18:55.840594: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9057 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 16:18:56.150582: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.294100e-01  RMSE=3.597360e-01
  per-joint RMSE: 0.4059 0.5436 0.3843 0.2447 0.2334 0.2326
Residual LSTM:  MSE=2.436186e-03      RMSE=4.935774e-02
  per-joint RMSE: 0.0506 0.0470 0.0733 0.0377 0.0438 0.0337
Combined torque MSE=2.436186e-03     RMSE=4.935774e-02
  per-joint RMSE: 0.0506 0.0470 0.0733 0.0377 0.0438 0.0337
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_test_H100.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_test_H100.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/combined_predictions_test_H100.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_rmse_time_test_H100.png


###############################
### CONFIG: feat=state H=50 ###
###############################

##########################################
### BUILD LSTM WINDOWS H=50 feat=state ###
##########################################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --out_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --H 50 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
  out_npz     = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.json
H=50, n_dof=6, feature_dim=18
X_train: (37069, 50, 18)  Y_train: (37069, 6)
X_test : (6755, 50, 18)  Y_test : (6755, 6)
feature_mode=state


##############################
### TRAIN LSTM seed=0 H=50 ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 0 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:18:58.689673: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:18:58.716325: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-33ylycn5 because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (37069, 50, 18), Y_train = (37069, 6)
  X_test  = (6755, 50, 18),  Y_test  = (6755, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 16:19:00.069314: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:19:00.074516: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:19:00.075451: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:19:00.077281: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:19:00.078291: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:19:00.079172: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:19:00.163224: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:19:00.164132: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:19:00.164944: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:19:00.165748: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9025 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 16:19:01.196415: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
522/522 - 3s - 6ms/step - loss: 0.1107 - val_loss: 0.1368
Epoch 2/120
522/522 - 2s - 3ms/step - loss: 0.0588 - val_loss: 0.1442
Epoch 3/120
522/522 - 2s - 3ms/step - loss: 0.0493 - val_loss: 0.1461
Epoch 4/120
522/522 - 2s - 3ms/step - loss: 0.0432 - val_loss: 0.1409
Epoch 5/120
522/522 - 2s - 3ms/step - loss: 0.0401 - val_loss: 0.1353
Epoch 6/120
522/522 - 2s - 3ms/step - loss: 0.0375 - val_loss: 0.1465
Epoch 7/120
522/522 - 2s - 3ms/step - loss: 0.0363 - val_loss: 0.1475
Epoch 8/120
522/522 - 2s - 3ms/step - loss: 0.0348 - val_loss: 0.1443
Epoch 9/120
522/522 - 2s - 3ms/step - loss: 0.0334 - val_loss: 0.1404
Epoch 10/120
522/522 - 2s - 3ms/step - loss: 0.0322 - val_loss: 0.1428
Epoch 11/120
522/522 - 2s - 3ms/step - loss: 0.0314 - val_loss: 0.1348
Epoch 12/120
522/522 - 2s - 3ms/step - loss: 0.0311 - val_loss: 0.1371
Epoch 13/120
522/522 - 2s - 3ms/step - loss: 0.0295 - val_loss: 0.1348
Epoch 14/120
522/522 - 2s - 3ms/step - loss: 0.0295 - val_loss: 0.1376
Epoch 15/120
522/522 - 2s - 3ms/step - loss: 0.0288 - val_loss: 0.1373
Epoch 16/120
522/522 - 2s - 3ms/step - loss: 0.0282 - val_loss: 0.1340
Epoch 17/120
522/522 - 2s - 3ms/step - loss: 0.0277 - val_loss: 0.1377
Epoch 18/120
522/522 - 2s - 3ms/step - loss: 0.0277 - val_loss: 0.1338
Epoch 19/120
522/522 - 2s - 3ms/step - loss: 0.0272 - val_loss: 0.1341
Epoch 20/120
522/522 - 2s - 3ms/step - loss: 0.0272 - val_loss: 0.1349
Epoch 21/120
522/522 - 2s - 3ms/step - loss: 0.0263 - val_loss: 0.1378
Epoch 22/120
522/522 - 2s - 3ms/step - loss: 0.0260 - val_loss: 0.1390
Epoch 23/120
522/522 - 2s - 3ms/step - loss: 0.0260 - val_loss: 0.1440
Epoch 24/120
522/522 - 2s - 3ms/step - loss: 0.0257 - val_loss: 0.1490
Epoch 25/120
522/522 - 2s - 3ms/step - loss: 0.0255 - val_loss: 0.1327
Epoch 26/120
522/522 - 2s - 3ms/step - loss: 0.0254 - val_loss: 0.1363
Epoch 27/120
522/522 - 2s - 3ms/step - loss: 0.0249 - val_loss: 0.1393
Epoch 28/120
522/522 - 2s - 3ms/step - loss: 0.0250 - val_loss: 0.1375
Epoch 29/120
522/522 - 2s - 3ms/step - loss: 0.0247 - val_loss: 0.1403
Epoch 30/120
522/522 - 2s - 3ms/step - loss: 0.0246 - val_loss: 0.1355
Epoch 31/120
522/522 - 2s - 3ms/step - loss: 0.0246 - val_loss: 0.1397
Epoch 32/120
522/522 - 2s - 3ms/step - loss: 0.0242 - val_loss: 0.1356
Epoch 33/120
522/522 - 2s - 3ms/step - loss: 0.0240 - val_loss: 0.1369
Epoch 34/120
522/522 - 2s - 3ms/step - loss: 0.0242 - val_loss: 0.1362
Epoch 35/120
522/522 - 2s - 3ms/step - loss: 0.0240 - val_loss: 0.1394
Epoch 36/120
522/522 - 2s - 3ms/step - loss: 0.0239 - val_loss: 0.1362
Epoch 37/120
522/522 - 2s - 3ms/step - loss: 0.0237 - val_loss: 0.1324
Epoch 38/120
522/522 - 2s - 3ms/step - loss: 0.0234 - val_loss: 0.1362
Epoch 39/120
522/522 - 2s - 3ms/step - loss: 0.0238 - val_loss: 0.1399
Epoch 40/120
522/522 - 2s - 3ms/step - loss: 0.0234 - val_loss: 0.1367
Epoch 41/120
522/522 - 2s - 3ms/step - loss: 0.0231 - val_loss: 0.1386
Epoch 42/120
522/522 - 2s - 3ms/step - loss: 0.0231 - val_loss: 0.1467
Epoch 43/120
522/522 - 2s - 3ms/step - loss: 0.0232 - val_loss: 0.1426
Epoch 44/120
522/522 - 2s - 3ms/step - loss: 0.0228 - val_loss: 0.1432
Epoch 45/120
522/522 - 2s - 3ms/step - loss: 0.0229 - val_loss: 0.1456
Epoch 46/120
522/522 - 2s - 3ms/step - loss: 0.0226 - val_loss: 0.1442
Epoch 47/120
522/522 - 2s - 3ms/step - loss: 0.0228 - val_loss: 0.1370
Epoch 48/120
522/522 - 2s - 3ms/step - loss: 0.0229 - val_loss: 0.1460
Epoch 49/120
522/522 - 2s - 3ms/step - loss: 0.0225 - val_loss: 0.1378
Epoch 50/120
522/522 - 2s - 3ms/step - loss: 0.0223 - val_loss: 0.1423
Epoch 51/120
522/522 - 2s - 3ms/step - loss: 0.0224 - val_loss: 0.1395
Epoch 52/120
522/522 - 2s - 3ms/step - loss: 0.0223 - val_loss: 0.1447
Epoch 53/120
522/522 - 2s - 3ms/step - loss: 0.0225 - val_loss: 0.1431
Epoch 54/120
522/522 - 2s - 3ms/step - loss: 0.0222 - val_loss: 0.1400
Epoch 55/120
522/522 - 2s - 3ms/step - loss: 0.0222 - val_loss: 0.1407
Epoch 56/120
522/522 - 2s - 3ms/step - loss: 0.0223 - val_loss: 0.1424
Epoch 57/120
522/522 - 2s - 3ms/step - loss: 0.0220 - val_loss: 0.1386
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.0561
Per-joint RMSE: 0.0598 0.0556 0.0743 0.0462 0.0454 0.0499
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_rmse_time.png


#################################
### COMBINED EVAL seed=0 H=50 ###
#################################

======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/scalers_H50.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2 --H 50 --split test --features state --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl --K 84 --test_fraction 0.2 --seed 0 --dataset_seed 1 --delan_seed -1 --delan_epochs 200 --hp_preset lutter_like_256_wd1e4 --delan_rmse_val 0.5135230657472838 --delan_rmse_test 0.3582080470488492' ===
======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:20:32.188423: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:20:32.214260: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-lbb8sclb because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 16:20:33.223734: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:20:33.228433: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:20:33.229229: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:20:33.230950: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:20:33.231740: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:20:33.232533: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:20:33.310407: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:20:33.311404: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:20:33.312233: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:20:33.312963: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9336 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 16:20:33.614406: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.294841e-01  RMSE=3.598391e-01
  per-joint RMSE: 0.4098 0.5424 0.3822 0.2443 0.2329 0.2341
Residual LSTM:  MSE=3.144288e-03      RMSE=5.607395e-02
  per-joint RMSE: 0.0598 0.0556 0.0743 0.0462 0.0454 0.0499
Combined torque MSE=3.144288e-03     RMSE=5.607395e-02
  per-joint RMSE: 0.0598 0.0556 0.0743 0.0462 0.0454 0.0499
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_test_H50.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_rmse_time_test_H50.png


##############################
### TRAIN LSTM seed=1 H=50 ###
##############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 1 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:20:35.495927: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:20:35.521986: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-7ayr563j because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (37069, 50, 18), Y_train = (37069, 6)
  X_test  = (6755, 50, 18),  Y_test  = (6755, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 16:20:36.811757: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:20:36.816444: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:20:36.817242: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:20:36.818925: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:20:36.819725: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:20:36.820528: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:20:36.893086: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:20:36.893925: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:20:36.894661: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:20:36.895628: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9308 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 16:20:37.889032: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
522/522 - 3s - 6ms/step - loss: 0.1119 - val_loss: 0.1432
Epoch 2/120
522/522 - 2s - 3ms/step - loss: 0.0584 - val_loss: 0.1382
Epoch 3/120
522/522 - 2s - 3ms/step - loss: 0.0491 - val_loss: 0.1308
Epoch 4/120
522/522 - 2s - 3ms/step - loss: 0.0434 - val_loss: 0.1439
Epoch 5/120
522/522 - 2s - 3ms/step - loss: 0.0403 - val_loss: 0.1367
Epoch 6/120
522/522 - 2s - 3ms/step - loss: 0.0377 - val_loss: 0.1423
Epoch 7/120
522/522 - 2s - 3ms/step - loss: 0.0361 - val_loss: 0.1484
Epoch 8/120
522/522 - 2s - 3ms/step - loss: 0.0344 - val_loss: 0.1524
Epoch 9/120
522/522 - 2s - 3ms/step - loss: 0.0340 - val_loss: 0.1338
Epoch 10/120
522/522 - 2s - 3ms/step - loss: 0.0323 - val_loss: 0.1463
Epoch 11/120
522/522 - 2s - 3ms/step - loss: 0.0317 - val_loss: 0.1403
Epoch 12/120
522/522 - 2s - 3ms/step - loss: 0.0305 - val_loss: 0.1346
Epoch 13/120
522/522 - 2s - 3ms/step - loss: 0.0302 - val_loss: 0.1341
Epoch 14/120
522/522 - 2s - 3ms/step - loss: 0.0298 - val_loss: 0.1322
Epoch 15/120
522/522 - 2s - 3ms/step - loss: 0.0290 - val_loss: 0.1392
Epoch 16/120
522/522 - 2s - 3ms/step - loss: 0.0285 - val_loss: 0.1409
Epoch 17/120
522/522 - 2s - 3ms/step - loss: 0.0278 - val_loss: 0.1367
Epoch 18/120
522/522 - 2s - 3ms/step - loss: 0.0277 - val_loss: 0.1380
Epoch 19/120
522/522 - 2s - 3ms/step - loss: 0.0272 - val_loss: 0.1376
Epoch 20/120
522/522 - 2s - 3ms/step - loss: 0.0269 - val_loss: 0.1431
Epoch 21/120
522/522 - 2s - 3ms/step - loss: 0.0267 - val_loss: 0.1374
Epoch 22/120
522/522 - 2s - 3ms/step - loss: 0.0265 - val_loss: 0.1379
Epoch 23/120
522/522 - 2s - 3ms/step - loss: 0.0263 - val_loss: 0.1345
Epoch 24/120
522/522 - 2s - 3ms/step - loss: 0.0260 - val_loss: 0.1408
Epoch 25/120
522/522 - 2s - 3ms/step - loss: 0.0256 - val_loss: 0.1381
Epoch 26/120
522/522 - 2s - 3ms/step - loss: 0.0254 - val_loss: 0.1467
Epoch 27/120
522/522 - 2s - 3ms/step - loss: 0.0255 - val_loss: 0.1435
Epoch 28/120
522/522 - 2s - 3ms/step - loss: 0.0253 - val_loss: 0.1368
Epoch 29/120
522/522 - 2s - 3ms/step - loss: 0.0248 - val_loss: 0.1461
Epoch 30/120
522/522 - 2s - 3ms/step - loss: 0.0247 - val_loss: 0.1351
Epoch 31/120
522/522 - 2s - 3ms/step - loss: 0.0244 - val_loss: 0.1468
Epoch 32/120
522/522 - 2s - 3ms/step - loss: 0.0242 - val_loss: 0.1395
Epoch 33/120
522/522 - 2s - 3ms/step - loss: 0.0242 - val_loss: 0.1413
Epoch 34/120
522/522 - 2s - 3ms/step - loss: 0.0241 - val_loss: 0.1402
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.0584
Per-joint RMSE: 0.0577 0.0656 0.0745 0.0467 0.0499 0.0509
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_rmse_time.png


#################################
### COMBINED EVAL seed=1 H=50 ###
#################################

======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/scalers_H50.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2 --H 50 --split test --features state --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl --K 84 --test_fraction 0.2 --seed 1 --dataset_seed 1 --delan_seed -1 --delan_epochs 200 --hp_preset lutter_like_256_wd1e4 --delan_rmse_val 0.5135230657472838 --delan_rmse_test 0.3582080470488492' ===
======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:21:32.602372: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:21:32.628546: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-z1r_tqlg because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 16:21:33.626651: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:21:33.631451: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:21:33.632249: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:21:33.633949: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:21:33.634816: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:21:33.635546: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:21:33.716633: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:21:33.717615: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:21:33.718423: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:21:33.719248: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9174 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 16:21:34.023377: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.294841e-01  RMSE=3.598391e-01
  per-joint RMSE: 0.4098 0.5424 0.3822 0.2443 0.2329 0.2341
Residual LSTM:  MSE=5.165862e-03      RMSE=7.187393e-02
  per-joint RMSE: 0.0777 0.0882 0.0853 0.0530 0.0582 0.0608
Combined torque MSE=5.165862e-03     RMSE=7.187393e-02
  per-joint RMSE: 0.0777 0.0882 0.0853 0.0530 0.0582 0.0608
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_test_H50.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_rmse_time_test_H50.png


################################
### CONFIG: feat=state H=100 ###
################################

###########################################
### BUILD LSTM WINDOWS H=100 feat=state ###
###########################################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --out_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H100__feat_state__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --H 100 --features state' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
  out_npz     = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H100__feat_state__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
  H           = 100
  feature_mode= state
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H100__feat_state__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H100__feat_state__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H100__feat_state__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H100__feat_state__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.json
H=100, n_dof=6, feature_dim=18
X_train: (36119, 100, 18)  Y_train: (36119, 6)
X_test : (6505, 100, 18)  Y_test : (6505, 6)
feature_mode=state


###############################
### TRAIN LSTM seed=0 H=100 ###
###############################

==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H100__feat_state__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 0 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:21:36.481915: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:21:36.508521: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-eddlyg9j because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H100__feat_state__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H100__feat_state__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
   H  = 100
  din = 18
 dout = 6
  X_train = (36119, 100, 18), Y_train = (36119, 6)
  X_test  = (6505, 100, 18),  Y_test  = (6505, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/scalers_H100.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 16:21:38.074262: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:21:38.079303: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:21:38.080217: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:21:38.082056: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:21:38.082972: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:21:38.083865: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:21:38.174838: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:21:38.175762: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:21:38.176704: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:21:38.177600: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9159 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 100, 128)       │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 100, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 16:21:39.266090: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
508/508 - 4s - 7ms/step - loss: 0.1124 - val_loss: 0.1364
Epoch 2/120
508/508 - 2s - 4ms/step - loss: 0.0592 - val_loss: 0.1347
Epoch 3/120
508/508 - 2s - 5ms/step - loss: 0.0496 - val_loss: 0.1303
Epoch 4/120
508/508 - 2s - 4ms/step - loss: 0.0443 - val_loss: 0.1285
Epoch 5/120
508/508 - 2s - 4ms/step - loss: 0.0412 - val_loss: 0.1229
Epoch 6/120
508/508 - 2s - 4ms/step - loss: 0.0376 - val_loss: 0.1221
Epoch 7/120
508/508 - 2s - 4ms/step - loss: 0.0361 - val_loss: 0.1205
Epoch 8/120
508/508 - 2s - 4ms/step - loss: 0.0344 - val_loss: 0.1181
Epoch 9/120
508/508 - 2s - 4ms/step - loss: 0.0334 - val_loss: 0.1224
Epoch 10/120
508/508 - 2s - 4ms/step - loss: 0.0322 - val_loss: 0.1275
Epoch 11/120
508/508 - 2s - 4ms/step - loss: 0.0315 - val_loss: 0.1280
Epoch 12/120
508/508 - 2s - 4ms/step - loss: 0.0310 - val_loss: 0.1253
Epoch 13/120
508/508 - 2s - 4ms/step - loss: 0.0296 - val_loss: 0.1224
Epoch 14/120
508/508 - 2s - 4ms/step - loss: 0.0293 - val_loss: 0.1259
Epoch 15/120
508/508 - 2s - 4ms/step - loss: 0.0287 - val_loss: 0.1326
Epoch 16/120
508/508 - 2s - 4ms/step - loss: 0.0284 - val_loss: 0.1299
Epoch 17/120
508/508 - 2s - 4ms/step - loss: 0.0279 - val_loss: 0.1278
Epoch 18/120
508/508 - 2s - 4ms/step - loss: 0.0276 - val_loss: 0.1243
Epoch 19/120
508/508 - 2s - 4ms/step - loss: 0.0271 - val_loss: 0.1266
Epoch 20/120
508/508 - 2s - 4ms/step - loss: 0.0266 - val_loss: 0.1260
Epoch 21/120
508/508 - 2s - 4ms/step - loss: 0.0270 - val_loss: 0.1265
Epoch 22/120
508/508 - 2s - 4ms/step - loss: 0.0261 - val_loss: 0.1320
Epoch 23/120
508/508 - 2s - 4ms/step - loss: 0.0258 - val_loss: 0.1341
Epoch 24/120
508/508 - 2s - 4ms/step - loss: 0.0258 - val_loss: 0.1361
Epoch 25/120
508/508 - 2s - 4ms/step - loss: 0.0253 - val_loss: 0.1359
Epoch 26/120
508/508 - 2s - 4ms/step - loss: 0.0251 - val_loss: 0.1334
Epoch 27/120
508/508 - 2s - 4ms/step - loss: 0.0251 - val_loss: 0.1360
Epoch 28/120
508/508 - 2s - 4ms/step - loss: 0.0249 - val_loss: 0.1366
Epoch 29/120
508/508 - 2s - 4ms/step - loss: 0.0245 - val_loss: 0.1364
Epoch 30/120
508/508 - 2s - 4ms/step - loss: 0.0245 - val_loss: 0.1393
Epoch 31/120
508/508 - 2s - 4ms/step - loss: 0.0240 - val_loss: 0.1361
Epoch 32/120
508/508 - 2s - 4ms/step - loss: 0.0244 - val_loss: 0.1365
Epoch 33/120
508/508 - 2s - 4ms/step - loss: 0.0239 - val_loss: 0.1382
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_train_test_H100.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.0568
Per-joint RMSE: 0.0538 0.0592 0.0776 0.0462 0.0508 0.0470
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=0 H=100 ###
##################################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/scalers_H100.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2 --H 100 --split test --features state --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl --K 84 --test_fraction 0.2 --seed 0 --dataset_seed 1 --delan_seed -1 --delan_epochs 200 --hp_preset lutter_like_256_wd1e4 --delan_rmse_val 0.5135230657472838 --delan_rmse_test 0.3582080470488492' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:22:54.700317: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:22:54.726495: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-4ynbobl9 because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 100
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 16:22:55.714089: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:22:55.718897: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:22:55.719727: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:22:55.721331: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:22:55.722125: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:22:55.722862: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:22:55.804247: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:22:55.805118: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:22:55.805903: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:22:55.806636: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9181 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 16:22:56.113662: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.294100e-01  RMSE=3.597360e-01
  per-joint RMSE: 0.4059 0.5436 0.3843 0.2447 0.2334 0.2326
Residual LSTM:  MSE=3.872515e-03      RMSE=6.222954e-02
  per-joint RMSE: 0.0572 0.0732 0.0825 0.0496 0.0517 0.0517
Combined torque MSE=3.872515e-03     RMSE=6.222954e-02
  per-joint RMSE: 0.0572 0.0732 0.0825 0.0496 0.0517 0.0517
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_test_H100.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_test_H100.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/combined_predictions_test_H100.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_rmse_time_test_H100.png


###############################
### TRAIN LSTM seed=1 H=100 ###
###############################

==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H100__feat_state__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 1 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:22:58.066589: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:22:58.094333: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-rglw2m0s because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H100__feat_state__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__lstm_windows_H100__feat_state__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
   H  = 100
  din = 18
 dout = 6
  X_train = (36119, 100, 18), Y_train = (36119, 6)
  X_test  = (6505, 100, 18),  Y_test  = (6505, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/scalers_H100.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 16:22:59.649476: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:22:59.654176: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:22:59.655106: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:22:59.656841: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:22:59.657623: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:22:59.658362: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:22:59.749627: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:22:59.750631: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:22:59.752504: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:22:59.753542: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9108 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 100, 128)       │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 100, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 16:23:00.874442: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
508/508 - 4s - 7ms/step - loss: 0.1135 - val_loss: 0.1302
Epoch 2/120
508/508 - 2s - 4ms/step - loss: 0.0588 - val_loss: 0.1328
Epoch 3/120
508/508 - 2s - 4ms/step - loss: 0.0501 - val_loss: 0.1336
Epoch 4/120
508/508 - 2s - 4ms/step - loss: 0.0436 - val_loss: 0.1381
Epoch 5/120
508/508 - 2s - 4ms/step - loss: 0.0407 - val_loss: 0.1332
Epoch 6/120
508/508 - 2s - 4ms/step - loss: 0.0383 - val_loss: 0.1468
Epoch 7/120
508/508 - 2s - 4ms/step - loss: 0.0365 - val_loss: 0.1450
Epoch 8/120
508/508 - 2s - 4ms/step - loss: 0.0350 - val_loss: 0.1545
Epoch 9/120
508/508 - 2s - 4ms/step - loss: 0.0338 - val_loss: 0.1469
Epoch 10/120
508/508 - 2s - 4ms/step - loss: 0.0322 - val_loss: 0.1520
Epoch 11/120
508/508 - 2s - 4ms/step - loss: 0.0308 - val_loss: 0.1512
Epoch 12/120
508/508 - 2s - 4ms/step - loss: 0.0313 - val_loss: 0.1380
Epoch 13/120
508/508 - 2s - 4ms/step - loss: 0.0298 - val_loss: 0.1404
Epoch 14/120
508/508 - 2s - 4ms/step - loss: 0.0288 - val_loss: 0.1473
Epoch 15/120
508/508 - 2s - 4ms/step - loss: 0.0285 - val_loss: 0.1514
Epoch 16/120
508/508 - 2s - 4ms/step - loss: 0.0282 - val_loss: 0.1458
Epoch 17/120
508/508 - 2s - 5ms/step - loss: 0.0274 - val_loss: 0.1431
Epoch 18/120
508/508 - 2s - 4ms/step - loss: 0.0271 - val_loss: 0.1388
Epoch 19/120
508/508 - 2s - 4ms/step - loss: 0.0269 - val_loss: 0.1390
Epoch 20/120
508/508 - 2s - 4ms/step - loss: 0.0263 - val_loss: 0.1395
Epoch 21/120
508/508 - 2s - 4ms/step - loss: 0.0261 - val_loss: 0.1389
Epoch 22/120
508/508 - 2s - 4ms/step - loss: 0.0258 - val_loss: 0.1419
Epoch 23/120
508/508 - 2s - 4ms/step - loss: 0.0255 - val_loss: 0.1399
Epoch 24/120
508/508 - 2s - 4ms/step - loss: 0.0252 - val_loss: 0.1408
Epoch 25/120
508/508 - 2s - 4ms/step - loss: 0.0251 - val_loss: 0.1419
Epoch 26/120
508/508 - 2s - 4ms/step - loss: 0.0251 - val_loss: 0.1370
Epoch 27/120
508/508 - 2s - 4ms/step - loss: 0.0248 - val_loss: 0.1350
Epoch 28/120
508/508 - 2s - 4ms/step - loss: 0.0245 - val_loss: 0.1355
Epoch 29/120
508/508 - 2s - 4ms/step - loss: 0.0245 - val_loss: 0.1347
Epoch 30/120
508/508 - 2s - 4ms/step - loss: 0.0243 - val_loss: 0.1363
Epoch 31/120
508/508 - 2s - 4ms/step - loss: 0.0243 - val_loss: 0.1347
Epoch 32/120
508/508 - 2s - 4ms/step - loss: 0.0239 - val_loss: 0.1388
Epoch 33/120
508/508 - 2s - 4ms/step - loss: 0.0238 - val_loss: 0.1353
Epoch 34/120
508/508 - 2s - 4ms/step - loss: 0.0239 - val_loss: 0.1385
Epoch 35/120
508/508 - 2s - 4ms/step - loss: 0.0237 - val_loss: 0.1315
Epoch 36/120
508/508 - 2s - 4ms/step - loss: 0.0236 - val_loss: 0.1326
Epoch 37/120
508/508 - 2s - 4ms/step - loss: 0.0236 - val_loss: 0.1360
Epoch 38/120
508/508 - 2s - 4ms/step - loss: 0.0231 - val_loss: 0.1326
Epoch 39/120
508/508 - 2s - 4ms/step - loss: 0.0237 - val_loss: 0.1343
Epoch 40/120
508/508 - 2s - 4ms/step - loss: 0.0230 - val_loss: 0.1363
Epoch 41/120
508/508 - 2s - 5ms/step - loss: 0.0229 - val_loss: 0.1341
Epoch 42/120
508/508 - 2s - 4ms/step - loss: 0.0228 - val_loss: 0.1434
Epoch 43/120
508/508 - 2s - 4ms/step - loss: 0.0228 - val_loss: 0.1347
Epoch 44/120
508/508 - 2s - 4ms/step - loss: 0.0229 - val_loss: 0.1362
Epoch 45/120
508/508 - 2s - 4ms/step - loss: 0.0225 - val_loss: 0.1367
Epoch 46/120
508/508 - 2s - 4ms/step - loss: 0.0225 - val_loss: 0.1402
Epoch 47/120
508/508 - 2s - 4ms/step - loss: 0.0224 - val_loss: 0.1320
Epoch 48/120
508/508 - 2s - 4ms/step - loss: 0.0225 - val_loss: 0.1346
Epoch 49/120
508/508 - 2s - 4ms/step - loss: 0.0225 - val_loss: 0.1329
Epoch 50/120
508/508 - 2s - 4ms/step - loss: 0.0222 - val_loss: 0.1282
Epoch 51/120
508/508 - 2s - 4ms/step - loss: 0.0222 - val_loss: 0.1306
Epoch 52/120
508/508 - 2s - 4ms/step - loss: 0.0223 - val_loss: 0.1313
Epoch 53/120
508/508 - 2s - 4ms/step - loss: 0.0221 - val_loss: 0.1271
Epoch 54/120
508/508 - 2s - 4ms/step - loss: 0.0218 - val_loss: 0.1304
Epoch 55/120
508/508 - 2s - 4ms/step - loss: 0.0219 - val_loss: 0.1276
Epoch 56/120
508/508 - 2s - 5ms/step - loss: 0.0218 - val_loss: 0.1295
Epoch 57/120
508/508 - 2s - 5ms/step - loss: 0.0217 - val_loss: 0.1292
Epoch 58/120
508/508 - 2s - 5ms/step - loss: 0.0217 - val_loss: 0.1316
Epoch 59/120
508/508 - 2s - 4ms/step - loss: 0.0215 - val_loss: 0.1275
Epoch 60/120
508/508 - 2s - 5ms/step - loss: 0.0216 - val_loss: 0.1267
Epoch 61/120
508/508 - 2s - 5ms/step - loss: 0.0215 - val_loss: 0.1258
Epoch 62/120
508/508 - 2s - 5ms/step - loss: 0.0215 - val_loss: 0.1272
Epoch 63/120
508/508 - 2s - 5ms/step - loss: 0.0213 - val_loss: 0.1246
Epoch 64/120
508/508 - 2s - 5ms/step - loss: 0.0213 - val_loss: 0.1275
Epoch 65/120
508/508 - 2s - 5ms/step - loss: 0.0213 - val_loss: 0.1257
Epoch 66/120
508/508 - 2s - 4ms/step - loss: 0.0214 - val_loss: 0.1265
Epoch 67/120
508/508 - 2s - 4ms/step - loss: 0.0211 - val_loss: 0.1284
Epoch 68/120
508/508 - 2s - 4ms/step - loss: 0.0212 - val_loss: 0.1290
Epoch 69/120
508/508 - 2s - 4ms/step - loss: 0.0210 - val_loss: 0.1296
Epoch 70/120
508/508 - 2s - 4ms/step - loss: 0.0210 - val_loss: 0.1255
Epoch 71/120
508/508 - 2s - 4ms/step - loss: 0.0210 - val_loss: 0.1245
Epoch 72/120
508/508 - 2s - 5ms/step - loss: 0.0209 - val_loss: 0.1252
Epoch 73/120
508/508 - 2s - 4ms/step - loss: 0.0207 - val_loss: 0.1240
Epoch 74/120
508/508 - 2s - 4ms/step - loss: 0.0209 - val_loss: 0.1253
Epoch 75/120
508/508 - 2s - 4ms/step - loss: 0.0211 - val_loss: 0.1260
Epoch 76/120
508/508 - 2s - 5ms/step - loss: 0.0209 - val_loss: 0.1304
Epoch 77/120
508/508 - 2s - 4ms/step - loss: 0.0209 - val_loss: 0.1248
Epoch 78/120
508/508 - 2s - 4ms/step - loss: 0.0208 - val_loss: 0.1256
Epoch 79/120
508/508 - 2s - 4ms/step - loss: 0.0205 - val_loss: 0.1267
Epoch 80/120
508/508 - 2s - 4ms/step - loss: 0.0205 - val_loss: 0.1304
Epoch 81/120
508/508 - 2s - 4ms/step - loss: 0.0206 - val_loss: 0.1267
Epoch 82/120
508/508 - 2s - 4ms/step - loss: 0.0207 - val_loss: 0.1251
Epoch 83/120
508/508 - 2s - 4ms/step - loss: 0.0206 - val_loss: 0.1351
Epoch 84/120
508/508 - 2s - 4ms/step - loss: 0.0205 - val_loss: 0.1365
Epoch 85/120
508/508 - 2s - 4ms/step - loss: 0.0203 - val_loss: 0.1388
Epoch 86/120
508/508 - 2s - 4ms/step - loss: 0.0204 - val_loss: 0.1296
Epoch 87/120
508/508 - 2s - 4ms/step - loss: 0.0203 - val_loss: 0.1298
Epoch 88/120
508/508 - 2s - 4ms/step - loss: 0.0201 - val_loss: 0.1337
Epoch 89/120
508/508 - 2s - 4ms/step - loss: 0.0202 - val_loss: 0.1331
Epoch 90/120
508/508 - 2s - 4ms/step - loss: 0.0203 - val_loss: 0.1324
Epoch 91/120
508/508 - 2s - 4ms/step - loss: 0.0201 - val_loss: 0.1312
Epoch 92/120
508/508 - 2s - 4ms/step - loss: 0.0202 - val_loss: 0.1301
Epoch 93/120
508/508 - 2s - 4ms/step - loss: 0.0200 - val_loss: 0.1361
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_train_test_H100.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.0525
Per-joint RMSE: 0.0538 0.0499 0.0748 0.0409 0.0451 0.0432
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=1 H=100 ###
##################################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/scalers_H100.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2 --H 100 --split test --features state --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl --K 84 --test_fraction 0.2 --seed 1 --dataset_seed 1 --delan_seed -1 --delan_epochs 200 --hp_preset lutter_like_256_wd1e4 --delan_rmse_val 0.5135230657472838 --delan_rmse_test 0.3582080470488492' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 16:26:32.521874: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 16:26:32.547962: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-yqmv_0rh because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 100
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 16:26:33.537972: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:26:33.542787: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:26:33.543602: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:26:33.545315: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:26:33.546108: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:26:33.546923: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:26:33.623460: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:26:33.624289: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:26:33.625036: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 16:26:33.625764: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9327 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 16:26:33.929797: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.294100e-01  RMSE=3.597360e-01
  per-joint RMSE: 0.4059 0.5436 0.3843 0.2447 0.2334 0.2326
Residual LSTM:  MSE=2.758205e-03      RMSE=5.251862e-02
  per-joint RMSE: 0.0538 0.0499 0.0748 0.0409 0.0451 0.0432
Combined torque MSE=2.758205e-03     RMSE=5.251862e-02
  per-joint RMSE: 0.0538 0.0499 0.0748 0.0409 0.0451 0.0432
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_test_H100.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_test_H100.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_170200.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/combined_predictions_test_H100.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_170200/UR3_Load0_5x10^4_under__best5x10L0__K84__d1__delan_jax_struct_s0_ep200_hp_lutter_like_256_wd1e4_actsoftplus_b1024_lr1e-4_wd1e-4_w256_d2__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_rmse_time_test_H100.png

